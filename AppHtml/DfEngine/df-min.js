(()=>{"use strict";const e={isSafari:!1,isChrome:!1,isOpera:!1,isMoz:!1,isIE:!1,isEdge:!1,isWebkit:!1,isMobile:!1,isIOS:!1,iVersion:0,detectDevice(){this._sPrevUA!==navigator.userAgent&&(this._sPrevUA=navigator.userAgent,this.isSafari=!1,this.isChrome=!1,this.isOpera=!1,this.isMoz=!1,this.isIE=!1,this.isEdge=!1,this.isWebkit=!1,this.isMobile=!1,this.isIOS=!1,navigator.userAgent.indexOf("Trident")>=0?(this.isIE=!0,document.documentMode?this.iVersion=document.documentMode:navigator.appVersion.indexOf("MSIE")>=0?this.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10):this.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("rv:")+3),10)):navigator.userAgent.indexOf("Edge/")>=0?(this.isEdge=!0,this.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Edge/")+5))):navigator.userAgent.indexOf("Chrome")>=0?(this.isChrome=!0,this.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Chrome/")+7))):navigator.userAgent.indexOf("Safari")>=0?(this.isSafari=!0,this.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8))):"Gecko"===navigator.product?(this.isMoz=!0,this.iVersion=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Firefox/")+8))):navigator.userAgent.indexOf("Opera")>=0?(this.isOpera=!0,this.iVersion=parseFloat(navigator.appVersion)):(this.isIE=!0,this.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10),document.documentMode&&(this.iVersion=document.documentMode)),/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i.test(navigator.userAgent)&&(this.isMobile=!0),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(this.isIOS=!0),navigator.userAgent.indexOf("AppleWebKit")>=0&&(this.isWebkit=!0))}};e.detectDevice();const t={disableTabIndexes(e){const t=df.dom.query(e,df.dom.cFocusSelector,!0);for(let e=0;e<t.length;e++){const i=t[e];null===i.getAttribute("data-dfOrigTabIndex")?(i.setAttribute("data-dfTabIndexCount",1),i.setAttribute("data-dfOrigTabIndex",i.tabIndex),i.tabIndex="-1"):i.setAttribute("data-dfTabIndexCount",parseInt(i.getAttribute("data-dfTabIndexCount"),10)+1)}},restoreTabIndexes(e){const t=df.dom.query(e,df.dom.cFocusSelector,!0);for(let e=0;e<t.length;e++){const i=t[e];null!==parseInt(i.getAttribute("data-dfTabIndexCount"),10)&&(i.getAttribute("data-dfTabIndexCount")<=1?(i.tabIndex=i.getAttribute("data-dfOrigTabIndex"),i.removeAttribute("data-dfOrigTabIndex"),i.removeAttribute("data-dfTabIndexCount")):i.setAttribute("data-dfTabIndexCount",parseInt(i.getAttribute("data-dfTabIndexCount"),10)-1))}},hidePlugins(t){const i=[];if(e.isIE){const e=df.dom.query(t,"iframe, object, embed",!0);for(let s=0;s<e.length;s++)"yes"!==(t=e[s]).getAttribute("data-df-hiddenplugin")&&(i.push(t),t.style.display="none",t.setAttribute("data-df-hiddenplugin","yes"))}return i},restorePlugins(e){for(let t=0;t<e.length;t++)e[t].style.display="",e[t].removeAttribute("data-df-hiddenplugin")},getAbsoluteOffset(e){const i={left:0,top:0};let s=!0;if(e.offsetParent)for(;e&&(s||"absolute"!==t.getCurrentStyle(e).position)&&"fixed"!==t.getCurrentStyle(e).position&&"relative"!==t.getCurrentStyle(e).position;)s=!1,i.top+=e.offsetTop,i.left+=e.offsetLeft,e=e.offsetParent;else e.y&&(i.left+=e.x,i.top+=e.y);return i},getViewportHeight:()=>void 0!==window.innerHeight?window.innerHeight:"CSS1Compat"===document.compatMode?document.documentElement.clientHeight:document.body?document.body.clientHeight:null,getViewportWidth:()=>"CSS1Compat"===document.compatMode?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0!==window.innerWidth?window.innerWidth:null,getSize(i){if(e.isIE||e.isWebkit)return{width:i.offsetWidth,height:i.offsetHeight};const s=t.getCurrentStyle(i);return{width:parseInt(s.getPropertyValue("width"),10),height:parseInt(s.getPropertyValue("height"),10)}},getCurrentStyle:e=>"function"==typeof window.getComputedStyle?window.getComputedStyle(e,null):e.currentStyle,getVertBoxDiff(e,i){let s=0;const o=t.getCurrentStyle(e);return 0!==(i=i||0)&&1!==i&&3!==i||(s+=parseFloat(o.marginTop)||0),0!==i&&1!==i||(s+=parseFloat(o.borderTopWidth)||0),0!==i&&2!==i||(s+=parseFloat(o.paddingTop)||0),0!==i&&1!==i&&3!==i||(s+=parseFloat(o.marginBottom)||0),0!==i&&1!==i||(s+=parseFloat(o.borderBottomWidth)||0),0!==i&&2!==i||(s+=parseFloat(o.paddingBottom)||0),s},getHorizBoxDiff(e,i){let s=0;const o=t.getCurrentStyle(e);return 0!==(i=i||0)&&1!==i&&3!==i||(s+=parseFloat(o.marginLeft)||0),0!==i&&1!==i||(s+=parseFloat(o.borderLeftWidth)||0),0!==i&&2!==i||(s+=parseFloat(o.paddingLeft)||0),0!==i&&1!==i&&3!==i||(s+=parseFloat(o.marginRight)||0),0!==i&&1!==i||(s+=parseFloat(o.borderRightWidth)||0),0!==i&&2!==i||(s+=parseFloat(o.paddingRight)||0),s},isSizedByContent(e){const t=e.clientHeight;e.appendChild(df.dom.create('<div style="width: 100%; height: 20px;">&nbsp</div>'));const i=t!==e.clientHeight;return e.removeChild(e.lastChild),i},getBoundRect(e){const t=e.getBoundingClientRect();return"number"!=typeof t.width?{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}:t},rectToObj:e=>({top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}),getTransformProp:function(){let e=null;return function(){return null===e&&(e=function(){const e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"];for(let t=0;t<e.length;t++)if(void 0!==document.createElement("div").style[e[t]])return e[t];return!1}()),e}}(),initCSS(){let t,i=document.body.className;i?(i=i.replace(/\bdf-ie*|df-safari|df-chrome|df-opera|df-mozilla|df-webkit|df-mobile\b/g,"").trim(),t=i.split(" ")):t=[],e.isIE?(t.push("df-ie"),t.push(e.iVersion<=6?" df-ie6":" df-ie"+e.iVersion)):e.isSafari?t.push("df-safari"):e.isChrome?t.push("df-chrome"):e.isOpera?t.push("df-opera"):e.isMoz&&t.push("df-mozilla"),e.isWebkit&&t.push("df-webkit"),e.isMobile&&t.push("df-mobile"),document.body.className=t.join(" ")},isOnScreen(e){let t=e.getBoundingClientRect();const i=t.top,s=t.height,o=t.left,n=t.width;for(e=e.offsetParent;e&&e!=document.body;){if(t=e.getBoundingClientRect(),i>t.bottom)return!1;if(o>t.right)return!1;if(i+s<=t.top)return!1;if(o+n<=t.left)return!1;e=e.offsetParent}return i<=document.documentElement.clientHeight},isElementFullyOnScreen(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},addScrollListeners(e,t,i){const s=[];for(;e;)s.push(e),df.dom.on("scroll",e,t,i),e=e.offsetParent;return s},removeScrollListeners(e,t,i){let s;for(;s=e.shift();)df.dom.off("scroll",s,t,i)},cssTextAlign(e){switch(e){case df.ciAlignLeft:return"left";case df.ciAlignCenter:return"center";case df.ciAlignRight:return"right"}return""}},i={keys:{modifier:["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Symbol","SymbolLock"],legacyModifier:["Hyper","Super"],whiteSpace:["Enter","Tab"],navigation:["ArrowDown","Down","ArrowLeft","Left","ArrowRight","Right","ArrowUp","Up","End","Home","PageDown","PageUp"],editing:["Backspace","Clear","Copy","CrSel","Cut","Delete","Del","EraseEof","ExSel","Insert","Paste","Redo","Undo"],ui:["Accept","Again","Attn","Cancel","ContextMenu","Escape","Esc","Execute","Find","Help","Pause","Play","Props","Select","ZoomIn","ZoomOut"],device:["BrightnessDown","BrightnessUp","Eject","LogOff","Power","PowerOff","PrintScreen","Hibernate","Standby","WakeUp"],imeCompositionKeys:["AllCandidates","Alphanumeric","CodeInput","Compose","Convert","Dead","FinalMode","GroupFirst","GroupLast","GroupNext","GroupPrevious","ModeChange","NextCandidate","NonConvert","PreviousCandidate","Process","SingleCandidate"],koreanSpecific:["HangulMode","HanjaMode","JunjaMode"],japaneseSpecific:["Eisu","Hankaku","Hiragana","HiraganaKatakana","KanaMode","KanjiMode","Katakana","Romaji","Zenkaku","ZenkakuHankaku"],commonFunction:["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Soft1","Soft2","Soft3","Soft4"],multimedia:["ChannelDown","ChannelUp","Close","MailForward","MailReply","MailSend","MediaClose","MediaFastForward","MediaPause","MediaPlay","MediaPlayPause","MediaRecord","MediaRewind","MediaStop","MediaTrackNext","MediaTrackPrevious","New","Open","Print","Save","SpellCheck"],multimediaNumpad:["Key11","Key12"],audio:["AudioBalanceLeft","AudioBalanceRight","AudioBassBoostDown","AudioBassBoostToggle","AudioBassBoostUp","AudioFaderFront","AudioFaderRear","AudioSurroundModeNext","AudioTrebleDown","AudioTrebleUp","AudioVolumeDown","AudioVolumeUp","AudioVolumeMute","MicrophoneToggle","MicrophoneVolumeDown","MicrophoneVolumeUp","MicrophoneVolumeMute"],speech:["SpeechCorrectionList","SpeechInputToggle"],application:["LaunchApplication1","LaunchApplication2","LaunchCalendar","LaunchContacts","LaunchMail","LaunchMediaPlayer","LaunchMusicPlayer","LaunchPhone","LaunchScreenSaver","LaunchSpreadsheet","LaunchWebBrowser","LaunchWebCam","LaunchWordProcessor"],browser:["BrowserBack","BrowserFavorites","BrowserForward","BrowserHome","BrowserRefresh","BrowserSearch","BrowserStop"],mobilePhone:["AppSwitch","Call","Camera","CameraFocus","EndCall","GoBack","GoHome","HeadsetHook","LastNumberRedial","Notification","MannerMode","VoiceDial"],tv:["TV","TV3DMode","TVAntennaCable","TVAudioDescription","TVAudioDescriptionMixDown","TVAudioDescriptionMixUp","TVContentsMenu","TVDataService","TVInput","TVInputComponent1","TVInputComponent2","TVInputComposite1","TVInputComposite2","TVInputHDMI1","TVInputHDMI2","TVInputHDMI3","TVInputHDMI4","TVInputVGA1","TVMediaContext","TVNetwork","TVNumberEntry","TVPower","TVRadioService","TVSatellite","TVSatelliteBS","TVSatelliteCS","TVSatelliteToggle","TVTerrestrialAnalog","TVTerrestrialDigital","TVTimer"],mediaControls:["AVRInput","AVRPower","ColorF0Red","ColorF1Green","ColorF2Yellow","ColorF3Blue","ColorF4Grey","ColorF5Brown","ClosedCaptionToggle","Dimmer","DisplaySwap","DVR","Exit","FavoriteClear0","FavoriteClear1","FavoriteClear2","FavoriteClear3","FavoriteRecall0","FavoriteRecall1","FavoriteRecall2","FavoriteRecall3","FavoriteStore0","FavoriteStore1","FavoriteStore2","FavoriteStore3","Guide","GuideNextDay","GuidePreviousDay","Info","InstantReplay","Link","ListProgram","LiveContent","Lock","MediaApps","MediaAudioTrack","MediaLast","MediaSkipBackward","MediaSkipForward","MediaStepBackward","MediaStepForward","MediaTopMenu","NavigateIn","NavigateNext","NavigateOut","NavigatePrevious","NextFavoriteChannel","NextUserProfile","OnDemand","Pairing","PinPDown","PinPMove","PinPToggle","PinPUp","PlaySpeedDown","PlaySpeedReset","PlaySpeedUp","RandomToggle","RcLowBattery","RecordSpeedNext","RfBypass","ScanChannelsToggle","ScreenModeNext","Settings","SplitScreenToggle","STBInput","STBPower","Subtitle","Teletext","VideoModeNext","Wink","ZoomToggle"]},allKeys:null,insertInputTypes:["insertText","insertReplacementText","insertLineBreak","insertParagraph","insertOrderedList","insertUnorderedList","insertHorizontalRule","insertFromYank","insertFromDrop","insertFromPaste","insertFromPasteAsQuotation","insertTranspose","insertCompositionText","insertLink"],KEY_CODE_TAB:9,KEY_CODE_NON_EDIT:{37:1,38:1,39:1,40:1,35:1,36:1,9:1},KEY_CODE_SPECIAL:{37:1,38:1,39:1,40:1,35:1,36:1,46:1,8:1,9:1},addDomCaptureListener(e,t,i,s){window.addEventListener&&(e="capture_"+e),this.addDomListener(e,t,i,s)},removeDomCaptureListener(e,t,i,s){window.addEventListener&&(e="capture_"+e),this.removeDomListener(e,t,i,s)},addDomListener(e,t,s,o){let n;n=void 0!==t._oDfDomH&&t._oDfDomH[e]?t._oDfDomH[e]:new i.DOMHandler(e,t),n.addListener(s,o)},removeDomListener(e,t,i,s){void 0!==t._oDfDomH&&t._oDfDomH[e]&&t._oDfDomH[e].removeListener(i,s)},addDomKeyListener(e,t,s){i.addDomListener("keydown",e,t,s)},removeDomKeyListener(e,t,s){i.removeDomListener("keydown",e,t,s)},addDomMouseWheelListener(e,t,s){df.sys.isMoz?i.addDomListener("DOMMouseScroll",e,t,s):i.addDomListener("mousewheel",e,t,s)},removeDomMouseWheelListener(e,t,s){df.sys.isMoz?i.removeDomListener("DOMMouseScroll",e,t,s):i.removeDomListener("mousewheel",e,t,s)},stop(e){e.stop()},iDOMHandlers:0,oDOMHandlers:{},clearDomHandlers(){for(const e in i.oDOMHandlers)i.oDOMHandlers.hasOwnProperty(e)&&i.oDOMHandlers[e].__DOMHandler&&i.oDOMHandlers[e].clear()},clearDomListeners(e,t){if(e._oDfDomH)for(const t in e._oDfDomH)e._oDfDomH.hasOwnProperty(t)&&e._oDfDomH[t].clear();t&&df.dom.visit(e,(function(e){i.clearDomListeners(e,!0)}))},DOMHandler:class{constructor(e,t){this.sEvent=e,this.eElement=t,this.aListeners=[],this.aRemoveListeners=[],this.bFiring=!1,this.fHandler=null,this.__DOMHandler=!0,this.iHandlerId=i.iDOMHandlers++,this.attach()}attach(){let e;const t=this;e=function(e){return t.fire(e)},window.addEventListener?"capture_"===this.sEvent.substr(0,8)?this.eElement.addEventListener(this.sEvent.substr(8),e,!0):this.eElement.addEventListener(this.sEvent,e,!1):this.eElement.attachEvent("on"+this.sEvent,e),this.eElement._oDfDomH||(this.eElement._oDfDomH={}),this.eElement._oDfDomH[this.sEvent]=this,i.oDOMHandlers[this.iHandlerId]=this,this.fHandler=e}clear(){window.addEventListener?"capture_"===this.sEvent.substr(0,8)?this.eElement.removeEventListener(this.sEvent.substr(8),this.fHandler,!0):this.eElement.removeEventListener(this.sEvent,this.fHandler,!1):this.eElement.detachEvent("on"+this.sEvent,this.fHandler),delete this.eElement._oDfDomH[this.sEvent],delete i.oDOMHandlers[this.iHandlerId]}addListener(e,t){if("function"!=typeof e)throw new df.Error(5131,"Listener must be a function (event: {{0}})",t||null,[this.sEvent]);t||console.warn("df.events.addListener()/df.dom.on() without an oEnvironment is deprecated, it could cause the wrong listener to be removed."),this.aListeners.push({fListener:e,oEnvironment:t})}removeListener(e,t){if(t){for(let i=0;i<this.aListeners.length;i++)if(this.aListeners[i].fListener===e&&this.aListeners[i].oEnvironment===t){this.bFiring?this.aRemoveListeners.push(this.aListeners[i]):this.aListeners.length>1?this.aListeners.splice(i,1):this.clear();break}}else{console.warn("df.events.removeListener()/df.dom.off() without an oEnvironment is deprecated, it could cause the wrong listener to be removed.");for(let t=0;t<this.aListeners.length;t++)if(this.aListeners[t].fListener===e){this.bFiring?this.aRemoveListeners.push(this.aListeners[t]):this.aListeners.length>1?this.aListeners.splice(t,1):this.clear();break}}}fire(e){const t=new i.DOMEvent(e,this.eElement,this.sEvent);this.bFiring=!0;for(let e=0;e<this.aListeners.length&&!t.bCanceled;e++)if("function"==typeof this.aListeners[e].fListener)try{!1===this.aListeners[e].fListener.call(void 0!==this.aListeners[e].oEnvironment?this.aListeners[e].oEnvironment:this.eElement,t)&&t.stop()}catch(e){df.handleError(e)}for(this.bFiring=!1;this.aRemoveListeners.length>0;){const e=this.aRemoveListeners.pop();this.removeListener(e.fListener,e.oEnvironment)}return!t.bCanceled||(e.preventDefault&&e.preventDefault(),e.returnValue=!1,!1)}},DOMEvent:class{constructor(e,t,i){this.eSource=t,this.e=e||window.event,this.sName=i,this.bCanceled=!1}getTarget(){let e;return this.e.target?e=this.e.target:this.e.srcElement&&(e=this.e.srcElement),3===e.nodeType&&(e=e.parentNode),e}getMouseX(){return this.e.clientX}getMouseY(){return this.e.clientY}getKeyCode(){return this.e.keyCode}isSpecialKey(){const e=this.getKeyCode();return(!df.sys.isIE&&!df.sys.isSafari||"keypress"!==this.e.type)&&(this.getAltKey()||this.getCtrlKey()||i.KEY_CODE_SPECIAL[e]&&0!==e)}isKeyPrintable(){return!this.getCtrlKey()&&!this.getAltKey()&&-1===i.allKeys.indexOf(this.e.key)}key(){return this.e.key}inputIsInsert(){return-1!==i.insertInputTypes.indexOf(this.e.inputType)}getCharCode(){return this.e.charCode?this.e.charCode:"number"!=typeof this.e.charCode?this.e.keyCode:0}getCtrlKey(){return this.e.ctrlKey}getShiftKey(){return this.e.shiftKey}getAltKey(){return this.e.altKey}getMouseButton(){if(!this.e.which)return this.e.button;switch(this.e.which){case 0:return 1;case 1:return 4;case 2:return 2;default:return 0}}getMouseWheelDelta(){let e=0;return this.e.detail?e=-this.e.detail/3:this.e.wheelDelta&&(e=this.e.wheelDelta/120),e}stop(){this.bCanceled=!0,this.e.returnValue=!1,this.e.cancelBubble=!0,this.e.canceled=!0,this.e.preventDefault&&this.e.preventDefault(),this.e.stopPropagation&&this.e.stopPropagation()}stopPropagation(){this.e.stopPropagation?this.e.stopPropagation():void 0!==this.e.cancelBubble&&(this.e.cancelBubble=!0)}matchKey(e){if(e){if(!(e instanceof Array))return e.iKeyCode===this.getKeyCode()&&!!e.bCtrl===this.getCtrlKey()&&!!e.bShift===this.getShiftKey()&&!!e.bAlt===this.getAltKey();for(let t=0;t<e.length;t++)if(e[t].iKeyCode===this.getKeyCode()&&!!e[t].bCtrl===this.getCtrlKey()&&!!e[t].bShift===this.getShiftKey()&&!!e[t].bAlt===this.getAltKey())return!0}return!1}}};i.addDomListener("unload",window,i.clearDomHandlers,window),i.JSHandler=class{constructor(e){this.sServerName=e||null,this.aListeners=[],this.aRemoveListeners=[],this.bFiring=!1}addListener(e,t){this.on(e,t)}on(e,t){if("function"!=typeof e)throw new df.Error(5131,"Listener must be a function",t||null,[this.sEvent]);this.aListeners.push({fListener:e,oEnvironment:t})}off(e,t){for(let i=0;i<this.aListeners.length;i++)this.aListeners[i].fListener===e&&this.aListeners[i].oEnvironment===t&&(this.bFiring?this.aRemoveListeners.push(this.aListeners[i]):this.aListeners.splice(i,1))}removeListener(e,t){this.off(e,t)}fire(e,t){if(this.aListeners.length>0){const s=t instanceof i.JSEvent?t:new i.JSEvent(e,t);this.bFiring=!0;for(let t=0;t<this.aListeners.length&&!s.bCanceled;t++)if("function"==typeof this.aListeners[t].fListener)try{!1===this.aListeners[t].fListener.call(void 0!==this.aListeners[t].oEnvironment?this.aListeners[t].oEnvironment:this.eElement,s)&&s.stop()}catch(t){df.handleError(t,e)}for(this.bFiring=!1;this.aRemoveListeners.length>0;){const e=this.aRemoveListeners.pop();this.off(e.fListener,e.oEnvironment)}return!s.bCanceled}return!0}},i.JSEvent=class{constructor(e,t){if(this.oSource=e,this.bCanceled=!1,"object"==typeof t)for(const e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}getTarget(){return this.oSource}stop(){this.bCanceled=!0}},i.allKeys=Object.keys(i.keys).reduce((function(e,t){return e.concat(i.keys[t])}),[]);const s={cFocusSelector:"a, button, textarea, input, iframe, select, *[tabindex]",piDomCounter:0,on(e,t,s,o){let n;t instanceof Array||t instanceof NodeList?t.forEach((function(t){this.on(e,t,s,o)}),this):(n=e instanceof Array?e:e.split(" "),n.forEach((function(e){i.addDomListener(e,t,s,o)})))},off(e,t,s,o){let n;t instanceof Array?t.forEach((function(t){this.off(t,e,s,o)}),this):(n=e instanceof Array?e:e.split(" "),n.forEach((function(e){i.removeDomListener(e,t,s,o)})))},clear(e,t){e instanceof Array?e.forEach((function(e){this.clear(e,t)}),this):i.clearDomListeners(e,t)},genDomId(){return"_df_"+this.piDomCounter++},addClass(e,t){let i,s=!1;if(e)if(e.className){const o=(t||"").split(/\s+/);i=" "+e.className+" ";for(let e=0;e<o.length;e++)i.indexOf(" "+o[e]+" ")<0&&(i+=" "+o[e],s=!0);s&&(e.className=i.trim())}else e.className=t},removeClass(e,t){let i,s=!1;if(e&&e.className){t=" "+t+" ";const o=e.className.split(/\s+/);i="";for(let e=0;e<o.length;e++)t.indexOf(" "+o[e]+" ")<0&&(i+=" "+o[e],s=!0);s&&(e.className=i.trim())}},toggleClass(e,t,i){i?this.addClass(e,t):this.removeClass(e,t)},createCSSElem(e){const t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,t},isBefore(e,t){if(t.parentNode===e.parentNode)for(let i=e.previousSibling;i;i=i.previousSibling)if(i===t)return!0;return!1},setText(e,t){" "===t?e.innerHTML="&nbsp;":(t=t.toString().replace(/\\n\\r/gi,"\n"),"innerText"in e?e.innerText=t:e.textContent=t)},getText:e=>void 0!==e.innerText?e.innerText:e.textContent,getOuterHTML(e){if(e.outerHTML)return e.outerHTML;if(e.parentNode){const t=e.parentNode,i=document.createElement(t.tagName);i.appendChild(e);const s=i.innerHTML;return t.appendChild(e),s}return null},deepClone(e){let t;const i=e.cloneNode(!0);return t=function(e,i){var s;for("SELECT"!==e.tagName&&"TEXTAREA"!==e.tagName||(e.value=i.value),s=0;s<e.childNodes.length;s++)3!==e.childNodes[s].nodeType&&8!==e.childNodes[s].nodeType&&t(e.childNodes[s],i.childNodes[s])},t(i,e),i},swapNodes(e,t){e&&t&&(void 0!==e.replaceNode?e.replaceNode(t):e.parentNode.replaceChild(t,e))},insertAfter(e,t){null!==t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},isParent(e,t){return null!==e&&(e===t||void 0!==e.parentNode&&this.isParent(e.parentNode,t))},searchParent(e,t){return t=t.toUpperCase(),e.tagName===t?e:void 0!==e.parentNode&&e!==document?this.searchParent(e.parentNode,t):null},focus(e,t){try{e.focus(),t&&e.select&&e.select(),"function"==typeof e.setActive&&e.setActive()}catch(e){}},getCaretPosition(e){return this.getSelection(e).start},getSelectionLength(e){return this.getSelection(e).length},getSelection(e){let t=0,i=0;if("selectionStart"in e&&/text|password|search|tel|url/.test(e.type))t=e.selectionStart,i=e.selectionEnd;else if(document.selection)try{const s=document.selection.createRange();if(s&&s.parentElement()===e){const o=e.value.length,n=e.value.replace(/\r\n/g,"\n"),r=e.createTextRange();r.moveToBookmark(s.getBookmark());const a=e.createTextRange();a.collapse(!1),r.compareEndPoints("StartToEnd",a)>-1?t=i=o:(t=-r.moveStart("character",-o),t+=n.slice(0,t).split("\n").length-1,r.compareEndPoints("EndToEnd",a)>-1?i=o:(i=-r.moveEnd("character",-o),i+=n.slice(0,i).split("\n").length-1))}}catch(e){}return{start:t,end:i,length:i-t}},setCaretPosition(e,t){try{if(document.selection){e.focus();const i=document.selection.createRange();i.moveStart("character",-e.value.length),i.moveEnd("character",-e.value.length),i.moveStart("character",t),i.select()}else(/text|password|search|tel|url/.test(e.type)&&e.selectionStart||0===e.selectionStart)&&(e.selectionStart=t,e.selectionEnd=t,e.focus())}catch(e){}},getFirstFocusChild(e){const t=this.query(e,this.cFocusSelector,!0);for(let e=0;e<t.length;e++)if(t[e].tabIndex>=0&&"hidden"!==t[e].type)return t[e];return null},visit(e,t,i){if(e.childNodes)for(let s=0;s<e.childNodes.length;s++)if(3!==e.childNodes[s].nodeType&&8!==e.childNodes[s].nodeType&&!1===t.call(i||this,e.childNodes[s]))return!1;return!0},disableTextSelection(e){e.unselectable="on",e.style.MozUserSelect="none",e.style.webkitUserSelect="none"},enableTextSelection(e){e.unselectable="off",e.style.MozUserSelect="text",e.style.webkitUserSelect="text"},ready(e,t){function i(){e.call(t),window.addEventListener?window.removeEventListener("load",i,!1):window.detachEvent("onload",i)}"complete"===document.readyState?i():window.addEventListener?window.addEventListener("load",i,!1):window.attachEvent("onload",i)},create(e){const t=document.createElement("div");return t.innerHTML=Array.isArray(e)?e.join(""):e,t.firstChild},query(e,t,i){if(!i&&e.querySelector)return e.querySelector(t);if(e.querySelectorAll){const s=e.querySelectorAll(t);return i?s:s.length>0?s[0]:null}throw new df.Error(999,"This browser doesn't support querySelectorAll")},translateY(e,i,s){const o=t.getTransformProp();return o?(e.style[o]="translateY("+i+"px)",!0):!!s&&(e.style.top=i+"px",!0)},translateX(e,i,s){const o=t.getTransformProp();return o?(e.style[o]=null!==i?"translateX("+i+"px)":"",!0):!!s&&(e.style.left=null!==i?i+"px":"",!0)},transition(e,t,i,s){this.on("transitionend",e,(function t(o){this.off("transitionend",e,t,this),e.style.transition="",i&&i.call(s||this)}),this),e.style.transition=t},encodeHtml:e=>(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"),encodeAttr:e=>(e||"").replace(/\"/g,"&quot;"),windowWidth:()=>Math.max(document.body&&Math.max(document.body.scrollWidth,document.body.offsetWidth)||0,document.documentElement&&Math.max(document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)||0),windowHeight:()=>Math.max(document.body&&Math.max(document.body.scrollHeight,document.body.offsetHeight)||0,document.documentElement&&Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)||0),animFrame(e,t){window.requestAnimationFrame?window.requestAnimationFrame((function(){e.call(t||this)})):setTimeout((function(){e.call(t||this)}),40)},offsetHeight:e=>e?.getBoundingClientRect().height||0,clientHeight(e){return this.offsetHeight(e)-((e?.offsetHeight||0)-(e?.clientHeight||0))},offsetWidth:e=>e?.getBoundingClientRect().width||0,clientWidth(e){return this.offsetWidth(e)-((e?.offsetWidth||0)-(e?.clientWidth||0))},setTabIndex(e,t){e.hasAttribute("data-dfOrigTabIndex")&&parseInt(e.getAttribute("data-dfTabIndexCount"),10)>0?e.setAttribute("data-dfOrigTabIndex",t):e.tabIndex=t}};s.ready(t.initCSS,window);const o={json:{parse(e){if("object"==typeof JSON&&"function"==typeof JSON.parse)return JSON.parse(e);throw new SyntaxError("This browser does not support JSON")},stringify(e){if("object"==typeof JSON&&"function"==typeof JSON.stringify)return JSON.stringify(e,(function(e,t){return"string"==typeof e&&"__"===e.substr(0,2)?void 0:t}));throw new SyntaxError("This browser does not support JSON")}},vt:{generateDeserializer(e){var t=[],i=0,s=[];function o(e,n){return"number"==typeof n?function(e,t){switch(t){case df.tBool:return"df.toBool("+e+".v)";case df.tInt:return"df.toInt("+e+".v)";case df.tNumber:return"df.toNumber("+e+".v)";case df.tDate:return"df.toDate("+e+".v)";default:return e+".v"}}(e,n):n instanceof Array?function(e,s){var n=i++,r=[];return r.push("function p",n,"(tVT){","var a = [], i; ","for(i = 0; i < tVT.c.length; i++){"),r.push("a.push(",o("tVT.c[i]",s[0]),");"),r.push("}","return a;","}"),t.push(r.join("")),"p"+n+"("+e+")"}(e,n):function(e,n){var r,a,l=0,h=[];if((a=s.indexOf(n))<0){for(r in a=i++,s[a]=n,h.push("function p",a,"(tVT){","return {"),n)n.hasOwnProperty(r)&&(l>0&&h.push(","),h.push(r,":",o("tVT.c["+l+"]",n[r])),l++);h.push("};","}"),t.push(h.join(""))}return"p"+a+"("+e+")"}(e,n)}return t.push("try{","return ",o("tVT",e),";","}catch(oErr){",'throw new df.Error(999, "Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);',"}"),new Function("tVT",t.join(""))},generateSerializer(e){var t=[],i=0;function s(e,o){return"number"==typeof o?function(e,t){switch(t){case df.tBool:return"{ v : df.fromBool("+e+"), c : [] }";case df.tDate:return"{ v : df.fromDate("+e+"), c : [] }";default:return"{ v : "+e+".toString(), c : [] }"}}(e,o):o instanceof Array?function(e,o){var n=i++,r=[];return r.push("function p",n,"(aArray){",'var tVT = { v : "", c : [] }, i;',"for(i = 0; i < aArray.length; i++){"),r.push("tVT.c.push(",s("aArray[i]",o[0]),");"),r.push("}","return tVT;","}"),t.push(r.join("")),"p"+n+"("+e+")"}(e,o):function(e,o){var n,r=0,a=i++,l=[];for(n in l.push("function p",a,"(oObj){","return {",'v : "",',"c : ["),o)o.hasOwnProperty(n)&&(r>0&&l.push(","),l.push(s('oObj["'+n+'"]',o[n])),r++);return l.push("]","};","}"),t.push(l.join("")),"p"+a+"("+e+")"}(e,o)}return t.push("try{","return ",s("tStruct",e),";","}catch(oErr){",'throw new df.Error(999, "Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);',"}"),new Function("tStruct",t.join(""))},deserialize(e,t){function i(e,t){return"number"==typeof t?function(e,t){switch(t){case df.tBool:return df.toBool(e.v);case df.tInt:return df.toInt(e.v);case df.tNumber:return df.toNumber(e.v);case df.tDate:return df.toDate(e.v);default:return e.v}}(e,t):t instanceof Array?function(e,t){var s,o=[];for(s=0;s<e.c.length;s++)o.push(i(e.c[s],t[0]));return o}(e,t):function(e,t){var s,o=0,n={};for(s in t)t.hasOwnProperty(s)&&(n[s]=i(e.c[o],t[s]),o++);return n}(e,t)}try{return i(e,t)}catch(e){throw new df.Error(999,"Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[e.message])}},serialize(e){function t(e){return"boolean"==typeof e?{v:df.fromBool(e),c:[]}:e instanceof Date?{v:df.fromDate(e),c:[]}:{v:e.toString(),c:[]}}function i(e){return"object"==typeof e?e instanceof Array?function(e){var t,s={v:"",c:[]};for(t=0;t<e.length;t++)s.c.push(i(e[t]));return s}(e):e instanceof Date?t(e):function(e){var t,s={v:"",c:[]};for(t in e)e.hasOwnProperty(t)&&s.c.push(i(e[t]));return s}(e):t(e)}try{return i(e)}catch(e){throw new df.Error(999,"Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[e.message])}}},gui:t,dev:e,isSafari:e.isSafari,isChrome:e.isChrome,isOpera:e.isOpera,isMoz:e.isMoz,isIE:e.isIE,isEdge:e.isEdge,isWebkit:e.isWebkit,isMobile:e.isMobile,isIOS:e.isIOS,iVersion:e.iVersion,ref:{getType(e){let t=typeof e;return"object"===t&&(t=null==e?"null":e.constructor===Array?"array":e.constructor===Date?"date":this.getConstructorName(e)),t},getConstructorName(e){let t=this.getMethodName(e.constructor);return""===t&&(t="object"),t},getMethodName(e){try{const t=e.toString();return t.substring(t.indexOf("function")+8,t.indexOf("(")).replace(/ /g,"")}catch(e){return""}},getGlobalObj:()=>window,getNestedProp(e){let t;const i=e.split(".");t=this.getGlobalObj();for(let e=0;e<i.length;e++){if("object"!=typeof t||null===t)return null;t=t[i[e]]}return t},setNestedProp(e,t){let i;const s=e.split(".");i=this.getGlobalObj();for(let e=0;e<s.length-1;e++){if("object"!=typeof i||null===i)return!1;i=i[s[e]]}return i[s[s.length-1]]=t,!0}},math:{padZero(e,t){let i=e.toString();for(;i.length<t;)i="0"+i;return i},isNumeric:e=>!isNaN(parseFloat(e))&&isFinite(e)},data:{stringToNum:(e,t,i)=>e&&parseFloat(e.replace(i||"","").replace(t,".")),numToString(e,t,i){let s,o;return o=(e=e||0).toString().replace(".",t),i>0&&(s=o.split(t),s.length<2&&(s[1]=""),s[1]=(s[1]+"0000000000000000000").substr(0,i),o=s[0]+t+s[1]),o},applyDateMask(e,t,i,s){let n=!1;return t.replace(/(m{1,4}|d{1,4}|yyyy|yy|\/|hh|ss|fff|f|\:)/gi,(function(t,r){switch(t.toLowerCase()){case"m":return n=!0,e.getMonth()+1;case"mm":return n?(n=!1,o.math.padZero(e.getMinutes(),2)):(n=!0,o.math.padZero(e.getMonth()+1,2));case"mmm":return n=!0,o.string.copyCase(df.lang.monthsShort[e.getMonth()],t);case"mmmm":return n=!0,o.string.copyCase(df.lang.monthsLong[e.getMonth()],t);case"d":return n=!1,e.getDate();case"dd":return n=!1,o.math.padZero(e.getDate(),2);case"ddd":return n=!1,o.string.copyCase(df.lang.daysShort[e.getDay()],t);case"dddd":return n=!1,o.string.copyCase(df.lang.daysLong[e.getDay()],t);case"yy":return n=!1,o.math.padZero(e.getFullYear()%100,2);case"yyyy":return n=!1,o.math.padZero(e.getFullYear(),4);case"/":return n=!1,i;case"hh":return n=!0,o.math.padZero(e.getHours(),2);case"ss":return n=!0,o.math.padZero(e.getSeconds(),2);case"f":return n=!0,e.getMilliseconds();case"fff":return n=!0,o.math.padZero(e.getMilliseconds(),3);case":":return n=!0,s||":"}return t}))},applyNumMask(e,t,i,s,o){let n,r,a,l,h,d,p,u,c,g,_=[],m=null,b=0,C=0,f=!1,w=!0;if("Z"===(t=t.replace(/&curren;/g,o)).charAt(0)){if(0===e)return"";t=t.substr(1)}for(n=t.split(";"),n=(t=e<0?n.length>1?n[1]:"-"+n[0]:n[0]).split("."),c=n[0],n.length>1&&(m=n[1]),l=0;l<t.length;l++)switch(t.charAt(l)){case"\\":l++;break;case"#":case"0":w?b>=0&&b++:C>=0&&C++;break;case"*":w?b=-1:C=-1;break;case",":f=!0;break;case".":w=!1}for(C>=0&&(e=e.toFixed(C)),g=0===e?"":String(e),n=g.split("."),p=n[0],u=n.length>1?n[1]:"","-"===p.charAt(0)&&(p=p.substr(1)),l=c.length-1,h=p.length-1,d=0;l>=0;){if(r=c.charAt(l),a=l>0&&"\\"===c.charAt(l-1),a||"#"!==r&&"*"!==r&&"0"!==r)(","!==r&&"\\"!==r||a)&&_.unshift(r);else for(;(h>=0||"0"===r)&&(d>=3&&(d=0,f&&_.unshift(s)),_.unshift(h>=0?p.charAt(h):"0"),h--,d++,"#"!==r&&"0"!==r););l--}if(null!==m){let e=[];for(h=0,l=0;l<m.length;l++)if(r=m.charAt(l),a=l>0&&"\\"===c.charAt(l-1),a||"#"!==r&&"*"!==r&&"0"!==r)("\\"!==r||a)&&e.push(r);else for(;(h<u.length||"0"===r)&&(e.push(h>=0?u.charAt(h):"0"),h++,"#"!==r&&"0"!==r););e.length&&_.push(i,e.join(""))}return _.join("")},applyWinMask(e,t){var i,s=0,o=0;const n=[];if(""===e)return"";if(""===t)return e;for(;s<t.length;){const r=t.charAt(s);if("\\"===r&&t.length>s+1)n.push(t.charAt(s+1));else if("#"===r||"@"===r||"!"===r||"*"===r){for(i=!1;o<e.length&&!i;)this.acceptWinMaskChar(e.charAt(o),r)&&(n.push(e.charAt(o)),i=!0),o++;if(!i)break}else n.push(r);s++}return n.join("")},acceptWinMaskChar:(e,t)=>"#"===t&&e.match(/[0-9]/)||"@"===t&&e.match(/[a-zA-Z]/)||"!"===t&&e.match(/[^a-zA-Z0-9]/)||"*"===t,stringToDate(e,t){let i,s=!1,o=0,n=0,r=0,a=0,l=0,h=0,d=0;const p=new Date;if(""===e.trim())return null;const u=e.split(/[^0-9]+/gi),c=t.split(/[^mdyhmsf]+/gi);for(let e=0;e<u.length;e++){const t=u[e];switch(c[e]){case"d":case"dd":o=parseInt(t,10),s=!1;break;case"m":n=parseInt(t,10),s=!0;break;case"mm":s?h=parseInt(t,10):n=parseInt(t,10);break;case"yy":case"yyyy":r=parseInt(t,10),2===t.length?r=r>50?r+1900:r+2e3:0===t.length&&(r=p.getFullYear()),s=!1;break;case"hh":a=parseInt(t,10),s=!0;break;case"ss":l=parseInt(t,10),s=!0;break;case"f":case"fff":d=parseInt(t,10)}}for(r=r?r>0?r<9999?r:9999:0:p.getFullYear(),n=n?n>0?n<=12?n-1:11:0:p.getMonth(),o=o?o>0?o<=32?o:31:1:p.getDate(),a=a>0?a<=23?a:24===a?0:23:0,h=h>0?h<60?h:59:0,l=l>0?l<60?l:59:0,d=d>0?d<999?d:999:0,i=new Date(r,n,o,a,h,l,d);i.getMonth()!==n;)o--,i=new Date(r,n,o,a,h,l,d);return i},dateToString(e,t,i){return this.applyDateMask(e,t,i||"/")},dateToWeek(e){const t=new Date(e.getTime());t.setHours(0,0,0,0),t.setDate(t.getDate()+3-(t.getDay()+6)%7);const i=new Date(t.getFullYear(),0,4);return 1+Math.round(((t.getTime()-i.getTime())/864e5-3+(i.getDay()+6)%7)/7)},removeFromArray(e,t){for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)},formatRegExp:/\{\{([0-9a-zA-Z]+)\}\}/gi,format(e,t){const i=t||{};return e.replace(this.formatRegExp,(function(e,t,s,o){return i.hasOwnProperty(t)?i[t]:e}))},markupDataSize(e){let t;return e<1024?e+" B":(t=e/1024,t<2048?Math.round(t)+" kB":(t/=1024,t<2048?t<100?10*Math.round(t)/10+" MB":Math.round(t)+" MB":(t/=1024,t<2048?t<100?10*Math.round(t)/10+" GB":Math.round(t)+" GB":(t/=1024,t<2048?t<100?10*Math.round(t)/10+" TB":Math.round(t)+" TB":(t/=1024,t<100?10*Math.round(t)/10+" PB":Math.round(t)+" PB")))))},escapeRegExp:e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),compareText:(e,t)=>e.localeCompare(t),compareRevText:(e,t)=>-e.localeCompare(t),compareBCD:(e,t)=>parseFloat(e)-parseFloat(t),compareRevBCD:(e,t)=>-(parseFloat(e)-parseFloat(t)),compareDate:(e,t)=>e==t?0:o.data.stringToDate(e,"yyyy/mm/dd","-")<o.data.stringToDate(t,"yyyy/mm/dd","-")?-1:1,compareRevDate:(e,t)=>e==t?0:o.data.stringToDate(e,"yyyy/mm/dd","-")<o.data.stringToDate(t,"yyyy/mm/dd","-")?1:-1,compareDateTime:(e,t)=>e==t?0:o.data.stringToDate(e,"yyyy/mm/ddThh:mm:ss.fff","-")<o.data.stringToDate(t,"yyyy/mm/ddThh:mm:ss.fff","-")?-1:1,compareRevDateTime:(e,t)=>e==t?0:o.data.stringToDate(e,"yyyy/mm/ddThh:mm:ss.fff","-")<o.data.stringToDate(t,"yyyy/mm/ddThh:mm:ss.fff","-")?1:-1,compareTime:(e,t)=>e==t?0:o.data.stringToDate(e,"hh:mm:ss","-")<o.data.stringToDate(t,"hh:mm:ss","-")?-1:1,compareRevTime:(e,t)=>e==t?0:o.data.stringToDate(e,"hh:mm:ss","-")<o.data.stringToDate(t,"hh:mm:ss","-")?1:-1,compareFunction(e,t){switch(e){case df.ciTypeBCD:return t?this.compareRevBCD:this.compareBCD;case df.ciTypeDate:return t?this.compareRevDate:this.compareDate;case df.ciTypeDateTime:return t?this.compareRevDateTime:this.compareDateTime;case df.ciTypeTime:return t?this.compareRevTime:this.compareTime;default:return t?this.compareRevText:this.compareText}},serverToType(e,t){let i=e;return t===df.ciTypeBCD?i=o.data.stringToNum(e,"."):t===df.ciTypeDate?i=o.data.stringToDate(e,"yyyy/mm/dd","-"):t===df.ciTypeDateTime?i=o.data.stringToDate(e,"yyyy/mm/ddThh:mm:ss.fff"):t===df.ciTypeTime&&(i=o.data.stringToDate(e,"hh:mm:ss")),i},typeToDisplay(e,t,i,s,n,r){let a=e;return!s&&n&&t!==df.ciTypeText?t===df.ciTypeDate||t===df.ciTypeDateTime||t===df.ciTypeTime?a=e&&o.data.applyDateMask(e,n,i.psDateSeparator,i.psTimeSeparator)||"":t===df.ciTypeBCD&&(a=null!==e&&o.data.applyNumMask(e||0,n,i.psDecimalSeparator,i.psThousandsSeparator,i.psCurrencySymbol)||""):n&&t===df.ciTypeText?a=o.data.applyWinMask(a,n):""!==e&&(t===df.ciTypeBCD?a=null!==e&&o.data.numToString(e,i.psDecimalSeparator,r):t===df.ciTypeDate?a=e&&o.data.dateToString(e,i.psDateFormat,i.psDateSeparator,i.psTimeSeparator)||"":t===df.ciTypeDateTime?a=e&&o.data.dateToString(e,i.psDateTimeFormat,i.psDateSeparator,i.psTimeSeparator)||"":t===df.ciTypeTime&&(a=e&&o.data.dateToString(e,i.psTimeFormat,i.psDateSeparator,i.psTimeSeparator)||"")),a}},cookie:{set(e,t,i,s){const o=new Date;let n="";i&&(o.setHours(o.getHours()+i),n+="; expires="+o.toGMTString()),s&&(n+="; path="+s),document.cookie=e+"="+t+n},del(e){const t=new Date;t.setTime(t.getTime()-1),document.cookie=e+"=; expires="+t.toGMTString()},get(e,t){let i=null;if(document.cookie){const t=document.cookie.split(";");for(let s=0;s<t.length&&null===i;s++){const o=t[s].split("=");o.length>1&&o[0].trim()===e.trim()&&(i=o[1])}}return null!==i?i:t}},string:{trim:e=>e.trim(),ltrim:e=>e.replace(/^\s+/,""),rtrim:e=>e.replace(/\s+$/,""),copyCase(e,t){let i="";for(let s=0;s<e.length;s++){const o=s<t.length?t.charAt(s)===t.charAt(s).toUpperCase():o;i+=o?e.charAt(s).toUpperCase():e.charAt(s).toLowerCase()}return i}},supportHtml5Input:function(){const e={};return function(t){let i;return"boolean"==typeof e[t]||(i=document.createElement("input"),i.setAttribute("type",t),e[t]=i.type===t),e[t]}}()};Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("callback must be a function");const t=Object(this),i=t.length>>>0,s=arguments[1];for(let o=0;o<i;o++){const i=t[o];if(e.call(s,i,o,t))return i}}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(let i=0;i<this.length;i++)e.call(t,this[i],i,this)}),Object.values||(Object.values=function(e){const t=[];for(var i in e)e.hasOwnProperty(i)&&e.propertyIsEnumerable(i)&&t.push(e[i]);return t}),String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.split(e).join(t)}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){let t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});const n="25.0.11.22",r={dom:s,sys:o,events:i,settings:{formKeys:{findGT:{iKeyCode:119,bCtrl:!1,bShift:!1,bAlt:!1},findLT:{iKeyCode:118,bCtrl:!1,bShift:!1,bAlt:!1},findGE:{iKeyCode:120,bCtrl:!1,bShift:!1,bAlt:!1},findFirst:{iKeyCode:36,bCtrl:!0,bShift:!1,bAlt:!1},findLast:{iKeyCode:35,bCtrl:!0,bShift:!1,bAlt:!1},save:{iKeyCode:113,bCtrl:!1,bShift:!1,bAlt:!1},clear:{iKeyCode:116,bCtrl:!1,bShift:!1,bAlt:!1},clearAll:{iKeyCode:116,bCtrl:!0,bShift:!1,bAlt:!1},remove:{iKeyCode:113,bCtrl:!1,bShift:!0,bAlt:!1},prompt:{iKeyCode:115,bCtrl:!1,bShift:!1,bAlt:!1},tabOut:{iKeyCode:9,bCtrl:!1,bShift:!1,bAlt:!1},submit:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1},escape:{iKeyCode:27,bCtrl:!1,bShift:!1,bAlt:!1}},listKeys:{scrollUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},scrollDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},scrollRangeUp:{iKeyCode:38,bCtrl:!1,bShift:!0,bAlt:!1},scrollRangeDown:{iKeyCode:40,bCtrl:!1,bShift:!0,bAlt:!1},scrollPageUp:{iKeyCode:33,bCtrl:!1,bShift:!1,bAlt:!1},scrollPageDown:{iKeyCode:34,bCtrl:!1,bShift:!1,bAlt:!1},scrollTop:[{iKeyCode:36,bCtrl:!0,bShift:!1,bAlt:!1},{iKeyCode:38,bCtrl:!0,bShift:!1,bAlt:!1}],scrollBottom:[{iKeyCode:35,bCtrl:!0,bShift:!1,bAlt:!1},{iKeyCode:40,bCtrl:!0,bShift:!1,bAlt:!1}],search:{iKeyCode:70,bCtrl:!0,bShift:!1,bAlt:!1},leftSwipeBtns:{iKeyCode:39},rightSwipeBtns:{iKeyCode:37},select:{iKeyCode:32},selectAll:{iKeyCode:65,bCtrl:!0},deSelectAll:{iKeyCode:27,bCtrl:!1,bShift:!1,bAlt:!1},collapseAllGrp:{iKeyCode:109,bCtrl:!0},expandAllGrp:{iKeyCode:107,bCtrl:!0},collapseGrp:{iKeyCode:109,bShift:!0},expandGrp:{iKeyCode:107,bShift:!0}},gridKeys:{nextCol:{iKeyCode:9,bCtrl:!1,bShift:!1,bAlt:!1},prevCol:{iKeyCode:9,bCtrl:!1,bShift:!0,bAlt:!1},newRow:{iKeyCode:121,bCtrl:!1,bShift:!0,bAlt:!1}},tabKeys:{enter:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1}},calendarKeys:{dayUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},dayDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},dayLeft:{iKeyCode:37,bCtrl:!1,bShift:!1,bAlt:!1},dayRight:{iKeyCode:39,bCtrl:!1,bShift:!1,bAlt:!1},monthUp:{iKeyCode:33,bCtrl:!1,bShift:!1,bAlt:!1},monthDown:{iKeyCode:34,bCtrl:!1,bShift:!1,bAlt:!1},yearUp:{iKeyCode:33,bCtrl:!0,bShift:!1,bAlt:!1},yearDown:{iKeyCode:34,bCtrl:!0,bShift:!1,bAlt:!1},enter:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1},close:{iKeyCode:27,bCtrl:!1,bShift:!1,bAlt:!1}},treeKeys:{moveUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},moveDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},collapse:{iKeyCode:37,bCtrl:!1,bShift:!1,bAlt:!1},extend:{iKeyCode:39,bCtrl:!1,bShift:!1,bAlt:!1},moveFirst:{iKeyCode:36,bCtrl:!1,bShift:!1,bAlt:!1},moveLast:{iKeyCode:35,bCtrl:!1,bShift:!1,bAlt:!1},enter:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1}},sliderKeys:{sliderUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},sliderDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},sliderLeft:{iKeyCode:37,bCtrl:!1,bShift:!1,bAlt:!1},sliderRight:{iKeyCode:39,bCtrl:!1,bShift:!1,bAlt:!1}},menuKeys:{moveUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},moveDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},moveLeft:{iKeyCode:37,bCtrl:!1,bShift:!1,bAlt:!1},moveRight:{iKeyCode:39,bCtrl:!1,bShift:!1,bAlt:!1}},spinKeys:{moveUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},moveDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1}},suggestionKeys:{backSpace:{iKeyCode:8,bCtrl:!1,bShift:!1,bAlt:!1},delete:{iKeyCode:46,bCtrl:!1,bShift:!1,bAlt:!1},moveUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},moveDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},select:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1},escape:[{iKeyCode:27,bCtrl:!1,bShift:!1,bAlt:!1},{iKeyCode:9,bCtrl:!1,bShift:!1,bAlt:!1}],forceDisplay:{iKeyCode:32,bCtrl:!0,bShift:!1,bAlt:!1}}},psVersionId:n,pnDataFlexVersion:(h=n.split(".")).length>1?parseFloat(h[0]+"."+h[1]):0,ciTypeText:0,ciTypeBCD:1,ciTypeDate:2,ciTypeDateTime:3,ciTypeTime:4,ciRegionCenter:0,ciRegionLeft:1,ciRegionRight:2,ciRegionTop:3,ciRegionBottom:4,ciLabelLeft:0,ciLabelTop:1,ciLabelRight:2,ciLabelFloat:3,ciAlignLeft:0,ciAlignCenter:1,ciAlignRight:2,ciDirGT:0,ciDirLT:1,ciOpenSameWindow:0,ciOpenNewTab:1,ciOpenNewWindow:2,cwiActual:0,cwiStretch:1,cwiStretchHoriz:2,cwiCenter:3,cwiFit:4,cwiCover:5,csUnsorted:0,csDescription:1,csValue:2,cCrumbHorizontal:0,cCrumbDropDown:1,cCrumbCaption:2,tUnknown:0,tString:1,tInt:2,tNumber:3,tDate:4,tBool:5,tAdv:6,gtAutomatic:0,gtAllData:1,gtManual:2,grpDisabled:0,grpCustom:1,grpAutomatic:2,cCallModeDefault:1,cCallModeWait:2,cCallModeProgress:3,smFind:0,smValidationTable:1,smCustom:2,ctExecDefault:0,ctExecEarly:1,ctExecViewLoad:2,modeDesktop:10,modeTablet:20,modeTabletLandscape:21,modeTabletPortrait:22,modeMobile:30,modeMobileLandscape:31,modeMobilePortrait:32,adActionBar:1,adMenu:2,adBoth:3,wbNone:0,wbWrap:1,wbPre:2,wbPreWrap:3,wbEllipsis:4,dropPositions:{ciDropUnknown:0,ciDropOn:1,ciDropBefore:2,ciDropAfter:3,ciDropOnEmpty:4},dragActions:{WebList:{ciDragRow:111},WebMultiSelectList:{ciDragRowSelection:141},WebTreeView:{ciDragFolder:121,ciDragItem:122},WebTagsForm:{ciDragTag:131},WebWidgetContainer:{ciDragWidget:151}},dropActions:{WebControl:{ciDropOnControl:201},WebList:{ciDropOnRow:211},WebTreeView:{ciDropOnRoot:221,ciDropOnFolder:222,ciDropOnItem:223},WebTagsForm:{ciDropOnInput:231},WebWidgetContainer:{ciDropOnCell:241}},WebUIContext:{WebUIContextCustom:0,WebUIContextListHead:1,WebUIContextListRow:2,WebUIContextListFull:3,WebUIContextListSelection:4,WebUIContextTreeviewFolder:5,WebUIContextTreeviewItem:6,WebUIContextTagsFormTag:7,isChildScopeCompatible:function(e){return e!==r.WebUIContext.WebUIContextListHead}},layoutType:{ciLayoutTypeInherit:0,ciLayoutTypeFlow:1,ciLayoutTypeGrid:2},rowColValType:{ciTypeDefault:0,ciTypeFixed:1,ciTypeFraction:2,ciTypeOther:3},CssEnabled:"Web_Enabled",CssDisabled:"Web_Disabled",CssHit:"Web_Hit",hitTimeout:1e3,psIncludeLocation:(l=document.getElementsByTagName("script"))[l.length-1].src,psRootPath:(a=Array.from(document.getElementsByTagName("script")).findLast((e=>e.src.indexOf("DfEngine")>0))?.src,a?a.substr(0,a.indexOf("DfEngine")):null),ajax:{},lang:{monthsLong:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysLong:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},gui:{aZReservations:[!0],reserveZIndex:function(){return this.aZReservations.push(!0)-1},freeZIndex:function(e){var t;for(this.aZReservations[e]=!1,t=this.aZReservations.length-1;t>=0&&!this.aZReservations[t];t--)this.aZReservations.pop()},dragMask:function(e){var t;return t=r.dom.create('<div class="WebApp_DragMask"></div>'),(e||document.body).appendChild(t),t}},defineClass:function(e,t,i){var s,n,r;if(console.warn(`df.defineClass is deprecated, use ES6 classes instead (${e})`),"string"==typeof e)if("function"==typeof(s=o.ref.getNestedProp(e))){if(arguments.length>2){if(r=arguments[arguments.length-1],"function"!=typeof(n="string"==typeof arguments[1]?o.ref.getNestedProp(arguments[1]):arguments[1]))return void alert("Super class for '"+e+"' must be defined first ('"+arguments[1]+"')");if(!(r=arguments[2]))return void alert("Prototype for new class must be specified!");const t=class extends n{constructor(){super(...arguments),s.apply(this,arguments)}};return Object.assign(t.prototype,r),t.base=n.prototype,t.base.constructor=function(){},void o.ref.setNestedProp(e,t)}2===arguments.length&&(r=arguments[1],s.prototype=r),s.prototype.constructor=s}else alert("Constructor for the new class must be a function!");else alert("Constructor for new class must be specified as string!")},mixin:function(e,t){console.error(`df.mixin is deprecated, use ES6 classes instead (${e})`)},toBool:function(e){return"0"!==e&&"-1"!==e&&"false"!==e&&!!e},fromBool:function(e){return e?"1":"0"},fromDate:function(e){return o.data.dateToString(e,"yyyy/mm/dd","-")},fromNumber:function(e){return e.toString()},toInt:function(e){return parseInt(e,10)},toNumber:function(e){return parseFloat(e)},toDate:function(e){return o.data.stringToDate(e,"yyyy/mm/dd","-")},toDateTime:function(e){return o.data.stringToDate(e,"yyyy/mm/ddThh:mm:ss.fff")},fromDateTime:function(e){return o.data.dateToString(this._tValue,"yyyy/mm/ddThh:mm:ss.fff","-",":")},timeValues:{},timeStart:function(e,t){t=e+":: Timing Start * "+t,r.log(t),this.timeValues[e]=(new Date).getTime()},timeStop:function(e,t){var i=(new Date).getTime();t=this.timeValues[e]?e+":: "+(i=(i-this.timeValues[e])/1e3)+" * Timing Stop * "+t:e+":: <NAV> * Timing Stop * "+t,r.log(t)},log:function(e){"object"==typeof console&&console.log&&console.log(e)},pbDebugging:"boolean"==typeof bDfDebug&&bDfDebug||document.location.href.toLowerCase().indexOf("dfdebug=true")>0,debug:function(e){this.pbDebugging&&r.log(e)},handleError:function(e,t){var i,s=null;if(!(e instanceof r.Error))throw e;(i=t||e.oSource||null)&&i.getWebApp?i=i.getWebApp():e.oSource&&e.oSource.getWebApp&&(i=e.oSource.getWebApp()),i&&i instanceof r.WebApp?s=i:e.oSource&&e.oSource instanceof r.WebApp&&(s=e.oSource),s?s.handleError(e):alert(e.iNumber+": "+e.sText+"\n\r Line: "+e.iLine+"\n\r Target: "+e.sTarget+"\n\r User error: "+e.bUserError)},classWordBreak:function(e){switch(e){case r.wbWrap:return"WebWrp_Wrap";case r.wbPre:return"WebWrp_Pre";case r.wbPreWrap:return"WebWrp_PreWrap";case r.wbEllipsis:return"WebWrp_Ellipsis"}return"WebWrp_None"}};var a,l,h;r.Error=function(e,t,i,s,n,r,a,l,h,d){this.iNumber=e,this.sText=t,this.bUserError=!!a,this.sCaption=l||null,this.oSource=i||null,this.oTarget=h||null,this.bServer=!!r,this.iLine=d,this.sDetailHtml=n||null,s&&(this.sText=o.data.format(this.sText,s))};class d{static states={REQUEST_STATE_UNITIALIZED:0,REQUEST_STATE_LOADING:1,REQUEST_STATE_LOADED:2,REQUEST_STATE_INTERACTIVE:3,REQUEST_STATE_COMPLETE:4};constructor(e,t,s){void 0===t&&(t=null),this.sUrl=e,this.pbWithCredentials=!1,this.sData=t,this.bAsynchronous=!0,this.sExpectedContentType=null,this.onFinished=new i.JSHandler,this.onError=new i.JSHandler,this.onClose=new i.JSHandler,this.oLoader=null,this.oSource=s||null,this.bSilent=!1}send(e){var t,i=this;"boolean"==typeof e&&(this.bAsynchronous=e),this.oLoader=new XMLHttpRequest,t=this.getData(),this.bAsynchronous&&(this.oLoader.onreadystatechange=function(){i.onReadyStateChange()});try{this.oLoader.open(t?"POST":"GET",this.getRequestUrl(),this.bAsynchronous),this.oLoader.withCredentials=this.pbWithCredentials,this.setHeaders(this.oLoader),this.oLoader.send(t)}catch(e){throw new r.Error(5121,"The application was unable to communicate with the server.",this)}this.bAsynchronous||this.onReadyStateChange()}onReadyStateChange(){try{if(this.oLoader.readyState===d.states.REQUEST_STATE_COMPLETE){if(!(this.oLoader.status>0))throw new r.Error(5121,"The application was unable to communicate with the server.",this);this.onClose.fire(this),this.checkErrors(),this.onFinished.fire(this,this.getFinishedDetails())}}catch(e){this.bSilent||r.handleError(e,this),this.onError.fire(this,{oError:e})}}getFinishedDetails(){return{oResponseXml:this.getResponseXml(),sResponseText:this.getResponseText()}}checkErrors(e){if(this.oLoader.status>=300&&(!e||500!==this.oLoader.status)){var t=this.oLoader.responseText;throw new r.Error(5120,"Received HTTP error '{{0}} {{1}}' while loading URL '{{2}}'.",this,[this.oLoader.status,this.oLoader.statusText,this.getRequestUrl()],t)}if(200==this.oLoader.status&&this.sExpectedContentType){let e=this.oLoader.getResponseHeader("Content-Type")||"";if(e.indexOf(";")&&(e=e.substring(0,e.indexOf(";"))),e.trim().toLowerCase()!=this.sExpectedContentType.toLowerCase())throw new r.Error(5124,"Invalid response for HTTP request, content-type mismatch.",this,[],`Received content-type header '${e}' while expecting '${this.sExpectedContentType}'.`)}}setHeaders(e){}getRequestUrl(){return this.sUrl}getResponseXml(){return this.oLoader.responseXML}getResponseText(){return this.oLoader.responseText}getData(){return this.sData}cancel(){null!==this.oLoader&&(this.onClose.fire(this),this.oLoader.onreadystatechange=function(){},this.oLoader.abort(),this.oLoader=null),this.onFinished.aListener=[]}destroy(){try{this.bAsynchronous&&this.oLoader&&this.oLoader.onreadystatechange&&(this.oLoader.onreadstatechange=null)}catch(e){}this.oLoader=null}getWebApp(){return this.oSource&&this.oSource.getWebApp?this.oSource.getWebApp():null}}class p extends d{constructor(e,t,i,s){null==i&&(i="WebService.wso"),super(i,null,s),this.sFunction=e,this.oParams=t||{},this.bUsePOST=!0,this.bExtendURL=!0,this.sExpectedContentType="application/json",this._oJSON=null}addParam(e,t){this.oParams[e]=t}setHeaders(e){super.setHeaders(e),this.bUsePOST&&e.setRequestHeader("Content-Type","application/json")}getData(){return this.bUsePOST?r.sys.json.stringify(this.oParams):null}getRequestUrl(){var e,t,i=[];if(e=(e=super.getRequestUrl()).indexOf("/JSON")>=0?e.replace("/JSON","/"+this.sFunction+"/JSON"):e.indexOf("?")>=0?e.replace("?","/"+this.sFunction+"/JSON"):e+("/"!==e.charAt(e.length-1)?"/":"")+this.sFunction+"/JSON",!this.bUsePOST){for(t in this.oParams)this.oParams.hasOwnProperty(t)&&(i.push(i.length<=0&&e.indexOf("?")<0?"?":"&"),i.push(encodeURIComponent(t)),i.push("="),i.push(encodeURIComponent(String(this.oParams[t]))));return e+i.join("")}return e}getResponseXml(){return null}checkErrors(){var e;if(this.oLoader.status>=400&&this.oLoader.status<600){try{e=r.sys.json.parse(this.getResponseText())}catch(e){}if(e&&e.errorCode)throw new r.Error(5122,e.errorDescription,this,[],null,!1,!1,"Server returned HTTP error 500");if(e&&e.error)throw new r.Error(5122,e.error.message,this,[],null,!1,!1,"HTTP Status "+this.oLoader.status+": "+(e.error.reason||this.oLoader.statusText||""))}super.checkErrors()}getResponseValue(){var e=this.getResponseText();try{return r.sys.json.parse(e)}catch(e){throw new r.Error(5123,"Received invalid JSON from the server.",this,[],e.message)}}}class u{constructor(e){this._oWebApp=e,this.peMode=-1,this.pbActive=!0,this._aWOs=[],this._aModes=[{eM:df.modeDesktop,sCSS:"df-ModeDesktop"},{eM:df.modeTablet,sCSS:"df-ModeTablet"},{eM:df.modeTabletLandscape,sCSS:"df-ModeTabletLandscape"},{eM:df.modeTabletPortrait,sCSS:"df-ModeTabletPortrait"},{eM:df.modeMobile,sCSS:"df-ModeMobile"},{eM:df.modeMobileLandscape,sCSS:"df-ModeMobileLandscape "},{eM:df.modeMobilePortrait,sCSS:"df-ModeMobilePortrait"}],this.init()}init(){this.detectMode(),df.dom.ready((function(){df.dom.on("resize",window,this.onWindowResize,this),df.dom.on("orientationchange",document,this.onWindowResize,this),this.detectMode()}),this)}destroy(){df.dom.off("resize",window,this.onWindowResize,this),df.dom.off("orientationchange",document,this.onWindowResize,this)}regWO(e){this._aWOs.push(e)}remWO(e){const t=this._aWOs.indexOf(e);t>=0&&this._aWOs.splice(t,1)}enforceMode(e){const t=this;this.peMode=e,df.dom.ready((function(){const e=t.pbActive?t.peMode:0;for(let i=0;i<t._aModes.length;i++)df.dom.toggleClass(document.body,t._aModes[i].sCSS,t._aModes[i].eM<=e);t._oWebApp.sizeChanged()}),this);for(let e=0;e<this._aWOs.length;e++){const t=this._aWOs[e];for(const e in t._oPropRuleStore)t._oPropRuleStore.hasOwnProperty(e)&&this.enforceRule(t,e)}}enforceRule(e,t){const i=this.pbActive?this.peMode:0;if(i>=0){const s=e._oPropRuleStore[t];if(!e._oSynced[t]){null===s.sDefault&&(s.sDefault=e.get(t));for(let o=0;o<s.aRules.length;o++)if(s.aRules[o].eM<=i)return e._set(t,s.aRules[o].sV,!0,!1),void(s.bActive=!0);s.bActive&&(e.set(t,s.sDefault,!0),s.bActive=!1)}}}detectMode(){let t,i,s,o=df.modeDesktop;e.detectDevice(),e.isMobile?(o=this.detectOrientation(),s=o==df.modeMobileLandscape,t=window.screen.width,i=window.screen.height):(t=df.dom.windowWidth(),i=df.dom.windowHeight(),s=t>i),t<580||s&&i<420?o=s?df.modeMobileLandscape:df.modeMobilePortrait:(t<1100||e.isMobile)&&(o=s?df.modeTabletLandscape:df.modeTabletPortrait),o!==this.peMode&&this.pbActive&&this.enforceMode(o)}detectOrientation(){let e=df.modeMobilePortrait;return window.screen.orientation?window.screen.orientation.type.indexOf("portrait")>=0?e=df.modeMobilePortrait:window.screen.orientation.type.indexOf("landscape")>=0&&(e=df.modeMobileLandscape):window.orientation&&(90!=window.orientation&&-90!=window.orientation||(e=df.modeMobileLandscape)),e}onWindowResize(e){this.detectMode()}activate(){this.pbActive||(this.pbActive=!0,this.enforceMode(this.peMode))}deactivate(){this.pbActive&&(this.pbActive=!1,this.enforceMode(this.peMode))}}class c{constructor(e,t){this._sName=e,this._oParent=t||null,this._oTypes={},this._oSynced={},this._aChildren=[],this._oServerActionModes={},this._oServerWaitMsg={},this._tActionData=null,this._oPropRuleStore=null,this._bStandalone=!e,this._oWebApp=null,this._oView=null,this._bIsWO=!0,this._bIsDynamic=!1}create(e){}destroy(){let e;for(this._oPropRuleStore&&this.getWebApp()._oModeControl.remWO(this);e=this._aChildren.pop();)e.destroy();this._oWebApp=null,this._oView=null,this._oParent&&delete this._oParent[this._sName],this._oParent=null}addChild(e){this._aChildren.push(e)}prop(e,t,i){this[t]=i,this._oTypes[t]=e}toLocalType(e,t){switch(t){case r.tString:return e;case r.tBool:return r.toBool(e);case r.tInt:return r.toInt(e);case r.tNumber:return r.toNumber(e);case r.tAdv:default:return e}}toServerType(e,t){switch(t){case r.tString:return"string"==typeof e?e:e?e.toString():"";case r.tBool:return r.fromBool(e);case r.tNumber:return r.fromNumber(e);case r.tAdv:return e;default:return null!==e?e.toString():e}}get(e){return this["get_"+e]?this["get_"+e]():this[e]}set(e,t,i){let s;this["set_"+e]&&(s=this["set_"+e](t)),void 0!==this[e]&&!1!==s&&(this[e]=t),!0!==i&&this.addSync(e)}_set(e,t,i,s){this._oTypes[e]&&(t=this.toLocalType(t,this._oTypes[e])),i&&this["set_"+e]&&this["set_"+e](t,!0),this[e]=t,s&&this.addSync(e)}addSync(e){this._oSynced.hasOwnProperty(e)||(this._oSynced[e]=!0)}unSync(e){this._oSynced.hasOwnProperty(e)&&delete this._oSynced[e]}getSynced(e,t){let i;const s=[],o=this.getLongName();for(const e in this._oSynced)this._oSynced.hasOwnProperty(e)&&(i=this.get(e),this._oTypes[e]&&(i=this.toServerType(i,this._oTypes[e])),void 0===i&&(i=null),this._oTypes[e]===r.tAdv?t.push({sO:o,sP:e,tV:i}):s.push({sN:e,sV:i}));s.length>0&&e.push({sO:o,aP:s});for(let i=0;i<this._aChildren.length;i++)this._aChildren[i]._bStandalone||this._aChildren[i].getSynced(e,t)}getLongName(){return this._oParent?this._oParent.getLongNamePrnt(this)+this._sName:this._sName}getLongNamePrnt(){return this.getLongName()+"."}getWebApp(){return this._oWebApp||(this._oWebApp=this._oParent&&this._oParent.getWebApp&&this._oParent.getWebApp()||null),this._oWebApp}getView(){return this._oView||(this._oView=this._oParent&&this._oParent.getView&&this._oParent.getView()||null),this._oView}getObjectLevel(){const e=this.getView();let t=0,i=this;for(;i!==e;)i=i._oParent,t++;return t}serverAction(e,t,i,s,o){this.serverActionEx({sMethod:e,aParams:t||[],tData:i||null,fHandler:s,oHandlerEnv:o})}serverActionEx(e){let t;const i=new r.ServerAction;i.oWO=this,i.sAction=t=e.sMethod,i.aParams=e.aParams||[],i.tData=e.tData||null,i.fHandler=e.fHandler||null,i.oHandlerEnv=e.oHandlerEnv||this,i.aViews=e.aViews||[],i.oPlatformSpecific=e.oPlatformSpecific||{};const s=this.getView();s&&i.aViews.push(s),e.eCallMode?i.eCallMode=e.eCallMode:(i.eCallMode=this._oServerActionModes[t.toLowerCase()]||r.cCallModeDefault,i.eCallMode===r.cCallModeProgress&&this._oServerWaitMsg[t.toLowerCase()]&&(i.sProcessMessage=this._oServerWaitMsg[t.toLowerCase()])),this.getWebApp().handleAction(i)}cancelServerAction(e){this.getWebApp().cancelAction(this,e)}hasPendingServerAction(e){return this.getWebApp().hasPendingAction(this,e)}callBack(e){const t=[];for(let e=1;e<arguments.length;e++)t.push(arguments[e]);this.serverAction(e,t,this._tActionData)}setActionMode(e,t,i){if(!t)throw new r.Error(999,"Assertion: Invalid server-action mode '{{0}}' for message '{{1}}'",this,[t,e]);this._oServerActionModes[e.toLowerCase()]=r.toInt(t),i&&(this._oServerWaitMsg[e.toLowerCase()]=i)}getActionMode(e){return this._oServerActionModes[e.toLowerCase()]||r.cCallModeDefault}event(e,t,i){this.setActionMode(e,arguments.length>1?t:r.cCallModeDefault),this[e]=new r.events.JSHandler(i||e),this.prop(r.tBool,"pbServer"+e,!1),this.prop(r.tString,"psClient"+e,"")}fire(e,t,i,s){return this.fireEx({sEvent:e,aParams:t,fHandler:i,oEnv:s})}fireEx(e){let t=!1,i=!1,s=null;const o=e.sEvent;if(!o)throw new r.Error(999,"Event name missing in fireEx.",this);e.aParams&&e.aParams instanceof Array||(e.aParams=[]);const n=new r.events.JSEvent(this,{aParams:e.aParams,oConf:e,bClient:!1,bServer:!1,sReturnVal:null,aViews:e.aView||[]});if(this["psClient"+o]&&!e.bSkipClient){const e=this.findFunc(this["psClient"+o]);if("function"==typeof e.fFunc){n.bClient=t=!0;try{!1===e.fFunc.call(e.oEnv,n)&&n.stop()}catch(e){this.getWebApp().handleError(e)}}else this.getWebApp().handleError(new r.Error(999,"Event handler function '{{0}}' set as 'psClient{{1}}' not found.",this,[this["psClient"+o],o]))}if(n.bCanceled||this[o]instanceof r.events.JSHandler&&(s=this[o],n.bClient=t=t||s.aListeners.length>0,s.fire(this,n)),!n.bCanceled){var a=e.sAltServerName||s&&s.sServerName||o;this["pbServer"+o]&&r.toBool(this["pbServer"+o])&&!e.bSkipServer&&(t=!0,i=!0,this.serverAction(a,e.aParams,e.tActionData||null,(function(t){n.sReturnValue=t.sReturnValue,n.bServer=!0,e.fHandler&&e.fHandler.call(e.oEnv||this,n)}),this))}return i||e.fHandler&&e.fHandler.call(e.oEnv||this,n),t}insertChild(e,t){this._aChildren.splice(t,0,e)}renderChild(e,t){}removeChild(e){const t=this._aChildren.indexOf(e);-1!==t&&this._aChildren.splice(t,1)}unrenderChild(e){}propRule(e,t,i){const s=this.getWebApp();let o=!1;if(t=r.toInt(t),!this._oPropRuleStore){if(this._oPropRuleStore={},!s._oModeControl)throw new r.Error(999,"Mobile mode controller not available!",this);s._oModeControl.regWO(this)}if(this._oPropRuleStore[e])for(let s=0;s<this._oPropRuleStore[e].aRules.length;s++)this._oPropRuleStore[e].aRules[s].eM===t&&(o=!0,this._oPropRuleStore[e].aRules[s].sV=i);else this._oPropRuleStore[e]={sDefault:null,aRules:[],bActive:!1};o||(this._oPropRuleStore[e].aRules.push({eM:t,sV:i}),this._oPropRuleStore[e].aRules.sort((function(e,t){return t.eM-e.eM}))),s._oModeControl.enforceRule(this,e)}findFunc(e){let t=null,i=null;if(e){const s=e.split(".");for(;s.length>1;){const e=s.shift();if(i)i=i[e];else if("window"===e)i=window;else if("this"===e)i=this;else if("object"==typeof this[e])i=this[e];else{const t=r.sys.ref.getGlobalObj();"object"==typeof t[e]&&(i=t[e])}}const o=s[0];if(i)t=i[o];else if("function"==typeof this[o])t=this[o],i=this;else{const e=r.sys.ref.getGlobalObj();"function"==typeof e[o]&&(t=e[o],i=e)}}return{fFunc:t,oEnv:i}}isParent(e){let t=this;for(;t;){if(t==e)return!0;t=t._oParent}return!1}}const g=e=>class extends e{constructor(e,t){super(e,t),this.prop(r.tBool,"pbDragDropEnabled",!1),this._sRawDragData="",this._aDragDropHelpers=new Set,this._aDropZones=[],this._aDragActions=new Set,this._aDropActions=new Set,this.event("OnDragStart",r.cCallModeWait),this.event("OnDrop",r.cCallModeDefault)}addDragDropEventListeners(){this._eElem&&(r.dom.off("dragstart",this._eElem,this.onDragStart,this),r.dom.off("dragend",this._eElem,this.onDragEnd,this),this._aDragActions.size>0&&(r.dom.on("dragstart",this._eElem,this.onDragStart,this),r.dom.on("dragend",this._eElem,this.onDragEnd,this)))}registerDragSource(e,t){this._aDragDropHelpers.add(e),this._aDragActions.add(t),this.resize(),this._eElem&&this.addDragDropEventListeners()}registerDropTarget(e,t){if(this._aDropActions.size>0&&(t==r.dropActions.WebControl.ciDropOnControl||this._aDropActions.has(r.dropActions.WebControl.ciDropOnControl)))throw new r.Error(999,'Drop Action "DropOnControl" cannot be used in conjunction with other Drop Actions. Ensure only "DropOnControl" or any of the other actions are registered exclusively.',this);this._aDragDropHelpers.add(e),this._aDropActions.add(t),this._eElem&&this.initDropZones()}getDragSourceObj(){return this}getDropTargetObj(){return this}initDropZones(){}addDropZone(e,t){t||(t=this);var i=new r.WebDropZone(e,t);this._aDropZones.push(i)}removeDropZone(e){this._aDropZones=this._aDropZones.filter((t=>t!==e))}removeDropZoneByElem(e){this._aDropZones=this._aDropZones.filter((t=>t._eZone!==e))}initDraggableElements(){}dragDropInit(){this._aDropZones=[],this.addDragDropEventListeners(),this.initDropZones()}dragDropCleanup(){}onDragStart(e){var[t,i]=this.getDragData(e,e.e.target);t&&i&&(e.e.stopPropagation(),this._aDragDropHelpers.forEach((s=>{s.onDragStart(e,this,e.e.target,t,i)})))}onDragEnd(e){this._aDragDropHelpers.forEach((t=>{t.onDragEnd(e)}))}onDrop(e,t,i){this._aDragDropHelpers.forEach((s=>{s.onDrop(e,this,t,i)}))}onControlDragOver(e,t,i){}getDragData(e,t){return[undefined,undefined]}getDropData(e){return[]}highlightDropZones(e){this._aDropZones.forEach((t=>{t.highlight(e)}))}cleanupDropZones(){this._aDropZones.forEach((e=>{e.unhighlight(),e.removeDropElemInteractions()}))}hasData(){return!1}determineDropCandidate(e,t){return[undefined,undefined]}determineDropPosition(e,t){return r.dropPositions.ciDropUnknown}interactWithDropElem(e,t){e.highlightElement(t)}doEmptyInteraction(e){}isSupportedDragAction(e){return this._aDragActions.has(e)}isSupportedDropAction(e){return this._aDropActions.has(e)}},_=class extends(g(c)){};class m extends _{constructor(e,t){super(e,t),this.prop(r.tString,"psCSSClass",""),this.prop(r.tString,"psHtmlId",""),this.prop(r.tString,"psTextColor",""),this.prop(r.tString,"psBackgroundColor",""),this.prop(r.tBool,"pbRender",!0),this.prop(r.tBool,"pbVisible",!0),this.prop(r.tBool,"pbEnabled",!0),this.event("OnRender",r.cCallModeDefault),this.OnAfterRender=new r.events.JSHandler,this.OnAfterShow=new r.events.JSHandler,this.OnAfterHide=new r.events.JSHandler,this._eElem=null,this._bWrapDiv=!1,this._bRenderChildren=!1,this._bFocusAble=!1,this._sControlClass="",this._sBaseClass="WebUIObj",this._aKeyHandlers=[],this._bShown=!1}openHtml(e){this._bWrapDiv&&(e.push('<div class="',this.genClass(),'"'),this.psHtmlId&&e.push(' id="',this.psHtmlId,'"'),e.push(' data-dfobj="',this.getLongName(),'"'),e.push(' tabindex="-1" style=" ',this.pbRender?"":"display: none;",this.pbVisible?"":"visibility: hidden;",'"'),e.push(">"))}closeHtml(e){this._bWrapDiv&&e.push("</div>")}render(){const e=[];return this.openHtml(e),this.closeHtml(e),this._eElem=r.dom.create(e.join("")),this.getRef(),this._bRenderChildren&&this.renderChildren(),this._eElem}getRef(){}afterRender(){this._bRenderChildren&&this.afterRenderChildren(),this._aKeyHandlers.length>0&&r.dom.on("keydown",this._eElem,this.onKeyDownHandler,this),this.fire("OnRender"),this.attachFocusEvents(),this.set_psTextColor(this.psTextColor),this.psBackgroundColor&&this.set_psBackgroundColor(this.psBackgroundColor),this.dragDropInit(),this.OnAfterRender.fire(this)}destroy(){super.destroy(),this._eElem&&(r.dom.clear(this._eElem,!0),this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem)),this._eElem=null}afterShow(){if(this._bShown=!0,this.OnAfterShow.fire(this),this._bRenderChildren)for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&this._aChildren[e].pbRender&&this._aChildren[e].afterShow()}afterHide(){if(this._bShown=!1,this.OnAfterHide.fire(this),this._bRenderChildren)for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&this._aChildren[e].pbRender&&this._aChildren[e].afterHide()}attachFocusEvents(){}renderChildren(e){e=e||this._eElem;for(let t=0;t<this._aChildren.length;t++){const i=this._aChildren[t];if(i instanceof m){const t=i.render();t&&e.appendChild(t)}}}afterRenderChildren(){for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&this._aChildren[e].afterRender()}isActive(){return this.pbRender&&this.pbVisible&&this.isEnabled()}isEnabled(){return!!this.pbEnabled&&(!(this._oParent instanceof m)||this._oParent.isEnabled())}updateEnabled(){if(this.applyEnabled(this.isEnabled()),this._bRenderChildren)for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&this._aChildren[e].updateEnabled()}applyEnabled(e){this._eElem&&(r.dom.toggleClass(this._eElem,r.CssDisabled,!e),r.dom.toggleClass(this._eElem,r.CssEnabled,e))}genClass(){return this._sBaseClass+" "+this._sControlClass+" "+(this.isEnabled()?r.CssEnabled:r.CssDisabled)+(this.psCSSClass?" "+this.psCSSClass:"")}set_psTextColor(e){this._eElem&&(this._eElem.style.color=e||"")}set_psBackgroundColor(e){this._eElem&&(this._eElem.style.background=e||"")}set_pbVisible(e){this._eElem&&(this._eElem.style.visibility=e?"":"hidden")}set_pbRender(e){this._eElem&&(this._eElem.style.display=e?"":"none",this.pbRender!==e&&(this.pbRender=e,this.pbRender?this.afterShow():this.afterHide(),this.sizeChanged(!0)))}set_pbEnabled(e){e!==this.pbEnabled&&(this.pbEnabled=e,this.updateEnabled())}set_psCSSClass(e){this.psCSSClass=e,this._eElem&&(this._eElem.className=this.genClass())}set_psHtmlId(e){this._eElem&&(this._eElem.id=e)}addKeyHandler(e,t,i,s,o){t=r.toInt(t),i=r.toBool(i),s=r.toBool(s),o=r.toBool(o);const n=this.findKeyHandler(t,i,s,o);if(n){for(let t=0;t<n.aMsg.length;t++)if(n.aMsg[t]===e)return;n.aMsg.push(e)}else 0===this._aKeyHandlers.length&&this._eElem&&r.dom.on("keydown",this._eElem,this.onKeyDownHandler,this),this._aKeyHandlers.push({iKey:t,aMsg:[e],bShift:i,bAlt:s,bCtrl:o})}removeKeyHandler(e,t,i,s,o){t=r.toInt(t),i=r.toBool(i),s=r.toBool(s),o=r.toBool(o);const n=this.findKeyHandler(t,i,s,o);if(n){for(let t=0;t<n.aMsg.length;t++)n.aMsg[t]===e&&(n.aMsg.splice(t,1),t--);n.aMsg.length||this._aKeyHandlers.slice(n.iIndex,1)}0===this._aKeyHandlers.length&&this._eElem&&r.dom.off("keydown",this._eElem,this.onKeyDownHandler,this)}findKeyHandler(e,t,i,s,o){for(let o=0;o<this._aKeyHandlers.length;o++){const n=this._aKeyHandlers[o];if(n.iKey===e&&n.bShift===t&&n.bAlt===i&&n.bCtrl===s)return n.iIndex=o,n}return null}onKeyDownHandler(e){const t=this.findKeyHandler(e.getKeyCode(),e.getShiftKey(),e.getAltKey(),e.getCtrlKey());if(t){this.getWebApp()._oCurrentObj&&this.getWebApp()._oCurrentObj!=this&&this.getWebApp()._oCurrentObj.validate&&this.getWebApp()._oCurrentObj.validate();for(let e=0;e<t.aMsg.length;e++)this.serverAction(t.aMsg[e],[t.iKey,r.fromBool(t.bShift),r.fromBool(t.bAlt),r.fromBool(t.bCtrl)]);e.stop()}}svrFocus(){const e=this.getWebApp();e?e.ready((()=>{this.focus()}),this):this.focus()}updateFocus(e){e?this.objFocus():this.getWebApp()?.objBlur(this)}onFocus(e){this.updateFocus(!0)}onBlur(e){this.updateFocus(!1)}objFocus(){const e=this.getView(),t=this.getWebApp();e&&e.objFocus(this),t&&t.objFocus(this)}focus(e){return!!(this._bFocusAble&&this.isEnabled()&&this._eElem&&this._eElem.focus)&&(this._eElem.focus(),this.objFocus(),!0)}conditionalFocus(e){return r.sys.isMobile?!(!this._bFocusAble||!this.isEnabled())&&(this.objFocus(),!0):this.focus(e)}scrollIntoView(e){this._eElem&&this._eElem.scrollIntoView(r.toBool(e))}focusNext(e){let t,i=this;for(;t=i._oParent;){for(let s=t._aChildren.indexOf(i)+1;s>0&&s<t._aChildren.length;s++)if(t._aChildren[s].focus(e))return!0;i=t}}sizeChanged(e){const t=this.getWebApp();let i=this;if(e&&(this._oParent&&this._oParent._bIsContainer&&(this._oParent._bPositionChanged=!0),this._bIsContainer&&(this._bPositionChanged=!0)),t)t.objSizeChanged(this),t.notifyLayoutChange(this);else{for(;i._oParent&&!i._bIsView&&!i._bIsBaseApp;)i=i._oParent;i&&i.resize&&i.resize()}}fireSubmit(){return this._oParent&&this._oParent.fireSubmit&&this._oParent.fireSubmit()}makeVisible(){this._oParent?.makeVisible?.()}determineSelectorForWebUIContext(e){return null}verifyElementForWebUIContext(e,t){return!0}retrieveValueFromWebUIContext(e,t){return null}getDropData(e,t){if(e&&e._eDropElem){return{data:this.getControlValue&&this.getControlValue()||"",action:r.dropActions.WebTagsForm.ciDropOnControl}}return null}initDropZones(){this.isSupportedDropAction(r.dropActions.WebControl.ciDropOnControl)&&this.addDropZone(this._eElem)}determineDropCandidate(e,t){return t.find((e=>e.supportsDropAction(this,r.dropActions.WebControl.ciDropOnControl)))?[this._eElem,r.dropActions.WebControl.ciDropOnControl]:[null,null]}determineDropPosition(e,t){return r.dropPositions.ciDropOn}interactWithDropElem(e,t){e.highlightElement()}doEmptyInteraction(e){return e.highlightElement(),r.dropActions.WebTagsForm.ciDropOnControl}hasData(){return!0}topLayer(){return this._oParent?.topLayer?.()||null}layoutType(){return this._oParent?.layoutType?.()||r.layoutType.ciLayoutTypeFlow}}class b extends m{constructor(e,t){super(e,t),this.prop(df.tInt,"piColumnIndex",0),this.prop(df.tInt,"piColumnSpan",1),this.prop(df.tInt,"piRowSpan",1),this.prop(df.tInt,"piRowIndex",0),this.prop(df.tBool,"pbShowLabel",!0),this.prop(df.tString,"psLabel",""),this.prop(df.tInt,"peLabelPosition",0),this.prop(df.tInt,"peLabelAlign",-1),this.prop(df.tInt,"piLabelOffset",-1),this.prop(df.tString,"psLabelColor",""),this.prop(df.tString,"psToolTip",""),this.prop(df.tBool,"pbFillHeight",!1),this.prop(df.tInt,"piHeight",-1),this.prop(df.tInt,"piMinHeight",0),this.event("OnFocus",df.cCallModeDefault),this.event("OnBlur",df.cCallModeDefault),this._eInner=null,this._eLbl=null,this._eControlWrp=null,this._eControl=null,this._oInfoBalloon=null,this._oObserver=null,this._sControlId=df.dom.genDomId(),this._bFocusAble=!0,this._bHasFocus=!1,this._sBaseClass="WebControl",this._bJSSizing=!0}openHtml(e){e.push('<div class="',this.genClass(),'"'),this.psHtmlId&&e.push(' id="',this.psHtmlId,'"'),e.push(' data-dfobj="',this.getLongName(),'"'),e.push(' style=" ',this.pbRender?"":"display: none;",this.pbVisible?"":"visibility: hidden;",'"'),e.push(">"),this.pbShowLabel?(e.push('<div class="WebCon_Inner ',this.pbFillHeight?"WebCon_FillRow":"",'">'),this.peLabelPosition!=df.ciLabelRight&&e.push(this.genLabelHtml())):e.push('<div class="WebCon_Inner ',this.pbFillHeight?"WebCon_FillRow":"",'">'),e.push("<div>")}genClass(){return super.genClass()+(this.pbFillHeight?" Web_FillHeight":"")+(this._bJSSizing?" Web_JS_Sizing":"")}closeHtml(e){e.push("</div>"),this.pbShowLabel&&this.peLabelPosition==df.ciLabelRight&&e.push(this.genLabelHtml()),e.push("</div></div>")}genLabelHtml(){const e=[];return df.sys.isMobile?e.push("<label>",df.dom.encodeHtml(this.psLabel),"</label>"):e.push('<label for="',this._sControlId,'" class="',this.peLabelPosition==df.ciLabelFloat&&""==this.psValue?"WebCon_Unfloat":"WebCon_Float",'" >',df.dom.encodeHtml(this.psLabel),"</label>"),e.join("")}afterRender(){this._eInner=df.dom.query(this._eElem,"div.WebCon_Inner"),this._eControlWrp=df.dom.query(this._eElem,"div.WebCon_Inner > div"),this.pbShowLabel&&(this._eLbl=df.dom.query(this._eElem,"div > label")),super.afterRender(),this._eLbl&&df.dom.on("click",this._eLbl,this.onLblClick,this),this.posLabel(!0),this.set_psLabelColor(this.psLabelColor),this.set_peLabelAlign(this.peLabelAlign),this.set_psToolTip(this.psToolTip),(this._bJSSizing||this.piHeight>0)&&this.sizeHeight(-1),this._oInfoBalloon&&(this._oInfoBalloon.init(),this._bShowInfoBallon&&this._oInfoBalloon.show()),this.initObserver()}afterShow(){super.afterShow(),this.initObserver()}afterHide(){super.afterHide(),this.destroyObserver()}destroy(){super.destroy(),this._eLbl=null,this._eControlWrp=null,this._eInner=null,this._eControl=null,this._oInfoBalloon&&(this._oInfoBalloon.destroy(),this._oInfoBalloon=null),this.destroyObserver()}onLblClick(e){df.sys.isMobile||this.focus()}set_psLabel(e){this._eLbl&&(e||(e=" "),df.dom.setText(this._eLbl,e))}set_pbShowLabel(e){this.pbShowLabel=e,this.posLabel(!1),this.sizeChanged()}set_psLabelColor(e){this._eLbl&&(this._eLbl.style.color=e)}set_peLabelAlign(e){this._eLbl&&(this._eLbl.style.textAlign=e===df.ciAlignLeft?"left":e===df.ciAlignCenter?"center":e===df.ciAlignRight?"right":"")}set_piLabelOffset(e){this.piLabelOffset=e,this.posLabel(!1),this.sizeChanged()}set_peLabelPosition(e){this.peLabelPosition=e,this.posLabel(!1),this.sizeChanged()}set_psToolTip(e){this._eControl&&(this._eControl.title=e)}set_piColumnIndex(e){this.piColumnIndex!==e&&(this.piColumnIndex=e,this.sizeChanged(!0))}set_piColumnSpan(e){this.piColumnSpan!==e&&(this.piColumnSpan=e,this.sizeChanged(!0))}set_psTextColor(e){this._eControl&&(this._eControl.style.color=e||"")}set_psBackgroundColor(e){this._eControl&&(this._eControl.style.background=e||"")}set_piMinHeight(e){this._eControl&&this.piMinHeight!==e&&(this.piMinHeight=e,this.sizeChanged())}set_piHeight(e){this._eControl&&this.piHeight!==e&&(this.piHeight=e,this.sizeChanged())}set_pbFillHeight(e){this._eControl&&(df.dom.toggleClass(this._eElem,"Web_FillHeight",e),this.pbFillHeight!==e&&(this.pbFillHeight=e,this.sizeChanged(!0)),this.initObserver())}initObserver(){this._bJSSizing&&this.isInGridContainer()&&this.pbFillHeight?this.createObserver():this.destroyObserver()}createObserver(){this._eElem&&!this._oObserver&&(this._oObserver=new ResizeObserver((e=>{let t=e[0]?.contentRect.height;t||(t=this._eElem.getBoundingClientRect()?.height||0),this.sizeHeight(t)})),this._oObserver.observe(this._eElem))}destroyObserver(){this._oObserver&&(this._oObserver.disconnect(),this._oObserver=null)}sizeChanged(e){this._eControl&&!this.pbFillHeight&&this.sizeHeight(-1),super.sizeChanged(e)}sizeHeight(e){let t=-1,i=!1;if(this.pbFillHeight?(t=e,i=e>0):this.piHeight>0&&(t=this.piHeight,i=!0),t<this.piMinHeight&&(t=this.piMinHeight,i=i||!this.pbFillHeight),this.setHeight(t,i),t>0)return t}setHeight(e,t){this._eControl&&(e>0?(e=(e-=this.getVertHeightDiff())<0?0:e,this._eControl.style.height=e+"px"):this._eControl.style.height="")}getVertHeightDiff(){let e=0;return this.peLabelPosition!==df.ciLabelTop&&this.peLabelPosition!==df.ciLabelFloat||!this._eLbl||(e+=this._eLbl.offsetHeight),e+=df.sys.gui.getVertBoxDiff(this._eInner),e+=df.sys.gui.getVertBoxDiff(this._eControlWrp),e+=df.sys.gui.getVertBoxDiff(this._eControl),e}posLabel(e){const t=this.peLabelPosition,i=this.piLabelOffset;let s,o="",n="";if(this._eElem){if(e||df.dom.removeClass(this._eInner,"WebCon_HasLabel WebCon_TopLabel WebCon_RightLabel WebCon_LeftLabel"),this.pbShowLabel){switch(this._eLbl||(df.sys.isMobile?this._eLbl=df.dom.create("<label>&nbsp;</label>"):this._eLbl=df.dom.create('<label for="'+this._sControlId+'" class="'+(this.peLabelPosition==df.ciLabelFloat&&""==this.psValue?"unfloat":"float")+'">&nbsp;</label>'),this.set_psLabel(this.psLabel),this.set_psLabelColor(this.psLabelColor),this.set_peLabelAlign(this.peLabelAlign),this._eInner.insertBefore(this._eLbl,this._eInner.firstChild),df.dom.on("click",this._eLbl,this.onLblClick,this)),e||df.dom.addClass(this._eInner,"WebCon_HasLabel"),t){case df.ciLabelLeft:s="WebCon_LeftLabel",i>0&&(o=`${i}px minmax(0, 1fr)`);break;case df.ciLabelTop:i>0&&(n=`${i}px minmax(0, 1fr)`),s="WebCon_TopLabel";break;case df.ciLabelFloat:s="WebCon_TopLabel WebCon_FloatEnabled";break;case df.ciLabelRight:s="WebCon_RightLabel",i>0&&(o=`minmax(0, 1fr) ${i}px`)}df.dom.addClass(this._eInner,s)}else this._eLbl&&(df.dom.off("click",this._eLbl,this.onLblClick,this),this._eLbl.parentNode.removeChild(this._eLbl),this._eLbl=null);this._eInner.style.gridTemplateColumns=o,this._eInner.style.gridTemplateRows=n}}getTooltipElem(){return this._eControlWrp}showInfoBalloon(e,t,i){i=df.toBool(i),this._oInfoBalloon?(this._oInfoBalloon.psCssClass=e,this._oInfoBalloon.psMessage=t,this._oInfoBalloon.update()):this._oInfoBalloon=new df.InfoBalloon(this,e,t),this._eElem?(this._oInfoBalloon.init(),i&&this._oInfoBalloon.show()):this._bShowInfoBallon=i}hideInfoBalloon(){this._oInfoBalloon&&this._oInfoBalloon.hide()}resize(){this._oInfoBalloon&&this._oInfoBalloon.resize(),this._aChildren.forEach((function(e){e.resize&&e.resize()}))}isInGridContainer(){return this._oParent?.isGridLayout?.()}focus(){if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){try{this._eControl.focus()}catch(e){}return this.objFocus(),!0}return!1}attachFocusEvents(){df.dom.on("focusin",this._eElem,this.onFocus,this),df.dom.on("focusout",this._eElem,this.onBlur,this)}updateFocus(e){super.updateFocus(e),df.dom.toggleClass(this._eElem,"WebCon_Focus",e),e?this.fire("OnFocus"):this.fire("OnBlur"),this._bHasFocus=e}}const C=e=>class extends e{constructor(e,t){super(e,t),this.prop(df.tInt,"piColumnCount",1),this.prop(df.tInt,"piWidth",0),this.prop(df.tInt,"piMinWidth",0),this.prop(df.tInt,"piHeight",0),this.prop(df.tInt,"piMinHeight",0),this.prop(df.tBool,"pbScroll",!1),this.prop(df.tInt,"peLayoutType",df.layoutType.ciLayoutTypeFlow),this.prop(df.tInt,"piRowCount",0),this.prop(df.tString,"psRowHeights",""),this.prop(df.tInt,"piDefaultRowHeight",-1),this.prop(df.tString,"psColumnWidths",""),this.prop(df.tString,"psDefaultColumnWidth","1fr"),this._oRegionTop=null,this._oRegionLeft=null,this._oRegionCenter=null,this._oRegionRight=null,this._oRegionBottom=null,this._eRegionTop=null,this._eMainArea=null,this._eRegionLeft=null,this._eRegionCenter=null,this._eContent=null,this._eRegionRight=null,this._eRegionBottom=null,this._eContainer=null,this._aUIObjects=[],this._aPanels=[],this._aFloats=[],this._bHasFill=!1,this._iContentHeight=null,this._bRendered=!1,this._bPanels=!1,this._bIsPanel=!1,this._bPositionChanged=!0,this._bIsContainer=!0,this._iWantedHeight=null,this._bWantedChanged=!1,this._iWhiteSpaceHeight=0,this._aRowsTemplate=[],this._aColsTemplate=[],this._iTotalRowHeight=0,this._bRenderChildren=!0,this._sBaseClass="WebContainer"}openHtml(e){super.openHtml(e),this.wrpOpenHtml(e),e.push('<div class="WebCon_Sizer">')}closeHtml(e){this._bPanels?e.push('<div class="WebCon_Main">'):e.push('<div class="WebCon_Content'+(this.isGridLayout()?" WebCon_GridLayout":"")+'">'),e.push("</div></div>"),this.wrpCloseHtml(e),super.closeHtml(e)}wrpOpenHtml(e){}wrpCloseHtml(e){}afterRender(){super.afterRender(),this._bRendered=!0,df.events.addDomListener("scroll",this._eElem,this.onScroll,this)}render(){this._bRenderChildren=!1;const e=super.render();return this._bRenderChildren=!0,this._eSizer=df.dom.query(this._eElem,"div.WebCon_Sizer"),this._iLastInnerHeight=-1,this._bPanels?this._eMainArea=df.dom.query(this._eElem,"div.WebCon_Main"):this._eContent=df.dom.query(this._eElem,"div.WebCon_Content"),this._eContainer=df.dom.query(this._eElem,"div.WebContainer")||this._eElem,this.renderChildren(),this.position(),e}renderChildren(){let e;for(let t=0;t<this._aFloats.length;t++)e=this._aFloats[t].render(),e&&this._eSizer.appendChild(e);if(this._bPanels){if(this._aUIObjects.length>0)throw new df.Error(999,"Web controls and panels cannot be siblings within the same container object '{{0}}'. Consider placing them within a panel.",this,[this.getLongName()||"oWebApp"]);this._eMainArea.style.position="relative",this._eMainArea.appendChild(df.dom.create('<div style="clear: both;"></div>'));for(let t=0;t<this._aPanels.length;t++)e=this._aPanels[t].render();this.placePanels(),this._bPositionChanged=!1}else{for(let t=0;t<this._aUIObjects.length;t++)e=this._aUIObjects[t].render(),e&&this._eContent.appendChild(e);this.isFlowLayout()&&this._eContent.appendChild(df.dom.create('<div style="clear: both;"></div>'))}}addChild(e){e instanceof m&&(e._bFloating?this._aFloats.push(e):void 0!==e.peRegion?(this._bPanels=!0,this._aPanels.push(e)):this._aUIObjects.push(e)),super.addChild(e)}insertChild(e,t){e instanceof m&&(e._bFloating?this._aFloats.push(e):void 0!==e.peRegion?(this._bPanels=!0,this._aPanels.push(e)):this._aUIObjects.splice(t,0,e)),super.insertChild(e,t)}renderChild(e,t){let i,s;t&&(s=!0);const o=this._aUIObjects.indexOf(e),n=o>=1?this._aUIObjects[o-1]:null,r=t||e.render();if(e._bIsPanel){switch(e.peRegion){case df.ciRegionBottom:this._eRegionBottom=r,this._oRegionBottom=e;break;case df.ciRegionCenter:this._eRegionCenter=r,this._oRegionCenter=e;break;case df.ciRegionLeft:this._eRegionLeft=r,this._oRegionLeft=e;break;case df.ciRegionRight:this._eRegionRight=r,this._oRegionRight=e;break;case df.ciRegionTop:this._eRegionTop=r,this._oRegionTop=e}this.placePanels()}else if(this._eContent&&r){if(null!==n)i=n._eElem.nextElementSibling;else if(i=this._eContent.firstElementChild,i)for(;!i.getAttribute("data-dfobj")&&i.nextElementSibling;)i=i.nextElementSibling;this._eContent.insertBefore(r,i)}s||e.afterRender(),this.position(),super.renderChild(e,t)}removeChild(e){let t;e instanceof m&&(e._bFloating?(t=this._aFloats.indexOf(e),this._aFloats.splice(t,1)):void 0!==e.peRegion?(t=this._aPanels.indexOf(e),0===this._aPanels.length&&(this._bPanels=!1),this._aPanels.splice(t,1)):(t=this._aUIObjects.indexOf(e),this._aUIObjects.splice(t,1))),super.removeChild(e)}unrenderChild(e){const t=e._eElem;if(e._bIsPanel)switch(e.peRegion){case df.ciRegionBottom:this._eRegionBottom=null,this._oRegionBottom=null;break;case df.ciRegionCenter:this._eRegionCenter=null,this._oRegionCenter=null;break;case df.ciRegionLeft:this._eRegionLeft=null,this._oRegionLeft=null;break;case df.ciRegionRight:this._eRegionRight=null,this._oRegionRight=null;break;case df.ciRegionTop:this._eRegionTop=null,this._oRegionTop=null}else e instanceof b&&this._eContent.removeChild(t);this.position(),super.unrenderChild(e)}placePanels(){let e;this._oRegionTop=null,this._oRegionLeft=null,this._oRegionCenter=null,this._oRegionRight=null,this._oRegionBottom=null,this._eRegionTop=null,this._eRegionLeft=null,this._eRegionCenter=null,this._eRegionRight=null,this._eRegionBottom=null;for(let t=0;t<this._aPanels.length;t++){const i=this._aPanels[t];if(i.peRegion===df.ciRegionCenter){if(this._oRegionCenter)throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[i._sName,this._oRegionCenter._sName]);this._oRegionCenter=i,this._eRegionCenter=e=i._eElem,e.parentNode!=this._eMainArea&&this._eMainArea.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.right="0px",e.style.left="0px",e.style.bottom="0px"}else if(i.peRegion===df.ciRegionTop){if(this._oRegionTop)throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[i._sName,this._oRegionTop._sName]);this._oRegionTop=i,this._eRegionTop=e=i._eElem,e.parentNode==this._eMainArea.parentNode&&e.nextElementSibling==this._eMainArea||this._eMainArea.parentNode.insertBefore(e,this._eMainArea),e.style.position="",e.style.top="",e.style.left="",e.style.right="",e.style.bottom=""}else if(i.peRegion===df.ciRegionLeft){if(this._oRegionLeft)throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[i._sName,this._oRegionLeft._sName]);this._oRegionLeft=i,this._eRegionLeft=e=i._eElem,e.parentNode!=this._eMainArea&&this._eMainArea.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.right="",e.style.bottom="0px"}else if(i.peRegion===df.ciRegionRight){if(this._oRegionRight)throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[i._sName,this._oRegionRight._sName]);this._oRegionRight=i,this._eRegionRight=e=i._eElem,e.parentNode!=this._eMainArea&&this._eMainArea.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.left="",e.style.right="0px",e.style.bottom="0px"}else{if(i.peRegion!==df.ciRegionBottom)throw new df.Error(999,"Invalid value for peRegion of '{{0}}'",this,[i._sName]);if(this._oRegionBottom)throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[i._sName,this._oRegionBottom._sName]);this._oRegionBottom=i,this._eRegionBottom=e=i._eElem,e.parentNode==this._eMainArea.parentNode&&e.previousElementSibling==this._eMainArea||this._eMainArea.parentNode.appendChild(e),e.style.position="",e.style.top="",e.style.left="",e.style.right="",e.style.bottom=""}}}genClass(){let e=super.genClass();return this.pbScroll&&(e+=" WebScroll"),e}prepareSize(){let e,t=0,i=0,s=0,o=0;const n=this._iWantedHeight;this._bStretch=!1;for(let e=0;e<this._aFloats.length;e++)this._aFloats[e].prepareSize&&this._aFloats[e].prepareSize();if(this._bPanels){this._bPositionChanged&&(this.placePanels(),this._bPositionChanged=!1),this._oRegionTop&&this._oRegionTop.pbRender&&(t+=this._oRegionTop.prepareSize(),i+=this._oRegionTop._iWantedHeight),this._oRegionCenter&&this._oRegionCenter.pbRender&&(s=this._oRegionCenter.prepareSize(),o=this._oRegionCenter._iWantedHeight,this._bStretch=this._oRegionCenter._bStretch||this._bStretch),this._oRegionLeft&&this._oRegionLeft.pbRender&&(e=this._oRegionLeft.prepareSize(),s=e>s?e:s,o=this._oRegionLeft._iWantedHeight>o?this._oRegionLeft._iWantedHeight:o,this._bStretch=this._oRegionLeft._bStretch||this._bStretch),this._oRegionRight&&this._oRegionRight.pbRender&&(e=this._oRegionRight.prepareSize(),s=e>s?e:s,o=this._oRegionRight._iWantedHeight>o?this._oRegionRight._iWantedHeight:o,this._bStretch=this._oRegionRight._bStretch||this._bStretch),i+=o,this._oRegionBottom&&this._oRegionBottom.pbRender&&(t+=this._oRegionBottom.prepareSize(),i+=this._oRegionBottom._iWantedHeight);const n=this.getHeightDiff(!0,!0,!0,!0);i+=n,t+=n}else{this._bPositionChanged&&(this.position(),this._iContentHeight=null,this._bPositionChanged=!1);for(let e=0;e<this._aChildren.length;e++)this._aChildren[e].prepareSize&&!this._aChildren[e]._bIsView&&this._aChildren[e].prepareSize();this._bHasFill?this.isGridLayout()?i=1:(this._iContentHeight||this.resizeColumnLayout(),i+=this._iContentHeight+this.getHeightDiff(!0,!0,!0,!0)):i+=df.dom.clientHeight(this._eContent)+this.getHeightDiff(!0,!0,!0,!1)}return this._iMinHeight=t,this._bIsPanel&&this.piHeight>0&&(this.peRegion==df.ciRegionBottom||this.peRegion==df.ciRegionTop)||!this._bIsPanel&&this.piHeight>0?this._iWantedHeight=this.piHeight:this._iWantedHeight=i>this.piMinHeight?i:this.piMinHeight,this._bWantedChanged=n!==this._iWantedHeight,this.peRegion!==df.ciRegionTop&&this.peRegion!==df.ciRegionBottom&&(this.piHeight<=0&&this._bHasFill||this._bIsView&&this.pbFillHeight)&&(this._bStretch=!0),this._bSizePrep=!0,this.pbScroll?0:this._iWantedHeight}resizeHorizontal(){let e=0;if(this._eElem){this._bPanels?(this._oRegionLeft&&(e=this._oRegionLeft.piWidth>0?this._oRegionLeft.piWidth:this._oRegionRight&&this._oRegionRight.pbRender?(this._eMainArea.clientWidth-(this._oRegionRight.piWidth||this._eMainArea.clientWidth/3))/2:this._eMainArea.clientWidth/2,this._oRegionLeft.setOuterWidth(e),this._eRegionCenter&&(this._eRegionCenter.style.left=this._oRegionLeft.pbRender?e+"px":"0px")),this._oRegionRight&&(e=this._oRegionRight.piWidth>0?this._oRegionRight.piWidth:this._oRegionLeft&&this._oRegionLeft.pbRender?(this._eMainArea.clientWidth-(this._oRegionLeft.piWidth||this._eMainArea.clientWidth/3))/2:this._eMainArea.clientWidth/2,this._oRegionRight.setOuterWidth(e),this._eRegionCenter&&(this._eRegionCenter.style.right=this._oRegionRight.pbRender?e+"px":"0px"))):this.updateMinWidth();for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&!this._aChildren[e]._bIsView&&this._aChildren[e].pbRender&&this._aChildren[e].resizeHorizontal&&this._aChildren[e].resizeHorizontal()}}resizeVertical(){let e,t,i,s,o=0,n=0,r=0,a=!1;if(this._eElem){if(this._bSizePrep||this.prepareSize(),this._bStretch||this._bIsPanel&&(this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionCenter||this.peRegion===df.ciRegionRight)?(e=df.dom.clientHeight(this._eContainer)+this.getHeightDiff(!0,!1,!1,!1),a=!0,e<this._iMinHeight&&(e=this._iMinHeight)):e=this._iWantedHeight,e<this.piMinHeight&&(e=this.piMinHeight,a=!0),this._bPanels){i=e,this._oRegionTop&&this._oRegionTop.pbRender&&(s=this._oRegionTop._iWantedHeight,s>i&&(e=e+this._oRegionTop._iWantedHeight-i,i=s),i-=s,this._oRegionTop.setOuterHeight(s)),this._oRegionBottom&&this._oRegionBottom.pbRender&&(s=this._oRegionBottom._iWantedHeight,s>i&&(e=e+s-i,i=s),i-=s,this._oRegionBottom.setOuterHeight(s));const l=i-this.getHeightDiff(!0,!0,!0,!0);this._oRegionLeft&&this._oRegionLeft.pbRender&&(n=this._oRegionLeft._iWantedHeight),this._oRegionCenter&&this._oRegionCenter.pbRender&&(o=this._oRegionCenter._iWantedHeight),this._bIsBaseApp&&(o=this._oCurrentView&&this._oCurrentView._iWantedHeight||0),this._oRegionRight&&this._oRegionRight.pbRender&&(r=this._oRegionRight._iWantedHeight);const h=Math.max(n,o,r);t=this.pbScroll?Math.max(h,l):a||this._oRegionLeft&&this._oRegionLeft._bStretch||this._oRegionCenter||this._oRegionRight&&this._oRegionRight._bStretch?l:h,t>0&&(this._eMainArea.style.height=t+"px"),this._iMiddleHeight=t}else this.isFlowLayout()&&this.resizeColumnLayout(),this.setInnerHeight(e);for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof m&&!this._aChildren[e]._bIsView&&this._aChildren[e].pbRender&&(this._aChildren[e].resizeVertical?this._aChildren[e].resizeVertical():this._aChildren[e].resize&&this._aChildren[e].resize());this._bSizePrep=!1}}setOuterHeight(e){e-=this.getHeightDiff(!0,!1,!1,!1),this._eElem.style.height=e>0?e+"px":""}setInnerHeight(e){e>0?e!==this._iLastInnerHeight&&(this._iLastInnerHeight=e,e-=this.getHeightDiff(!0,!0,!1,!1),this._eSizer.style.minHeight=e>0?e+"px":""):this._iLastInnerHeight>0&&(this._iLastInnerHeight=e,this._eSizer.style.minHeight="")}setOuterWidth(e){e-=df.sys.gui.getHorizBoxDiff(this._eElem,1),this._eElem.style.width=e>0?e+"px":""}setInnerWidth(e){e-=df.sys.gui.getHorizBoxDiff(this._eElem,0),e-=df.sys.gui.getHorizBoxDiff(this._eSizer,1),this._eSizer.style.width=e>0?e+"px":""}updateMinWidth(){let e=this.piMinWidth;e-=df.sys.gui.getHorizBoxDiff(this._eElem,0),e-=df.sys.gui.getHorizBoxDiff(this._eSizer,1),this._eSizer.style.minWidth=e>0?e+"px":""}resizeColumnLayout(){let e,t,i,s,o,n=0,r=0,a=0;const l=[],h=this.piColumnCount;if(df.sys.isIE&&df.sys.iVersion<=8&&(n=3),this._bHasFill){for(let t=0;t<this._aUIObjects.length;t++){const i=this._aUIObjects[t];if(i.pbRender){const t=-1==i.piColumnIndex?0:i.piColumnIndex,d=t+i.piColumnSpan<=h?t:0;if(o=d+i.piColumnSpan>h||i.piColumnSpan<=0?h-d:i.piColumnSpan,(r>d||r+o>h)&&(s?(s.iHeight=a,l.push(s),s=null):n+=a,a=0,r=0),i.pbFillHeight)s?s.aItems.push(i):s={aItems:[i],iHeight:0},e=i.getMinHeight?i.getMinHeight():i.piMinHeight,a<e&&(a=e);else{const e=df.dom.offsetHeight(i._eElem);e>a&&(a=e)}r=d+(o||1)}}s?(s.iHeight=a,l.push(s)):n+=a,this._iContentHeight=n,t=df.dom.clientHeight(this._eContainer),t<this.piMinHeight&&(t=this.piMinHeight),t-=this.getHeightDiff(!1,!0,!0,!0),t-=n,t-=this._iWhiteSpaceHeight;for(let e=0;e<l.length;e++){s=l[e],i=t/(l.length-e),i--,this._iContentHeight=this._iContentHeight+s.iHeight,i<s.iHeight&&(i=s.iHeight);for(let e=0;e<s.aItems.length;e++)s.aItems[e].sizeHeight(i);t-=i}}}layoutType(){return this.peLayoutType==df.layoutType.ciLayoutTypeInherit?this._oParent?.layoutType?.()||df.layoutType.ciLayoutTypeFlow:this.peLayoutType}isFlowLayout(){return this.layoutType()==df.layoutType.ciLayoutTypeFlow}isGridLayout(){return this.layoutType()==df.layoutType.ciLayoutTypeGrid}position(){this.isFlowLayout()||this._bPanels?this.positionFlow():this.positionGrid()}positionGrid(){let e;const t=this.piColumnCount,i=[],s=[],o=df.dom.query(this._eElem,".WebCon_Content");if(!o)return;o.style.display="grid";const n=this.parsePsColumnWidths();for(let e=0;e<t;e++){const t={iIndex:e,sWidth:-1,eType:df.rowColValType.ciTypeDefault},i=n.find((t=>t.iIndex==e));if(i){const e=i.sWidth;t.sWidth=e,t.eType=i.eType}s.push(t)}const r=this.getDefaultColumnWidth();0==n.length?o.style.gridTemplateColumns="repeat("+t+", "+r+")":o.style.gridTemplateColumns=s.map((e=>{switch(e.eType){case df.rowColValType.ciTypeDefault:return r;case df.rowColValType.ciTypeFixed:return e.sWidth+"px";case df.rowColValType.ciTypeFraction:case df.rowColValType.ciTypeOther:return e.sWidth;default:return r}})).join(" ");const a=this.getDefaultRowHeight(),l=this.genBaseRowHeightString(a);o.style.gridAutoRows=l;let[h,d]=this.sortChildren(this._aUIObjects);d<this.piRowCount&&(d=this.piRowCount);let p=[];if(this.psRowHeights&&""!=this.psRowHeights){let e;[p,e]=this.parsePsRowHeights(),d<=e&&(d=e+1)}for(let e=0;e<d;e++){const t={iIndex:e,sHeight:-1,eType:df.rowColValType.ciTypeDefault},s=p.find((t=>t.iIndex==e));s&&(t.sHeight=s.sHeight,t.eType=s.eType),i.push(t)}this._aRowsTemplate=i,this._aColsTemplate=s,this._bHasFill=!1,o.style.gridTemplateRows=i.map((e=>{switch(e.eType){case df.rowColValType.ciTypeDefault:return l;case df.rowColValType.ciTypeFixed:return e.sHeight+"px";case df.rowColValType.ciTypeFraction:return this._bHasFill=!0,e.sHeight;case df.rowColValType.ciTypeOther:return e.sHeight;default:return l}})).join(" "),h.forEach((i=>{if(i._eElem&&i.pbRender&&i instanceof b){const s=i.piColumnIndex+i.piColumnSpan<=t?i.piColumnIndex:0;e=s+i.piColumnSpan>t||i.piColumnSpan<=0?t-undefined:i.piColumnSpan;const o=s>-1?i.piColumnIndex+1:"auto",n=i.piRowIndex>-1?i.piRowIndex+1:"auto";e=i.piColumnSpan>0?i.piColumnSpan:1;const r=i.piRowSpan>0?i.piRowSpan:1;i._eElem.style.gridColumn=o+" / span "+e,i._eElem.style.gridRow=n+" / span "+r}}))}determineRowHeights(){const e=[],t=df.dom.query(this._eElem,".WebCon_Content");if(!t)return;let i=window.getComputedStyle(t).gridTemplateRows.split(" ");for(let t=0;t<i.length;t++)e.push(parseFloat(i[t]));return e}determineColumnWidths(){const e=[],t=df.dom.query(this._eElem,".WebCon_Content");if(!t)return;const i=window.getComputedStyle(t).gridTemplateColumns.split(" ");for(let t=0;t<i.length;t++)e.push(parseFloat(i[t]));return e}parsePsColumnWidths(){const e=[];try{if(this.psColumnWidths&&""!=this.psColumnWidths){let t=this.psColumnWidths.split(" ");for(let i=0;i<t.length;i++){let s=t[i].split("/"),o=df.rowColValType.ciTypeOther;s[1].includes("fr")?o=df.rowColValType.ciTypeFraction:df.sys.math.isNumeric(s[1])&&(o=df.rowColValType.ciTypeFixed),e.push({iIndex:parseInt(s[0]),sWidth:s[1],eType:o})}}}catch(e){throw new df.Error(999,"Unable to parse psColumnWidths, check the documentation for more info on the correct format",this,[])}return e}parsePsRowHeights(){let e=0;const t=[];try{let i=this.psRowHeights.split(" ");for(let s=0;s<i.length;s++){let o=i[s].split("/");if(o.length>=2){let i=parseInt(o[0]),s=df.rowColValType.ciTypeOther;o[1].includes("fr")?s=df.rowColValType.ciTypeFraction:df.sys.math.isNumeric(o[1])&&(s=df.rowColValType.ciTypeFixed),t.push({iIndex:i,sHeight:o[1],eType:s}),i>e&&(e=i)}}}catch(e){throw new df.Error(999,"Unable to parse psRowHeights, check the documentation for more info on the correct format",this,[])}return[t,e]}sortChildren(e){return[e.sort(((e,t)=>e.piRowIndex>t.piRowIndex?1:e.piRowIndex<t.piRowIndex?-1:0)),1]}getDefaultRowHeight(){return this.piDefaultRowHeight>-1?this.piDefaultRowHeight:20}getDefaultColumnWidth(){return""!=this.psDefaultColumnWidth.trim()?this.psDefaultColumnWidth:"1fr"}positionFlow(){let e,t=0;const i=this.piColumnCount;if(i<=0)throw new df.Error(999,"Invalid column count on '{{0}}'",this,[this.getLongName()||"oWebApp"]);this._bHasFill=!1;for(let s=0;s<this._aUIObjects.length;s++){const o=this._aUIObjects[s];if(o._eElem&&o.pbRender&&o instanceof b){const s=-1==o.piColumnIndex?0:o.piColumnIndex,n=s+(o.piColumnSpan||1)<=i?s:0;e=n+o.piColumnSpan>i||o.piColumnSpan<=0?i-n:o.piColumnSpan,o._eElem.style.styleFloat="left",o._eElem.style.cssFloat="left",t>n||t+e>i?(o._eElem.style.clear="left",t=0):o._eElem.style.clear="none",o._eElem.style.marginLeft=Math.floor(1e4/i)/100*(n-t)+"%",t=n+(e||1),o._eElem.style.width=e===i?"100%":Math.floor(1e4/i)/100*e+"%"}this._bHasFill=this._bHasFill||o.pbFillHeight}}getRequiredHeight(){return this._bSizePrep||this.prepareSize(),this._bSizePrep=!1,this._iWantedHeight}genBaseRowHeightString(e){return"minmax("+e+"px, max-content)"}getHeightDiff(e,t,i,s){let o=0;return e&&this._eContainer&&(o+=df.sys.gui.getVertBoxDiff(this._eContainer,3)),t&&(this._eContainer&&(o+=df.sys.gui.getVertBoxDiff(this._eContainer,2),o+=this._eContainer.offsetHeight-this._eContainer.clientHeight),this._eSizer&&(o+=df.sys.gui.getVertBoxDiff(this._eSizer,1))),i&&(this._eSizer&&(o+=df.sys.gui.getVertBoxDiff(this._eSizer,2)),this._eMainArea&&(o+=df.sys.gui.getVertBoxDiff(this._eMainArea,2)),this._eContent&&(o+=df.sys.gui.getVertBoxDiff(this._eContent,1))),s&&this._eContent&&(o+=df.sys.gui.getVertBoxDiff(this._eContent,2),o+=1),o}getWidthDiff(e,t,i,s){let o=0;return e&&this._eElem&&(o+=df.sys.gui.getHorizBoxDiff(this._eElem,0)),(e||t)&&this._eContainer&&(o+=df.sys.gui.getHorizBoxDiff(this._eContainer,e&&t?0:e?1:2)),(t||i)&&this._eSizer&&(o+=df.sys.gui.getHorizBoxDiff(this._eSizer,t&&i?0:t?1:2)),i&&this._eMainArea&&(o+=df.sys.gui.getHorizBoxDiff(this._eMainArea,2)),(i||s)&&this._eContent&&(o+=df.sys.gui.getHorizBoxDiff(this._eContent,i&&s?0:i?1:2)),o}getContentWidthDiff(){let e=0;return this._eContent&&(e+=df.sys.gui.getHorizBoxDiff(this._eContent)),e}onScroll(e){const t=this.getWebApp();t&&t.notifyScroll(this)}focus(e){for(let t=0;t<this._aChildren.length;t++)if(this._aChildren[t].focus&&this._aChildren[t].focus(e))return!0;return!1}conditionalFocus(e){for(let t=0;t<this._aChildren.length;t++)if(this._aChildren[t].conditionalFocus&&this._aChildren[t].conditionalFocus(e))return!0;return!1}set_piWidth(e){this.piWidth=e,this._eElem&&this.sizeChanged()}set_piHeight(e){this.piHeight=e,this._eElem&&this.sizeChanged()}set_piMinHeight(e){this.piMinHeight=e,this._eElem&&this.sizeChanged()}set_piMinWidth(e){this.piMinWidth=e,this._eElem&&this.sizeChanged()}set_piColumnCount(e){this.piColumnCount=e,this._eElem&&this.sizeChanged(!0)}set_psRowHeights(e){this.psRowHeights=e,this._eElem&&this.sizeChanged(!0)}set_psColumnWidths(e){this.psColumnWidths=e,this._eElem&&this.sizeChanged(!0)}set_psBackgroundColor(e){this._eContainer&&(this._eContainer.style.background=e||"")}set_pbScroll(e){this._eElem&&(df.dom.toggleClass(this._eElem,"WebScroll",e),this.sizeChanged())}};class f extends(C(m)){}class w extends b{constructor(e,t){super(e,t),this.prop(df.tString,"psValue",""),this.prop(df.tBool,"pbChanged",!1),this.prop(df.tInt,"peDataType",df.ciTypeText),this.prop(df.tInt,"piPrecision",0),this.prop(df.tInt,"piMaxLength",0),this.prop(df.tBool,"pbCapslock",!1),this.prop(df.tBool,"pbRequired",!1),this.prop(df.tBool,"pbLimitDateRange",!0),this.prop(df.tInt,"peAlign",-1),this.prop(df.tString,"psMask",""),this.event("OnAutoFind",df.cCallModeDefault),this.event("OnChange",df.cCallModeDefault),this.event("OnValidate",df.cCallModeDefault),this._tValue=null,this._sOrigValue="",this._sPrevChangeVal=null,this._bValueInvalid=!1,this._bMasks=!0,this._oMask=null,this._bAutoFind=!1,this._bReplaceDecSepp=!1,this._oErrorBalloon=null,this._aErrors=[],this.addSync("psValue"),this.addSync("pbChanged")}afterRender(){this._bRendering=!0,super.afterRender();var e=this.psValue;this.set_peDataType(this.peDataType),this.set_psValue(e),this.set_pbCapslock(this.pbCapslock),this.set_peAlign(this.peAlign),this.set_pbRequired(this.pbRequired),df.dom.enableTextSelection(this._eControlWrp),this._eControl&&(df.dom.on("change",this._eControl,this.onChange,this),df.events.addDomKeyListener(this._eControl,this.onKey,this),df.dom.enableTextSelection(this._eControl)),this.updateErrorDisp(),this._bRendering=!1}destroy(){this._oErrorBalloon&&(this._oErrorBalloon.destroy(),this._oErrorBalloon=null),this._oMask&&(this._oMask.detach(),this._oMask=null),super.destroy()}attachFocusEvents(){this._eControl&&(df.dom.on("focus",this._eControl,this.onFocus,this),df.dom.on("blur",this._eControl,this.onBlur,this))}applyEnabled(e){super.applyEnabled(e),this._eControl&&(this._eControl.disabled=!e,df.dom.setTabIndex(this._eControl,e?0:-1))}get_pbChanged(){return!this.pbChanged&&this._eElem&&this.updateTypeVal(),this.pbChanged||this._sOrigValue!==this.getServerVal()}set_psValue(e){this._tValue=df.sys.data.serverToType(e,this.peDataType),this.psValue=e,this._sPrevChangeVal=this._sOrigValue=this.getServerVal(),this.refreshDisplay(this._tValue),this._bRendering||this.hideAllControlErrors()}get_psValue(){return this._eElem&&this.updateTypeVal(),this._bValueInvalid?this._sOrigValue:this.getServerVal()}set_peDataType(e,t){let i;this._eControl&&(t&&(i=this.get_psValue()),this.peDataType=e,this.initMask(),t&&this.set_psValue(i),df.dom.removeClass(this._eControl,"dfData_BCD dfData_Date dfDate_Text"),e===df.ciTypeBCD?df.dom.addClass(this._eControl,"dfData_BCD"):e===df.ciTypeDate?df.dom.addClass(this._eControl,"dfData_Date"):df.dom.addClass(this._eControl,"dfData_Text"))}set_psMask(e){this.updateTypeVal(),this.psMask=e,this.initMask(),this.refreshDisplay(this._tValue)}set_pbCapslock(e){this._eControl&&df.dom.toggleClass(this._eControl,"Web_Uppercase",e)}set_pbRequired(e){this._eElem&&df.dom.toggleClass(this._eElem,"Web_FieldRequired",e)}set_peAlign(e){this._eControl&&(this._eControl.style.textAlign=df.sys.gui.cssTextAlign(e))}refreshDisplay(e){if(this._eElem){const t=this.typeToDisplay(e);this.setControlValue(t)}}serverToType(e){return df.sys.data.serverToType(e,this.peDataType)}typeToDisplay(e){return df.sys.data.typeToDisplay(e,this.peDataType,this.getWebApp(),this._bHasFocus,this.psMask,this.piPrecision)}dateFormat(){return this.getWebApp().psDateFormat}dateTimeFormat(){return this.getWebApp().psDateTimeFormat}timeFormat(){return this.getWebApp().psTimeFormat}dateSep(){return this.getWebApp().psDateSeparator}decSep(){return this.getWebApp().psDecimalSeparator}thousSep(){return this.getWebApp().psThousandsSeparator}timeSep(){return this.getWebApp().psTimeSeparator}updateTypeVal(){let e=this.getControlValue();this.pbCapslock&&(e=e.toUpperCase()),this._bValueInvalid=!1,this.peDataType===df.ciTypeText&&this.psMask?this.psValue=this._tValue=this.clearWinMask(e):!this._bHasFocus&&this.psMask||(this.psValue=e,this.peDataType===df.ciTypeBCD?(this._tValue=df.sys.data.stringToNum(e,this.decSep(),this.thousSep()),isNaN(this._tValue)&&(this._tValue=0)):this.peDataType===df.ciTypeDate?(this._tValue=df.sys.data.stringToDate(e,this.dateFormat(),this.dateSep()),this._bValueInvalid=!this.validateDateRange(this._tValue)):this.peDataType===df.ciTypeDateTime?this._tValue=df.sys.data.stringToDate(e,this.dateTimeFormat(),this.dateSep(),this.timeSep()):this.peDataType===df.ciTypeTime?this._tValue=df.sys.data.stringToDate(e,this.timeFormat(),this.dateSep(),this.timeSep()):this._tValue=e)}validateDateRange(e){return!e||!this.pbLimitDateRange||e.getFullYear()<=2500&&e.getFullYear()>=1}getServerVal(){if(null!==this._tValue){if(this.peDataType===df.ciTypeBCD)return this._tValue.toString();if(this.peDataType===df.ciTypeDate)return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-")||"";if(this.peDataType===df.ciTypeDateTime)return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"yyyy/mm/ddThh:mm:ss.fff","-",":")||"";if(this.peDataType===df.ciTypeTime)return this._tValue instanceof Date&&df.sys.data.dateToString(this._tValue,"hh:mm:ss","-",":")||""}return this.psValue}getControlValue(){return this._eControl?this._eControl.value:this.psValue}setControlValue(e){this._eControl&&this._eControl.value!==e&&(this._eControl.value=e)}initMask(){this._bMasks&&this._eControl&&(this._oMask&&(this._oMask.detach(),this._oMask=null),this.peDataType===df.ciTypeBCD?this._oMask=this.genNumMask():this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime||this.peDataType===df.ciTypeTime?this._oMask=this.genDateMask(this.peDataType):this.peDataType===df.ciTypeText&&this.psMask&&(this._oMask=this.genWinMask(this.psMask)))}genWinMask(e){const t=this,i=[];for(let t=0;t<e.length;t++){const s=e.charAt(t);"\\"===s&&t+1<this.sMask.length&&("#"===e.charAt(t+1)||"@"===e.charAt(t+1)||"!"===e.charAt(t+1)||"*"===e.charAt(t+1))?(t++,i.push({bEnter:!1,bNumeric:!1,bAlpha:!1,bPunct:!1,sChar:e.charAt(t+1)})):i.push({bEnter:"#"===s||"@"===s||"!"===s||"*"===s,bNumeric:"#"===s||"*"===s,bAlpha:"@"===s||"*"===s,bPunct:"!"===s||"*"===s,sChar:s})}function s(e){let t,s,o;if(e.isKeyPrintable()){const n=o=this._eControl.value,r=df.dom.getSelection(this._eControl);t=r.start;const a=e.key();for(r.length>0&&(o=o.substr(0,r.start)+o.substr(r.end)),s=t;s<i.length&&!i[s].bEnter;)o.length<=s&&(o+=i[s].sChar),s++;o!==n&&(this._eControl.value=o),t!==s&&s<i.length&&(df.dom.setCaretPosition(this._eControl,s),t=s),(t>=i.length||!df.sys.data.acceptWinMaskChar(a,i[t].sChar))&&e.stop()}}function o(e){let t=0,s="",o=0;const n=this._eControl.value;for(let e=0;e<n.length&&t<i.length;e++){const o=n.charAt(e);i[t].bEnter?df.sys.data.acceptWinMaskChar(o,i[t].sChar)&&(s+=o,t++):(s+=i[t].sChar,t++)}if(e.inputIsInsert())for(;t<i.length&&!i[t].bEnter;)s+=i[t].sChar,t++,o++;if(s!==this._eControl.value){const e=df.dom.getCaretPosition(this._eControl);this._eControl.value=s,df.dom.setCaretPosition(this._eControl,e+o)}}return df.dom.on("keydown",this._eControl,s,this),df.dom.on("input",this._eControl,o,this),{clearVal(e){let t=0,s="";for(;t<e.length&&t<i.length;)(i[t].bEnter||e.charAt(t)!==i[t].sChar)&&(s+=e.charAt(t)),t++;return s},detach(){t._eControl&&(df.dom.off("keydown",t._eControl,s,t),df.dom.off("input",t._eControl,o,t))}}}clearWinMask(e){return this._oMask?this._oMask.clearVal(e):e}genDateMask(e){let t,i=null;const s=this;function o(){let s;s=e===df.ciTypeDateTime?this.dateTimeFormat():e===df.ciTypeTime?this.timeFormat():this.dateFormat();const o=this.dateSep(),n=this.timeSep(),r=s.match(/([^mdyhsf]+)|([mdyhsf]+)/gi)||[];let a="";t=[],r.forEach((function(e){let i={oNext:null,bVal:!0};switch(e.toLowerCase()){case"yyyy":i.iMax=4,a+="(\\d{1,4})?";break;case"dd":case"mm":case"yy":case"hh":case"ss":i.iMax=2,a+="(\\d{1,2})?";break;case"fff":i.iMax=3,a+="(\\d{1,3})?";break;default:i.bVal=!1,i.sText=e.replace("/",o).replace(":",n),i.iMax=i.sText.length,a+="(\\D{1"+(i.iMax>1?","+i.iMax:"")+"})?"}t.length&&(t[t.length-1].oNext=i),t.push(i)})),i=new RegExp(a,"")}function n(e){const s=i.exec(e);let o=0,n=!1;t.forEach((function(e,t){e.iStart=o,e.sVal=s[t+1]||"",e.sVal?(o+=e.sVal.length,e.bFound=!0):(n=!0,e.bFound=!1),e.bDirty=n,e.iEnd=o,e.bAdd=!1}))}function r(e){if(e.isKeyPrintable()){let i=!1,s=0;const o=e.key(),r=df.dom.getSelection(this._eControl),a=r.start,l=-1!=="0123456789".indexOf(o);let h=this._eControl.value;r.length>0&&(h=h.substr(0,r.start)+h.substr(r.end));const d=a==h.length;n(h);let p=t[0];for(;p.oNext&&p.iEnd<a;)p=p.oNext;if(d)if(l)if(p.bVal&&p.sVal.length<p.iMax)i=!0;else{for(p=p.oNext;p&&!p.bVal;)p.bAdd=!p.bFound,p=p.oNext;i=p&&p.bVal}else p.bVal&&p.sVal.length>0&&p.oNext&&(p=p.oNext,p.bVal||p.sText.charAt(0)!=o||(i=!0));else if(l)p.bVal?p.sVal.length<p.iMax&&(i=!0):p.iEnd==a&&p.oNext?(p=p.oNext,i=p.bVal&&p.sVal.length<p.iMax):p.bDirty&&(i=!0);else if(p.bVal&&p.sVal.length>0&&a-p.iStart>0&&a-p.iStart<=p.iMax&&p.oNext&&(p=p.oNext,!p.bVal&&p.sText.charAt(0)==o))if(p.bFound){let e=p.oNext;for(;e;)e.bVal||e.bFound||e.sText!=p.sText||(i=!0),e=e.oNext}else i=!0;if(t.reduce((function(e,t){return e||t.bAdd}),!1)){let e="";t.forEach((function(t){t.bVal?e+=t.sVal:(t.bFound||t.bAdd)&&(e+=t.sText,s+=t.sText.length-t.sVal.length)})),this._eControl.value=e}s&&df.dom.setCaretPosition(this._eControl,a+s),i||e.stop()}}function a(e){if(e.inputIsInsert()){let e=0;const i=df.dom.getSelection(this._eControl).start,s=this._eControl.value;n(s);let o="";t.forEach((function(t){t.bVal?o+=t.sVal:(t.bFound||t.oNext&&t.oNext.bFound)&&(o+=t.sText,e+=t.sText.length-t.sVal.length)})),o!==s&&(this._eControl.value=o,df.dom.setCaretPosition(this._eControl,i+e))}}return o.call(this),df.dom.on("focus",this._eControl,o,this),df.dom.on("keydown",this._eControl,r,this),df.dom.on("input",this._eControl,a,this),{detach(){s._eControl&&(df.dom.off("keydown",s._eControl,r,s),df.dom.off("input",s._eControl,a,s),df.dom.off("focus",s._eControl,o,s))}}}genNumMask(){let e,t,i,s;const o=this;function n(){e=this.decSep(),t=e+".,",s=this.piPrecision,i=this.piMaxLength-this.piPrecision}let r,a,l,h,d;function p(e){r=!1,a="",l=!1,h=0,d="";for(let o=0;o<e.length;o++){const n=e.charAt(o);-1!=="0123456789".indexOf(n)?!l&&a.length<i?a+=n:s>0&&d.length<s&&(d+=n):"-"==n?r=!0:-1!=t.indexOf(n)&&s>0&&(l=!0,h=o)}}function u(o){if(o.isKeyPrintable()){let n=!1,u=!1,c=0;const g=o.key(),_=df.dom.getSelection(this._eControl),m=_.start,b=-1!=="0123456789".indexOf(g),C=this._eControl.value;let f=C;_.length>0&&(f=f.substr(0,_.start)+f.substr(_.end));const w=m==f.length;p(f),b?!l||m<=h?a.length<i?(r&&0==m&&(c+=1),n=!0):w&&!l&&s>0&&(l=!0,u=!0,c+=1,n=!0):d.length<s&&(n=!0):"-"==g?0==m&&(r?c+=1:n=!0):-1!=t.indexOf(g)&&!l&&s>0&&(n=!0),u&&(f=(r?"-":"")+a+(l?e:"")+d,C!=f&&(this._eControl.value=f)),(c||u)&&df.dom.setCaretPosition(this._eControl,m+c),n||o.stop()}}function c(t){const i=df.dom.getSelection(this._eControl).start,s=this._eControl.value;p(s);let o=(r?"-":"")+a+(l?e:"")+d;o!==s&&(this._eControl.value=o,df.dom.setCaretPosition(this._eControl,i))}return n.call(this),df.dom.on("focus",this._eControl,n,this),df.dom.on("keydown",this._eControl,u,this),df.dom.on("input",this._eControl,c,this),{detach(){o._eControl&&(df.dom.off("keydown",o._eControl,u,o),df.dom.off("input",o._eControl,c,o),df.dom.off("focus",o._eControl,n,o))}}}validate(){let e,t=!0;return this.pbRequired&&(e=this.get_psValue(),this.peDataType===df.ciTypeBCD&&0===parseFloat(e)||""===e?(t=!1,this.showControlError(13,this.getWebApp().getTrans("err_entry_required"))):this.hideControlError(13)),this.peDataType===df.ciTypeDate&&(this.updateTypeVal(),this.validateDateRange(this._tValue)?this.hideControlError(16):(t=!1,this.showControlError(16,this.getWebApp().getTrans("err_enter_valid_date")))),t&&(this.fireChange(),this.fireAutoFind(),this.fire("OnValidate",[],(function(e){e.bServer?"0"===e.sReturnValue?this.selectAndFocus?this.selectAndFocus():this.focus():this.hideAllControlErrors():e.bCanceled&&(t=!1)}))),t}onKey(e){e.matchKey(df.settings.formKeys.tabOut)&&(this.validate()||e.stop())}updateFocus(e){super.updateFocus(e),e||(this.updateTypeVal(),this.fireAutoFind()),this.refreshDisplay(this._tValue)}fireChange(){this.updateTypeVal();const e=this.getServerVal();this._sPrevChangeVal!==e&&(this.pbChanged=!0,this.fire("OnChange",[e,this._sPrevChangeVal]),this._bAutoFind=!0,this._sPrevChangeVal=e)}fireAutoFind(){this._bAutoFind&&(this.fire("OnAutoFind"),this._bAutoFind=!1)}onChange(e){this.fireChange()}showControlError(e,t){e=parseInt(e,10);for(let i=0;i<this._aErrors.length;i++)if(this._aErrors[i].iNumber===e)return this._aErrors[i].sText=t,void this.updateErrorDisp();this._aErrors.push({iNumber:e,sText:t}),this.updateErrorDisp()}hideControlError(e){e=df.toInt(e);for(let t=0;t<this._aErrors.length;t++)if(this._aErrors[t].iNumber===e){this._aErrors.splice(t,1),this.updateErrorDisp();break}}hideAllControlErrors(){this._aErrors=[],this.updateErrorDisp()}updateErrorDisp(){const e=[];if(this._aErrors.length>0){this.makeVisible();for(let t=0;t<this._aErrors.length;t++)t>0&&e.push("<br>"),e.push(this._aErrors[t].sText);this._oErrorBalloon?(this._oErrorBalloon.psMessage=e.join(""),this._oErrorBalloon.update()):this._oErrorBalloon=new df.InfoBalloon(this,"WebErrorTooltip",e.join("")),this._oErrorBalloon.show(),this.getErrorElem()&&df.dom.addClass(this.getErrorElem(),"WebError"),this.focus()}else this._oErrorBalloon&&(this._oErrorBalloon.hide(),df.dom.removeClass(this.getErrorElem(),"WebError"))}getErrorElem(){return this._eElem}resize(){super.resize(),this._oErrorBalloon&&this._oErrorBalloon.resize()}}class S extends w{constructor(e,t){super(e,t),this.prop(df.tBool,"pbReadOnly",!1),this.prop(df.tString,"psAutoComplete","off"),this.event("OnKey",df.cCallModeDefault),this.event("OnInput",df.cCallModeDefault)}afterRender(){super.afterRender(),this.set_pbReadOnly(this.pbReadOnly),df.dom.on("keydown",this._eControl,this.onKeyDownSrv,this),df.dom.on("input",this._eControl,this.onInputSrv,this),this._eLbl&&this.peLabelPosition===df.ciLabelFloat&&(this.floatLabel(!1),df.dom.on("click",this._eLbl,this.onFocus,this),this.checkAutoFill())}initMask(){super.initMask(),this._eControl&&(this.peDataType!==df.ciTypeText||this.psMask?this._eControl.maxLength=1048576:this._eControl.maxLength=this.piMaxLength>0?this.piMaxLength:0)}set_pbReadOnly(e){this._eControl&&(this._eControl.readOnly=e,df.dom.toggleClass(this._eElem,"Web_ReadOnly",e))}set_piMaxLength(e){this.piMaxLength=e,this.initMask()}set_psAutoComplete(e){this._eControl&&(this._eControl.autocomplete=e)}set_peLabelPosition(e){this.peLabelPosition=e,this.posLabel(!1),this._eLbl&&(df.dom.off("click",this._eLbl,this.onFocus,this),e===df.ciLabelFloat&&(df.dom.on("click",this._eLbl,this.onFocus,this),this.floatLabel(!1)))}onKeyDownSrv(e){this.fire("OnKey",[df.fromBool(e.isKeyPrintable()),e.key()])}onInputSrv(e){this.fire("OnInput",[e.inputIsInsert(),e.e.inputType||"Undefined"])}updateFocus(e){super.updateFocus(e),this.peLabelPosition===df.ciLabelFloat&&this.floatLabel(e)}floatLabel(e){""!=this.getControlValue()||e&this.isEnabled()||this.matchSelector(this._eControl,":-webkit-autofill")?null!=this._eLbl&&(df.dom.addClass(this._eLbl,"WebCon_Float"),df.dom.removeClass(this._eLbl,"WebCon_Unfloat")):null!=this._eLbl&&(df.dom.addClass(this._eLbl,"WebCon_Unfloat"),df.dom.removeClass(this._eLbl,"WebCon_Float"))}setControlValue(e){super.setControlValue(e),this._eControl&&this.peLabelPosition===df.ciLabelFloat&&this.floatLabel(this._bHasFocus)}checkAutoFill(){const e=this;let t=20;!function i(){t--,e._eControl&&e.matchSelector(e._eControl,":-webkit-autofill")?e.floatLabel(!1):t>0&&setTimeout(i,100)}()}matchSelector(e,t){return!!df.sys.isChrome&&(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)}}class y extends f{constructor(e,t){super(e,t),this.prop(r.tInt,"peRegion",0),this.prop(r.tBool,"pbResizable",!1),this._eDivider=null,this._bWrapDiv=!0,this._sControlClass="WebPanel",this._bIsPanel=!0}afterRender(){super.afterRender(),this.set_pbResizable(this.pbResizable)}set_pbResizable(e){this._eElem&&(e&&this.peRegion!==r.ciRegionCenter?(this._eDivider||(this._eDivider=r.dom.create("<div></div>"),this._eElem.appendChild(this._eDivider),r.dom.on("mousedown",this._eDivider,this.onResize,this)),this._eDivider.className=this.peRegion===r.ciRegionLeft||this.peRegion===r.ciRegionRight?"WebPanel_DividerVertical":"WebPanel_DividerHorizontal",this._eDivider.style.right="",this._eDivider.style.left="",this._eDivider.style.top="",this._eDivider.style.bottom="",this.peRegion===r.ciRegionLeft?this._eDivider.style.right="0px":this.peRegion===r.ciRegionRight?this._eDivider.style.left="0px":this.peRegion===r.ciRegionBottom?this._eDivider.style.top="0px":this.peRegion===r.ciRegionTop&&(this._eDivider.style.bottom="0px")):this._eDivider&&(r.dom.off("mousedown",this._eDivider,this.onResize,this),this._eElem.removeChild(this._eDivider),this._eDivider=null))}set_peRegion(e){this._eElem&&this.peRegion!==e&&(this.peRegion=e,this.setOuterWidth(0),this.setOuterHeight(0),this.sizeChanged(!0),this.set_pbResizable(this.pbResizable))}onResize(e){let t,i,s=0,o=0;if(!this.isEnabled())return;const n=r.dom.create('<div class="'+(this.peRegion===r.ciRegionLeft||this.peRegion===r.ciRegionRight?"WebPanel_DividerVertical_Ghost":"WebPanel_DividerHorizontal_Ghost")+'"></div>'),a=r.gui.dragMask(this.topLayer()||document.body);this.peRegion===r.ciRegionTop||this.peRegion===r.ciRegionBottom?(a.style.cursor="n-resize",this.peRegion===r.ciRegionTop?(i=this._eElem.clientHeight,s=this.piMinHeight>2?this.piMinHeight:2,o=i+this._oParent._eMainArea.clientHeight,this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0&&(o-=this._oParent._oRegionCenter.piMinHeight)):(i=this._oParent._eMainArea.clientHeight,this._oParent._eRegionTop&&(i+=this._oParent._eRegionTop.clientHeight,s=this._oParent._eRegionTop.clientHeight),this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0&&(s+=this._oParent._oRegionCenter.piMinHeight),o=i+this._eElem.clientHeight-(this.piMinHeight>0?this.piMinHeight:0)-10),n.style.top=i+"px",this._oParent._eMainArea.parentNode.appendChild(n)):(a.style.cursor="e-resize",this.peRegion===r.ciRegionLeft?(t=this._eElem.clientWidth,s=this.piMinWidth>2?this.piMinWidth:2,o=t+this._oParent._eRegionCenter.clientWidth,this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0?o-=this._oParent._oRegionCenter.piMinWidth:o-=4):(t=this._oParent._eMainArea.clientWidth-this._eElem.clientWidth,this._oParent._eRegionLeft&&(s=this._oParent._eRegionLeft.clientWidth),this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0&&(s+=this._oParent._oRegionCenter.piMinWidth),o=t+this._eElem.clientWidth-(this.piMinWidth>0?this.piMinWidth:0)-10),n.style.left=t+"px",this._oParent._eMainArea.appendChild(n));const l=t,h=i,d=e.getMouseX(),p=e.getMouseY();function u(e){this.peRegion===r.ciRegionTop||this.peRegion===r.ciRegionBottom?(i=h-(p-e.getMouseY()),i=i<o?i>s?i:s:o,n.style.top=i+"px"):(t=l-(d-e.getMouseX()),t=t<o?t>s?t:s:o,n.style.left=t+"px")}function c(e){r.dom.off("mouseup",a,c,this),r.dom.off("mouseup",window,c,this),r.dom.off("mousemove",a,u,this),a.parentNode.removeChild(a),n&&n.parentNode.removeChild(n),this.peRegion===r.ciRegionTop?(this.piHeight=i,this._eElem.style.height=this.piHeight+"px"):this.peRegion===r.ciRegionBottom?(this.piHeight=this._eElem.clientHeight+(h-i),this._eElem.style.height=this.piHeight+"px"):this.peRegion===r.ciRegionLeft?(this.piWidth=t,this._eElem.style.width=this.piWidth+"px"):this.peRegion===r.ciRegionRight&&(this.piWidth=this._eElem.clientWidth+(l-t),this._eElem.style.width=this.piWidth+"px"),this.sizeChanged()}r.dom.on("mousemove",a,u,this),r.dom.on("mouseup",window,c,this),r.dom.on("mouseup",a,c,this),e.stop()}}class D extends f{constructor(e,t){super(e,t),this.prop(r.tInt,"piMaxWidth",0),this.prop(r.tInt,"piMinWidth",0),this.prop(r.tInt,"piMinHeight",0),this.prop(r.tString,"psCaption",""),this.prop(r.tBool,"pbShowCaption",!0),this.prop(r.tBool,"pbFocusFirstOnShow",!0),this.prop(r.tBool,"pbFillHeight",!1),this.event("OnSubmit",r.cCallModeWait),this.event("OnShow",r.cCallModeWait),this.event("OnHide",r.cCallModeDefault),this.event("OnResizeWindow",r.cCallModeDefault),this.setActionMode("HandleDeleteKey",r.cCallModeWait),this.setActionMode("HandleSaveKey",r.cCallModeWait),this._oCurrentObj=null,this._eRenderTo=null,this._bRendered=!1,this._bIsView=!0,this.pbScroll=!0}show(){this._bStandalone?this._show():this.getWebApp().showView(this._sName,!1)}hide(){this._bStandalone?this._hide(!1):this.getWebApp().hideView(this._sName)}windowResize(e,t){this._bRendered?this.fire("OnResizeWindow",[e,t],(function(){this.centerWindow()})):this._bFireOnResize=!0}centerWindow(){}setOuterWidth(e){}getInvoking(){if(this.psInvokingView){const e=this.getWebApp();if(e[this.psInvokingView]instanceof D)return e[this.psInvokingView]}return null}returnFocus(){this._oCurrentObj?this._oCurrentObj.conditionalFocus():this.conditionalFocus()}objFocus(e){this._oCurrentObj=e}set_piHeight(e){this.piHeight=e,(e=e>this.piMinHeight?e:this.piMinHeight)>0&&this._eElem&&this.setInnerHeight(e),this.sizeChanged()}set_psCaption(e){this.psCaption=e,this.updateCaption()}set_pbShowCaption(e){this.pbShowCaption=e,this.updateCaption()}updateCaption(){this._eElem&&(this._eLbl.style.display=this.pbShowCaption?"":"none",r.dom.setText(this._eLbl,this.psCaption))}fireSubmit(){return this.getWebApp()._oCurrentObj&&this.getWebApp()._oCurrentObj.validate&&this.getWebApp()._oCurrentObj.validate(),this.fire("OnSubmit")}onKey(e){e.matchKey(r.settings.formKeys.submit)&&this.fireSubmit()&&e.stop()}getView(){return this}}class v extends D{constructor(e,t){super(e,t),this.prop(r.tBool,"pbResizable",!0),this.prop(r.tBool,"pbShowClose",!0),this.prop(r.tInt,"piLeft",0),this.prop(r.tInt,"piTop",0),this._bHasLeft=!1,this._bHasTop=!1,this._eMask=null,this._oPrevFocus=null,this.pbModal=!1,this._bWrapDiv=!1,this._sBaseClass="WebWindow"}create(){this._bHasLeft=this.piLeft>0,this._bHasTop=this.piTop>0}genClass(){return this._sBaseClass="WebWindow"+(this.pbResizable?" WebWin_Resizable":""),super.genClass()}openHtml(e){e.push('<dialog class="',this.genClass(),'"'),this.psHtmlId&&e.push(' id="',this.psHtmlId,'"'),e.push(' data-dfobj="',this.getLongName(),'"'),e.push(' style=" ',this.pbRender?"":"display: none;",this.pbVisible?"":"visibility: hidden;",'top:10px;"'),e.push(">"),e.push('<div class="WebWin_top_l">','<div class="WebWin_top_r">','<div class="WebWin_top_c">',"</div>","</div>","</div>",'<div class="WebWin_main_l">','<div class="WebWin_main_r">','<div class="WebWin_header">','<div class="WebWin_header_r">','<div class="WebWin_header_c">'),e.push('             <label class="WebWin_title"',this.pbShowCaption?"":'style="display: none"',">",r.dom.encodeHtml(this.psCaption),"</label>"),e.push('<div class="WebWin_controls">'),e.push('<div class="WebWin_close" tabindex="0"',this.pbShowClose?"":' style="display:none"',"></div>"),e.push("</div>",'<div style="clear: both;"></div>',"</div>","</div>","</div>",'<div class="WebWin_main_c">','<div class="WebContainer">'),super.openHtml(e)}closeHtml(e){super.closeHtml(e),e.push("</div>","</div>","</div>","</div>",'<div class="WebWin_bottom_l">','<div class="WebWin_bottom_r">','<div class="WebWin_bottom_c">',"</div>",'<div class="WebWin_resizer">',"</div>","</div>","</dialog>")}afterRender(){this._eLbl=r.dom.query(this._eElem,"label.WebWin_title"),this._eHeader=r.dom.query(this._eElem,"div.WebWin_header"),this._eHeaderContent=r.dom.query(this._eElem,"div.WebWin_header_c"),this._eControlWrap=r.dom.query(this._eElem,"div.WebWin_main_c"),this._eMainRight=r.dom.query(this._eElem,"div.WebWin_main_r"),this._eMainLeft=r.dom.query(this._eElem,"div.WebWin_main_l"),this._eTopLeft=r.dom.query(this._eElem,"div.WebWin_top_l"),this._eTopRight=r.dom.query(this._eElem,"div.WebWin_top_r"),this._eTopContent=r.dom.query(this._eElem,"div.WebWin_top_c"),this._eBottomLeft=r.dom.query(this._eElem,"div.WebWin_bottom_l"),this._eBottomRight=r.dom.query(this._eElem,"div.WebWin_bottom_r"),this._eResizer=r.dom.query(this._eElem,"div.WebWin_resizer"),this._eBottomContent=r.dom.query(this._eElem,"div.WebWin_bottom_c"),this._eCloseBtn=r.dom.query(this._eElem,"div.WebWin_close"),super.afterRender(),this.set_piHeight(this.piHeight),this.set_piWidth(this.piWidth),r.dom.on("mousedown",this._eHeader,this.onStartDrag,this),r.dom.on("mousedown",this._eMainRight,this.onStartResize,this),r.dom.on("mousedown",this._eMainLeft,this.onStartResize,this),r.dom.on("mousedown",this._eTopLeft,this.onStartResize,this),r.dom.on("mousedown",this._eBottomLeft,this.onStartResize,this),r.dom.on("mousedown",this._eCloseBtn,(function(e){e.stop()}),this),r.dom.on("click",this._eCloseBtn,this.onCloseClick,this),this._bStandalone&&r.dom.on("resize",window,this.onWindowResize,this),r.events.addDomKeyListener(this._eElem,this.onKey,this)}_show(e){const t=!this._eElem,i=this.getWebApp();if(this.fireEx({sEvent:"OnShow"}),t){const e=this.render();r.dom.addClass(e,"WebWin_Hidden")}this._oPrevFocus=i._oCurrentObj,this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem),this._eRenderTo=e=e||i?._eViewPort||document.body,e.appendChild(this._eElem),r.dom.removeClass(this._eElem,"WebWin_Hidden"),this.pbModal?this._eElem.showModal():this._eElem.show(),t&&this.afterRender(),this._bRendered=!0,this.pbFloating&&(this.resize(),this.centerWindow()),this.afterShow(),this._oCurrentObj=null,i&&i.objFocus(this),setTimeout((()=>{if(i&&this._bRendered){r.dom.addClass(this._eElem,"WebWin_Visible"),this.pbFocusFirstOnShow&&!this._oCurrentObj&&this.conditionalFocus(!0);const e=document.activeElement.closest("[data-dfobj]");if(e){const t=this.getWebApp().findObj(e.dataset.dfobj);t instanceof b&&t.updateFocus(!0)}i.OnShowWindow.fire(i,{oWindow:this,eElem:this._eElem,bModal:this.pbModal})}}),20)}_hide(e){const t=this.getWebApp();let i=!1;if(this._bRendered){e||this.fire("OnHide",[]);const s=this.getInvoking()||t._oCurrentWindow;s?s.returnFocus():this._oPrevFocus&&this._oPrevFocus.conditionalFocus(),this._eRenderTo=null,this._eElem.close(),r.dom.addClass(this._eElem,"WebWin_Hidden"),r.dom.removeClass(this._eElem,"WebWin_Visible"),t&&(i=!t.OnHideWindow.fire(t,{oWindow:this,eElem:this._eElem,bModal:this.pbModal}))}this._bRendered=!1,this.afterHide(),this._bStandalone&&(i?setTimeout((()=>{this._eElem&&this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem)}),5e3):this._eElem&&this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem))}set_pbResizable(e){this._eElem&&r.dom.toggleClass(this._eElem,"WebWin_Resizable",e)}set_pbShowClose(e){this._eCloseBtn&&(this._eCloseBtn.style.display=e?"":"none")}set_piWidth(e){let t;e=e>this.piMinWidth?e:this.piMinWidth,this.piWidth=e,t=e>0?parseInt(e,10)+"px":"",this._eControlWrap&&(this._eControlWrap.style.width=t,this._eHeader.style.width=t,this._eElem&&e>0&&this.setOuterWidth(e))}set_piHeight(e){super.set_piHeight(e),this._eElem&&e>0&&this.setOuterHeight(e)}set_piTop(e){this._bHasTop=!0,this._eElem&&(this._eElem.style.top=parseInt(e,10)+"px")}set_piLeft(e){this._bHasLeft=!0,this._eElem&&(this._eElem.style.left=parseInt(e,10)+"px")}createGhost(){let e,t,i,s,o,n=[];return o=this.psHtmlId,this.psHtmlId="",this._bWrapDiv=!1,this.openHtml(n),this.closeHtml(n),this._bWrapDiv=!0,this.psHtmlId=o,e=r.dom.create(n.join("")),e.className=this.genClass()+" WebWin_ghost",this._eElem.parentNode.appendChild(e),r.dom.disableTextSelection(e),t=r.dom.query(e,".WebWin_main_c"),i=r.dom.query(e,".WebWin_header"),s=r.sys.gui.getSize(this._eControlWrap),i.style.width=s.width+"px",t.style.width=s.width+"px",t.style.height=s.height+"px",e.style.top=this.piTop+"px",e.style.left=this.piLeft+"px",e.showModal(),e}onStartDrag(e){let t,i,s,o,n,a,l;function h(e){this.piTop=e.getMouseY()-a,this.piLeft=e.getMouseX()-l,this.piTop=this.piTop<=0?1:this.piTop>=o?o:this.piTop,this.piLeft=this.piLeft<=0?1:this.piLeft>=n?n:this.piLeft,i.style.top=this.piTop+"px",i.style.left=this.piLeft+"px"}function d(e){r.dom.off("mouseup",t,d,this),r.dom.off("mouseup",window,d,this),r.dom.off("mousemove",t,h,this),t.parentNode.removeChild(t),i&&this._eElem.parentNode.removeChild(i),this._eElem.style.top=this.piTop+"px",this._eElem.style.left=this.piLeft+"px",this._eElem.classList.remove("Web_Moving"),this.resize()}this.isEnabled()&&(a=e.getMouseY()-this.piTop,l=e.getMouseX()-this.piLeft,s=r.sys.gui.getSize(this._eElem),this._eCloseBtn&&this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>s.width&&(s.width=this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth),n=this.getViewportWidth()-s.width-1,o=this.getViewportHeight()-s.height-1,i=this.createGhost(),this._eElem.classList.add("Web_Moving"),t=r.gui.dragMask(),i.appendChild(t),t.style.cursor="move",r.dom.on("mouseup",t,d,this),r.dom.on("mouseup",window,d,this),r.dom.on("mousemove",t,h,this))}onStartResize(e){if(this.pbResizable&&this.isEnabled()){const t=e.getTarget();t===this._eMainRight?(this.resizeDrag(e,!0,!1,!1,!1,"e-resize"),e.stop()):t===this._eMainLeft?(this.resizeDrag(e,!0,!0,!1,!1,"e-resize"),e.stop()):t===this._eTopRight?(this.resizeDrag(e,!0,!1,!0,!0,"ne-resize"),e.stop()):t===this._eTopLeft?(this.resizeDrag(e,!0,!0,!0,!0,"nw-resize"),e.stop()):t===this._eTopContent?(this.resizeDrag(e,!1,!1,!0,!0,"n-resize"),e.stop()):t===this._eBottomRight||t===this._eResizer?(this.resizeDrag(e,!0,!1,!0,!1,"nw-resize"),e.stop()):t===this._eBottomLeft?(this.resizeDrag(e,!0,!0,!0,!1,"ne-resize"),e.stop()):t===this._eBottomContent&&(this.resizeDrag(e,!1,!1,!0,!1,"n-resize"),e.stop())}}resizeDrag(e,t,i,s,o,n){let a,l,h,d,p,u,c,g,_,m,b,C,f=0;function w(e){t&&(i?(this.piWidth=u-(e.getMouseX()-g),this.piWidth=this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth,this.piLeft=c-(this.piWidth-u)):(this.piWidth=u+(e.getMouseX()-g),this.piWidth=this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth,this.piWidth+this.piLeft>this.getViewportWidth()-f&&(this.piWidth=this.getViewportWidth()-f-this.piLeft)),l.style.left=this.piLeft+"px",h.style.width=this.piWidth+"px",d.style.width=this.piWidth+"px"),s&&(o?(this.piHeight=_-(e.getMouseY()-m),this.piHeight=this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight,this.piTop=b-(this.piHeight-_)):(this.piHeight=_+(e.getMouseY()-m),this.piHeight=this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight),l.style.top=this.piTop+"px",h.style.height=this.piHeight+"px")}function S(e){r.dom.off("mouseup",a,S,this),r.dom.off("mouseup",window,S,this),r.dom.off("mousemove",a,w,this),a.parentNode.removeChild(a),l&&this._eElem.parentNode.removeChild(l),C&&r.sys.gui.restorePlugins(C),this._eControlWrap.style.width=this.piWidth+"px",this._eHeader.style.width=this.piWidth+"px",this._eElem.style.left=this.piLeft+"px",this._eElem.style.top=this.piTop+"px",this._eElem.classList.remove("Web_Resizing"),this.setOuterHeight(this.piHeight),this.resize()}p=r.sys.gui.getSize(this._eControlWrap),u=p.width,g=e.getMouseX(),c=this.piLeft,_=p.height,m=e.getMouseY(),b=this.piTop,this.piHeight=this.piHeight>0?this.piHeight:this._eControlWrap.clientHeight,this._eCloseBtn&&this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>p.width&&(f=this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth-p.width),l=this.createGhost(),h=r.dom.query(l,".WebWin_main_c"),d=r.dom.query(l,".WebWin_header"),this._eElem.classList.add("Web_Resizing"),a=r.gui.dragMask(),l.appendChild(a),a.style.cursor=n,r.dom.on("mousemove",a,w,this),r.dom.on("mouseup",window,S,this),r.dom.on("mouseup",a,S,this)}getViewportElem(){return this.pbFloating&&this.pbModal?document.body:this._eRenderTo}blur(){}doClose(){this.pbShowClose&&this.hide()}resize(){this._bRendered&&(!this._eControlWrap||this.piHeight||this.piWidth||(this.piHeight=r.dom.clientHeight(this._eControlWrap),this.piWidth=r.dom.clientWidth(this._eControlWrap),this._eControlWrap.style.width=this.piWidth+"px",this._eHeader.style.width=this.piWidth+"px",this._eControlWrap.style.height=this.piHeight+"px"),this.resizeHorizontal(),this.resizeVertical())}setOuterHeight(e){e>0?(this._eControlWrap.style.height=e+"px",e-=this.getHeightDiff(!0,!0,!1,!1),this._eContainer.style.height=e+"px"):(this._eControlWrap.style.height="",this._eContainer.style.height="")}viewResize(e){let t,i;this.prepareSize(),t=r.dom.offsetHeight(this._eHeader)+r.dom.offsetHeight(this._eBottomLeft),e=r.dom.windowHeight()-20,i=this.piHeight<=0?this._iWantedHeight:this.piHeight,i>0&&i+t<e?this.setOuterHeight(i):this.setOuterHeight(e-t),this.resize()}getViewportWidth(){return r.sys.gui.getViewportWidth()}getViewportHeight(){return r.sys.gui.getViewportHeight()}onCloseClick(e){this.isEnabled()&&this.doClose()}onKey(e){e.matchKey(r.settings.formKeys.escape)?this.doClose():super.onKey(e)}onWindowResize(e){this.centerWindow()}centerWindow(){this._bRendered&&this._eElem&&(this._bHasTop||(this.piTop=this.getViewportHeight()/2-(this._eElem.clientHeight||this.piHeight)/2,r.sys.isMobile&&(this.piTop=.65*this.piTop),this.piTop=this.piTop>0?this.piTop:0),this._bHasLeft||(this.piLeft=this.getViewportWidth()/2-(this._eElem.clientWidth||this.piWidth)/2,this.piLeft=this.piLeft>0?this.piLeft:0),this._eElem.style.top=parseInt(this.piTop,10)+"px",this._eElem.style.left=parseInt(this.piLeft,10)+"px")}}class R extends v{constructor(e,t){super(e,t),this.event("OnEscape",r.cCallModeWait),this.pbFloating=!0,this.pbModal=!0,this.pbScroll=!1,this.psFloatByControl=null}doClose(){this.fire("OnEscape")||super.doClose()}floatByControl(){const e=this.getWebApp().findObj(this.psFloatByControl),t=r.sys.gui.getBoundRect(e._eElem);let i,s;s=this.piLeft,i=this.piTop,this.piTop=t.bottom,this.piLeft=t.left,this._eElem.style.top=this.piTop+"px",this._eElem.style.left=this.piLeft+"px",r.sys.gui.isElementFullyOnScreen(this._eElem)||(this.piTop=i,this.piLeft=s,this._eElem.style.top=i+"px",this._eElem.style.left=s+"px")}topLayer(){return this._eElem}}class W extends b{constructor(e,t){super(e,t),this.prop(r.tString,"psCaption",""),this.prop(r.tInt,"peAlign",0),this.prop(r.tBool,"pbShowBorder",!1),this.prop(r.tInt,"peWordBreak",r.wbPreWrap),this.pbShowLabel=!1,this._bFocusAble=!1,this._sControlClass="WebLabel"}openHtml(e){super.openHtml(e),e.push('<div class="WebLabel_content ',r.classWordBreak(this.peWordBreak),'">&nbsp;</div>')}closeHtml(e){super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebLabel_content"),super.afterRender(),this.set_peAlign(this.peAlign),this.set_psCaption(this.psCaption),this.set_pbShowBorder(this.pbShowBorder)}set_psCaption(e){this._eControl&&(r.dom.setText(this._eControl,e),e!==this.psCaption&&this.sizeChanged())}set_peWordBreak(e){this._eControl&&(r._eControl.className="WebLabel_content "+r.classWordBreak(e))}set_pbShowBorder(e){this._eControl&&(r.dom.toggleClass(this._eControl,"WebLabel_border",e),this.pbShowBorder!==e&&this.sizeChanged())}set_peAlign(e){this._eControl&&(this._eControl.style.textAlign=e===r.ciAlignLeft?"left":e===r.ciAlignCenter?"center":e===r.ciAlignRight?"right":"")}}class I extends b{constructor(e,t){super(e,t),this.prop(r.tInt,"piMaxValue",100),this.prop(r.tInt,"piValue",0),this.prop(r.tBool,"pbShowPercentage",!0),this.prop(r.tString,"psCaption",""),this.prop(r.tInt,"piDecimals",""),this._eProgressBarWrp=null,this._eProgress=null,this._ePercentage=null,this.piColumnSpan=0,this.pbShowLabel=!1,this._sControlClass="WebProgressBar"}openHtml(e){super.openHtml(e),e.push('<div class="WebPB_Wrp',this.pbShowPercentage||this.psCaption?" WebPB_ShowPercentage":"",'">'),e.push("<div>"),e.push('<div class="WebPB_Progress"></div>'),""!==this.psCaption?e.push('<div class="WebPB_Percentage">',r.dom.encodeHtml(this.psCaption),"</div>"):e.push('<div class="WebPB_Percentage"></div>')}closeHtml(e){e.push("</div></div>"),super.closeHtml(e)}afterRender(){this._eProgressBarWrp=r.dom.query(this._eElem,".WebPB_Wrp"),this._eProgress=r.dom.query(this._eElem,".WebPB_Progress"),this._ePercentage=r.dom.query(this._eElem,".WebPB_Percentage"),this.set_piValue(this.piValue),super.afterRender()}getPercentage(e){let t=this.piDecimals;void 0!==e&&(t=e),t=Math.pow(10,t);const i=this.piValue/this.piMaxValue*100;return Math.round(i*t)/t}set_piValue(e){this._eProgress&&(e=e>=0?e<=this.piMaxValue?e:this.piMaxValue:0,this.piValue=e,this._eProgress.style.width=this.getPercentage(2)+"%",r.dom.toggleClass(this._eProgress,"WebPB_Zero",0===e),this.psCaption||r.dom.setText(this._ePercentage,this.getPercentage()+"%"))}set_pbShowPercentage(e){this._ePercentage&&r.dom.toggleClass(this._eProgressBarWrp,"WebPB_ShowPercentage",e||this.psCaption)}set_psCaption(e){this._ePercentage&&(this.psCaption=e,r.dom.toggleClass(this._eProgressBarWrp,"WebPB_ShowPercentage",e||this.pbShowPercentage),e?r.dom.setText(this._ePercentage,e):this.set_piValue(this.piValue))}set_piMaxValue(e){this.piMaxValue=e,this.set_piValue(this.piValue)}}class M extends b{constructor(e,t){super(e,t),this.prop(df.tString,"psCaption",""),this.prop(df.tString,"psTextColor",""),this.prop(df.tString,"psWaitMessage",""),this.prop(df.tBool,"pbShowWaitDialog",!1),this.prop(df.tInt,"peAlign",-1),this.event("OnClick",df.cCallModeWait),this.pbShowLabel=!1,this._sControlClass="WebButton",this._bJSSizing=!1}create(){super.create(),this.set_pbShowWaitDialog(this.pbShowWaitDialog)}openHtml(e){super.openHtml(e),e.push('<button id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled"'),this.peAlign>=0&&e.push(' style="text-align: ',df.sys.gui.cssTextAlign(this.peAlign),'"'),e.push(">",df.dom.encodeHtml(this.psCaption),"</button>")}afterRender(){this._eControl=df.dom.query(this._eElem,"button"),super.afterRender(),df.dom.on("click",this._eControl,this.onBtnClick,this),df.events.addDomKeyListener(this._eElem,this.onKey,this)}onBtnClick(e){let t=null,i=!1;const s=this._eElem;this.isEnabled()&&(df.dom.addClass(s,df.CssHit),t=setTimeout((function(){i&&df.dom.removeClass(s,df.CssHit),t=null}),df.hitTimeout),this.fire("OnClick",[],(function(e){e.bCanceled||this.psLoadViewOnClick&&this.getWebApp().showView(this.psLoadViewOnClick,!1),t||df.dom.removeClass(s,df.CssHit),i=!0})),e.stop())}applyEnabled(e){super.applyEnabled(e),this._eControl&&(this._eControl.disabled=!e)}set_psCaption(e){this._eControl&&(df.dom.setText(this._eControl,e),this.sizeChanged())}set_pbShowWaitDialog(e){this.setActionMode("OnClick",e?df.cCallModeProgress:df.cCallModeWait,this.psWaitMessage)}set_psWaitMessage(e){this.setActionMode("OnClick",this.pbShowWaitDialog?df.cCallModeProgress:df.cCallModeWait,e)}onKey(e){e.matchKey(df.settings.formKeys.submit)&&e.stopPropagation()}set_peAlign(e){this._eControl&&(this._eControl.style.textAlign=df.sys.gui.cssTextAlign(e))}}class T extends b{constructor(e,t){super(e,t),this.prop(r.tInt,"piHeight",0),this.prop(r.tInt,"piMinHeight",0),this._sControlClass="WebSpacer",this._bFocusAble=!1}openHtml(e){super.openHtml(e),e.push('<div class="WebSpacer_Spacer">')}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebSpacer_Spacer"),super.afterRender()}}class H extends b{constructor(e,t){super(e,t),this.prop(r.tString,"psUrl",""),this.prop(r.tBool,"pbShowBorder",!0),this.event("OnLocationChange",r.cCallModeDefault),this._eWrapper=null,this._sContentHtml=null,this._sControlClass="WebIFrame"}openHtml(e){super.openHtml(e);const t="df_webiframe_"+r.dom.piDomCounter++;e.push('<div class="WebIFrm_Wrp"><iframe name="',t,'" scrolling="auto" frameborder="no"></iframe></div>')}afterRender(){this._eControl=r.dom.query(this._eElem,"iframe"),this._eWrapper=r.dom.query(this._eElem,"div.WebIFrm_Wrp"),super.afterRender(),r.dom.on("load",this._eControl,this.onFrameLoad,this),this.set_pbShowBorder(this.pbShowBorder),this.set_psUrl(this.psUrl),null!=this._sContentHtml&&this.writeHtmlContent()}onFrameLoad(e){const t=this._eControl.contentWindow.location.href;t&&this.psUrl!==t&&(this.psUrl=t,this.addSync("psUrl"),this.fire("OnLocationChange",[t]))}set_psUrl(e){this._eControl&&(this._eControl.src=e)}set_pbShowBorder(e){this._eWrapper&&r.dom.toggleClass(this._eWrapper,"WebIFrm_Box",e)}setHeight(e,t){this._eControl&&(e>0?(e=(e-=this.getVertHeightDiff())<0?0:e,this._eWrapper.style.height=e+"px"):this._eWrapper.style.height="80px")}getVertHeightDiff(){let e=super.getVertHeightDiff();return e+=r.sys.gui.getVertBoxDiff(this._eWrapper),e}setHtmlContent(e){this._sContentHtml=e,this.writeHtmlContent()}writeHtmlContent(){this._eControl&&(this._eControl.contentWindow.document.open("text/htmlreplace"),this._eControl.contentWindow.document.write(this._sContentHtml),this._eControl.contentWindow.document.close())}}class E extends b{constructor(e,t){super(e,t),this.prop(r.tBool,"pbScroll",!0),this.prop(r.tString,"psHtml",""),this.prop(r.tBool,"pbShowBorder",!1),this.event("OnClick",r.cCallModeWait),this._sControlClass="WebHtmlBox",this._bFocusAble=!1}openHtml(e){super.openHtml(e),e.push('<div class="WebHtml_Wrp">')}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebHtml_Wrp"),super.afterRender(),this.set_piHeight(this.piHeight),this.set_pbShowBorder(this.pbShowBorder),r.dom.on("click",this._eControl,this.onHtmlClick,this),this.updateHtml(this.psHtml)}updateHtml(e){this.psHtml=e,this._eControl&&(this._eControl.innerHTML=this.psHtml,this.sizeChanged())}appendHtml(e){this.psHtml+=e,this._eControl&&(this._eControl.innerHTML=this.psHtml,this.sizeChanged())}prependHtml(e){this.psHtml=e+this.psHtml,this._eControl&&(this._eControl.innerHTML=this.psHtml,this.sizeChanged())}updateHtmlArray(){const e=r.sys.vt.deserialize(this._tActionData,[r.tString]);this.updateHtml(e.join(""))}set_pbScroll(e){this._eControl&&(this._eControl.style.overflowY=this.pbFillHeight||this.piHeight>0?e?"auto":"hidden":"visible",this._eControl.style.overflowX=e?"auto":"")}set_pbShowBorder(e){this._eControl&&r.dom.toggleClass(this._eControl,"WebHtml_Box",e)}set_piHeight(e){this._eControl&&(super.set_piHeight(e),this.piHeight=e,this.set_pbScroll(this.pbScroll))}set_psHtml(e){this.updateHtml(e)}set_pbFillHeight(e){super.set_pbFillHeight(e),this.pbFillHeight=e,this.set_pbScroll(this.pbScroll)}onHtmlClick(e){let t=e.getTarget();for(;t&&t!==this._eControl;)t.getAttribute("data-ServerOnClick")&&this.fire("OnClick",[t.getAttribute("data-ServerOnClick"),t.getAttribute("data-OnClickParam")||""]),t=t.parentNode}}class x extends f{constructor(){super("oWebApp",null),this.pbViewApp=!1,this.prop(df.tString,"psTheme","string"==typeof sDfPreloadTheme&&sDfPreloadTheme||"Df_Web_Creme"),this.prop(df.tString,"psVersionID",""),this.prop(df.tString,"psDecimalSeparator",","),this.prop(df.tString,"psThousandsSeparator","."),this.prop(df.tString,"psDateFormat","dd/mm/yyyy"),this.prop(df.tString,"psDateSeparator","-"),this.prop(df.tString,"psDateTimeFormat","dd/mm/yyyy hh:mm:ss"),this.prop(df.tString,"psTimeFormat","hh:mm:ss"),this.prop(df.tString,"psTimeSeparator",":"),this.prop(df.tString,"psCurrencySymbol","$"),this.prop(df.tInt,"peAlignView",df.ciAlignCenter),this.prop(df.tInt,"piScreenWidth",screen.width),this.prop(df.tInt,"piScreenHeight",screen.height),this.prop(df.tInt,"piWindowWidth",0),this.prop(df.tInt,"piWindowHeight",0),this.prop(df.tInt,"peMode",0),this.prop(df.tBool,"pbResponsive",!0),this.prop(df.tBool,"pbIsMobile",!0),this.prop(df.tString,"psLocationHash",""),this.prop(df.tAdv,"pasBrowserLanguages",null),this.prop(df.tInt,"piBrowserTimezoneOffset",0),this.prop(df.tBool,"pbUpdateApplicationTitle",!0),this.prop(df.tString,"psApplicationTitle",""),this.event("OnOrientationChange",df.cCallModeWait),this.event("OnResizeWindow",df.cCallModeDefault),this.OnError=new df.events.JSHandler,this.OnShowProgress=new df.events.JSHandler,this.OnShowWindow=new df.events.JSHandler,this.OnHideWindow=new df.events.JSHandler,this.OnHideProgress=new df.events.JSHandler,this._oPreLoaded={},this._oModeControl=new u(this),this._oMenuHub=null,this._aSyncPropCache=[],this._aAdvSyncPropCache=[],this._oCurrentWindow=null,this._oCurrentView=null,this._oCurrentObj=null,this._aViews=[],this._aFocussed=[],this._bReady=!1,this._aLoadQueue=[],this._oLoadViewQueue={},this._aPreLoadViewActions=[],this._bInitStarted=!1,this._bCallTimeout=!1,this._oPendingCall=null,this._oSendingCall=null,this._eLocked=-1,this._aLockwaiters=[],this._eStyleSystem=null,this._eStyleTheme=null,this._eStyleApplication=null,this._sRootPath=df.psRootPath||"",this._oTranslations={},this._aModalQueue=[],this._tResizeTimer=null,this._bSizeChanged=!1,this._bContainerStretch=!1,this._aResponseAttachments=null,this._bIsBaseApp=!0,this._bWrapDiv=!0,this._sControlClass="WebApp",this._eViewPort=null,this.addSync("peMode"),this.addSync("pbIsMobile"),this.addSync("piScreenWidth"),this.addSync("piScreenHeight"),this.addSync("piWindowWidth"),this.addSync("piWindowHeight"),this.addSync("psLocationHash"),this.addSync("pasBrowserLanguages"),this.addSync("piBrowserTimezoneOffset"),this.setActionMode("loadView",df.cCallModeWait),this.ready(this.attachGlobalHandlers),df.log("DataFlex Web Application Framework "+df.psVersionId),df.log("Copyright 2005-2025 Data Access Corporation. All rights reserved.")}create(){super.create(),this.set_pbResponsive(this.pbResponsive)}attachGlobalHandlers(){df.dom.on("resize",window,this.onWindowResize,this),df.dom.on("scroll",window,this.onScroll,this),df.dom.on("orientationchange",window,this.onOrientationChange,this),df.dom.on("popstate",window,this.onPopState,this),df.dom.on("hashchange",window,this.onHashChange,this),this.piScreenHeight=screen.height,this.piScreenWidth=screen.width}destroy(){df.dom.off("resize",window,this.onWindowResize,this),df.dom.off("scroll",window,this.onScroll,this),df.dom.off("orientationchange",window,this.onOrientationChange,this),super.destroy(),this._oModeControl&&(this._oModeControl.destroy(),this._oModeControl=null)}addChild(e){if(e instanceof D)this._aViews.push(e);else{if(e.peRegion===df.ciRegionCenter)throw new df.Error(999,"The 'oWebApp' object should not have panels set to the center region, this space is reserved for the WebView.",this,[e.getLongName()]);super.addChild(e)}}updateEnabled(){super.updateEnabled();for(let e=0;e<this._aViews.length;e++)this._aViews[e]instanceof m&&this._aViews[e].updateEnabled()}placePanels(){super.placePanels(),this.pbViewApp&&(this._eViewRegion||(this._eViewRegion=df.dom.create('<div class="BaseApp_ViewRegion" style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px"></div>')),this._eRegionCenter=this._eViewRegion,this._eRegionCenter.parentNode==this._eMainArea&&this._eRegionCenter.nextElementSibling==this._eMainArea.lastChild||this._eMainArea.insertBefore(this._eRegionCenter,this._eMainArea.lastChild))}initialize(e){this._bInitStarted=!0;try{this.checkBrowser()&&this.serverAction("LoadWebApp",[df.fromBool(!!e)],null,(function(e){this.updateCSS(!1),df.dom.ready((function(){this.testCSS((function(){this._bCallTimeout=!0;try{this._bReady=!0;for(let e=0;e<this._aLoadQueue.length;e++)this._aLoadQueue[e].fHandler.call(this._aLoadQueue[e].oEnv||this)}catch(e){this.handleError(e)}}))}),this)}))}catch(e){this.handleError(e)}}checkBrowser(){return!(df.sys.isIE&&df.sys.iVersion<11)||(alert("Unfortunately the browser you are using is not supported by this framework. Please upgrade to a more modern browser.\n\r\n\rThe minimal version required is Internet Explorer 11. We advise to use the latest version of Microsoft Edge, Google Chrome or Mozilla FireFox."),!1)}ready(e,t,i){"string"==typeof e?this.ready((function(){this[e]instanceof D?t.call(i||this):(this._oLoadViewQueue[e]||(this._oLoadViewQueue[e]={aWaiters:[],bLoading:!1}),this._oLoadViewQueue[e].aWaiters.push({fHandler:t,oEnv:i}))})):(i=t,t=e,this._bReady?t.call(i||this):this._aLoadQueue.push({fHandler:t,oEnv:i}))}displayApp(e){this._bInitStarted||this.initialize(!0),this.ready((function(){let t;try{if(t="string"==typeof e?df.dom.query(document.body,e):e,!t)throw new df.Error(999,"No proper element passed",this);this._eViewPort=t,this._bContainerStretch=!df.sys.gui.isSizedByContent(t);const i=this.render();this.afterRender(),i.style.visibility="hidden",t.appendChild(i),this.afterShow(),this.forceResize(),i.style.visibility=""}catch(e){this.handleError(e)}}))}displayView(e,t){this._bInitStarted||this.initialize(!1),this.ready((function(){let i;try{if(i="string"==typeof t?df.dom.query(document.body,t):t,!i)throw new df.Error(999,"No proper element passed",this);this._eViewPort=i,this.serverActionEx({sMethod:"ShowView_FromClient",aParams:[e,df.fromBool(!0)],aViews:[e],fHandler(t){var s;(s=this[e])&&s instanceof D&&s._show(i)},oHandlerEnv:this})}catch(e){this.handleError(e)}}))}renderView(e){this.ready((function(){const t=this[e];if(!t)throw new df.Error(999,"Cannot render view '{{0}}' as it is not initialized.",this,[e]);t._bRendered||(t instanceof R?(t.psInvokingView=this._oCurrentWindow&&this._oCurrentWindow._sName||"",t.psInvokingView&&t.addSync("psInvokingView"),this.queueModal((function(){t._show(this._eRegionCenter),this.forceResize()}),this)):(this.hideView(this._oCurrentView,t===this._oCurrentView),t._show(this._eRegionCenter),this.forceResize(),this._oCurrentView=t),this._oCurrentWindow=t)}))}showView(e,t,i){const s=[e,df.fromBool(!1)];t&&(s.push(t),s.push(i)),this.serverActionEx({sMethod:"ShowView_FromClient",aParams:s,aViews:[e]})}hideView(e,t){const i="string"==typeof e?this[e]:e;if(i instanceof D){const e=i.getInvoking();i._hide(df.toBool(t)),this._oCurrentWindow===i&&(this._oCurrentWindow=null),this._oCurrentView===i&&(this._oCurrentView=null),i instanceof R&&e&&(this._oCurrentWindow=e)}}loadView(e,t,i,s,o){t&&(this._oPreLoaded[e]=[]),this.ready((function(){if(this[e]&&this[e]instanceof D)s&&s.call(o||this,this[e]);else{if(this._oLoadViewQueue[e]||(this._oLoadViewQueue[e]={aWaiters:[],bLoading:!1}),this._oLoadViewQueue[e].bLoading)return;this._oLoadViewQueue[e].bLoading=!0,s&&this._oLoadViewQueue[e].aWaiters.push({fHandler:s,oEnv:o});const n=new df.ServerAction;n.oWO=this,n.sAction="loadView",n.aParams=[e,i||"",df.fromBool(t)],n.eCallMode=df.cCallModeWait,n.fHandler=function(i){let s;const o=this[e];if(df.toBool(i.sReturnValue))try{if(!(o instanceof D))throw this._oLoadViewQueue[e].bLoading=!1,new df.Error(999,"No view definition received for '{{0}}'",this,[e]);{if(t&&this._oPreLoaded[e]){for(s=this._oPreLoaded[e].shift();s;)this.execClientAction(s),s=this._oPreLoaded[e].shift();delete this._oPreLoaded[e]}const i=this._oLoadViewQueue[e].aWaiters;for(let e=0;e<i.length;e++)i[e].fHandler.call(i[e].oEnv||this,o);this._oLoadViewQueue[e]=null}}catch(e){this.handleError(e)}},n.oHandlerEnv=this,n.aViews.push(i||null),n.aViews.push(e),this.handleAction(n)}}),this)}unloadView(e,t){if(t=df.toBool(t),this[e]&&this[e]instanceof D){const t=this[e];t._bRendered&&this.hideView(e,!0),this._oCurrentObj&&this._oCurrentObj.getView()===t&&(this._oCurrentObj=null),t.destroy();const i=this._aChildren.indexOf(t);i>=0&&this._aChildren.splice(i,1)}t&&this._oWODefStore[e]&&delete this._oWODefStore[e]}objFocus(e){const t=e.getView();t&&!t._bStandalone&&t._bRendered&&(this._oCurrentWindow=t),t&&!t._bRendered||(this._oCurrentObj=e)}objBlur(e){}returnFocus(){this._oCurrentObj&&this._oCurrentObj.conditionalFocus()}getFocusObjName(){return this._oCurrentObj instanceof m&&!this._oCurrentObj._bStandalone?this._oCurrentObj.getLongName():""}set_pbMDI(e){this._eRegionCenter&&(this._eRegionCenter.style.position=e?"relative":"")}notifyScroll(e){this.notifyPosChange(e)}notifyLayoutChange(e){this.notifyPosChange(e)}notifyPosChange(e){}initJSON(e){return function e(t,i){let s,o;if("df.WebApp"===t.sType)o=this;else{if(i[t.sName])throw new df.Error(999,"Naming conflict with child object '{{0}}'",this,[t.sName]);{const e=this.getConstructor(t.sType,t);if("function"!=typeof e)throw new df.Error(999,"Could not find class '{{0}}'",this,[t.sType]);i[t.sName]=o=new e(t.sName,i)}}for(let e=0;e<t.aProps.length;e++){if(s=t.aProps[e].sN,"_"===s.charAt(0))throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[t.aProps[e].sV,t.sName]);if(o[s]&&("object"==typeof o[s]||"function"==typeof o[s]))throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[s,t.sName]);o._set(s,t.aProps[e].sV,!1,!1)}if(t.aAdvP)for(let e=0;e<t.aAdvP.length;e++){if(s=t.aAdvP[e].sN,"_"===s.charAt(0))throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[t.aAdvP[e].sV,t.sName]);if(o[s]&&("object"==typeof o[s]||"function"==typeof o[s]))throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[s,t.sName]);o._oTypes[s]||(o._oTypes[s]=df.tAdv),o._set(s,t.aAdvP[e].tV,!1,!1)}this.newWebObject(o,i,t);for(let i=0;i<t.aObjs.length;i++)e.call(this,t.aObjs[i],o);return o.create(t),o}.call(this,e,this)}newWebObject(e,t,i){t.addChild&&t!==e&&t.addChild(e)}getConstructor(e){return df.sys.ref.getNestedProp(e)}findObj(e){let t;if(""===e)return this;const i=e.split(/[\. | \$]/);t=this;for(let e=0;e<i.length&&t;e++)t=t[i[e]];return"object"==typeof t&&t||null}waitForCall(e,t){if(this._eLocked>=df.cCallModeDefault){for(let i=0;i<this._aLockwaiters.length;i++)if(this._aLockwaiters[i].fFunc===e&&this._aLockwaiters[i].oEnv===t)return;this._aLockwaiters.push({fFunc:e,oEnv:t})}else e.call(t)}lock(e,t){let i;const s=this;if(this._eLocked=e,document&&document.body&&(e>=df.cCallModeWait&&(this._eLockMask||(this._eLockMask=df.gui.dragMask(this._oCurrentWindow?.topLayer()||document.body),this._tLockCursor=setTimeout((function(){s._eLockMask&&(s._eLockMask.style.cursor="wait"),s._tLockCursor=null}),140)),df.events.addDomCaptureListener("keydown",document.body,this.onBlockKey,this)),e>=df.cCallModeProgress&&!this._bLockWait&&(this._bLockWait=!0,this.OnShowProgress.fire(this,{sMessage:t})))){this._aModalQueue.push(this._oLockModalBlock={fFunc:null,bFinished:!1,bDisplayed:!0}),this._oLockDialog=i=new R(null,this),i.psCaption="",i.pbResizable=!1,i.pbShowClose=!1,i.psCSSClass="WebMsgBox WebMsgBoxProgress";const e=new W(null,i);e.psCaption=t||this.getTrans("loading")+"..",e.psCSSClass="WebMsgBoxProgress",i.addChild(e),i.show(),i._oPrevFocus=null}}unlock(){let e;for(this._eLocked=-1,this._eLockMask&&(this._eLockMask.style.cursor="",this._eLockMask.parentNode.removeChild(this._eLockMask),this._eLockMask=null,this._tLockCursor&&(clearTimeout(this._tLockCursor),this._tLockCursor=null)),document&&document.body&&df.events.removeDomCaptureListener("keydown",document.body,this.onBlockKey,this),this._bLockWait&&(this._bLockWait=!1,this.OnHideProgress.fire(this,{}),this._oLockDialog&&(this._oLockDialog.hide(),this._oLockDialog=null,this._oLockModalBlock.bFinished=!0,this.processModal()));e=this._aLockwaiters.pop();)e.fFunc.call(e.oEnv)}onBlockKey(e){if(this._eLocked>=df.cCallModeWait)return e.stop(),!1}handleAction(e){this.lock(e.eCallMode,e.sProcessMessage),e.aViews.push(this._oCurrentWindow),this._oPendingCall?(this._oPendingCall.aActions.push(e),this._oPendingCall.eCallMode<e.eCallMode&&(this._oPendingCall.eCallMode=e.eCallMode)):(this._oPendingCall=new df.ServerCall,this._oPendingCall.aActions.push(e),this._oPendingCall.sFocus=this.getFocusObjName(),this._oPendingCall.eCallMode=e.eCallMode),this.processCall()}cancelAction(e,t){if(this._oPendingCall){const i=this._oPendingCall.aActions;for(let s=0;s<i.length;s++)if(i[s].oWO===e&&i[s].sAction===t&&(i.splice(s,1),s--),0===i.length){this._oPendingCall=null;break}}}hasPendingAction(e,t){if(this._oPendingCall){const i=this._oPendingCall.aActions;for(let s=0;s<i.length;s++)if(i[s].oWO===e&&i[s].sAction===t)return!0}return!1}processResponse(e,t){if(!(e&&e.r&&e.r.Header&&e.r.asReturnValues))throw new df.Error(5123,"Unexpected response format.",this);{const i=e.r;if(this._aResponseAttachments=e.a||[],this.handleHeader(i.Header),t&&t.aActions.length===i.asReturnValues.length){const e=new df.events.JSEvent(this);for(let s=0;s<t.aActions.length;s++)e.sReturnValue=i.asReturnValues[s],t.aActions[s].fHandler&&t.aActions[s].fHandler.call(t.aActions[s].oHandlerEnv||null,e)}this._aResponseAttachments=null}}processCall(){const e=()=>{try{const e=this._oPendingCall;e&&(this._oSendingCall||(this._oSendingCall=e,this.sendCall(e).then((t=>{this.processResponse(t,e)})).catch((e=>{this.handleError(e)})).finally((()=>{this._oPendingCall||this.unlock(),this._oSendingCall=null,this.processCall()})),this._oPendingCall=null))}catch(e){this.unlock(),this._oPendingCall=null,this._oSendingCall=null,this.handleError(e)}};this._bCallTimeout?window.requestIdleCallback?window.requestIdleCallback(e,{timeout:30}):window.setTimeout(e,10):e()}assembleRequest(e){let t=[],i=[];const s=[];return e.aActions.forEach((e=>{s.push({sTarget:e.oWO.getLongName(),sAction:e.sAction,aParams:e.aParams,iAttached:e.tData&&i.push(e.tData)||0}),t=t.concat(e.aViews)})),{v:df.psVersionId,r:{Header:this.getHeader(t,e.sFocus),aActions:s},a:i}}sendCall(e){return new Promise(((e,t)=>{t(new df.Error(99,"Not implemented"))}))}getHeader(e,t){const i={},s={sFocus:t,aDDOViews:[],aSyncProps:[],aAdvSyncP:[]};function o(e){var t,n,r;"string"==typeof e?(t=this.findObj(e),r=e):r=(t=e)._sName,i[r]||(i[r]=!0,t instanceof D?((n=t.getInvoking())&&o.call(this,n),t.getSynced(s.aSyncProps,s.aAdvSyncP),s.aDDOViews.push(r)):(this.getCachedSyncProps(e,s.aSyncProps,s.aAdvSyncP),s.aDDOViews.push(r)))}if(this.getSynced(s.aSyncProps,s.aAdvSyncP),e instanceof Array)for(let t=0;t<e.length;t++)e[t]&&o.call(this,e[t]);else e&&o.call(this,e);return s}handleHeader(e){for(let t=0;t<e.aActions.length;t++)e.aActions[t].eType===df.ctExecEarly&&this.execClientAction(e.aActions[t]);for(let t=0;t<e.aObjectDefs.length;t++)this.initJSON(e.aObjectDefs[t]);this.handleSyncProps(e.aSyncProps),this.handleAdvSyncProps(e.aAdvSyncP);for(let t=0;t<e.aActions.length;t++)e.aActions[t].eType!==df.ctExecEarly&&this.execClientAction(e.aActions[t])}handleSyncProps(e){for(let t=0;t<e.length;t++){const i=e[t],s=this.findObj(i.sO);if(s)for(let e=0;e<i.aP.length;e++)s._set(i.aP[e].sN,i.aP[e].sV,!0,!0);else this.cacheSyncProps(i)}}handleAdvSyncProps(e){for(let t=0;t<e.length;t++){const i=e[t],s=this.findObj(i.sO);s?s._set(i.sP,i.tV,!0,!0):this.cacheAdvProp(i)}}execClientAction(e){const t=this.findObj(e.sTarget);let i;if(t){const i=t.findFunc(e.sName);if("function"==typeof i.fFunc){e.iAttached>0&&(e._tActionData?t._tActionData=e._tActionData:t._tActionData=this.responseAttachment(e.iAttached));try{i.fFunc.apply(i.oEnv,e.aParams)}catch(e){this.handleError(e)}t._tActionData=null}else this.handleError(new df.Error(999,"Action method not found '{{0}}' on object '{{1}}'",this,[e.sName,e.sTarget]))}else i=e.sTarget,i.indexOf(".")>0&&(i=i.substr(0,i.indexOf("."))),this._oPreLoaded[i]?(e.iAttached&&(e._tActionData=this.responseAttachment(e.iAttached)),this._oPreLoaded[i].push(e)):this.handleError(new df.Error(999,"Could not find object '{{0}}'",this,[e.sTarget]))}responseAttachment(e){if(this._aResponseAttachments&&this._aResponseAttachments.length>e-1)return this._aResponseAttachments[e-1];throw new df.Error(999,"Invalid response attachment index.",this)}cacheSyncProps(e){let t;for(let i=0;i<this._aSyncPropCache.length;i++)if(this._aSyncPropCache[i].sO===e.sO){const s=this._aSyncPropCache[i];for(let i=0;i<e.aP.length;i++){t=!1;for(let o=0;o<s.aP.length&&!t;o++)s.aP[o].sN===e.aP[i].sN&&(s.aP[o].sV=e.aP[i].sV,t=!0);t||s.aP.push(e.aP[i])}return}this._aSyncPropCache.push(e)}cacheAdvProp(e){for(let t=0;t<this._aAdvSyncPropCache.length;t++)if(this._aAdvSyncPropCache[t].sO===e.sO&&this._aAdvSyncPropCache[t].sP===e.sP)return void(this._aAdvSyncPropCache[t].tV=e.tV);this._aAdvSyncPropCache.push(e)}getCachedSyncProps(e,t,i){const s=e+".",o=s.length;for(let i=0;i<this._aSyncPropCache.length;i++)this._aSyncPropCache[i].sO!==e&&this._aSyncPropCache[i].sO.substr(0,o)!==s||(t.push(this._aSyncPropCache[i]),this._aSyncPropCache.splice(i,1),i--);for(let t=0;t<this._aAdvSyncPropCache.length;t++)this._aAdvSyncPropCache[t].sO!==e&&this._aAdvSyncPropCache[t].sO.substr(0,o)!==s||(i.push(this._aAdvSyncPropCache[t]),this._aAdvSyncPropCache.splice(t,1),t--)}set_psTheme(e){this.psTheme!==e&&(document.body&&df.dom.removeClass(document.body,this.psTheme),this.psTheme=e,this.updateCSS(!0))}set_pbResponsive(e){this._oModeControl&&(e?this._oModeControl.activate():this._oModeControl.deactivate())}set_peAlignView(e){this.peAlignView=e,this.sizeChanged()}updateCSS(e){let t;const i=this,s=this.psTheme.trim();if(!this._eStyleSystem||!this._eStyleTheme||!this._eStyleApplication){t="?v="+df.psVersionId,"string"==typeof sDfBuildNr&&sDfBuildNr&&(t+="."+sDfBuildNr);const e=df.dom.query(document,"link",!0);for(let t=0;t<e.length;t++)e[t].href.indexOf("DfEngine/system.css")>0&&(this._eStyleSystem=e[t]),e[t].href.indexOf("CssThemes/")>0&&e[t].href.indexOf("theme.css")>0&&(this._eStyleTheme=e[t]),e[t].href.indexOf("CssStyle/application.css")>0&&(this._eStyleApplication=e[t]);if(!this._eStyleSystem){this._eStyleSystem=df.dom.createCSSElem(this._sRootPath+"DfEngine/system.css"+t);const e=document.head||document.getElementsByTagName("head")[0];e.firstChild?e.insertBefore(this._eStyleSystem,e.firstChild):e.appendChild(this._eStyleSystem)}this._eStyleTheme||(this._eStyleTheme=df.dom.createCSSElem(this._sRootPath+"CssThemes/"+s+"/theme.css"+t),df.dom.insertAfter(this._eStyleTheme,this._eStyleSystem)),this._eStyleApplication||(this._eStyleApplication=df.dom.createCSSElem(this._sRootPath+"CssStyle/application.css"+t),df.dom.insertAfter(this._eStyleApplication,this._eStyleTheme)),document.body&&(document.body.id="OWEBAPP")}document.body&&df.dom.addClass(document.body,this.psTheme),this._eStyleTheme.href.indexOf(this._sRootPath+"CssThemes/"+s+"/theme.css")<0&&(this._eStyleTheme.href=this._sRootPath+"CssThemes/"+s+"/theme.css"),e&&this.testCSS((function(){this.resize(),setTimeout((function(){try{i.resize()}catch(e){i.handleError(e)}}),200)}))}testCSS(e,t){let i,s=0,o=!1;const n=df.dom.create('<div id="df_load_test" style="position: absolute"></div>'),r=()=>(!o&&n.clientHeight>=1&&(i.disconnect(),n.parentNode.removeChild(n),o=!0,e.call(this)),o);i=new ResizeObserver((e=>{r()})),i.observe(n),document.body.appendChild(n);const a=()=>{r()||(t?t.call(this):s<50?(s++,setTimeout(a,50)):e.call(this))};setTimeout(a,500)}onWindowResize(e){const t=this;this._tResizeTimeout&&(clearTimeout(this._tResizeTimeout),this._tResizeTimeout=null),this._tResizeTimeout=setTimeout((function(){try{t._tResizeTimeout=null,t.resize(),t.windowResize()}catch(e){t.handleError(e)}}),50),this.piScreenHeight===screen.width&&this.piScreenWidth===screen.height&&df.sys.isIE&&this.onOrientationChange(e)}windowResize(){this.fire("OnResizeWindow",[this.get_piWindowWidth(),this.get_piWindowHeight()]);for(let e=0;e<this._aViews.length;e++)this._aViews[e].windowResize(this.get_piWindowWidth(),this.get_piWindowHeight())}onScroll(e){this.notifyScroll(this)}prepareSize(){const e=super.prepareSize();return this._bStretch=this._bContainerStretch,e}resize(){let e;if(this.resizeHorizontal(),this.resizeVertical(),this.pbViewApp){this._eElem&&(e=this._iMiddleHeight-df.sys.gui.getVertBoxDiff(this._eRegionCenter,0));for(let t=0;t<this._aViews.length;t++){const i=this._aViews[t];!this._eElem&&i._eRenderTo&&(e=df.dom.clientHeight(i._eRenderTo)-df.sys.gui.getVertBoxDiff(i._eRenderTo,2)),i._bRendered&&i.viewResize(e)}}this.notifyPosChange(this),this._bSizeChanged=!1}objSizeChanged(e){const t=this;this._bSizeChanged=!0,this._tResizeTimer||(t._tResizeTimer=setTimeout((function(){try{t.resize(),t._tResizeTimer=null}catch(e){t.handleError(e)}}),30))}forceResize(){const e=this;this.sizeChanged(!0),setTimeout((function(){e.sizeChanged(!0)}),60)}onOrientationChange(e){let t;this.piScreenHeight=screen.height,this.piScreenWidth=screen.width,t="number"==typeof window.orientation?window.orientation:screen.height>screen.width?90:0,this.fire("OnOrientationChange",[t])}showInfoBox(e,t){this._aModalQueue.push({fFunc:function(i){var s=this;const o=this.get_piWindowWidth(),n=new R(null,this);n.psCaption=t,n.piMinWidth=o>420?400:o-20,n.piMinHeight=80,n.psCSSClass="WebMsgBox WebMsgBoxInfo",n.pbScroll=!0;const r=this._aViews.length;s._aViews.push(n),n.OnSubmit.addListener((function(e){n.hide()}),this),n.OnHide.addListener((function(e){i.bFinished=!0,setTimeout((function(){try{s.processModal(),n.destroy(),s._aViews.splice(r,1)}catch(e){s.handleError(e)}}),20)}),this);const a=new y(null,n);a.peRegion=df.ciRegionCenter,n.addChild(a);const l=new W(null,n);l.psCaption=e,l.psCSSClass="WebMsgBox_Text",a.addChild(l);const h=new y(null,n);h.peRegion=df.ciRegionBottom,h.piColumnCount=3,h.psCSSClass="WebMsgBoxOneBtn",n.addChild(h);const d=new M(null,n);d.psCaption=this.getTrans("ok"),d.piColumnIndex=2,d.pbShowLabel=!1,d.OnClick.addListener((function(e){n.hide()}),this),h.addChild(d),n.show(),this.ready((function(){n.resize(),d.focus()}))},bFinished:!1,bDisplayed:!1}),this.processModal()}showMessageBox(e,t,i,s,o,n){const r=this.findObj(e);if(!r)throw new df.Error(999,"Return WebObject not found '{{0}}'",this,[e]);const a=this._tActionData;if(!a)throw new df.Error(999,"No buttons specified",this);this.showMsgBox(i,s,o,a,n,(function(e,i){r.getActionMode(t)<df.cCallModeWait&&r.setActionMode(t,df.cCallModeWait),r.serverAction(t,[e],null,(function(){i.hide()}))}))}showMsgBox(e,t,i,s,o,n){this._aModalQueue.push({fFunc:function(r){let a,l,h,d,p=null,u=this.get_piWindowWidth();function c(e){n.call(this,e.oSource._iConfirmId,a)}a=new R(null,this),a.psCaption=t,a.piMinWidth=u>500?480:u-20,a.piMinHeight=100,a.pbShowClose=!1,a.psCSSClass="WebMsgBox "+i,a.pbScroll=!0,this._aViews.push(a),a.OnHide.addListener((function(e){r.bFinished=!0,setTimeout((()=>{try{this.processModal(),a.destroy();let e=this._aViews.indexOf(a);(e=-1)&&this._aViews.splice(e,1)}catch(e){this.handleError(e)}}),20)}),this),h=new y(null,a),h.peRegion=df.ciRegionCenter,a.addChild(h),l=new W(null,a),l.psCaption=e,l.psCSSClass="WebMsgBox_Text",h.addChild(l),d=new y(null,a),d.peRegion=df.ciRegionBottom,d.piColumnCount=2*s.length+2,df.sys.isMobile&&(2===s.length?d.piColumnCount=2*s.length:s.length>2&&(d.piColumnCount=1)),1===s.length?d.psCSSClass="WebMsgBoxOneBtn":2===s.length?d.psCSSClass="WebMsgBoxTwoButtons":d.psCSSClass="WebMsgBoxButtons",a.addChild(d),o=parseInt(o,10);for(let e=0;e<s.length;e++){const t=new M(null,a);t.psCaption=s[e],t.piColumnIndex=2*e+1,t.piColumnSpan=2,t.pbShowLabel=!1,t._iConfirmId=e+1,t.OnClick.addListener(c),df.sys.isMobile?2===s.length?t.piColumnIndex=2*e:s.length>2&&(t.piColumnIndex=0,t.piColumnSpan=0):0===e?t.psCSSClass="WebMsgBoxFirstBtn":e===s.length-1&&(t.psCSSClass="WebMsgBoxLastBtn"),d.addChild(t),t._iConfirmId===o&&(p=t)}a.show(),this.ready((function(){a.resize(),p&&p.focus()}))},bFinished:!1,bDisplayed:!1}),this.processModal()}showYesNo(e,t,i){this.showMsgBox(e,this.getTrans("confirm"),"WebMsgBoxConfirm",[this.getTrans("yes"),this.getTrans("no")],0,(function(e,s){try{t&&t.call(i||this,1===e)}catch(e){this.handleError(e)}s.hide()}))}processModal(){if(this._aModalQueue.length>0){for(;this._aModalQueue[0]&&this._aModalQueue[0].bFinished;)this._aModalQueue.shift();this._aModalQueue.length>0&&!this._aModalQueue[0].bDisplayed&&(this._aModalQueue[0].bDisplayed=!0,this._aModalQueue[0].fFunc.call(this,this._aModalQueue[0]))}}queueModal(e,t){this._aModalQueue.push({fFunc(i){e.call(t||null),i.bFinished=!0,this.processModal()},bFinished:!1,bDisplayed:!1}),this.processModal()}log(e){df.log(e)}getTrans(e,t){return this._oTranslations[e]?this._oTranslations[e]:t?null:"{{"+e+"}}"}getLongName(){return""}getLongNamePrnt(){return""}initTranslations(){this.initTrans(this._tActionData)}initTrans(e){for(let t=0;t<e.length;t++)this._oTranslations[e[t].sN]=e[t].sV;df.lang={monthsLong:[this.getTrans("january"),this.getTrans("february"),this.getTrans("march"),this.getTrans("april"),this.getTrans("may"),this.getTrans("june"),this.getTrans("july"),this.getTrans("august"),this.getTrans("september"),this.getTrans("october"),this.getTrans("november"),this.getTrans("december")],monthsShort:[this.getTrans("jan"),this.getTrans("feb"),this.getTrans("mar"),this.getTrans("apr"),this.getTrans("mayShort"),this.getTrans("jun"),this.getTrans("jul"),this.getTrans("aug"),this.getTrans("sep"),this.getTrans("oct"),this.getTrans("nov"),this.getTrans("dec")],daysShort:[this.getTrans("sun"),this.getTrans("mon"),this.getTrans("tue"),this.getTrans("wed"),this.getTrans("thu"),this.getTrans("fri"),this.getTrans("sat")],daysLong:[this.getTrans("sunday"),this.getTrans("monday"),this.getTrans("tuesday"),this.getTrans("wednesday"),this.getTrans("thursday"),this.getTrans("friday"),this.getTrans("saturday")]}}showError(e,t,i,s,o){this.handleError(new df.Error(df.toInt(e),i,this,null,null,!0,df.toBool(o),s,null,df.toInt(t)))}handleError(e){if(!(e instanceof df.Error))throw e;this.OnError.fire(this,{oError:e})&&(e.oTarget&&e.oTarget.displayError&&e.oTarget.pbRender&&e.oTarget.pbVisible?e.oTarget.displayError(e.iNumber,e.sText):(this._aModalQueue.push({fFunc:function(t){let i,s,o,n=this;const r=[],a=this.get_piWindowWidth();o=e.bServer?e.sCaption||this.getTrans("error_title_server"):e.sCaption||this.getTrans("error_title_client",!0)||"Unhandled Program Error on the client";const l=new R(null,this);l.psCaption=o,l.piMinWidth=a>520?500:a-20,l.piMinHeight=e.bUserError?80:180,l.psCSSClass=e.bUserError?"WebMsgBox WebMsgBoxWarning":"WebMsgBox WebMsgBoxError";const h=this._aViews.length;n._aViews.push(l),l.OnSubmit.addListener((function(e){try{l.hide()}catch(e){n.handleError(e)}}),this),l.OnHide.addListener((function(e){t.bFinished=!0,setTimeout((function(){try{n.processModal(),l.destroy(),n._aViews.splice(h,1)}catch(e){n.handleError(e)}}),20)}),this);const d=new y(null,l);d.peRegion=df.ciRegionCenter,l.addChild(d),i=new W(null,d),i.psCaption=e.sText,i.psCSSClass="WebMsgBox_Text",d.addChild(i),e.bUserError||(i=new W(null,d),r.push("Error: ",e.iNumber),e.bServer?e.iLine&&r.push("\nLine:",e.iLine):e.oSource&&e.oSource instanceof c&&r.push("\nObject:",e.oSource.getLongName()),i.psCaption=r.join(""),d.addChild(i),e.sDetailHtml&&(l.piMinHeight=300,l.piHeight=400,e.sDetailHtml.match(/<body*>|<html*>/gi)?(s=new H(null,d),s.pbFillHeight=!0,s.pbShowLabel=!1,s.psCSSClass="WebErrorDetails",s.setHtmlContent(e.sDetailHtml),d.addChild(s)):(s=new E(null,d),s.pbFillHeight=!0,s.pbShowBox=!0,s.pbScroll=!0,s.pbShowLabel=!1,s.psCSSClass="WebErrorDetails",s.psHtml=e.sDetailHtml,d.addChild(s))));const p=new y(null,l);p.peRegion=df.ciRegionBottom,p.piColumnCount=3,p.psCSSClass="WebMsgBoxOneBtn",l.addChild(p);const u=new M(null,l);u.psCaption=this.getTrans("ok",!0)||"OK",u.piColumnIndex=2,u.pbShowLabel=!1,u.OnClick.addListener((function(e){l.hide()}),this),p.addChild(u),l.show(),this.ready((function(){l.resize(),u.focus()}))},bFinished:!1,bDisplayed:!1}),this.processModal()))}setPageTitle(e){document.title=e}navigateToPage(e,t){this.queueModal((function(){(t=parseInt(t,10))===df.ciOpenSameWindow?window.location.href=e:t===df.ciOpenNewWindow?window.open(e,"_blank_"+df.dom.piDomCounter++,"width=700, height=500, resizable=yes"):window.open(e,"_blank")}),this)}navigateNewWindow(e,t,i){this.queueModal((function(){window.open(e,"_blank_"+df.dom.piDomCounter++,"width="+t+", height="+i+", resizable=yes, location=yes")}))}navigateRefresh(){this.queueModal((function(){window.location.reload()}))}historyPushState(e,t){const i={df:!0,vt:this._tActionData};history&&history.pushState&&history.pushState(i,t||null,e||null)}historyReplaceState(e,t){const i={df:!0,vt:this._tActionData};history&&history.replaceState&&history.replaceState(i,t||null,e||null)}onPopState(e){const t=e.e.state;let i=null;t&&t.df&&t.vt&&void 0!==t.vt.v&&t.vt.c&&(i=t.vt),this.serverAction("HistoryPopState",[document.title,document.location.href],i),e.stop()}onHashChange(e){this.cancelServerAction("HistoryPopState"),this.serverAction("LocationHashChange",[document.location.hash])}get_piWindowWidth(){return df.dom.windowWidth()}get_piWindowHeight(){return df.dom.windowHeight()}get_peMode(){if(this._oModeControl)return this._oModeControl.peMode}get_pbIsMobile(){return df.sys.isMobile}get_psLocationHash(){return window.location.hash}get_piBrowserTimezoneOffset(){return(new Date).getTimezoneOffset()}get_pasBrowserLanguages=function(){const e=df.sys.vt.serialize(navigator.languages||navigator.language&&[navigator.language]||["en-US"]);return function(){return e}}();topLayer(){return document.body}getWebApp(){return this}}class L extends x{constructor(e){if(super(),!window.chrome.webview)throw new df.Error(999,"LocalApp requires chromium webview message API to function!");df.dom.on("message",window.chrome.webview,this.onWebMessageReceived,this),this._bPanels=e,this.pbViewApp=e}afterRender(){super.afterRender(),this.syncObserver()}syncObserver(){let e=!1;const t=()=>{e=!1,this._bCallTimeout=!1,this.serverAction("SynchronizeProps"),this._bCallTimeout=!0};new MutationObserver((function(){e||(e=!0,window.requestIdleCallback(t))})).observe(this._eElem,{subtree:!0,childList:!0,attributes:!0}),df.dom.on("input",this._eElem,(function(i){e||(e=!0,window.requestIdleCallback(t))}),this)}sendCall(e){return e.oPromise=new Promise(((t,i)=>{let s=[];e.aActions.forEach((e=>{e.oPlatformSpecific.aAdditionalObjects&&(s=s.concat(e.oPlatformSpecific.aAdditionalObjects))}));const o=this.assembleRequest(e);e._resolve=t,e._reject=i,df.debug("Sending call.."),df.debug(o),s.length>0?window.chrome.webview.postMessageWithAdditionalObjects(o,s):window.chrome.webview.postMessage(o)}))}onWebMessageReceived(e,t){const i=e.e.data;this._oSendingCall?(df.debug("Received response:"),df.debug(i),this._oSendingCall._resolve(i)):(df.debug("Received host message.."),df.debug(i),this.processResponse(i,null))}}r.dragdrop=function(){var e,t=[],i=[],s=!1,o=0,n=new Set;function a(){i.forEach((function(e){var t=e.oDetails=e.oObj.getDropDetails();e.eZone.style.width=t.oRect.width+"px",e.eZone.style.height=t.oRect.height+"px",e.eZone.style.left=t.oRect.left+"px",e.eZone.style.top=t.oRect.top+"px"}))}function l(){s&&(i.forEach((function(e){e.eZone.parentNode.removeChild(e.eZone),e.eZone=null})),n.forEach((function(e){e.cleanupHelper()})),i=[],s=!1,o=0,clearInterval(e))}function h(l){o++,s||c(l.e)&&(s||(t.forEach((function(e){var t,s=e.getDropDetails();s&&((t=r.dom.create('<div data-dropzone="yes" class="WebDropZone '+s.sDropClass+'"><div>'+s.sDropContent+"</div></div>")).style.width=s.oRect.width+"px",t.style.height=s.oRect.height+"px",t.style.left=s.oRect.left+"px",t.style.top=s.oRect.top+"px",s.eZoneParent.appendChild(t),i.push({oObj:e,oDetails:s,eZone:t}))})),e=setInterval(a,300),s=!0),n.forEach((e=>{e.onFileDrag(l)}))),s=!0,l.stop()}function d(e){for(var t=e.getTarget();t&&t!==document.body;){if(t.hasAttribute("data-dropzone"))return e.e.dataTransfer.dropEffect="copy",void e.stop();t=t.parentNode}e.e.dataTransfer.dropEffect="none",e.stop()}function p(e){for(var t=e.getTarget();t&&t!==document.body&&!t.hasAttribute("data-dropzone");)t=t.parentNode;t&&i.forEach((function(i){if(i.eZone===t)return i.oObj.handleDrop(e),l(),e.stop(),!1}))}function u(e){--o<=0&&(l(),o=0)}function c(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1}return r.dom.ready((function(){r.dom.on("dragenter",document,h,window),r.dom.on("dragover",document,d,window),r.dom.on("drop",document,p,window),r.dom.on("dragleave",document,u,window)}),window),{addHandler(e){t.push(e)},remHandler(e){for(var i;(i=t.indexOf(e))>=0;)t.splice(i,1)},registerHelper(e){n.add(e)},removeHelper(e){n.remove(e)},containsFiles:c,stopDropZones:l}}(),r.uploadFiles=function(e){var t,i,s,o,n,a,l=[];function h(){var t,i,l=!0,p=null;if(!n){for(t=0;t<s.length;t++)if(!s[t].bFinished){if(p){l=!1;break}p=s[t],i=t}!function(t,i,l){if(e.displayProgress.call(o,i,s.length,0,t.oFile.size,e.iLoaded,e.iTotal),o.getWebApp()instanceof L&&window.chrome?.webview?.postMessageWithAdditionalObjects)o.serverActionEx({sMethod:"DoHandleLocalFileUpload",aParams:[t.sResourceId],tData:null,fHandler:()=>{e.iLoaded+=t.oFile.size,e.displayProgress.call(o,i,s.length,t.oFile.size,t.oFile.size,e.iLoaded,e.iTotal),t.bFinished=!0,l(!0)},oHandlerEnv:null,oPlatformSpecific:{aAdditionalObjects:[t.oFile]}});else{let h,p;a=p=new XMLHttpRequest,p.upload.addEventListener("progress",(function(t){var n=e.iLoaded+t.loaded;n=n<e.iTotal?n:e.iTotal,e.displayProgress.call(o,i,s.length,t.loaded,t.total,n,e.iTotal)}),!1),p.onreadystatechange=function(i){try{if(p.readyState===d.states.REQUEST_STATE_COMPLETE){if(!n){if(201!==p.status)throw new r.Error(999,"Received HTTP error '{{0}} {{1}}' while uploading file.",this,[p.status,p.statusText],p.responseText);t.bFinished=!0,e.iLoaded+=t.oFile.size,l(!0),p.onreadystatechange=null}p=null}}catch(e){l(!1),o.getWebApp().handleError(e),p=null}},p.open("POST",o.psUploadUrl,!0),h=new FormData,h.append("hash",t.sResourceId),h.append("v","html5"),h.append("file",t.oFile),p.send(h)}}(p,i,(function(t){var i;if(t){if(l&&e.displayFinishWorking.call(o),o.pbNotifyIndividualFile)o.serverAction("DoFileFinished",[p.oFile.name,p.sResourceId],null,(function(e){p.sFinishedResult=e.sReturnValue,l||h()}),o);else if(l)for(i=0;i<s.length;i++)o.serverAction("DoFileFinished",[s[i].oFile.name,s[i].sResourceId],null,(function(e){p.sFinishedResult=e.sReturnValue}));else h();l&&(o.fire("OnUploadFinished",[],(function(t){e.displayFinished.call(o,!0),!1,e.finished&&e.finished.call(o,!0,s)})),o.processUpload=null)}else o._eControl&&(o._eControl.value=""),e.displayFinished.call(o,!1),!1}))}}s=e.aFiles,o=e.oWO,e.iTotal=0,e.iLoaded=0,i=function(){},e.displayStartWorking=e.displayStartWorking||i,e.displayProgress=e.displayProgress||i,e.displayFinishWorking=e.displayFinishWorking||i,e.displayFinished=e.displayFinished||i,e.cancel=function(){n=!0,s=[],a&&a.abort(),e.displayFinished.call(o,!1),!1};if(!(s&&s.length>0))throw new r.Error(999,"No file details found to start upload.",this);for(t=0;t<s.length;t++){const i=s[t].oFile;l.push([t,i.name||"Unknown",i.size||0,i.type||"Unknown"]),e.iTotal+=i.size||0}e.displayStartWorking.call(o),o.doStartUpload((function(t){var i,a=JSON.parse(t.sReturnValue);for(i=0;i<a.length;i++){if(!(a[i].length>=2&&s[a[i][0]]))throw new r.Error(999,"Received invalid resource id from the server.",this);s[a[i][0]].sResourceId=a[i][1]}for(e.iTotal=0,e.iLoaded=0,i=0;i<s.length;i++)s[i].sResourceId?e.iTotal+=s[i].oFile.size:(s.splice(i,1),i--);s.length>0?(n=!1,h()):(e.displayFinished.call(o,!1),!1)}),l)},r.uploadFilesProgressDialog=function(e){var t,i,s,o,n,a,l,h,d,p,u;let c=(u=e.oWO).getWebApp().getTrans("files"),g=u.getWebApp().getTrans("file");function _(t){e.cancel()}e.displayStartWorking=function(){var m=r.dom.windowWidth();(t=new R(null,u)).psCaption=u.getWebApp().getTrans("file_cap_uploading"),t.pbShowClose=this.pbAllowCancel,t.piMinWidth=m>520?500:m-20,t.OnEscape.addListener(_,this),(i=new y(null,t)).peRegion=r.ciRegionCenter,i.piColumnCount=10,t.addChild(i),(s=new W(null,i)).psCaption=g+":",s.piColumnSpan=2,s.peAlign=r.ciAlignRight,i.addChild(s),(o=new W(null,i)).psCaption="...",o.piColumnSpan=0,o.piColumnIndex=2,i.addChild(o),(s=new W(null,i)).psCaption=u.getWebApp().getTrans("file_remain")+":",s.piColumnSpan=2,s.peAlign=r.ciAlignRight,i.addChild(s),(n=new W(null,i)).psCaption=e.aFiles.length+" "+c+" ("+r.sys.data.markupDataSize(e.iTotal)+")",n.piColumnSpan=0,n.piColumnIndex=2,i.addChild(n),a=new T(null,i),i.addChild(a),u.pbMultiFile&&((l=new I(null,i)).piMaxValue=e.iTotal>0?e.iTotal:e.aFiles.length,i.addChild(l)),h=new I(null,i),i.addChild(h),u.pbAllowCancel&&((d=new y(null,t)).peRegion=r.ciRegionBottom,d.piColumnCount=12,t.addChild(d),(p=new M(null,d)).psCaption=u.getWebApp().getTrans("cancel"),p.piColumnIndex=9,p.piColumnSpan=3,p.OnClick.addListener(_,this),d.addChild(p)),t.show(),u.getWebApp().ready((function(){t.resize(),p&&p.focus()}))},e.displayProgress=function(t,i,s,a,d,p){o.set("psCaption",e.aFiles[t]&&e.aFiles[t].oFile&&e.aFiles[t].oFile.name||"");let g=i-(t+1),_=p-d;n.set("psCaption",g>0?g.toString()+" "+c+" ("+r.sys.data.markupDataSize(_)+")":r.sys.data.markupDataSize(_)),u.pbMultiFile&&(l.set("piMaxValue",p),l.set("piValue",d)),h.set("piMaxValue",a),h.set("piValue",s)},e.displayFinishWorking=function(){h.set("piValue",h.get("piMaxValue")),u.pbMultiFile&&l.set("piValue",l.get("piMaxValue")),n.set("psCaption","0 KB")},e.displayFinished=function(e){t&&(t.hide(),t.destroy(),t.OnEscape.removeListener(_,this),p&&p.OnClick.removeListener(_,this),t=null)},r.uploadFiles(e)};const A=e=>class extends e{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowDialog",!0),this.prop(r.tBool,"pbCapture",!1),this.prop(r.tString,"psAccept",""),this.event("OnUploadFinished",r.cCallModeWait)}initFiles(e){var t;if(!this._bUploading){for(this._aFiles=[],t=0;t<e.length&&(this.pbMultiFile||this._aFiles.length<1);t++)this.validate(e[t])&&this._aFiles.push({bFinished:!1,sResourceId:null,oFile:e[t]});this._aFiles.length>0&&(this.displaySelectedFileDetails(),this.pbAutoStart&&this.startUpload())}}validate(e){var t,i,s,o,n,r=!1;if(this.psAccept){for(t=this.psAccept.toLowerCase().split(","),i=0;i<t.length;i++)if("."===(s=t[i].trim()).charAt(0)){if(e.name.substr(e.name.lastIndexOf("."),s.length).toLowerCase()===s)return!0;r=!0}else if(e.type&&(o=s.split("/"),n=e.type.split("/"),o.length>1&&n.length>1&&(o[0]===n[0]||"*"===o[0])&&(o[1]===n[1]||"*"===o[1])))return!0;return!e.type&&!r}return!0}startUpload(){var e={oWO:this,aFiles:this._aFiles,finished(e,t){this._eInput&&(this._eInput.value="")},displayStartWorking:this.displayStartWorking,displayProgress:this.displayProgress,displayFinishWorking:this.displayFinishWorking,displayFinished:this.displayFinished};this.pbShowDialog?r.uploadFilesProgressDialog(e):r.uploadFiles(e)}doStartUpload(e,t){this.serverAction("DoStartUpload",[],r.sys.vt.serialize(t),e)}processUpload(){}displaySelectedFileDetails(){}displayStartWorking(){}displayProgress(e,t,i,s,o,n){}displayFinishWorking(){}displayFinished(e){}set_psAccept(e){this._eInput&&(this._eInput.accept=e)}set_pbCapture(e){this._eInput&&(this._eInput.capture=e)}};class P extends(A(b)){}class B extends P{constructor(e,t){super(e,t),this.prop(r.tBool,"pbMultiFile",!1),this.prop(r.tBool,"pbAutoStart",!0),this.prop(r.tBool,"pbAllowCancel",!0),this.prop(r.tBool,"pbNotifyIndividualFile",!1),this.prop(r.tString,"psDropZoneObjName",""),this._oDragArea=null,this._eDragArea=null}fileHtml(e){e.push('<div style="display: none">'),e.push('<input type="file" name="',this._sName,'" id="',this._sControlId,'"',this.pbMultiFile?" multiple":"",' accept="',this.psAccept,'"',this.pbCapture?" capture":"",">"),e.push("</div>")}afterRender(){this._eInput=r.dom.query(this._eElem,'input[type="file"]'),super.afterRender(),r.dom.on("change",this._eInput,this.onFileChange,this)}selectFiles(){if(!(window.File&&window.FileList&&window.FileReader))throw new r.Error(999,"HTML5 Upload is not supported by this browser.",this);this._eInput.click()}afterShow(){super.afterShow(),r.dragdrop.addHandler(this)}afterHide(){super.afterHide(),r.dragdrop.remHandler(this)}getDropDetails(){var e,t,i=this.getWebApp();return this.isEnabled()&&(e=i.findObj(this.psDropZoneObjName))instanceof m&&(t=e===i?document.body:e._eElem)?{sDropContent:this.getWebApp().getTrans("file_drop"),sDropClass:"",oRect:t.getBoundingClientRect(),eZoneParent:t.closest("dialog")||document.body}:null}handleDrop(e){var t;(t=e.e.dataTransfer&&e.e.dataTransfer.files||null)&&t.length>0&&(e.stop(),this.initFiles(t))}onFileChange(e){this._eInput.files.length>0&&this.initFiles(this._eInput.files),e.stop()}}class F extends m{constructor(e,t){super(e,t),this.prop(r.tString,"psCaption",""),this.prop(r.tString,"psTextColor",""),this.prop(r.tBool,"pbBeginGroup",!1),this.prop(r.tString,"psGroupCaption",""),this.prop(r.tString,"psImage",""),this.prop(r.tString,"psToolTip",""),this.prop(r.tInt,"peActionDisplay",r.adBoth),this.event("OnClick",r.cCallModeWait),this.prop(r.tString,"psLoadViewOnClick",""),this._bShown=!0,this._oProv=null}itemClick(e,t,i){return this.fire("OnClick",[],(function(e){e.bCanceled||this.psLoadViewOnClick&&this.getWebApp().showView(this.psLoadViewOnClick),t.call(i,e.bClient||e.bServer||this.psLoadViewOnClick)}))}set_psCaption(e){this.psCaption=e,this.notifyChange()}set_psToolTip(e){this.psToolTip=e,this.notifyChange()}set_pbBeginGroup(e){this.pbBeginGroup=e,this.notifyChange()}set_psImage(e){this.psImage=e,this.notifyChange()}set_psHtmlId(e){this.psHtmlId=e,this.notifyChange()}set_psCSSClass(e){this.psCSSClass=e,this.notifyChange()}set_psTextColor(e){this.psTextColor=e,this.notifyChange()}set_psBackgroundColor(e){this.psBackgroundColor=e,this.notifyChange()}set_peActionDisplay(e){this.peActionDisplay=e,this.notifyChange()}set_pbVisible(e){this.pbVisible!==e&&(this.pbVisible=e,this.notifyChange())}set_pbRender(e){this.pbRender!==e&&(this.pbRender=e,this.pbRender?this.afterShow():this.afterHide(),this.notifyChange())}show(){}hide(){}applyEnabled(e){this.notifyChange()}notifyChange(){this.getProv().notifyChange()}getTooltipElem(){const e=this.getProv();if(e){if(!e.psGroupName)return e.getItemElemByHandler(this);{const t=e.getHub().getListeners(e.psGroupName);for(let e=0;e<t.length;e++)if(t[e]._bShown)return t[e].getItemElemByHandler(this)}}return null}getProv(){let e;if(!this._oProv){for(e=this;e&&!e._bIsMenuProv;)e=e._oParent;if(!e||!e._bIsMenuProv)throw new r.Error(999,"Menu item '{{0}}' should be wrapped by a menu object.",this,[this._sName]);this._oProv=e}return this._oProv}cssClass(){return this.psCSSClass}visible(){return this.pbRender&&this.pbVisible}customRender(){return!1}itemHtml(e){}itemRendered(e){}}class k extends F{constructor(e,t){super(e,t),this.prop(r.tBool,"pbChecked",!1),this.addSync("pbChecked")}itemClick(e,t,i){return e.hRef&&e.hRef.set_pbChecked(!e.hRef.isChecked()),super.itemClick(e,t,i)}isChecked(){return!0===this.pbChecked}set_pbChecked(e){this.pbChecked=e,this.notifyChange()}}r.tWebMenuItem={sId:r.tString,sCaption:r.tString,sTooltip:r.tString,sGroupCaption:r.tString,bEnabled:r.tBool,sCSSClass:r.tString,sHtmlId:r.tString,bBeginGroup:r.tBool,sImage:r.tString,eCheckbox:r.tInt,sTextColor:r.tString,sBackgroundColor:r.tString,eActionDisplay:r.tString,aChildren:[]},r.tWebMenuItem.aChildren.push(r.tWebMenuItem);const V=e=>class extends e{constructor(e,t){super(e,t),this.prop(r.tBool,"pbAllowHtml"),this.prop(r.tString,"psGroupName"),this.OnUiUpdate=new r.events.JSHandler,this._aMenu=null,this._aDynamicMenu=null,this._bIsMenuProv=!0,this._bIsMenuListener=!1}create(){super.create(),this.psGroupName&&(this.getHub().addProvider(this.psGroupName,this),this._bIsMenuListener&&this.getHub().addListener(this.psGroupName,this))}destroy(){this.psGroupName&&(this._bIsMenuListener&&this.getHub().remListener(this.psGroupName,this),this.getHub().remProvider(this.psGroupName,this)),super.destroy()}groupCollect(e){return this.genMenuData(e)}groupUpdate(e){this._aMenu=e,this.updatePaths(),this.refreshMenu()}genMenuData(e){if(this._aDynamicMenu){const t=this._aDynamicMenu;for(let i=0;i<t.length;i++)t[i]._oHandler=this,e.push(t[i])}!function e(t,i){for(let s=0;s<t._aChildren.length;s++){const o=t._aChildren[s];if(o instanceof F&&o.visible()){const t={sId:"",hRef:o,sCaption:o.psCaption,sTooltip:o.psToolTip,sGroupCaption:o.psGroupCaption,bEnabled:o.isEnabled(),sCSSClass:o.cssClass(),sHtmlId:o.psHtmlId,bBeginGroup:o.pbBeginGroup,sImage:o.psImage,eCheckbox:o instanceof k?o.isChecked()?1:-1:0,sTextColor:o.psTextColor,sBackgroundColor:o.psBackgroundColor,eActionDisplay:o.peActionDisplay,aChildren:[],_bCustomRender:o.customRender(),_oHandler:o};i.push(t),e(o,t.aChildren)}}}(this,e)}set_psGroupName(e){this.psGroupName&&this.getHub().remProvider(this.psGroupName,this),this.getHub().addProvider(this.psGroupName,this)}set_pbAllowHtml(e){this.pbAllowHtml=e,this.refreshMenu()}deserializeVT=r.sys.vt.generateDeserializer([r.tWebMenuItem]);refresh(){const e=this.deserializeVT(this._tActionData);for(let t=0;t<e.length;t++)this.initDynamic(e[t]);this._aDynamicMenu=e,this.notifyChange()}itemClick(e,t,i){return e.aChildren.length>0?(t.call(i,!1),!1):this.fire("OnItemClick",[e.sId,e.sCaption],(function(e){t.call(i,e.bClient||e.bServer)}))}updateItem(e,t){const i=r.sys.vt.deserialize(this._tActionData,r.tWebMenuItem),s=this.getItemById(e);s&&(s.sId=i.sId,s.sCaption=i.sCaption,s.sTooltip=i.sToolTip,s.sGroupCaption=i.sGroupCaption,s.bEnabled=i.bEnabled,s.sCSSClass=i.sCSSClass,s.sHtmlId=i.sHtmlId,s.bBeginGroup=i.bBeginGroup,s.sImage=i.sImage,s.eCheckbox=i.eCheckbox,s.sTextColor=i.sTextColor,s.sBackgroundColor=i.sBackgroundColor,s.eActionDisplay=i.eActionDisplay,r.toBool(t)&&(s.aChildren=i.aChildren,this.initDynamic(s)),this.notifyChange())}insertItem(e){const t=r.sys.vt.deserialize(this._tActionData,r.tWebMenuItem),i=this.getItemById(e);i&&(this.initDynamic(t),i.aChildren.push(t),this.notifyChange())}removeItem(e){(function t(i){for(let s=0;s<i.length;s++){if(i[s].sId===e)return i.splice(s,1),!0;if(t(i[s].aChildren))return!0}return!1})(this._aDynamicMenu)&&this.notifyChange()}initDynamic(e){e._oHandler=this;for(let t=0;t<e.aChildren.length;t++)this.initDynamic(e.aChildren[t])}notifyChange(){this.getWebApp().waitForCall(this.performUpdate,this)}updateEnabled(){super.updateEnabled(),this.notifyChange()}performUpdate(){this._aMenu=null,this.psGroupName?this.getHub().updateGroup(this.psGroupName):this.refreshMenu(),this.OnUiUpdate.fire(this,{bUiDriven:!1})}getMenu(){return this._aMenu||(this._aMenu=[],this.psGroupName&&this._bIsMenuListener||(this.genMenuData(this._aMenu),this.updatePaths())),this._aMenu}getItemByPath(e){let t=null,i=this.getMenu();const s=e.split(".");for(let e=0;e<s.length;e++)i[s[e]]?(t=i[s[e]],i=t.aChildren):t=null;return t}getItemById(e){return function t(i){for(let s=0;s<i.length;s++){if(i[s].sId===e)return i[s];const o=t(i[s].aChildren);if(o)return o}return null}(this.getMenu())}getItemByHandler(e){return function t(i){for(let s=0;s<i.length;s++){if(i[s]._oHandler===e)return i[s];const o=t(i[s].aChildren);if(o)return o}return null}(this.getMenu())}getItemElemByPath(e){return this._eControl&&r.dom.query(this._eControl,'li[data-df-path="'+e+'"]')||null}getItemElemByHandler(e){const t=this.getItemByHandler(e);return t?this.getItemElemByPath(t._sPath):null}genItemHtml(e,t,i){let s;const o=["WebMenuItem",t.sCSSClass,t.bEnabled?r.CssEnabled:r.CssDisabled];if(t.aChildren.length>0&&o.push("WebItm_HasSub"),t.bBeginGroup&&o.push("WebItm_BgnGroup"),t.sImage&&o.push("WebItm_HasIcon"),(t.eCheckbox<0||t.eCheckbox>0)&&o.push("WebItm_HasCheckbox"),e.push('<li class="',r.dom.encodeAttr(o.join(" ")),'" data-df-path="',t._sPath,'"'),t.sHtmlId&&e.push(' id="',r.dom.encodeAttr(t.sHtmlId),'"'),(t.sBackgroundColor||t.sTextColor)&&(e.push(' style="'),t.sTextColor&&e.push("color: ",r.dom.encodeAttr(t.sTextColor),";"),t.sBackgroundColor&&e.push("background-color: ",r.dom.encodeAttr(t.sBackgroundColor),";"),e.push('"')),e.push(">"),t._bCustomRender)t._oHandler.itemHtml(e);else if(t.sCaption=t.sCaption.replace("&",""),s=!this.pbShowLabel&&t._sPath.indexOf(".")<0?t.sTooltip||r.dom.encodeHtml(t.sCaption):t.sTooltip,e.push('<div title="',r.dom.encodeAttr(s),'">'),t.sImage?e.push('<span class="WebItm_Icon" style="background-image: url(\''+r.dom.encodeAttr(t.sImage)+"');\">&nbsp;</span>"):e.push('<span class="WebItm_Icon">&nbsp;</span>'),t.eCheckbox<0?e.push('<input class="WebItm_CheckBox" type="checkbox"></input>'):t.eCheckbox>0&&e.push('<input class="WebItm_CheckBox" type="checkbox" checked></input>'),e.push('<a tabindex="-1" href="javascript: void(0);" target="_self">',this.pbAllowHtml?t.sCaption:r.dom.encodeHtml(t.sCaption),"</a></div>"),i&&t.aChildren.length>0){e.push("<ul>");for(let s=0;s<t.aChildren.length;s++)this.genItemHtml(e,t.aChildren[s],i);e.push("</ul>")}e.push("</li>")}updatePaths(){function e(t,i){t._sPath=i;for(let s=0;s<t.aChildren.length;s++)e(t.aChildren[s],i+"."+s.toString())}for(let t=0;t<this._aMenu.length;t++)e(this._aMenu[t],t.toString())}refreshMenu(){}expandItem(e){}showItem(e){this.expandItem(e)}getHub(){const e=this.getWebApp();return e?(e._oMenuHub||(e._oMenuHub=new r.GroupHub),e._oMenuHub):null}notifyMenuRendered(e,t){e.forEach((e=>{e._bCustomRender&&e._oHandler.itemRendered(this.getItemElemByPath(e._sPath))}))}};class O extends(V(b)){}class N extends S{constructor(e,t){super(e,t),this.prop(r.tBool,"pbPromptButton",!1),this.prop(r.tBool,"pbPassword",!1),this.prop(r.tString,"psPlaceHolder",""),this.prop(r.tBool,"pbAutoTab",!1),this.prop(r.tString,"psInputMode",""),this.event("OnPrompt",r.cCallModeWait),this._eWrap=null,this._ePrompt=null,this._bAutoTabOnUp=!1,this._sControlClass="WebForm",this._bJSSizing=!1}openHtml(e){super.openHtml(e),e.push('<div class="WebFrm_Wrapper"><span class="WebFrm_Prompt"></span><div class="WebFrm_PromptSpacer">','<input type="',this.pbPassword?"password":"text",'"',' name="',this._sName,'"',' value="" id="',this._sControlId,'"'),this.psInputMode&&e.push(' inputmode="',this.psInputMode,'"'),e.push(this.peLabelPosition!=r.ciLabelFloat?' placeholder="'+r.dom.encodeAttr(this.psPlaceHolder)+'"':"",' autocomplete="',r.dom.encodeAttr(this.psAutoComplete),'"',this.isEnabled()?"":' disabled="disabled" tabindex="-1"',">")}closeHtml(e){e.push("</div></div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebFrm_Wrapper input"),this._ePrompt=r.dom.query(this._eElem,"div.WebFrm_Wrapper span.WebFrm_Prompt"),this._eWrap=r.dom.query(this._eElem,"div.WebFrm_Wrapper"),super.afterRender(),r.dom.on("click",this._ePrompt,this.onPromptClick,this),this.set_pbPromptButton(this.pbPromptButton)}set_pbPassword(e){if(this._eControl)if(r.sys.isIE&&r.sys.iVersion<9){const t=this._eControl.cloneNode(!1);t.type=e?"password":"text",this._eControl.parentNode.replaceChild(t,this._eControl),this._eControl=t}else this._eControl.type=e?"password":"text"}set_psBackgroundColor(e){this._eWrap&&(this._eWrap.style.background=e||"")}set_pbPromptButton(e){this._eWrap&&this._ePrompt&&r.dom.toggleClass(this._eWrap,"WebFrm_HasPrompt",e)}set_psPlaceHolder(e){this._eControl&&this.peLabelPosition!=r.ciLabelFloat&&(this._eControl.placeholder=e)}set_psInputMode(e){this._eControl&&(this._eControl.inputMode=e)}onPromptClick(e){this.isEnabled()&&(this.objFocus(),this.firePrompt()?e.stopPropagation():this.focus())}getVertHeightDiff(){let e=super.getVertHeightDiff();return e+=r.sys.gui.getVertBoxDiff(this._eWrap),e}onKey(e){super.onKey(e),e.matchKey(r.settings.formKeys.prompt)&&this.firePrompt()&&e.stop()}firePrompt(){if(this.pbPromptButton)return this.fire("OnPrompt")}focus(e){if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){try{this._eControl.focus(),e&&this._eControl.select()}catch(e){}return this.objFocus(),!0}return!1}onFocus(e){let t;t=r.dom.getCaretPosition(this._eControl);const i=this._eControl.value.length-t,s=r.dom.getSelectionLength(this._eControl)>=this._eControl.value.length;super.onFocus(e);t!==r.dom.getCaretPosition(this._eControl)&&(this.peDataType===r.ciTypeBCD&&(t=this._eControl.value.length-i),r.dom.setCaretPosition(this._eControl,t)),s&&this._eControl.select()}autoTab(){const e=this.maxLength();if(this._eControl.value.length==e){var t=r.dom.getSelection(this._eControl);if(0==t.length&&t.start==e)return this.focusNext(!0),!0}return!1}onKeyPressAutoTab(e){this._bAutoTabOnUp=!this.autoTab()}onKeyUpAutoTab(e){this._bAutoTabOnUp&&(this.autoTab(),this._bAutoTabOnUp=!1)}maxLength(){return this.peDataType===r.ciTypeBCD?this.piMaxLength+(this.piPrecision?this.decSep().length:0):this.peDataType===r.ciTypeDate?r.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.dateFormat(),this.dateSep(),this.timeSep()).length:this.peDataType===r.ciTypeDateTime?r.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.dateTimeFormat(),this.dateSep(),this.timeSep()).length:this.peDataType===r.ciTypeTime?r.sys.data.dateToString(new Date(2020,10,10,10,10,10,10),this.timeFormat(),this.dateSep(),this.timeSep()).length:this.psMask?this.psMask.length:this.piMaxLength}initMask(){this._eControl&&(r.dom.off("keypress",this._eControl,this.onKeyPressAutoTab,this),r.dom.off("keyup",this._eControl,this.onKeyUpAutoTab,this)),super.initMask(),this._eControl&&this.pbAutoTab&&(r.dom.on("keypress",this._eControl,this.onKeyPressAutoTab,this),r.dom.on("keyup",this._eControl,this.onKeyUpAutoTab,this))}set_pbAutoTab(e){this._eControl&&(this.pbAutoTab=e,this.initMask())}}r.fpFloatByControl=1,r.fpFloatLeftSqueezeWebApp=2,r.fpFloatLeftPushWebApp=3,r.fpFloatFixed=4,r.fpFloatAbsolute=5;class z extends f{constructor(e,t){super(e,t),this.prop(r.tInt,"piWidth",0),this.prop(r.tInt,"piHeight",0),this.prop(r.tInt,"piTop",-1),this.prop(r.tInt,"piLeft",-1),this.prop(r.tInt,"piBottom",-1),this.prop(r.tInt,"piRight",-1),this.prop(r.tInt,"piContentWidth",0),this.prop(r.tString,"psFloatByControl",""),this.prop(r.tBool,"pbHideOnBlur",!1),this.prop(r.tBool,"pbHideOnEscape",!1),this.prop(r.tBool,"pbFocusOnShow",!1),this.prop(r.tInt,"pePosition",r.fpFloatByControl),this.prop(r.tBool,"pbShrinkIfNoSpace",!1),this.prop(r.tBool,"pbNaturalWidth",!1),this.event("OnHide"),this._eMask=null,this.pbScroll=!1,this.pbVisible=!1,this._bViewVisible=!1,this._bWrapDiv=!1,this._bVisible=!1,this._bFloating=!0,this._sControlClass="WebFlPnl"}create(){const e=this.getView();e?(e.OnAfterShow.on(this.showView,this),e.OnAfterHide.on(this.hideView,this),this._bViewVisible=e._bShown):this._bViewVisible=!0,super.create()}destroy(){const e=this.getView();e&&(e.OnAfterShow.off(this.showView,this),e.OnAfterHide.off(this.hideView,this)),super.destroy()}render(){const e=super.render();return(this.topLayer()||document.body).appendChild(e),null}genClass(){const e=[super.genClass()];return this.pePosition===r.fpFloatByControl&&(e.push("WebFP_ArrowTop"),e.push("WebFP_FloatBy")),this.pePosition!==r.fpFloatLeftSqueezeWebApp&&this.pePosition!==r.fpFloatLeftPushWebApp||e.push("WebFP_FloatLeft"),this.pbVisible?e.push("WebFP_Visible"):e.push("WebFP_Hidden"),this.piContentWidth>0&&e.push("WebFP_FixedContentWidth"),e.join(" ")}openHtml(e){e.push('<div class="',this.genClass(),'" style="display: none"'),this.psHtmlId&&e.push(' id="',this.psHtmlId,'"'),e.push(' data-dfobj="',this.getLongName(),'"'),e.push(' tabindex="0" style=" ',this.pbRender?"":"display: none;",'"'),e.push(">"),e.push('<div tabindex="',this.pbHideOnBlur?"0":"-1",'" class="WebFP_FocusCatcher"></div>'),e.push('<div class="WebContainer">'),super.openHtml(e)}closeHtml(e){super.closeHtml(e),e.push("</div>"),e.push('<div tabindex="',this.pbHideOnBlur?"0":"-1",'" class="WebFP_FocusCatcher"></div>'),e.push('<div class="WebFP_Arrow"></div>'),e.push("</div>")}afterRender(){this._eArrow=r.dom.query(this._eElem,"div.WebFP_Arrow"),this._aFocusCatchers=r.dom.query(this._eElem,"div.WebFP_FocusCatcher",!0),super.afterRender(),r.events.addDomCaptureListener("focus",this._eElem,this.onCaptureFocus,this),r.events.addDomCaptureListener("blur",this._eElem,this.onCaptureBlur,this),r.events.addDomKeyListener(this._eElem,this.onKey,this),r.dom.on("focus",this._aFocusCatchers,this.onCatchFocus,this),this.piContentWidth>0&&(this._eSizer.style.width=this.piContentWidth+"px"),this.pbVisible&&this._bViewVisible?this.show():this.positionPnl()}show(){this.pbVisible=!0,this.addSync("pbVisible"),this._bViewVisible&&this.doShow()}doShow(){const e=this;if(this._bVisible=!0,this._eElem.style.display="",this._eElem.parentNode.lastChild!==this._eElem&&this._eElem.parentNode.appendChild(this._eElem),(this.pbHideOnBlur&&r.sys.isMobile||this.pePosition===r.fpFloatLeftPushWebApp)&&(this._eMask||(this._eMask=r.dom.create('<div class="WebMenu_Mask">&nbsp;</div>'),this._eElem.parentNode.insertBefore(this._eMask,this._eElem),r.dom.on("click",this._eMask,this.onMaskTouch,this))),this.pePosition===r.fpFloatByControl){const e=this.getWebApp().findObj(this.psFloatByControl);e&&e._eElem&&(this._eBlurBuddy=e._eElem,r.events.addDomCaptureListener("blur",e._eElem,this.onCaptureBlur,this))}this.positionPnl(),this.afterShow(),this._tHideBlurTimeout&&(clearTimeout(this._tHideBlurTimeout),this._tHideBlurTimeout=null),r.dom.removeClass(e._eElem,"WebFP_Hidden"),r.dom.addClass(e._eElem,"WebFP_Visible"),setTimeout((function(){e._eElem&&(e.positionPnl(),e.pbFocusOnShow&&(e.focus()||e._eElem.focus()))}),20),this.pePosition===r.fpFloatByControl&&(this._tPositionInterval=setInterval((function(){e.positionPnl()}),500))}getFloatByRefElem(){let e=null;const t=this.getWebApp().findObj(this.psFloatByControl);return t&&(e=t._eElem,t.getTooltipElem&&(e=t.getTooltipElem()||e)),e}positionPnl(){let e,t,i,s=0,o=0,n=-1,a=0,l=!0;if(this._bVisible&&this._eElem){const h=this.getWebApp();let d=this.piWidth;t=this.piHeight;const p=r.dom.windowWidth(),u=r.dom.windowHeight();i=this._eElem.offsetHeight,t>i&&(i=t);const c=this._eElem.offsetWidth;if(this.pePosition===r.fpFloatByControl){if(this.psFloatByControl){const e=this.getFloatByRefElem();if(e){const t=r.sys.gui.getBoundRect(e);if(d<=0&&!this.pbNaturalWidth&&(d=t.width),s=t.bottom,o=t.left+t.width/2-(this.pbNaturalWidth?c:d)/2,o<5&&(o=5),a=t.left+t.width/2-o,!(t.top||t.left||t.width||t.height))return}else s=this.piTop,o=this.piLeft}d>p-20&&(d=p-20),o+d>p&&(o=-1,n=10,a=d-(p-e.right+e.width/2-n)),s+i>u&&(this.pbShrinkIfNoSpace,s+t>u&&(t>0?t=u-s-30:s=u-t>0?u-t:0)),this._eElem.style.top=s+"px",this._eElem.style.left=o>=0?o+"px":"",this._eElem.style.right=n>=0?n+"px":"",this._eArrow.style.left=a+"px",this.setOuterWidth(d),t>0?(this._eContainer.style.height=t+"px",this._eElem.style.maxHeight=""):(t=u-s-30,this._eContainer.style.height="",this._eElem.style.maxHeight=t+"px"),r.dom.toggleClass(this._eElem,"WebFP_ArrowTop",l),r.dom.toggleClass(this._eElem,"WebFP_ArrowBottom",!l)}this.pePosition!==r.fpFloatLeftSqueezeWebApp&&this.pePosition!==r.fpFloatLeftPushWebApp||(this._eElem.style.top=r.Designer?"17px":"0px",this._eElem.style.left="0px",this._eElem.style.bottom="0px",this._eElem.style.position="fixed",this._eContainer.style.height="100%",this.setOuterWidth(this.pbVisible&&this.pbRender?this.piWidth:0),h&&h._eElem&&(this.pePosition===r.fpFloatLeftSqueezeWebApp?h._eElem.style.marginLeft=(this.pbVisible&&this.pbRender?this.piWidth:0)+"px":(h._eElem.parentNode.style.overflow="hidden",h._eElem.style.transform="translateX("+(this.pbVisible&&this.pbRender?this.piWidth:0)+"px)"))),this.pePosition===r.fpFloatFixed&&(this._eElem.style.top=this.piTop>=0?this.piTop+"px":"",this._eElem.style.left=this.piLeft>=0?this.piLeft+"px":"",this._eElem.style.bottom=this.piBottom>=0?this.piBottom+"px":"",this._eElem.style.right=this.piRight>=0?this.piRight+"px":"",d>=0&&(this.pbShrinkIfNoSpace&&d+Math.max(this.piLeft,0)+Math.max(this.piRight,0)>p&&(d=p-Math.max(this.piLeft,0)-Math.max(this.piRight,0)),this.setOuterWidth(d)),(t>=0||this.piBottom>=0&&this.piTop>=0)&&(this._eContainer.style.height="100%"),t>=0&&(this.pbShrinkIfNoSpace&&t+Math.max(this.piTop,0)+Math.max(this.piBottom,0)>u&&(t=u-Math.max(this.piTop,0)-Math.max(this.piBottom,0)),this._eElem.style.height=t+"px",this._eElem.style.maxHeight=""))}else this._eElem&&(this._eElem.style.top="0px",this._eElem.style.left="0px",this._eElem.style.bottom="",this._eElem.style.right="",this._eElem.style.height="",this._eElem.style.maxHeight="");this.resizeHorizontal(),super.resizeVertical()}setInnerHeight(e){e>r.dom.clientHeight(this._eContainer)&&(e=r.dom.clientHeight(this._eContainer)),super.setInnerHeight(e)}set_piHeight(e){super.set_piHeight(e),this._eElem&&(this.piHeight=e,this.positionPnl())}set_piWidth(e){const t=this.getWebApp();this._eElem&&(this.setOuterWidth(e),this.pePosition===r.fpFloatLeftSqueezeWebApp&&this.pbVisible&&this.pbRender&&t&&t._eElem&&(t._eElem.style.marginLeft=e+"px"))}set_pbVisible(e){this._eElem&&this.pbVisible!==e&&(e?this.show():this.hide(!1,"manual"))}set_pbRender(e){this._eElem&&this.pbRender!==e&&(super.set_pbRender(e),this.pbRender=e,e&&this.pbVisible?this.show():this.hide(!1,"manual"))}set_pePosition(e){if(this._eElem&&this.pePosition!==e){const t=this.getWebApp();t&&t._eElem&&(e!==r.fpFloatLeftSqueezeWebApp&&this.pePosition===r.fpFloatLeftSqueezeWebApp&&(t._eElem.style.marginLeft=""),e!==r.fpFloatLeftPushWebApp&&this.pePosition===r.fpFloatLeftPushWebApp&&(t._eElem.parentNode.style.overflow="",t._eElem.style.transform="",this._eMask&&(r.dom.off("click",this._eMask,this.onMaskTouch,this),this._eMask.parentNode.removeChild(this._eMask),this._eMask=null))),this.pePosition=e,this.positionPnl()}}set_piContentWidth(e){this._eContainer&&(this._eSizer.style.width=e+"px",r.dom.toggleClass(this._eElem,"WebFP_FixedContentWidth",e>0))}set_pbHideOnBlur(e){this._aFocusCatchers&&this._aFocusCatchers.forEach((function(t){r.dom.setTabIndex(t,e?0:-1)}))}hide(e,t){this.pbVisible=!1,this.addSync("pbVisible"),this.doHide(e,t||"manual")}doHide(e,t){const i=this,s=this.getWebApp();this._tPositionInterval&&(clearInterval(this._tPositionInterval),this._tPositionInterval=null),r.dom.addClass(i._eElem,"WebFP_Hidden"),r.dom.removeClass(i._eElem,"WebFP_Visible"),e||this.positionPnl(),this.afterHide(),this._eMask&&(r.dom.off("click",this._eMask,this.onMaskTouch,this),this._eMask.parentNode.removeChild(this._eMask),this._eMask=null),this._eBlurBuddy&&r.events.removeDomCaptureListener("blur",this._eBlurBuddy,this.onCaptureBlur,this),this.pePosition===r.fpFloatLeftSqueezeWebApp&&s&&s._eElem&&(s._eElem.style.marginLeft="0px"),this.fire("OnHide",[t]),setTimeout((function(){!i.pbVisible&&i._eElem&&(i._eElem.style.display="none",i._bVisible=!1)}),1500)}showView(e){this._bViewVisible=!0,this.pbVisible&&this._eElem&&this.doShow()}hideView(e){this._bViewVisible=!1,this.pbVisible&&this.doHide(!0,"auto_view")}onCaptureFocus(e){this._tHideBlurTimeout&&(clearTimeout(this._tHideBlurTimeout),this._tHideBlurTimeout=null)}onCaptureBlur(e){const t=this;this._tHideBlurTimeout&&clearTimeout(this._tHideBlurTimeout),this._tHideBlurTimeout=setTimeout((function(){t.pbHideOnBlur&&t.hide(!0,"auto_blur"),t._tHideBlurTimeout=null}),150)}onMaskTouch(e){this.pbHideOnBlur&&this.hide(!1,"auto_blur")}resizeVertical(){this.positionPnl(),super.resizeVertical()}resize(){this._eElem&&this.positionPnl()}onKey(e){e.matchKey(r.settings.calendarKeys.close)&&this._bVisible&&(this.hide(!0,"auto_escape"),e.stop())}onCatchFocus(e){this.pbHideOnBlur&&this.hide(!1,"auto_tabout")}}class G extends w{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowWeekNr",!0),this.prop(r.tBool,"pbShowToday",!0),this.prop(r.tInt,"piStartWeekAt",1),this.event("OnDateClick",r.cCallModeWait),this.OnRealtimeChange=new r.events.JSHandler,this.OnEnter=new r.events.JSHandler,this._eBuddy=null,this._bBuddyActive=!0,this._eElem=null,this._eFocus=null,this._eBody=null,this._eDispMonth=null,this._eDispYear=null,this._dSelected=new Date,this._iWeekSelected=r.sys.data.dateToWeek(this._dSelected),this._iDisplayYear=this._dSelected.getFullYear(),this._iDisplayMonth=this._dSelected.getMonth(),this._iLastDisplayYear=this._iDisplayYear,this._iLastDisplayMonth=this._iDisplayMonth,this._aMonthNames=r.lang.monthsLong,this._aMonthNamesShort=r.lang.monthsShort,this._aDaysShort=r.lang.daysShort,this._aDaysLong=r.lang.daysLong,this._sControlClass="WebDatePicker",this.peDataType=r.ciTypeDate}create(){const e=this.getWebApp();this.psMask||e&&(this.psMask=e.psDateFormat)}openHtml(e){super.openHtml(e),e.push('<div class="WebDatePicker_FocusHolder" ',this.isEnabled()?'tabindex="0"':'tabindex="-1"',">"),e.push('<div class="WebDP">','<div class="WebDP_Wrp">','<div class="WebDP_Head">','<div class="WebDP_BtnPrev"><span></span></div>','<div class="WebDP_BtnNext"><span></span></div>','<div class="WebDP_BtnYear"><span></span><div class="WebDP_YearMnu"></div></div>','<div class="WebDP_BtnMonth"><span></span><div class="WebDP_MonthMnu"></div></div>','<div style="clear: both;"></div>',"</div>",'<div class="WebDP_Body">')}closeHtml(e){e.push("</div>"),e.push('<div class="WebDP_Footer"',this.pbShowToday?"":' style="display: none"',">",'<div class="WebDP_BtnToday">',this.getWebApp().getTrans("todayIs")," <span></span></div>","</div>"),e.push("</div>","</div>"),super.closeHtml(e),e.push("</div>")}afterRender(){this._eFocus=r.dom.query(this._eElem,"div.WebDatePicker_FocusHolder"),this._eBody=r.dom.query(this._eElem,"div.WebDP_Body"),this._eFooter=r.dom.query(this._eElem,"div.WebDP_Footer"),this._eDispMonth=r.dom.query(this._eElem,"div.WebDP_BtnMonth > span"),this._eDispYear=r.dom.query(this._eElem,"div.WebDP_BtnYear > span"),this._eDispToday=r.dom.query(this._eElem,"div.WebDP_BtnToday > span"),super.afterRender(),r.dom.on("click",this._eElem,this.onWrapClick,this),r.dom.on("click",this._eBody,this.onBodyClick,this),r.dom.on("click",r.dom.query(this._eElem,"div.WebDP_BtnNext"),this.onNextClick,this),r.dom.on("click",r.dom.query(this._eElem,"div.WebDP_BtnPrev"),this.onPrevClick,this),r.dom.on("click",r.dom.query(this._eElem,"div.WebDP_BtnMonth"),this.onMonthClick,this),r.dom.on("click",r.dom.query(this._eElem,"div.WebDP_BtnYear"),this.onYearClick,this),r.dom.on("click",r.dom.query(this._eElem,"div.WebDP_BtnToday"),this.onTodayClick,this),this._eBuddy&&(this._eFocus=this._eBuddy),r.events.addDomKeyListener(this._eFocus,this.onKey,this),r.dom.on("focus",this._eFocus,this.onFocus,this),r.dom.on("blur",this._eFocus,this.onBlur,this),this.update()}set_pbShowWeekNr(e){this.pbShowWeekNr=e,this.displayCalendar()}set_pbShowToday(e){this._eFooter&&(this._eFooter.style.display=e?"":"none")}set_piStartWeekAt(e){this.piStartWeekAt=e,this.update()}update(){this._eElem&&(r.dom.setText(this._eDispMonth,this._aMonthNames[this._iDisplayMonth]),r.dom.setText(this._eDispYear,this._iDisplayYear),r.dom.setText(this._eDispToday,r.sys.data.applyDateMask(new Date,this.psMask,this.getWebApp().psDateSeparator)),this.displayCalendar())}displayCalendar(){let e,t,i;const s=[];if(!this._eBody)return;s.push("<div><table>");const o=this._iDisplayYear,n=this._iDisplayMonth,a=new Date,l=new Date(o,n,1,1,1,1),h=new Date(o,n+1,1,1,1,1);s.push('<tr class="WebDP_BodyHead">'),this.pbShowWeekNr&&s.push('<th class="WebDP_WeekNr">',this.getWebApp().getTrans("wk"),"</th>");for(let i=0;i<7;i++)t="",e=i+this.piStartWeekAt>6?i+this.piStartWeekAt-7:i+this.piStartWeekAt,0!==e&&6!==e||(t="WebDP_Weekend"),s.push('<th class="',t,'">',this.getDay(i,!0),"</th>");for(s.push("</tr>"),e=l.getDay()-this.piStartWeekAt,e<0&&(e=7+e),l.setDate(l.getDate()-e),e=0,i=0,s.push("<tr>");l<h||e<7&&0!==e||i<6;)(0===e||e>6)&&(i>0&&s.push("</tr><tr>"),i++,this.pbShowWeekNr&&s.push('<td class="WebDP_WeekNr">',r.sys.data.dateToWeek(l),"</td>"),e=0),t="WebDP_Day",l.getMonth()!==n&&(t+=(""!==t?" ":"")+"WebDP_Overflow"),0!==l.getDay()&&6!==l.getDay()||(t+=(""!==t?" ":"")+"WebDP_Weekend"),l.getDate()===this._dSelected.getDate()&&l.getMonth()===this._dSelected.getMonth()&&l.getFullYear()===this._dSelected.getFullYear()&&(t+=(""!==t?" ":"")+"WebDP_Selected"+(this.bHasFocus?" focussed":"")),l.getDate()===a.getDate()&&l.getMonth()===a.getMonth()&&l.getFullYear()===a.getFullYear()&&(t+=(""!==t?" ":"")+"WebDP_Today"),s.push('<td class="',t,'" data-date="',l.getDate(),'" data-month="',l.getMonth(),'" data-year="',l.getFullYear(),'">',l.getDate(),"</td>"),l.setDate(l.getDate()+1),e++;if(s.push("</table></div>"),this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth===this._iDisplayMonth)this._eBody.innerHTML=s.join("");else{let e=r.dom.query(this._eBody,".WebDP_Old");e&&this._eBody.removeChild(e);const t=r.dom.create(s.join(""));e=this._eBody.firstChild,e&&(e.firstChild.style.width=e.firstChild.clientWidth+"px",e.firstChild.style.height=e.firstChild.clientHeight+"px",r.dom.addClass(e,"WebDP_Old")),this._eBody.appendChild(t),e&&r.dom.addClass(e,this._iLastDisplayYear<this._iDisplayYear||this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth<this._iDisplayMonth?"WebDP_HideNext":"WebDP_HidePrev")}this._iLastDisplayYear=this._iDisplayYear,this._iLastDisplayMonth=this._iDisplayMonth}setSelectedDate(e,t,i){e||(e=new Date,this.fireRTChange()),this._dSelected=e,this._iWeekSelected=r.sys.data.dateToWeek(this._dSelected),i||(this._iDisplayYear=this._dSelected.getFullYear(),this._iDisplayMonth=this._dSelected.getMonth(),t&&(this._iLastDisplayYear=this._iDisplayYear,this._iLastDisplayMonth=this._iDisplayMonth)),this.update()}getSelectedDate(){return new Date(this._dSelected.valueOf())}getDay(e,t){return(e+=this.piStartWeekAt)>6&&(e-=7),t?this._aDaysShort[e]:this._aDaysLong[e]}onMonthClick(e){let t,i;const s=[],o=this,n=r.dom.query(this._eElem,"div.WebDP_MonthMnu");function a(e){var t=e.getTarget();t.getAttribute("data-month")&&(this._iDisplayMonth=parseInt(t.getAttribute("data-month"),10),i(),this.update(),this.focus(),e.stop())}function l(e){clearTimeout(t)}function h(e){clearTimeout(t),t=setTimeout(i,1200)}if(i=function(){r.dom.off("click",n,a,this),r.dom.off("mouseover",n,l,this),r.dom.off("mouseout",n,h,this),n.style.display="none",clearTimeout(t),o._fMonthHide=null},this._fMonthHide)this._fMonthHide();else if(this.isEnabled()){this._fMonthHide=i,r.dom.on("click",n,a,this),r.dom.on("mouseover",n,l,this),r.dom.on("mouseout",n,h,this),s.push("<ul>");for(let e=0;e<12;e++){const t=e===this._iDisplayMonth?"WebDP_Current":"";s.push('<li data-month="',e,'" class="',t,'">',this._aMonthNames[e],"</li>")}s.push("</ul"),n.innerHTML=s.join(""),n.style.display="inline",t=setTimeout(i,2400),this.focus(),e.stop()}}onYearClick(e){let t,i,s,o,n,a;const l=[],h=this,d=r.dom.query(this._eElem,"div.WebDP_YearMnu");function p(e){var t=e.getTarget();t.getAttribute("data-year")&&(this._iDisplayYear=parseInt(t.getAttribute("data-year"),10),a(),this.update(),this.focus()),e.stop()}function u(e){clearTimeout(s)}function c(e){s=setTimeout(a,1200)}function g(){let e;e=t.nextSibling.getAttribute("data-year"),e--,i.parentNode.removeChild(i.previousSibling);const s=document.createElement("li");r.dom.setText(s,e),s.setAttribute("data-year",e),t.parentNode.insertBefore(s,t.nextSibling)}function _(){let e;e=i.previousSibling.getAttribute("data-year"),e++,t.parentNode.removeChild(t.nextSibling);const s=document.createElement("li");r.dom.setText(s,e),s.setAttribute("data-year",e),i.parentNode.insertBefore(s,i)}function m(e){let i;const s=e.getTarget();i=s===t?g:_,i(),o=setTimeout((function e(){i(),o=setTimeout(e,35)}),300),r.dom.addClass(s,s===t?"WebDP_UpDown":"WebDP_DownDown"),e.stop()}function b(e){clearTimeout(o),r.dom.removeClass(t,"WebDP_UpDown"),r.dom.removeClass(i,"WebDP_DownDown"),e.stop()}if(a=function(){d.style.display="none",r.dom.off("click",d,p,this),r.dom.off("mouseover",d,u,this),r.dom.off("mouseout",d,c,this),r.dom.off("mousedown",t,m,this),r.dom.off("mouseout",t,b,this),r.dom.off("mouseup",t,b,this),r.dom.off("mousedown",i,m,this),r.dom.off("mouseout",i,b,this),r.dom.off("mouseup",i,b,this),clearTimeout(s),h._fYearHide=null},this._fYearHide)this._fYearHide();else if(this.isEnabled()){this._fYearHide=a,l.push("<ul>"),l.push('<li class="WebDP_Up"></li>');for(let e=this._iDisplayYear-4;e<this._iDisplayYear+4;e++)n=e===this._iDisplayYear?"WebDP_Current":"",l.push('<li data-year="',e,'" class="',n,'">',e,"</li>");l.push('<li class="WebDP_Down"></li>'),l.push("</ul"),d.innerHTML=l.join(""),d.style.display="inline",t=r.dom.query(d,"li.WebDP_Up"),i=r.dom.query(d,"li.WebDP_Down"),r.dom.on("click",d,p,this),r.dom.on("mouseover",d,u,this),r.dom.on("mouseout",d,c,this),r.dom.on("mousedown",t,m,this),r.dom.on("mouseout",t,b,this),r.dom.on("mouseup",t,b,this),r.dom.on("mousedown",i,m,this),r.dom.on("mouseout",i,b,this),r.dom.on("mouseup",i,b,this),s=setTimeout(a,2400),this.focus(),e.stop()}}onNextClick(e){this.isEnabled()&&(this._iDisplayMonth++,this._iDisplayMonth>=12&&(this._iDisplayYear++,this._iDisplayMonth=0),this.update(),this.focus(),e.stop())}onPrevClick(e){this.isEnabled()&&(this._iDisplayMonth--,this._iDisplayMonth<0&&(this._iDisplayYear--,this._iDisplayMonth=11),this.update(),this.focus(),e.stop())}onBodyClick(e){const t=e.getTarget();if(this.isEnabled()&&t.getAttribute("data-date")){const i=new Date(parseInt(t.getAttribute("data-year"),10),parseInt(t.getAttribute("data-month"),10),parseInt(t.getAttribute("data-date"),10),1,1,1);this.focus(),this.setSelectedDate(i,!1,!1),this.fireRTChange(),this.fireEnter(),this.fireDateClick(),e.stop()}}onWrapClick(e){this.isEnabled()&&(this.focus(),e.stop())}onTodayClick(e){this.isEnabled()&&(this._dSelected=new Date,this._iDisplayYear=this._dSelected.getFullYear(),this._iDisplayMonth=this._dSelected.getMonth(),this.focus(),this.update(),this.fireRTChange(),this.fireEnter(),this.fireDateClick())}onKey(e){const t=new Date(this._dSelected.getTime());this._bBuddyActive&&this.isEnabled()&&(e.matchKey(r.settings.calendarKeys.dayUp)?(t.setDate(t.getDate()-7),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.dayDown)?(t.setDate(t.getDate()+7),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.dayLeft)?(t.setDate(t.getDate()-1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.dayRight)?(t.setDate(t.getDate()+1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.monthUp)?(t.setMonth(t.getMonth()+1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.monthDown)?(t.setMonth(t.getMonth()-1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.yearUp)?(t.setFullYear(t.getFullYear()+1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.yearDown)?(t.setFullYear(t.getFullYear()-1),this.setSelectedDate(t),this.fireRTChange(),e.stop()):e.matchKey(r.settings.calendarKeys.enter)&&(this.fireDateClick(),this.fireEnter()||e.stop()))}fireRTChange(){this.OnRealtimeChange.fire(this,{dValue:this.getSelectedDate()})}fireEnter(){return this.OnEnter.fire(this,{dValue:this.getSelectedDate()})}fireDateClick(){this.fire("OnDateClick",[this.get("psValue")])}refreshDisplay(e){this.peDataType!==r.ciTypeDate&&this.peDataType!==r.ciTypeDateTime||this.setSelectedDate(e,!0,!1)}updateTypeVal(){this.peDataType!==r.ciTypeDate&&this.peDataType!==r.ciTypeDateTime||(this._tValue=this.getSelectedDate())}applyEnabled(e){super.applyEnabled(e),this._eFocus&&r.dom.setTabIndex(this._eFocus,e?0:-1)}focus(){return!!(this._bFocusAble&&this.isEnabled()&&this._eFocus)&&(this._eFocus.focus(),this._bLozingFocus=!1,this.objFocus(),!0)}onFocus(e){this._bBuddyActive&&this._bFocusAble&&this.isEnabled()&&this._eFocus&&(this.objFocus(),this._eElem&&r.dom.addClass(this._eElem,"WebCon_Focus"),this._bHasFocus=!0,this._bLozingFocus=!1)}onBlur(e){const t=this;this._bBuddyActive&&(this._bLozingFocus=!0,this.fireChange(),setTimeout((function(){t._bLozingFocus&&(t.updateTypeVal(),t.fireAutoFind(),t._eElem&&r.dom.removeClass(t._eElem,"WebCon_Focus"),t._bLozingFocus=!1)}),100))}}class U extends N{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowWeekNr",!0),this.prop(r.tBool,"pbShowToday",!0),this.prop(r.tInt,"piStartWeekAt",1),this.prop(r.tBool,"pbAutoShow",!1),this.prop(r.tBool,"pbModal",!1),this.prop(r.tBool,"pbHtml5NativeOnMobile",!0),this.pbPromptButton=!0,this._ePickerWrp=null,this._eFocus=null,this._bPickerVisible=!1,this._bSkipAutoShow=!1,this._bShowWait=!1,this._iWidth=0,this._iHeight=0,this._tOnChange=null,this._sControlClass="WebForm WebDateForm",this._eParentRef=null}afterRender(){super.afterRender(),this.pbHtml5NativeOnMobile&&r.sys.isMobile&&r.sys.supportHtml5Input("date")&&(this._ePrompt.innerHTML='<div class="WebDF_HiddenDate"><input type="date"></div>',this._eHtml5HiddenDate=r.dom.query(this._ePrompt,"input"),r.dom.on("change",this._eHtml5HiddenDate,this.html5OnChange,this),r.dom.on("input",this._eHtml5HiddenDate,this.html5OnChange,this))}destroy(){this._oFloatingPanel&&(this._oFloatingPanel.destroy(),this._oFloatingPanel=null,this._oPicker=null),super.destroy()}set_pbShowWeekNr(e){this._oPicker&&this._oPicker.set("pbShowWeekNr",e)}set_pbShowToday(e){this._oPicker&&this._oPicker.set("pbShowToday",e)}set_piStartWeekAt(e){this._oPicker&&this._oPicker.set("piStartWeekAt",e)}setControlValue(e){super.setControlValue(e),this._eHtml5HiddenDate&&(this._eHtml5HiddenDate.value=this._tValue&&r.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-")||"")}html5OnChange(e){const t=this;this._tValue=r.sys.data.stringToDate(this._eHtml5HiddenDate.value,"yyyy-mm-dd","-"),this.refreshDisplay(this._tValue),this._tOnChange&&clearTimeout(this._tOnChange),this._tOnChange=setTimeout((function(){t.fireChange(),t._tOnChange=null}),150)}initPicker(){let e,t;t=this.pbModal?this._oFloatingPanel=this.createModalDialog():this._oFloatingPanel=this.createPanel(),this.configurePanel(t),t.create(),this._oPicker=e=this.createDatePicker(),this.configureDatePicker(e),e.create(),t.addChild(e)}createPanel(){return new z(null,this)}createModalDialog(){return new R(null,this)}configurePanel(e){e.psFloatByControl=this.getLongName(),e.piColumnCount=1,e.pbHideOnBlur=!0,e.pbFocusOnShow=!0,e.pbHideOnEscape=!0,e.pbNaturalWidth=!0,e.psCSSClass="NoWhitespace Shadow WebDateForm_FlPnl",e.OnHide.addListener(this.onPanelClose,this)}createDatePicker(){return new G(null,this)}configureDatePicker(e){e.pbShowLabel=!1,e.psValue=this.getServerVal(),e.piColumnSpan=0,e.pbShowWeekNr=this.pbShowWeekNr,e.pbShowToday=this.pbShowToday,e.piStartWeekAt=this.piStartWeekAt,e.psMask=this.getWebApp().psDateFormat,e.psCSSClass="WebDatePicker_Form NoWhitespace",e.OnRealtimeChange.addListener(this.onPickerChange,this),e.OnEnter.addListener(this.onPickerEnter,this)}renderPicker(){const e=this._oFloatingPanel,t=e.render();t&&this._eElem.parentNode.insertBefore(t,this._eElem),e.afterRender(),e.resizeHorizontal(),e.resizeVertical()}showPicker(){this._oFloatingPanel||this.initPicker(),this._oFloatingPanel._eElem||this.renderPicker(),this._oPicker._bBuddyActive=!0,this._oPicker.set("psValue",this.getServerVal()),this._oFloatingPanel.show(),this.pbModal&&this._oFloatingPanel.floatByControl(),this._bPickerVisible=!0}hideDatePicker(e){this._bPickerVisible=!1,this._oFloatingPanel&&(this._oPicker._bBuddyActive=!1,this._oFloatingPanel.hide())}firePrompt(){if(this.isEnabled()&&!this.pbReadOnly)return this._eHtml5HiddenDate?(this.updateTypeVal(),this._tValue?this._eHtml5HiddenDate.value=r.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-"):this._eHtml5HiddenDate.value="",!0):(this.showPicker(),!0)}onPickerChange(e){this._tValue=e.dValue,this.refreshDisplay(e.dValue)}onPickerEnter(e){this.peDataType!==r.ciTypeDate&&this.peDataType!==r.ciTypeDateTime||(this._tValue=e.dValue,this.refreshDisplay(this._tValue)),this.hideDatePicker(),this.focus(),this.fireChange()}onPanelClose(e){const t=e.aParams[0];this.fireChange(),"auto_blur"!==t&&(this._bSkipAutoShow=!0,this.focus())}onFocus(e){super.onFocus(e),this.pbAutoShow&&this.isEnabled()&&!this.pbReadOnly&&!this._bSkipAutoShow&&this.showPicker(),this._bSkipAutoShow=!1}}r.tQueuedSyncProp={sO:r.tString,sP:r.tString,bA:r.tBool,sV:r.tString,tVT:{}},r.tSyncPropsWrapper={bReset:r.tBool,aSyncProps:[{sO:r.tString,aP:[{sN:r.tString,sV:r.tString}]}]},r.tAdvSyncPropsWrapper={bReset:r.tBool,aAdvSyncProps:[{sO:r.tString,sP:r.tString,tV:{}}]};class K extends(C(b)){}class j extends K{constructor(e,t){super(e,t),this.prop(r.tAdv,"ptSyncPropsWrapper",null),this.prop(r.tAdv,"ptAdvSyncPropsWrapper",null),this.addSync("ptSyncPropsWrapper"),this.addSync("ptAdvSyncPropsWrapper"),this._aSyncPropQueue=[],this._bReset=!1,this._aSyncPropCache=[],this._aAdvSyncPropCache=[],this._sBaseClass="WebControl",this._sControlClass="WebDynCon"}getRef(){super.getRef(),this._eControl=r.dom.query(this._eElem,"div.WebCon_Inner > div")}getMinHeight(){let e=0;return this.resize(),e=this.pbScroll?this.pbFillHeight?this.piMinHeight:Math.max(this.piHeight,this.piMinHeight):this.getRequiredHeight(),this._eControl&&(e+=r.sys.gui.getVertBoxDiff(this._eControl),e+=r.sys.gui.getVertBoxDiff(this._eInner),e+=r.sys.gui.getVertBoxDiff(this._eControlWrp)),e<this.piMinHeight&&(e=this.piMinHeight),e}setHeight(e,t){this._eControl&&(e>0?(e=(e-=this.getVertHeightDiff())<0?0:e,this._eContainer.style.height=e+"px"):this._eContainer.style.height="")}wrpOpenHtml(e){e.push('<div class="WebContainer">')}wrpCloseHtml(e){e.push("</div>")}loadQueuedSyncProps(){const e=this._tActionData;let t;for(let i=0;i<e.length;i++)t=e[i],this._aSyncPropQueue.push(t)}loadDynamicObjects(){const e=this._tActionData;for(let t=0;t<e.length;t++){const i=e[t];this.initDynamicObject(i,this,!1)._oOwner=this}this._eElem&&(this.renderChildren(),this.afterRender(),this.position(),this.getWebApp().resize()),this.emptyPropCache()}insertDynamicObject(e,t){const i=this._tActionData,s=this.getWebApp().findObj(e)||this,o=s[t]||null,n=this.initDynamicObject(i,s,!0);if(this._eElem){const e=null!==o?s._aChildren.indexOf(o)+1:0;s.insertChild(n,e),s.renderChild(n),this.getWebApp().resize()}}insertDynamicObjectAtIndex(e,t){const i=this._tActionData,s=this.getWebApp().findObj(e)||this,o=this.initDynamicObject(i,s,!0);this._eElem&&(s.insertChild(o,t),s.renderChild(o),this.getWebApp().resize())}prependDynamicObject(e){const t=this._tActionData,i=this.getWebApp().findObj(e)||this,s=this.initDynamicObject(t,i,!0);this._eElem&&(i.insertChild(s,0),i.renderChild(s),this.getWebApp().resize())}appendDynamicObject(e){const t=this._tActionData,i=this.getWebApp().findObj(e)||this,s=this.initDynamicObject(t,i,!0);if(this._eElem){const e=i._aUIObjects.length;i.insertChild(s,e),i.renderChild(s),this.getWebApp().resize()}}moveDynamicObject(e,t){const i=this.getWebApp(),s=i.findObj(e),o=i.findObj(t),n=o._oParent,r=s._oParent,a=s._eElem;s._oParent=n,r.removeChild(s);const l=null!==o?n._aChildren.indexOf(o)+1:0;n.insertChild(s,l,o),n.renderChild(s,a);const h=s.getObjectLevel();for(let e=0;e<h;e++)i.resize()}moveDynamicObjectToIndex(e,t,i){const s=this.getWebApp(),o=s.findObj(e),n=s.findObj(t),r=o._oParent,a=o._eElem;o._oParent=n,r.removeChild(o),n.insertChild(o,i),n.renderChild(o,a);let l=o.getObjectLevel();for(let e=0;e<l;e++)s.resize()}destroyDynamicObject(e){const t=this.getWebApp().findObj(e),i=t._oParent;i.removeChild(t),i.unrenderChild(t),t.destroy();const s=i.getObjectLevel();for(let e=0;e<s;e++)this.getWebApp().resize()}initDynamicObject(e,t,i){let s,o;const n=this.getWebApp();if(t[e.sName])throw new r.Error(999,"Naming conflict with child object '{{0}}'",this,[e.sName]);{const i=n.getConstructor(e.sType,e);if("function"!=typeof i)throw new r.Error(999,"Could not find class '{{0}}'",this,[e.sType]);t[e.sName]=o=new i(e.sName,t)}o._bIsDynamic=!0;for(let t=0;t<e.aProps.length;t++){if(s=e.aProps[t].sN,"_"===s.charAt(0))throw new r.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[e.aProps[t].sV,e.sName]);if(o[s]&&("object"==typeof o[s]||"function"==typeof o[s]))throw new r.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[s,e.sName]);o._set(s,e.aProps[t].sV,!1,!1)}if(e.aAdvP)for(let t=0;t<e.aAdvP.length;t++){if(s=e.aAdvP[t].sN,"_"===s.charAt(0))throw new r.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[e.aAdvP[t].sV,e.sName]);if(o[s]&&("object"==typeof o[s]||"function"==typeof o[s]))throw new r.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[s,e.sName]);o._oTypes[s]||(o._oTypes[s]=r.tAdv),o._set(s,e.aAdvP[t].tV,!1,!1)}this.applyQueuedSyncProps(o),o._oOwner=this,i||n.newWebObject(o,t);for(let t=0;t<e.aObjs.length;t++)this.initDynamicObject.call(this,e.aObjs[t],o,!1);return o.create(e),o}resetContainer(){for(let e=0;e<this._aChildren.length;e++)this._aChildren[e].destroy();this._aChildren=[],this._aFloats=[],this._aUIObjects=[],this._aPanels=[],this._aSyncPropQueue=[],this._bReset=!1,this.getWebApp().resize()}applyQueuedSyncProps(e){let t;const i=this._aSyncPropQueue.filter((function(t){return t.sO===e.getLongName()}));this._aSyncPropQueue=this._aSyncPropQueue.filter((function(t){return t.sO!==e._sName}));for(let s=0;s<i.length;s++){const o=i[s];t=o.bA?o.tVT:o.sV,e._set(o.sP,t,!0,!0)}}emptyPropCache(){this.handleSyncProps(this._aSyncPropCache),this.handleAdvSyncProps(this._aAdvSyncPropCache),this._aSyncPropCache=[],this._aAdvSyncPropCache=[]}getSynced(e,t){const i=[],s=this.getLongName();for(const e in this._oSynced)if(this._oSynced.hasOwnProperty(e)){let o=this.get(e);this._oTypes[e]&&(o=this.toServerType(o,this._oTypes[e])),void 0===o&&(o=null),this._oTypes[e]===r.tAdv?t.push({sO:s,sP:e,tV:o}):i.push({sN:e,sV:o})}i.length>0&&e.push({sO:s,aP:i})}handleSyncProps(e){const t=this.getWebApp();for(let i=0;i<e.length;i++){const s=e[i],o=t.findObj(s.sO);if(o)for(let e=0;e<s.aP.length;e++)o._set(s.aP[e].sN,s.aP[e].sV,!0,!0)}}handleAdvSyncProps(e){const t=this.getWebApp();for(let i=0;i<e.length;i++){const s=e[i],o=t.findObj(s.sO);o&&o._set(s.sP,s.tV,!0,!0)}}set_ptSyncPropsWrapper(e){const t=r.sys.vt.deserialize(e,r.tSyncPropsWrapper);t.bReset?(this._bReset=!0,this._aSyncPropCache=this._aSyncPropCache.concat(t.aSyncProps)):this.handleSyncProps(t.aSyncProps)}get_ptSyncPropsWrapper(){const e=[],t=[];for(let i=0;i<this._aChildren.length;i++)this._aChildren[i].getSynced(e,t);for(let t=0;t<e.length;t++)e[t].aP.sort((function(e,t){return e.sN>t.sN?1:t.sN>e.sN?-1:0}));const i={bReset:this._bReset,aSyncProps:e};return r.sys.vt.serialize(i,r.tSyncPropsWrapper)}set_ptAdvSyncPropsWrapper(e){const t=r.sys.vt.deserialize(e,r.tAdvSyncPropsWrapper);for(var i=0;i<e.c[1].c.length;i++)t.aAdvSyncProps[i].tV=e.c[1].c[i].c[2];t.bReset?(this._bReset=!0,this._aAdvSyncPropCache=this._aAdvSyncPropCache.concat(t.aAdvSyncProps)):this.handleAdvSyncProps(t.aAdvSyncProps)}get_ptAdvSyncPropsWrapper(){const e=[],t=[];for(var i=0;i<this._aChildren.length;i++)this._aChildren[i].getSynced(e,t);for(var s=0;s<t.length;s++)t[s].aP.sort((function(e,t){return e.sN>t.sN?1:t.sN>e.sN?-1:0}));const o={bReset:this._bReset,aAdvSyncProps:t};return r.sys.vt.serialize(o,r.tAdvSyncPropsWrapper)}getLongNamePrnt(e){if(e?._bIsDynamic)return this.getLongName()+"$";super.getLongNamePrnt(e)}onFocus(e){}onBlur(e){}serializeAdvSyncProps(e){function t(e){return{v:"",c:[{v:e.sO.toString(),c:[]},{v:e.sP.toString(),c:[]},this.serializeVT(e.tV)]}}function i(e){const i={v:"",c:[]};for(let s=0;s<e.length;s++)i.c.push(t(e[s]));return i}try{return function(e){const t={v:"",c:[]};for(let o=0;o<e.length;o++)t.c.push({v:"",c:[{v:(s=e[o]).sO.toString(),c:[]},i(s.aP)]});var s;return t}(e)}catch(e){throw new r.Error(999,"Unable to serialize AdvSyncProps array, invalid data format!\n\r\n\rMSG: {{0}}",this,[e.message])}}}class q extends w{constructor(e,t){super(e,t),this.prop(r.tString,"psChecked","1"),this.prop(r.tString,"psUnchecked","0"),this.prop(r.tString,"psCaption",""),this.pbServerOnChange=!1,this.psClientOnChange="",this._eCaption=null,this._sControlClass="WebCheckbox"}openHtml(e){super.openHtml(e),e.push('<input type="checkbox" id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled" tabindex="-1"','><span class="WebCB_Fake"></span><label class="WebCheckbox_Caption" for="',this._sControlId,'"></label>'),this._oParent?._bIsContainer&&this._oParent?.isFlowLayout()&&e.push('<div style="clear: both"></div>')}afterRender(){this._eControl=r.dom.query(this._eElem,"input"),this._eCaption=r.dom.query(this._eElem,"label.WebCheckbox_Caption"),this._eFakeBox=r.dom.query(this._eElem,".WebCB_Fake"),this.set_psCaption(this.psCaption),super.afterRender(),r.dom.on("click",this._eControl,this.onClick,this),r.dom.on("click",this._eFakeBox,this.onFakeClick,this)}getControlValue(){return this._eControl?this._eControl.checked?this.psChecked:this.psUnchecked:this.psValue}setControlValue(e){this._eControl&&(this._eControl.checked=e===this.psChecked)}set_psValue(e){super.set_psValue(e),this._sPrevChangeVal=this.get_psValue()}set_psCaption(e){this._eCaption&&(r.dom.setText(this._eCaption,e),this.psCaption!==e&&this.sizeChanged())}set_psTextColor(e){this._eCaption&&(this._eCaption.style.color=e||"")}set_psToolTip(e){super.set_psToolTip(e),this._eFakeBox&&(this._eFakeBox.title=e),this._eCaption&&(this._eCaption.title=e)}tick(){this._eControl&&this.isEnabled()&&(this._eControl.checked=!this._eControl.checked,this.fireChange())}onClick(e){this.fireChange()}onFakeClick(e){this.isEnabled()&&(this.tick(),this.focus(),this.fireChange())}}r.tWebComboItem={sValue:r.tString,sDescription:r.tString};class Z extends w{constructor(e,t){super(e,t),this.prop(r.tInt,"peSortItems",r.csUnsorted),this._bFilled=!1,this._sControlClass="WebCombo",this._aValues=null,this._bDeferedSet=!1}openHtml(e){super.openHtml(e),e.push('<div class="WebFrm_Wrapper"><select name="',this._sName,'" id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled" tabindex="-1"',"></select></div>")}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebFrm_Wrapper > select"),this._eWrap=r.dom.query(this._eElem,"div.WebFrm_Wrapper"),super.afterRender(),r.dom.on("click",this._eControl,this.onClick,this),this.updateList(this.psValue)}deserializeVT=r.sys.vt.generateDeserializer([r.tWebComboItem]);fill(){const e=this._tActionData;this._aValues=this.deserializeVT(e),this.sortList(),this.updateList(this._sPrevChangeVal)}sortList(){if(this.peSortItems===r.csValue){const e=r.sys.data.compareFunction(this.peDataType);this._aValues.sort((function(t,i){return e(t.sValue,i.sValue)}))}else this.peSortItems===r.csDescription&&this._aValues.sort((function(e,t){return r.sys.data.compareText(e.sDescription,t.sDescription)}))}updateList(e){const t=this._aValues;if(this._eControl&&t){for(;this._eControl.options.length>0;)this._eControl.remove(0);for(let i=0;i<t.length;i++){const s=new Option(t[i].sDescription,t[i].sValue);this._eControl.options[this._eControl.options.length]=s,t[i].sValue===e&&(s.selected=!0)}this._bFilled=!0}}getControlValue(){return this._eControl&&this._bFilled?this._eControl.value:this.psValue}setControlValue(e){this._eControl&&this._bFilled?(this._eControl.value=e,this._bDeferedSet=this._eControl.value!==e):this._bDeferedSet=!0}fireChange(){this._bDeferedSet=!1,super.fireChange()}set_pbCapslock(e){}set_psBackgroundColor(e){this._eWrap&&(this._eWrap.style.background=e||"")}onClick(e){this.fireChange()}onKey(e){const t=this;super.onKey(e),setTimeout((function(){t.fireChange()}),10)}}class Y extends N{constructor(e,t){super(e,t),this.prop(df.tBool,"pbCaseSensitive",!1),this.prop(df.tBool,"pbFullText",!1),this.prop(df.tInt,"piPageSize",15),this.prop(df.tInt,"piStartAtChar",2),this.prop(df.tInt,"piPopupWidth",0),this.prop(df.tString,"psShowMoreText","Show more..."),this.prop(df.tString,"psCreateNewItemText","Create new item"),this.prop(df.tBool,"pbSourceIsValidationTable",!1),this.prop(df.tInt,"piMinimumItemLength",2),this.prop(df.tBool,"pbAllowCreate",!1),this.prop(df.tInt,"piTypeTimeout",20),this.prop(df.tBool,"pbAllData",!1),this.prop(df.tBool,"pbSuggestions",!1),this.prop(df.tBool,"pbPaged",!1),this._eSuggestions=null,this._bForceDisplay=!1,this._tRepos=null,this._aSuggestRows=[],this._aShownSuggestions=[],this._oSelectedSuggestion=null,this._iMaxCells=1,this._bFirstFetch=!0,this._TotalOfControlRows=0,this._ShowNextHandle=!1,this._iPage=0,this._iAdditionalItems=0,this._oPrevItem=null}afterRender(){this._eSuggestions=df.dom.create('<div class="WebBaseSelectionForm WebSuggestions'+(this.psCSSClass.length>0?" "+this.psCSSClass:"")+' WebSug_Hidden"><div class="WebSug_Content"></div></div>'),this._eSugContent=df.dom.query(this._eSuggestions,"div.WebSug_Content"),this._eSugSuggestions=df.dom.create('<div class="WebSug_Suggestions"></div>'),this._eSugControls=df.dom.create('<div class="WebSug_Controls"></div>'),this._eSugContent.appendChild(this._eSugSuggestions),this._eSugContent.appendChild(this._eSugControls),this._eInputBox=df.dom.query(this._eElem,".WebFrm_PromptSpacer"),this._eControl=df.dom.query(this._eInputBox,"input"),super.afterRender(),df.dom.addClass(this._eElem,"WebSelectionForm");(this.topLayer()||document.body).appendChild(this._eSuggestions),df.dom.on("keyup",this._eControl,this.onSuggestKey,this),df.dom.on("click",this._eSuggestions,this.onSuggestClick,this),df.dom.on("click",this._eInputBox,this.inputBoxOnClick,this),df.dom.on("resize",window,this.onWindowResize,this),this.set_pbReadOnly(this.pbReadOnly),this.set_pbEnabled(this.isEnabled())}getSearchValue(){return this.pbReadOnly?"":this.pbCapslock?this.getServerVal().toUpperCase():this.getServerVal()}applyEnabled(e){super.applyEnabled(e),!this._eControl||this.pbReadOnly&&e||(this._eControl.contentEditable=e)}set_pbReadOnly(e){this.pbReadOnly=e,this._eControl&&(this.pbReadOnly||this.isEnabled())&&(this._eControl.contentEditable=!this.pbReadOnly),this.set_pbPromptButton(this.pbPromptButton&&!e)}inputBoxOnClick(e){"Range"!=window.getSelection().type&&this.isEnabled()&&(this._eControl.focus(),e.stop())}suggestSelect(){const e=this.getSearchValue().trim();if(this._oSelectedSuggestion&&this._oSelectedSuggestion.control)switch(this._oSelectedSuggestion.sRowId){case"more":return this.handleMoreButton(),void this.suggestMove(-1);case"create":if(!(this.isEnabled()&&this.pbAllowCreate&&e.length>=this.piMinimumItemLength))return;this.serverAction("CreateNewByValue",[e],null,null)}else this.isEnabled()&&1==this.pbAllowCreate&&e.length>=this.piMinimumItemLength&&this.serverAction("CreateNewByValue",[e],null,null);this._eControl.value="",this.suggestHide()}handleMoreButton(){this._bLastItemOnServer||this._bMoreRequested||(this._bMoreRequested=!0,this.pbPaged&&this._iPage++,this.suggestLoad())}onSuggestClick(e){let t=e.getTarget();for(;"TR"!==t.tagName&&t.parentNode&&t!==this._eSugContent;)t=t.parentNode;if(t.hasAttribute("data-dfrowid")){let e=this._aShownSuggestions[parseInt(t.getAttribute("data-dfrowid"))];e&&(this.suggestHightlight(e),this.suggestSelect(),this.focus())}}suggestUpdate(){this.updateTypeVal();const e=this.getSearchValue().trim();if(e!==this._sSuggestPrevVal||this._bForceDisplay)if(this._sSuggestPrevVal=e,e.length>=this.piStartAtChar||this._bForceDisplay){if(this._bSuggestVisible&&this._sSuggestBaseVal&&e.substr(0,this._sSuggestBaseVal.length)==this._sSuggestBaseVal)return void this.suggestRefine(e);this.suggestDisplay(),this.suggestLoad()}else this._bSuggestVisible&&this.suggestHide()}clientFilter(e,t){const i=[],s=this.getSearchValue(),o=new RegExp(df.sys.data.escapeRegExp(s),this.pbCaseSensitive||this.pbCapslock?"":"i");for(let n=0;n<e.length;n++)if(e[n].control)i.push(e[n]);else for(let r=0;r<e[n].aValues.length;r++)if(this.pbFullText){if(o.test(e[n].aValues[r])){i.push(e[n]),t&&t(e[n]);break}}else if(this.pbCaseSensitive||this.pbCapslock){if(0==e[n].aValues[r].indexOf(s)){i.push(e[n]),t&&t(e[n]);break}}else if(0==e[n].aValues[r].toLowerCase().indexOf(s.toLowerCase())){i.push(e[n]),t&&t(e[n]);break}return this.extraFilterOnHandle?this.extraFilterOnHandle(i):i}suggestHandle(e,t){const i=this;let s,o;this._bFirstFetch=!1,this._bMoreRequested=!1,this._bLastItemOnServer=1==t;const n=this._tActionData;if(this.updateTypeVal(),this._eControl&&(s=this.getSearchValue()),s!==e){if(s.substr(0,e)!=e)return;o=!0}this._iMaxCells=0;for(let e=0;e<n.length;e++)n[e].aValues.length>this._iMaxCells&&this._iMaxCells++;var r;this._sSuggestBaseVal=e,this._iPage>0&&this.pbPaged?this._aSuggestRows=this._aSuggestRows.concat(n):this._aSuggestRows=n,this._oPrevItem=this._aSuggestRows[this._aSuggestRows.length-1];let a=this.clientFilter(this._aSuggestRows,(function(e){r=r||i._oSelectedSuggestion&&e.aValues[0]==i._oSelectedSuggestion.aValues[0]}));r||(this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null),this._TotalOfControlRows=this.AddControlSuggestions(a);let l=-1;this._oSelectedSuggestion&&(l=this.findIndexByValue(this._oSelectedSuggestion.aValues[0],a)),this._oSelectedSuggestion=l<0?a.length>0?a[0]:null:a[l],o?this.suggestRefine(s):this.suggestRender(e),this._ShowNextHandle&&(this._ShowNextHandle=!1,this.showSuggestions())}AddControlSuggestions(e){const t=e.length,i=this.getSearchValue().trim();!this._bLastItemOnServer&&this.pbPaged&&e.length>0&&!this.pbAllData&&e.push({control:!0,sRowId:"more",aValues:["("+this.psShowMoreText+")"],sCssClassName:"Sugg_ControlSuggestion"});let s=!0;return this._aShownSuggestions&&(s=!(this._aShownSuggestions.length>0&&this._aShownSuggestions[0].aValues[0]==i)),s&&this.pbAllowCreate&&i.length>0&&e.push({control:!0,sRowId:"create",aValues:["("+this.psCreateNewItemText+(i.length>0?' "'+df.dom.encodeAttr(df.dom.encodeHtml(i))+'"':"")+")"],sCssClassName:"Sugg_ControlSuggestion"}),e.length-t}suggestRender(e){if(!this._eSuggestions)return;let t,i,s;this.pbFullText?s=new RegExp(df.sys.data.escapeRegExp(e),this.pbCaseSensitive||this.pbCapslock?"g":"gi"):(t=e.toLowerCase(),i=e.length);const o=this;function n(e,n,r){function a(e){return"<b>"+e+"</b>"}let l=0;for(r.push('<tr data-dfrowid="',e,'" class="WebSug_Suggestion ',n.sCssClassName,o._oSelectedSuggestion&&n.aValues[0]==o._oSelectedSuggestion.aValues[0]?" WebSug_Selected":"",'">'),l=0;l<n.aValues.length;l++){const e=df.dom.encodeHtml(n.aValues[l]);r.push("<td>"),n.control||o.pbSourceIsValidationTable&&0!=l?r.push(e):o.pbFullText?r.push(e.replace(s,a)):e.length>0&&e.substr(0,i).toLowerCase()==t?r.push("<b>",e.substr(0,i),"</b>",e.substr(i)):r.push(e),r.push("</td>")}for(;l++<o._iMaxCells;)r.push("<td></td>");r.push("</tr>")}const r=[];this._aShownSuggestions=this.clientFilter(this._aSuggestRows),this._TotalOfControlRows=this.AddControlSuggestions(this._aShownSuggestions);const a=[];a.push("<table>");const l=this.pbSuggestions?this._aShownSuggestions.length<this.piPageSize?this._aShownSuggestions.length:this.piPageSize:this._aShownSuggestions.length;for(let e=0;e<l;e++)this._aShownSuggestions[e].control?r.push({iIndex:e,oObj:this._aShownSuggestions[e]}):n(e,this._aShownSuggestions[e],a);a.push("</table>");const h=[];h.push("<table>");for(let e=0;e<this._TotalOfControlRows;e++)n(r[e].iIndex,r[e].oObj,h);h.push("</table>"),this._eSugSuggestions.innerHTML=a.join(""),this._eSugControls.innerHTML=h.join(""),this.suggestPosition()}suggestRefine(e){const t=this;let i=!1;this._aShownSuggestions=this.clientFilter(this._aSuggestRows,(function(e){i=i||t._oSelectedSuggestion&&e.aValues[0]==t._oSelectedSuggestion.aValues[0]})),i||(this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null),this.suggestRender(e),this._bSuggestVisible&&this.suggestDisplay(),this.afterSuggestRefine()}afterSuggestRefine(e){this._aShownSuggestions.length-this._TotalOfControlRows<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged&&this.handleMoreButton()}suggestMove(e){const t=this._aShownSuggestions=this.clientFilter(this._aSuggestRows);if(this._TotalOfControlRows=this.AddControlSuggestions(t),this._oSelectedSuggestion){const i=this.findIndexByValue(this._oSelectedSuggestion.aValues[0],t)+e;i>=t.length?i=0:i<0&&(i=t.length-1),this.suggestHightlight(t[i])}else this.suggestHightlight(t.length>0?t[0]:null)}suggestHightlight(e){let t;this._oSelectedSuggestion=e,this._aShownSuggestions=this.clientFilter(this._aSuggestRows),this._TotalOfControlRows=this.AddControlSuggestions(this._aShownSuggestions);for(let e=0;e<this._aShownSuggestions.length&&(t=this._oSelectedSuggestion&&this._aShownSuggestions[e].aValues[0]==this._oSelectedSuggestion.aValues[0],!t);e++);t||(this._oSelectedSuggestion=this._aShownSuggestions.length>0?this._aShownSuggestions[0]:null),this.updateTypeVal(),this.suggestRender(this.getSearchValue());const i=df.dom.query(this._eSugSuggestions,"tr.WebSug_Selected");if(i){const e=df.sys.gui.getAbsoluteOffset(i).top,t=e+i.offsetHeight;e-this._eSugSuggestions.scrollTop<0?this._eSugSuggestions.scrollTop=e:t>this._eSugSuggestions.clientHeight+this._eSugSuggestions.scrollTop&&(this._eSugSuggestions.scrollTop=t-this._eSugSuggestions.clientHeight)}}findSuggestionByValue(e){const t=this.findIndexByValue(e,this._aSuggestRows);return-1!=t?this._aSuggestRows[t]:null}findIndexByValue(e,t){for(let i=0;i<t.length;i++)if(t[i].aValues[0]==e)return i;return-1}onSuggestKey(e){const t=df.settings.suggestionKeys,i=e.getKeyCode();this.isEnabled()&&!this.pbReadOnly?(e.matchKey(t.forceDisplay)&&(this._bForceDisplay=!0,this._bSuggestVisible||this.suggestDisplay(),e.stop()),(this._bSuggestVisible||this.getSearchValue().length>0||!e.isSpecialKey()&&(i<112||i>127))&&this.suggestUpdate(),this._bForceDisplay=!1):e.stop()}suggestLoad(e){const t=this;e&&(this._overrideDoLoad=e,this.invalidateCache()),df.dom.addClass(this._eSuggestions,"WebSug_Loading"),this._eElem&&df.dom.addClass(this._eElem,"WebSug_Loading"),this._tSuggestUpdate||(this._tSuggestUpdate=setTimeout((function(){t._tSuggestUpdate=null,t.updateTypeVal(),t.suggestDoLoad(t.getSearchValue()),t._bSuggestVisible&&t.suggestDisplay()}),this.piTypeTimeout))}suggestDoLoad(e){this.pbAllData&&(e=""),!this.pbAllData||0===this._aSuggestRows.length||this._overrideDoLoad?(this._overrideDoLoad=!1,!this._bSuggestLoading&&this.isEnabled()?(this._bSuggestLoading=!0,this.serverAction("FindSuggestions",[e,this._iPage,this._iAdditionalItems],this._oPrevItem,(function(){this._bSuggestLoading=!1,this._sSuggestNextLoad?(this.suggestDoLoad(this._sSuggestNextLoad),this._sSuggestNextLoad=null):(this._eSuggestions&&df.dom.removeClass(this._eSuggestions,"WebSug_Loading"),this._eElem&&df.dom.removeClass(this._eElem,"WebSug_Loading"),this._bSuggestVisible&&this.suggestDisplay())}),this)):this._sSuggestNextLoad=e):this.suggestHightlight(this._oSelectedSuggestion)}suggestDisplay(){const e=df.dom.query(this._eSugSuggestions,"tbody"),t=df.dom.query(this._eSugControls,"tbody");if(e){if(0==e.childNodes.length&&0==t.childNodes.length)return void this.suggestHide()}else if(!this._bFirstFetch){let e=!0;if(t&&t.childNodes.length>0&&(e=!1),e)return this.suggestHide(),void(this._ShowNextHandle=!0)}if(this.isEnabled()){df.dom.addClass(this._eSuggestions,"WebSug_Visible"),df.dom.removeClass(this._eSuggestions,"WebSug_Hidden");let i=0;if(e){let s=e.childNodes.length>this.piPageSize?this.piPageSize:e.childNodes.length;if(s>0){i=df.sys.gui.getBoundRect(e.childNodes[0]).height*s}else{let e=!0;if(t&&t.childNodes.length>0&&(e=!1),e)return void this.suggestHide()}}this._eSugSuggestions.style.height=i+"px",this.suggestPosition(),this.suggestHightlight(this._oSelectedSuggestion),this._bSuggestVisible=!0}}suggestPosition(){const e=this._eSuggestions,t=this._eWrap;if(e&&t)if(df.sys.gui.isOnScreen(t)){e.style.display="";const i=df.sys.gui.getBoundRect(t),s=i.bottom,o=i.left;i.left+(this.piPopupWidth>0?this.piPopupWidth:i.width)>window.innerWidth&&(o=window.innerWidth-(this.piPopupWidth>0?this.piPopupWidth:i.width)),e.style.top=s+"px",e.style.left=o+"px",e.style.width=(this.piPopupWidth>0?this.piPopupWidth:i.width)+"px",i.bottom+this._eSugSuggestions.clientHeight>window.innerHeight&&(e.style.top=i.top-this._eSuggestions.clientHeight+"px")}else e.style.display="none"}suggestHide(){this._eSuggestions&&(df.dom.addClass(this._eSuggestions,"WebSug_Hidden"),df.dom.removeClass(this._eSuggestions,"WebSug_Visible"),this._tSuggestDisplay&&(clearTimeout(this._tSuggestDisplay),this._tSuggestDisplay=null),this._tSuggestUpdate&&(clearTimeout(this._tSuggestUpdate),this._tSuggestUpdate=null),this._oSelectedSuggestion=null),this.updateTypeVal(),this._sSuggestPrevVal=this.getSearchValue(),this._bSuggestVisible=!1,this._bForceDisplay=!1}invalidateCache(){this.pbAllData||(this._iPage=0,this._bLastItemOnServer=!1)}showSuggestions(){this._bForceDisplay=!0,this.suggestDisplay(),this.suggestUpdate(),this.focus()}onKey(e){const t=df.settings.suggestionKeys;this.isEnabled()&&!this.pbReadOnly?(e.bCanceled||super.onKey(e),e.bCanceled||(e.matchKey(t.escape)&&this._bSuggestVisible?this.suggestHide():e.matchKey(t.select)?(this.suggestSelect(),e.stop()):e.matchKey(t.moveUp)?(this._bSuggestVisible||this.showSuggestions(),this.suggestMove(-1),e.stop()):e.matchKey(t.moveDown)?(this._bSuggestVisible||this.showSuggestions(),this.suggestMove(1),e.stop()):(this.invalidateCache(),(e.matchKey(t.backSpace)||e.matchKey(t.delete))&&this.getSearchValue().length<=1&&this.suggestLoad()),e.matchKey(t.forceDisplay)&&e.stop())):e.stop()}onWindowResize(e){const t=this;this._tRepos||setTimeout((function(){t._bSuggestVisible&&t.suggestPosition(),t._tRepos=null}),40),this._bSuggestVisible&&this.suggestPosition()}onBlur(e){const t=this;super.onBlur(e),this._tSugBlurTimeout&&(clearTimeout(this._tSugBlurTimeout),this._tSugBlurTimeout=null),this._tSugBlurTimeout=setTimeout((function(){t._bHasFocus||t.suggestHide(),t.afterBlur&&t.afterBlur()}),500)}onPromptClick(e){this.isEnabled()&&!this.pbReadOnly&&(this.objFocus(),this.firePrompt()?e.stopPropagation():(this.focus(),this._bSuggestVisible?this.suggestHide():this.showSuggestions()))}}class J extends N{constructor(e,t){super(e,t),this.prop(r.tString,"psPopupCSSClass",""),this.prop(r.tInt,"peSuggestionMode",r.smFind),this.prop(r.tBool,"pbCaseSensitive",!1),this.prop(r.tBool,"pbAllowForce",!0),this.prop(r.tBool,"pbFullText",!1),this.prop(r.tBool,"pbHighlight",!0),this.prop(r.tBool,"pbShowResults",!0),this.prop(r.tInt,"piMaxResults",15),this.prop(r.tInt,"piStartAtChar",2),this.prop(r.tInt,"piSuggestionWidth",0),this.prop(r.tBool,"pbClientRefinement",!0),this.prop(r.tInt,"piPopupTimeout",50),this.prop(r.tInt,"piTypeTimeout",20),this.event("OnHideSuggestions",r.cCallModeDefault),this._eSuggestions=null,this._bForceDisplay=!1,this._tRepos=null,this._aScrollListeners=null,this._sSelectedId=null}openHtml(e){super.openHtml(e)}afterRender(){super.afterRender(),r.dom.on("keyup",this._eControl,this.onSuggestKey,this)}initDOM(){this._eSuggestions=r.dom.create('<div class="WebSuggestions WebSug_Hidden '+this.psPopupCSSClass+'"><div class="WebSug_Content"></div><div>'),this._eSugContent=r.dom.query(this._eSuggestions,"div.WebSug_Content");(this.topLayer()||document.body).appendChild(this._eSuggestions),r.dom.on("click",this._eSuggestions,this.onSuggestClick,this)}suggestUpdate(){const e=this;this.updateTypeVal();const t=this.getServerVal();if(t!==this._sSuggestPrevVal||this._bForceDisplay)if(this._sSuggestPrevVal=t,t.length>=this.piStartAtChar||this._bForceDisplay){if(this._bSuggestVisible){if(this.pbClientRefinement&&this._sSuggestBaseVal&&t.substr(0,this._sSuggestBaseVal.length)===this._sSuggestBaseVal)return void this.suggestRefine(t)}else this._tSuggestDisplay||(this._tSuggestDisplay=setTimeout((function(){e._tSuggestDisplay=null,e.suggestDisplay()}),this.piPopupTimeout));this.suggestLoad()}else this._bSuggestVisible&&this.suggestHide()}suggestLoad(){const e=this;this.pbShowResults&&(this._eSuggestions||this.initDOM(),r.dom.addClass(this._eSuggestions,"WebSug_Loading")),this._eElem&&r.dom.addClass(this._eElem,"WebSug_Loading"),this._tSuggestUpdate||(this._tSuggestUpdate=setTimeout((function(){e._tSuggestUpdate=null,e.updateTypeVal(),e.suggestDoLoad(e.getServerVal())}),this.piTypeTimeout))}suggestDoLoad(e){this._bSuggestLoading?this._sSuggestNextLoad=e:(this._bSuggestLoading=!0,this.serverAction("FindSuggestions",[e],null,(function(){this._bSuggestLoading=!1,this._sSuggestNextLoad?(this.suggestDoLoad(this._sSuggestNextLoad),this._sSuggestNextLoad=null):(this._eSuggestions&&r.dom.removeClass(this._eSuggestions,"WebSug_Loading"),this._eElem&&r.dom.removeClass(this._eElem,"WebSug_Loading"))}),this))}suggestHandle(e){let t,i=!1;const s=this._tActionData;this.updateTypeVal();const o=this.getServerVal();if(o!==e){if(!this.pbClientRefinement||o.substr(0,e)!==e)return;t=!0}this._sSuggestBaseVal=e,this._aSuggestBase=this._aSuggestRows=s;for(let e=0;e<s.length;e++)s[e].sRowId===this._sSelectedId&&(i=!0);i||(this._sSelectedId=s.length>0?s[0].sRowId:null),t?this.suggestRefine(o):this.suggestRender(e)}suggestDisplay(){this.isEnabled()&&(this.pbShowResults&&(this._eSuggestions||this.initDOM(),this._aSuggestRows||(this._eSugContent.innerHTML=""),this.suggestPosition(),r.dom.addClass(this._eSuggestions,"WebSug_Visible"),r.dom.removeClass(this._eSuggestions,"WebSug_Hidden"),this.suggestPosition(),r.dom.on("resize",window,this.onWindowResize,this),this._aScrollListeners=r.sys.gui.addScrollListeners(this._eWrap,this.onWindowResize,this)),this._bSuggestVisible=!0)}suggestPosition(){const e=this._eSuggestions,t=this._eWrap;if(e&&t)if(r.sys.gui.isOnScreen(t)){e.style.display="";const i=r.sys.gui.getBoundRect(t),s=i.bottom;let o=i.left;i.left+(this.piSuggestionWidth>0?this.piSuggestionWidth:i.width)>window.innerWidth&&(o=window.innerWidth-(this.piSuggestionWidth>0?this.piSuggestionWidth:i.width)),e.style.top=s+"px",e.style.left=o+"px",e.style.width=(this.piSuggestionWidth>0?this.piSuggestionWidth:i.width)+"px",i.bottom+this._eSugContent.clientHeight>window.innerHeight?this._eSuggestions.style.bottom="0px":this._eSuggestions.style.bottom=""}else e.style.display="none"}suggestHide(){this._eSuggestions&&(r.dom.addClass(this._eSuggestions,"WebSug_Hidden"),r.dom.removeClass(this._eSuggestions,"WebSug_Visible"),this._tSuggestDisplay&&(clearTimeout(this._tSuggestDisplay),this._tSuggestDisplay=null),this._tSuggestUpdate&&(clearTimeout(this._tSuggestUpdate),this._tSuggestUpdate=null),this.updateTypeVal(),this._sSuggestPrevVal=this.getServerVal(),r.dom.off("resize",window,this.onWindowResize,this),this._aScrollListeners&&r.sys.gui.removeScrollListeners(this._aScrollListeners,this),this._aSuggestRows=null,this._sSelectedId=null),this.fire("OnHideSuggestions",[]),this._bSuggestVisible=!1,this._bForceDisplay=!1}suggestRender(e){let t,i,s;const o=[],n=this._aSuggestRows;function a(e){return"<b>"+e+"</b>"}if(this._eSuggestions){this.pbHighlight&&(this.pbFullText?s=new RegExp(r.sys.data.escapeRegExp(e),this.pbCaseSensitive?"g":"gi"):(t=e.toLowerCase(),i=e.length)),o.push("<table>");for(let e=0;e<n.length;e++){o.push('<tr data-suggestnr="',e,'" class="WebSug_Suggestion ',n[e].sRowId===this._sSelectedId?"WebSug_Selected":"",'">');for(let l=0;l<n[e].aValues.length;l++){const h=n[e].aValues[l];o.push("<td>"),!this.pbHighlight||this.peSuggestionMode===r.smValidationTable&&0!==l?o.push(h):this.pbFullText?o.push(h.replace(s,a)):h.substr(0,i).toLowerCase()===t?o.push("<b>",h.substr(0,i),"</b>",h.substr(i)):o.push(h),o.push("</td>")}o.push("</tr>")}o.push("</table>"),this._eSugContent.innerHTML=o.join(""),this.suggestPosition()}}suggestRefine(e){let t=!0,i=!1;const s=[],o=this._aSuggestBase;if(this.pbFullText){const t=new RegExp(r.sys.data.escapeRegExp(e),this.pbCaseSensitive?"":"i");for(let e=0;e<o.length;e++)for(let n=0;n<(this.peSuggestionMode!==r.smValidationTable?o[e].aValues.length:1);n++)if(t.test(o[e].aValues[n])){s.push(o[e]),i=i||o[e].sRowId===this._sSelectedId;break}this._aSuggestRows=s,this.suggestRender(e),o.length>=this.piMaxResults&&s.length<this.piMaxResults&&this.suggestLoad()}else{const n=e.toLowerCase(),a=e.length;for(let l=0;l<o.length;l++)!this.pbCaseSensitive&&o[l].aValues[0].substr(0,a).toLowerCase()===n||this.pbCaseSensitive&&o[l].aValues[0].substr(0,a)===e?(s.push(o[l]),i=i||o[l].sRowId===this._sSelectedId):s.length>0&&(t=this.peDataType===r.ciTypeBCD);this._aSuggestRows=s,i||(this._sSelectedId=s.length>0?s[0].sRowId:null),this.suggestRender(e),o.length>=this.piMaxResults&&t&&e!==this._sSuggestBaseVal&&this.suggestLoad()}}suggestSelect(){let e=null;const t=this._aSuggestRows;if(this._sSelectedId){for(let i=0;i<t.length;i++)if(t[i].sRowId===this._sSelectedId){e=t[i];break}e&&(this.updateTypeVal(),this.serverAction("SelectSuggestion",[this.getServerVal()],[e],(function(e){this.suggestHide()})))}}suggestMove(e){let t;const i=this._aSuggestRows;if(this._sSelectedId){for(t=0;t<i.length&&i[t].sRowId!==this._sSelectedId;t++);t+=e,t=t>=0?t<i.length?t:i.length-1:0,this.suggestHightlight(i[t].sRowId)}else this.suggestHightlight(i.length>0?i[0].sRowId:null)}suggestHightlight(e){this._sSelectedId=e,this.updateTypeVal(),this.suggestRender(this.getServerVal());const t=r.dom.query(this._eSugContent,"tr.WebSug_Selected");if(t){const e=r.sys.gui.getAbsoluteOffset(t).top,i=e+t.offsetHeight;e-this._eSuggestions.scrollTop<0?this._eSuggestions.scrollTop=e:i>this._eSuggestions.clientHeight+this._eSuggestions.scrollTop&&(this._eSuggestions.scrollTop=i-this._eSuggestions.clientHeight)}}onSuggestClick(e){let t=e.getTarget();for(;"TR"!==t.tagName&&t.parentNode&&t!==this._eSugContent;)t=t.parentNode;if(t.hasAttribute("data-suggestnr")){const e=parseInt(t.getAttribute("data-suggestnr"),10);this._aSuggestRows[e]&&(this.suggestHightlight(this._aSuggestRows[e].sRowId),this.suggestSelect(),this.focus())}}showSuggestions(){this._bForceDisplay=!0,this._bSuggestVisible||this.suggestDisplay(),this.suggestUpdate(),this.focus()}onKey(e){const t=r.settings.suggestionKeys;super.onKey(e),e.bCanceled||(this._bSuggestVisible&&this.pbShowResults&&(e.matchKey(t.escape)?this.suggestHide():e.matchKey(t.select)?(this.suggestSelect(),e.stop()):e.matchKey(t.moveUp)?(this.suggestMove(-1),e.stop()):e.matchKey(t.moveDown)&&(this.suggestMove(1),e.stop())),e.matchKey(t.forceDisplay)&&this.pbAllowForce&&e.stop())}onSuggestKey(e){const t=r.settings.suggestionKeys,i=e.getKeyCode();e.matchKey(t.forceDisplay)&&this.pbAllowForce&&(this._bForceDisplay=!0,this._bSuggestVisible||this.suggestDisplay(),e.stop()),(this._bSuggestVisible||!e.isSpecialKey()&&(i<112||i>127))&&this.suggestUpdate(),this._bForceDisplay=!1}onWindowResize(e){const t=this;this._tRepos||setTimeout((function(){t.suggestPosition(),t._tRepos=null}),40),this.suggestPosition()}onBlur(e){const t=this;super.onBlur(e),this._tSugBlurTimeout&&(clearTimeout(this._tSugBlurTimeout),this._tSugBlurTimeout=null),this._tSugBlurTimeout=setTimeout((function(){t._bHasFocus||t.suggestHide()}),500)}set_psPopupCSSClass(e){this._eSuggestions&&(this._eSuggestions.className="WebSuggestions "+(this._bSuggestVisible?"WebSug_Visible":"WebSug_Hidden")+e)}}class X extends Y{constructor(e,t){super(e,t),this.prop(r.tInt,"piTagTruncateAt",60),this.prop(r.tBool,"pbTagOnSpace",!1),this.prop(r.tBool,"pbAllowTagSelection",!0),this.prop(r.tString,"psSeparator",","),this.event("OnTagClick",r.cCallModeDefault,"privateOnTagClick"),this.event("OnAddTag",r.cCallModeDefault,"privateOnAddTag"),this.event("OnRemoveTag",r.cCallModeDefault,"privateOnRemoveTag"),this._aSelectedSuggestions=[],this._sSelectedTag=null,this._oSelectedTag=null,this._aTagCssClass={}}openHtml(e){b.prototype.openHtml.call(this,e),e.push('<div class="WebFrm_Wrapper"><div class="WebFrm_PromptSpacer">','<span class="WebDynFrm WebTgf_Placeholder">',this.peLabelPosition!=r.ciLabelFloat?r.dom.encodeAttr(r.dom.encodeHtml(this.psPlaceHolder)):"","</span>",'<span class="WebDynFrm WebTgfInput" name="',this._sName,'" id="',this._sControlId,'" role="textbox" tabindex="0"',' contenteditable="true"></span>')}closeHtml(e){e.push('</div><span class="WebFrm_Prompt"></span></div>'),b.prototype.closeHtml.call(this,e)}setPlaceHolderVisibility(e){this.setVisibility(this._ePlaceHolder,e)}setInputVisibility(e){this.setVisibility(this._eControl,e)}setVisibility(e,t){e.style.display=t?"":"none"}getVisibility(e){return"none"!=e.style.display}focusInputField(){if(this.pbReadOnly||!this.isEnabled())return;(0===this._aSelectedSuggestions.length||this.getVisibility(this._ePlaceHolder))&&this.setPlaceHolderVisibility(!1);const e=this;this._tFocus||(this._tFocus=setTimeout((function(){e._tFocus&&(e._eControl.focus(),e._tFocus=null)}),1))}blurInputField(){this._tFocus=null,(0===this._eControl.value.length&&0===this._aSelectedSuggestions.length||this.getVisibility(this._ePlaceHolder))&&this.setPlaceHolderVisibility(!0)}afterRender(){this._eSuggestions=r.dom.create('<div class="WebBaseSelectionForm WebSuggestions'+(this.psCSSClass.length>0?" "+this.psCSSClass:"")+' WebSug_Hidden"><div class="WebSug_Content"></div></div>'),this._eSugContent=r.dom.query(this._eSuggestions,"div.WebSug_Content"),this._eSugSuggestions=r.dom.create('<div class="WebSug_Suggestions"></div>'),this._eSugControls=r.dom.create('<div class="WebSug_Controls"></div>'),this._eSugContent.appendChild(this._eSugSuggestions),this._eSugContent.appendChild(this._eSugControls),this._eInputBox=r.dom.query(this._eElem,".WebFrm_PromptSpacer"),this._ePlaceHolder=r.dom.query(this._eElem,".WebTgf_Placeholder");const e=this;this._eControl=this._eControl=r.dom.query(this._eInputBox,".WebTgfInput"),Object.defineProperty(this._eControl,"value",{get:()=>e._eControl.innerText,set(t){e._eControl.innerText=t}}),Object.defineProperty(this._eControl,"keypress",{get:()=>e._eControl.keydown,set(t){e._eControl.keydown=t}}),this._eControl.select=function(){e._eControl.focus()},r.dom.on("focusin",this._eInputBox,this.focusInputField,this),r.dom.on("click",this._eInputBox,this.focusInputField,this),r.dom.on("blur",this._eControl,this.blurInputField,this),this.blurInputField(),this._ePrompt=r.dom.query(this._eElem,"div.WebFrm_Wrapper span.WebFrm_Prompt"),this._eWrap=r.dom.query(this._eElem,"div.WebFrm_Wrapper"),b.prototype.afterRender.call(this),r.dom.on("click",this._ePrompt,this.onPromptClick,this),this.set_pbPromptButton(this.pbPromptButton),r.dom.addClass(this._eElem,"WebSelectionForm");(this.topLayer()||document.body).appendChild(this._eSuggestions),r.dom.on("keyup",this._eControl,this.onSuggestKey,this),r.dom.on("click",this._eSuggestions,this.onSuggestClick,this),r.dom.on("click",this._eInputBox,this.inputBoxOnClick,this),r.dom.on("resize",window,this.onWindowResize,this),r.dom.addClass(this._eElem,"WebTagsForm"),this.aSelectionCache&&this.setCachedTags(),r.dom.on("click",this._eInputBox,this.removeTagSelection,this),this.set_pbReadOnly(this.pbReadOnly),this.set_pbEnabled(this.isEnabled()),this.validateAsSeparator(this.psSeparator),this.dragDropInit()}set_pbEnabled(e){let t=e!==this.isEnabled();super.set_pbEnabled(e),t&&this.setControlValue(this.getControlValue())}validateAsSeparator(e){if(1!==e.length)throw new r.Error(871,"Invalid psSeparator; requires length of just one character.");return!0}set_psSeparator(e){e!==this.psSeparator&&this.validateAsSeparator(e)&&(this.psSeparator=e)}set_pbReadOnly(e){let t=e!==this.pbReadOnly;super.set_pbReadOnly(e),t&&this.setControlValue(this.getControlValue())}removeTagSelection(){this._sSelectedTag&&this._oSelectedTag&&r.dom.removeClass(this._oSelectedTag,"WebTgf_Focus"),this._sSelectedTag=null,this._oSelectedTag=null}setTagSelection(e){this.removeTagSelection(),this._sSelectedTag=e,this._oSelectedTag=r.dom.query(this._eInputBox,".WebTgf_Tag[data-dfrowid='"+this._sSelectedTag.aValues[0].replaceAll("'","\\'")+"']"),r.dom.addClass(this._oSelectedTag,"WebTgf_Focus")}getSearchValue(){let e=this._eControl.value;return this.pbCapslock?e.toUpperCase():e}getControlValue(){let e=[],t="\\"+this.psSeparator;for(let i=0;i<this._aSelectedSuggestions.length;i++)this._aSelectedSuggestions[i].control||e.push(this._aSelectedSuggestions[i].aValues[0].replaceAll(this.psSeparator,t));return e.join(this.psSeparator)}parseSelectionValues(e){let t=[],i=-1,s=-1,o=0;for(;(i=e.indexOf(this.psSeparator,s+1))>=0;){let n=!0,r=i;for(;--r>=0&&"\\"===e.charAt(r);)n=!n;if(n){let s=e.substr(o,i-o);s=s.replaceAll("\\"+this.psSeparator,this.psSeparator).trim(),s.length>0&&(t.push(s),o=i+1)}s=i}let n=e.substr(o,e.length-o);return n=n.replaceAll("\\"+this.psSeparator,this.psSeparator).trim(),n.length>0&&t.push(n),t}setControlValue(e){this.aSelectionCache=this.parseSelectionValues(e),this._eInputBox&&this.setCachedTags()}suggestHandle(e,t){super.suggestHandle(e,t),this._aSuggestRows.length-this._aSelectedSuggestions.length<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged&&this.handleMoreButton()}AddControlSuggestions(e){let t=e.length,i=this.getSearchValue().trim();!this._bLastItemOnServer&&this.pbPaged&&e.length>0&&!this.pbAllData&&e.push({control:!0,sRowId:"more",aValues:["("+this.psShowMoreText+")"],sCssClassName:"Sugg_ControlSuggestion"});let s=!0;return this._aShownSuggestions&&(s=!(this._aShownSuggestions.length>0&&this._aShownSuggestions[0].aValues[0]==i)),s&&(s=this.getSelectedSuggestionId(i)<0),s&&this.pbAllowCreate&&i.length>0&&e.push({control:!0,sRowId:"create",aValues:["("+this.psCreateNewItemText+(i.length>0?" '"+i+"'":"")+")"],sCssClassName:"Sugg_ControlSuggestion"}),e.length-t}afterSuggestRefine(e){this._aShownSuggestions.length-this._TotalOfControlRows-this._aSelectedSuggestions.length<this.piPageSize&&!this._bLastItemOnServer&&this.pbPaged&&this.handleMoreButton()}setCachedTags(){this.clearTags();for(let e=0;e<this.aSelectionCache.length;e++)this.addTag({sRowId:e.toString(),aValues:[this.aSelectionCache[e]],sCssClassName:""});this.setPlaceHolderVisibility(0===this._eControl.value.length&&0==this.aSelectionCache.length),this.updateTypeVal()}truncate(e,t,i){if(e.length<=t)return e;if(0==t)return e;let s=e.substr(0,t);return(i&&-1!=s.lastIndexOf(" ")?s.substr(0,s.lastIndexOf(" ")):s)+"&hellip;"}setTagCssClass(e,t){this._aTagCssClass[e]=" "+t.trim(),this.updateTypeVal(),this.refreshDisplay(this._tValue)}suggestSelect(){if(this._oSelectedSuggestion&&!this._oSelectedSuggestion.control){let e=this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);if(e)return this.addTag(e),this.fireEx({sEvent:"OnAddTag",tActionData:e,oEnv:this}),this.updateTypeVal(),this.focusInputField(),this._eControl.value="",void this.suggestHide()}super.suggestSelect(),this.focusInputField()}extraFilterOnHandle(e){return this._aSelectedSuggestions.forEach((function(t){for(let i=0;i<e.length;i++)e[i].aValues[0]==t.aValues[0]&&e.splice(i--,1)})),e}addTag(e){this._aSelectedSuggestions.push(e);let t=!1;this._sSelectedTag&&this.isEnabled()&&this._sSelectedTag.aValues[0]==e.aValues[0]&&(t=!0);var i=r.dom.create('<div class="WebTgf_Tag'+(t?" WebTgf_Focus":"")+(this._aTagCssClass[e.aValues[0]]?this._aTagCssClass[e.aValues[0]]:"")+'" data-dfrowid="'+r.dom.encodeAttr(e.aValues[0])+'"'+(this.pbDragDropEnabled&&this.isSupportedDragAction(r.dragActions.WebTagsForm.ciDragTag)?' draggable="true"':"")+'>                 <span class="WebTgf_Text">'+r.dom.encodeHtml(this.truncate(e.aValues[0],this.piTagTruncateAt,!1))+"</span>"+(this.isEnabled()&&!this.pbReadOnly?'<span class="WebTgf_CloseTag">x</span> ':"")+"</div>");let s=this._eInputBox.insertBefore(i,this._eControl);t&&(this._oSelectedTag=i),r.dom.on("mousedown",s,(function(e){if("Range"==window.getSelection().type)return;let t=e.getTarget();for(;!t.classList.contains("WebTgf_Tag")&&!t.classList.contains("WebTgf_CloseTag");)t=t.parentNode;if(this.isEnabled())if(t.classList.contains("WebTgf_CloseTag")&&!this.pbReadOnly)t=t.parentNode,this.removeTag(t.getAttribute("data-dfrowid")),this.blurInputField(),this.removeTagSelection();else if(t.classList.contains("WebTgf_Tag")){let e=this.getSelectedSuggestionId(t.getAttribute("data-dfrowid"));if(e<0)throw new r.Error(999,"Could not refind the clicked tag.");this.removeTagSelection(),this.pbAllowTagSelection&&(this.setTagSelection(this._aSelectedSuggestions[e]),this.focus()),this.fireEx({sEvent:"OnTagClick",tActionData:this._aSelectedSuggestions[e],oEnv:this})}}),this),this.pbSuggestions&&this._iAdditionalItems++,this.sizeChanged()}clearTags(){const e=this;this._aSelectedSuggestions=[],this._eInputBox&&this._eInputBox.querySelectorAll(".WebTgf_Tag").forEach((function(t){e._eInputBox.removeChild(t)})),this._iAdditionalItems=0}removeTag(e){let t=r.dom.query(this._eInputBox,".WebTgf_Tag[data-dfrowid='"+e.replaceAll("'","\\'")+"']");if(t){let i=this.getSelectedSuggestionId(e),s=this._aSelectedSuggestions[i];this._aSelectedSuggestions.splice(i,1),t.parentNode.removeChild(t),this.updateTypeVal(),this.fireEx({sEvent:"OnRemoveTag",tActionData:s,oEnv:this}),this.sizeChanged()}this._bSuggestVisible&&this.suggestHide(),this.pbSuggestions&&this._iAdditionalItems--,this.suggestLoad()}getSelectedSuggestionId(e){for(let t=0;t<this._aSelectedSuggestions.length;t++)if(this._aSelectedSuggestions[t].aValues[0]==e)return t;return-1}onKey(e){function t(e,t){const i=document.createRange(),s=window.getSelection();0!=e.childNodes.length&&(i.setStart(e.childNodes[0],t),i.collapse(!0),s.removeAllRanges(),s.addRange(i))}function i(e){let t,i=0;if(window.getSelection){const s=window.getSelection();s.rangeCount&&(t=s.getRangeAt(0),t.commonAncestorContainer.parentNode==e&&(i=t.endOffset))}else if(document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.parentElement()==e)){var s=document.createElement("span");e.insertBefore(s,e.firstChild);var o=t.duplicate();o.moveToElementText(s),o.setEndPoint("EndToEnd",t),i=o.text.length}return i}if(e.e.ctrlKey)switch(e.e.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:return e.stop(),!1}if(["<",">","'","/"].indexOf(e.e.key)>-1)return e.stop(),this._eControl.value+=e.e.key,void t(this._eControl,this._eControl.value.length);const s=r.settings.suggestionKeys;if(this.isEnabled()&&!this.pbReadOnly)switch(e.e.key){case"Enter":if(!this._bSuggestVisible)return void e.stop();e.e.shiftKey&&(this._oSelectedSuggestion=null),this.suggestSelect(),e.stop();break;case" ":case"Spacebar":if(!this.pbTagOnSpace||e.e.ctrlKey)break;this.suggestSelect(),e.stop()}if(super.onKey(e),!e.bCanceled||this.pbReadOnly){if("ArrowLeft"!=e.e.key&&"Left"!=e.e.key||!this.pbAllowTagSelection)if("ArrowRight"!=e.e.key&&"Right"!=e.e.key||!this.pbAllowTagSelection)!this.isEnabled()||this.pbReadOnly||"Backspace"!=e.e.key&&"Delete"!=e.e.key||0!=this.getSearchValue().length&&!this._sSelectedTag||!this.pbAllowTagSelection?this.removeTagSelection():(this._sSelectedTag?(this.removeTag(this._sSelectedTag.aValues[0]),this.removeTagSelection()):this._aSelectedSuggestions.length>0&&this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length-1]),e.stop());else{if(this._aSelectedSuggestions.length<=0)return;if(this._sSelectedTag){let i=this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);if(this.removeTagSelection(),i>=this._aSelectedSuggestions.length-1)return this.removeTagSelection(),this._eControl.focus(),t(this._eControl,0),void e.stop();i++,this.setTagSelection(this._aSelectedSuggestions[i]),e.stop()}else i(this._eControl)==this.getSearchValue().length&&(this.setTagSelection(this._aSelectedSuggestions[0]),e.stop())}else{if(this._aSelectedSuggestions.length<=0)return;if(this._sSelectedTag){let i=this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);if(this.removeTagSelection(),!(i>0))return this.removeTagSelection(),this._eControl.focus(),t(this._eControl,this.getSearchValue().length),void e.stop();i--,this.setTagSelection(this._aSelectedSuggestions[i]),e.stop()}else 0==i(this._eControl)&&(this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length-1]),e.stop())}e.matchKey(s.forceDisplay)&&e.stop()}}createTag(){let e=this._tActionData;if(-1==e.aValues[0]&&(e.aValues[0]=this._aSelectedSuggestions.length.toString()),-1!=this.getSelectedSuggestionId(e.aValues[0]))throw new r.Error(871,"Id already in use.");this.addTag(e),this.fireEx({sEvent:"OnAddTag",tActionData:e,oEnv:this}),this.updateTypeVal(),this.suggestDoLoad(this.getSearchValue()),this.suggestHide()}afterBlur(){if(this._sSelectedTag){const e=this;this._tUnselectTag||(this._tUnselectTag=setTimeout((function(){e._tUnselectTag=null,e._bHasFocus||(r.dom.removeClass(e._oSelectedTag,"WebTgf_Focus"),e._sSelectedTag=null,e._oSelectedTag=null)}),500))}}determineSelectorForWebUIContext(e){return e===r.WebUIContext.WebUIContextTagsFormTag?".WebTgf_Tag[data-dfrowid]":null}retrieveValueFromWebUIContext(e,t){switch(t){case r.WebUIContext.WebUIContextTagsFormTag:if(!e.hasAttribute("data-dfrowid"))break;return e.getAttribute("data-dfrowid")}return null}getDragData(e,t){try{return[{data:t.getAttribute("data-dfrowid")},r.dragActions.WebTagsForm.ciDragTag]}catch(e){return console.error("Attempt to perform unsupported drag action"),[null,null]}}getDropData(e,t){if(e&&e._eDropElem){const t=r.dom.query(e._eDropElem,".WebTgf_Text");let i="";t&&(i=t.innerText);return{data:i,action:r.dropActions.WebTagsForm.ciDropOnInput}}return null}initDraggableElements(){}initDropZones(){if(this._aDropZones=[],super.initDropZones(),this.isSupportedDropAction(r.dropActions.WebTagsForm.ciDropOnInput)){const e=r.dom.query(this._eElem,".WebFrm_Wrapper");this.addDropZone(e)}}determineDropCandidate(e,t){if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebControl.ciDropOnControl))))return[this._eElem,r.dropActions.WebControl.ciDropOnControl];if(!t.find((e=>e.supportsDropAction(this,r.dropActions.WebTagsForm.ciDropOnInput))))return[null,null];let i=document.elementFromPoint(e.e.clientX,e.e.clientY)?.closest(".WebTgf_Tag");if(!i){const e=r.dom.query(this._eElem,".WebTgf_Tag",!0);i=e.length>0&&e[e.length-1]||null}return i&&(i.hasAttribute("data-dfdropplaceholder")&&(i.previousElementSibling?.hasAttribute("data-dfrowid")?i=i.previousElementSibling:i.nextElementSibling?.hasAttribute("data-dfrowid")&&(i=i.nextElementSibling)),i)?[i,r.dropActions.WebTagsForm.ciDropOnInput]:[null,null]}determineDropPosition(e,t){const i=r.sys.gui.getBoundRect(t),s=i.right-i.width/2;return e.e.clientX>=s?r.dropPositions.ciDropAfter:r.dropPositions.ciDropBefore}interactWithDropElem(e,t){if(e._eDropAction==r.dropActions.WebControl.ciDropOnControl)e.highlightElement();else{let i=document.createElement("div");i.innerHTML='<span class="WebTgf_Text">DROP</span><span class="WebTgf_CloseTag">x</span> ',r.dom.addClass(i,"WebTgf_Tag WebTgf_DropPlaceHolder"),i.setAttribute("data-dfrowid","empty_placeholder"),e.insertElement(i,t)}}doEmptyInteraction(e){if(this.isSupportedDropAction(r.dropActions.WebTagsForm.ciDropOnInput)){let t=document.createElement("div");t.innerHTML='<span class="WebTgf_Text">DROP</span><span class="WebTgf_CloseTag">x</span> ',r.dom.addClass(t,"WebTgf_Tag WebTgf_DropPlaceHolder");const i=r.dom.query(this._eElem,".WebFrm_PromptSpacer");return e.insertElement(t,i),r.dropActions.WebTagsForm.ciDropOnInput}return this.isSupportedDropAction(r.dropActions.WebControl.ciDropOnControl)?(e.highlightElement(),r.dropActions.WebControl.ciDropOnControl):null}hasData(){return""!=this.get("psValue")}}class ${static displayTypes={row:1,header:2,custom:3};constructor(e){this.oL=e,this.bPaged=!1,this.sCurrentRowId=e.psCurrentRowId,this.iCurrentRow=-1,this.aDisplay=[],this.aData=[],this.aGroupHeaders=[],this.aGroups=[],this.bIsGrouped=!1,this.onDataUpdate=new r.events.JSHandler,this.onBeforeDataUpdate=new r.events.JSHandler,this.onBeforeRowChange=new r.events.JSHandler,this.onRowChange=new r.events.JSHandler,this.onAfterRowChange=new r.events.JSHandler,e._onSettingChange.on(this.onSettingChange,this)}prepDisplay(){const e=[],t=(i,s)=>{const o=this.aGroupHeaders[i];if(o.iParentHeaderIndex>=0&&t(o.iParentHeaderIndex,s),e.length>0){if(e[e.length-1]<o.iGroupIndex)return;e.pop()}o.bCollapsed&&e.push(o.iGroupIndex),o._iItemIndex=this.aDisplay.push({eType:$.displayTypes.header,iIndex:i})-1};this.aDisplay=[],this.aGroupHeaders.forEach((e=>e._iItemIndex=null)),this.aData.forEach(((i,s)=>{i._iItemIndex=null,i.iGroupHeaderIndex>=0&&this.bIsGrouped&&t(i.iGroupHeaderIndex,s),0==e.length&&(i._iItemIndex=this.aDisplay.push({eType:$.displayTypes.row,iIndex:s})-1)}))}handleData(e){if(e&&(!Array.isArray(e.aRows)||!Array.isArray(e.aGroupHeaders)||!Array.isArray(e.aGroups)))throw new r.Error(999,"Invalid data structure for weblist data.",this);this.onBeforeDataUpdate.fire(this),e&&(this.aData=e.aRows,this.oL.peGrouping==r.grpCustom&&(this.aGroupHeaders=e.aGroupHeaders,this.aGroups=e.aGroups,this.bIsGrouped=this.aGroups.length>0)),this.bIsGrouped?this.groupData():this.sortData(),this.prepDisplay(),this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId),this.iCurrentRow<0&&this.aData.length>0&&(this.iCurrentRow=0,this.sCurrentRowId=this.aData[0].sRowId),this.onDataUpdate.fire(this,{sType:"full"})}isFirst(e){return this.aData[0]==e}isLast(e){return this.aData[this.aData.length-1]==e}groupData(){this.oL._oGrouping?.groupData()}sortData(){const e=this.oL;if(e.piSortColumn>=0&&e._aColumns[e.piSortColumn]){let t=[],i=[];return e.piSortColumn>=0&&-1==t.indexOf(e.piSortColumn)&&(t.push(e.piSortColumn),i.push(r.sys.data.compareFunction(e._aColumns[e.piSortColumn].peDataType,e.pbReverseOrdering))),e._aColumns.forEach(((s,o)=>{-1==t.indexOf(o)&&(t.push(o),i.push(r.sys.data.compareFunction(s.peDataType,e.pbReverseOrdering)))})),this.customSortData(t,i),!0}return!1}customSortData(e,t){this.aData.sort(((i,s)=>{for(let o=0;o<e.length;o++){const n=e[o],r=t[o](i.aCells[n].sValue,s.aCells[n].sValue);if(0!=r)return r}return 0}))}rowIndexByRowId(e){return this.aData.findIndex((t=>t.sRowId==e))}rowIdByRowIndex(e){return this.aData[e]?this.aData[e].sRowId:null}rowByRowIndex(e){return this.aData[e]}rowByRowId(e){return this.aData.find((t=>t.sRowId==e))||null}rowIndexToItemIndex(e){return this.aData[e]&&null!=this.aData[e]._iItemIndex?this.aData[e]._iItemIndex:-1}setCurrentRowId(e){if(this.sCurrentRowId!==e){const t={sPrevRowId:this.sCurrentRowId,iPrevRowIndex:this.iCurrentRow,sGotoRowId:e,iGotoRowIndex:this.rowIndexByRowId(e)};this.sCurrentRowId=t.sGotoRowId,this.iCurrentRow=t.iGotoRowIndex,this.onRowChange.fire(this,t)}}updateRow(e,t,i){const s=this.rowIndexByRowId(e);if(s>=0){if(this.onBeforeDataUpdate.fire(this),i){this.aData[s].sRowId=t.sRowId,t.sCssClassName&&t.sCssClassName,t.aCells.forEach(((e,t)=>{const i=this.aData[s].aCells[t];i.sValue=e.sValue,e.sTooltip&&(i.sTooltip=e.sTooltip),e.sCssClassName&&(i.sCssClassName=e.sCssClassName),e.aOptions.length&&(i.aOptions=e.aOptions)}))}else this.aData[s]=t;this.sCurrentRowId!==e&&this.sCurrentRowId!==t.sRowId||(this.sCurrentRowId=t.sRowId,this.iCurrentRow=s),this.onDataUpdate.fire(this,{sType:"row",sUpdateRowId:e,sNewRowId:t.sRowId})}}removeRow(e){const t=this.rowIndexByRowId(e);t>=0&&(this.iCurrentRow>t&&this.iCurrentRow--,this.aData.splice(t,1),this.prepDisplay(),this.onDataUpdate.fire(this,{sType:"remrow",sRowId:e,iRowIndex:t}))}appendRow(e){this.aData.push(e),this.sortData()&&(this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId)),this.prepDisplay(),this.onDataUpdate.fire(this,{sType:"newrow",sRowId:e.sRowId})}insertBefore(e,t){let i=this.rowIndexByRowId(e);i<0&&(i=this.aData.length),i<=this.iCurrentRow&&this.iCurrentRow++,this.aData.splice(i,0,t),this.sortData()&&(this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId)),this.prepDisplay(),this.onDataUpdate.fire(this,{sType:"newrow",sRowId:t.sRowId})}insertAfter(e,t){const i=this.rowIndexByRowId(e);i<0||i+1==this.aData.length?this.appendRow(t):this.insertBefore(this.aData[i+1].sRowId,t)}updateCell(e,t){this.iCurrentRow>=0&&(this.onBeforeDataUpdate.fire(this),this.aData[this.iCurrentRow].aCells[e._iColIndex].sValue=t,this.onDataUpdate.fire(this,{sType:"cell",sUpdateRowId:this.sCurrentRowId,oCol:e}))}updateCellByRowId(e,t,i){const s=this.rowIndexByRowId(e);s>=0&&(this.onBeforeDataUpdate.fire(this),this.aData[s].aCells[t._iColIndex].sValue=i,this.onDataUpdate.fire(this,{sType:"cell",sUpdateRowId:e,oCol:t}))}updateSorting(){const e=this.oL;!this.bPaged&&e.piSortColumn>=0&&this.handleData(null,"page","",!0,!0)}updateGrouping(){var e=this.oL;this.bPaged||e.peGrouping==r.grpDisabled||this.handleData(null,"page","",!0,!0)}onSettingChange(e){if("prop"===e.sType)switch(e.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateSorting()}else"sorting"===e.sType?this.updateSorting():"grouping"===e.sType&&this.updateGrouping()}}class Q{constructor(e,t,i){this.oL=e,this.oM=t,this.oC=i,this.oR=e._oRowRenderer,this.bPreventSubmit=!1,this.bCancelClick=!1,this.bScroll=!1,this.onRowsRendered=new r.events.JSHandler,t.onDataUpdate.on(this.onDataUpdate,this),t.onRowChange.on(this.onRowChange,this),e._onSettingChange.on(this.onSettingChange,this),i.onCellClick.on(this.onCellClick,this),i.onAfterCellClick.on(this.onAfterCellClick,this)}genHtml(e){e.push('<div class="WebList_BodyWrp">'),e.push('<div class="WebList_Body',this.oL.pbShowSelected?" WebList_ShowSelected":"",'">'),this.tableHtml(e),e.push("</div></div>")}afterRender(e){this.eRowContainer=this.eBody=r.dom.query(e,"div.WebList_Body"),this.eBodyWrp=r.dom.query(e,"div.WebList_BodyWrp"),r.dom.addClass(this.oL._eControl,this.bScroll?"WebList_Scrolling":"WebList_NoScrolling"),r.events.addDomListener("click",this.eBody,this.onTableClick,this),r.events.addDomListener("dblclick",this.eBody,this.onTableDblClick,this),this.onRowsRendered.fire(this)}groupHeaderHtml(e,t,i){const s=this.oM;if(t>=0&&s.aGroupHeaders[t]){const o=s.aGroupHeaders[t],n=s.aGroups[o.iGroupIndex];e.push(`<div class="WebList_GroupHeader Web_Level${o.iGroupIndex} ${0==i?"Web_First":""}" data-dfgrphead="${t}" data-dfitem="${i}">`),n.sLabel&&e.push(`<span class=WebList_GroupHeader_Name>${n.sLabel}</span>`),o.sItem&&e.push(`<span class="WebList_GroupHeader_Item">${o.sItem}</span> `),o.sTotal?e.push(`<span class="WebList_GroupHeader_Total">${o.sTotal}</span> `):o.iItems>0&&e.push(`<span class="WebList_GroupHeader_Items">${o.iItems}</span> `),this.oL.pbGroupsCollapsible&&(o.bCollapsed?e.push('<span class="WebList_GroupHeader_ToggleBtn"><i class="WebList_GroupHeader_IconExpand"></i></span>'):e.push('<span class="WebList_GroupHeader_ToggleBtn"><i class="WebList_GroupHeader_IconCollapse"></i></span>')),e.push("</div>")}}itemHtml(e,t){const i=this.oM,s=i.aDisplay[t];if(s)switch(s.eType){case $.displayTypes.row:{const o=i.aData[s.iIndex];this.oR.rowHtml(o,e,t%2==0,i.aGroups.length,i.isFirst(o),i.isLast(o),t)}break;case $.displayTypes.header:this.groupHeaderHtml(e,s.iIndex,t)}}tableHtml(e){this.oM.aDisplay.forEach(((t,i)=>{this.itemHtml(e,i)}))}refreshDisplay(){const e=[];this.eRowContainer&&(this.tableHtml(e),this.eRowContainer.innerHTML=e.join(""),this.onRowsRendered.fire(this),this.oL.sizeChanged(!1))}refreshRow(e,t){const i=[],s=this.oM.rowIndexByRowId(t),o=this.row(e);if(s>=0&&o){const e=o.dataset.dfitem;this.itemHtml(i,e);const t=r.dom.create(i);o.parentNode.replaceChild(t,o)}}refreshCell(e,t){const i=this.oM,s=this.cell(e,t._iCol),o=i.rowIndexByRowId(e);s&&o>=0&&(s.innerHTML=this.oR.cellHtml(t,this.oM.aData[o],this.oM.aData[o].aCells[t._iColIndex]))}onDataUpdate(e){"row"===e.sType&&this.refreshRow(e.sUpdateRowId,e.sNewRowId),"cell"===e.sType?this.refreshCell(e.sUpdateRowId,e.oCol):this.refreshDisplay()}onRowChange(e){if(this.eBody&&!this.oL._oGrouping.makeCurrentRowVisible()){if(e.sPrevRowId){const t=this.row(e.sPrevRowId);t&&r.dom.removeClass(t,"WebList_Selected")}const t=this.row(e.sGotoRowId);t&&r.dom.addClass(t,"WebList_Selected")}}onSettingChange(e){const t=this.oL;if("redraw"===e.sType)this.refreshDisplay();else if("prop"===e.sType&&"pbShowSelected"===e.sProp)this.eBody&&r.dom.toggleClass(this.eBody,"WebList_ShowSelected",t.pbShowSelected)}containerElem(e){const t=this.eRowContainer?.querySelectorAll(e);if(t)for(const e of t)if(e.closest("div.WebList_Body")==this.eRowContainer)return e;return null}row(e){return this.containerElem('table.WebList_Row[data-dfrowid="'+e+'"]')}groupHeader(e){return this.containerElem('div.WebList_GroupHeader[data-dfgrphead="'+e+'"]')}currentRowElem(){return this.row(this.oM.sCurrentRowId)}item(e){return this.containerElem('[data-dfitem="'+e+'"]')}determineCell(e){for(var t={iCol:-1,sRowId:null,iHeaderIndex:-1,eSwipeBtn:null,bHeaderToggle:!1};e&&e.parentNode&&e!==this.eRowContainer&&!t.sRowId;)"TD"===e.tagName&&e.hasAttribute("data-dfcol")?t.iCol=parseInt(e.getAttribute("data-dfcol"),10):"TD"===e.tagName&&e.hasAttribute("data-dfswbtn")?t.eSwipeBtn=e:"TABLE"===e.tagName&&e.hasAttribute("data-dfisrow")?t.sRowId=e.getAttribute("data-dfrowid"):e.matches("div.WebList_GroupHeader[data-dfgrphead]")?t.iHeaderIndex=parseInt(e.dataset.dfgrphead,10):e.matches("span.WebList_GroupHeader_ToggleBtn")&&(t.bHeaderToggle=!0),e=e.parentNode;return t}onTableClick(e){const t=this;if(!this.oL.isEnabled()||this.bCancelClick)return;const i=this.determineCell(e.getTarget());i.eSwipeBtn?this.oL._oTouchHandler.swipeBtnClick(e,i.eSwipeBtn):null!==i.sRowId?this.oC.cellClick(e,i.sRowId,i.iCol)&&(this._bPreventSubmit=!0,setTimeout((function(){t.bPreventSubmit=!1}),250),e.stop()):i.iHeaderIndex>=0&&i.bHeaderToggle&&this.oL._oGrouping.toggleGroupHeader(i.iHeaderIndex)}onTableDblClick(e){if(!this.oL.isEnabled())return;const t=this.determineCell(e.getTarget());null!==t.sRowId&&this.oC.cellDblClick(e,t.sRowId,t.iCol)?e.stop():this.bPreventSubmit||this.oL.fireSubmit()}onCellClick(e){const t=this;this.bHitDone=!1,this.eHitElem=this.row(e.sRowId),r.dom.addClass(this.eHitElem,r.CssHit),this.tHitTimer=setTimeout((function(){t.bHitDone&&r.dom.removeClass(t.eHitElem,r.CssHit),t.tHitTimer=null}),r.hitTimeout)}onAfterCellClick(e){this.tHitTimer||r.dom.removeClass(this.eHitElem,r.CssHit),this.bHitDone=!0}setHeight(e){}cell(e,t){return this.eRowContainer&&r.dom.query(this.eRowContainer,"table[data-dfrowid='"+e+"'] td[data-dfcol='"+t+"']")||null}colCell(e){return this.cell(this.oM.sCurrentRowId,e._iCol)}colCellByIndex(e){return this.cell(this.oM.sCurrentRowId,e)}scrollbarWidth(){return 0}getViewSize(){return 10}fullwidth(){return this.eBody&&this.eBody.clientWidth||0}setExtraRowHeight(e,t){}getExtraRowHeight(e){return 0}scrollToRow(e){}}class ee extends Q{heightCache={};constructor(e,t,i){super(e,t,i),this.bScroll=!0,this.bZebraTop=!1,this.bZebraBottom=!1,this.iTableOffset=0,this.iScrollOffsetPx=0,this.iRowDispOffset=0,this.iViewOffset=0,this.iRowsDispOffset=0,this.iRowDispLast=0,this.iPrefViewOffset=8,this.iMaxViewOffsetDiff=this.iPrefViewOffset/2,this.iLastScrollbarSet=0,this.bScrollbarDirty=!1,this.iAvgRowHeight=0,this.iTableHeight=0,this.bNoRender=!1,this.iAutoScroll=0,this.oInitialFullEvent=null,this.bFirstFill=!0,this.aItemHeightProcess=[],this.onHorizontalScroll=new r.events.JSHandler,this.onVerticalScroll=new r.events.JSHandler,this.bDelUpdDim=!1,this.bDelUpdDimForced=!1,e._onResize.on(this.onResize,this),this._oDimUpdConf=null}genHtml(e){e.push('<div class="WebList_BodyWrp">'),e.push('<div class="WebList_Body',this.oL.pbShowSelected?" WebList_ShowSelected":"",'">'),e.push('<div class="WebList_TableWrp',this.oL.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">'),e.push('<div class="WebList_Table">'),e.push("</div></div></div>"),e.push('<div class="WebList_Scroll" tabindex="-1"><div class="WebList_Stretcher" style="width: 1px;"></div></div>'),e.push("</div>")}afterRender(e){this.eTableWrp=r.dom.query(e,"div.WebList_TableWrp"),this.eTable=r.dom.query(e,"div.WebList_Table"),this.eScrollbar=r.dom.query(e,"div.WebList_Scroll"),this.eScrollStretch=r.dom.query(e,"div.WebList_Scroll > div.WebList_Stretcher"),super.afterRender(e),r.events.addDomMouseWheelListener(this.eBody,this.onMouseWheelScroll,this),r.dom.on("scroll",this.eScrollbar,this.onScrollbarScroll,this),r.dom.on("scroll",this.eTableWrp,this.onHorizbarScroll,this),r.events.addDomCaptureListener("load",this.eTableWrp,this.onContentLoaded,this)}afterFirstFill(){r.dom.animFrame((function(){this.oL.piSortColumn>0&&this.scrollToCol(this.oL.piSortColumn)}),this)}onDataUpdate(e){let t;if(this.iMaxPX=null,"full"===e.sType){if(!this.eBody)return void(this.oInitialFullEvent=e);this.clearHeightCache(),this.updateScrollbarSize(),this.bNoRender=!0;const i=this.row(this.oM.sCurrentRowId);i?t=i.offsetTop-this.iTableOffset:this.centerCurrentRow(),this.bNoRender=!1,this.updatePosition(!0),this.dimensionUpdate({bUpdateRows:!1,bUpdateScrollbar:!0,bForceRedraw:!1,fFinished:()=>{i?this.smartRepositionCurrentRow(t):this.centerCurrentRow()}}),this.iTableHeight<=0&&r.dom.animFrame((function(){this.iTableHeight>0&&this.centerCurrentRow()}),this),this.bFirstFill&&(this.bFirstFill=!1,this.afterFirstFill())}if("next"===e.sType&&this.updateScrollbarSize(),"prev"===e.sType&&(this.iScrollOffsetPx+=e.iOffsetChange*(this.iAvgRowHeight||20),this.iRowDispOffset+=e.iOffsetChange,this.iRowsDispOffset+=e.iOffsetChange,this.iRowDispLast+=e.iOffsetChange,this.bNoRender=!0,this.updateScrollbarSize(),this.eScrollbar.scrollTop=this.eScrollbar.scrollTop+e.iOffsetChange*(this.iAvgRowHeight||20),this.bNoRender=!1,this.updatePosition()),"row"===e.sType&&this.refreshRow(e.sUpdateRowId,e.sNewRowId),"cell"===e.sType&&this.refreshCell(e.sUpdateRowId,e.oCol),"newrow"===e.sType&&(this.bNoRender=!0,this.updateScrollbarSize(),this.scrollToCurrentRow(),this.bNoRender=!1,this.updatePosition(!0)),"remrow"===e.sType&&(this.bNoRender=!0,this.updateScrollbarSize(),this.scrollToCurrentRow(),this.bNoRender=!1,this.updatePosition(!0)),"display"===e.sType){const t=this.iRowDispOffset,i=this.iTableOffset;this.updatePosition(!0),this.dimensionUpdate({bUpdateRows:!1,bUpdateScrollbar:!0,bForceRedraw:!1,fFinished:()=>{const s=this.combinedRowHeightPx(0,t)+i;this.scrollTo(s,!1,!1,!1),e.iDisplayItem&&this.scrollToDisplayItem(e.iDisplayItem)}})}}onRowChange(e){this.eBody&&(super.onRowChange(e),this._oDimUpdConf?this.dimensionUpdate({fFinished:()=>{this.scrollToCurrentRow()}}):this.scrollToCurrentRow())}onSettingChange(e){"redraw"===e.sType?this.updatePosition(!0):"prop"===e.sType&&"pbAutoColumnSizing"===e.sProp?(r.dom.toggleClass(this.eTableWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing),r.dom.toggleClass(this.eTableWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing)):super.onSettingChange(e)}scroll(e,t,i){let s;s=this.iScrollOffsetPx,s+=e,this.scrollTo(s,t,i)}scrollTo(e,t,i,s){e!==this.iScrollOffsetPx&&(this.iScrollOffsetPx=e,this.updatePosition(!1,t,!!s),i||this.updateScrollbarPos(this.iScrollOffsetPx),this.onVerticalScroll.fire(this,{iScrollOffsetPx:this.iScrollOffsetPx}),this.updateCache())}updatePosition(e,t,i){const s=this.oM;let o,n,r,a,l,h,d,p,u,c=null,g=null,_=0,m=0;if(!this.eBody||this.bNoRender)return;const b=this.tableHeight();t=!!t,i=!!i,e=!!e,d=this.getMaxPX(),p=n=i?this.iScrollOffsetPx:Math.min(this.iScrollOffsetPx,d),l=Math.max(n,0)+b;for(let e=0;e<s.aDisplay.length;e++)if(h=this.rowHeightPx(e),t&&null===g&&m+h>n&&h<1.5*this.iAvgRowHeight&&(n=n-m<h/2?m:m+h),m+=h,null===g&&m>=n&&(this.iScrollOffsetPx=i?n:n=Math.max(0,Math.min(n,d)),l=Math.max(n,0)+b,g=e,u=m-h),m>=l){c=e;break}d-p<.5*this.iAvgRowHeight&&(n=d),null===g&&(this.iScrollOffsetPx=i?n:n=Math.max(0,Math.min(n,d)),l=Math.max(n,0)+this.iTableHeight,g=0,u=0),null===c&&(c=Math.max(0,s.aDisplay.length-1)),m<this.iTableHeight&&(_=(this.iTableHeight-m)/(this.iAvgRowHeight||20)+this.iPrefViewOffset),a=Math.max(g-this.iPrefViewOffset,0),r=Math.min(c+this.iPrefViewOffset,s.aDisplay.length-1),e||g<this.iRowDispOffset||c>this.iRowDispLast||this.iCalcEmptyRows!==_?(this.iCalcEmptyRows=_,this.iRowDispLast=r,this.iRowDispOffset=a,this.refreshDisplay()):this.adjustDisplay(a,r),o=n-(u-this.combinedRowHeightPx(this.iRowDispOffset,g)),this.updateScrollOffset(o)}refreshDisplay(){const e=[],t=this.iRowDispLast-this.iRowDispOffset;if(t>100&&console.warn(`Painting issue, painting ${t} rows`),this.tableHtml(e),r.sys.isIE)for(;this.eTable.lastChild;)this.eTable.removeChild(this.eTable.lastChild);this.eTable.innerHTML=e.join(""),this.onRowsRendered.fire(this),this.dimensionUpdate({bUpdateRows:!0,bUpdateScrollbar:!0,bForceRedraw:!1})}itemHtml(e,t){super.itemHtml(e,t),this.aItemHeightProcess.push(t)}tableHtml(e){const t=this.oM;for(let i=this.iRowDispOffset;i<=this.iRowDispLast&&i<t.aDisplay.length;i++)this.itemHtml(e,i);for(let i=0;i<this.iCalcEmptyRows;i++)this.oR.rowHtml(null,e,(i+this.iRowDispLast+1)%2==0,t.aGroups.length,!1,!1)}adjustDisplay(e,t){const i=this.iMaxViewOffsetDiff;let s=!1;if(this.iRowDispOffset>e){if(this.iRowDispOffset>e+i)for(;this.iRowDispOffset>e;)this.iRowDispOffset--,this.insertRow(this.iRowDispOffset,!0),s=!0;if(this.iRowDispLast>t+i)for(;this.iRowDispLast>t;)this.removeBottomRow()}else{if(this.iRowDispLast<t-i)for(;this.iRowDispLast<t;)this.iRowDispLast++,this.insertRow(this.iRowDispLast,!1),s=!0;if(this.iRowDispOffset<e-i)for(;this.iRowDispOffset<e;)this.removeTopRow()}s&&this.onRowsRendered.fire(this)}removeTopRow(){if(this.eTable.firstChild){for(;!this.eTable.firstChild.hasAttribute("data-dfitem");)this.eTable.removeChild(this.eTable.firstChild);this.eTable.firstChild&&(this.eTable.removeChild(this.eTable.firstChild),this.iRowDispOffset++,this.bZebraTop=!this.bZebraTop)}}removeBottomRow(){if(this.eTable.lastChild){for(;!this.eTable.firstChild.hasAttribute("data-dfitem");)this.eTable.removeChild(this.eTable.lastChild);this.eTable.lastChild&&(this.eTable.removeChild(this.eTable.lastChild),this.iRowDispLast--,this.bZebraBottom=!this.bZebraBottom)}}updateScrollOffset(e){this.eTable&&(this.iTableOffset=e,r.dom.translateY(this.eTable,-e,!0),this.eTableWrp.scrollTop>0&&(this.eTableWrp.scrollTop=0))}insertRow(e,t){const i=[];this.itemHtml(i,e);const s=r.dom.create(i);t?this.eTable.prepend(s):this.eTable.appendChild(s)}clearHeightCache(){this.oM.aDisplay.forEach((e=>{e._iRowHeight=null})),this.heightCache={}}realHeight(e){return e?.getBoundingClientRect().height||0}realMargin(e){const t=r.sys.gui.getCurrentStyle(e),i=parseFloat(t.marginTop)||0,s=parseFloat(t.marginBottom)||0;return Math.max(i,s)}updateItemHeight(e){const t=this.oM,i=this.item(e);if(!i)return!1;let s=this.realHeight(i);const o=i.className;this.heightCache.hasOwnProperty(o)||(this.heightCache[o]=this.realMargin(i)),s+=this.heightCache[o];const n=t.aDisplay[e]._iRowHeight!==s;return t.aDisplay[e]._iRowHeight=s,n}updateAvgRowHeight(){let e=0,t=0;this.oM.aDisplay.forEach((function(i){i._iRowHeight&&(t++,e+=i._iRowHeight)})),t&&(this.iAvgRowHeight=e/t),this.iMaxPX=0}updateRenderedRowHeights(){let e=!1;for(let t=this.iRowDispOffset;t<this.oM.aDisplay.length&&t<=this.iRowDispLast;t++)e|=this.updateItemHeight(t);return this.aItemHeightProcess=[],e&&(this.updateAvgRowHeight(),this.iMaxPX=null),e}processRowHeights(){let e,t=!1;for(;e=this.aItemHeightProcess.pop();)t=!0,this.updateItemHeight(e);return t&&(this.iMaxPX=null,this.updateAvgRowHeight()),t}rowHeightPx(e){let t;const i=this.oM.aDisplay[e];return t=i._iRowHeight?i._iRowHeight:this.iAvgRowHeight||20,i.eType==$.displayTypes.row&&(t+=this.oM.aData[i.iIndex]._iRowHeightExtra||0),t}combinedRowHeightPx(e,t){const i=this.oM;let s=0;for(let o=e;o<i.aDisplay.length&&o<t;o++)s+=this.rowHeightPx(o);return s}snapToRow(e){let t=0;const i=this.oM;for(let s=0;s<i.aDisplay.length;s++){const i=this.rowHeightPx(s);if(t+i>e)return e-t<i/2?t:t+i;t+=i}return t}getMaxPX(){return this.iMaxPX?this.iMaxPX:this.iMaxPX=Math.max(this.combinedRowHeightPx(0,this.oM.aDisplay.length)-this.iTableHeight,0)}updateScrollbarSize(){const e=this.combinedRowHeightPx(0,this.oM.aDisplay.length);this.eScrollStretch&&this.eScrollStretch.clientHeight!==e&&(this.eScrollStretch.style.height=e+"px")}updateScrollbarPos(e){let t;const i=this;this.eScrollbar&&(this.eScrollbar.scrollTop=this.iLastScrollbarSet=e,this.bScrollbarDirty=t=Math.abs(this.eScrollbar.scrollTop-this.iLastScrollbarSet)>5,t&&setTimeout((function(){i.bScrollbarDirty&&i.eScrollbar.scrollTop!==i.iLastScrollbarSet&&(i.eScrollbar.scrollTop=i.iLastScrollbarSet),i.bScrollbarDirty=!1}),300))}onScrollbarScroll(e){const t=this.eScrollbar.scrollTop;Math.abs(t-this.iLastScrollbarSet)>2&&!this.bScrollbarDirty&&(this.iAutoScroll=0,this.iLastScrollbarSet=t,this.scrollTo(t,!0,!0))}onMouseWheelScroll(e){const t=e.getMouseWheelDelta();this.iAutoScroll=0,t>0?this.scroll(-2*(this.iAvgRowHeight||20),!0):t<0&&this.scroll(2*(this.iAvgRowHeight||20),!0),e.stop()}updateCache(){this.oC.triggerCacheUpdate(this.iRowDispOffset,this.iRowDispLast)}centerCurrentRow(){const e=this.oM,t=e.rowIndexToItemIndex(e.iCurrentRow),i=this.tableHeight();if(t>=0&&i>0){let e=this.combinedRowHeightPx(0,t);e=e-i/2+this.rowHeightPx(t)/2,this.scrollTo(e,!0,!1)}}smartRepositionCurrentRow(e){const t=this.oM,i=t.rowIndexToItemIndex(t.iCurrentRow);i>=0&&this.smartRepositionDisplayItem(i,e)}smartRepositionDisplayItem(e,t){let i=this.combinedRowHeightPx(0,e);i-=t,i>0&&i<this.getMaxPX()&&this.scrollTo(i,!0,!1),this.scrollToDisplayItem(e)}scrollToCurrentRow(){this.scrollToRow(this.oM.sCurrentRowId)}scrollToRow(e){const t=this.oM;let i=t.rowIndexByRowId(e),s=t.rowIndexToItemIndex(i);s>=0&&this.scrollToDisplayItem(s)}scrollToDisplayItem(e){let t=this.combinedRowHeightPx(0,e),i=this.rowHeightPx(e);t<this.iScrollOffsetPx?this.scrollTo(t,!0,!1):t+i>this.iScrollOffsetPx+this.iTableHeight&&(t=t+i-this.iTableHeight,this.scrollTo(t,!1,!1))}scrollToCol(e){const t=this.oL;let i;t.pbAutoColumnSizing||(i=this.colCellByIndex(e),i||(i=this.eBody&&r.dom.query(this.eBody,"td[data-dfcol='"+e+"']")||null),i&&(i.offsetLeft<this.eTableWrp.scrollLeft?t._oBody.scrollToHoriz(i.offsetLeft):i.offsetLeft+i.offsetWidth>this.eTableWrp.clientWidth+this.eTableWrp.scrollLeft&&t._oBody.scrollToHoriz(Math.min(i.offsetLeft,i.offsetLeft+i.offsetWidth-this.eTableWrp.clientWidth))))}scrollToHoriz(e){this.eTableWrp.scrollLeft=e}setHeight(e){e-=r.sys.gui.getVertBoxDiff(this.eBody),e-=r.sys.gui.getVertBoxDiff(this.eBodyWrp),e=Math.max(e,0),this.eBody.style.height=e+"px",this.eScrollbar.style.height=(r.dom.clientHeight(this.eTableWrp)||e||0)+"px"}determineDimensions(){let e=!1;return this.eBody&&(this.iPrevTableHeight=this.iTableHeight,this.iTableHeight=this.eTableWrp.clientHeight||this.iTableHeight,e=e||this.iPrevTableHeight!==this.iTableHeight||this.iTableWidth!==this.eTableWrp.clientWidth,this.iTableWidth=this.eTableWrp.clientWidth),e}tableHeight(){return this.eTableWrp?.clientHeight||this.iTableHeight||0}waitForRepaint(e){window.requestIdleCallback?window.requestIdleCallback(e,{timeout:40}):window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout(e,40)}dimensionUpdate(e){e=e||{},this._oDimUpdConf?(this._oDimUpdConf.bUpdateRows||=e.bUpdateRows,this._oDimUpdConf.bUpdateScrollbar||=e.bUpdateScrollbar,this._oDimUpdConf.bUpdateRows||=e.bUpdateRows,e.fFinished&&this._oDimUpdConf.aFinished.push(e.fFinished)):(e.aFinished=e.fFinished?[e.fFinished]:[],this._oDimUpdConf=e),this.waitForRepaint((()=>{const e=this._oDimUpdConf;if(!e)return;this._oDimUpdConf=null;let t=this.determineDimensions();t||e.bUpdateRows?t|=this.updateRenderedRowHeights():t|=this.processRowHeights(),(t||e.bUpdateScrollbar)&&this.updateScrollbarSize(),(t||e.bForceRedraw)&&this.updatePosition(e.bForceRedraw),this.eTableWrp&&(this.eTableWrp.style.paddingRight=this.scrollbarWidth()+"px"),e.aFinished.forEach((e=>e()))}))}onResize(e){this.oInitialFullEvent?this.dimensionUpdate({bUpdateRows:!0,bUpdateScrollbar:!0,bForceRedraw:!0,fFinished:()=>{this.oInitialFullEvent&&(this.onDataUpdate(this.oInitialFullEvent),this.oInitialFullEvent=null)}}):this.dimensionUpdate({bUpdateRows:!1,bUpdateScrollbar:!1,bForceRedraw:!1})}onContentLoaded(e){let t=e.getTarget();for(;t&&t!==this.eTableWrp;){if(t.hasAttribute("data-dfrowid")){const e=t.getAttribute("data-dfrowid");return void(this.aItemHeightProcess.indexOf(e)<=0&&(this.aItemHeightProcess.push(e),this.dimensionUpdate({bUpdateRows:!1,bUpdateScrollbar:!1,bForceRedraw:!1})))}t=t.parentNode}}scrollbarWidth(){return this.eScrollbar&&this.eScrollbar.offsetWidth||0}getViewSize(){const e=this.tableHeight();return e&&this.iAvgRowHeight?e/this.iAvgRowHeight:10}setExtraRowHeight(e,t){const i=this.oM,s=i.rowIndexByRowId(e);s>=0&&(i.aData[s]._iRowHeightExtra=t,this.iMaxPX=null,this.updateScrollbarSize())}getExtraRowHeight(e){const t=this.oM,i=t.rowIndexByRowId(e);if(i>=0)return t.aData[i]._iRowHeightExtra||0}onHorizbarScroll(e){this.onHorizontalScroll.fire(this,{nScrollX:this.eTableWrp.scrollLeft})}}class te extends ${constructor(e){super(e),this.bFirst=!1,this.bLast=!1,this.bPaged=!0,this.iPrefCacheOffset=25}handleData(e,t,i,s,o){const n={sType:"",iOffsetChange:0,sUpdateRowId:""};if(e&&(!Array.isArray(e.aRows)||!Array.isArray(e.aGroupHeaders)||!Array.isArray(e.aGroups)))throw new r.Error(999,"Invalid data structure for weblist data.");this.onBeforeDataUpdate.fire(this),"page"===t&&(this.aData=e.aRows,this.bLast=o,this.bFirst=s,this.prepDisplay(),this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId),this.iCurrentRow<0&&o&&s&&this.aData.length>0&&(this.iCurrentRow=0,this.sCurrentRowId=this.aData[0].sRowId),n.sType="full"),"first"===t&&(this.aData=e.aRows,this.bLast=o,this.bFirst=s,this.prepDisplay(),this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId),n.sType="full"),"last"===t&&(e.aRows.reverse(),this.aData=e.aRows,this.bLast=o,this.bFirst=s,this.prepDisplay(),this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId),n.sType="full"),"next"===t&&(this.aData=this.aData.concat(e.aRows),this.bLast=o,n.sType="next",this.prepDisplay()),"prev"===t&&(e.aRows.reverse(),this.aData=e.aRows.concat(this.aData),this.bFirst=s,n.iOffsetChange=e.aRows.length,n.sType="prev",this.prepDisplay(),this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId)),this.onDataUpdate.fire(this,n)}isFirst(e){return this.bFirst&&this.aData[0]==e}isLast(e){return this.bLast&&this.aData[this.aData.length-1]==e}updateSorting(){}sortData(){}}class ie{constructor(e,t){this.oL=e,this.oM=t,this.iRowChangeCount=0,this.onCellClick=new r.events.JSHandler,this.onCellDblClick=new r.events.JSHandler,this.onAfterCellClick=new r.events.JSHandler,e._onKeyDown.addListener(this.keyDown,this)}cellClick(e,t,i,s){const o=this.oL,n=this.oM;let r,a="";o._bHasFocus=!0;const l=n.rowIndexByRowId(t);if(l>=0){if(i>=0&&(r=o._aColumns[i]._iColIndex,a=n.aData[l].aCells[r].sValue),i>=0&&o._aColumns[i].cellClickBefore(e,t,a))return!1;if(s||this.selectRow("row",l),i>=0&&o._aColumns[i].cellClickAfter(e,t,a))return o.focus(),!1;if(this.fireRowClick(t,i))return!0}return!1}fireRowClick(e,t){this.onCellClick.fire(this,{sRowId:e,iCol:t});return this.oL.fire("OnRowClick",[e,null!==t?t:-1],(function(i){this.onAfterCellClick.fire(this,{sRowId:e,iCol:t})}),this)}cellDblClick(e,t,i){return!this.onCellDblClick.fire(this,{sRowId:t,iCol:i})}headClick(e,t){const i=this.oL,s=i._aColumns[t];let o=!1;return s&&(s.fire("OnHeaderClick")?o=!0:i.pbColumnSortable&&s.pbSortable&&(i.piSortColumn===t?this.changeSorting(t,!i.pbReverseOrdering):this.changeSorting(t,!1),o=!0)),i.focus(),o}headDblClick(e,t){return!1}changeSorting(e,t){const i=this.oL,s=i.piSortColumn,o=i.pbReverseOrdering;i.addSync("piSortColumn"),i.addSync("pbReverseOrdering"),i.piSortColumn=e,i.pbReverseOrdering=t,i._onSettingChange.fire(this,{sType:"sorting"}),this.oM.bPaged&&i.serverAction("ChangeSorting",[e,t,s,o])}keyPress(e){const t=this.oL;if(t.isEnabled()){if(t.pbAutoSearch&&t.piSortColumn>=0&&!this.bNoSearch&&t.hasFocus()){if(e.getCharCode()>32&&!e.isSpecialKey()){let i=String.fromCharCode(e.getCharCode());return t._aColumns[t.piSortColumn].peDataType===r.ciTypeBCD?"0123456789,.-".indexOf(i)<0&&(i=""):t._aColumns[t.piSortColumn].peDataType===r.ciTypeDate&&"0123456789-".indexOf(i)<0&&(i=""),this.showSearch(i),e.stop(),!1}}return!0}}search(e){const t=this.oM,i=this.oL,s=t.aData;let o,n,a,l=0,h=s.length-1,d=null;const p=i.pbReverseOrdering,u=i._aColumns[i.piSortColumn]._iColIndex;if(!(u<0))if(this.oM.bPaged)i.serverAction("OnSearch",[e]);else{for(i._aColumns[u].peDataType===r.ciTypeText?(o=function(e,t){return(e=e.substr(0,t.length).toLowerCase()).localeCompare(t)},e=e.toLowerCase()):o=r.sys.data.compareFunction(i._aColumns[u].peDataType);l<h;)if(n=Math.floor((l+h)/2),a=o(s[n].aCells[u].sValue,e),a=p?-a:a,a<0)l=n+1;else{if(!(a>0)){d=n;break}h=n-1}if(0===a){if(d>0)for(a=o(s[d-1].aCells[u].sValue,e),a=p?-a:a;0===a&&d>0;)d--,d>0&&(a=o(s[d-1].aCells[u].sValue,e))}else d=n<l?l:n>l?h:n;this.moveToRow(d)}}showSearch(e){const t=this.oL,i=r.dom.windowWidth(),s=t.piSortColumn;if(s<0)return;const o=new R(null,t);o.psCaption=t.getWebApp().getTrans("search")+": "+t._aColumns[s].psCaption,o.pbShowClose=!0,o.pbDDHotKeys=!1,o.pbResizable=!1,o.piMinWidth=i>390?370:i-20,o.psCSSClass="WebMsgBox";const n=new y(null,o);n.peRegion=r.ciRegionCenter,o.addChild(n);const a=new N(null,o);a.psLabel="",a.pbShowLabel=!1,a.psValue=e||"",a.peDataType=t._aColumns[s].peDataType,a.psMask=t._aColumns[s].psMask,a.piPrecision=t._aColumns[s].piPrecision,a.piMaxLength=t._aColumns[s].piMaxLength,a.pbCapslock=t._aColumns[s].pbCapslock,a.peAlign=r.ciAlignLeft,n.addChild(a);const l=new y(null,o);l.peRegion=r.ciRegionBottom,l.piColumnCount=3,l.psCSSClass="WebMsgBoxOneBtn",o.addChild(l);const h=new M(null,o);h.psCaption=t.getWebApp().getTrans("ok"),h.piColumnIndex=1,h.pbShowLabel=!1,h.OnClick.addListener((function(e){o.fire("OnSubmit")}),this),l.addChild(h);const d=new M(null,o);d.psCaption=t.getWebApp().getTrans("cancel"),d.piColumnIndex=2,d.pbShowLabel=!1,d.OnClick.addListener((function(e){o.hide()}),this),l.addChild(d),o.OnSubmit.addListener((function(e){const i=a.get("psValue");o.hide(),t.objFocus(),this.search(i),t._eFocus&&t._eFocus.focus()}),this),o.show(),a.peDataType!==r.ciTypeDate&&a.peDataType!==r.ciTypeDateTime&&a.peDataType!==r.ciTypeTime||(a.focus(),e&&a.setControlValue(e)),r.sys.isMobile||r.dom.setCaretPosition(a._eControl,a._eControl.value.length)}keyDown(e){const t=this.oL,i=this,s=e.oDOMEvent;if(t._bHasFocus||t._eKeyBuddy){if(s.matchKey(r.settings.listKeys.scrollUp))this.moveUpRow();else if(s.matchKey(r.settings.listKeys.scrollDown))this.moveDownRow();else if(s.matchKey(r.settings.listKeys.scrollPageUp))this.movePageUp();else if(s.matchKey(r.settings.listKeys.scrollPageDown))this.movePageDown();else if(s.matchKey(r.settings.listKeys.scrollTop))this.moveToFirstRow();else if(s.matchKey(r.settings.listKeys.scrollBottom))this.moveToLastRow();else if(s.matchKey(r.settings.listKeys.leftSwipeBtns)&&t._oTouchHandler&&t._oTouchHandler.showSwipeLeft());else if(!(s.matchKey(r.settings.listKeys.rightSwipeBtns)&&t._oTouchHandler&&t._oTouchHandler.showSwipeRight()))return!s.matchKey(r.settings.formKeys.submit)||(!this.oM.sCurrentRowId||!this.fireRowClick(this.oM.sCurrentRowId,null)||(s.stop(),!1));return this.bNoSearch=!0,setTimeout((function(){i.bNoSearch=!1}),50),s.stop(),!1}}handleData(e,t,i,s,o){this.oM.handleData(e,t,i,s,o),this.pbDataAware||this.updateColumnsFromCache("page"===t)}setCurrentRowId(e){this.oM.setCurrentRowId(e)}updateRow(e,t,i){this.oM.updateRow(e,t,i)}updateCell(e,t){this.oM.updateCell(e,t)}removeRow(e){const t=this.oM;let i,s=!1;t.sCurrentRowId===e&&(s=!0,i=t.iCurrentRow,t.sCurrentRowId="",t.iCurrentRow=-1),t.removeRow(e),s&&(i<t.aData.length?this.selectRow("row",i):i>0?this.selectRow("row",i-1):this.appendNewRow())}appendRow(e){this.oM.appendRow(e)}insertBefore(e,t){this.oM.insertBefore(e,t)}insertAfter(e,t){this.oM.insertAfter(e,t)}selectRow(e,t,i,s){const o=this.oL,n=this.oM,a=n.sCurrentRowId;let l=!0,h="",d=s||null;o.cancelServerAction("ChangeCurrentRow"),"row"===e&&(h=n.rowIdByRowIndex(t),l=null!==h&&h!==a,o.pbDataAware||(d=n.aData[t]));const p={sPrevRowId:n.sCurrentRowId,iPrevRowIndex:n.iCurrentRow,sGotoRow:h,iGotoRowIndex:t};this.iRowChangeCount++;const u=this.iRowChangeCount;function c(e){var t=u!==this.iRowChangeCount;p.bSuccess=r.toBool(e),n.onAfterRowChange.fire(n,p),o.pbOfflineEditing||r.toBool(e)?i&&i.call(this,!0,t):i.call(this,!1,t)}l?(n.onBeforeRowChange.fire(n,p),o.pbOfflineEditing?("row"===e&&(this.setCurrentRowId(h),this.updateColumnsFromCache(!0)),c.call(this)):(this.handleRowChange=c,o.serverAction("ChangeCurrentRow",[e,h],d&&o.serializeRows([d])||null))):i&&i.call(this,!1)}handleRowChange(e){}updateColumnsFromCache(e){const t=this.oL,i=this.oM;if(!t.pbDataAware){const s=i.rowIndexByRowId(i.sCurrentRowId);if(s>=0)for(let o=0;o<t._aColumns.length;o++)t._aColumns[o].set("psValue",i.aData[s].aCells[t._aColumns[o]._iColIndex].sValue),e&&t._aColumns[o].set("pbChanged",!1)}}triggerCacheUpdate(e,t){const i=this.oM;i.bPaged&&(i.bLast||i.aData.length-t<i.iPrefCacheOffset&&this.loadCachePage("next"),i.bFirst||e<i.iPrefCacheOffset&&this.loadCachePage("prev"))}loadCachePage(e,t,i){const s=this.oL,o=this.oM;let n="";this.bLoading||(this.bLoading=!0,"next"===e?o.aData.length&&(n=o.aData[o.aData.length-1].sRowId):"prev"===e?o.aData.length&&(n=o.aData[0].sRowId):this._bNoRender=!0,s.serverAction("LoadDataPage",[e,n],null,(function(e){this.bLoading=!1,e.bError||t&&t.call(i||this)}),this))}processDataSet(e){const t=this.oM,i=this.oL;i.serverAction("HandleProcessDataSet",[e,t.iCurrentRow],i.serializeRows(t.aData))}moveToFirstRow(){const e=this.oM,t=this.oL,i=function(){e.aData.length>0?this.selectRow("row",0):this.appendNewRow()};e.bPaged?t.pbOfflineEditing||0===e.iCurrentRow&&""===e.sCurrentRowId?this.loadCachePage("first",(function(){i.call(this)})):this.selectRow("first",-1):i.call(this)}moveToLastRow(){const e=this.oM,t=this.oL,i=function(){e.aData.length>0?this.selectRow("row",e.aData.length-1):this.appendNewRow()};e.bPaged?t.pbOfflineEditing||0===e.iCurrentRow&&""===e.sCurrentRowId?this.loadCachePage("last",(function(){i.call(this)})):this.selectRow("last",-1):i.call(this)}moveDownRow(){const e=this.oM;return e.iCurrentRow>=0&&e.iCurrentRow<e.aData.length-1&&(this.selectRow("row",e.iCurrentRow+1),!0)}moveUpRow(){const e=this.oM;e.iCurrentRow>0&&this.selectRow("row",e.iCurrentRow-1)}movePageDown(){const e=this.oM;let t=Math.round(e.iCurrentRow+this.oL._oBody.getViewSize()-1);t>=e.aData.length&&(t=e.aData.length-1),this.selectRow("row",t)}movePageUp(){const e=this.oM;let t=Math.round(e.iCurrentRow-this.oL._oBody.getViewSize()+1);t<0&&(t=0),this.selectRow("row",t)}moveToRow(e){(e=parseInt(e,10))>=0&&e<this.oM.aData.length&&this.selectRow("row",e)}moveToRowByID(e){const t=this.oM.rowIndexByRowId(e);t>=0&&this.moveToRow(t)}appendNewRow(){}}const se="groupConfig";class oe{constructor(e,t,i){this.oL=e,this.oM=t,this.oC=i,e._onKeyDown.addListener(this.onKeyDown,this),e._onSettingChange.addListener(this.onSettingsChange,this),this.loadGroupConfig()}registerMenuGroupingSelector(e){e.onGroupsChanged.on(this.onGroupsChanged,this)}applyGrouping(e){const t=this.oL,i=this.oM;if(t.peGrouping!=df.grpAutomatic)throw new df.Error(999,"Set peGrouping to groupAutomatic to use applyGrouping.");if(i instanceof te)throw new df.Error(999,"Automatic grouping not supported with paged data loading. Set peDbGridType to gtAllData or gtManual to allow automatic grouping.");if(!Array.isArray(e))throw new df.Error(999,"Received invalid grouping data, expected aray.");e.forEach((e=>{if(!t._aColumns[e.iColumnId])throw new df.Error(999,"Received invalid grouping data, invalid column id.")})),i.aGroups=e,i.aGroupHeaders=[],i.bIsGrouped=e.length>0,t._onSettingChange.fire(this,{sType:"grouping"})}applyGroupConfig(e,t){(e||!this.oL.pbStoreGroupConfig||localStorage.getItem(null==this.oL.getStorageName(se)))&&(this.applyGrouping(t),this.storeGroupConfig())}clearGrouping(){const e=this.oL,t=this.oM;t.aGroups=[],t.aGroupHeaders=[],t.bIsGrouped=!1,e._onSettingChange.fire(this,{sType:"grouping"})}storeGroupConfig(){this.oL.pbStoreGroupConfig&&localStorage.setItem(this.oL.getStorageName(se),JSON.stringify(this.oM.aGroups))}loadGroupConfig(){if(this.oL.pbStoreGroupConfig){const e=localStorage.getItem(this.oL.getStorageName(se));if(e)try{const t=JSON.parse(e);Array.isArray(t)&&this.applyGrouping(t)}catch(e){}}}triggerOnGroupsChanged(){this.oL.fireEx({sEvent:"OnGroupConfigChanged",tActionData:this.oM.aGroups,sAltServerName:"privateOnGroupConfigChanged"})}groupData(){const e=this.oL,t=this.oM,i=t.aGroups;if(e.peGrouping==df.grpAutomatic){let s=[],o=[];i.forEach((t=>{s.push(t.iColumnId),o.push(df.sys.data.compareFunction(e._aColumns[t.iColumnId].peDataType,t.bReverse))})),e.piSortColumn>=0&&-1==s.indexOf(e.piSortColumn)&&(s.push(e.piSortColumn),o.push(df.sys.data.compareFunction(e._aColumns[e.piSortColumn].peDataType,e.pbReverseOrdering))),e._aColumns.forEach(((t,i)=>{-1==s.indexOf(i)&&(s.push(i),o.push(df.sys.data.compareFunction(t.peDataType,e.pbReverseOrdering)))})),t.aGroupHeaders=[],t.customSortData(s,o);let n=[];t.aData.reduce(((r,a,l)=>{let h=null==r;a.iGroupHeaderIndex=-1;for(let l=0;l<i.length;l++)h||(h=0!=o[l](a.aCells[s[l]].sValue,r.aCells[s[l]].sValue)),h?(n[l]=t.aGroupHeaders.length,t.aGroupHeaders.push({iGroupIndex:l,iParentHeaderIndex:a.iGroupHeaderIndex,sItem:a.aCells[s[l]].sValue,iItems:1,sTotal:"",bCollapsed:e.pbGroupsCollapsible&&e.pbGroupsCollapseByDefault,_iLogicalParentGroup:l>0?n[l-1]:-1}),a.iGroupHeaderIndex=n[l]):t.aGroupHeaders[n[l]].iItems++;return a._iLogicalGroup=n[i.length-1],a}),null)}else if(e.peGrouping==df.grpCustom){let s=[];t.aData.forEach((o=>{let n=o.iGroupHeaderIndex;for(;n>=0;){const r=t.aGroupHeaders[n];if(!r)throw new df.Error(999,`Invalid weblist data, invalid group header reference for row ${o.sRowId}`,e);if(r.iParentHeaderIndex==n)throw new df.Error(999,`Invalid weblist data, recursive group header index ${n} `,e);if(!i[r.iGroupIndex])throw new df.Error(999,`Invalid weblist data, group ${r.iGroupIndex} referenced by group header ${n} does not exist.`,e);s[r.iGroupIndex]=n,r._iLogicalParentGroup=r.iGroupIndex>0?s[r.iGroupIndex-1]:-1,n=r.iParentHeaderIndex}o._iLogicalGroup=s[i.length-1]}))}}onGroupsChanged(e){this.applyGrouping(e.aGroups),this.storeGroupConfig(),this.triggerOnGroupsChanged()}toggleGroupHeader(e){const t=this.oM,i=t.aGroupHeaders[e];i&&(i.bCollapsed=!i.bCollapsed,t.prepDisplay(),t.onDataUpdate.fire(this,{sType:"display"}))}collapseAll(){const e=this.oM;e.bIsGrouped&&(e.aGroupHeaders.forEach((e=>e.bCollapsed=!0)),e.prepDisplay(),e.onDataUpdate.fire(this,{sType:"display"}))}expandAll(){const e=this.oM;e.bIsGrouped&&(e.aGroupHeaders.forEach((e=>e.bCollapsed=!1)),e.prepDisplay(),e.onDataUpdate.fire(this,{sType:"display"}))}collapseCurrent(){const e=this.oM;if(e.iCurrentRow&&e.aData[e.iCurrentRow]){let t=e.aData[e.iCurrentRow]._iLogicalGroup;for(;t>=0;){const i=e.aGroupHeaders[t];if(!i.bCollapsed)return i.bCollapsed=!0,e.prepDisplay(),e.onDataUpdate.fire(this,{sType:"display",iDisplayItem:i._iItemIndex}),!0;t=i._iLogicalParentGroup}}return!1}expandCurrent(){const e=this.oM;if(e.iCurrentRow&&e.aData[e.iCurrentRow]){let t=e.aData[e.iCurrentRow]._iLogicalGroup;for(;t>=0;){const i=e.aGroupHeaders[t];if(i.bCollapsed&&(i._iLogicalParentGroup<0||!e.aGroupHeaders[i._iLogicalParentGroup].bCollapsed))return i.bCollapsed=!1,e.prepDisplay(),e.onDataUpdate.fire(this,{sType:"display"}),!0;t=i._iLogicalParentGroup}}return!1}makeCurrentRowVisible(){const e=this.oM;let t=!1;if(e.iCurrentRow>=0&&e.aData[e.iCurrentRow]){let i=e.aData[e.iCurrentRow]._iLogicalGroup;for(;i>=0;){const s=e.aGroupHeaders[i];s.bCollapsed&&(s.bCollapsed=!1,t=!0),i=s._iLogicalParentGroup}}return t&&(e.prepDisplay(),e.onDataUpdate.fire(this,{sType:"display"})),t}onKeyDown(e){const t=e.oDOMEvent;return t.matchKey(df.settings.listKeys.collapseAllGrp)?(this.collapseAll(),t.stop(),!1):t.matchKey(df.settings.listKeys.expandAllGrp)?(this.expandAll(),t.stop(),!1):t.matchKey(df.settings.listKeys.collapseGrp)?(this.collapseCurrent(),t.stop(),!1):t.matchKey(df.settings.listKeys.expandGrp)?(this.expandCurrent(),t.stop(),!1):void 0}onSettingsChange(e){const t=this.oM;if(t.bIsGrouped&&("pbGroupsCollapsible"==e.sProp||"pbGroupsCollapseByDefault"==e.sProp))return this.groupData(),t.prepDisplay(),t.onDataUpdate.fire(this,{sType:"display"}),!1}}class ne{constructor(e,t){this.oL=e,this.oM=t,this.iColMin=20,this.iRound=df.sys.isIE&&df.sys.iVersion<=8?1:100,this.sTableWidth="100%",e._onSettingChange.on(this.onSettingChange,this)}init(){this.prepareLayout()}onSettingChange(e){"prepare-redraw"===e.sType&&this.prepareLayout()}rowHtml(e,t,i,s,o,n,r){const a=this.oL;if(e&&e.aCells.length<a._aColumns.length+a._aSwipeBtns.length)throw new df.Error(999,"List data is not containing enough columns ({{0}} / {{1}}).",a,[e.aCells.length,a._aColumns.length+a._aSwipeBtns.length]);t.push('<table data-dfisrow="true" data-dfitem="',r,'" data-dfrowid="',e?e.sRowId:"empty",this.oL.pbDragDropEnabled&&(this.oL.isSupportedDragAction(df.dragActions.WebList.ciDragRow)||this.oL.isSupportedDragAction(df.dragActions.WebMultiSelectList.ciDragRowSelection))?'" draggable="true"':'" ','" class="',this.rowClass(e,i,s,o,n),'" style="width:',this.sTableWidth,'">'),this.resizeRowHtml(t);for(let i=0;i<this.oL._aColumnMapper.length;i++){if(!this.oL._aColumnMapper[i].pbRender||this.oL._aColumnMapper[i].pbHidden)continue;const s=this.oL._aColumnMapper[i];s.pbNewLine&&t.push("</tr><tr>");const o=e&&(e.aCells[s._iColIndex].sTooltip||s.pbValueAsTooltip&&s.tooltipValue(e.aCells[s._iColIndex]))||"";let n=e&&e.fCellClass?e.fCellClass(s,e&&e.aCells[s._iColIndex]||null):this.cellClass(s,e&&e.aCells[s._iColIndex]||null);t.push('<td data-dfcol="',s._iCol,'" class="',n,'" title="',df.dom.encodeAttr(o),'"'),s.piListRowSpan>1&&t.push(' rowspan="',s.piListRowSpan,'"'),s.piListColSpan>1&&t.push(' colspan="',s.piListColSpan,'"'),s.pbVisible||t.push(df.cHideColumnCSS),t.push(">",e?this.cellHtml(s,e,e.aCells[s._iColIndex]):"&nbsp;","</td>")}t.push("</tr></table>")}cellClass(e,t){const i=[];return i.push(e._sCellClass),i.push(e.isEnabled()?df.CssEnabled:df.CssDisabled),e.pbEditable&&"WebGrid"===this.oL._sControlClass&&i.push("WebEditable"),i.push(e.peAlign===df.ciAlignLeft?"WebList_AlignLeft":e.peAlign===df.ciAlignCenter?"WebList_AlignCenter":e.peAlign===df.ciAlignRight?"WebList_AlignRight":""),e.peDataType===df.ciTypeBCD?i.push("dfData_BCD"):e.peDataType===df.ciTypeDate?i.push("dfData_Date"):i.push("dfData_Text"),e.psCSSClass&&i.push(e.psCSSClass),t&&t.sCssClassName&&i.push(t.sCssClassName),i.join(" ")}rowClass(e,t,i,s,o){const n=["WebList_Row"];return(e&&e.sRowId)===this.oM.sCurrentRowId&&n.push("WebList_Selected"),n.push(t?" WebList_RowOdd":" WebList_RowEven"),e||n.push("WebList_RowEmpty"),e&&e.sCssClassName&&n.push(e.sCssClassName),n.push(`Web_Level${i}`),s&&n.push("Web_First"),o&&n.push("Web_Last"),n.join(" ")}cellHtml(e,t,i){i=i||{sValue:"",sTooltip:"",sCssClassName:"",aOptions:[]};const s=e._bHasFocus;e._bHasFocus=!1;const o=t&&t.fCellHtml?t.fCellHtml.call(e,t.sRowId,i):e.cellHtml(t.sRowId,i);return e._bHasFocus=s,o}resizeRowHtml(e){const t=this.aColWidths,i=!this.oL.pbAutoColumnSizing;e.push("<colgroup>");for(let s=0;s<t.length;s++)i||t[s].bFixed?e.push('<col data-dfcol="',t[s].oCol._iCol,'" style="width: ',t[s].iPixels,'px"></col>'):e.push('<col data-dfcol="',t[s].oCol._iCol,'" style="width: ',t[s].iPercent,'%"></col>');e.push("</colgroup>")}prepareLayout(){let e,t=0,i=0,s=0,o=[],n=0,r=0,a=0;const l=[];for(let o=0;o<this.oL._aColumnMapper.length;o++)if(this.oL._aColumnMapper[o].pbRender&&!this.oL._aColumnMapper[o].pbHidden){for(e=this.oL._aColumnMapper[o],e.piListColSpan=Math.max(e.piListColSpan,1),e.piListRowSpan=Math.max(e.piListRowSpan,1),e.pbNewLine&&l.length>0&&(l[i].length>t&&(t=l[i].length),i++,s=0);l[i]&&l[i][s];)s++;for(let t=0;t<e.piListRowSpan;t++){l[i+t]||(l[i+t]=[]);for(let o=0;o<e.piListColSpan;o++)l[i+t][s+o]=e}s+=e.piListColSpan}l[i]&&l[i].length>t&&(t=l[i].length);for(let s=0;s<t;s++){for(o[s]={bDef:!1,bGues:!1,bFixed:!1,iWidth:0,oCol:null},i=0;i<l.length;i++)if(e=l[i][s],e){if(1===e.piListColSpan){o[s].bDef=!0,o[s].bFixed=e.pbFixedWidth,o[s].iWidth=e.piWidth,o[s].oCol=e;break}o[s].bGues||(o[s].bGues=!0,o[s].bFixed=e.pbFixedWidth,o[s].iWidth=e.piWidth/e.piListColSpan,o[s].oCol=e)}o[s].bFixed?r+=o[s].iWidth:a+=o[s].iWidth}for(let e=0;e<o.length;e++)n+=o[e].iWidth,o[e].iPixels=o[e].iWidth,o[e].bFixed||(o[e].iPercent=Math.floor(o[e].iWidth*(100/a)*this.iRound)/this.iRound);this.aColWidths=o,this.oL.pbAutoColumnSizing?this.sTableWidth="100%":this.sTableWidth=n+"px"}recalcColumnSizes(e,t,i){let s,o=0,n=0;if(this.oL.pbAutoColumnSizing){const r=this.calcPixelRatio();for(let t=e+1;t<this.aColWidths.length;t++)this.aColWidths[t].bFixed?o+=this.aColWidths[t].iPixels:o+=this.aColWidths[t].iPercent*r,(this.aColWidths[t].oCol.pbResizable||i)&&n++;for(this.aColWidths[e].bFixed?this.aColWidths[e].iPixels=this.aColWidths[e].iPixels+t:this.aColWidths[e].iPercent=(this.aColWidths[e].iPercent*r+t)/r;0!==Math.round(t||0)&&t!==s;){const o=t/n;s=t;for(let s=e+1;s<this.aColWidths.length;s++)if(this.aColWidths[s].oCol.pbResizable||i){const e=this.aColWidths[s].bFixed?this.aColWidths[s].iPixels:this.aColWidths[s].iPercent*r;let i=e-o;i<this.iColMin&&(i=this.iColMin),this.aColWidths[s].bFixed?this.aColWidths[s].iPixels=i:this.aColWidths[s].iPercent=i/r,t-=e-i}}for(let e=0;e<this.aColWidths.length;e++)this.aColWidths[e].bFixed?this.aColWidths[e].oCol.piWidth=this.aColWidths[e].iPixels:this.aColWidths[e].oCol.piWidth=10*this.aColWidths[e].iPercent,this.aColWidths[e].oCol.addSync("piWidth")}else this.aColWidths[e].oCol.piWidth=this.aColWidths[e].iPixels=this.aColWidths[e].iPixels+t,this.aColWidths[e].oCol.addSync("piWidth");this.oL.redraw()}calcPixelRatio(){let e=this.oL._oBody.fullwidth();for(let t=0;t<this.aColWidths.length;t++)this.aColWidths[t].bFixed&&(e-=this.aColWidths[t].iPixels);return e/100}findVColNr(e){const t=this.oL;let i=0;for(let s=0;s<t._aColumnMapper.length;s++){const o=t._aColumnMapper[s];if(o.pbRender&&!o.pbHidden){if(o.pbNewLine&&(i=0),o===e)return i;i+=o.piListColSpan}}return-1}}class re extends O{constructor(e,t){super(e,t),this.prop(r.tString,"psRootCaption",""),this.prop(r.tBool,"pbShowCaption",!0),this.prop(r.tBool,"pbShowBackItem",!0),this.prop(r.tBool,"pbShowIcons",!1),this._sCurrentMenu="",this._eCurrentMenu=null,this._oMenuBtn=null,this._bIsMenuListener=!0,this.pbShowLabel=!1,this._bRenderChildren=!1,this._sControlClass="WebMenuList"}openHtml(e){super.openHtml(e),e.push('<div class="WebMenuWrp" tabindex="0">','<div class="WebML_Title"',this.pbShowCaption?"":' style="display: none"',">",'<span class="WebML_Caption">',this.psRootCaption,"</span>","</div>",'<div class="WebML_Panel',this.pbShowIcons?" WebML_ShowIcons":"",'">','<div class="WebML_Mnu WebML_Root WebML_Current" data-dfmenu-path="">');const t=this.getMenu();this.genMenuHtml(e,t,!1),e.push("</div>","</div>")}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){let e;this._eControl=r.dom.query(this._eElem,"div.WebMenuWrp"),this._eMenuPanel=e=r.dom.query(this._eElem,"div.WebML_Panel"),this._eMenuTitle=r.dom.query(this._eElem,"div.WebML_Title"),this._eMenuCaption=r.dom.query(this._eElem,"span.WebML_Caption");const t=this._eCurrentMenu=r.dom.query(e,"div.WebML_Mnu");super.afterRender(),r.dom.on("click",e,this.onMenuClick,this),this.piHeight<=0&&!this.pbFillHeight&&r.dom.animFrame((function(){t.firstChild&&(e.style.height=this.getMenuHeight(this._eCurrentMenu)+"px",this.sizeChanged())}),this),this.notifyMenuRendered(this.getMenu())}genMenuHtml(e,t,i){e.push("<ul>"),i&&this.pbShowBackItem&&e.push('<li class="WebML_Item WebML_Back" data-df-path="go-back"><a href="javascript:void(0);" target="_self">',this.getWebApp().getTrans("back"),"</a></li>");for(let i=0;i<t.length;i++){const s=t[i],o=["WebML_Item",s.sCSSClass,s.bEnabled?r.CssEnabled:r.CssDisabled];s.aChildren.length>0&&o.push("WebML_HasSub"),s.bBeginGroup&&e.push('<li class="WebML_Divider">',s.sGroupCaption||"","</li>"),this.genItemHtml(e,s,!1)}e.push("</ul>")}onMenuClick(e){let t,i,s=e.getTarget();const o=this;for(;!t&&s&&s!==this._eElem;)if(s.hasAttribute("data-df-path")){const i=s.getAttribute("data-df-path");if("go-back"===i)return this.levelUp(),void e.stop();t=this.getItemByPath(i)}else s=s.parentNode;if(t){if(t.bEnabled){if(t.aChildren.length>0){if(i=r.dom.query(this._eMenuPanel,'div.WebML_Mnu[data-dfmenu-path="'+t._sPath+'"]'),!i){const e=[];e.push('<div class="WebML_Mnu WebML_HiddenSub" data-dfmenu-path="',t._sPath,'">'),this.genMenuHtml(e,t.aChildren,!0),e.push("</div>"),i=r.dom.create(e.join("")),this._eMenuPanel.appendChild(i),this.notifyMenuRendered(t.aChildren,i)}const e=this._eCurrentMenu;r.dom.setText(this._eMenuCaption,t.sCaption),setTimeout((function(){e&&(r.dom.addClass(e,"WebML_HiddenParent"),r.dom.removeClass(e,"WebML_Current")),r.dom.addClass(i,"WebML_Current"),r.dom.removeClass(i,"WebML_HiddenSub"),o.OnUiUpdate.fire(this,{bUiDriven:!0}),o.updateMenuSize()}),20),this._sCurrentMenu=t._sPath,this._eCurrentMenu=i}t._oHandler.itemClick(t,(function(e){!e||!this._oMenuBtn||t.hRef instanceof k||t.aChildren.length||this._oMenuBtn.hideMenu()}),this)}e.stop()}}expandItem(e){e.aChildren.length>0?this._sCurrentMenu=e._sPath:this._sCurrentMenu="",this.refreshMenu(),this.OnUiUpdate.fire(this,{bUiDriven:!0})}showItem(e){const t=this.getItemByPath(e._sPath.substr(0,e._sPath.lastIndexOf(".")));t?this.expandItem(t):(this._sCurrentMenu="",this.refreshMenu())}collapseAll(){this._sCurrentMenu="",this.refreshMenu(),this.OnUiUpdate.fire(this,{bUiDriven:!0})}levelUp(){var e,t,i=null;const s=this;if(this._sCurrentMenu){if(this._sCurrentMenu.indexOf(".")>0&&(this._sCurrentMenu=this._sCurrentMenu.substr(0,this._sCurrentMenu.lastIndexOf(".")),i=this.getItemByPath(this._sCurrentMenu)),i?t=i.aChildren:(this._sCurrentMenu="",t=this.getMenu()),!(e=r.dom.query(this._eMenuPanel,'div.WebML_Mnu[data-dfmenu-path="'+this._sCurrentMenu+'"]'))){const i=[];i.push('<div class="WebML_Mnu WebML_HiddenParent',t===this.getMenu()?" WebML_Root":"",'" data-dfmenu-path="',this._sCurrentMenu,'">'),this.genMenuHtml(i,t,!!this._sCurrentMenu),i.push("</div>"),e=r.dom.create(i.join("")),this._eMenuPanel.appendChild(e),this.notifyMenuRendered(t,e)}const o=this._eCurrentMenu;i?r.dom.setText(this._eMenuCaption,i.sCaption):r.dom.setText(this._eMenuCaption,this.psRootCaption),setTimeout((function(){o&&(r.dom.addClass(o,"WebML_HiddenSub"),r.dom.removeClass(o,"WebML_Current")),r.dom.addClass(e,"WebML_Current"),r.dom.removeClass(e,"WebML_HiddenParent"),s.OnUiUpdate.fire(this,{bUiDriven:!0}),s.updateMenuSize()}),20),this._eCurrentMenu=e}}refreshMenu(){let e,t,i;const s=[];this._eMenuPanel&&(this._sCurrentMenu&&(e=this.getItemByPath(this._sCurrentMenu)),e?t=e.aChildren:(this._sCurrentMenu="",t=this.getMenu()),s.push('<div class="WebML_Mnu WebML_Current',t===this.getMenu()?" WebML_Root":"",'" data-dfmenu-path="',this._sCurrentMenu,'">'),this.genMenuHtml(s,t,!!this._sCurrentMenu),s.push("</div>"),this._eMenuPanel.innerHTML=s.join(""),i=this._eMenuPanel.firstChild,this.notifyMenuRendered(t,i),e?r.dom.setText(this._eMenuCaption,e.sCaption):r.dom.setText(this._eMenuCaption,this.psRootCaption),this._eCurrentMenu=i,this.updateMenuSize())}updateMenuSize(e){if(!this.pbFillHeight&&this.piHeight<=0&&this._eCurrentMenu){const t=this.getMenuHeight(this._eCurrentMenu);this._eMenuPanel.style.height=t+"px",e||this.sizeChanged(),r.dom.animFrame((function(){var e;this._eCurrentMenu&&(e=this.getMenuHeight(this._eCurrentMenu))!==t&&(this._eMenuPanel.style.height=e+"px",this.sizeChanged())}),this)}}setHeight(e){this._eMenuPanel&&(r.dom.toggleClass(this._eMenuPanel,"WebML_NoScollRoot",e<=0),e<=0&&this._eCurrentMenu?this._eMenuPanel.style.height=this.getMenuHeight(this._eCurrentMenu)+"px":(e<=80&&(e=80),e=(e-=this.getVertHeightDiff())<0?0:e,this._eMenuPanel.style.height=e+"px"))}getVertHeightDiff(){let e=super.getVertHeightDiff();return e+=this._eMenuTitle?.offsetHeight,e+=r.sys.gui.getVertBoxDiff(this._eMenuPanel),e}getMenuHeight(e){let t=e.firstChild.offsetHeight;return t+=r.sys.gui.getVertBoxDiff(e),t}resize(){this.updateMenuSize(!0),super.resize()}set_pbShowIcons(e){this._eMenuPanel&&r.dom.toggleClass(this._eMenuPanel,"WebML_ShowIcons",e)}set_psRootCaption(e){this.psRootCaption=e,this.refreshMenu()}set_pbShowBackItem(e){this.pbShowBackItem=e,this.refreshMenu()}set_pbShowCaption(e){this._eMenuTitle&&(this._eMenuTitle.style.display=e?"":"none")}}class ae extends z{constructor(e,t){super(e,t),this.prop(r.tInt,"piMaxHeight",500),this.prop(r.tString,"psControlName",""),this.prop(r.tString,"psContextCSSSelector",""),this.prop(r.tInt,"peContext",r.WebUIContext.WebUIContextCustom),this.prop(r.tString,"psContextValue",""),this.prop(r.tBool,"pbChildScopes",!1),this.prop(r.tString,"psContextScopeName",""),this.prop(r.tBool,"pbAllowHtml"),this.prop(r.tString,"psGroupName"),this.prop(r.tBool,"pbShowIcons",!1),this.event("OnContextMenuOpen",r.cCallModeDefault,"privateOnContextMenuOpen"),this.event("OnItemClick"),this.pePosition=r.fpFloatFixed,this.piWidth=200,this.piHeight=-1,this.piColumnCount=1,this.pbHideOnEscape=!0,this._bIsMenuProv=!0,this._oRootControl=null,this._bRendered=!1,this._oMenu=null,this._oChildrenCache=[]}set_psControlName(e,t){if(this.psControlName!==e||t){if(this.unbind(),this.psControlName=e,"window"===this.psControlName?this._oRootControl={_eElem:document.documentElement}:this.psControlName.length>0?this._oRootControl=this.getWebApp().findObj(this.psControlName):this._oRootControl=this.getWebApp(),!this._oRootControl)throw new r.Error(999,"WebContextMenu could not find the Scope/Control.");this.bind()}}set_peContext(e){this.peContext!==e&&(this.unbind(),this.peContext=e,this.bind())}set_psContextCSSSelector(e){this.psContextCSSSelector!==e&&this.peContext===r.WebUIContext.WebUIContextCustom&&(this.unbind(),this.psContextCSSSelector=e,this.bind())}set_pbShowIcons(e){this._oMenu?.set_pbShowIcons(this.pbShowIcons=e)}set_psGroupName(e){this._oMenu?.set_psGroupName(this.psGroupName=e)}set_pbAllowHtml(e){this._oMenu?.set_pbAllowHtml(this.pbAllowHtml=e)}refresh(){this._oMenu&&(this._oMenu._tActionData=this._tActionData,this._oMenu.refresh(),this._oMenu._tActionData=null)}updateItem(e,t){this._oMenu&&(this._oMenu._tActionData=this._tActionData,this._oMenu.updateItem(e,t),this._oMenu._tActionData=null)}insertItem(e){this._oMenu&&(this._oMenu._tActionData=this._tActionData,this._oMenu.insertItem(e),this._oMenu._tActionData=null)}removeItem(e){this._oMenu?.removeItem(e)}notifyChange(){this._oMenu?.notifyChange()}refreshMenu(){this._oMenu&&(this._oMenu._aMenu=null,this._oMenu.refreshMenu())}collapseAll(){this._oMenu?.collapseAll()}hideMenu(){r.events.removeDomCaptureListener("click",document,this.onClickGeneral,this),r.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this),this.hide()}create(){this.set_psControlName(this.psControlName,!0),this._oMenu=new re("MenuList",this),this._oMenu.objFocus=function(){},this._oMenu._oMenuBtn=this,this._oMenu.pbShowCaption=!1,this._oMenu.pbShowBackItem=!0,this._oMenu.pbShowIcons=this.pbShowIcons;const e=this;for(this._oMenu.getMenuHeight=function(t){let i=t.firstChild.offsetHeight;return i+=r.sys.gui.getVertBoxDiff(t),i<=e.piMaxHeight?i:e.piMaxHeight},this._fMenuBaseClick=this._oMenu.onMenuClick,this._oMenu.onMenuClick=function(t){e._fMenuBaseClick.apply(this,arguments);let i,s=t.getTarget();if(s)for(;!i&&s&&s!==this._eElem&&s.hasAttribute;){if(s.hasAttribute("data-df-path"))return i=this.getItemByPath(s.getAttribute("data-df-path")),void(i&&i.bEnabled&&0===i.aChildren.length&&(i.hRef instanceof k||this._oMenuBtn.hideMenu(),e.fire("OnItemClick",[i.sId,i.sCaption])));s=s.parentNode}},this._oMenu._hContextMenu=this,this._oMenu.create();this._oChildrenCache.length;)this._oMenu.addChild(this._oChildrenCache[0]),this._oChildrenCache.splice(0,1);super.addChild(this._oMenu),super.create()}privateStopEvent(e){e.stop()}destroy(){this._bRendered&&r.dom.off("contextmenu",this._eElem,this.privateStopEvent,this),this.unbind(),super.destroy()}genClass(){return["WebContextMenu",super.genClass()].join(" ")}afterRender(){this._bRendered=!0,super.afterRender(),r.dom.on("contextmenu",this._eElem,this.privateStopEvent,this),this.bind()}afterRenderChildren(){if(super.afterRenderChildren(),this._oMenu&&this._oMenu._aChildren)for(let e=0;e<this._oMenu._aChildren.length;e++){const t=this._oMenu._aChildren[e];t._bProviderRequestAfterRender&&t.afterRender()}}isRootControlReady(){return this._oRootControl&&this._oRootControl._eElem}afterRenderRootControl(){this.rebind()}bind(){if(!this.isRootControlReady())return this._hRootControlAfterRender=this._oRootControl?.OnAfterRender,void this._hRootControlAfterRender?.on(this.afterRenderRootControl,this);if(this._oRootControl&&this._oRootControl._eElem){if(this.pbChildScopes&&!r.WebUIContext.isChildScopeCompatible(this.peContext))throw new r.Error(999,"WebContextMenu cannot use pbChildScopes with this peContext.");if(this.useCSSSelectorOfObject(this._oRootControl,this.pbChildScopes),this._oRootControl.bindHandlerForWebUIContext&&this.pbChildScopes&&!this._oRootControl.bindHandlerForWebUIContext(this,this.peContext))throw new r.Error(999,"WebContextMenu's assinged control does not allow binding with the current peContext.");r.dom.on("contextmenu",this._oRootControl._eElem,this.onContextMenuOpen,this)}else if(!this._hRootControlAfterRender)throw new r.Error(999,"WebContextMenu could not find an element for the RootControl.")}useCSSSelectorOfObject(e,t){if(this.peContext===r.WebUIContext.WebUIContextCustom)return!0;if(!e.determineSelectorForWebUIContext){if(t)return!1;throw new r.Error(999,"WebContextMenu could not contact the assigned control since it does not support the required interface.")}let i=e.determineSelectorForWebUIContext(this.peContext);if(null==i){if(t)return!1;throw new r.Error(999,"WebContextMenu's assinged control does not support the desired peContext.")}return this.psContextCSSSelector=i,this.addSync("psContextCSSSelector"),!0}unbind(){if(this._hRootControlAfterRender&&(this._hRootControlAfterRender.off(this.afterRenderRootControl,this),this._hRootControlAfterRender=null),this._oRootControl&&this._oRootControl._eElem)this._oRootControl.unbindHandlerForWebUIContext&&this.pbChildScopes&&(this._oRootControl.unbindHandlerForWebUIContext(this,this.peContext)||console.warn("WebContextMenu's assinged control does not allow unbinding with the current peContext.")),r.dom.off("contextmenu",this._oRootControl._eElem,this.onContextMenuOpen,this),r.events.removeDomCaptureListener("click",document,this.onClickGeneral,this),r.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this),this.hideMenu();else if(this._bRendered)throw new r.Error(999,"WebContextMenu could not find a element for the RootControl.")}rebind(){this.unbind(),this.bind()}addChild(e){if(!(e instanceof F))throw new r.Error(999,"WebMenuContext only supports menu items/checkboxes ("+e.getLongName()+").");this._oMenu?this._oMenu.addChild(e):this._oChildrenCache.push(e)}getVisibleChildCount(){let e=0;if(this._oMenu&&this._oMenu._aChildren)for(let t=0;t<this._oMenu._aChildren.length;t++)this._oMenu._aChildren[t].pbRender&&this._oMenu._aChildren[t].pbVisible&&e++;for(let t=0;t<this._oChildrenCache.length;t++)this._oMenu._aChildren[t].pbRender&&this._oMenu._aChildren[t].pbVisible&&e++;return this._oMenu?._aDynamicMenu&&(e+=this._oMenu._aDynamicMenu.length),e}showView(e){super.showView(e),this.rebind()}hideView(e){super.hideView(e),this.unbind()}show(){this.isEnabled()&&(this.pbVisible=!0,this._bViewVisible&&this.doShow())}isVisible(){return!0===this.pbVisible}onClickGeneral(e){this._eElem.contains(e.getTarget())||(r.events.removeDomCaptureListener("click",document,this.onClickGeneral,this),r.events.removeDomCaptureListener("contextmenu",document,this.hideMenu,this),this.hideMenu())}onContextMenuOpen(e){this._bRendered||(this.render(),this.afterRender());let t=document.elementFromPoint(e.e.clientX,e.e.clientY),i=this._oRootControl;if(this.pbChildScopes){let e=t;for(;!e.hasAttribute("data-dfobj")&&e!=this._oRootControl._eElem;){if(!e.parentNode||!e.parentNode.hasAttribute)throw new r.Error(999,"WebContextMenu could not find a TargetScope control element.");e=e.parentNode}if(i=this.getWebApp()?.findObj(e.getAttribute("data-dfobj")),!i)throw new r.Error(999,"WebContextMenu could not find a TargetScope control.");if(!this.useCSSSelectorOfObject(i,!0))return}let s=0===this.psContextCSSSelector.length;for(;t&&t.matches&&t!==this._oRootControl._eElem&&!s&&(s=t.matches(this.psContextCSSSelector),!s);)t=t.parentNode;this.psContextScopeName=i.getLongName(),this.addSync("psContextScopeName");let o=!i.verifyElementForWebUIContext||i.verifyElementForWebUIContext(t,this.peContext);if(this.isEnabled()&&s&&o&&this.getVisibleChildCount()){if(e.stop(),this.psContextValue="",i.retrieveValueFromWebUIContext&&this.peContext>r.WebUIContext.WebUIContextCustom){let e=i.retrieveValueFromWebUIContext(t,this.peContext);if(null==e)throw new r.Error(999,"WebContextMenu's assinged control does not support the desired peContext or we passed the wrong element.");if(e.toString)this.psContextValue=e.toString();else{if(!(e instanceof Object))throw new r.Error(999,"WebContextMenu could not convert the determined Value returned by the assigned control.");this.psContextValue=JSON.stringify(e)}}this.addSync("psContextValue"),r.events.addDomCaptureListener("click",document,this.onClickGeneral,this),r.events.addDomCaptureListener("contextmenu",document,this.hideMenu,this),this.fire("OnContextMenuOpen",[],(function(t){if("1"===t.sReturnValue)return;this._oMenu._sCurrentMenu="",this.refreshMenu(),this.piLeft=e.e.clientX,this.piTop=e.e.clientY,this.show();const i=r.sys.gui.getBoundRect(this._oMenu._eCurrentMenu);i.right>window.innerWidth&&window.innerWidth-i.left<=i.width?this.piLeft=i.left-i.width:i.right>window.innerWidth&&(this.piLeft=window.innerWidth-i.width),i.bottom>window.innerHeight&&window.innerHeight-i.top>=i.height?this.piTop=i.top-i.height:i.bottom>window.innerHeight&&(this.piTop=window.innerHeight-i.height),this.positionPnl()}))}}doHide(e,t){const i=this.getWebApp();this._tPositionInterval&&(clearInterval(this._tPositionInterval),this._tPositionInterval=null),r.dom.addClass(this._eElem,"WebFP_Hidden"),r.dom.removeClass(this._eElem,"WebFP_Visible"),e||this.positionPnl(),this.afterHide(),this._eMask&&(r.dom.off("click",this._eMask,this.onMaskTouch,this),this._eMask.parentNode.removeChild(this._eMask),this._eMask=null),this._eBlurBuddy&&r.events.removeDomCaptureListener("blur",this._eBlurBuddy,this.onCaptureBlur,this),this.pePosition===r.fpFloatLeftSqueezeWebApp&&i&&i._eElem&&(i._eElem.style.marginLeft="0px"),this.fire("OnHide",[t]),!this.pbVisible&&this._eElem&&(this._eElem.style.display="none",this._bVisible=!1)}enable(e){this.pbEnabled=null===e||e}disable(){this.pbEnabled=!1}createMenuItem(e){const t=new F(null,this);return t.psCaption=e,t.create(),t}createCheckedMenuItem(e,t,i){const s=new k(null,this);return s.psCaption=e,s.pbChecked=t,arguments.length>2&&(s.pbEnabled=i),s.create(),s}}class le extends F{constructor(e,t){super(e,t),this._bProviderRequestAfterRender=!0}getList(){if(this._oList)return this._oList;if(!this.getProv())throw new r.Error(999,"cWebMenuColumnBase could not find it's parent WebContextMenu.",this);if(!(this._oProv instanceof ae))throw new r.Error(999,"cWebMenuColumnBase's provider should be a WebContextMenu.",this);let e=this._oProv._oRootControl;if(!(e instanceof _e))throw new r.Error(999,"Control-Referece/Parent of cWebMenuColumnBase should be a WebList/WebGrid.",this);return this._oList=e}}class he extends le{constructor(e,t){super(e,t),this._iAddedColums=0}afterRender(){super.afterRender();let e=this.getList();if(!e)throw new r.Error(999,"WebMenuColumnList could not find it's WebList.",this);this.refreshColumnList(),e._oHeader?.registerMenuColumnList(this)}refreshColumnList(){if(this._iAddedColums)for(;this._iAddedColums;)this._aChildren[0].destroy(),this._aChildren.splice(0,1),this._iAddedColums--;const e=this.getList();if(!e)throw new r.Error(999,"WebMenuColumnList could not find it's WebList.",this);let t=e._aColumns.length;for(let i=0;i<t;i++){if(!e._aColumns[i].pbRender||0===e._aColumns[i].psCaption.length)continue;let t=new k(null,this);t.psCaption=e._aColumns[i].psCaption,t.pbChecked=0==e._aColumns[i].pbHidden,t.pbEnabled=e._aColumns[i].pbHideable,t._oColumnRef=e._aColumns[i],t.create(),t.OnClick.on((function(t){if(!this._oColumnRef.pbHideable)return void t.stop();e._aColumns.filter((function(e){return e.pbRender&&!e.pbHidden&&0!==e.psCaption.length})).length<=1?(this.set_pbChecked(!0),this._oColumnRef.set_pbHidden(!1)):(this.set_pbChecked(!this._oColumnRef.pbHidden),this._oColumnRef.set_pbHidden(!this._oColumnRef.pbHidden)),e.triggerLayoutChange(this._oColumnRef),t.stop()}),t),this._aChildren.splice(this._iAddedColums++,0,t)}this.getProv().refreshMenu()}addChild(e){super.addChild(e),this.getProv().refreshMenu()}}r.WebMenuColumnList=he;class de extends le{constructor(e,t){super(e,t)}afterRender(){super.afterRender();let e=this.getList();if(!e)throw new r.Error(999,"WebMenuColumnRestorer could not find it's WebList.",this);e._oHeader?.registerMenuColumnRestorer(this)}itemClick(e,t,i){let s=this.getList();if(!s)throw new r.Error(999,"WebMenuColumnList could not find it's WebList.",this);return s.triggerRestoreColumnLayout(this),super.itemClick(e,t,i)}addChild(){throw new r.Error(999,"a cWebMenuColumnRestorer is not supposed to have children.",this)}}class pe{constructor(e,t,i){this.oL=e,this.oC=i,this.oR=e._oRowRenderer,this._oHeaderMenu=null,this._oHeaderMenuColumnList=null,this._oHeaderMenuColumnRestorer=null,this._bHeaderMenuPreviousState=!0,this._oColumnNewLineCache=[],e._onResize.on(this.onResize,this),e._onSettingChange.on(this.onSettingChange,this),e._onModulesCreated.on(this.onModulesCreated,this)}onModulesCreated(e){const t=this.oL._oBody;t instanceof ee&&t.onHorizontalScroll.on(this.onHorizontalScroll,this)}genHtml(e){const t=this.oL;e.push('<div class="WebList_Head"',t.pbShowHeader?"":' style="display:none"',">"),e.push('<div class="WebList_HeadWrp',t.pbColumnsResizable?" WebList_ColResizable":"",t.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">'),this.headerHtml(e),e.push("</div>"),e.push("</div>")}afterRender(e){this.eHead=r.dom.query(e,"div.WebList_Head"),this.eHeadWrp=r.dom.query(e,"div.WebList_HeadWrp"),r.dom.on("click",this.eHead,this.onHeadClick,this),r.dom.on("mousedown",this.eHead,this.onHeadMouseDown,this),r.dom.on("dblclick",this.eHead,this.onHeadDblClick,this),this.refreshColumnList(),this.setColumnReordering(this.oL.pbAllowColumnReordering)}registerHeaderMenu(e){if(this._oHeaderMenu)throw new r.Error(999,"A WebContextMenu with the context 'ListHead' is already registered, only one is allowed.",this);this._oHeaderMenu=e}unregisterHeaderMenu(e){this._oHeaderMenu&&this._oHeaderMenu===e||console.warn("A WebContextMenu with the context 'ListHead' is already registered, only one is allowed.",this),this._oHeaderMenu=null}registerMenuColumnList(e){if(this._oHeaderMenuColumnList)throw new r.Error(999,"A WebMenuColumnList is already registered, only one is allowed.",this);if(!(e instanceof he))throw new r.Error(999,"registerMenuColumnList() should only be called with a WebMenuColumnList.",this);this._oHeaderMenuColumnList=e,this._oHeaderMenuColumnList.pbRender=this.oL.pbAllowColumnReordering}registerMenuColumnRestorer(e){if(this._oHeaderMenuColumnRestorer)throw new r.Error(999,"A WebMenuColumnRestorer is already registered, only one is allowed.",this);if(!(e instanceof de))throw new r.Error(999,"registerMenuColumnRestorer() should only be called with a WebMenuColumnRestorer.",this);this._oHeaderMenuColumnRestorer=e,this._oHeaderMenuColumnRestorer.pbRender=this.oL.pbAllowColumnReordering}refreshColumnList(){this._oHeaderMenuColumnList?.refreshColumnList()}setColumnHiding(e){this._oHeaderMenuColumnList&&(this._oHeaderMenuColumnList.pbRender=e),this.refreshColumnList()}setColumnReordering(e){this._oHeaderMenuColumnRestorer&&(this._oHeaderMenuColumnRestorer.pbRender=e),e&&!r.sys.isMobile?r.dom.on("dragstart",this.eHead,this.onHeadMouseDownWithDraggingProxy,this):r.dom.off("dragstart",this.eHead,this.onHeadMouseDownWithDraggingProxy,this),this._oHeaderMenu?.refreshMenu()}onHeadMouseDownWithDraggingProxy(e){this.onHeadMouseDown(e,!0)}headerHtml(e){const t=this.oL,i=this.oR;let s,o=null;e.push('<table style="width:',i.sTableWidth,'">'),i.resizeRowHtml(e),e.push("<tr>"),o=this.oL._aColumnMapper[this.oL._aColumnMapper.length-1];for(let i=0;i<this.oL._aColumnMapper.length;i++){if(!this.oL._aColumnMapper[i].pbRender||this.oL._aColumnMapper[i].pbHidden)continue;const n=this.oL._aColumnMapper[i];n.pbNewLine&&e.push("</tr><tr>"),s="WebList_ColHead",n._iCol===t.piSortColumn&&(s+=t.pbReverseOrdering?" WebList_Sorted":" WebList_SortedReverse"),t.pbColumnSortable&&n.pbSortable&&(s+=" WebList_Sortable"),n.headerCSS()&&(s+=" "+n.headerCSS()),s+=" "+this.oR.cellClass(n,null),e.push("<th ",this.oL.pbAllowColumnReordering?'draggable="true"':"",' class="',s,'" data-dfcol="',n._iCol,'"'),n.piListRowSpan>1&&e.push(' rowspan="',n.piListRowSpan,'"'),n.piListColSpan>1&&e.push(' colspan="',n.piListColSpan,'"'),n.psToolTip&&e.push(' title="',r.dom.encodeHtml(n.psToolTip),'"'),n.pbVisible||e.push(r.cHideColumnCSS),e.push("><div>"),e.push('<div class="WebList_ColCap">',n.headerHtml(),"</div>"),!n.pbResizable||t.pbAutoColumnSizing&&n===o||e.push('<div class="WebList_ColSep" data-dfcol="',n._iCol,'"></div>'),e.push("</div></th>")}e.push("</tr></table>")}updateHeader(){const e=[],t=this.offsetHeight();this.oL.pbAllowColumnHiding&&this.refreshColumnList(),this.eHeadWrp&&(this.headerHtml(e),this.eHeadWrp.innerHTML=e.join("")),t!=this.offsetHeight()&&this.oL.sizeChanged()}offsetHeight(){if(this.eHead)return this.eHead.offsetHeight}onHeadClick(e){let t=e.getTarget();if(this.oL.isEnabled())for(;t.parentNode&&t!==this._eHead;){if("TH"===t.tagName&&t.hasAttribute("data-dfcol")){const i=parseInt(t.getAttribute("data-dfcol"),10);return void(this.oC.headClick(e,i)&&e.stop())}t=t.parentNode}}onHeadDblClick(e){let t=e.getTarget();if(this.oL.isEnabled())for(;t.parentNode&&t!==this._eHead;){if("TH"===t.tagName&&t.hasAttribute("data-dfcol")){const i=parseInt(t.getAttribute("data-dfcol"),10);return void(this.oC.headDblClick(e,i)&&e.stop())}t=t.parentNode}}onHeadMouseDown(e,t){let i=e.getTarget();if(!this.oL.isEnabled())return e.stop(),!1;if(0===e.e.button){if(!this._oHeaderMenu||!this._oHeaderMenu.isVisible()){if("WebList_ColSep"===i.className&&this.oL.pbColumnsResizable)return this._oHeaderMenu&&(this._bHeaderMenuPreviousState=this._oHeaderMenu.isEnabled(),this._oHeaderMenu.disable()),this.resizeColumn(e,parseInt(i.getAttribute("data-dfcol"),10)),e.stop(),!1;if((i.classList.contains("WebList_ColHead")||"WebList_ColCap"===i.className)&&this.oL.pbAllowColumnReordering&&t){for(this._oHeaderMenu&&(this._bHeaderMenuPreviousState=this._oHeaderMenu.isEnabled(),this._oHeaderMenu.disable());!i.classList.contains("WebList_ColHead");)i=i.parentNode;const t=parseInt(i.getAttribute("data-dfcol"),10),s=this;this._oColumnNewLineCache=[];for(let e=0;e<this.oL._aColumnMapper.length;e++)this.oL._aColumnMapper[e].pbNewLine&&(this._oColumnNewLineCache.push(e),this.oL._aColumnMapper[e].pbNewLine=!1);return this._oColumnNewLineCache.length>0&&this.oL.redraw(),setTimeout((function(){const i=r.dom.query(s.eHead,'.WebList_ColHead[data-dfcol="'+t+'"');s.moveColumn(i,e,t)}),this._oColumnNewLineCache.length>0?75:0),e.stop(),!1}return!0}this._oHeaderMenu.hideMenu()}}moveColumn(e,t,i){const s=this.oL._eElem.cloneNode(!0),o=[];for(let e=0;e<this.oL._aColumnMapper.length;e++)this.oL._aColumnMapper[e].pbRender&&!this.oL._aColumnMapper[e].pbHidden&&o.push(e);const n=Array.prototype.indexOf.call(e.parentNode.children,e),a=o[n];let l=a;for(let t=0;t<e.childNodes.length;t++)e.removeChild(e.childNodes[t]);e.classList.add("WebList_Moving");const h=r.dom.query(this.oL._oBody.eBody,'td[data-dfcol="'+i+'"',!0);for(let e=0;e<h.length;e++)h[e].innerHTML="",h[e].classList.add("WebList_Moving");const d=e.getBoundingClientRect(),p=d.width/2,u=d.height/2,c=r.dom.query(s,"[data-dfcol]",!0);for(let e=0;e<c.length;e++)c[e].getAttribute("data-dfcol")!=i?c[e].parentNode.removeChild(c[e]):c[e].style.width="100%";const g=r.dom.query(s,".WebList_Scroll");g&&g.parentNode.removeChild(g);let _=r.dom.query(s,".WebList_HorizScroll",!0);for(let e=0;e<_.length;e++)r.dom.removeClass(_[e],"WebList_HorizScroll");if(this.oL.pbShowLabel){const e=r.dom.query(s,"div > label",!1);e&&e.parentNode.removeChild(e)}s.style.position="fixed",s.style.left=t.e.clientX-p+"px",s.style.top=t.e.clientY-u+"px",s.style.width=d.width+"px",s.style["pointer-events"]="none",(this.oL.topLayer()||document.body).appendChild(s);var m=document.body.style.overflow;document.body.style.overflow="hidden";const b=r.dom.query(this.oL._eElem,'[data-dfcol="'+i+'"',!0);function C(t){function i(e,t){const i=e.parentNode;i.removeChild(e),t>=i.childNodes.length?i.appendChild(e):i.insertBefore(e,i.childNodes[t])}i(e,t);for(let e=0;e<b.length;e++)i(b[e],t)}let f=Date.now();const w=this.oL._oBody.eTableWrp,S=20;function y(e){if(s.style.left=e.e.clientX-p+"px",s.style.top=e.e.clientY-u+"px",this.oL._oBody.eTableWrp){let t=w.getBoundingClientRect();Date.now()-f>100&&(e.e.clientX<t.left+S+S?(w.scrollLeft-=S,f=Date.now()):e.e.clientX>t.right-S-S&&(w.scrollLeft+=S,f=Date.now()))}let t=e.getTarget();for(;t.hasAttribute&&!t.hasAttribute("data-dfcol")&&t!=this.oL._eElem;)t=t.parentNode;let i=t;if(t.hasAttribute&&t.hasAttribute("data-dfcol"))for(;i.hasAttribute&&!i.hasAttribute("data-dfobj")&&t!=this.oL._eElem;)i=i.parentNode;if(!t.hasAttribute||!t.hasAttribute("data-dfcol")||i!==this.oL._eElem)return void C(n);if(t.classList.contains("WebList_Moving"))return;const r=t.getBoundingClientRect(),a=r.left+(r.right-r.left)/3,h=r.right-(r.right-r.left)/3;if(e.e.x>a&&e.e.x<h)return;let d=Array.prototype.indexOf.call(t.parentNode.children,t);e.e.x<=a?d>n&&d>0&&d--:e.e.x>h&&d<n&&d<t.parentNode.children.length-1&&d++,l=o[d],C(d)}r.dom.on("mouseup",window,(function e(t){if(this._oHeaderMenu&&this._oHeaderMenu.enable(this._bHeaderMenuPreviousState),0!==t.e.button)return;document.body.style.overflow=m,r.dom.off("mouseup",window,e,this),r.dom.off("mousemove",window,y,this),s.parentNode.removeChild(s);for(let e=0;e<this._oColumnNewLineCache.length;e++)this.oL._aColumnMapper[this._oColumnNewLineCache[e]].pbNewLine=!0;let o=t.getTarget();for(;o.hasAttribute&&!o.hasAttribute("data-dfcol")&&o!=this.oL._eElem;)o=o.parentNode;let n=o;if(o.hasAttribute&&o.hasAttribute("data-dfcol"))for(;n.hasAttribute&&!n.hasAttribute("data-dfobj")&&o!=this.oL._eElem;)n=n.parentNode;if(!o.hasAttribute||!o.hasAttribute("data-dfcol")||n!==this.oL._eElem)return void this.oL.redraw();const h=this.oL._aColumnMapper[a];this.oL._aColumnMapper.splice(a,1),this.oL._aColumnMapper.splice(l,0,h);let d=l<a?l:a;for(;d<this.oL._aColumnMapper.length;d++)this.oL._aColumnMapper[d].piPosition=d;this.oL.redraw(),this.oL.triggerLayoutChange(this.oL._aChildren[i])}),this),r.dom.on("mousemove",window,y,this)}resizeColumn(e,t){const i=this.oL,s=this.oR;let o,n=0,a=0,l=0;const h=r.gui.dragMask(i.topLayer()||document.body);h.style.cursor="e-resize";const d=s.calcPixelRatio();let p=e.getTarget().parentNode;for(;p.hasAttribute&&!p.hasAttribute("data-dfcol")&&p!=this.oL._eElem;)p=p.parentNode;const u=Array.prototype.indexOf.call(p.parentNode.children,p),c=e.getTarget().getBoundingClientRect();if(i.pbAutoColumnSizing)for(let e=u+1;e<s.aColWidths.length;e++)s.aColWidths[e].oCol.pbResizable&&(n=s.aColWidths[e].bFixed?s.aColWidths[e].iPixels:s.aColWidths[e].iPercent*d,l+=n-s.iColMin);else l=screen.width-c.left;const g=e.getMouseX();o=s.aColWidths[u].bFixed||!i.pbAutoColumnSizing?-s.aColWidths[u].iPixels+s.iColMin:-s.aColWidths[u].iPercent*d+s.iColMin;const _=c.left,m=r.dom.create('<div class="WebList_ColResizer"></div>');function b(e){const t=e.getMouseX();a=t-g,a<o&&(a=o),a>l&&(a=l);const i=_+a;m.style.left=i+"px"}function C(e){this._oHeaderMenu&&this._oHeaderMenu.enable(this._bHeaderMenuPreviousState),0===e.e.button&&(r.dom.off("mouseup",h,C,this),r.dom.off("mouseup",window,C,this),r.dom.off("mousemove",h,b,this),m.parentNode.removeChild(m),h.parentNode.removeChild(h),this.oR.recalcColumnSizes(u,a,!1),this.oL.triggerLayoutChange(this.oL._aChildren[t]))}this.eHead.appendChild(m),m.style.left=_+"px",m.style.top=c.top+"px",m.style.height=i._eElem.clientHeight+"px",r.dom.on("mouseup",h,C,this),r.dom.on("mouseup",window,C,this),r.dom.on("mousemove",h,b,this)}colCell(e){return this.colCellByIndex(e._iCol)}colCellByIndex(e){return r.dom.query(this.eHeadWrp,"th.WebList_ColHead[data-dfcol='"+e+"']")}onSettingChange(e){const t=this.oL;if("redraw"===e.sType)this.updateHeader();else if("sorting"===e.sType)this.updateHeader();else if("prop"===e.sType)switch(e.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateHeader();break;case"pbShowHeader":this.eHead&&(this.eHead.style.display=t.pbShowHeader?"":"none",t.sizeChanged());break;case"pbColumnsResizable":this.eHead&&r.dom.toggleClass(this.eHeadWrp,"WebList_ColResizable",t.pbColumnsResizable);break;case"pbAutoColumnSizing":r.dom.toggleClass(this.eHeadWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing),r.dom.toggleClass(this.eHeadWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing)}}onResize(e){this.eHead&&this.oL._oBody&&(this.eHead.style.paddingRight=this.oL._oBody.scrollbarWidth()+"px")}onHorizontalScroll(e){this.eHeadWrp&&(this.eHeadWrp.scrollLeft=e.nScrollX)}}class ue{constructor(e,t,i){this.oL=e,this.oC=i,this.oR=e._oRowRenderer,this.oM=t,e._onResize.on(this.onResize,this),e._onSettingChange.on(this.onSettingChange,this),e._onModulesCreated.on(this.onModulesCreated,this)}onModulesCreated(e){const t=this.oL._oBody;t instanceof ee&&t.onHorizontalScroll.on(this.onHorizontalScroll,this)}genHtml(e){const t=this.oL;e.push('<div class="WebList_Footer WebList_Body"',t.pbShowFooter?"":' style="display:none"',">"),e.push('<div class="WebList_FooterWrp WebList_BodyWrp',t.pbColumnsResizable?" WebList_ColResizable":"",t.pbAutoColumnSizing?" WebList_AutoSize":" WebList_HorizScroll",'">'),this.footerHtml(e),e.push("</div>"),e.push("</div>")}afterRender(e){this.eFooter=r.dom.query(e,"div.WebList_Footer"),this.eFooterWrp=r.dom.query(e,"div.WebList_FooterWrp")}footerHtml(e){const t={aCells:[],sCssClassName:"",sRowId:"_WebList_Footer",iGroupHeaderIndex:-1,fCellClass(e,t){const i=[];return i.push(e._sCellClass),i.push(r.CssDisabled),i.push(e.peFooterAlign===r.ciAlignLeft?"WebList_AlignLeft":e.peFooterAlign===r.ciAlignCenter?"WebList_AlignCenter":e.peFooterAlign===r.ciAlignRight?"WebList_AlignRight":""),e.peFooterDataType===r.ciTypeBCD?i.push("dfData_BCD"):e.peFooterDataType===r.ciTypeDate?i.push("dfData_Date"):i.push("dfData_Text"),e.psCSSClass&&i.push(e.psCSSClass),t&&t.sCssClassName&&i.push(t.sCssClassName),i.join(" ")},fCellHtml(e,t){let i=t.sValue;return 0===i.length?"&nbsp;":(i=r.sys.data.serverToType(i,this.peFooterDataType),i=r.sys.data.typeToDisplay(i,this.peFooterDataType,this.getWebApp(),this._bHasFocus,this.psFooterMask,this.piFooterPrecision),this.pbAllowHtml||(i=r.dom.encodeHtml(i)),""!==i?i:"&nbsp;")}};let i=this.oL._aColumns.concat(this.oL._aSwipeBtns);i.sort((function(e,t){const i=e._iColIndex,s=t._iColIndex;return i<s?-1:i>s?1:0}));for(let e=0;e<i.length;e++)t.aCells.push({sValue:i[e].psFooterValue||"",sTooltip:"",sCssClassName:"",aOptions:[]});this.oR.rowHtml(t,e,!0)}updateFooter(){const e=[];this.eFooterWrp&&(this.footerHtml(e),this.eFooterWrp.innerHTML=e.join(""))}offsetHeight(){if(this.eFooter)return this.eFooter.offsetHeight}onSettingChange(e){const t=this.oL;if("redraw"===e.sType)this.updateFooter();else if("sorting"===e.sType)this.updateFooter();else if("prop"===e.sType)switch(e.sProp){case"piSortColumn":case"pbReverseOrdering":this.updateFooter();break;case"pbShowFooter":this.eFooter&&(this.eFooter.style.display=t.pbShowFooter?"":"none",t.sizeChanged());break;case"pbColumnsResizable":this.eFooter&&r.dom.toggleClass(this.eFooterWrp,"WebList_ColResizable",t.pbColumnsResizable);break;case"pbAutoColumnSizing":r.dom.toggleClass(this.eFooterWrp,"WebList_AutoSize",this.oL.pbAutoColumnSizing),r.dom.toggleClass(this.eFooterWrp,"WebList_HorizScroll",!this.oL.pbAutoColumnSizing)}}onResize(e){this.eFooter&&this.oL._oBody&&(this.eFooter.style.paddingRight=this.oL._oBody.scrollbarWidth()+"px")}onHorizontalScroll(e){this.eFooterWrp&&(this.eFooterWrp.scrollLeft=e.nScrollX)}}class ce{constructor(e,t,i,s){this.oL=e,this.oV=t,this.oM=i,this.oC=s,this.iAutoScrollIncr=1,this.iSwipeStartOffset=0,this.iSwipeOffset=0,this.eSwipeRow=null,this.eSwipeRowStart=null,this.eSwipeLeftBtns=null,this.eSwipeRightBtns=null}afterRender(e){const t=this.oV;window.PointerEvent?r.dom.on("pointerdown",t.eBody,this.onPointerDown,this):r.dom.on("touchstart",t.eBody,this.onTouchStart,this),t.bScroll&&t.eBodyWrp.addEventListener&&this.oL.pbAutoColumnSizing&&t.eBodyWrp.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1})}onTouchStart(e){1===e.e.targetTouches.length&&this.touchScroll(!1,e)}onPointerDown(e){"pen"!==e.e.pointerType&&"touch"!==e.e.pointerType||this.touchScroll(!0,e)}touchScroll(e,t){const i=this,s=this.oV,o=325,n=!!s.bScroll;let a,l,h,d,p,u,c,g,_,m,b,C=0,f=0,w=Date.now(),S=0,y=!1,D=!1;s.iAutoScroll=_=this.iAutoScrollIncr++;const v=this.swipeStart(t.getTarget()),R=b=m=e?t.e.clientX:t.e.targetTouches[0].pageX,W=h=l=a=e?t.e.clientY:t.e.targetTouches[0].pageY;function I(t){var i;a=e?t.e.clientY:t.e.targetTouches[0].pageY,m=e?t.e.clientX:t.e.targetTouches[0].pageX,D&&y||!D&&Math.abs(R-m)>Math.abs(W-a)?(y=!0,this.swipeRow(t.getTarget(),R-m)):(y&&this.swipeRowCancel(),n&&((i=s.iScrollOffsetPx+(l-a))<0?i=.3*(g+(W-a)):i>u&&(i=u+.3*(g+(W-a)-u)),s.scrollTo(i,!1,!1,!0),t.stop())),l=a,b=m,(v||n)&&t.e.preventDefault()}function M(){let e,t;if(s.iAutoScroll===_&&f){if(e=Date.now()-w,s.iScrollOffsetPx<0||s.iScrollOffsetPx>u){if(!S){const t=Math.abs(-f*Math.exp(-e/o)/f);S=100*t,f=Math.max(-f/2e3,1)*(s.iScrollOffsetPx>u?c:-c)*t,p=s.iScrollOffsetPx+f,w=Date.now(),e=Date.now()-w}t=-f*Math.exp(-e/S)}else t=-f*Math.exp(-e/o);const n=p+t;t>.5||t<-.5?(s.scrollTo(n,!1,!1,!0),r.dom.animFrame(M,this)):(s.scrollTo(p,!1,!1,!0),p<0?H.call(i,-s.iScrollOffsetPx,n/-c*80):p>u&&H.call(i,u-s.iScrollOffsetPx,(n-u)/c*80))}}function T(t){e?(r.dom.off("pointerup",document,T,this),r.dom.off("pointercancel",document,T,this),r.dom.off("pointermove",document,I,this)):(r.dom.off("touchend",document,T,this),r.dom.off("touchcancel",document,T,this),r.dom.off("touchmove",document,I,this)),clearInterval(d),y&&this.swipeRowEnd(),n&&(s.iScrollOffsetPx<0?H.call(this,-s.iScrollOffsetPx,s.iScrollOffsetPx/-c*80):s.iScrollOffsetPx>u?H.call(this,u-s.iScrollOffsetPx,(s.iScrollOffsetPx-u)/c*80):y||(C>10||C<-10)&&(f=1.9*C,p=Math.round(s.iScrollOffsetPx+f),p>0&&p<u&&(p=s.snapToRow(p)),w=Date.now(),r.dom.animFrame(M,this))),(Math.abs(l-W)>15||Math.abs(b-R)>15)&&e&&(s.bCancelClick=!0,setTimeout((function(){s.bCancelClick=!1}),200))}function H(e,t){const i=this.oV;let s,o,n;0!==e&&(s=i.iScrollOffsetPx,o=Date.now(),n=o+t,function t(){var a,l,h,d,p;i.iAutoScroll===_&&(a=Math.min(Date.now(),n),h=a-o,d=s,p=n-o,l=-e/2*(Math.cos(Math.PI*h/p)-1)+d,i.scrollTo(l,!1,!1,!0),a<n&&(l>.5||l<.5)&&r.dom.animFrame(t,this))}())}n&&(g=s.iScrollOffsetPx,u=s.getMaxPX(),c=.1*s.iTableHeight),e?(r.dom.on("pointerup",document,T,this),r.dom.on("pointercancel",document,T,this),r.dom.on("pointermove",document,I,this)):(r.dom.on("touchend",document,T,this),r.dom.on("touchcancel",document,T,this),r.dom.on("touchmove",document,I,this)),d=setInterval((function(){const e=Date.now(),t=e-w;w=e;const i=h-a;h=a,C=.8*(500*i/(1+t))+.2*C}),50),setTimeout((function(){D=!0}),300)}showSwipeLeft(){const e=this.oV.currentRowElem();let t;if(e&&this.swipeStart(e)){if(this.eSwipeRow&&!this.eSwipeRowStart&&this.iSwipeOffset<0)return this.swipeRowClose(this.eSwipeRow),!0;if(this.eSwipeRowStart&&(this.eSwipeRow&&this.eSwipeRow!==this.eSwipeRowStart&&this.swipeRowClose(this.eSwipeRow),this.eSwipeRow=this.eSwipeRowStart,this.eSwipeRowStart=null),this.eSwipeLeftBtns||this.eSwipeRightBtns||this.initSwipeRow(),this.eSwipeLeftBtns)return t=this.iSwipeStartOffset<0?0:this.eSwipeLeftBtns.offsetWidth,this.swipeAniOffset(this.eSwipeRow,t),!0}return!1}showSwipeRight(){const e=this.oV.currentRowElem();let t;if(e&&this.swipeStart(e)){if(this.eSwipeRow&&!this.eSwipeRowStart&&this.iSwipeOffset>0)return this.swipeRowClose(this.eSwipeRow),!0;if(this.eSwipeRowStart&&(this.eSwipeRow&&this.eSwipeRow!==this.eSwipeRowStart&&this.swipeRowClose(this.eSwipeRow),this.eSwipeRow=this.eSwipeRowStart,this.eSwipeRowStart=null),this.eSwipeLeftBtns||this.eSwipeRightBtns||this.initSwipeRow(),this.eSwipeRightBtns)return t=this.iSwipeStartOffset>0?0:-this.eSwipeRightBtns.offsetWidth,this.swipeAniOffset(this.eSwipeRow,t),!0}return!1}swipeStart(e){const t=this.oL,i=this.oV,s=this.oM;let o=!1;for(;e&&e!==i.eBody;){if("TABLE"===e.tagName&&e.hasAttribute("data-dfisrow")){o=!0;break}e=e.parentNode}if(o){if(this.iSwipeStartOffset=0,this.eSwipeRow&&this.eSwipeRow===e)return this.iSwipeStartOffset=this.iSwipeOffset,!0;const i=s.rowIndexByRowId(e.getAttribute("data-dfrowid")),o=s.aData[i];for(let i=0;i<t._aSwipeBtns.length;i++){const s=t._aSwipeBtns[i],n=o.aCells[s._iColIndex];if(s.isVisible(n))return this.eSwipeRowStart=e,!0}this.eSwipeRowStart=null}return!1}initSwipeRow(){let e,t,i,s=!1,o=!1;const n=this.eSwipeRow,a=this.oM,l=this.oL;if(n){const h=a.rowIndexByRowId(n.getAttribute("data-dfrowid")),d=a.aData[h],p=['<table data-dfrowid="',d?d.sRowId:"empty",'" class="WebList_SwipeBtns WebList_SwipeBtnsLeft"><tr>'],u=['<table data-dfrowid="',d?d.sRowId:"empty",'" class="WebList_SwipeBtns WebList_SwipeBtnsRight"><tr>'];for(let e=0;e<l._aSwipeBtns.length;e++){const t=l._aSwipeBtns[e],r=d.aCells[t._iColIndex];t.isVisible(r)&&(t.pbPositionLeft?(i=p,o=!0):(i=u,s=!0),i.push('<td data-dfswbtn="',e,'" class="WebList_SwipeBtn ',t.psCSSClass," ",r.sCssClassName,'" style="'),t.piWidth>0&&i.push("width: ",t.piWidth,"px; "),i.push("height: ",n.offsetHeight,'px">',t.btnHtml(r),"</td>"))}p.push("</tr></table>"),u.push("</tr></table>"),o&&(this.eSwipeLeftBtns=e=r.dom.create(p.join("")),n.parentNode.insertBefore(e,n)),s&&(this.eSwipeRightBtns=t=r.dom.create(u.join("")),n.parentNode.insertBefore(t,n))}}swipeRow(e,t){let i,s=0,o=0;this.eSwipeRowStart&&(this.eSwipeRow&&this.swipeRowClose(this.eSwipeRow),this.eSwipeRow=this.eSwipeRowStart,this.eSwipeRowStart=null),this.eSwipeRow&&(this.eSwipeLeftBtns||this.eSwipeRightBtns||this.initSwipeRow(),this.eSwipeLeftBtns&&(o=this.eSwipeLeftBtns.offsetWidth),this.eSwipeRightBtns&&(s-=this.eSwipeRightBtns.offsetWidth),this.iSwipeOffset=i=Math.max(Math.min(this.iSwipeStartOffset-t,o),s),r.dom.translateX(this.eSwipeRow,i,!1))}swipeRowCancel(){this.eSwipeRow&&(this.swipeRowClose(this.eSwipeRow),this.eSwipeRow=null)}swipeRowClose(e){const t=this.eSwipeLeftBtns,i=this.eSwipeRightBtns;this.swipeAniOffset(e,0,(function(){t&&t.parentNode&&t.parentNode.removeChild(t),i&&i.parentNode&&i.parentNode.removeChild(i)})),this.eSwipeLeftBtns=null,this.eSwipeRightBtns=null}swipeRowEnd(){let e=this.iSwipeOffset;this.eSwipeRow&&(e=this.iSwipeOffset>this.iSwipeStartOffset?this.iSwipeOffset>0?this.eSwipeLeftBtns.offsetWidth:0:this.iSwipeOffset<0?0-this.eSwipeRightBtns.offsetWidth:0,0===e?(this.swipeRowClose(this.eSwipeRow),this.eSwipeRow=null):this.swipeAniOffset(this.eSwipeRow,e))}swipeAniOffset(e,t,i){r.dom.transition(e,"all 200ms",i,this),r.dom.translateX(e,t),this.iSwipeOffset=t}swipeBtnClick(e,t){const i=this.oL,s=this.oM,o=this.eSwipeRow;let n=t,a=null;for(;t&&t!==this.oV.eBody;){if("TABLE"===t.tagName&&t.hasAttribute("data-dfrowid")){a=t.getAttribute("data-dfrowid");break}t=t.parentNode}if(a){const t=s.rowIndexByRowId(a);t>=0&&(this.oC.selectRow("row",t),r.dom.addClass(n,"WebCon_Active"),i._aSwipeBtns[n.getAttribute("data-dfswbtn")].btnClick(e,s.aData[t].sRowId,(function(e){r.dom.removeClass(n,"WebCon_Active"),this.swipeRowClose(o),i.focus()}),this))}}}class ge{constructor(e,t){this.oL=e,this.oM=t,this.eElem=null,t.onDataUpdate.on(this.onDataUpdate,this),e._onSettingChange.on(this.onSettingChange,this)}genHtml(e){const t=this.oL;e.push('<div class="WebList_PlaceHolder"',t.psPlaceHolder&&0===this.oM.aData.length?"":' style="display: none"',">",r.dom.encodeHtml(t.psPlaceHolder),"</div>")}afterRender(e){this.eElem=r.dom.query(e,"div.WebList_PlaceHolder")}onDataUpdate(e){this.oL.psPlaceHolder&&this.eElem&&(this.eElem.style.display=0===this.oM.aData.length?"":"none")}onSettingChange(e){const t=this.oL;this.eElem&&"prop"===e.sType&&"psPlaceHolder"===e.sProp&&(t.psPlaceHolder?r.dom.setText(this.eElem,t.psPlaceHolder):this.eElem.style.display="none")}}r.cHideColumnCSS=' style="visibility:hidden"';class _e extends b{constructor(e,t){super(e,t),this.prop(r.tString,"psCurrentRowId",""),this.prop(r.tInt,"piCurrentRowIndex",-1),this.prop(r.tInt,"piRowCount",0),this.prop(r.tBool,"pbShowHeader",!0),this.prop(r.tBool,"pbShowFooter",!1),this.prop(r.tBool,"pbShowSelected",!0),this.prop(r.tBool,"pbDataAware",!0),this.prop(r.tInt,"peDbGridType",r.gtAutomatic),this.prop(r.tInt,"peGrouping",r.grpDisabled),this.prop(r.tBool,"pbOfflineEditing",!1),this.prop(r.tBool,"pbAutoSearch",!0),this.prop(r.tBool,"pbColumnSortable",!0),this.prop(r.tBool,"pbReverseOrdering",!0),this.prop(r.tInt,"piSortColumn",0),this.prop(r.tInt,"piMinHeight",0),this.prop(r.tInt,"piHeight",0),this.prop(r.tBool,"pbColumnsResizable",!0),this.prop(r.tBool,"pbAutoColumnSizing",!0),this.prop(r.tBool,"pbAllowColumnReordering",!0),this.prop(r.tBool,"pbAllowColumnHiding",!0),this.prop(r.tBool,"pbStoreColumnLayout",!0),this.prop(r.tBool,"pbStoreGroupConfig",!0),this.prop(r.tString,"psPlaceHolder",""),this.prop(r.tString,"psKeyBuddy",""),this.prop(r.tBool,"pbScroll",!0),this.prop(r.tBool,"pbGroupsCollapsible",!0),this.prop(r.tBool,"pbGroupsCollapseByDefault",!0),this.event("OnRowClick",r.cCallModeWait),this._aColumns=[],this._aSwipeBtns=[],this._oRowRenderer=null,this._oModel=null,this._oHeader=null,this._oBody=null,this._oFooter=null,this._oTouchHandler=null,this._oGrouping=null,this._iColCount=0,this._tRedraw=null,this._bLozingFocus=!1,this._bScrollQueued=!1,this._onSettingChange=new r.events.JSHandler,this._onResize=new r.events.JSHandler,this._onModulesCreated=new r.events.JSHandler,this._onKeyDown=new r.events.JSHandler,this.addSync("piCurrentRowIndex"),this.addSync("psCurrentRowId"),this.addSync("piRowCount"),this.setActionMode("HandleProcessDataSet",r.cCallModeWait),this.setActionMode("ChangeCurrentRow",r.cCallModeWait),this.event("OnColumnLayoutChanged",r.cCallModeDefault),this.event("OnGroupConfigChanged",r.cCallModeDefault),this._sControlClass="WebList"}addChild(e){e._bIsColumn&&(e._iColIndex=this._iColCount++,e._iCol=this._aColumns.length,this._aColumns.push(e)),e._bIsSwipeButton&&(e._iColIndex=this._iColCount++,this._aSwipeBtns.push(e)),super.addChild(e)}create(){this.recordColumnMapperDefaults(),this.loadLayout(!0,!1),this.rebuildColumnMapper(!1),this._oModel=this.createModel(),this._oController=this.createController(),this._oRowRenderer=this.createRowModel(),this._oHeader=this.createHeaderView(),this._oBody=this.createView(),this._oFooter=this.createFooterView(),this._oTouchHandler=this.createTouchHandler(),this._oPlaceHolder=this.createPlaceHolder(),this._oGrouping=this.createGrouping(),this._oRowRenderer.init(),this._onModulesCreated.fire(this)}createGrouping(){return new oe(this,this._oModel,this._oController)}applyGroupConfig(e){this._oGrouping?.applyGroupConfig(r.toBool(e),this._tActionData)}clearGroupConfig(){this._oGrouping?.clearGrouping()}getStorageName(e){return e&&e.length>0?window.location.host+"."+window.location.pathname+"."+this.getLongName()+"@"+e:window.location.host+"."+window.location.pathname+"."+this.getLongName()}serializeLayout(){const e=[];for(let t=0;t<this._aColumns.length;t++){let i={};i.sObjName=this._aColumns[t].getLongName(),i.bFixed=this._aColumns[t].pbFixedWidth,i.iWidth=this._aColumns[t].piWidth,i.iPosition=this._aColumns[t].piPosition,i.bHidden=this._aColumns[t].pbHidden,e.push(i)}return e}loadLayout(e,t){"boolean"!=typeof t&&(t=!0);let i=null;if(this.pbStoreColumnLayout&&!r.pbDebugging){const s=localStorage.getItem(this.getStorageName("layout"));if(s)try{if(i=JSON.parse(s),i.length!==this._aColumns.length)return null;for(let e=0;e<i.length;e++)if(i[e].sObjName!==this._aColumns[e].getLongName())return null}catch(e){return s&&localStorage.removeItem(this.getStorageName("layout")),null}i&&e&&this.restoreColumnMapper(t,i)}return i}saveLayout(e){if(this.pbStoreColumnLayout&&!r.pbDebugging)try{localStorage.setItem(this.getStorageName("layout"),JSON.stringify(e))}catch(e){}}triggerLayoutChange(e){const t=this.serializeLayout();this.saveLayout(t),this.fireEx({sEvent:"OnColumnLayoutChanged",tActionData:t,sAltServerName:"privateOnColumnLayoutChanged"})}recordColumnMapperDefaults(){this._defaultLayout=this.serializeLayout()}restoreColumnMapperDefaults(){this.restoreColumnMapper(!0,this._defaultLayout)}restoreColumnMapper(e,t){if("boolean"!=typeof e&&(e=!0),Array.isArray(this._tActionData)&&!Array.isArray(t)&&(t=this._tActionData),!Array.isArray(t))return;const i=[];for(let e=0;e<this._aColumns.length;e++)i[this._aColumns[e].getLongName()]=this._aColumns[e];try{for(let e=0;e<t.length;e++){const s=i[t[e].sObjName];s&&(s.pbFixedWidth=t[e].bFixed,s.piWidth=t[e].iWidth,s.piPosition=t[e].iPosition,s.pbHidden=t[e].bHidden)}t=this.serializeLayout(),this.saveLayout(t),this.rebuildColumnMapper(!1),e&&this.redraw()}catch(e){}}rebuildColumnMapper(e){"boolean"!=typeof e&&(e=!0),this._aColumnMapper=[];const t=[];for(let e=0;e<this._aColumns.length;e++)-1!==this._aColumns[e].piPosition?this._aColumnMapper.push(this._aColumns[e]):t.push(this._aColumns[e]);this._aColumnMapper.sort((function(e,t){const i=e.piPosition,s=t.piPosition;return i<s?-1:i>s?1:0}));let i=0;if(this._aColumnMapper.length>0)do{this._aColumnMapper[i].piPosition!==i&&(t.length>0&&(this._aColumnMapper.splice(i,0,t[0]),t.splice(0,1)),this._aColumnMapper[i].piPosition=i)}while(++i<this._aColumnMapper.length);if(this._aColumnMapper=this._aColumnMapper.concat(t),t.length>0)do{this._aColumnMapper[i].piPosition=i}while(++i<this._aColumnMapper.length);e&&this.redraw()}triggerRebuildHeaderMenu(){return this._oHeader.refreshColumnList()}triggerRestoreColumnLayout(e){this.restoreColumnMapperDefaults(!0),this.triggerLayoutChange(e)}createView(){return this.pbScroll?new ee(this,this._oModel,this._oController):new Q(this,this._oModel,this._oController)}createController(){return new ie(this,this._oModel)}createModel(){return this.peDbGridType!==r.gtAllData&&this.peDbGridType!==r.gtManual&&this.pbDataAware&&this.pbScroll?new te(this):new $(this)}createRowModel(){return new ne(this,this._oModel)}createHeaderView(){return new pe(this,this._oModel,this._oController)}createFooterView(){return new ue(this,this._oModel,this._oController)}createPlaceHolder(){return new ge(this,this._oModel)}createTouchHandler(){return new ce(this,this._oBody,this._oModel,this._oController)}focusHtml(e){e.push('<div class="WebList_Focus" tabindex="',this.isEnabled()?"0":"-1",'">')}openHtml(e,t){super.openHtml(e),this.focusHtml(e),this._oHeader?.genHtml(e),this._oBody?.genHtml(e),this._oFooter?.genHtml(e),this._oPlaceHolder?.genHtml(e)}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){if(this._eControl=this._eFocus=r.dom.query(this._eElem,"div.WebList_Focus"),this._oHeader?.afterRender(this._eElem),this._oBody?.afterRender(this._eElem),this._oFooter?.afterRender(this._eElem),this._oPlaceHolder?.afterRender(this._eElem),this._oTouchHandler?.afterRender(this._eElem),super.afterRender(),this.updateEnabled(),this._eFocus&&(r.dom.on("keydown",this._eFocus,this.onKeyDown,this),r.dom.on("keypress",this._eFocus,this.onKeyPress,this),r.dom.on("click",this._eElem,this.onListClick,this)),this._bRenderChildren=!0,this.psKeyBuddy){const e=this.getWebApp().findObj(this.psKeyBuddy);e&&(e instanceof b&&(this._eKeyBuddy=e._eControl),this._eKeyBuddy||(this._eKeyBuddy=e._eElem),r.events.addDomListener("keydown",this._eKeyBuddy,this.onKeyDown,this))}this.dragDropInit()}afterRenderChildren(){}setHeight(e,t){this._eControl&&(e>0?(e=(e-=this.getVertHeightDiff())<0?0:e,this._oBody.setHeight(e)):this._oBody.setHeight(0))}getVertHeightDiff(){let e=super.getVertHeightDiff();return this._oHeader&&(e+=this._oHeader.offsetHeight()),this._oFooter&&(e+=this._oFooter.offsetHeight()),e}resize(){this._onResize.fire(this),super.resize()}onKeyPress(e){if(this.isEnabled())return this._oController.keyPress(e)}onKeyDown(e){if(this.isEnabled())return this._onKeyDown.fire(this,{oDOMEvent:e})}applyEnabled(e){this._eFocus&&r.dom.setTabIndex(this._eFocus,e?0:-1),super.applyEnabled(e)}gridRefresh(e,t){const i=this._tActionData;this.cancelServerAction("ChangeCurrentRow"),this.cancelServerAction("OnRowClick"),this._oController.handleData(i,"page","",r.toBool(e),r.toBool(t))}handleDataPage(e,t,i,s){const o=this._tActionData;this._oController.handleData(o,e,t,r.toBool(i),r.toBool(s))}handleRowChange(e){this._oController.handleRowChange(e)}updateRow(e,t){const i=this.deserializeRows(this._tActionData);i.length>0&&this._oController.updateRow(e,i[0],r.toBool(t))}dataSetAppendRow(){const e=this.deserializeRows(this._tActionData);e.length>0&&this._oController.appendRow(e[0])}dataSetInsertRowBefore(e){const t=this.deserializeRows(this._tActionData);t.length>0&&this._oController.insertBefore(e,t[0])}dataSetInsertRowAfter(e){const t=this.deserializeRows(this._tActionData);t.length>0&&this._oController.insertAfter(e,t[0])}dataSetRemoveRow(e){this._oController.removeRow(e)}dataSetUpdateRow(e){const t=this.deserializeRows(this._tActionData);t.length>0&&this._oController.updateRow(t[0].sRowId,t[0])}removeRow(e){this._oController.removeRow(e)}processDataSet(e){this._oController.processDataSet(e)}moveToFirstRow(){this._oController.moveToFirstRow()}moveToLastRow(){this._oController.moveToLastRow()}moveDownRow(){this._oController.moveDownRow()}moveUpRow(){this._oController.moveUpRow()}movePageDown(){this._oController.movePageDown()}movePageUp(){this._oController.movePageUp()}moveToRow(e){this._oController.moveToRow(e)}moveToRowByID(e){this._oController.moveToRowByID(e)}scrollToCol(e){this.pbScroll&&this._oBody&&this._oBody.scrollToCol(e)}search(e){this._oController.search(e)}showSearch(e){this._oController.showSearch(e)}expandAllGroups(){this._oGrouping?.expandAll()}collapseAllGroups(){this._oGrouping?.collapseAll()}set_psCurrentRowId(e){this._oController&&this._oController.setCurrentRowId(e)}set_pbAllowColumnReordering(e){this.pbAllowColumnReordering!==e&&this._oHeader.setColumnReordering(this.pbAllowColumnReordering=e)}set_pbAllowColumnHiding(e){this.pbAllowColumnHiding!==e&&this._oHeader.setColumnHiding(this.pbAllowColumnHiding=e)}get_psCurrentRowId(){return this.currentRowId()}get_piRowCount(){return this._oModel&&this._oModel.aData.length||0}get_piCurrentRowIndex(){return this._oModel&&this._oModel.iCurrentRow}set_piSortColumn(e){this.propertyUpdate("piSortColumn",e)}set_pbReverseOrdering(e){this.propertyUpdate("pbReverseOrdering",e)}set_psPlaceHolder(e){this.propertyUpdate("psPlaceHolder",e)}set_pbShowHeader(e){this.propertyUpdate("pbShowHeader",e)}set_pbShowFooter(e){this.propertyUpdate("pbShowFooter",e)}set_pbShowSelected(e){this.propertyUpdate("pbShowSelected",e)}set_pbColumnsResizable(e){this.propertyUpdate("pbColumnsResizable",e)}set_pbAutoColumnSizing(e){this.propertyUpdate("pbAutoColumnSizing",e),this.redraw()}set_pbGroupsCollapsible(e){this.propertyUpdate("pbGroupsCollapsible",e)}set_pbGroupsCollapseByDefault(e){this.propertyUpdate("pbGroupsCollapseByDefault",e)}propertyUpdate(e,t){if(this[e]!==t){const i=this[e];this[e]=t,this._onSettingChange.fire(this,{sType:"prop",sProp:e,newval:t,prevval:i})}}updateCurrentCell(e,t){this._oController.updateCell(e,t)}redraw(){const e=this;this._tRedraw&&clearTimeout(this._tRedraw),this._tRedraw=setTimeout((function(){e._onSettingChange.fire(e,{sType:"prepare-redraw"}),e._onSettingChange.fire(e,{sType:"redraw"}),e._tRedraw=null}),10)}destroy(){super.destroy(),this._tRedraw&&clearTimeout(this._tRedraw)}insertChild(e,t){e._bIsColumn&&(e._iColIndex=this._iColCount++,e._iCol=this._aColumns.length,this._aColumns.splice(t,0,e)),e._bIsSwipeButton&&(e._iColIndex=this._iColCount++,this._aSwipeBtns.splice(t,0,e)),super.insertChild(e,t)}renderChild(e,t){this.redraw(),super.renderChild(e,t)}removeChild(e){const t=this._aChildren.indexOf(e);e._bIsColumn&&(e._iColIndex=this._iColCount--,e._iCol=this._aColumns.length,this._aColumns.splice(t,1)),e._bIsSwipeButton&&(e._iColIndex=this._iColCount--,this._aSwipeBtns.splice(t,1)),super.removeChild(e)}unrenderChild(e){this.redraw(),super.unrenderChild(e)}getColCell(e){return this._oBody.colCell(e)}getColHead(e){return this._oHeader.colCell(e)}getCell(e,t){const i=this._oModel.rowIdByRowIndex(e);return this._oBody.cell(i,t)}currentRowId(){return this._oModel&&this._oModel.sCurrentRowId||""}focus(){return!!(this._bFocusAble&&this.isEnabled()&&this._eFocus)&&(this._eFocus.focus(),this.objFocus(),!0)}onListClick(e){this.focus()}onFocus(e){this._bHasFocus||super.onFocus(e),this._bLozingFocus=!1}onBlur(e){const t=this,i=super.onBlur;this._bLozingFocus=!0,setTimeout((function(){t._bLozingFocus&&(i.call(t,e),t._bLozingFocus=!1)}),20)}hasFocus(){if(this._bHasFocus){if(this._bLozingFocus){let e=this.getWebApp()._oCurrentObj;for(;e!=this&&e._oParent;)e=e._oParent;return e==this}return!0}return!1}bindHandlerForWebUIContext(e,t){if(t===r.WebUIContext.WebUIContextListHead)this._oHeader?.registerHeaderMenu(e);return!0}unbindHandlerForWebUIContext(e,t){if(t===r.WebUIContext.WebUIContextListHead)this._oHeader?.unregisterHeaderMenu(e);return!0}determineSelectorForWebUIContext(e){switch(e){case r.WebUIContext.WebUIContextListHead:return".WebList_ColHead";case r.WebUIContext.WebUIContextListRow:return"table[data-dfrowid]";case r.WebUIContext.WebUIContextListFull:return""}return null}retrieveValueFromWebUIContext(e,t){switch(t){case r.WebUIContext.WebUIContextListHead:{let t=r.dom.query(e,".WebList_ColCap");return t?t.innerHTML:""}case r.WebUIContext.WebUIContextListRow:if(!e.hasAttribute("data-dfrowid"))break;return e.getAttribute("data-dfrowid");case r.WebUIContext.WebUIContextListFull:{let t=e;for(;t&&t.hasAttribute&&!t.hasAttribute("data-dfrowid")&&t!=this._eElem;)t=t.parentNode;return t?.hasAttribute("data-dfrowid")?t.getAttribute("data-dfrowid"):""}}return null}getDragData(e,t){try{const e=t.closest("table")?.getAttribute("data-dfrowid")||-1;let i;return e&&"empty"!=e&&-1!=e&&(""!=e||e>=0)?(i={...this._oModel.aData[this._oModel.rowIndexByRowId(e)]},Object.keys(i).forEach((function(e){0==e.indexOf("_")&&delete i[e]})),[{data:i},r.dragActions.WebList.ciDragRow]):[null,null]}catch(e){return console.error("Attempt to perform unsupported drag action"),[null,null]}}getDropData(e,t){const i=e._eDropElem&&e._eDropElem.getAttribute("data-dfrowid")||-1;let s;i&&-1!=i&&(""!=i||i>=0)&&(s={...this._oModel.aData[this._oModel.rowIndexByRowId(i)]},Object.keys(s).forEach((function(e){0==e.indexOf("_")&&delete s[e]})));return{data:s,action:r.dropActions.WebList.ciDropOnRow}}initDropZones(){if(this._aDropZones=[],super.initDropZones(),this.isSupportedDropAction(r.dropActions.WebList.ciDropOnRow)){const e=r.dom.query(this._eElem,".WebList_BodyWrp");this.addDropZone(e)}}determineDropCandidate(e,t){if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebControl.ciDropOnControl))))return[this._eElem,r.dropActions.WebControl.ciDropOnControl];if(!t.find((e=>e.supportsDropAction(this,r.dropActions.WebList.ciDropOnRow))))return[null,null];let i=document.elementFromPoint(e.e.clientX,e.e.clientY)?.closest("[data-dfrowid]");if(i){const e=i.getAttribute("data-dfrowid");if("empty_placeholder"==e)return[i.previousElementSibling||i.nextElementSibling||i,r.dropActions.WebList.ciDropOnRow];if("empty"!=e)return[i,r.dropActions.WebList.ciDropOnRow];for(;i;){const e=i.getAttribute("data-dfrowid");if("empty"!=e&&"empty_placeholder"!=e)return[i,r.dropActions.WebList.ciDropOnRow];i=i.previousElementSibling}}return[null,null]}determineDropPosition(e,t){const i=r.sys.gui.getBoundRect(t),s=i.bottom-i.height/2;return e.e.clientY>=s?r.dropPositions.ciDropAfter:r.dropPositions.ciDropBefore}onControlDragOver(e,t,i){if(!this._bScrollQueued){let i=10,s=100;const o=r.sys.gui.getBoundRect(t._eZone),n=o.bottom-50;if(e.e.clientY<=o.bottom&&e.e.clientY>n){o.bottom-e.e.y<.5*n&&(s=20),this._bScrollQueued=!0,setTimeout((()=>{this.dragScroll(i)}),s)}const a=o.top+50;if(e.e.clientY>=o.top&&e.e.clientY<a){i=-i;e.e.y-o.top<.5*a&&(s=20),this._bScrollQueued=!0,setTimeout((()=>{this.dragScroll(i)}),s)}}}dragScroll(e){this._oBody?.scroll(e,!1),this._bScrollQueued=!1}interactWithDropElem(e,t){if(e._eDropAction==r.dropActions.WebControl.ciDropOnControl)e.highlightElement();else{const i=document.createElement("table");r.dom.addClass(i,"WebList_Row WebList_DropPlaceHolder"),i.setAttribute("data-dfrowid","empty_placeholder");const s=this.getPlaceholderRowHeight();s&&s>0&&(i.style.height=String(s)+"px"),e.insertElement(i,t)}}doEmptyInteraction(e){if(this.isSupportedDropAction(r.dropActions.WebList.ciDropOnRow)){const t=document.createElement("table");r.dom.addClass(t,"WebList_Row WebList_DropPlaceHolder");const i=this.getPlaceholderRowHeight();i&&i>0&&(t.style.height=String(i)+"px");const s=r.dom.query(this._eElem,".WebList_Body table");return e.insertElement(t,s,r.dropPositions.ciDropBefore),r.dropActions.WebList.ciDropOnRow}return this.isSupportedDropAction(r.dropActions.WebControl.ciDropOnControl)?(e.highlightElement(),r.dropActions.WebControl.ciDropOnControl):null}hasData(){return this._oModel.aData&&this._oModel.aData.length>0}getPlaceholderRowHeight(){const e=this._oBody.iAvgRowHeight,t=r.dom.clientHeight(r.dom.query(this._eElem,".WebList_Body table"));return(e>0?e:t)||0}deserializeRows(e){return e}serializeRows(e){return e}}r.wleManual=0,r.wleOpenOnRowChange=1,r.wleOpenOnRowClick=2,r.wleOpenOnRowClickCloseOnChange=3,r.wleOpenOnRowDoubleClick=4,r.wleOpenOnRowDoubleClickCloseOnChange=5;const me=e=>class extends e{constructor(e,t){if(super(e,t),!(t&&t instanceof _e))throw new r.Error(999,"WebColumn object '{{0}}' should be placed inside a WebList object. Consider wrapping your column with a list or grid object.",this,[this.getLongName()]);this.prop(r.tBool,"pbGroupable",!0),this.prop(r.tBool,"pbSortable",!1),this.prop(r.tBool,"pbValueAsTooltip",!0),this.prop(r.tBool,"pbAllowHtml",!1),this.prop(r.tInt,"piWidth",0),this.prop(r.tString,"psCaption",""),this.prop(r.tBool,"pbNewLine",!1),this.prop(r.tInt,"piListColSpan",1),this.prop(r.tInt,"piListRowSpan",1),this.prop(r.tBool,"pbFixedWidth",!1),this.prop(r.tBool,"pbResizable",!0),this.prop(r.tBool,"pbHidden",!1),this.prop(r.tBool,"pbShowCaption",!0),this.prop(r.tInt,"piPosition",-1),this.prop(r.tBool,"pbHideable",!0),this.prop(r.tInt,"peFooterDataType",r.ciTypeText),this.prop(r.tInt,"peFooterAlign",-1),this.prop(r.tInt,"piFooterPrecision",0),this.prop(r.tString,"psFooterMask",""),this.prop(r.tString,"psFooterValue",""),this.addSync("pbHidden"),this.addSync("piPosition"),this.prop(r.tBool,"pbEditable",!0),this.event("OnHeaderClick",r.cCallModeDefault),this._sCellClass="WebCol",this._bCellEdit=!0,this._iColIndex=0,this._iCol=0,this._bIsColumn=!0}set_psFooterValue(e){this.psFooterValue!==e&&(this.psFooterValue=e,this._oParent._oFooter.updateFooter())}set_psFooterMask(e){this.psFooterMask!==e&&(this.psFooterMask=e,this._oParent._oFooter.updateFooter())}set_piFooterPrecision(e){this.piFooterPrecision!==e&&(this.piFooterPrecision=e,this._oParent._oFooter.updateFooter())}set_peFooterAlign(e){this.peFooterAlign!==e&&(this.peFooterAlign=e,this._oParent._oFooter.updateFooter())}set_peFooterDataType(e){this.peFooterDataType!==e&&(this.peFooterDataType=e,this._oParent._oFooter.updateFooter())}set_psValue(e){super.set_psValue(e),this._oParent instanceof We&&this._oParent.updateCurrentCell(this,e)}set_pbRender(e,t){"boolean"!=typeof t&&(t=!0);const i=this.pbRender!==e;super.set_pbRender(e),i&&(this.pbRender=e,this._oParent.rebuildColumnMapper(t))}set_pbShowCaption(e){this.pbShowCaption!==e&&(this.pbShowCaption=e,this._oParent._oHeader.updateHeader())}set_pbHidden(e,t){"boolean"!=typeof t&&(t=!0),this.pbHidden!==e&&(this.pbHidden=e,this._oParent.rebuildColumnMapper(t))}set_piPosition(e,t){"boolean"!=typeof t&&(t=!0),this.piPosition!==e&&(this.piPosition=e,this._oParent.rebuildColumnMapper(t))}set_pbHideable(e){this.pbHideable!==e&&(this.pbHideable=e,this._oParent.triggerRebuildHeaderMenu())}set_pbEditable(e){this.pbEditable!==e&&(this.pbEditable=e,this._oParent.redraw())}set_pbAllowHtml(e){this.pbAllowHtml!==e&&(this.pbAllowHtml=e,this._oParent.redraw())}set_piWidth(e){this.piWidth!==e&&(this.piWidth=e,this._oParent.redraw())}set_pbFixedWidth(e){this.pbFixedWidth!==e&&(this.pbFixedWidth=e,this._oParent.redraw())}set_pbNewLine(e){this.pbNewLine!==e&&(this.pbNewLine=e,this._oParent.redraw(),this._oParent.sizeChanged(!0))}set_psCaption(e){this.psCaption!==e&&(this.psCaption=e,this._oParent.redraw())}set_psCSSClass(e){const t=this.psCSSClass!==e;super.set_psCSSClass(e),t&&(this.psCSSClass=e,this._oParent.redraw())}set_piListColSpan(e){this.piListColSpan!==e&&(this.piListColSpan=e,this._oParent.redraw())}set_piListRowSpan(e){this.piListRowSpan!==e&&(this.piListRowSpan=e,this._oParent.redraw())}set_pbVisible(e){this.set_pbVisible!==e&&(super.set_pbVisible(e),this.pbVisible=e,this._oParent.redraw())}applyEnabled(e){super.applyEnabled(e),this._oParent.redraw()}onKey(e){this._oParent.onKeyDown(e)?super.onKey(e):e.e.cancelBubble=!0}headerCSS(){return null}headerHtml(){return this.psCaption&&this.pbShowCaption?this.psCaption:"&nbsp;"}cellHtml(e,t){let i;const s=r.sys.data.serverToType(t.sValue,this.peDataType);return i=this.typeToDisplay(s),this.pbAllowHtml||(i=r.dom.encodeHtml(i)),""!==i?i:"&nbsp;"}tooltipValue(e){const t=r.sys.data.serverToType(e.sValue,this.peDataType);return this.typeToDisplay(t)}cellClickBefore(e,t,i){return!1}cellClickAfter(e,t,i){return!1}cellEdit(){}cellUnEdit(){}getTooltipElem(){let e=this._oParent.getColCell(this);return e||(e=this._oParent.getColHead(this)),e}getErrorElem(){return this.getTooltipElem()}selectAndFocus(){this._oParent instanceof We&&this._oParent.selectCol(this._iCol),this.focus()}};class be extends(me(N)){}class Ce extends be{constructor(e,t){super(e,t),this.prop(r.tInt,"peWordBreak",r.wbNone)}create(){this._sCellClass="WebCol "+r.classWordBreak(this.peWordBreak)}cellHtml(e,t){return this.pbPassword?t.sValue.replace(/./g,"&bull;"):super.cellHtml(e,t)}tooltipValue(e){return this.pbPassword?e.sValue.replace(/./g,"&bull;"):super.tooltipValue(e)}set_peWordBreak(e){this.peWordBreak!==e&&(this._sCellClass="WebCol "+r.classWordBreak(e),this._oParent.redraw())}}const fe=e=>class extends e{define_WebGridView_mixin(e,t,i){this.eEditCell=null,this.oEditCol=null,this.sEditRowId=null,this.bCellEdit=!1,this.bStopFocus=!1,t.onColChange.on(this.onColChange,this),t.onBeforeRowChange.on(this.onBeforeRowChange,this),t.onAfterRowChange.on(this.onAfterRowChange,this)}afterRender(e){super.afterRender(e),this.editCell()}refreshDisplay(){this.eBody&&(this.unEditCell(!1),super.refreshDisplay(),this.editCell())}refreshRow(e,t){let i=e===this.sEditRowId;this.eBody&&(i&&(this.unEditCell(!1),i=!0),super.refreshRow(e,t),i&&this.editCell())}refreshCell(e,t){this.oEditCol===t&&this.sEditRowId===e||super.refreshCell(e,t)}insertRow(e,t){super.insertRow(e,t),this.oM.rowIdByRowIndex(e)===this.oM.sCurrentRowId&&this.editCell()}removeTopRow(){this.eEditCell&&this.oM.iCurrentRow===this.iRowDispOffset&&(this.unEditCell(!1),this.oL._eFocus.focus()),super.removeTopRow.call(this)}removeBottomRow(){this.eEditCell&&this.iRowDispLast===this.oM.iCurrentRow&&(this.unEditCell(!1),this.oL._eFocus.focus()),super.removeBottomRow.call(this)}editCell(){const e=this.oL,t=this.oM,i=t.iCurrentColumn,s=t.iCurrentRow;let o;if((!this.bScroll||s>=this.iRowDispOffset&&s<=this.iRowDispLast)&&i>=0){const s=e._aColumns[i];if(!s||!s.pbEditable)return;this.bCellEdit=o=s._bCellEdit;const n=s._eElem;s._bIgnoreOnChange=!0;const a=this.cell(t.sCurrentRowId,i);if(a){if(a!==this.eEditCell&&(o&&(a.innerHTML="",a.appendChild(n)),r.dom.addClass(a,"WebGrid_EditCell")),s.cellEdit(),e.hasFocus())if(s.isEnabled())if(o)s.focus(!0),(r.sys.isIE||r.sys.isEdge&&r.sys.iVersion<13)&&setTimeout((function(){r.sys.isEdge?s.focus(!0):s instanceof Ce&&s._eControl.select()}),10);else{const t=r.dom.getFirstFocusChild(a);t?t.focus():e._eFocus.focus()}else e._eFocus.focus();this.eEditCell=a,this.oEditCol=s,this.sEditRowId=t.sCurrentRowId}s._bIgnoreOnChange=!1}}unEditCell(e){const t=this.oR,i=this.oM;if(this.oEditCol){const s=this.oEditCol,o=s._bCellEdit,n=i.rowIndexByRowId(this.sEditRowId);e&&o&&n>=0&&s.get("pbChanged")&&(i.aData[n].aCells[s._iColIndex].sValue=s.get_psValue()),s._eControl&&s._eControl.blur&&s._eControl.blur(),o&&s._eElem.parentNode&&s._eElem.parentNode.removeChild(s._eElem),n>=0&&(this.eEditCell.innerHTML=t.cellHtml(s,i.aData[n],i.aData[n].aCells[s._iColIndex])),r.dom.removeClass(this.eEditCell,"WebGrid_EditCell"),this.eEditCell=null,this.oEditCol=null,this.iEditRowId=null}}focus(){const e=this.oM;if(!this.bStopFocus&&(!this.bScroll||e.iCurrentRow>=this.iRowDispOffset&&e.iCurrentRow<=this.iRowDispLast)&&this.oEditCol)if(this.oEditCol._bCellEdit){if(this.oEditCol.focus(!0))return!0}else{const e=r.dom.getFirstFocusChild(this.eEditCell);if(e)return e.focus(),!0}return!1}onColChange(e){e.bRowChange||(this.unEditCell(!0),this.editCell())}onRowChange(e){this.unEditCell(!this.oL.pbDataAware),super.onRowChange(e),this.editCell()}onBeforeRowChange(e){this.bStopFocus=!0}onAfterRowChange(e){this.bStopFocus=!1,this.oL.hasFocus()&&this.focus()}};class we extends(fe(Q)){constructor(e,t,i){super(e,t,i),this.define_WebGridView_mixin(e,t,i)}}class Se extends(fe(ee)){constructor(e,t,i){super(e,t,i),this.define_WebGridView_mixin(e,t,i)}}const ye=e=>class extends e{define_WebGridModel_mixin(e){this.iCurrentColumn=e.piCurrentColumn,this.onColChange=new r.events.JSHandler}appendRow(e){this.aData.length>0&&""===this.aData[this.aData.length-1].sRowId?(this.aData.splice(this.aData.length-1,0,e),this.iCurrentRow++):this.aData.push(e),this.sortData()&&(this.iCurrentRow=this.rowIndexByRowId(this.sCurrentRowId)),this.prepDisplay(),this.onDataUpdate.fire(this,{sType:"newrow",sRowId:e.sRowId})}};class De extends(ye($)){constructor(e){super(e),this.define_WebGridModel_mixin(e)}}class ve extends(ye(te)){constructor(e){super(e),this.define_WebGridModel_mixin(e)}}class Re extends ie{constructor(e,t){super(e,t),this.iChangeToCol=null,this.bNewRow=!1,this.tNewRow=null,this.iNewCount=0}selectRow(e,t,i,s){const o=this.oL,n=this.oL._oBody||{};if(o.pbDataAware||this.updateCacheFromColumns(),n.oEditCol&&n.oEditCol.validate&&n.oEditCol.get("pbChanged")&&!n.oEditCol.validate())return!1;super.selectRow(e,t,(function(e,s){var o,n,a=this.oM;null!==this.iChangeToCol&&this.iChangeToCol!==a.iCurrentColumn&&(n=a.iCurrentColumn,a.iCurrentColumn=this.iChangeToCol,a.onColChange.fire(this,{bRowChange:e,iGotoCol:this.iChangeToCol,iPrevCol:n})),this.iChangeToCol=null,e&&a.aData[t]&&(this.tOrigRow=r.sys.json.parse(r.sys.json.stringify(a.aData[t]))),e&&this.bNewRow&&((o=a.rowIndexByRowId(""))>=0&&(a.aData.splice(o,1),a.prepDisplay(),a.iCurrentRow=a.rowIndexByRowId(a.sCurrentRowId),a.onDataUpdate.fire(this,{sType:"remrow",sRowId:"",iRowIndex:o})),this.bNewRow=!1),i&&i.call(this,e,s)}),s)}processDataSet(e){this.updateCacheFromColumns(),super.processDataSet(e)}updateCacheFromColumns(){const e=this.oM,t=this.oL,i=e.iCurrentRow;let s=null,o=!1;if(!t.pbDataAware&&i>=0){for(let n=0;n<t._aColumns.length;n++){const r=t._aColumns[n];if(r.get("pbChanged")){s||(s=JSON.parse(JSON.stringify(e.aData[i])));const t=r.get("psValue");o=o||s.aCells[r._iColIndex].sValue!==t,s.aCells[r._iColIndex].sValue=t}}s&&(o||""===s.sRowId)&&(""===s.sRowId&&(s.sRowId="new_"+this.iNewCount++),e.updateRow(e.sCurrentRowId,s))}}updateRow(e,t,i){this.bNewRow&&""===e&&""===t.sRowId&&(t.sRowId="new_"+this.iNewCount++),super.updateRow(e,t,i)}updateCell(e,t){this.tNewRow&&""===this.oM.sCurrentRowId?this.tNewRow.aCells[e._iColIndex].sValue=t:super.updateCell(e,t)}handleData(e,t,i,s,o){super.handleData(e,t,i,s,o),0===this.oM.aData.length&&this.appendNewRow()}createNewRow(){const e=this.oL,t={sRowId:"",sCssClassName:"",aCells:[],iGroupHeaderIndex:-1};for(let i=0;i<e._aColumns.length;i++)t.aCells[e._aColumns[i]._iColIndex]={sValue:e._aColumns[i].peDataType===r.ciTypeBCD?"0":"",sTooltip:"",sCssClassName:"",aOptions:[]};return t}appendNewRow(){const e=this.oL,t=this.oM;let i;return!!e.pbAllowAppendRow&&(this.tNewRow=i=this.createNewRow(),this.selectRow("new",-1,(function(s,o){s&&(this.bNewRow=!0,t.aData.push(i),t.sCurrentRowId!==i.sRowId?this.setCurrentRowId(i.sRowId):t.iCurrentRow=t.rowIndexByRowId(i.sRowId),t.prepDisplay(),t.onDataUpdate.fire(this,{sType:"newrow",sRowId:i.sRowId,iRowIndex:t.aData.length-1}),e.pbOfflineEditing&&this.updateColumnsFromCache(!0)),this.tNewRow=null}),e.pbDataAware?null:i),!0)}insertNewRow(){const e=this.oL,t=this.oM,i=t.iCurrentRow;let s;return e.pbAllowInsertRow?(this.tNewRow=s=this.createNewRow(),this.selectRow("new",-1,(function(o,n){o&&(this.bNewRow=!0,t.aData.splice(i,0,s),t.sCurrentRowId!==s.sRowId?this.setCurrentRowId(s.sRowId):t.iCurrentRow=t.rowIndexByRowId(s.sRowId),t.prepDisplay(),t.onDataUpdate.fire(this,{sType:"newrow",sRowId:s.sRowId,iRowIndex:t.iCurrentRow}),e.pbOfflineEditing&&this.updateColumnsFromCache(!0),this.tNewRow=null)}),e.pbDataAware?null:s),!0):this.appendNewRow()}clearRow(e){const t=this.oM,i=this.oL;let s;if(e===t.sCurrentRowId){if(t.iCurrentRow>=0)for(let e=0;e<i._aColumns.length;e++)s=i._aColumns[e],s.get("pbChanged")&&(s.set("psValue",this.tOrigRow&&this.tOrigRow.aCells[s._iColIndex].sValue||""),s.set("pbChanged",!1))}}setCurrentRowId(e){const t=this.oM;if(e!==t.sCurrentRowId&&null!==this.iChangeToCol&&this.iChangeToCol!==t.iCurrentColumn){const e=t.iCurrentColumn;t.iCurrentColumn=this.iChangeToCol,t.onColChange.fire(this,{bRowChange:!0,iGotoCol:this.iChangeToCol,iPrevCol:e}),this.iChangeToCol=null}super.setCurrentRowId(e)}cellClick(e,t,i){const s=this.oM,o=this.oL;i>=0&&i!==s.iCurrentColumn&&o._aColumns[i].pbEditable&&(this.iChangeToCol=i),"empty"===t&&this.appendNewRow(),super.cellClick(e,t,i)}prevCol(){const e=this.oM,t=this.oL;let i,s=!1;i=e.iCurrentColumn;for(let e=0;e<t._aColumnMapper.length;e++)if(t._aColumnMapper[e]._iCol===i){i=e;break}do{if(i--,i<0){if(s)break;s=!0,i=t._aColumnMapper.length-1}}while(!t._aColumnMapper[i].isEnabled()||!t._aColumnMapper[i].pbEditable||!t._aColumnMapper[i].pbRender||t._aColumnMapper[i].pbHidden||!t._aColumnMapper[i].pbVisible);if(i=t._aColumnMapper[i]._iCol,s){if(e.iCurrentRow>0)return this.iChangeToCol=i,this.selectRow("row",e.iCurrentRow-1),!0}else if(i!==e.iCurrentColumn){const t=e.iCurrentColumn;return e.iCurrentColumn=i,e.onColChange.fire(this,{bRowChange:s,iGotoCol:i,iPrevCol:t}),!0}return!1}nextCol(){const e=this.oL,t=this.oM;let i,s;i=t.iCurrentColumn;for(let t=0;t<e._aColumnMapper.length;t++)if(e._aColumnMapper[t]._iCol===i){i=t;break}if(!e._aColumnMapper[i].isEnabled()||e._aColumnMapper[i].validate&&e._aColumnMapper[i].validate()){do{if(i++,i>=e._aColumnMapper.length){if(s)break;s=!0,i=0}}while(!e._aColumnMapper[i].isEnabled()||!e._aColumnMapper[i].pbEditable||!e._aColumnMapper[i].pbRender||e._aColumnMapper[i].pbHidden||!e._aColumnMapper[i].pbVisible);if(i=e._aColumnMapper[i]._iCol,s)return this.iChangeToCol=i,t.iCurrentRow<t.aData.length-1?(this.selectRow("row",t.iCurrentRow+1),!0):this.appendNewRow();if(i!==t.iCurrentColumn){const e=t.iCurrentColumn;return t.iCurrentColumn=i,t.onColChange.fire(this,{bRowChange:!1,iGotoCol:i,iPrevCol:e}),!0}}return!0}selectCol(e){const t=this.oM,i=this.oL;if(e>=0&&e<i._aColumns.length&&i._aColumns[e].pbRender){const i=t.iCurrentColumn;t.iCurrentColumn=e,t.onColChange.fire(this,{bRowChange:!1,iGotoCol:e,iPrevCol:i})}}keyDown(e){const t=e.oDOMEvent;if(t.matchKey(r.settings.gridKeys.prevCol)){if(this.prevCol())return t.stop(),!1}else if(t.matchKey(r.settings.gridKeys.nextCol)){if(this.nextCol())return t.stop(),!1}else{if(!t.matchKey(r.settings.gridKeys.newRow))return super.keyDown(e);if(this.insertNewRow())return t.stop(),!1}return!0}moveDownRow(){return!!super.moveDownRow.call(this)||!(this.oM.bPaged&&!this.oM.bLast)&&this.appendNewRow()}}class We extends _e{constructor(e,t){super(e,t),this.prop(r.tBool,"pbAllowInsertRow",!0),this.prop(r.tBool,"pbAllowAppendRow",!0),this.prop(r.tInt,"piCurrentColumn",0),this.pbAutoSearch=!1,this.addSync("piCurrentColumn"),this._bRenderChildren=!0,this._sControlClass="WebGrid"}createView(){return this.pbScroll?new Se(this,this._oModel,this._oController):new we(this,this._oModel,this._oController)}createController(){return new Re(this,this._oModel)}createModel(){return this.peDbGridType!==r.gtAllData&&this.peDbGridType!==r.gtManual&&this.pbDataAware&&this.pbScroll?new ve(this):new De(this)}renderChildren(){const e=this._oModel;let t=null,i=null;for(let e=0;e<this._aColumns.length;e++)this._aColumns[e].pbShowLabel=!1,this._aColumns[e].render(),this._aColumns[e].afterRender(),null==t&&this._aColumns[e].pbRender&&(t=this._aColumns[e]),null==i&&this._aColumns[e].pbRender&&this._aColumns[e].isEnabled()&&(i=this._aColumns[e]);e.iCurrentColumn<0&&(e.iCurrentColumn=i?i._iCol:t?t._iCol:0)}applyEnabled(e){super.applyEnabled(e)}prevCol(){this._oController.prevCol()}nextCol(){this._oController.nextCol()}selectCol(e){this._oController.selectCol(e)}insertNewRow(){return this._oController.insertNewRow()}appendNewRow(){return this._oController.appendNewRow()}clearRow(e){return this._oController.clearRow(e)}get_piCurrentColumn(){return this._oModel.iCurrentColumn}set_piCurrentColumn(e){this._oController.selectCol(e)}attachFocusEvents(){this._eFocus.tabIndex=-1,super.attachFocusEvents()}focus(){return!!(this._bFocusAble&&this.isEnabled()&&this._eFocus)&&(this._oBody.focus()||(this._eFocus.focus(),this.objFocus()),!0)}}class Ie extends ie{constructor(e,t){super(e,t),this._bAllChecked=!1,this._iBeginRange=-1}keyDown(e){const t=e.oDOMEvent;let i=this.oL,s=this.oM;if(i._bHasFocus){if(i.pbKeyboardSelection){if(t.matchKey(r.settings.listKeys.select))return this.toggleCurrentRow(),t.stop(),!1;if(t.matchKey(r.settings.listKeys.selectAll))return this.toggleSelectAll(),t.stop(),!1;if(t.matchKey(r.settings.listKeys.deSelectAll))return this.clearSelection(),t.stop(),!1;if(t.matchKey(r.settings.listKeys.scrollUp)||t.matchKey(r.settings.listKeys.scrollDown)||t.matchKey(r.settings.listKeys.scrollPageUp)||t.matchKey(r.settings.listKeys.scrollPageDown)||t.matchKey(r.settings.listKeys.scrollTop)||t.matchKey(r.settings.listKeys.scrollBottom)){let t=super.keyDown(e);return i.pbSelectionByRow&&(this.clearSelection(),this.setCurrentRow(!0)),this._iBeginRange=-1,t}if(t.matchKey(r.settings.listKeys.scrollRangeUp)){-1===this._iBeginRange&&(this._iBeginRange=s.iCurrentRow),this.clearSelection(),this.moveUpRow();for(let e=Math.min(s.iCurrentRow,this._iBeginRange);e<=Math.max(s.iCurrentRow,this._iBeginRange);e++){let t=s.rowIdByRowIndex(e);t&&this.setSelection(t,!0)}return t.stop(),!1}if(t.matchKey(r.settings.listKeys.scrollRangeDown)){-1===this._iBeginRange&&(this._iBeginRange=s.iCurrentRow),this.clearSelection(),this.moveDownRow();for(let e=Math.min(s.iCurrentRow,this._iBeginRange);e<=Math.max(s.iCurrentRow,this._iBeginRange);e++){let t=s.rowIdByRowIndex(e);t&&this.setSelection(t,!0)}return t.stop(),!1}return super.keyDown(e)}t.stop()}}cellClick(e,t,i,s){let o=this.oL,n=this.oM,r=n.rowIndexByRowId(t),a=!!s;if("empty"!==t)if(o.pbKeyboardSelection&&e.e.ctrlKey)this.toggleSelectionOfRow(t);else if(o.pbKeyboardSelection&&e.e.shiftKey){this.clearSelection();let e=this._iBeginRange=-1!==this._iBeginRange?this._iBeginRange:n.iCurrentRow,t=r>=e?1:-1;for(this.selectRow("row",r),r+=t;e!==r;){let i=n.rowIdByRowIndex(e);i&&this.setSelection(i,!0),e+=t}a=!0}else o.pbSelectionByRow?(this.clearSelection(),r>=0&&this.setSelection(t,!0)):i>=0&&o._aColumns[i]._bIsMultiSelectCapable&&this.setSelection(t,!o.isRowIdSelected(t));let l=super.cellClick(e,t,i,a);return a||(this._iBeginRange=-1),e.stop(),l}headClick(e,t){let i=this.oL._aColumns[t];if(i&&i._bIsMultiSelectCapable){if(e.getTarget().classList.contains("WebCB_Fake"))return this.toggleSelectAll(),e.stop(),!1}return super.headClick(e,t)}toggleSelectAll(){this._bAllChecked?this.clearSelection():this.selectAll(),this._iBeginRange=-1}setAllSelectedCheckboxState(e,t=!0){let i=this.oL._oHeader;this._bAllChecked=e,t&&i.updateHeader()}areAllRowsSelected(){return this._bAllChecked}toggleCurrentRow(){const e=this.oM;e.sCurrentRowId&&e.sCurrentRowId.length>0&&this.toggleSelectionOfRow(e.sCurrentRowId)}setCurrentRow(e){const t=this.oM;t.sCurrentRowId&&t.sCurrentRowId.length>0&&this.setSelection(t.sCurrentRowId,e)}toggleSelectionOfRow(e,t){const i=this.oL,s=this.oM;let o=i._paSelectedRowIds.findIndex((t=>t===e));o>=0?(i._paSelectedRowIds.splice(o,1),t||this.fireSelectionEvent("OnDeSelectRow",s.rowByRowId(e)),i._oBody.refreshRow(e,e)):(i._paSelectedRowIds.push(e),t||this.fireSelectionEvent("OnSelectRow",s.rowByRowId(e)),i._oBody.refreshRow(e,e)),this.setAllSelectedCheckboxState(!1)}isCurrentRowSelected(){const e=this.oL,t=this.oM;return!(!t.sCurrentRowId||t.sCurrentRowId.length<=0)&&e._paSelectedRowIds.findIndex((e=>e===t.sCurrentRowId))>=0}setSelection(e,t,i){const s=this.oL,o=this.oM;let n=s._paSelectedRowIds.findIndex((t=>t===e));t&&-1==n?(s._paSelectedRowIds.push(e),i||this.fireSelectionEvent("OnSelectRow",o.rowByRowId(e)),s._oBody.refreshRow(e,e)):!t&&n>=0&&(s._paSelectedRowIds.splice(n,1),i||this.fireSelectionEvent("OnDeSelectRow",o.rowByRowId(e)),s._oBody.refreshRow(e,e)),this.setAllSelectedCheckboxState(!1)}selectAll(){let e=this.oL,t=this.oM;e._paSelectedRowIds=[];for(let i=0;i<t.aData.length;i++)e._paSelectedRowIds.push(t.aData[i].sRowId),e._oBody.refreshRow(t.aData[i].sRowId,t.aData[i].sRowId);this.setAllSelectedCheckboxState(!0),this.fireSelectionEvent("OnSelectAllRows")}clearSelection(){let e=this.oL,t=e._paSelectedRowIds.slice();e._paSelectedRowIds=[];for(let i=0;i<t.length;i++)e._oBody.refreshRow(t[i],t[i]);this.setAllSelectedCheckboxState(!1),this.fireSelectionEvent("OnDeSelectAllRows")}fireSelectionEvent(e,t){let i=this.oL;const s=1,o=2,n=3,a=4;let l=0;switch(e){case"OnSelectRow":if(l=s,null==t)return;break;case"OnDeSelectRow":if(l=o,null==t)return;break;case"OnSelectAllRows":l=n;break;case"OnDeSelectAllRows":l=a;break;default:throw new r.Error(999,"Invalid selection Event")}i.addSync("paSelectedRowIds"),i.fireEx({sEvent:e,aParams:[l],tActionData:t,sAltServerName:"privateOnSelectEvent"})}}class Me extends ne{constructor(e,t){super(e,t),this._sCSSSelectedClass="WebList_MultiSelected",this._sCSSUnSelectedClass="WebList_MultiUnSelected"}rowClass(e,t){return e?this.oL._paSelectedRowIds.find((t=>t===e.sRowId))?super.rowClass(e,t)+" "+this._sCSSSelectedClass:super.rowClass(e,t)+" "+this._sCSSUnSelectedClass:super.rowClass(e,t)}}class Te extends _e{constructor(e,t){super(e,t),this._sControlClass="WebMultiSelectList WebList",this._aMultiSelectColumns=[],this.prop(r.tAdv,"paSelectedRowIds",null),this.prop(r.tBool,"pbSelectionByRow",!0),this.prop(r.tBool,"pbKeyboardSelection",!0),this.event("OnSelectRow",r.cCallModeDefault),this.event("OnDeSelectRow",r.cCallModeDefault),this.event("OnSelectAllRows",r.cCallModeDefault),this.event("OnDeSelectAllRows",r.cCallModeDefault),this._paSelectedRowIds=[]}addChild(e){e._bIsColumn&&e._bIsMultiSelectCapable&&this._aMultiSelectColumns.push(e),super.addChild(e)}createController(){return new Ie(this,this._oModel)}createRowModel(){return new Me(this,this._oModel)}set_paSelectedRowIds(e){e=r.sys.vt.deserialize(e,[r.tString]),Array.isArray(e)||(e=[]),e&&e.length===this._paSelectedRowIds.length&&e.every(((e,t)=>e===this._paSelectedRowIds[t]))||(this._paSelectedRowIds=e,this._oController.setAllSelectedCheckboxState(!1,!1),this.redraw())}get_paSelectedRowIds(){return r.sys.vt.serialize(this._paSelectedRowIds,[r.tString])}isRowIdSelected(e){return this._paSelectedRowIds.find((t=>t===e))}hasCheckboxColumn(){return this._aMultiSelectColumns.length>0}gridRefresh(e,t){this._oController.setAllSelectedCheckboxState(!1),super.gridRefresh(e,t)}handleDataPage(e,t,i,s){this._oController.setAllSelectedCheckboxState(!1),super.handleDataPage(e,t,i,s)}dataSetAppendRow(){this._oController.setAllSelectedCheckboxState(!1),super.dataSetAppendRow()}dataSetInsertRowBefore(e){this._oController.setAllSelectedCheckboxState(!1),super.dataSetInsertRowBefore(e)}dataSetInsertRowAfter(e){this._oController.setAllSelectedCheckboxState(!1),super.dataSetInsertRowAfter(e)}dataSetRemoveRow(e){this._oController.setSelection(e,!1),super.dataSetRemoveRow(e)}removeRow(e){this._oController.setSelection(e,!1),super.removeRow(e)}determineSelectorForWebUIContext(e){return e===r.WebUIContext.WebUIContextListSelection?".WebList_MultiSelected":super.determineSelectorForWebUIContext(e)}retrieveValueFromWebUIContext(e,t){return t===r.WebUIContext.WebUIContextListSelection?this._paSelectedRowIds.join(","):super.retrieveValueFromWebUIContext(e,t)}getDragData(e,t){try{const e=t.getAttribute("data-dfrowid")||-1;let i;return e&&"empty"!=e&&-1!=e&&(""!=e||e>=0)?(i=[],this._paSelectedRowIds.includes(e)?this._paSelectedRowIds.forEach((e=>i.push({...this._oModel.aData[this._oModel.rowIndexByRowId(e)]}))):i.push({...this._oModel.aData[this._oModel.rowIndexByRowId(e)]}),i.forEach((e=>Object.keys(e).forEach((function(t){0==t.indexOf("_")&&delete e[t]})))),[{data:i},this._paSelectedRowIds.includes(e)?r.dragActions.WebMultiSelectList.ciDragRowSelection:r.dragActions.WebList.ciDragRow]):[null,null]}catch(e){return console.error("Attempt to perform unsupported drag action"),[null,null]}}onDragStart(e){var[t,i]=this.getDragData(e,e.e.target);if(t&&i){if(e.e.stopPropagation(),!this._eTempCrt&&i===r.dragActions.WebMultiSelectList.ciDragRowSelection){this._eTempCrt=document.createElement("div"),this._eTempCrt.classList.add("WebMultiSelectList"),this._eTempCrt.classList.add("WebDragDropMultiSelectionGhost"),this._eTempCrt.style.position="absolute",this._eTempCrt.style.top="0px",this._eTempCrt.style.right="0px",this._eTempCrt.style.bottom="0px",this._eTempCrt.style.width="max-content",this._eTempCrt.style.height="20px",this._eTempCrt.style.padding="7px",this._eTempCrt.style.backgroundColor="white",this._eTempCrt.style.border="solid gray 1px",this._eTempCrt.style["border-radius"]="5px",this._eTempCrt.style["z-index"]="-1";let t=document.createElement("p");t.innerText=this._paSelectedRowIds.length+this.getWebApp().getTrans("rows"),this._eTempCrt.appendChild(t),document.body.appendChild(this._eTempCrt),e.e.dataTransfer.setDragImage(this._eTempCrt,0,0)}this._aDragDropHelpers.forEach((s=>{s.onDragStart(e,this,e.e.target,t,i)}))}}onDragEnd(e){this._aDragDropHelpers.forEach((t=>{t.onDragEnd(e)})),this._eTempCrt&&(document.body.removeChild(this._eTempCrt),this._eTempCrt=null)}}class He extends(me(Z)){}class Ee extends(me(q)){}class xe extends Ee{constructor(e,t){super(e,t),this._sTick=null,this._sCellClass="WebColCheckbox",this._sControlClass="WebCheckbox WebCheckboxColumn"}cellClickBefore(e,t,i){const s=e.getTarget();super.cellClickBefore(e,t,i),r.dom.isParent(s,this._eElem)||"INPUT"!==s.tagName&&"SPAN"!==s.tagName||(this._sTick=t)}cellClickAfter(e,t,i){super.cellClickAfter(e,t,i),this._sTick&&this.getWebApp().waitForCall((function(){this._bIgnoreOnChange=!1,this._sTick===this._oParent.currentRowId()&&(this.tick(),this._sTick=null),this._bIgnoreOnChange=!0}),this)}cellHtml(e,t){const i=[];return i.push('<div class="',this.genClass(),'"><div class="WebCon_Inner"><div><input type="checkbox"'),t.sValue===this.psChecked?i.push(' onclick="this.checked = true" checked="checked"'):i.push(' onclick="this.checked = false"'),this.isEnabled()||i.push(' disabled="disabled"'),this._oParent instanceof We||i.push(' tabindex="-1"'),i.push('><span class="WebCB_Fake"></span></div></div></div>'),i.join("")}}class Le extends(me(U)){}class Ae extends(me(w)){}class Pe extends(me(w)){}class Be extends(me(J)){}class Fe extends(me(w)){}class ke extends(me(X)){}class Ve extends O{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowOnHover",!1),this.prop(r.tBool,"pbFocusable",!1),this._bShownByHover=!1,this._sSelectedItem=null,this._sExpanded=null,this._tHideTimeout=null,this._bIsMenuListener=!0,this._bWrapDiv=!0,this._bRenderChildren=!1,this._sControlClass="WebMenuBar"}openHtml(e){super.openHtml(e),e.push('<ul class="WebBarRoot" tabindex="0">'),this.genMenuHtml(e)}closeHtml(e){e.push("</ul>"),e.push('<div style="clear: both"></div>'),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"ul"),super.afterRender(),r.dom.on("click",this._eControl,this.onMenuClick,this),r.dom.on("mouseover",this._eControl,this.onMouseOver,this),r.dom.on("mouseout",this._eControl,this.onMouseOut,this),r.dom.on("keydown",this._eControl,this.onKeyDown,this)}genMenuHtml(e){const t=this.getMenu();for(let i=0;i<t.length;i++)this.genItemHtml(e,t[i],i.toString(),!0)}refreshMenu(){const e=[];this._eControl&&(this.genMenuHtml(e),this._eControl.innerHTML=e.join(""),this.exapndPath(this._sExpanded||"",!0))}onMenuClick(e){let t,i=null;if(this.isEnabled()){for(this.notifyReceived(),this._bShownByHover=!1,t=e.getTarget();!i&&t&&t!==this._eElem;)t.hasAttribute("data-df-path")&&(i=this.getItemByPath(t.getAttribute("data-df-path"))),t=t.parentNode;i&&(this.selectItem(i),i.bEnabled&&(this.isExpanded(i)?this.collapseItem(i):this.expandItem(i),i._oHandler.itemClick(i,(function(e){!e||i.hRef instanceof k||this.collapseAll()}),this)&&this.getWebApp().returnFocus()),e.stop())}}onMouseOver(e){let t,i=null;if(this.isEnabled()){for(this.notifyReceived(),t=e.getTarget();!i&&t&&t!==this._eElem;)t.hasAttribute("data-df-path")&&(i=this.getItemByPath(t.getAttribute("data-df-path"))),t=t.parentNode;i&&(this.selectItem(i),(this._sExpanded||this.pbShowOnHover)&&(this._sExpanded||(this._bShownByHover=!0),i.aChildren.length>0?this.expandItem(i):this.collapseSubItems(i)),e.stop())}}onMouseOut(e){this.notifyLost(!0),e.stop()}selectItem(e){let t;this._sSelectedItem&&this._sSelectedItem!==e._sPath&&this._sSelectedItem!==e._sPath&&(t=this.getItemElemByPath(this._sSelectedItem),t&&r.dom.removeClass(t,"WebItm_Selected"),this._sSelectedItem=null),e.bEnabled&&(t=this.getItemElemByPath(e._sPath),r.dom.addClass(t,"WebItm_Selected"),this._sSelectedItem=e._sPath)}isExpanded(e){return!(!this._sExpanded||this._sExpanded.substr(0,e._sPath.length)!==e._sPath)}exapndPath(e,t){let i=e.split("."),s="";t&&r.dom.addClass(this._eElem,"WebNoTransition");for(let e=0;e<i.length;e++){s+=e>0?"."+i[e]:i[e];let t=this.getItemByPath(s);t&&this.expandItem(t)}t&&r.dom.removeClass(this._eElem,"WebNoTransition")}expandItem(e){let t,i;if(this.collapseSubItems(e),e.aChildren.length>0&&e.bEnabled){for(this._sExpanded=e._sPath,t=this.getItemElemByPath(this._sExpanded);t&&t!==this._eElem;)t.hasAttribute("data-df-path")&&(r.dom.addClass(t,"WebItm_Expanded"),i=t),t=t.parentNode;if(i){const e=i.lastChild,t=i.getBoundingClientRect();let s=t.left;const o=r.sys.gui.getViewportWidth();s+e.offsetWidth>o&&(s=t.right-e.offsetWidth,s<0&&(s=5)),e.style.top=t.bottom+"px",e.style.left=s+"px"}}}collapseSubItems(e){let t;const i=e._sPath;if(this._sExpanded&&e._sPath!==this._sExpanded)if(t=this.getItemElemByPath(this._sExpanded),t)for(;t&&t!==this._eElem;){if(t.hasAttribute("data-df-path")){if(this._sExpanded=t.getAttribute("data-df-path"),this._sExpanded===i.substr(0,this._sExpanded.length))break;r.dom.removeClass(t,"WebItm_Expanded")}t=t.parentNode}else this.collapseAll()}collapseItem(e){let t=e._sPath;t.indexOf(".")>0?(t=t.substr(0,t.lastIndexOf(".")),this.expandItem(this.getItemByPath(t))):this.collapseAll()}collapseAll(){const e=r.dom.query(this._eControl,"li.WebItm_Expanded",!0);for(let t=0;t<e.length;t++)r.dom.removeClass(e[t],"WebItm_Expanded");this._sExpanded=null}notifyLost(e){const t=this;e&&!this._bShownByHover||(this._tHideTimeout&&clearTimeout(this._tHideTimeout),this._tHideTimeout=setTimeout((function(){var i;t._tHideTimeout=null,t.collapseAll(),t._sSelectedItem&&((i=t.getItemElemByPath(t._sSelectedItem))&&r.dom.removeClass(i,"WebItm_Selected"),t._sSelectedItem=null),e&&t._bShownByHover&&t.getWebApp().returnFocus()}),150))}notifyReceived(){this._tHideTimeout&&(clearTimeout(this._tHideTimeout),this._tHideTimeout=null)}moveParent(){let e=this._sSelectedItem;if(e&&e.indexOf(".")>0){e=e.substr(0,e.lastIndexOf("."));const t=this.getItemByPath(e);t&&(this.collapseItem(t),this.selectItem(t))}}moveSibling(e){let t,i=!0;if(this._sSelectedItem){const s=this._sSelectedItem.split(".");for(;i||t&&!t.bEnabled;){s[s.length-1]=parseInt(s[s.length-1],10)+e;const o=s.join(".");t=this.getItemByPath(o),i=!1}t&&(this.expandItem(t),this.selectItem(t))}}moveChild(){let e,t,i=!0;e=this._sSelectedItem?this._sSelectedItem+".0":"0";const s=e.split(".");for(;i||t&&!t.bEnabled;)e=s.join("."),t=this.getItemByPath(e),s[s.length-1]=parseInt(s[s.length-1],10)+1,i=!1;t&&(this.expandItem(t),this.selectItem(t))}onKeyDown(e){let t=!1;const i=this._sSelectedItem&&this._sSelectedItem.indexOf(".")<0;if(e.matchKey(r.settings.menuKeys.moveUp))i||this.moveSibling(-1),t=!0;else if(e.matchKey(r.settings.menuKeys.moveDown))i?this.moveChild():this.moveSibling(1),t=!0;else if(e.matchKey(r.settings.menuKeys.moveLeft))i?this.moveSibling(-1):this.moveParent(),t=!0;else if(e.matchKey(r.settings.menuKeys.moveRight))i?this.moveSibling(1):this.moveChild(),t=!0;else if(e.matchKey(r.settings.formKeys.submit)&&this._sSelectedItem){const e=this.getItemByPath(this._sSelectedItem);e&&(t=!0,e._oHandler.itemClick(e,(function(e){e&&(this.collapseAll(),this.getWebApp().returnFocus())}),this))}t&&(e.stop(),this._bShownByHover=!1)}onFocus(e){this.isEnabled()&&(this.notifyReceived(),this._eElem&&(r.dom.addClass(this._eElem,"WebCon_Focus"),this._sSelectedItem||this.moveChild()),this.pbFocusable&&this.objFocus(),this.fire("OnFocus"),this._bHasFocus=!0)}onBlur(e){this.notifyLost(!1),this._eElem&&r.dom.removeClass(this._eElem,"WebCon_Focus"),this.fire("OnBlur"),this._bHasFocus=!1}}class Oe extends Ve{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowCaption",!1),this.prop(r.tInt,"peAlign",r.ciAlignLeft),this.prop(r.tBool,"pbShowIcons",!0),this.prop(r.tString,"psSubItemCaption","More.."),this._eControl=null,this._bWrapDiv=!0,this._sControlClass="WebToolBar"}openHtml(e){super.openHtml(e)}closeHtml(e){super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"ul"),super.afterRender(),this.set_pbShowCaption(this.pbShowCaption),this.set_pbShowIcons(this.pbShowIcons),this.set_peAlign(this.peAlign)}refreshMenu(){super.refreshMenu(),this.adjustWidth()}genMenuHtml(e){super.genMenuHtml(e),e.push('<li data-df-item="subitems" class="WebMenuItem WebTlb_SubItems WebTlb_NoFit" style="display: none;"><div><span class="WebItm_Icon">&nbsp;</span><a href="javascript: void(0);" target="_self">',this.psSubItemCaption,"</a></div><ul></ul></li>")}onMenuClick(e){let t;if(super.onMenuClick(e),!e.bCanceled)for(t=e.getTarget();t&&t!==this._eElem;){if(t.hasAttribute("data-df-item"))return this._eControl.focus(),this._bSubMenuOpened?this.collapseAll():this.expandSub(),void e.stop();t=t.parentNode}}expandSub(){let e;const t=r.dom.query(this._eControl,"li.WebTlb_NoFit"),i=t.lastChild;if(i){r.dom.addClass(t,"WebItm_Expanded"),this._bSubMenuOpened=!0;const s=t.getBoundingClientRect();e=s.left;const o=r.sys.gui.getViewportWidth();e+i.offsetWidth>o&&(e=s.right-i.offsetWidth,e<0&&(e=5)),i.style.top=s.bottom+"px",i.style.left=e+"px"}}collapseAll(){if(this._bSubMenuOpened){const e=r.dom.query(this._eControl,"li.WebTlb_NoFit");r.dom.addClass(e,"WebItm_Expanded"),this._bSubMenuOpened=!1}super.collapseAll()}adjustWidth(){let e;if(this._eControl){const t=this._eControlWrp.clientWidth,i=r.dom.query(this._eControl,"li.WebTlb_NoFit");if(this._eControl.scrollWidth>t){const s=r.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",!0);if(s.length>1){const o=r.dom.query(this._eControl,"li.WebTlb_NoFit > ul");for(i.style.display="",e=s.length-2;this._eControl.scrollWidth>t&&e>=0;){const t=s[e];o.appendChild(t),e--}}}else i.style.display="none"}}resize(){const e=this._eControlWrp.clientWidth;this._iLastResizeSpace!==e&&(this._iLastResizeSpace=e,this.adjustWidth())}genClass(){let e=super.genClass();return e+=this._oParent?._bIsCommandBar?" WebTlb_Command":" WebTlb_Standalone",e}set_pbShowCaption(e){this._eControl&&(r.dom.toggleClass(this._eControl,"WebTlb_HideCaption",!e),this.refreshMenu())}set_pbShowIcons(e){this._eControl&&(r.dom.toggleClass(this._eControl,"WebTlb_HideIcons",!e),this.refreshMenu())}set_peAlign(e){this._eControlWrp&&(this._eControlWrp.style.textAlign=["left","center","right"][e])}}class Ne extends(V(c)){}class ze{oL=null;aColumns=[];aGroups=[];eDragGroup=null;onSizeChanged=new df.events.JSHandler;onGroupsChanged=new df.events.JSHandler;components={eMain:null,eContainer:null,eSubGroupBtn:null,eFieldsSelected:null,eChip:null,eSelectDropdown:null};constructor(e){this.oL=e,e._onSettingChange.on(this.onWebListSettingsChange,this),this.createElements(),this.updateColumns()}render(){return this.aGroups=this.oL._oModel.aGroups,this.renderGroups(),df.dom.addClass(this.components.eSelectDropdown,"Web_Hidden"),this.components.eMain}onWebListSettingsChange(e){this.updateColumns()}updateColumns(){this.aColumns=[],this.oL._aColumns.forEach((e=>{e.pbRender&&e.pbGroupable&&this.aColumns.push({iColumnId:e._iCol,sLabel:df.dom.encodeHtml(e.psCaption)})}))}createElements(){const e=this.components.eMain=df.dom.create('<div class="WebGrpSel_Container">\n                <div class="WebGrpSel_Head">\n                    <div id="WebGrpSel_Title">Group Columns</div>\n                    <div class="WebGrpSel_Chip">0</div>\n                </div>\n                <div class="WebGrpSel_Fields"></div>\n                <div class="WebGrpSel_Add">\n                    <button type="button" class="WebGrpSel_Add_Button">+ Add group</button>\n                    <div class="WebGrpSel_DropDown Web_Hidden"></div>\n                </div>\n            </div>\n        ');this.components.eChip=df.dom.query(e,".WebGrpSel_Chip"),this.components.eFieldsSelected=df.dom.query(e,".WebGrpSel_Fields"),this.components.eSubGroupBtn=df.dom.query(e,".WebGrpSel_Add_Button"),this.components.eSelectDropdown=df.dom.query(e,".WebGrpSel_DropDown"),df.dom.on("click",this.components.eMain,this.onMainClick,this),df.dom.on("click",this.components.eSubGroupBtn,this.onAddButtonClick,this),df.dom.on("click",this.components.eSelectDropdown,this.onAddDropDownClick,this),df.dom.on("click",this.components.eFieldsSelected,this.onFieldsClick,this),df.dom.on("change",this.components.eFieldsSelected,this.onFieldsChange,this),df.dom.on("dragstart",this.components.eFieldsSelected,this.onFieldsDragStart,this),df.dom.on("dragenter",this.components.eFieldsSelected,this.onFieldsDragEnter,this),df.dom.on("dragleave",this.components.eFieldsSelected,this.onFieldsDragLeave,this),df.dom.on("dragover",this.components.eFieldsSelected,this.onFieldsDragOver,this),df.dom.on("dragend",this.components.eFieldsSelected,this.onFieldsDragEnd,this),df.dom.on("drop",this.components.eFieldsSelected,this.onFieldsDragDrop,this)}onMainClick(e){e.stop()}onAddButtonClick(e){const t=this.components.eSelectDropdown,i=this.availableColumns();if(t.classList.contains("Web_Hidden")){this.components.eSelectDropdown.innerHTML=i.reduce(((e,t)=>e+`<div class="Web_Item" data-colid="${t.iColumnId}">${t.sLabel}</div>`),"");const e=this.components.eSubGroupBtn.getBoundingClientRect();t.style.top=e.bottom+"px",t.style.left=e.left+"px",df.dom.removeClass(t,"Web_Hidden")}else df.dom.addClass(t,"Web_Hidden")}columnIndexById(e){return this.aColumns.map((e=>e.iColumnId)).indexOf(parseInt(e,10))}onAddDropDownClick(e){const t=e.getTarget()?.closest(".Web_Item[data-colid]")?.dataset.colid||null;if(null==t)return;const i=this.columnIndexById(t);if(-1==i)return;const s=this.aColumns[i];this.aGroups.push({iColumnId:s.iColumnId,sLabel:s.sLabel,bReverse:!1}),this.renderGroups(),this.fireGroupsChanged(),df.dom.addClass(this.components.eSelectDropdown,"Web_Hidden")}availableColumns(){const e=this.aGroups.map((e=>e.iColumnId)),t=[];return this.aColumns.forEach((i=>{-1==e.indexOf(i.iColumnId)&&t.push(i)})),t}renderGroups(){const e=this.availableColumns();this.components.eFieldsSelected.innerHTML=this.aGroups.reduce(((t,i,s)=>(t+=`<div class="WebGrpSel_Group" data-group="${s}" draggable="true">\n                    <div class="WebGrpSel_Action" data-action="rearrange" title="Drag to rearrange"><i class="WebGrpSel_IconReaarrange"></i></div>\n                    <select class="WebGrpSel_GroupSelect" title="Select group col">\n                    <option value="${i.iColumnId}" selected>${i.sLabel}</option>\n            `,t+=e.reduce(((e,t,i)=>e+`<option value="${t.iColumnId}">${t.sLabel}</option>`),""),t+=`</select>\n                    <div class="WebGrpSel_Action" data-action="switchsort" title="Switch sorting direction"><i class="${i.bReverse?"WebGrpSel_IconSortAsc":"WebGrpSel_IconSortDesc"}"></i></div>\n                    <div class="WebGrpSel_Action" data-action="remove" title="Remove Group"><i class="WebGrpSel_IconRemove"></i></div>\n                </div>`)),""),df.dom.setText(this.components.eChip,this.aGroups.length),df.dom.setText(this.components.eSubGroupBtn,this.aGroups.length>0?"+ Add sub group":"+ Add group"),this.onSizeChanged.fire(this)}onFieldsClick(e){const t=e.getTarget().closest(".WebGrpSel_Action")?.dataset.action||null,i=e.getTarget().closest(".WebGrpSel_Group")?.dataset.group||null;if(null!=t&&null!=i&&this.aGroups[i])switch(t){case"remove":this.aGroups.splice(i,1),this.renderGroups(),this.fireGroupsChanged();break;case"switchsort":this.aGroups[i].bReverse=!this.aGroups[i].bReverse,this.renderGroups(),this.fireGroupsChanged()}}onFieldsChange(e){const t=e.getTarget().closest(".WebGrpSel_GroupSelect")?.value||null,i=e.getTarget().closest(".WebGrpSel_Group")?.dataset.group||null;if(null==t||null==i||!this.aGroups[i])return;const s=this.columnIndexById(t);-1!=s&&(this.aGroups[i].iColumnId=this.aColumns[s].iColumnId,this.aGroups[i].sLabel=this.aColumns[s].sLabel,this.renderGroups(),this.fireGroupsChanged())}onFieldsDragStart(e){const t=e.getTarget().closest(".WebGrpSel_Group")||null,i=t?.dataset.group||null;t&&null!=i&&this.aGroups[i]&&(e.e.dataTransfer.dropEffect="move",e.e.dataTransfer.effectAllowed="move",this.eDragGroup=t,t.classList.add("Web_Drag"))}onFieldsDragOver(e){const t=e.getTarget().closest(".WebGrpSel_Group")||null;this.eDragGroup&&null!=t&&(e.e.preventDefault(),e.stopPropagation(),e.e.dataTransfer.dropEffect="move",df.dom.isBefore(this.eDragGroup,t)?this.components.eFieldsSelected.insertBefore(this.eDragGroup,t):this.components.eFieldsSelected.insertBefore(this.eDragGroup,t.nextSibling))}onFieldsDragEnd(e){this.eDragGroup&&(e.e.preventDefault(),e.stopPropagation(),this.finishDrag())}onFieldsDragEnter(e){if(!this.eDragGroup)return;e.e.preventDefault(),e.stopPropagation();e.e.dataTransfer.dropEffect="move"}onFieldsDragDrop(e){this.eDragGroup&&(e.e.preventDefault(),e.stopPropagation(),this.finishDrag())}onFieldsDragLeave(e){this.eDragGroup&&(e.e.preventDefault(),e.stopPropagation())}finishDrag(){const e=this.eDragGroup?.dataset.group||null,t=this.eDragGroup?.nextElementSibling?.dataset.group||null;if(this.eDragGroup=null,null==e||!this.aGroups[e]||null!=t&&!this.aGroups[t])return;const i=this.aGroups[e];this.aGroups.splice(e,1),null!=t?this.aGroups.splice(t,0,i):this.aGroups.push(i),this.renderGroups(),this.fireGroupsChanged()}fireGroupsChanged(){this.onGroupsChanged.fire(this,{aGroups:this.aGroups})}}class Ge extends f{constructor(e,t){if(super(e,t),!(t&&t instanceof Ue))throw new r.Error(999,"WebCard object '{{0}}' should be placed inside a WebCardContainer object. Consider wrapping your card with a card container.",this,[this.getLongName()]);this.prop(r.tString,"psCaption",""),this.prop(r.tString,"psBtnCSSClass",""),this.event("OnShow",r.cCallModeDefault),this.event("OnHide",r.cCallModeDefault),this._eBtn=null,this._eLbl=null,this._bCurrent=!1,this._bCC=!0,this._sControlClass="WebCard",this._bWrapDiv=!0}tabButtonHtml(e){e.push('<div class="WebTab_Btn ',this.isEnabled()?r.CssEnabled:r.CssDisabled," ",this.psBtnCSSClass,'" style="',this.pbRender&&this.pbVisible?"":"display: none;",'" ',this.isEnabled()?'tabindex="0"':'tabindex="-1"',"><span><label>",r.dom.encodeHtml(this.psCaption),"</label></span></div>")}afterRender(){super.afterRender(),this._eElem.style.display=""}btnRendered(e){this._eBtn=e,this._eLbl=r.dom.query(this._eBtn,"span > label"),r.dom.on("click",this._eBtn,this.onBtnClick,this),r.dom.on("click",this._eLbl,this.onBtnClick,this),r.events.addDomKeyListener(this._eBtn,this.onBtnKey,this)}attachFocusEvents(){window.addEventListener?(r.events.addDomCaptureListener("focus",this._eBtn,this.onBtnFocus,this),r.events.addDomCaptureListener("blur",this._eBtn,this.onBtnBlur,this)):(r.dom.on("focusin",this._eBtn,this.onBtnFocus,this),r.dom.on("focusout",this._eBtn,this.onBtnBlur,this))}prepareSize(){const e=super.prepareSize();return this._bStretch=!0,e}onBtnClick(e){this.isEnabled()&&(this.show(),e.stop())}onBtnKey(e){this.isEnabled()&&e.matchKey(r.settings.tabKeys.enter)&&(this.show(),e.stop())}onBtnFocus(e){r.dom.addClass(this._eBtn,"WebTab_Focus")}onBtnBlur(e){r.dom.removeClass(this._eBtn,"WebTab_Focus")}_hide(e){this._eElem&&(this._eElem.style.visibility="hidden",r.dom.removeClass(this._eBtn,"WebTab_Current")),!e&&this._bCurrent&&this.fire("OnHide"),this._bCurrent=!1}_show(e){this._eElem?this._eElem.parentNode.firstChild&&this._eElem!==this._eElem.parentNode.firstChild&&this._eElem.parentNode.insertBefore(this._eElem,this._eElem.parentNode.firstChild):this.renderCard(!0),this._eElem.style.visibility="inherit",r.dom.addClass(this._eBtn,"WebTab_Current"),e||this._bCurrent||this.fire("OnShow"),this._bCurrent=!0}renderCard(e){const t=this.render();e&&this._oParent._eControl.firstChild?this._oParent._eControl.insertBefore(t,this._oParent._eControl.firstChild):this._oParent._eControl.appendChild(t),this.afterRender(),this.resizeHorizontal(),this.resizeVertical()}show(){this.isActive()&&this._oParent.showCard(this)}applyEnabled(e){super.applyEnabled(e),this._eBtn&&(r.dom.toggleClass(this._eBtn,r.CssDisabled,!e),r.dom.toggleClass(this._eBtn,r.CssEnabled,e),r.dom.setTabIndex(this._eLbl,e?0:-1))}makeVisible(){this.show(),super.makeVisible()}set_psCaption(e){this._eLbl&&(this._oParent._oCurrent===this&&this._oParent._eLabel&&r.dom.setText(this._oParent._eLabel,e),r.dom.setText(this._eLbl,e))}set_pbVisible(e){this._eBtn&&(this._eBtn.style.display=e&&this.pbRender?"":"none",this.pbVisible=e,this.getWebApp().waitForCall((function(){e?this._oParent._oCurrent||this._oParent.showCard(this):this._bCurrent&&this._oParent.hideCard(this),this.getWebApp().forceResize()}),this))}set_pbRender(e){this._eBtn&&(this._eBtn.style.display=e&&this.pbVisible?"":"none",this.pbRender!==e&&(this.pbRender=e,this.getWebApp().waitForCall((function(){e?this._oParent._oCurrent||this._oParent.showCard(this):this._bCurrent&&this._oParent.hideCard(this),this.getWebApp().forceResize()}),this)))}set_psTextColor(e){this._eLbl&&(this._eLbl.style.color=e||""),super.set_psTextColor(e)}set_psBackgroundColor(e){this._eBtn&&(this._eBtn.style.background=e||""),super.set_psBackgroundColor(e)}set_psBtnCSSClass(e){this._eBtn&&this.psBtnCSSClass!==e&&(r.dom.removeClass(this._eBtn,this.psBtnCSSClass),r.dom.addClass(this._eBtn,e))}}class Ue extends b{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowBorder",!1),this.prop(r.tBool,"pbShowCaption",!1),this.prop(r.tBool,"pbSwipeCards",!1),this.prop(r.tString,"psCurrentCard",""),this.addSync("psCurrentCard"),this.event("OnCardChange",r.cCallModeWait),this._iHeightSet=null,this._aCards=[],this._eHead=null,this._oCurrent=null,this._bRendered=!1,this._bCC=!0,this._bWrapDiv=!0,this._bRenderChildren=!0,this._sControlClass="WebCardContainer",this._sCardClass="WebCC"}openHtml(e){super.openHtml(e),this.headHtml(e),e.push('<div class="',this._sCardClass,'_Body">')}headHtml(e){e.push('<div class="',this._sCardClass,'_Head">');for(let t=0;t<this._aCards.length;t++)this._aCards[t].tabButtonHtml(e);e.push('<div style="clear: both"></div></div>')}closeHtml(e){e.push("</div>"),e.push('<label class="',this._sCardClass,'_Caption"></label>'),super.closeHtml(e)}afterRender(){this._eBody=r.dom.query(this._eElem,"div."+this._sCardClass+"_Body"),this._eHead=r.dom.query(this._eElem,"div."+this._sCardClass+"_Head"),this._eLabel=r.dom.query(this._eElem,"label."+this._sCardClass+"_Caption");const e=r.dom.query(this._eElem,"div."+this._sCardClass+"_Head > div.WebTab_Btn",!0);for(let t=0;t<this._aCards.length;t++)t<e.length&&this._aCards[t].btnRendered(e[t]);super.afterRender(),this.pbSwipeCards&&this.set_pbSwipeCards(!0),this.showCard(this._oCurrent,!0),this._bRendered=!0}set_pbSwipeCards(e){this._eBody&&(e?window.PointerEvent?r.dom.on("pointerdown",this._eBody,this.onPointerDown,this):r.dom.on("touchstart",this._eBody,this.onTouchStart,this):window.PointerEvent?r.dom.off("pointerdown",this._eBody,this.onPointerDown,this):r.dom.off("touchstart",this._eBody,this.onTouchStart,this),r.dom.toggleClass(this._eBody,"WebCC_Swipable",e))}onTouchStart(e){1===e.e.targetTouches.length&&this.touchSwipe(!1,e)}onPointerDown(e){"pen"!==e.e.pointerType&&"touch"!==e.e.pointerType||this.touchSwipe(!0,e)}touchSwipe(e,t){let i,s,o,n,a,l,h=null,d=!1,p=!1,u=-1,c=null,g=null,_=this._oCurrent,m=null,b=null,C=null;for(let e=0;e<this._aCards.length;e++)if(this._aCards[e]===_&&(u=e),this._aCards[e].isActive())if(u<0)c=this._aCards[e];else if(!g&&u!==e){g=this._aCards[e];break}function f(t){let h;i=e?t.e.clientY:t.e.targetTouches[0].pageY,l=e?t.e.clientX:t.e.targetTouches[0].pageX,(p&&d||!p&&Math.abs(a-l)>Math.abs(s-i))&&(d=!0,n=l-a,m||(m=_._eElem,r.dom.addClass(m,"WebC_Swipe"),o=m.offsetWidth),n>0?(n=Math.min(o,n),c?(C||(b&&(r.dom.translateX(b,null,!1),r.dom.removeClass(b,"WebC_SwipeBelow"),b=null),c._eElem||c.renderCard(!1),C=c._eElem,r.dom.addClass(C,"WebC_SwipeBelow")),h=-.3*o+.3*n,r.dom.translateX(C,h,!1),r.dom.translateX(m,n,!1)):(n*=.17,r.dom.translateX(m,n,!1))):(n=Math.max(-o,n),g?(b||(C&&(r.dom.translateX(C,null,!1),r.dom.removeClass(C,"WebC_SwipeBelow"),C=null),g._eElem||g.renderCard(!1),b=g._eElem,r.dom.addClass(b,"WebC_SwipeBelow")),h=.3*o+.3*n,r.dom.translateX(b,h,!1),r.dom.translateX(m,n,!1)):(n*=.17,r.dom.translateX(m,n,!1))),t.stop())}function w(){h&&this.showCard(h,!1),C&&(r.dom.translateX(C,null,!1),r.dom.removeClass(C,"WebC_SwipeBelow")),b&&(r.dom.translateX(b,null,!1),r.dom.removeClass(b,"WebC_SwipeBelow")),m&&(r.dom.translateX(m,null,!1),r.dom.removeClass(m,"WebC_Swipe WebC_SwipeLeaving"))}function S(t){n>0?c&&C?n>.4*o?(h=c,n<o?(r.dom.transition(C,"all 200ms",w,this),r.dom.translateX(C,0,!1),r.dom.transition(m,"all 200ms"),r.dom.translateX(m,o,!1),r.dom.addClass(m,"WebC_SwipeLeaving")):w.call(this)):n<o?(r.dom.transition(C,"all 200ms",w,this),r.dom.translateX(C,.3*o,!1),r.dom.transition(m,"all 200ms"),r.dom.translateX(m,0,!1)):w.call(this):0!==n&&m&&r.dom.translateX(m,0,!1):g&&b?-n>.4*o?(h=g,-n<o?(r.dom.transition(b,"all 200ms",w,this),r.dom.translateX(b,0,!1),r.dom.transition(m,"all 200ms"),r.dom.translateX(m,-o,!1),r.dom.addClass(m,"WebC_SwipeLeaving")):w.call(this)):-n<o?(r.dom.transition(b,"all 200ms",w,this),r.dom.translateX(b,-.3*o,!1),r.dom.transition(m,"all 200ms"),r.dom.translateX(m,0,!1)):w.call(this):0!==n&&m&&(r.dom.transition(m,"all 100ms",w,this),r.dom.translateX(m,0,!1)),e?(r.dom.off("pointerup",window,S,this),r.dom.off("pointercancel",window,S,this),r.dom.off("pointermove",window,f,this)):(r.dom.off("touchend",window,S,this),r.dom.off("touchcancel",window,S,this),r.dom.off("touchmove",window,f,this))}this.pbSwipeCards&&_&&(g||c)&&(a=l=e?t.e.clientX:t.e.targetTouches[0].pageX,s=i=e?t.e.clientY:t.e.targetTouches[0].pageY,e?(r.dom.on("pointerup",window,S,this),r.dom.on("pointercancel",window,S,this),r.dom.on("pointermove",window,f,this)):(r.dom.on("touchend",window,S,this),r.dom.on("touchcancel",window,S,this),r.dom.on("touchmove",window,f,this)),setTimeout((function(){p=!0}),300))}renderChildren(e){let t;this.psCurrentCard&&(this._oCurrent=this.getWebApp().findObj(this.psCurrentCard));for(let e=0;e<this._aCards.length&&!this._oCurrent;e++)this._aCards[e].isActive()&&(this._oCurrent=this._aCards[e]);if(e=this._eControl=r.dom.query(this._eElem,"div."+this._sCardClass+"_Body"),this.hasDynamicHeight())for(let i=0;i<this._aChildren.length;i++){const s=this._aChildren[i];s instanceof m&&(t=s.render(),t&&e.appendChild(t))}else this._oCurrent&&(t=this._oCurrent.render(),t&&e.appendChild(t))}afterRenderChildren(){this.hasDynamicHeight()?super.afterRenderChildren():this._oCurrent&&this._oCurrent.afterRender()}hasDynamicHeight(){return!this.pbFillHeight&&this.piHeight<=0}addChild(e){if(e instanceof Ge)this._aCards.push(e);else if(e instanceof m)throw new r.Error(999,"WebCardContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebCard.",this,[e.getLongName()||"oWebApp"]);super.addChild(e)}afterShow(){this._bShown=!0,this._oCurrent&&this._oCurrent.afterShow()}afterHide(){this._bShown=!1,this._oCurrent&&this._oCurrent.afterHide()}getNaturalHeight(){let e=0;for(let t=0;t<this._aCards.length;t++)if(this._aCards[t].pbRender&&this._aCards[t]._eElem){const i=this._aCards[t].getRequiredHeight();i>e&&(e=i)}return e+=this.getHeightDiff(),e}sizeHeight(e){let t=-1;if(t=this.pbFillHeight?e:this.piHeight>0?this.piHeight:this.getNaturalHeight(),t<this.piMinHeight&&(t=this.piMinHeight),this.setHeight(t),this.resizeCards(),t>0)return t}getVertHeightDiff(){let e=0;return this.peLabelPosition===r.ciLabelTop&&this._eLbl&&(e+=this._eLbl.offsetHeight),e+=this.getHeightDiff(),e}resize(){this._eElem&&this._bRendered&&(this.pbFillHeight?this.resizeCards():this.sizeHeight(-1))}resizeCards(){for(let e=0;e<this._aCards.length;e++)this._aCards[e]._eElem&&(this._aCards[e].resizeHorizontal(),this._aCards[e].resizeVertical())}getHeightDiff(){let e=0;return this.pbShowCaption&&this._eHead&&(e+=r.sys.gui.getVertBoxDiff(this._eHead,1)),this._eControl&&(e+=r.sys.gui.getVertBoxDiff(this._eControl),e+=r.sys.gui.getVertBoxDiff(this._eInner),e+=r.sys.gui.getVertBoxDiff(this._eControlWrp)),e}getMinHeight(){let e=0;return this.pbFillHeight?this.piMinHeight:this.piHeight>0?Math.max(this.piHeight,this.piMinHeight):(this.resize(),e=this.getNaturalHeight(),e<this.piMinHeight&&(e=this.piMinHeight),e)}renderAllCards(){if(this._eControl)for(let e=0;e<this._aCards.length;e++)if(!this._aCards[e]._eElem){const t=this._aCards[e].render();this._eControl.appendChild(t),this._aCards[e].afterRender()}}set_piHeight(e){e<=0&&this.renderAllCards(),super.set_piHeight(e)}set_pbFillHeight(e){e||this.renderAllCards(),super.set_pbFillHeight(e)}attachFocusEvents(){this._eHead&&(window.addEventListener?(r.events.addDomCaptureListener("focus",this._eHead,this.onFocus,this),r.events.addDomCaptureListener("blur",this._eHead,this.onBlur,this)):(r.dom.on("focusin",this._eHead,this.onFocus,this),r.dom.on("focusout",this._eHead,this.onBlur,this)))}focus(e){for(let t=0;t<this._aChildren.length;t++)if(this._aChildren[t].focus&&this._aChildren[t].focus(e))return!0;return!1}conditionalFocus(e){for(let t=0;t<this._aChildren.length;t++)if(this._aChildren[t].conditionalFocus&&this._aChildren[t].conditionalFocus(e))return!0;return!1}onFocus(e){this._bHasFocus||super.onFocus(e),this._bLozingFocus=!1}onBlur(e){const t=this,i=super.onBlur;this._bLozingFocus=!0,setTimeout((function(){t._bLozingFocus&&(i.call(t,e),t._bLozingFocus=!1)}),100)}showCard(e,t){if((this.isEnabled()||t)&&e&&e.isActive()){if(t||e===this._oCurrent||this.fireCardChange(e._sName,this._oCurrent&&this._oCurrent._sName||""),this._eElem)for(let i=0;i<this._aCards.length;i++){const s=this._aCards[i];s===e?(s._show(!!t),this._eLabel&&r.dom.setText(this._eLabel,s.psCaption)):s._hide(!!t)}!t&&this._oCurrent&&this._oCurrent.afterHide(),this._oCurrent=e,t||this._oCurrent.afterShow(),this.getWebApp()&&this.getWebApp().notifyLayoutChange(this)}}fireCardChange(e,t){this.fire("OnCardChange",[e,t])}hideCard(e){let t=null,i=!1;if(e===this._oCurrent){for(let s=0;s<this._aCards.length;s++){const o=this._aCards[s];if(o.isActive()){if(i)return void this.showCard(o);t=o}o===e&&(i=!0)}this.showCard(t)}}nextCard(){let e=!1;for(let t=0;t<this._aCards.length;t++){const i=this._aCards[t];if(e){if(i.isActive())return void this.showCard(i)}else e=i===this._oCurrent}}previousCard(){let e=!1;for(let t=this._aCards.length-1;t>=0;t--){const i=this._aCards[t];if(e){if(i.isActive())return void this.showCard(i)}else e=i===this._oCurrent}}get_psCurrentCard(){return this._oCurrent&&this._oCurrent.getLongName()||""}genClass(){let e=super.genClass();return this.pbShowCaption&&(e+=" WebCC_HasCaption"),this.pbShowBorder&&(e+=" WebCC_HasBorder"),e}set_pbShowBorder(e){this._eElem&&(r.dom.toggleClass(this._eElem,"WebCC_HasBorder",e),this.sizeChanged())}set_pbShowCaption(e){this._eElem&&(r.dom.toggleClass(this._eElem,"WebCC_HasCaption",e),this.sizeChanged())}set_psBackgroundColor(e){this._eLabel&&(this._eLabel.style.background=e||""),this._eControl&&(this._eControl.style.background=e||"")}}class Ke extends Ge{constructor(e,t){super(e,t),this._sControlClass="WebTabPage",this._bCC=!0}}r.tWebTreeItem={sId:r.tString,sParentId:r.tString,sName:r.tString,sAltText:r.tString,sValue:r.tString,sCSSClass:r.tString,sIcon:r.tString,bFolder:r.tBool,bLoadChildren:r.tBool,bExpanded:r.tBool};r.ciUploadStateEmpty=0,r.ciUploadStateDisplay=1,r.ciUploadStateSelected=2,r.ciUploadStateUploading=3,r.ciUploadStateFinished=4;class je extends(C(b)){}r.WebGroupBase=je;class qe extends je{constructor(e,t){super(e,t),this.prop(r.tString,"psCaption",""),this.prop(r.tBool,"pbShowBorder",!0),this.prop(r.tBool,"pbShowCaption",!0),this.prop(r.tBool,"pbCollapsible",!1),this.prop(r.tBool,"pbExpanded",!0),this.event("OnExpand",r.cCallModeDefault),this.event("OnCollapse",r.cCallModeDefault),this._eCaption=null,this._sBaseClass="WebControl",this._sControlClass="WebGroup"}wrpOpenHtml(e){e.push('<div class="WebContainer">')}wrpCloseHtml(e){e.push("</div>"),e.push('<label class="WebGrp_Caption">',r.dom.encodeHtml(this.psCaption),"</label>"),e.push('<div class="WebGrp_ExpandBtn"></div>')}getRef(){super.getRef(),this._eCaption=r.dom.query(this._eElem,"label.WebGrp_Caption"),this._eControl=r.dom.query(this._eElem,"div.WebCon_Inner > div"),this._eExpandBtn=r.dom.query(this._eElem,"div.WebGrp_ExpandBtn")}afterRender(){super.afterRender(),r.dom.on("click",this._eExpandBtn,this.onExpandClick,this),r.dom.on("transitionend",this._eElem,this.onTransEnd,this),this._eContent&&r.dom.on("transitionend",this._eContent,this.onTransEndCancel,this)}genClass(){let e=super.genClass();return this.pbShowCaption&&(e+=" WebGrp_HasCaption"),this.pbShowBorder&&(e+=" WebGrp_HasBorder"),this.pbCollapsible&&(e+=" WebGrp_Collapsible "+(this.pbExpanded?"WebGrp_Expanded":"WebGrp_Collapsed")),e}set_psCaption(e){this._eCaption&&(r.dom.setText(this._eCaption,e),this.sizeChanged())}set_pbShowCaption(e){this._eElem&&(r.dom.toggleClass(this._eElem,"WebGrp_HasCaption",e),this.sizeChanged())}set_pbShowBorder(e){this._eElem&&(r.dom.toggleClass(this._eElem,"WebGrp_HasBorder",e),this.sizeChanged())}set_pbCollapsible(e){this._eElem&&(r.dom.toggleClass(this._eElem,"WebGrp_Collapsible",e),e?r.dom.addClass(this._eElem,this.pbExpanded?"WebGrp_Expanded":"WebGrp_Collapsed"):r.dom.removeClass(this._eElem,"WebGrp_Expanded WebGrp_Collapsed"))}set_pbExpanded(e){this._eElem&&this.pbCollapsible&&this.pbExpanded!==e&&(e?(r.dom.addClass(this._eElem,"WebGrp_Expanded"),r.dom.removeClass(this._eElem,"WebGrp_Collapsed"),this.fire("OnExpand")):(r.dom.addClass(this._eElem,"WebGrp_Collapsed"),r.dom.removeClass(this._eElem,"WebGrp_Expanded"),this.fire("OnCollapse")),this.sizeChanged(!0))}onExpandClick(e){this.isEnabled()&&this.set("pbExpanded",!this.pbExpanded)}onTransEnd(e){this.sizeChanged(!0)}onTransEndCancel(e){e.stopPropagation()}getMinHeight(){let e=0;return this.resize(),e=this.pbScroll?this.pbFillHeight?this.piMinHeight:Math.max(this.piHeight,this.piMinHeight):this.getRequiredHeight(),this._eControl&&(e+=r.sys.gui.getVertBoxDiff(this._eControl),e+=r.sys.gui.getVertBoxDiff(this._eInner),e+=r.sys.gui.getVertBoxDiff(this._eControlWrp)),e<this.piMinHeight&&(e=this.piMinHeight),e}setHeight(e,t){this._eControl&&(e>0?(e=(e-=this.getVertHeightDiff())<0?0:e,this._eContainer.style.height=e+"px"):this._eContainer.style.height="")}getVertHeightDiff(){let e=super.getVertHeightDiff();return e+=r.sys.gui.getVertBoxDiff(this._eContainer,3),e}getHeightDiff(e,t,i,s){let o=super.getHeightDiff(e,t,i,s);return e&&(o+=this.getVertHeightDiff()),o}set_psBackgroundColor(e){this._eContainer&&(this._eContainer.style.background=e||""),this._eCaption&&(this._eCaption.style.background=e||"")}onFocus(e){}onBlur(e){}}r.tWebBreadcrumbItem={sViewName:r.tString,sCrumbCaption:r.tString,sHeadCaption:r.tString};r.colorFormatHex=1,r.colorFormatRGB=2,r.settings.colorPickKeys={colorUp:{iKeyCode:38,bCtrl:!1,bShift:!1,bAlt:!1},colorDown:{iKeyCode:40,bCtrl:!1,bShift:!1,bAlt:!1},colorLeft:{iKeyCode:37,bCtrl:!1,bShift:!1,bAlt:!1},colorRight:{iKeyCode:39,bCtrl:!1,bShift:!1,bAlt:!1},sliderUp:{iKeyCode:33,bCtrl:!1,bShift:!1,bAlt:!1},sliderDown:{iKeyCode:34,bCtrl:!1,bShift:!1,bAlt:!1},enter:{iKeyCode:13,bCtrl:!1,bShift:!1,bAlt:!1}},r.tWebColorPaletteItem={sColor:r.tString,sDescription:r.tString};class Ze extends b{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowColorBar",!0),this.prop(r.tInt,"peColorFormat",r.colorFormatHex),this.prop(r.tInt,"piPaletteItemsPerRow",6),this.prop(r.tString,"psValue","#A53D40"),this.addSync("psValue"),this.event("OnChange"),this.OnRealtimeChange=new r.events.JSHandler,this.OnEnter=new r.events.JSHandler,this._tDoubleClick=null,this._iDoubleClickWait=800,this._aHSV=[0,0,0],this._aColorPalette=[],this._sControlClass="WebColorPicker"}create(e){super.create(),this.set_psValue(this.psValue)}openHtml(e){const t=["WebCP_Main"];super.openHtml(e),this.pbShowColorBar&&t.push("WebCP_ShowColorBar"),this._aColorPalette.length>0&&t.push("WebCP_ShowPalette"),e.push('<div class="',t.join(" "),'" tabindex="0">','<div class="WebCP_ColorPalette">'),this.genColorPaletteHtml(e),e.push("</div>",'<div class="WebCP_Picker">','<div class="WebCP_ColorMap">','<canvas width="0" height="0"></canvas>','<div class="WebCP_Pointer"></div>',"</div>",'<div class="WebCP_GradSlider">','<canvas width="0" height="0"></canvas>','<div class="WebCP_Slide"></div>',"</div>","</div>",'<div class="WebCP_ColorBar"></div>',"<div>")}closeHtml(e){super.closeHtml(e)}afterRender(){this._eFocus=this._eControl=r.dom.query(this._eElem,".WebCP_Main"),this._ePicker=r.dom.query(this._eElem,".WebCP_Picker"),this._eColorPalette=r.dom.query(this._eElem,".WebCP_ColorPalette"),this._eColorMap=r.dom.query(this._eElem,".WebCP_ColorMap"),this._eMapCanvas=r.dom.query(this._eElem,".WebCP_ColorMap canvas"),this._ePointer=r.dom.query(this._eElem,".WebCP_Pointer"),this._eGradSlider=r.dom.query(this._eElem,".WebCP_GradSlider"),this._eSliderCanvas=r.dom.query(this._eElem,".WebCP_GradSlider canvas"),this._eSlide=r.dom.query(this._eElem,".WebCP_Slide"),this._eColorBar=r.dom.query(this._eElem,".WebCP_ColorBar"),super.afterRender(),r.dom.on("mousedown",this._eColorMap,this.startMapMouse,this),r.dom.on("mousedown",this._eGradSlider,this.startSliderMouse,this),r.dom.on("click",this._eColorPalette,this.onPaletteClick,this),r.dom.on("dblclick",this._eColorPalette,this.onPaletteDblClick,this),r.events.addDomKeyListener(this._eFocus,this.onKey,this),r.events.addDomMouseWheelListener(this._eFocus,this.onMouseWheelScroll,this),this._eColorBar.style.backgroundColor=this.psValue,r.dom.setText(this._eColorBar,this.psValue)}resize(){let e=0;this._aColorPalette.length>0&&(e+=this._eColorPalette.offsetHeight),this._ePicker.style.top=e+"px",super.resize(),this._eControl.clientHeight&&(this._eMapCanvas.width===this._eColorMap.clientWidth&&this._eMapCanvas.height===this._eColorMap.clientHeight||(this.drawColorMap(),this.positionPointer()),this._eSliderCanvas.width===this._eGradSlider.clientWidth&&this._eSliderCanvas.height===this._eGradSlider.clientHeight||this.drawGradientSlider())}drawColorMap(){const e=this._eMapCanvas;e.width=this._eColorMap.clientWidth,e.height=this._eColorMap.clientHeight,this._mainctx||(this._mainctx=e.getContext("2d"));const t=this._mainctx;t.clearRect(0,0,e.width,e.height);const i=t.createLinearGradient(0,0,e.width,0);i.addColorStop(0,"#F00"),i.addColorStop(1/6,"#FF0"),i.addColorStop(2/6,"#0F0"),i.addColorStop(.5,"#0FF"),i.addColorStop(4/6,"#00F"),i.addColorStop(5/6,"#F0F"),i.addColorStop(1,"#F00"),t.fillStyle=i,t.fillRect(0,0,e.width,e.height);const s=t.createLinearGradient(0,0,0,e.height);s.addColorStop(0,"rgba(255,255,255,0)"),s.addColorStop(1,"rgba(255,255,255,1)"),t.fillStyle=s,t.fillRect(0,0,e.width,e.height)}positionPointer(){let e=0,t=0;const i=this.getHSV();e=i[0]*this._eMapCanvas.width,t=(1-i[1])*this._eMapCanvas.height,e-=this._ePointer.offsetWidth/2,t-=this._ePointer.offsetHeight/2,this._ePointer.style.left=Math.round(e)+"px",this._ePointer.style.top=Math.round(t)+"px"}drawGradientSlider(){const e=this._eSliderCanvas;e.width=this._eGradSlider.clientWidth,e.height=this._eGradSlider.clientHeight,this._sliderctx||(this._sliderctx=e.getContext("2d"));const t=this._sliderctx;t.clearRect(0,0,e.width,e.height);const i=this.getHSV();i[2]=1;const s=this.HSVtoRGB(i),o=t.createLinearGradient(0,0,0,e.height);o.addColorStop(0,this.RGBtoHexString(s)),o.addColorStop(1,"#000000"),t.fillStyle=o,t.fillRect(0,0,e.width,e.height),this.positionSlider()}positionSlider(){let e=0;e=(1-this.getHSV()[2])*this._eSliderCanvas.height,e-=Math.round(this._eSlide.offsetHeight/2),this._eSlide.style.top=e+"px"}addPaletteItem(e,t){const i=[];this._aColorPalette.push({sColor:e,sDescription:t}),this._eElem&&(this.genColorPaletteHtml(i),this._eColorPalette.innerHTML=i.join(""),this.sizeChanged())}updatePalette(){const e=[];this._aColorPalette=this.deserializeVT(this._tActionData),this._eElem&&(this.genColorPaletteHtml(e),this._eColorPalette.innerHTML=e.join(""),r.dom.toggleClass(this._eControl,"WebCP_ShowPalette",this._aColorPalette.length>0),this.sizeChanged())}genColorPaletteHtml(e){const t=this._aColorPalette;if(t.length>0){e.push('<table class="WebCP_Palette"><colgroup>');for(let t=0;t<this.piPaletteItemsPerRow;t++)e.push('<col style="width: ',Math.floor(1e3/this.piPaletteItemsPerRow)/10,'%">');e.push("</colgroup><tr>");for(let i=0;i<t.length;i++){const s=this.RGBtoHexString(this.stringToRGB(t[i].sColor));i%this.piPaletteItemsPerRow==0&&i>0&&e.push("</tr><tr>"),e.push('<td class="WebCP_PalColor" style="background-color: ',s,'" data-palcolor="',s,'" title="',t[i].sDescription,'"></td>')}e.push("</tr></table>")}}onPaletteClick(e){let t=e.getTarget();const i=this.psValue;if(this.isEnabled())for(;t&&t!==this._eColorPalette;){if(t.hasAttribute("data-palcolor")){const e=this.RGBtoHSV(this.stringToRGB(t.getAttribute("data-palcolor")));return this.setHSV(e),void this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:i})}t=t.parentNode}}onPaletteDblClick(e){let t=e.getTarget();if(this.isEnabled())for(;t&&t!==this._eColorPalette;){if(t.hasAttribute("data-palcolor")){const i=this.RGBtoHSV(this.stringToRGB(t.getAttribute("data-palcolor")));return this.setHSV(i),this.OnEnter.fire(this,{sColor:this.psValue}),void e.stop()}t=t.parentNode}}startMapMouse(e){let t,i;const s=this.getHSV(),o=this;if(!this.isEnabled())return;if(this._tDoubleClick)return this.OnEnter.fire(this,{sColor:this.psValue}),clearTimeout(this._tDoubleClick),this._tDoubleClick=null,void e.stop();this._tDoubleClick=setTimeout((function(){o._tDoubleClick=null}),this._iDoubleClickWait);const n=r.gui.dragMask(this.topLayer()||document.body);n.style.cursor="crosshair";const a=r.sys.gui.getBoundRect(this._eMapCanvas);function l(){const e=this.psValue;s[0]=t/a.width,s[1]=1-i/a.height,this.setHSV(s,!0),this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:e})}function h(e){t=Math.min(Math.max(e.getMouseX()-a.left,0),a.width),i=Math.min(Math.max(e.getMouseY()-a.top,0),a.height),l.call(this)}function d(e){this.fire("OnChange",[this.psValue]),this.focus(),r.dom.off("mouseup",n,d,this),r.dom.off("mouseup",window,d,this),r.dom.off("mousemove",n,h,this),n&&n.parentNode&&n.parentNode.removeChild(n)}t=e.getMouseX()-a.left,i=e.getMouseY()-a.top,r.dom.on("mousemove",n,h,this),r.dom.on("mouseup",window,d,this),r.dom.on("mouseup",n,d,this),e.stop(),l.call(this)}startSliderMouse(e){let t;const i=this.getHSV(),s=this;if(!this.isEnabled())return;if(this._tDoubleClick)return this.OnEnter.fire(this,{sColor:this.psValue}),clearTimeout(this._tDoubleClick),void(this._tDoubleClick=null);this._tDoubleClick=setTimeout((function(){s._tDoubleClick=null}),this._iDoubleClickWait);const o=r.gui.dragMask(this.topLayer()||document.body);o.style.cursor="n-resize";const n=r.sys.gui.getBoundRect(this._eSliderCanvas);function a(){const e=this.psValue;i[2]=1-t/n.height,this.setHSV(i,!1),this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:e})}function l(e){t=Math.min(Math.max(e.getMouseY()-n.top,0),n.height),a.call(this)}function h(e){this.fire("OnChange",[this.psValue]),this.focus(),r.dom.off("mouseup",o,h,this),r.dom.off("mouseup",window,h,this),r.dom.off("mousemove",o,l,this),o&&o.parentNode&&o.parentNode.removeChild(o)}t=e.getMouseY()-n.top,r.dom.on("mousemove",o,l,this),r.dom.on("mouseup",window,h,this),r.dom.on("mouseup",o,h,this),e.stop(),a.call(this)}adjustColor(e,t){const i=this.getHSV(),s=this.psColor;i[e]=Math.max(0,Math.min(1,i[e]+t/20)),this.setHSV(i,2!==e),this.OnRealtimeChange.fire(this,{sColor:this.psValue,sPrevColor:s}),this.fire("OnChange",[this.psValue])}onMouseWheelScroll(e){const t=e.getMouseWheelDelta();this.isEnabled()&&(t>0?this.adjustColor(2,1):t<0&&this.adjustColor(2,-1),e.stop())}onKey(e){this.isEnabled()&&(e.matchKey(r.settings.colorPickKeys.colorUp)?(this.adjustColor(1,1),e.stop()):e.matchKey(r.settings.colorPickKeys.colorDown)?(this.adjustColor(1,-1),e.stop()):e.matchKey(r.settings.colorPickKeys.colorLeft)?(this.adjustColor(0,-1),e.stop()):e.matchKey(r.settings.colorPickKeys.colorRight)?(this.adjustColor(0,1),e.stop()):e.matchKey(r.settings.colorPickKeys.sliderUp)?(this.adjustColor(2,1),e.stop()):e.matchKey(r.settings.colorPickKeys.sliderDown)?(this.adjustColor(2,-1),e.stop()):e.matchKey(r.settings.colorPickKeys.enter)&&this.OnEnter.fire(this,{sColor:this.psValue}))}set_psValue(e){const t=this.stringToRGB(e),i=this.RGBtoHSV(t);this._aHSV[0]===i[0]&&this._aHSV[1]===i[1]&&this._aHSV[2]===i[2]||this.setHSV(i,!0)}set_pbShowColorBar(e){this._eColorBar&&(r.dom.toggleClass(this._eControl,"WebCP_ShowColorBar",e),this.drawColorMap(),this.drawGradientSlider())}getHSV(){return this._aHSV.slice()}setHSV(e,t){this._aHSV=e;const i=this.HSVtoRGB(e);this.peColorFormat===r.colorFormatHex?this.psValue=this.RGBtoHexString(i):this.psValue=this.RGBtoRgbString(i),this._eControl&&(this._eColorBar&&(this._eColorBar.style.backgroundColor=this.psValue,r.dom.setText(this._eColorBar,this.psValue)),this.positionPointer(),t?this.drawGradientSlider():this.positionSlider())}RGBtoHSV(e){let t;const i=e[0]/255,s=e[1]/255,o=e[2]/255,n=Math.max(i,s,o),r=Math.min(i,s,o),a=n,l=n-r,h=0===n?0:l/n;if(n===r)t=0;else{switch(n){case i:t=(s-o)/l+(s<o?6:0);break;case s:t=(o-i)/l+2;break;case o:t=(i-s)/l+4}t/=6}return[t,h,a]}HSVtoRGB(e){let t,i,s;const o=e[0],n=e[1],r=e[2],a=Math.floor(6*o),l=6*o-a,h=r*(1-n),d=r*(1-l*n),p=r*(1-(1-l)*n);switch(a%6){case 0:t=r,i=p,s=h;break;case 1:t=d,i=r,s=h;break;case 2:t=h,i=r,s=p;break;case 3:t=h,i=d,s=r;break;case 4:t=p,i=h,s=r;break;case 5:t=r,i=h,s=d}return[Math.round(255*t),Math.round(255*i),Math.round(255*s)]}RGBtoHexString(e){let t="#";for(let i=0;i<e.length;i++)t+=r.sys.math.padZero(Math.round(e[i]).toString(16),2);return t}hexStringToRGB(e){return 7===e.length?[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)]:4===e.length?[parseInt(e.substr(1,1)+e.substr(1,1),16),parseInt(e.substr(2,1)+e.substr(2,1),16),parseInt(e.substr(3,1)+e.substr(3,1),16)]:[0,0,0]}RGBtoRgbString(e){return"rgb("+e.join(",")+")"}rgbStringToRGB(e){";"===(e=e.substr(4)).charAt(e.length-1)&&e.substr(0,e.length-1),")"===e.charAt(e.length-1)&&e.substr(0,e.length-1);const t=e.split(",");if(3===t.length){for(let e=0;e<3;e++)t[e]=Math.max(0,Math.min(255,parseInt(t[e],10)));return t}return[0,0,0]}stringToRGB(e){var t=[0,0,0];return"#"===e.substr(0,1)?t=this.hexStringToRGB(e):"rgb("===e.substr(0,4).toLowerCase()&&(t=this.rgbStringToRGB(e)),t}deserializeVT=r.sys.vt.generateDeserializer([r.tWebColorPaletteItem])}class Ye extends ne{constructor(e,t){super(e,t),this.rRegEx=/{{([a-zA-Z0-9_\-]*)}}/g}rowHtml(e,t,i){const s=this.oL,o=this;t.push(s._sHtmlTemplate.replace(this.rRegEx,(function(t,i){if("dfrowid"==i)return e.sRowId;if("isDraggable"==i)return s.pbDragDropEnabled&&s.isSupportedDragAction(r.dragActions.WebList.ciDragRow)?"true":"false";const n=s._oColMap[i];return n?o.cellHtml(n,e,e.aCells[n._iColIndex]):t})))}}class Je extends Q{tableHtml(e){e.push(this.oL.psHtmlBefore),super.tableHtml(e),e.push(this.oL.psHtmlAfter)}onTableClick(e){const t=this;let i=e.getTarget(),s=null,o=null,n=!0;if(this.oL.isEnabled()&&!this.bCancelClick){for(;i.parentNode&&i!==this.eBody&&!s;)i.hasAttribute("data-ServerOnElemClick")&&(o=i.getAttribute("data-ServerOnElemClick")),i.hasAttribute("data-dfisrow")&&(s=i.getAttribute("data-dfrowid")),i=i.parentNode;o&&(n=this.oL.fire("OnElemClick",[s||"",o])),n&&s&&this.oC.cellClick(e,s,-1)&&(this._bPreventSubmit=!0,setTimeout((function(){t.bPreventSubmit=!1}),250),e.stop())}}refreshCell(e,t){this.refreshDisplay()}refreshRow(e,t){this.refreshDisplay()}}r.tDragDropDataKvPair={sKey:r.tString,sValue:r.tString},r.tGenericDragDropData={aDragData:[r.tDragDropDataKvPair],aDropData:[r.tDragDropDataKvPair]};class Xe extends c{constructor(e,t){super(e,t),this.event("OnHelperReady",r.cCallModeWait),this._aSources=[],this._aTargets=[],this._oDragData=null,this._bInitializedDrag=!1,this._bAcceptAllDrops=!1,this._oDragObj=null}isDropAllowed(){return!0===this._bAcceptAllDrops||this._bInitializedDrag}create(){super.create(),this.fire("OnHelperReady")}registerDragSource(e,t){let i=this.getWebApp().findObj(e),s=!1;if(i&&(i=i.getDragSourceObj()),!i)throw new r.Error(999,"Could not find drag source object '{{0}}'.",this,[e]);for(let e=0;e<this._aSources.length;e++){let o=this._aSources[e];o.oControl==i&&(o.aActions.push(parseInt(t)),s=!0)}if(!s){const e={oControl:i,aActions:[parseInt(t)]};this._aSources.push(e)}i.registerDragSource(this,parseInt(t))}registerDropTarget(e,t){let i=this.getWebApp().findObj(e),s=!1;if(i&&(i=i.getDropTargetObj()),!i)throw new r.Error(999,"Could not find drop target object '{{0}}'.",this,[e]);for(let e=0;e<this._aTargets.length;e++){let o=this._aTargets[e];o.oControl==i&&(o.aActions.push(parseInt(t)),s=!0)}if(!s){const e={oControl:i,aActions:[parseInt(t)]};this._aTargets.push(e)}i.registerDropTarget(this,parseInt(t))}highlightDropZones(){this._aTargets.forEach((e=>{e.oControl.highlightDropZones(this)}))}onDragStart(e,t,i,s,o){if(!s||!this.supportsDragAction(t,o))return!1;this._oDragData={oControl:t,eElem:i,oData:s},this._bInitializedDrag=!0,this.highlightDropZones()}onDragEnd(e){this.isDropAllowed()&&(this.cleanupHelper(),r.dragdrop.stopDropZones())}cleanupHelper(){this._aTargets.forEach((e=>{e.oControl.cleanupDropZones()})),this._oDragData=null,this._bInitializedDrag=!1}serializeDragDropData=r.sys.vt.generateSerializer(r.tGenericDragDropData);onDrop(e,t,i){if(this._oDragData&&i&&this.supportsDropAction(i._oControl,i._eDropAction)&&this.isDropAllowed()){const e=i.getDropData();var s={DragData:this._oDragData?.oData||null,DropData:e};this.serverAction("Drop",[this._oDragData?.oControl?.getLongName()||"",i._oControl.getLongName(),i._eDropPosition],s)}this.onDragEnd(e)}onDragOver(){}destroyDragObj(){this._oDragObj.destroy(),this._oDragObj=null}supportsDragAction(e,t){for(let i=0;i<this._aSources.length;i++){let s=this._aSources[i];if(s.oControl==e)for(let e=0;e<s.aActions.length;e++)if(s.aActions[e]==t)return!0}return!1}supportsDropAction(e,t){for(let i=0;i<this._aTargets.length;i++){let s=this._aTargets[i];if(s.oControl==e)for(let e=0;e<s.aActions.length;e++)if(s.aActions[e]==t)return!0}return!1}}class $e extends(A(Xe)){}r.tGridDef={iRowCount:r.tInt,iColCount:r.tInt,sDefaultRowHeight:r.tString,sDefaultColWidth:r.tString,sRowHeights:r.tString,sColWidths:r.tString},r.tWidgetDef={sName:r.tString,iRowIndex:r.tInt,iColIndex:r.tInt,iRowSpan:r.tInt,iColSpan:r.tInt,bFillHeight:r.tBool,tNameValuePair:[{sName:r.tString,sValue:r.tString}]},r.tContainerDef={GridDef:r.tGridDef,aWidgets:[r.tWidgetDef]};self.df=r,r.ajax.HttpRequest=d,r.ajax.JSONCall=p,r.ServerAction=class{constructor(){this.oWO=null,this.sAction="",this.aParams=[],this.tData={v:"",c:[]},this.aViews=[],this.eCallMode=df.cCallModeDefault,this.sProcessMessage="",this.fHandler=null,this.oHandlerEnv=null,this.sReturnValue=null}},r.ServerCall=class{constructor(){this.aActions=[],this.eCallMode=df.cCallModeDefault,this.sProcessMessage="",this.sFocus="",this.aWaiters=[],this.bSending=!1}},r.InfoBalloon=class{constructor(e,t,i){this.psMessage=i,this.piHideDelay=6e3,this.pbShowOnHover=!0,this.psCSSClass=t,this.poTarget=e,this._eElem=null,this._eEventElem=null,this._eParentRef=null,this._bFirstPos=!0,this._bTopTooltip=!1,this._tHideTimeout=null,this._tPositionInterval=null}update(){this._eElem&&(this._eElem.innerHTML=this.psMessage,this._eElem.className="WebInfoBalloon "+this.psCSSClass,this._eElem.style.bottom="",this._eElem.style.top="",this._eElem.style.left="",this._bTopTooltip=!1,this._bFirstPos=!0,this.position())}init(){const e=this.getTargetElem();if(!this._eElem&&e){this._eElem=df.dom.create('<div class="WebInfoBalloon WebInfoBalloonHidden '+this.psCSSClass+'"></div>'),this._eElem.innerHTML=this.psMessage;(this.poTarget?.topLayer()||document.body).appendChild(this._eElem),this._bTopTooltip=!1,this._bFirstPos=!0,this.position(),this.pbShowOnHover&&(df.dom.on("mouseover",e,this.onMouseOver,this),df.dom.on("mouseout",e,this.onMouseOut,this),this._eEventElem=e)}}destroy(){this._eElem&&this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem),this._eElem=null}show(){this._eElem?this._eElem.parentNode.lastChild!==this._eElem&&this._eElem.parentNode.appendChild(this._eElem):this.init(),this._show(),this.setTimeout()}_show(){const e=this;this._eElem&&(df.dom.addClass(this._eElem,"WebInfoBalloonVisible"),df.dom.removeClass(this._eElem,"WebInfoBalloonHidden"),this._tPositionInterval||(this._tPositionInterval=setInterval((function(){e.position()}),300)))}getTargetElem(){let e=this.poTarget._eElem;return this.poTarget.getTooltipElem&&(e=this.poTarget.getTooltipElem()||e),e}hide(){const e=this._eElem;this._eElem&&(this._hide(),this._eEventElem&&(df.dom.off("mouseover",this._eEventElem,this.onMouseOver,this),df.dom.off("mouseout",this._eEventElem,this.onMouseOut,this),this._eEventElem=null),this._tHideTimeout&&(clearTimeout(this._tHideTimeout),this._tHideTimeout=null),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),3e3),this._eElem=null)}_hide(){this._eElem&&(df.dom.addClass(this._eElem,"WebInfoBalloonHidden"),df.dom.removeClass(this._eElem,"WebInfoBalloonVisible")),this._tPositionInterval&&(clearInterval(this._tPositionInterval),this._tPositionInterval=null)}position(){let e=0,t=0;const i=this.getTargetElem(),s=this._eElem;if(s&&i){const o=df.dom.windowWidth();if(!df.sys.gui.isOnScreen(i))return void(s.style.display="none");s.style.display="";const n=df.sys.gui.getBoundRect(i);e=n.top+n.height,t=n.left+Math.max(Math.round((n.width-70)/2),0);const r=s.clientHeight+df.sys.gui.getVertBoxDiff(s),a=s.clientWidth+df.sys.gui.getHorizBoxDiff(s),l=e+i.offsetHeight;this._bFirstPos&&(screen.height<e+r&&screen.height>l+r&&(this._bTopTooltip=!0,df.dom.addClass(this._eElem,"WebInfoBalloon_Top")),this._bFirstPos=!1),o<t+a&&(t=Math.max(n.left-10,0)),this._bTopTooltip?s.style.bottom=l+"px":s.style.top=e+"px",s.style.left=t+"px"}}setTimeout(){const e=this;this.piHideDelay>0&&(this._tHideTimeout&&clearTimeout(this._tHideTimeout),this._tHideTimeout=setTimeout((function(){e._hide()}),this.piHideDelay))}onMouseOver(e){this._show(),this._tHideTimeout&&(clearTimeout(this._tHideTimeout),this._tHideTimeout=null)}onMouseOut(e){this.setTimeout()}resize(){this.position()}},r.MobRuleController=u,r.GroupHub=class{constructor(){this._oGroups={}}addListener(e,t){e=e.toLowerCase(),this._oGroups[e]||(this._oGroups[e]={aListeners:[],aProviders:[]}),this._oGroups[e].aListeners.push(t);const i=this.collectGroup(e);t.groupUpdate(i)}remListener(e,t){if(e=e.toLowerCase(),this._oGroups[e]){const i=this._oGroups[e].aListeners.indexOf(t);i>=0&&this._oGroups[e].aListeners.splice(i,1)}}addProvider(e,t){e=e.toLowerCase(),this._oGroups[e]||(this._oGroups[e]={aListeners:[],aProviders:[]}),this._oGroups[e].aProviders.push(t),this.updateGroup(e)}remProvider(e,t){if(e=e.toLowerCase(),this._oGroups[e]){const i=this._oGroups[e].aProviders.indexOf(t);i>=0&&(this._oGroups[e].aProviders.splice(i,1),this.updateGroup(e))}}updateGroup(e){if(e=e.toLowerCase(),this._oGroups[e]&&this._oGroups[e].aListeners.length>0){const t=this.collectGroup(e),i=this._oGroups[e].aListeners;for(let e=0;e<i.length;e++)i[e].groupUpdate(t)}}collectGroup(e){let t=[];e=e.toLowerCase();const i=this._oGroups[e].aProviders;for(let e=0;e<i.length;e++)i[e].groupCollect(t);return t}getListeners(e){return this._oGroups[e]?this._oGroups[e].aListeners.slice():[]}},r.WebObject=c,r.WebBaseUIObject=m,r.WebBaseContainer=f,r.WebBaseControl=b,r.WebBaseDEO=w,r.WebBaseForm=S,r.WebBaseFileUpload=B,r.WebBaseMenu=O,r.WebPanel=y,r.BaseApp=x,r.WebApp=class extends x{constructor(e){super(),this.psWebService=e||"WebServiceDispatcher.wso",this.pbXHRWithCredentials=!1,this._bPanels=!0,this.pbViewApp=!0}sendCall(e){return new Promise(((t,i)=>{let s=new p("CallAction",this.assembleRequest(e),this.psWebService,this);s.pbWithCredentials=this.pbXHRWithCredentials,s.bSilent=!0,s.onFinished.addListener((function(e){try{let i=e.oSource.getResponseValue();t(i)}catch(e){i(e)}}),this),s.onError.addListener((function(e){i(e.oError)}),this);try{s.send(!0)}catch(e){i(e)}}))}position(){}},r.LocalApp=L,r.WebBaseView=D,r.WebView=class extends D{constructor(e,t){super(e,t),this.prop(r.tBool,"pbFillHeight",!1),this._sControlClass="WebView",this._sBaseClass="WebInlineView",this._bWrapDiv=!0}wrpOpenHtml(e){e.push('<div class="WebContainer">')}wrpCloseHtml(e){e.push("</div>")}openHtml(e){super.openHtml(e),e.push('<div class="WebCon_Inner">'),e.push('<label class="WebWin_title"',this.pbShowCaption?"":'style="display: none"',">",r.dom.encodeHtml(this.psCaption),"</label>"),e.push('<div class="WebCon_ContentWrp">')}closeHtml(e){super.closeHtml(e),e.push("</div></div></div></div>")}afterRender(){this._eInner=r.dom.query(this._eElem,"div.WebCon_Inner"),this._eContentWrap=r.dom.query(this._eElem,"div.WebCon_ContentWrp"),this._eLbl=r.dom.query(this._eElem,"label.WebWin_title"),super.afterRender(),this.set_piHeight(this.piHeight),this.set_piWidth(this.piWidth),this.set_piMaxWidth(this.piMaxWidth),this.set_piMinWidth(this.piMinWidth),r.events.addDomKeyListener(this._eElem,this.onKey,this)}_show(e){const t=this.getWebApp(),i=!this._eElem;if(this.fireEx({sEvent:"OnShow"}),i){const e=this.render();r.dom.addClass(e,"WebWin_Hidden")}this._eElem.parentNode!==e&&(e.appendChild(this._eElem),this._eRenderTo=e),r.dom.removeClass(this._eElem,"WebWin_Hidden"),i&&this.afterRender(),this._bRendered=!0,this.afterShow(),this._oCurrentObj=null,t&&t.objFocus(this),setTimeout((()=>{t&&this._bRendered&&(this.pbFocusFirstOnShow&&!this._oCurrentObj&&this.conditionalFocus(!0),r.dom.addClass(this._eElem,"WebWin_Visible"),t.OnShowWindow.fire(t,{oWindow:this,eElem:this._eElem,bModal:!1}))}),20)}_hide(e){const t=this.getWebApp();let i=!1;this._bRendered&&(this._bRendered&&!e&&this.fire("OnHide",[]),r.dom.addClass(this._eElem,"WebWin_Hidden"),r.dom.removeClass(this._eElem,"WebWin_Visible"),t&&(i=!t.OnHideWindow.fire(t,{oWindow:this,eElem:this._eElem,bModal:!1}))),this._bRendered=!1,this.afterHide(),this._bStandalone&&(i?setTimeout((()=>{this._eElem&&this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem)}),5e3):this._eElem&&this._eElem.parentNode&&this._eElem.parentNode.removeChild(this._eElem))}viewResize(e){const t=this.getWebApp();this.prepareSize(),this.piHeight>0&&this.piHeight<e?this.setOuterHeight(this.piHeight):(this._bStretch||this.pbScroll&&t._eElem)&&this.setOuterHeight(e),this.resize()}getHeightDiff(e,t,i,s){let o=super.getHeightDiff(e,t,i,s);return this._eLbl&&i&&(o+=r.sys.gui.getVertBoxDiff(this._eInner,0),o+=this._eLbl.offsetHeight,o+=r.sys.gui.getVertBoxDiff(this._eLbl,1),o+=r.sys.gui.getVertBoxDiff(this._eContentWrap,0)),o}navigateBackToHere(e,t,i){this.serverAction("NavigateBackToHere_Callback",[e,t,i],this._tActionData)}destroy(){const e=this.getWebApp();let t;e&&(t=e._aViews.indexOf(this),t>=0&&e._aViews.splice(t,1)),super.destroy()}closePanel(){this.close()}set_pbFillHeight(e){this.pbFillHeight=e,this.sizeChanged()}set_piMinWidth(e){this.pbFloating||(this._eSizer&&(e>0?(e-=this.getWidthDiff(!0,!0,!1,!1),this._eSizer.style.minWidth=e+"px"):this._eSizer.style.minWidth=""),this.sizeChanged()),this.piMinWidth=e,this.set_piWidth(this.piWidth)}set_piWidth(e){if(this._eSizer){e-=this.getWidthDiff(!0,!0,!1,!1),this._eSizer.style.width=e>0?e+"px":""}this.sizeChanged()}set_piMaxWidth(e){this._eSizer&&(e>0?(e-=this.getWidthDiff(!0,!0,!1,!1),this._eSizer.style.maxWidth=e+"px"):this._eSizer.style.maxWidth=""),this.sizeChanged()}resizeHorizontal(){this.setOuterWidth(this.piWidth),super.resizeHorizontal()}setOuterHeight(e){this._eContainer&&(e-=this.getHeightDiff(!0,!1,!1,!1),this._eContainer.style.height=e>0?e+"px":"")}resize(){this._bRendered&&(this.updateAlign(),this.resizeHorizontal(),this.resizeVertical())}updateAlign(){if(this._eSizer){const e=this.getWebApp().peAlignView;this._eSizer.style.marginLeft=e===r.ciAlignCenter||e===r.ciAlignRight?"auto":"",this._eSizer.style.marginRight=e===r.ciAlignCenter?"auto":""}}},r.WebWindow=v,r.WebModalDialog=R,r.WebButton=M,r.WebLabel=W,r.WebForm=N,r.WebDateForm=U,r.WebDynamicObjectContainer=j,r.WebCheckbox=q,r.WebEdit=class extends S{constructor(e,t){super(e,t),this.prop(r.tBool,"pbStopOnSubmit",!0),this.prop(r.tString,"psPlaceHolder",""),this._eWrap=null,this._ePrompt=null,this._sControlClass="WebEdit",this._bJSSizing=!1}openHtml(e){super.openHtml(e),e.push('<div class="WebFrm_Wrapper"><textarea name="',this._sName,'"',' autocomplete="',r.dom.encodeAttr(this.psAutoComplete),'"',this.peLabelPosition!=r.ciLabelFloat?' placeholder="'+r.dom.encodeAttr(this.psPlaceHolder)+'" ':"",this.isEnabled()?"":' disabled="disabled" tabindex="-1"',"></textarea></div>")}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebFrm_Wrapper textarea"),this._eWrap=r.dom.query(this._eElem,"div.WebFrm_Wrapper"),super.afterRender(),r.events.addDomKeyListener(this._eElem,this.onKey,this)}set_psBackgroundColor(e){this._eWrap&&(this._eWrap.style.background=e||"")}set_psPlaceHolder(e){this._eControl&&this.peLabelPosition!=r.ciLabelFloat&&(this._eControl.placeholder=e)}get_pbChanged(){let e=this._sOrigValue;return!!this.pbChanged||(this._eElem&&(this.updateTypeVal(),e=e.replace(/\r\n|\r/g,"\n")),e!==this.getServerVal())}getVertHeightDiff(){let e=super.getVertHeightDiff();return e+=r.sys.gui.getVertBoxDiff(this._eWrap),r.sys.isChrome&&(e++,e++),e}onKey(e){e.matchKey(r.settings.formKeys.submit)&&this.pbStopOnSubmit?e.stopPropagation():super.onKey(e)}},r.WebBaseSelectionForm=Y,r.WebCombo=Z,r.WebSuggestionForm=J,r.WebSelectionForm=class extends Y{constructor(e,t){super(e,t),this.event("OnSelect",r.cCallModeDefault,"privateOnSelect")}openHtml(e){super.openHtml(e)}afterRender(){super.afterRender()}suggestSelect(){if(this._oSelectedSuggestion&&!this._oSelectedSuggestion.control){let e=this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);if(e)return this.set_psValue(e.aValues[0]),this.fireEx({sEvent:"OnSelect",tActionData:[e],oEnv:this}),void this.suggestHide()}super.suggestSelect()}},r.WebTagsForm=X,r.WebListExpandPanel=class extends f{constructor(e,t){if(super(e,t),this.prop(r.tInt,"peMode",r.wleOpenOnRowClickCloseOnChange),this.prop(r.tBool,"pbShowLoading",!1),this.prop(r.tString,"psExpandedRow",""),this.prop(r.tBool,"pbFocusOnShow",!0),this.event("OnExpand",r.cCallModeDefault),this.event("OnCollapse",r.cCallModeDefault),this._sExpandedRow=null,this._bExpanding=!1,this.OnAfterExpand=new r.events.JSHandler,this._sControlClass="WebListExpPnl",this._bWrapDiv=!0,this.addSync("psExpandedRow"),!(t instanceof _e))throw new r.Error(999,"WebListExpandPanel object '{{0}}' should be placed inside a WebList object.",this,[this.getLongName()]);this._oL=t,this._oL._onModulesCreated.addListener(this.onModulesCreated,this)}onModulesCreated(e){this._oL._oBody.onRowsRendered.addListener(this.onRowsRendered,this),this._oL._oController.onCellClick.addListener(this.onCellClick,this),this._oL._oController.onCellDblClick.addListener(this.onCellDblClick,this),this._oL._oModel.onRowChange.addListener(this.onRowChange,this)}onCellClick(e){this.peMode!=r.wleOpenOnRowClick&&this.peMode!=r.wleOpenOnRowClickCloseOnChange||(this._sExpandedRow==e.sRowId?this.collapse():this.expand(e.sRowId))}onCellDblClick(e){this.peMode!=r.wleOpenOnRowDoubleClick&&this.peMode!=r.wleOpenOnRowDoubleClickCloseOnChange||(this._sExpandedRow==e.sRowId?this.collapse():this.expand(e.sRowId))}onRowChange(e){this.peMode==r.wleOpenOnRowChange?this._sExpandedRow!==e.sGotoRowId&&this.expand(e.sGotoRowId):this.peMode!=r.wleOpenOnRowClickCloseOnChange&&this.peMode!=r.wleOpenOnRowDoubleClickCloseOnChange||this._sExpandedRow!==e.sGotoRowId&&this.collapse()}afterRender(){super.afterRender(),r.dom.on("focusin",this._eElem,this.onFocus,this),r.dom.on("click",this._eElem,this.onClick,this),r.dom.on("keydown keypress",this._eElem,(function(e){e.stopPropagation()}),this)}onFocus(e){e.stop()}onClick(e){e.stop()}collapse(){const e=this._oL._oBody;let t;function i(e){t.parentNode&&t.parentNode.removeChild(t),r.dom.off("transitionend",t,i,this)}this._sExpandedRow&&(this.fire("OnCollapse"),this._eElem.parentNode&&(t=this._eElem.cloneNode(!0),r.dom.query(t,"input",!0).forEach((function(e){e.name=e.name+"_1"})),t.style.height=this._eElem.scrollHeight+"px",this._eElem.parentNode.insertBefore(t,this._eElem),this._eElem.parentNode.removeChild(this._eElem),r.dom.animFrame((function(){r.dom.animFrame((function(){r.dom.on("transitionend",t,i,this),r.dom.addClass(t,"WebLEP_Hidden"),r.dom.removeClass(t,"WebLEP_Visible"),t.style.height="0px"}),this)}),this)),r.dom.addClass(this._eElem,"WebLEP_Hidden"),r.dom.removeClass(this._eElem,"WebLEP_Visible"),e.setExtraRowHeight(this._sExpandedRow,0),this._sExpandedRow=null,this.afterHide())}expand(e){const t=this._oL._oBody;let i;function s(e){i.style.height=null,this._bExpanding=!1,r.dom.off("transitionend",i,s,this),this.afterShow()}this._sExpandedRow&&this.collapse();const o=t.row(e);o&&(this._eElem?(this._eElem.style.display="none",r.dom.insertAfter(this._eElem,o)):(this.render(),r.dom.addClass(this._eElem,"WebLEP_Hidden"),this._eElem.style.display="none",r.dom.insertAfter(this._eElem,o),this.afterRender()),i=this._eElem,this.pbShowLoading&&r.dom.addClass(i,"WebCon_Loading"),this.fire("OnExpand",[e],(function(e){r.dom.removeClass(i,"WebCon_Loading")}),this),this.resizeHorizontal(),this.resizeVertical(),this._sExpandedRow=e,this.pbFocusOnShow&&this.focus(),r.dom.animFrame((function(){r.dom.on("transitionend",i,s,this),i.style.height="0px",i.style.display="",r.dom.animFrame((function(){var s;s=this.piHeight>0?this.piHeight+this.getHeightDiff(!1,!0,!1,!1):i.scrollHeight,i.style.height=s+"px",r.dom.addClass(i,"WebLEP_Visible"),r.dom.removeClass(i,"WebLEP_Hidden"),this._bExpanding=!0,t.setExtraRowHeight(e,s),t.scrollToRow(e)}),this)}),this))}onRowsRendered(e){if(this._sExpandedRow&&this._eElem&&!this._eElem.parentNode){const e=this._oL._oBody.row(this._sExpandedRow);e&&r.dom.insertAfter(this._eElem,e)}}get_psExpandedRow(){return this._sExpandedRow||""}resize(){this.resizeHorizontal(),this.resizeVertical()}setInnerHeight(e){super.setInnerHeight(e)}},r.WebList=_e,r.WebListHeaderView=pe,r.WebListRowModel=ne,r.WebListSwipeButton=class extends m{constructor(e,t){super(e,t),this.prop(r.tString,"psCaption",""),this.prop(r.tInt,"piWidth",50),this.prop(r.tBool,"pbPositionLeft",!1),this.prop(r.tBool,"pbDynamic",!1),this.prop(r.tBool,"pbAllowHtml",!1),this.event("OnClick",r.cCallModeWait),this._iColIndex=0,this._bIsSwipeButton=!0}isVisible(e){return this.pbRender&&this.pbVisible&&(!this.pbDynamic||r.toBool(e.aOptions[0]))}btnHtml(e){let t="";return t=this.pbDynamic?e.sValue:this.psCaption,this.pbAllowHtml||(t=r.dom.encodeHtml(t)),t}btnClick(e,t,i,s){return this.fire("OnClick",[t],i,s),!0}},r.WebGrid=We,r.WebMuliSelectList=Te,r.WebColumn_mixin=me,r.WebColumn=Ce,r.WebColumnCombo=class extends He{constructor(e,t){super(e,t),this._sCellClass="WebColCombo"}afterRender(){super.afterRender()}cellHtml(e,t){let i=t.sValue;if(this._aValues)for(let e=0;e<this._aValues.length;e++)if(this._aValues[e].sValue===i)return this.pbAllowHtml?this._aValues[e].sDescription:r.dom.encodeHtml(this._aValues[e].sDescription);const s=r.sys.data.serverToType(i,this.peDataType);return i=this.typeToDisplay(s),this.pbAllowHtml||(i=r.dom.encodeHtml(i)),""!==i?i:"&nbsp;"}onKey(e){const t=this;super.onKey(e),r.sys.isMoz&&(e.matchKey(r.settings.listKeys.scrollUp)||e.matchKey(r.settings.listKeys.scrollDown))&&(this._eControl.disabled=!0,setTimeout((function(){t._eControl.disabled=!t.isEnabled()}),20))}},r.WebColumnCheckbox=xe,r.WebColumnDate=class extends Le{constructor(e,t){super(e,t),this._sCellClass="WebCol"}afterRender(){super.afterRender()}onKey(e){this._bPickerVisible?e.matchKey(r.settings.calendarKeys.close)&&this._bPickerVisible&&(this.hideDatePicker(),e.stop()):super.onKey(e)}},r.WebColumnButton=class extends Ae{constructor(e,t){super(e,t),this.prop(r.tString,"psBtnCssClass",""),this.prop(r.tBool,"pbDynamic",!1),this.event("OnClick",r.cCallModeWait),this._sControlClass="",this._sCellClass="WebColBtn",this._bCellEdit=!1}openHtml(e){super.openHtml(e),e.push("<div>")}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div"),super.afterRender()}set_psBtnCssClass(e){const t=this.psBtnCssClass!==e;this.psBtnCssClass=e,t&&this._oParent.redraw()}getControlValue(){return this.psValue}cellClickAfter(e,t,i){const s=e.getTarget();return!("BUTTON"!==s.tagName||!s.hasAttribute("data-dfbtnid")||!this.isEnabled())&&(this.fire("OnClick",[s.getAttribute("data-dfbtnid"),t]),!0)}cellHtml(e,t){let i="";const s=[];if(this.isEnabled()||(i+=' disabled="disabled"'),this.pbDynamic){const e=t.aOptions;for(let t=0;t<e.length;t+=3)e[t]&&s.push('<button data-dfbtnid="',e[t],'" class="',e[t+1],'"',i,">",e[t+2],"</button>")}else s.push('<button data-dfbtnid="DEFAULT"',i,' class="',this.psBtnCssClass,'">',this.psButtonCaption,"</button>");return s.join("")}focus(){if(this._bFocusAble&&this.isEnabled()&&this._eControl&&this._eControl.focus){const e=r.dom.query(this._eControl,"button");if(e)return e.focus(),this.objFocus(),!0}return!1}},r.WebColumnImage=class extends Pe{constructor(e,t){super(e,t),this.event("OnClick",r.cCallModeWait),this.prop(r.tBool,"pbImageByCSS",!1),this.prop(r.tBool,"pbDynamic",!1),this.prop(r.tInt,"pePosition",r.cwiFit),this.prop(r.tString,"psImageUrl",""),this.prop(r.tString,"psImageCSSClass",""),this.prop(r.tInt,"piImageWidth",0),this.prop(r.tInt,"piImageHeight",0),this._sControlClass="",this._sCellClass="WebColImg",this._bCellEdit=!1}openHtml(e){super.openHtml(e),e.push("<div>")}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div"),super.afterRender()}set_psImageUrl(e){this.psImageUrl=e,this._oParent.redraw()}getControlValue(){return this.psValue}cellClickAfter(e,t,i){const s=e.getTarget();return!!(this.isEnabled()&&s.hasAttribute("data-dfimg")&&this.fire("OnClick",[s.getAttribute("data-dfimg"),t]))}cellHtml(e,t){const i=[];let s="";if(this.piImageWidth>0&&(s+="width: "+this.piImageWidth+"px;"),this.piImageHeight>0&&(s+="height: "+this.piImageHeight+"px;"),this.piImageHeight>0&&this.piImageWidth>0)switch(this.pePosition){case r.cwiActual:break;case r.cwiStretch:s+=" background-size:100% 100%;";break;case r.cwiStretchHoriz:s+=" background-size: 100%; background-position: center center;";break;case r.cwiCenter:s+=" background-position: center center;";break;case r.cwiFit:s+=" background-size:contain; background-position: center center;";break;case r.cwiCover:s+=" background-size:cover; background-position: center center;"}if(this.pbDynamic){const e=t.aOptions;if(e.length){for(let t=0;t<e.length;t+=2)if(e[t]){const o=e[t+1]||"";this.pbImageByCSS?i.push('<span style="',s,'" class="',e[t],'" data-dfimg="',e[t],'" title="',o,'"></span>'):0===this.piImageWidth||0===this.piImageHeight?i.push('<img style="',s,'" src="',e[t],'" data-dfimg="',e[t],'" title="',o,'">'):i.push('<span style="',s,"background-repeat: no-repeat; background-image: url('",e[t],'\');" data-dfimg="',e[t],'" title="',o,'"></span>')}}else i.push('<span style="',s,'" class=""></span>')}else this.pbImageByCSS?i.push('<span style="',s,'" class="',this.psImageCSSClass,'" data-dfimg="',this.psImageUrl,'"></span>'):i.push('<img style="',s,'" src="',this.psImageUrl,'" data-dfimg="',this.psImageUrl,'">');return i.join("")}},r.WebColumnSuggestion=class extends Be{constructor(e,t){super(e,t),this._sCellClass="WebCol"}onKey(e){const t=r.settings.suggestionKeys;if(this._bSuggestVisible){if(e.matchKey(t.moveUp))return this.suggestMove(-1),void e.stop();if(e.matchKey(t.moveDown))return this.suggestMove(1),void e.stop()}super.onKey(e)}},r.WebColumnLink=class extends Fe{constructor(e,t){super(e,t),this.event("OnClick",r.cCallModeWait),this._sControlClass="WebColLink",this._sCellClass="WebColLink WebWrp_None",this._bCellEdit=!1}openHtml(e){super.openHtml(e),e.push('<a href="javascript:void(0);" target="_self">')}closeHtml(e){e.push("</a>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"a"),super.afterRender()}getControlValue(){return this.psValue}cellClickAfter(e,t,i){return!("A"!==e.getTarget().tagName||!this.isEnabled())&&(this.fire("OnClick",[t,i]),!0)}cellHtml(e,t){return'<a href="javascript:void(0);" target="_self">'+super.cellHtml(e,t)+"</a>"}onKey(e){e.e.cancelBubble=!0,e.matchKey(r.settings.formKeys.submit)?this.cellClick(e,this._oParent.currentRowId(),this.psValue):super.onKey(e)}},r.WebColumnTags=class extends ke{constructor(e,t){super(e,t),this._sCellClass="WebTagsColumn WebTagsForm WebColTags",this.prop(r.tInt,"peWordBreak",r.wbWrap)}cellHtml(e,t){const i=[],s=this.parseSelectionValues(t.sValue);for(let e=0;e<s.length;e++)i.push('<div class="WebTgf_Tag">'),i.push('<span class="WebTgf_Text ',r.classWordBreak(this.peWordBreak),'">',r.dom.encodeHtml(this.truncate(s[e],this.piTagTruncateAt,!1)),"</span>"),i.push("</div>");return i.join("")}tooltipValue(e){return this.parseSelectionValues(e.sValue).join(", ")}set_peWordBreak(e){this.peWordBreak!==e&&this._oParent.redraw()}},r.WebColumnSelectionIndicator=class extends xe{constructor(e,t){super(e,t),this.prop(r.tBool,"pbSelectAllCheckbox",!1),this._sCellClass="WebColumnSelectionIndicator WebColCheckbox",this._sControlClass="WebColumnSelectionIndicator WebCheckbox WebCheckboxColumn",this._bIsMultiSelectCapable=!0,this._bAllCheckedCheckbox=!1}setAllSelectedCheckbox(e){e!==this._bAllCheckedCheckbox&&(this._bAllCheckedCheckbox=e,this.updateHeader())}create(){if(!(this._oParent instanceof Te))throw new r.Error(999,"The parent of the a cWebColumnSelectionIndicator should be a cWebMultiSelectList.");return super.create()}headerCSS(){return this.pbSelectAllCheckbox?"WebCheckbox WebCheckboxColumn":null}headerHtml(){return this.pbSelectAllCheckbox?'<input class="WebMultiSelectList_SelectAllBox" type="checkbox"'+(this._oParent._oController.areAllRowsSelected()?'checked="checked"':"")+' tabindex="-1"><span class="WebMultiSelectList_SelectAllBox WebCB_Fake"></span>':super.headerHtml()}cellHtml(e,t){const i=[];return i.push('<div class="',this.genClass(),'"><div class="WebCon_Inner"><div><input type="checkbox"'),this._oParent.isRowIdSelected(e)?i.push(' onclick="this.checked = true" checked="checked"'):i.push(' onclick="this.checked = false"'),this.isEnabled()||i.push(' disabled="disabled"'),this._oParent instanceof We||i.push(' tabindex="-1"'),i.push('><span class="WebCB_Fake"></span></div></div></div>'),i.join("")}set_pbSelectAllCheckbox(e){this.pbSelectAllCheckbox!==e&&(this.pbSelectAllCheckbox=e,this._oParent._oHeader.updateHeader())}},r.WebCommandBar=class extends m{constructor(e,t){super(e,t),this.prop(r.tInt,"peRegion",r.ciRegionTop),this._eSizer=null,this._bIsCommandBar=!0,this._bWrapDiv=!0,this._bRenderChildren=!0,this._sControlClass="WebCommandBar"}addChild(e){if(!(e instanceof Ve||e instanceof Oe))throw new r.Error(5201,"Invalid object structure: WebCommandBar can only contain WebMenuBar or WebToolBar objects.",this);super.addChild(e)}openHtml(e){super.openHtml(e),e.push('<div class="WebCmd_Sizer">')}closeHtml(e){e.push("</div>"),super.closeHtml(e)}renderChildren(e){let t;this._eSizer=r.dom.query(this._eElem,"div.WebCmd_Sizer");for(let e=0;e<this._aChildren.length;e++){const i=this._aChildren[e];if(i instanceof m){const e=i.render();i instanceof Oe?(t||(t=r.dom.create('<div class="WebCmd_ToolWrap"></div>'),this._eSizer.appendChild(t)),t.appendChild(e)):(t=null,this._eSizer.appendChild(e))}}}prepareSize(){return this._bStretch=!1,this._eSizer&&(this._iWantedHeight=this._eSizer.scrollHeight),this._iWantedHeight}setOuterHeight(e){this._eElem&&(this._eElem.style.height=e+"px")}},r.WebMenuBar=Ve,r.WebMenuGroup=class extends Ne{constructor(e,t){super(e,t),this._bActive=!1}create(){const e=this.getView();e?(e.OnShow.addListener(this.showView,this),e.OnHide.addListener(this.hideView,this)):(this._bActive=!0,super.create())}showView(e){this._bActive=!0,this.psGroupName&&this.getHub().addProvider(this.psGroupName,this)}hideView(e){this._bActive=!1,this.psGroupName&&this.getHub().remProvider(this.psGroupName,this)}set_psGroupName(e){this._bActive&&super.set_psGroupName(e)}},r.WebToolBar=Oe,r.WebActionBar=class extends Oe{constructor(e,t){super(e,t),this._sControlClass+=" WebActionBar"}genMenuHtml(e){let t,i=!1;const s=this.getMenu();for(let o=0;o<s.length;o++)t=s[o],t.sCSSClass||(t.sCSSClass="WebDefaultMenuItem"),t.eActionDisplay!==r.adBoth&&t.eActionDisplay!==r.adActionBar||this.genItemHtml(e,t,!0),i=i||t.eActionDisplay===r.adBoth||t.eActionDisplay===r.adMenu;if(e.push('<li data-df-item="subitems" class="WebMenuItem WebTlb_SubItems WebTlb_NoFit"',i?"":' style="display: none;"','><div><span class="WebItm_Icon">&nbsp;</span><a href="javascript: void(0);" target="_self">',this.psSubItemCaption,"</a></div><ul>"),i)for(let i=0;i<s.length;i++)t=s[i],t.eActionDisplay!==r.adBoth&&t.eActionDisplay!==r.adMenu||this.genItemHtml(e,t,!0);e.push("</ul></li>")}adjustWidth(){let e,t,i;if(this._eControl){const s=this._eControlWrp.clientWidth;if(this._eControl.scrollWidth>s&&(e=r.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",!0),e.length>1)){for(i=e.length-2;this._eControl.scrollWidth>s&&i>=0;){if(t=e[i],t.hasAttribute("data-df-path")){this.getItemByPath(t.getAttribute("data-df-path")).eActionDisplay===r.adBoth&&t.parentNode.removeChild(t)}i--}if(this._eControl.scrollWidth>s){const o=r.dom.query(this._eControl,"li.WebTlb_NoFit > ul");for(e=r.dom.query(this._eElem,"ul.WebBarRoot > li.WebMenuItem",!0),i=e.length-2;this._eControl.scrollWidth>s&&i>=0;)t=e[i],o.appendChild(t),i--}r.dom.query(this._eControl,"li.WebTlb_NoFit").style.display=""}}}collapseAll(){this._eMask&&(r.dom.off("click",this._eMask,this.onMaskTouch,this),this._eMask.parentNode.removeChild(this._eMask),this._eMask=null),super.collapseAll()}expandItem(e){e&&e.aChildren.length>0&&this.showMask(),super.expandItem(e)}expandSub(){this.showMask(),super.expandSub()}showMask(){r.sys.isMobile&&(this._eMask=r.dom.create('<div class="WebMenu_Mask">&nbsp;</div>'),this._eElem.insertBefore(this._eMask,this._eElem.firstChild),r.dom.on("click",this._eMask,this.onMaskTouch,this))}onMaskTouch(e){this.collapseAll(),e.stop()}},r.WebMenuItem=F,r.WebMenuItemCheckbox=k,r.WebMenuColumnBase=le,r.WebMenuColumnList=he,r.WebMenuColumnRestorer=de,r.WebMenuGroupingSelector=class extends le{constructor(e,t){super(e,t),this._oGroupingSelector=null}afterRender(){super.afterRender();let e=this.getList();if(!e)throw new df.Error(999,"WebMenuGroupingSelector could not find it's WebList.",this);this._oGroupingSelector=new ze(e),this._oGroupingSelector.onSizeChanged.on(this.onSizeChange,this),e._oGrouping.registerMenuGroupingSelector(this._oGroupingSelector)}onSizeChange(e){this.getProv()?._oMenu?.updateMenuSize()}itemClick(e,t,i){}addChild(){throw new df.Error(999,"a WebMenuGroupingSelector is not supposed to have children.",this)}cssClass(){return super.cssClass()+" WebMenuGroupingSelector"}visible(){if(super.visible()){return this.getList().peGrouping==df.grpAutomatic}return!1}customRender(){return!0}itemHtml(e){e.push('<div class="WebMenuGrp_Placeholder"></div>')}itemRendered(e){this._oGroupingSelector&&e&&(e.removeChild(e.firstChild),e.appendChild(this._oGroupingSelector.render()))}itemHidden(){}},r.WebCardContainer=Ue,r.WebCard=Ge,r.WebTabContainer=class extends Ue{constructor(e,t){super(e,t),this._sControlClass="WebTabContainer",this._sCardClass="WebTbc",this._bCC=!1}openHtml(e){this.pbShowCaption=!1,this.pbShowBorder=!1,super.openHtml(e)}addChild(e){if(e instanceof m&&!(e instanceof Ke))throw new r.Error(999,"WebTabContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebTabPage.",this,[e.getLongName()||"oWebApp"]);super.addChild(e)}set_pbShowCaption(e){}set_pbShowBorder(e){}getHeightDiff(){let e=0;return this._eHead&&(e+=r.dom.clientHeight(this._eHead),e+=r.sys.gui.getVertBoxDiff(this._eHead,1)),this.pbShowCaption&&this._eLabelSpacer&&(e+=r.dom.clientHeight(this._eLabelSpacer),e+=r.sys.gui.getVertBoxDiff(this._eHead,1)),this._eControl&&(e+=r.sys.gui.getVertBoxDiff(this._eControl),e+=r.sys.gui.getVertBoxDiff(this._eInner),e+=r.sys.gui.getVertBoxDiff(this._eControlWrp)),e}focus(){let e;if(this._bFocusAble&&this.isEnabled()&&this._eElem)for(let t=0;t<this._aCards.length;t++)if(e=this._aCards[t],e.isActive()&&e._eBtn){try{e._eBtn.focus()}catch(e){}return this.objFocus(),!0}return!1}},r.WebTabPage=Ke,r.WebDatePicker=G,r.WebTreeView=class extends b{constructor(e,t){super(e,t),this.prop(r.tBool,"pbShowIcons",!0),this.prop(r.tBool,"pbAllowHtml",!1),this.prop(r.tString,"psSelectedId",""),this.prop(r.tString,"psSelectedValue",""),this.event("OnSelect",r.cCallModeWait),this.event("OnExpand",r.cCallModeDefault),this.event("OnCollapse",r.cCallModeDefault),this._aRootItems=[],this._aItems=[],this._iAutoNum=1e3,this._tSelectedNode=null,this._bRedraw=!1,this._eRootTable=null,this._eCurHoveredElem=null,this._fHoverTimeOut=null,this._sControlClass="WebTreeView"}openHtml(e){super.openHtml(e),e.push('<div class="WebTree_Body" style="height: 10px;" ',this.isEnabled()?'tabindex="0"':'tabindex="-1"',">")}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){const e=this;this._eControl=r.dom.query(this._eElem,"div.WebTree_Body"),this._eFocus=this._eControl,super.afterRender(),r.dom.on("click",this._eControl,this.onBodyClick,this),r.dom.on("dblclick",this._eControl,this.onBodyDblClick,this),r.events.addDomKeyListener(this._eElem,this.onKey,this),this.redraw(),setTimeout((function(){e._tSelectedNode&&e.scrollToElement(e._tSelectedNode._eElem)}),50),setTimeout((function(){e.dragDropCleanup(),e.dragDropInit()}),50)}applyEnabled(e){super.applyEnabled(e),this._eFocus&&(this._eFocus.tabIndex=e?0:-1)}get_psSelectedId(){return this._tSelectedNode?this._tSelectedNode.sId:""}get_psSelectedValue(){return this._tSelectedNode?this._tSelectedNode.sValue:""}set_pbShowIcons(e){this.pbShowIcons=e,this.redraw()}select(e){const t=this.getNodeById(e);t&&this.doSelect(t,!1)}expand(e){const t=this.getNodeById(e);t&&t.bFolder&&this.expandNode(t)}collapse(e){const t=this.getNodeById(e);t&&this.collapseNode(t)}collapseAll(){for(let e=0;e<this._aItems.length;e++)this._aItems[e].bExpanded&&this.collapseNode(this._aItems[e])}refresh(e){let t,i;const s=this.deserializeVT(this._tActionData);if(i=this._tSelectedNode&&(this._tSelectedNode.sId||""),!i&&this.psSelectedId&&(i=this.psSelectedId,this.psSelectedId=""),e){if(t=this.getNodeById(e),t)for(;t._aChildren.length>0;)this.doRemove(t._aChildren[0],!0)}else this.clear(),this.displayLoading();for(let i=0;i<s.length;i++)t=this.initNode(s[i]),t.sParentId||(t.sParentId=e||""),this.insert(t);i?(t=this.getNodeById(i),t&&(this._tSelectedNode=t)):this._tSelectedNode=null,this.redraw(),this.hideLoading()}updateNode(){var e,t;const i=this.deserializeVT(this._tActionData);i.length>0&&(e=this.initNode(i[0]),(t=this.getNodeById(e.sId))&&(t.sName=e.sName,t.sAltText=e.sAltText,t.sValue=e.sValue,t.sCSSClass=e.sCSSClass,t.sIcon=e.sIcon,t.bFolder=e.bFolder,t.bLoadChildren=e.bLoadChildren,this.redraw()))}insertNode(){let e;const t=this.deserializeVT(this._tActionData);t.length>0&&(e=this.initNode(t[0]),this.insert(e),this.redraw())}removeNode(e){const t=this.getNodeById(e);t&&(this.doRemove(t),this.redraw())}deserializeVT=r.sys.vt.generateDeserializer([r.tWebTreeItem]);loadSubNodes(e){let t="",i="",s=0;e?(e._bIsLoading=!0,this.displayLoading(e),t=e.sId,i=e.sValue,s=this.getLevel(e)):(this.clear(),this.displayLoading()),this.serverAction("LoadSubNodes",[t,i,s],null,(function(t){e&&(e._bIsLoading=!1,this.updateNodeCSS(e)),t.bError||(e?(e._bIsLoaded=!0,this.expandNode(e)):this.redraw()),this.hideLoading(e)}),this)}addSubItems(e){let t;const i=this.deserializeVT(this._tActionData);for(let s=0;s<i.length;s++)t=this.initNode(i[s]),t.sParentId||(t.sParentId=e||""),this.insert(t)}initNode(e){return e._aChildren=[],e._tParent=null,e._eElem=null,e._eSubMenuRow=null,e._eSubMenuTable=null,e._bIsLoading=!1,e._bIsLoaded=e.bExpanded,e.sId||(this._iAutoNum++,e.sId=this._iAutoNum.toString()),e}insert(e){let t;if(this.getNodeById(e.sId))throw new r.Error(5151,"Node IDs must be unique (ID: '{{0}}')",this,[e.sId]);e.sParentId&&(t=this.getNodeById(e.sParentId)),t?(e._tParent=t,t._aChildren.push(e)):this._aRootItems.push(e),this._aItems.push(e)}clear(){if(this._eRootTable){this._eControl.removeChild(this._eRootTable);for(let e=0;e<this._aItems.length;e++)this._aItems[e]._eElem&&(this._aItems[e]._eElem.tNode=null),this._aItems[e]._eElem=null,this._aItems[e]._eSubMenuRow=null,this._aItems[e]._eSubMenuTable=null}this._tSelectedNode=null,this._aItems=[],this._aRootItems=[],this._eControl&&(this._eRootTable=this.constructTable(),this._eControl.appendChild(this._eRootTable))}redraw(){if(this._eControl){if(this._bRedraw=!0,this._eRootTable){this._eControl.removeChild(this._eRootTable);for(let e=0;e<this._aItems.length;e++)this._aItems[e]._eElem=null,this._aItems[e]._eSubMenuRow=null,this._aItems[e]._eSubMenuTable=null}this._eRootTable=this.constructTable(),this.constructMenu(this._aRootItems,this._eRootTable),this._eControl.appendChild(this._eRootTable),this._bRedraw=!1}}constructTable(){return document.createElement("table")}constructNode(e,t,i,s,o){let n,a;const l=e._aChildren.length>0||e.bLoadChildren,h=t.insertRow(i);return h.setAttribute("data-dftree-id",e.sId),this.pbDragDropEnabled&&(e.bFolder?this.isSupportedDragAction(r.dragActions.WebTreeView.ciDragFolder)&&h.setAttribute("draggable",!0):this.isSupportedDragAction(r.dragActions.WebTreeView.ciDragItem)&&h.setAttribute("draggable",!0)),e._eElem=h,n=h.insertCell(0),n.innerHTML="<div>&nbsp;</div>",n=h.insertCell(h.cells.length),a=this.pbAllowHtml?e.sName:r.dom.encodeHtml(e.sName),n.innerHTML='<span class="WebTree_Text" title="'+r.dom.encodeAttr(e.sAltText)+'">'+a+"</span>",this.updateNodeCSS(e),l&&e.bExpanded&&(i++,this.constructSubmenu(e,t,i,o)),i}constructMenu(e,t){let i=0;for(let s=0;s<e.length;s++)i=this.constructNode(e[s],t,i,0===s&&t===this.eRootTable,s===e.length-1),i++}constructSubmenu(e,t,i,s){let o;const n=t.insertRow(i);n.className="WebTree_SubRow"+(this._bRedraw?"":" WebTree_HiddenSubRow"),o=n.insertCell(0),o.className=s?"WebTree_ConLast":"WebTree_Con",o=n.insertCell(1),o.innerHTML="<table></table>";const a=r.dom.query(o,"table");e._eSubMenuRow=n,e._eSubMenuTable=a,this.constructMenu(e._aChildren,a,!1),this._bRedraw||setTimeout((function(){e._eSubMenuRow&&r.dom.removeClass(e._eSubMenuRow,"WebTree_HiddenSubRow")}),20)}updateNodeCSS(e){if(e._eElem){e._eElem.className=(e.bExpanded?"WebTree_Expanded":"WebTree_Collapsed")+(e===this._tSelectedNode?" WebTree_Selected":"")+" "+e.sCSSClass;const t=this.isFirst(e),i=this.isLast(e),s=this.isRoot(e),o=this.hasChildren(e);if(e._eElem.cells[0].className="WebTree_Item WebTree_"+(t&&s||i?(t&&s?"Start":"")+(i?"End":""):"Entry")+(o?"Sub":""),this.pbShowIcons){const t=e._eElem.cells[1];e.sIcon&&!e._bIsLoading?(t.style.backgroundImage="url('"+e.sIcon+"')",t.style.backgroundRepeat="no-repeat",t.className=(e.bFolder?"WebTree_Folder ":"WebTree_Icon ")+"WebTree_HasIcon"):(t.className=(e._bIsLoading?"WebTree_IconLoading ":"WebTree_NoIcon ")+(e.bFolder?"WebTree_Folder ":"WebTree_Icon "),t.style.backgroundImage="")}}}toggle(e){e.bExpanded?this.collapseNode(e):this.expandNode(e)}expandNode(e){e.bExpanded=!0,e._bIsLoading||(this.fire("OnExpand",[e.sId,e.sValue,this.getLevel(e)]),!e._bIsLoaded&&e.bLoadChildren?this.loadSubNodes(e):(e._eElem&&(e._eSubMenuRow?r.dom.removeClass(e._eSubMenuRow,"WebTree_HiddenSubRow"):this.constructSubmenu(e,e._tParent?e._tParent._eSubMenuTable:this._eRootTable,e._eElem.rowIndex+1,this.isLast(e))),this.updateNodeCSS(e)))}collapseNode(e){if(e.bExpanded=!1,this.fire("OnCollapse",[e.sId,e.sValue,this.getLevel(e)]),e._eSubMenuRow&&r.dom.addClass(e._eSubMenuRow,"WebTree_HiddenSubRow"),this.isParent(this._tSelectedNode,e))for(;e&&!this.doSelect(e);)e=e._tParent;this.updateNodeCSS(e)}moveUp(){let e;if(this._tSelectedNode){e=this._tSelectedNode;const t=this.getPosition(e);if(t>0){for(e=(e._tParent?e._tParent._aChildren:this._aRootItems)[t-1];e.bExpanded&&e._aChildren.length>0;)e=e._aChildren[e._aChildren.length-1];this.doSelect(e)}else e._tParent&&this.doSelect(e._tParent)}}moveDown(){let e;if(this._tSelectedNode)if(e=this._tSelectedNode,e.bExpanded&&e._aChildren.length>0)this.doSelect(e._aChildren[0]);else for(;e;){const t=e._tParent?e._tParent._aChildren:this._aRootItems,i=this.getPosition(e);if(i<t.length-1){this.doSelect(t[i+1]);break}e=e._tParent}else this._aRootItems.length>0&&this.doSelect(this._aRootItems[0])}doCollapse(){if(this._tSelectedNode){const e=this._tSelectedNode;e.bExpanded&&this.hasChildren(e)?this.collapseNode(e):e._tParent&&this.doSelect(e._tParent)}}doExpand(){if(this._tSelectedNode){const e=this._tSelectedNode;!e.bExpanded&&this.hasChildren(e)?this.expandNode(e):e._aChildren.length>0&&this.doSelect(e._aChildren[0])}else this._aRootItems.length>0&&this.doSelect(this._aRootItems[0])}moveFirst(){this._aRootItems.length>0&&this.doSelect(this._aRootItems[0])}moveLast(){let e;if(this._aRootItems.length>0){for(e=this._aRootItems[this._aRootItems.length-1];e.bExpanded&&e._aChildren.length>0;)e=e._aChildren[e._aChildren.length-1];this.doSelect(e)}}doSelect(e,t){this.addSync("psSelectedId"),this.addSync("psSelectedValue");const i=this._tSelectedNode;this._tSelectedNode=e;const s=this.psSelectedId!==e.sId;return this.psSelectedId=e.sId,i&&this.updateNodeCSS(i),this.updateNodeCSS(e),e._eElem&&this.scrollToElement(e._eElem),!t&&s&&this.fire("OnSelect",[e.sId,e.sValue,this.getLevel(e)]),!0}doRemove(e,t){let i,s,o=!1;if(function e(t){for(;t._aChildren.length>0;)e.call(this,t._aChildren.pop());t._eElem=null,t._eSubMenuRow=null,t._eSubMenuTable=null,t===this._tSelectedNode&&(this._tSelectedNode=null,o=!0),r.sys.data.removeFromArray(this._aItems,t)}.call(this,e),s=e._tParent?e._tParent._aChildren:this._aRootItems,s)for(i=0;i<s.length;i++)if(s[i]===e){s.splice(i,1);break}o&&!t&&(s&&s.length>0?this.doSelect(s[i]||s[i-1]):this.doSelect(e._tParent||this._aItems[0]))}getPosition(e){const t=e._tParent?e._tParent._aChildren:this._aRootItems;for(let i=0;i<t.length;i++)if(t[i]===e)return i;return-1}isLast(e){const t=e._tParent?e._tParent._aChildren:this._aRootItems;return t[t.length-1]===e}isFirst(e){return(e._tParent?e._tParent._aChildren:this._aRootItems)[0]===e}isRoot(e){return!e._tParent}isParent(e,t){for(;e;){if(e===t)return!0;e=e._tParent}return!1}getLevel(e){let t=1;for(;e._tParent;)t++,e=e._tParent;return t}getNodeById(e){for(let t=0;t<this._aItems.length;t++)if(this._aItems[t].sId===e)return this._aItems[t];return null}hasChildren(e){return e.bLoadChildren&&!e._bIsLoaded||e._aChildren.length>0}scrollToElement(e){const t=r.sys.gui.getAbsoluteOffset(e),i=r.sys.gui.getAbsoluteOffset(this._eControl),s=t.top-i.top;s<this._eControl.scrollTop?this._eControl.scrollTop=s:s+e.offsetHeight>this._eControl.scrollTop+this._eControl.clientHeight&&(this._eControl.scrollTop=s+e.offsetHeight-this._eControl.clientHeight)}onBodyClick(e){let t=null,i=!0,s=e.getTarget();if(this.isEnabled()){for(;s&&!t&&s!==this._eElem;)s.className.indexOf("WebTree_Item")>=0&&(i=!1),t=s.getAttribute("data-dftree-id"),s=s.parentNode;const o=this.getNodeById(t);o&&(i&&this._tSelectedNode!==o?(!o.bExpanded&&this.hasChildren(o)&&this.expandNode(o),this.doSelect(o)):this.toggle(o),e.stop()),this.focus()}}onBodyDblClick(e){let t=null,i=e.getTarget();if(this.isEnabled()){for(;i&&!t&&i!==this._eElem;)t=i.getAttribute("data-dftree-id"),i=i.parentNode;this.getNodeById(t)&&this.fireSubmit()&&e.stop()}}onKey(e){this.isEnabled()&&(e.matchKey(r.settings.treeKeys.moveUp)?(this.moveUp(),e.stop()):e.matchKey(r.settings.treeKeys.moveDown)?(this.moveDown(),e.stop()):e.matchKey(r.settings.treeKeys.collapse)?(this.doCollapse(),e.stop()):e.matchKey(r.settings.treeKeys.extend)?(this.doExpand(),e.stop()):e.matchKey(r.settings.treeKeys.moveFirst)?(this.moveFirst(),e.stop()):e.matchKey(r.settings.treeKeys.moveLast)?(this.moveLast(),e.stop()):e.matchKey(r.settings.treeKeys.enter)&&this.fireSubmit()&&e.stop())}displayLoading(e){e?this.updateNodeCSS(e):this._eControl&&r.dom.addClass(this._eControl,"WebTree_Loading")}hideLoading(e){e?this.updateNodeCSS(e):this._eControl&&r.dom.removeClass(this._eControl,"WebTree_Loading")}focus(){return!!(this._bFocusAble&&this.isEnabled()&&this._eFocus)&&(this._eFocus.focus(),this.objFocus(),!0)}onFocus(e){super.onFocus(e),this._bLozingFocus=!1}onBlur(e){const t=this,i=super.onBlur;this._bLozingFocus=!0,setTimeout((function(){t._bLozingFocus&&(i.call(t,e),t._bLozingFocus=!1)}),100)}determineSelectorForWebUIContext(e){switch(e){case r.WebUIContext.WebUIContextTreeviewFolder:case r.WebUIContext.WebUIContextTreeviewItem:return"tr[data-dftree-id]"}return null}verifyElementForWebUIContext(e,t){switch(t){case r.WebUIContext.WebUIContextTreeviewFolder:case r.WebUIContext.WebUIContextTreeviewItem:{if(!e.hasAttribute("data-dftree-id"))return!1;const i=e.getAttribute("data-dftree-id"),s=this.getNodeById(i);return s.bFolder&&t===r.WebUIContext.WebUIContextTreeviewFolder||!s.bFolder&&t===r.WebUIContext.WebUIContextTreeviewItem}}return!0}retrieveValueFromWebUIContext(e,t){switch(t){case r.WebUIContext.WebUIContextTreeviewFolder:case r.WebUIContext.WebUIContextTreeviewItem:if(!e.hasAttribute("data-dftree-id"))break;return e.getAttribute("data-dftree-id")}return null}getDragData(e,t){try{const e=t.getAttribute("data-dftree-id")||-1;let i,s;return e&&-1!=e&&(""!=e||e>=0)&&(i={...this.getNodeById(e)},Object.keys(i).forEach((function(e){0==e.indexOf("_")&&delete i[e]})),s=i.bFolder?r.dragActions.WebTreeView.ciDragFolder:r.dragActions.WebTreeView.ciDragItem),[{data:i},s]}catch(e){return console.error("Attempt to perform unsupported drag action"),[null,null]}}getDropData(e,t){if(e&&e._eDropElem){const t=e._eDropElem.getAttribute("data-dftree-id")||-1;let i,s;t&&-1!=t&&(""!=t||t>=0)&&(i={...this.getNodeById(t)},Object.keys(i).forEach((function(e){0==e.indexOf("_")&&delete i[e]})),s=i.bFolder?r.dropActions.WebTreeView.ciDropOnFolder:r.dropActions.WebTreeView.ciDropOnItem);return{data:i,action:s}}return null}initDraggableElements(){}initDropZones(){if(this._aDropZones=[],super.initDropZones(),this.isSupportedDropAction(r.dropActions.WebTreeView.ciDropOnFolder)||this.isSupportedDropAction(r.dropActions.WebTreeView.ciDropOnItem)){const e=r.dom.query(this._eElem,".WebTree_Body");this.addDropZone(e)}}determineDropCandidate(e,t){if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebControl.ciDropOnControl))))return[this._eElem,r.dropActions.WebControl.ciDropOnControl];let i=document.elementFromPoint(e.e.clientX,e.e.clientY)?.closest("tr[data-dftree-id]");if(i){let e=i.getAttribute("data-dftree-id");if(this.getNodeById(e).bFolder){if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebTreeView.ciDropOnFolder))))return[i,r.dropActions.WebTreeView.ciDropOnFolder]}else if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebTreeView.ciDropOnItem))))return[i,r.dropActions.WebTreeView.ciDropOnItem]}return[null,null]}determineDropPosition(e,t){return r.dropPositions.ciDropOn}interactWithDropElem(e,t){e._eDropAction,r.dropActions.WebControl.ciDropOnControl,e.highlightElement()}doEmptyInteraction(e){return this.isSupportedDropAction(r.dropActions.WebTreeView.ciDropOnRoot)?(e.highlightElement(),r.dropActions.WebTreeView.ciDropOnRoot):this.isSupportedDropAction(r.dropActions.WebControl.ciDropOnControl)?(e.highlightElement(),r.dropActions.WebControl.ciDropOnControl):null}onControlDragOver(e,t,i){i!=this._eCurHoveredElem&&(this._eCurHoveredElem=i,clearTimeout(this._fHoverTimeOut),this._eCurHoveredElem&&(this._fHoverTimeOut=setTimeout((()=>{this.expand(this._eCurHoveredElem.getAttribute("data-dftree-id"))}),1e3)))}hasData(){return this._aItems&&this._aItems.length>0}},r.WebIFrame=H,r.WebImage=class extends b{constructor(e,t){super(e,t),this.prop(r.tString,"psUrl",""),this.prop(r.tBool,"pbScroll",!1),this.prop(r.tInt,"pePosition",r.cwiActual),this.prop(r.tBool,"pbShowBorder",!1),this.prop(r.tBool,"pbFitZoom",!0),this.event("OnClick",r.cCallModeWait),this.pbServerOnClick=!1,this.psClientOnClick="",this._eImg=null,this._sLastUrl=null,this._iImageWidth=null,this._iImageHeight=null,this._bFocusAble=!1,this._sControlClass="WebImage"}openHtml(e){super.openHtml(e),e.push('<div class="WebImg_Wrp"><img>')}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebImg_Wrp"),this._eImg=r.dom.query(this._eElem,"div.WebImg_Wrp > img"),super.afterRender(),r.dom.on("click",this._eControl,this.onClick,this),r.dom.on("load",this._eImg,this.onImageLoaded,this),this.set_pePosition(this.pePosition),this.set_pbShowBorder(this.pbShowBorder),this.set_piHeight(this.piHeight),this.updateImage()}set_psUrl(e){this.psUrl=e,this.updateImage()}set_pbScroll(e){this._eControl&&(this._eControl.style.overflowY=e&&this.pePosition!==r.cwiStretch?"auto":"hidden",this._eControl.style.overflowX=e&&this.pePosition!==r.cwiStretchHoriz&&this.pePosition!==r.cwiStretch?"auto":"hidden")}set_pePosition(e){this._eImg&&(this._eControl.scrollLeft=0,this._eControl.scrollTop=0,this._eImg.style.width=e===r.cwiStretch||e===r.cwiStretchHoriz?"100%":"",this._eImg.style.height=e===r.cwiStretch?"100%":"",this._eImg.style.marginLeft=e===r.cwiCenter?"auto":"",this._eImg.style.marginRight=e===r.cwiCenter?"auto":"",this._eImg.style.display="block",this._eImg.style.marginTop="",this.pePosition=e,this.set_pbScroll(this.pbScroll),this.centerImage())}set_pbShowBorder(e){this._eControl&&(r.dom.toggleClass(this._eControl,"WebImg_Box",e),this.pbShowBorder!==e&&this.sizeChanged())}set_psToolTip(e){this._eImg&&(this._eImg.alt=e,this._eImg.title=e)}updateImage(){this._iImageWidth=null,this._iImageHeight=null,this._eImg&&(this.psUrl!==this._sLastUrl&&(this._eImg.style.visibility="hidden"),this._eImg.src=this.psUrl,this._sLastUrl=this.psUrl,this.centerImage())}centerImage(){if(this._eImg){if(this.pePosition===r.cwiFit&&this._iImageWidth>0){const e=this._eControl.clientWidth/this._iImageWidth,t=this._eControl.clientHeight/this._iImageHeight;let i=e<t?e:t;this.pbFitZoom||(i=i>1?1:i),i>0&&(this._eImg.style.width=Math.floor(this._iImageWidth*i)+"px")}this.pePosition!==r.cwiCenter&&this.pePosition!==r.cwiFit||(this._eImg.clientHeight<this._eControl.clientHeight?this._eImg.style.marginTop=Math.floor((this._eControl.clientHeight-this._eImg.clientHeight)/2)+"px":(this._eImg.style.marginTop="",this._eControl.scrollTop=Math.floor((this._eControl.scrollHeight-this._eControl.clientHeight)/2)),this._eImg.clientWidth<this._eControl.clientWidth?this._eImg.style.marginLeft=Math.floor((this._eControl.clientWidth-this._eImg.clientWidth)/2)+"px":(this._eImg.style.marginLeft="",this._eControl.scrollLeft=Math.floor((this._eControl.scrollWidth-this._eControl.clientWidth)/2)))}}resize(){0===this._iImageWidth&&(this._iImageWidth=this._eImg.clientWidth,this._iImageHeight=this._eImg.clientHeight),this.centerImage()}onImageLoaded(e){this._iImageWidth=this._eImg.clientWidth,this._iImageHeight=this._eImg.clientHeight,this.centerImage(),this._eImg.style.visibility=""}onClick(e){this.isEnabled()&&this.fire("OnClick")&&e.stop()}},r.WebHtmlBox=E,r.WebRadio=class extends w{constructor(e,t){super(e,t),this.prop(r.tString,"psMasterName",""),this.prop(r.tString,"psGroupName",""),this.prop(r.tString,"psRadioValue",""),this.prop(r.tString,"psCaption",""),this.event("OnSelect",r.cCallModeDefault),this._oMaster=null,this._aRadios=[],this._sPrevChangeVal=null,this._iPrevSelected=null,this._eCaption=null,this._sControlClass="WebRadio"}openHtml(e){super.openHtml(e),e.push('<input type="radio" name="',this.psGroupName,'" id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled" tabindex="-1"','><span class="WebR_Fake"></span><label class="WebRadio_Caption" for="',this._sControlId,'"></label>'),this._oParent?._bIsContainer&&this._oParent?.isFlowLayout()&&e.push('<div style="clear: both"></div>')}afterRender(){const e=this.getWebApp();this._eControl=r.dom.query(this._eElem,"input"),this._eCaption=r.dom.query(this._eElem,"label.WebRadio_Caption"),this._eFakeBox=r.dom.query(this._eElem,".WebR_Fake"),this.set_psCaption(this.psCaption),this.set_psRadioValue(this.psRadioValue),this.psMasterName?(this._oMaster=e.findObj(this.psMasterName),this._oMaster.registerRadio(this),this.unSync("psValue"),this.unSync("pbChanged"),this.psValue=this._oMaster.psValue):this.registerRadio(this),super.afterRender(),r.dom.on("click",this._eControl,this.onClick,this),r.dom.on("click",this._eFakeBox,this.onFakeClick,this)}get_pbChanged(){return this._oMaster?this._oMaster.get_pbChanged():super.get_pbChanged()}set_psValue(e){if(this._oMaster)this._oMaster.set_psValue(e);else{super.set_psValue(e);for(let e=0;e<this._aRadios.length;e++)if(this._aRadios[e]._eControl.checked){this._iPrevSelected=e;break}}}get_psValue(){return this._oMaster?this._oMaster.get_psValue():super.get_psValue()}set_psRadioValue(e){this._eControl&&(this._eControl.value=e)}set_psCaption(e){this._eCaption&&(r.dom.setText(this._eCaption,e),this.psCaption!==e&&this.sizeChanged())}set_psTextColor(e){this._eCaption&&(this._eCaption.style.color=e||"")}set_psToolTip(e){super.set_psToolTip(e),this._eFakeBox&&(this._eFakeBox.title=e)}getControlValue(){if(this._oMaster)return this._oMaster.getControlValue();for(let e=0;e<this._aRadios.length;e++)if(this._aRadios[e]._eControl.checked)return this._aRadios[e].psRadioValue;return this.psValue}setControlValue(e){if(this._oMaster)return this._oMaster.setControlValue(e);if(!this._aRadios[this._iPrevSelected]||!this._aRadios[this._iPrevSelected]._eControl.checked||this._aRadios[this._iPrevSelected].psRadioValue!==e)for(let t=0;t<this._aRadios.length;t++)if(this._aRadios[t].psRadioValue===e)return void(this._aRadios[t]._eControl.checked=!0)}registerRadio(e){this._aRadios.push(e)}fireChange(){if(this._oMaster)return this._oMaster.fireChange();this.updateTypeVal();const e=this.getServerVal();for(let t=0;t<this._aRadios.length;t++)this._sPrevChangeVal!==e&&this._aRadios[t].fire("OnChange",[e,this._sPrevChangeVal]),this._aRadios[t]._eControl.checked&&t!==this._iPrevSelected&&(this._aRadios[t].fire("OnSelect"),this._iPrevSelected=t);this._sPrevChangeVal=e}onClick(e){this.fireChange()}onFakeClick(e){this.isEnabled()&&(this.focus(),this._eControl.checked=!0,this.fireChange())}},r.WebSlider=class extends w{constructor(e,t){super(e,t),this.prop(r.tInt,"piMinValue",1),this.prop(r.tInt,"piMaxValue",10),this.prop(r.tInt,"piSliderValue",1),this.prop(r.tInt,"piInterval",1),this.prop(r.tBool,"pbVertical",!1),this.prop(r.tInt,"piHeight",0),this.prop(r.tBool,"pbShowMarkers",!1),this.prop(r.tInt,"piMaxMarkers",101),this.prop(r.tBool,"pbRanged",!1),this.prop(r.tInt,"piSliderStart",0),this.prop(r.tInt,"piFrom",1),this.prop(r.tInt,"piTo",3),this.prop(r.tBool,"pbShowValue",!0),this.prop(r.tBool,"pbShowRange",!1),this.prop(r.tBool,"pbMouseWheelScroll",!0),this._eSlider=null,this._eSliderWrp=null,this._eSliderBar=null,this._eControl=null,this._eLabels=null,this._eValueIndicator=null,this._bSelected=!1,this._bFocus=!1,this._eRangedSlider=null,this._iValueInterval=0,this._aLabels=[],this._aMarkers=[],this._iPrevChangePos=1,this._iPrevChangeFrom=0,this._iPrevChangeTo=0,this.unSync("psValue"),this._sControlClass="WebSlider"}create(e){super.create(e),this.piSliderValue<this.piMinValue?this.piSliderValue=this.piMinValue:this.piSliderValue>this.piMaxValue&&(this.piSliderValue=this.piMaxValue),this._iPrevChangePos=this.piSliderValue,this.assertions(),this.piSliderValue>this.piMaxValue?this.piSliderValue=this.piMaxValue:this.piSliderValue<this.piMinValue&&(this.piSliderValue=this.piMinValue),this.pbRanged?(this.addSync("piFrom"),this.addSync("piTo")):this.addSync("piSliderValue")}openHtml(e){super.openHtml(e),this.pbShowValue&&e.push('<div class="WebSlider_ValueIndicatorWrapper">1</div>'),e.push('<div class="WebSlider_Wrapper',this.pbVertical?" WebSlider_Vertical":" WebSlider_Horizontal",this.pbRanged?" WebSlider_Range":" WebSlider_NoRange",'" ',this.isEnabled()?'tabindex="0"':'tabindex="-1"',">"),e.push('<div class="WebSlider_BarWrapper">'),e.push('<div class="WebSlider_Bar">'),e.push('<div class="WebSlider_InnerBar">'),this.pbShowRange&&e.push('<div class="WebSlider_ShowRange"></div>'),e.push("</div></div>"),e.push("</div>"),e.push('<div class="WebSlider_Labels">'),this.generateMarkers(),this.renderLabels(e),e.push("</div>"),e.push('<div class="WebSlider_SliderWrapper">'),e.push('<div class="WebSlider_Slider"></div>'),this.pbRanged&&e.push('<div class="WebSlider_SliderRanged WebSlider_Slider"></div>'),e.push("</div>")}closeHtml(e){e.push("</div>")}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebSlider_Wrapper"),this._eSlider=r.dom.query(this._eElem,"div.WebSlider_Slider"),this._eSliderWrp=r.dom.query(this._eElem,"div.WebSlider_SliderWrapper"),this._eSliderBar=r.dom.query(this._eElem,"div.WebSlider_Bar"),this._eSliderBarWrp=r.dom.query(this._eElem,"div.WebSlider_BarWrapper"),this._eSliderBarInner=r.dom.query(this._eElem,"div.WebSlider_InnerBar"),this._eLabels=r.dom.query(this._eElem,"div.WebSlider_Labels"),this._eValueIndicator=r.dom.query(this._eElem,"div.WebSlider_ValueIndicatorWrapper"),this.pbRanged&&(this._eRangedSlider=r.dom.query(this._eElem,"div.WebSlider_SliderRanged")),this.pbShowRange&&(this._eRangeIndicator=r.dom.query(this._eElem,"div.WebSlider_ShowRange")),super.afterRender(),this.updateDisplay(),window.PointerEvent?r.dom.on("pointerdown",this._eControl,this.onPointerDown,this):r.dom.on("touchstart",this._eControl,this.onTouchDown,this),r.events.addDomMouseWheelListener(this._eSliderWrp,this.onMouseWheelScroll,this),this.pbRanged&&r.dom.on("mousedown",this._eRangedSlider,this.onMouseDown,this),r.dom.on("mousedown",this._eSlider,this.onMouseDown,this),r.dom.on("click",this._eLabels,this.onLabelClick,this),r.dom.on("click",this._eControl,this.onSliderClick,this)}assertions(){if(this.piInterval<=0)throw new r.Error(999,"The piInterval needs to be a positive number",this);if(this.piMaxValue===this.piMinValue)throw new r.Error(999,"Please specify a Max and a Min value",this);if(this.piMaxValue<this.piMinValue)throw new r.Error(999,"The max value is smaller then the min value",this);if((this.piMaxValue-this.piMinValue)%this.piInterval>0)throw new r.Error(999,"Your maximum, minimum and interval value do not match properly",this);if(this.piSliderValue<this.piMinValue||this.piSliderValue>this.piMaxValue)throw new r.Error(999,"Please specify the piSliderValue with a number between the piMinValue and piMaxValue",this);if((this.piSliderValue-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piSliderValue)%this.piInterval>0)throw new r.Error(999,"The piSliderValue value is unreachable with the specified interval.",this);if(this.pbRanged){if(this.piFrom<this.piMinValue||this.piFrom>this.piMaxValue)throw new r.Error(999,"Please specify the piFrom with a number between the piMinValue and piMaxValue",this);if(this.piTo<this.piMinValue||this.piTo>this.piMaxValue)throw new r.Error(999,"Please specify the piTo with a number between the piMinValue and piMaxValue",this);if((this.piFrom-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piFrom)%this.piInterval>0)throw new r.Error(999,"The piRangedValue value is unreachable with the specified interval.",this);if((this.piTo-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piTo)%this.piInterval>0)throw new r.Error(999,"The piTo value is unreachable with the specified interval.",this)}}getVertHeightDiff(){let e=super.getVertHeightDiff();return this._eValueIndicator&&this.pbVertical&&(e+=this._eValueIndicator.offsetHeight),e}resize(e){this.positionLabels(),this.updateDisplay()}updateDisplay(){let e,t;if(this._eElem){const i=this.getInterval()/this.piInterval;if(this.pbRanged){const e=i*(this.piFrom-this.piMinValue),s=i*(this.piTo-this.piMinValue);this.pbVertical?(this._eRangedSlider.style.top=e+"px",this._eSlider.style.top=s+"px"):(this._eRangedSlider.style.left=e+"px",this._eSlider.style.left=s+"px"),this.pbShowValue&&(this._eValueIndicator.innerHTML=this.piFrom+"-"+this.piTo),this.pbShowRange&&(this.pbVertical?(this._eRangeIndicator.style.top=e+"px",this._eRangeIndicator.style.height=s-e+"px"):(this._eRangeIndicator.style.left=e+"px",t=s-e,t=t<0?-t:t,this._eRangeIndicator.style.width=t+"px"))}else e=i*(this.piSliderValue-this.piMinValue),this.pbVertical?this._eSlider.style.top=e+"px":this._eSlider.style.left=e+"px",this.pbShowValue&&(this._eValueIndicator.innerHTML=this.piSliderValue),this.pbShowRange&&(this.pbVertical?(this._eRangeIndicator.style.top="0px",this._eRangeIndicator.style.height=e+"px"):(this._eRangeIndicator.style.left="0px",e=e<0?-e:e,this._eRangeIndicator.style.width=e+"px"))}}fillLabels(){this._tActionData&&(this._aLabels=r.sys.vt.deserialize(this._tActionData,[{sN:r.tString,sV:r.tString}]),this.generateMarkers(),this.updateLabels())}generateMarkers(){var e,t,i;const s=this._aLabels;if(this._aMarkers=[],this.pbShowMarkers){t=this.piMaxMarkers;const s=(this.piMaxValue-this.piMinValue)/(t-1);if(s<this.piInterval)i=this.piInterval;else for(i=this.piInterval;i<s||(this.piMaxValue-this.piMinValue)%i;)i+=this.piInterval;t=(this.piMaxValue-this.piMinValue)/i;for(let s=0;s<=t;s++)(e={}).piSliderValue=i*s+this.piMinValue,e.psLabel="",this._aMarkers.push(e)}if(s)for(let t=0;t<s.length;t++)(e={}).piSliderValue=parseFloat(s[t].sV,10),e.psLabel=s[t].sN,e.piSliderValue%this.piInterval==0&&e.piSliderValue<=this.piMaxValue&&e.piSliderValue>=this.piMinValue&&this._aMarkers.push(e);this._aMarkers=this._aMarkers.sort(this.sortLabels),this._aMarkers=this.removeDoubleValues(this._aMarkers)}sortLabels(e,t){return e.piSliderValue<t.piSliderValue?-1:e.piSliderValue>t.piSliderValue?1:e.piSliderValue===t.piSliderValue?0:void 0}removeDoubleValues(e){const t=[];for(let i=0;i<e.length;i++)i+1===e.length?t.push(e[i]):e[i].piSliderValue===e[i+1].piSliderValue?(e[i].psLabel.length>e[i+1].psLabel.length?t.push(e[i]):t.push(e[i+1]),i++):t.push(e[i]);return t}renderLabels(e){e.push('<div class="WebSlider_LabelMarkerWrapper"',0!==this._aLabels.length||this.pbShowMarkers?"":' style="display: none;"',">");for(let t=0;t<this._aMarkers.length;t++)e.push('<div class="WebSlider_LabelMarker" data-labelIndex="',t,'"></div>');e.push('</div><div class="WebSlider_LabelWrapper"',0===this._aLabels.length?' style="display: none;"':"",">");for(let t=0;t<this._aMarkers.length;t++)""!==this._aMarkers[t].psLabel&&e.push('<div class="WebSlider_LabelText" data-labelIndex="',t,'">',this._aMarkers[t].psLabel,"</div>");e.push("</div>")}positionLabels(){let e,t,i;const s=this.getInterval()/this.piInterval,o=r.dom.query(this._eLabels,"div.WebSlider_LabelText",!0),n=r.dom.query(this._eLabels,"div.WebSlider_LabelMarker",!0);i=this.pbVertical?this._eSlider.offsetHeight/2:this._eSlider.offsetWidth/2;for(let t=0;t<n.length;t++)e=0,e=i+s*(this._aMarkers[t].piSliderValue-this.piMinValue),this.pbVertical?n[t].style.top=e+"px":n[t].style.left=e+"px";for(let n=0;n<o.length;n++){e=0;const r=this._aMarkers[o[n].getAttribute("data-labelIndex")].piSliderValue;e=i+s*(r-this.piMinValue),this.pbVertical?(e-=o[n].offsetHeight/2,o[n].style.top=e+"px"):(t=(r-this.piMinValue)/(this.piMaxValue-this.piMinValue),t=.6*(t-.5)+.5,e-=t*o[n].offsetWidth,o[n].style.left=e+"px")}}updateLabels(){const e=[];this._eElem&&(this.renderLabels(e),this._eLabels.innerHTML=e.join(""),this.positionLabels())}increment(e,t){this.pbRanged?t?e?this.piTo<this.piMaxValue?this.piTo+=this.piInterval:this.piFrom>this.piMinValue&&(this.piFrom-=this.piInterval):this.piFrom<this.piTo&&(this.piTo-=this.piInterval):e?this.piTo<this.piMaxValue&&(this.piTo+=this.piInterval,this.piFrom+=this.piInterval):this.piFrom>this.piMinValue&&(this.piTo-=this.piInterval,this.piFrom-=this.piInterval):e&&this.piSliderValue!==this.piMaxValue?this.piSliderValue+=this.piInterval:e||this.piSliderValue===this.piMinValue||(this.piSliderValue-=this.piInterval),this.updateDisplay(),this.fireChange()}getInterval(){return(this.pbVertical?this._eSliderBarInner.offsetHeight:this._eSliderBarInner.offsetWidth)/((this.piMaxValue-this.piMinValue)/this.piInterval)}toPositive(e){return e=Math.sqrt(Math.pow(e,2))}getMaximalSliderPosition(){let e;return e=this.pbVertical?this._eSliderBarInner.offsetHeight:this._eSliderBarInner.offsetWidth,e}onLabelClick(e){let t=e.getTarget();if(this.isEnabled()){for(;null===t.getAttribute("data-labelindex")||t===document;)if(t=t.parentNode,t===document)return;this.piSliderValue=this._aMarkers[t.getAttribute("data-labelIndex")].piSliderValue,this.updateDisplay(),this.fireChange(),this.onFocus()}}onMouseDown(e){this.slide(0,this._eRangedSlider===e.eSource&&this.pbRanged,e)}onPointerDown(e){let t;const i=10;if("pen"===e.e.pointerType||"touch"===e.e.pointerType){const s=e.e.clientX,o=e.e.clientY;t=this._eSlider.getBoundingClientRect(),s>t.left-i&&s<t.right+i&&o>t.top-i&&o<t.bottom+i?this.slide(1,!1,e):this.pbRanged&&(t=this._eRangedSlider.getBoundingClientRect(),s>t.left-i&&s<t.right+i&&o>t.top-i&&o<t.bottom+i&&this.slide(1,!0,e))}}onTouchDown(e){let t;const i=10,s=e.e.targetTouches[0].clientX,o=e.e.targetTouches[0].clientY;t=this._eSlider.getBoundingClientRect(),s>t.left-i&&s<t.right+i&&o>t.top-i&&o<t.bottom+i?this.slide(2,!1,e):this.pbRanged&&(t=this._eRangedSlider.getBoundingClientRect(),s>t.left-i&&s<t.right+i&&o>t.top-i&&o<t.bottom+i&&this.slide(2,!0,e))}onMouseWheelScroll(e){if(this.pbMouseWheelScroll){const t=e.getMouseWheelDelta();t>0?this.increment(!1,!1):t<0&&this.increment(!0,!1),e.stop()}}slide(e,t,i){let s;const o=this.pbVertical;if(!this.isEnabled())return;function n(t){return 0===e?o?t.getMouseY():t.getMouseX():1===e?o?t.e.clientY:t.e.clientX:2===e?o?t.e.targetTouches[0].clientY:t.e.targetTouches[0].clientX:0}const a=this.getInterval(),l=r.gui.dragMask(this.topLayer()||document.body);l.style.cursor=o?"s-resize":"e-resize";const h=n(i);function d(e){let i,o;const r=n(e);if(o=(r-h)/a,o=Math.round(this.toPositive(o)),h>r&&(o*=-1),i=o*this.piInterval+s,i<this.piMinValue?i=this.piMinValue:i>this.piMaxValue&&(i=this.piMaxValue),this.pbRanged){if(t){if(this.piFrom=i,this.piFrom>this.piTo){t=!1;const e=this.piFrom;this.piFrom=this.piTo,this.piTo=e}}else if(this.piTo=i,this.piTo<this.piFrom){t=!0;const e=this.piFrom;this.piFrom=this.piTo,this.piTo=e}}else this.piSliderValue=i;this.updateDisplay()}function p(t){l.parentNode.removeChild(l),0===e?(r.dom.off("mouseup",window,p,this),r.dom.off("mouseup",l,p,this),r.dom.off("mousemove",l,d,this)):1===e?(r.dom.off("pointerup",window,p,this),r.dom.off("pointerup",l,p,this),r.dom.off("pointermove",window,d,this)):2===e&&(r.dom.off("touchend",window,p,this),r.dom.off("touchend",l,p,this),r.dom.off("touchmove",window,d,this)),this.fireChange()}s=this.pbRanged?t?this.piFrom:this.piTo:this.piSliderValue,0===e?(r.dom.on("mouseup",window,p,this),r.dom.on("mouseup",l,p,this),r.dom.on("mousemove",l,d,this)):1===e?(r.dom.on("pointerup",window,p,this),r.dom.on("pointerup",l,p,this),r.dom.on("pointermove",window,d,this)):2===e&&(r.dom.on("touchend",window,p,this),r.dom.on("touchend",l,p,this),r.dom.on("touchmove",window,d,this)),i.stop(),this.focus()}onSliderClick(e){let t,i;if(!this.isEnabled())return;const s=this._eSliderBarInner.getBoundingClientRect();if(!(e.getMouseY()>=s.top-2&&e.getMouseY()<=s.bottom+2&&e.getMouseX()>=s.left-2&&e.getMouseX()<=s.right+2))return;t=this.pbVertical?e.getMouseY()-s.top:e.getMouseX()-s.left;const o=t/(this.getInterval()/this.piInterval);i=Math.round(o/this.piInterval)*this.piInterval+this.piMinValue,i<this.piMinValue?i=this.piMinValue:i>this.piMaxValue&&(i=this.piMaxValue),this.pbRanged?i<this.piFrom?this.piFrom=i:i>this.iTo?this.piTo=i:i-this.piFrom<this.piTo-i?this.piFrom=i:this.piTo=i:this.piSliderValue=i,this.updateDisplay(),this.fireChange()}onKey(e){return e.matchKey(r.settings.sliderKeys.sliderDown)?(this.increment(this.pbVertical,!this.pbVertical),void e.stop()):e.matchKey(r.settings.sliderKeys.sliderUp)?(this.increment(!this.pbVertical,!this.pbVertical),void e.stop()):e.matchKey(r.settings.sliderKeys.sliderLeft)?(this.increment(!1,this.pbVertical),void e.stop()):e.matchKey(r.settings.sliderKeys.sliderRight)?(this.increment(!0,this.pbVertical),void e.stop()):void super.onKey(e)}fireChange(){this._iPrevChangePos===this.piSliderValue&&this._iPrevChangeFrom===this.piFrom&&this._iPrevChangeTo===this.piTo||(this.pbChanged=!0,this.fire("OnChange",[this.piSliderValue,this._iPrevChangePos]),this._iPrevChangePos=this.piSliderValue,this._iPrevChangeFrom=this.piFrom,this._iPrevChangeTo=this.piTo)}set_piMinValue(e){this.piMinValue=e,this.resize(),this.generateMarkers(),this.updateLabels()}set_piMaxValue(e){this.piMaxValue=e,this.updateDisplay(),this.generateMarkers(),this.updateLabels()}set_piInterval(e){this.piInterval=e,this.updateDisplay(),this.generateMarkers(),this.updateLabels()}set_pbShowMarkers(e){this.pbShowMarkers=e,this.generateMarkers(),this.updateLabels()}set_piSliderValue(e){return e>this.piMaxValue?this.piSliderValue=this.piMaxValue:e<this.piMinValue?this.piSliderValue=this.piMinValue:this.piSliderValue=e,this._iPrevChangePos=this.piSliderValue,this.updateDisplay(),!1}set_piFrom(e){const t=this;return e>this.piMaxValue?this.piFrom=this.piMaxValue:e<this.piMinValue?this.piFrom=this.piMinValue:this.piFrom=e,this._iPrevChangeFrom=this.piFrom,this.piFrom>this.piTo?setTimeout((function(){if(t.piFrom>t.piTo){const e=t.piFrom,i=t._iPrevChangeFrom;t.piFrom=t.piTo,t.piTo=e,t._iPrevChangeFrom=t._iPrevChangeTo,t._iPrevChangeTo=i}t.updateDisplay()}),10):this.updateDisplay(),!1}set_piTo(e){const t=this;return e>this.piMaxValue?this.piTo=this.piMaxValue:e<this.piMinValue?this.piTo=this.piMinValue:this.piTo=e,this._iPrevChangeTo=this.piTo,this.piFrom>this.piTo?setTimeout((function(){if(t.piFrom>t.piTo){const e=t.piFrom,i=t._iPrevChangeFrom;t.piFrom=t.piTo,t.piTo=e,t._iPrevChangeFrom=t._iPrevChangeTo,t._iPrevChangeTo=i}t.updateDisplay()}),10):this.updateDisplay(),!1}get_pbChanged(){return this.pbChanged}get_psValue(){return this.piSliderValue.toString()}set_psValue(e){}attachFocusEvents(){this._eControl&&this.isEnabled()&&this.pbVisible&&(r.events.addDomCaptureListener("focus",this._eControl,this.onFocus,this),r.dom.on("blur",this._eControl,this.onBlur,this))}focus(){return!!(this._bFocusAble&&this.isEnabled()&&this._eControl)&&(this._eControl.focus(),this.objFocus(),!0)}onFocus(e){super.onFocus(e),this.focus(),this._bLozingFocus=!1}onBlur(e){const t=this;this._bLozingFocus=!0,setTimeout((function(){t._bLozingFocus&&(t.getWebApp().objBlur(t),t._eElem&&r.dom.removeClass(t._eElem,"WebCon_Focus"),t._bHasFocus=!1,t._bLozingFocus=!1)}),100)}},r.WebSpacer=T,r.WebHorizontalLine=class extends b{constructor(e,t){super(e,t),this._sControlClass="WebHorizontalLine",this._bFocusAble=!1}openHtml(e){super.openHtml(e),e.push("<hr/>")}closeHtml(e){super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"hr"),super.afterRender()}set_psBackgroundColor(e){this._eControl&&(this._eControl.style.backgroundColor=e||"",this._eControl.style.color=e||"")}},r.WebTimer=class extends c{constructor(e,t){super(e,t),this.prop(r.tBool,"pbAutoStart",!0),this.prop(r.tBool,"pbAutoStop",!0),this.prop(r.tInt,"piInterval",2e3),this.prop(r.tBool,"pbRunning",!1),this.prop(r.tBool,"pbWaitForCall",!0),this.event("OnTimer",r.cCallModeDefault),this._tInterval=null,this._tTimeout=null,this._oView=null,this.addSync("pbRunning")}create(){super.create(),this._oView=this.getView(),this._oView?(this._oView.OnShow.on(this.showView,this),this._oView.OnHide.on(this.hideView,this)):this.pbAutoStart&&(this.pbRunning=!0,this.trigger())}destroy(){super.destroy(),this._oView&&(this._oView.OnShow.off(this.showView,this),this._oView.OnHide.off(this.hideView,this))}timer(){this.pbRunning&&this.fire("OnTimer",[],(function(){this.trigger()}))}trigger(){const e=this;this.pbRunning?this.pbWaitForCall?(this._tInterval&&(clearInterval(this._tInterval),this._tInterval=null),this._tTimeout&&clearTimeout(this._tTimeout),this._tTimeout=setTimeout((function(){e.timer()}),this.piInterval)):this._tInterval||(this._tInterval=setInterval((function(){e.timer()}),this.piInterval)):(this._tInterval&&(clearInterval(this._tInterval),this._tInterval=null),this._tTimeout&&(clearTimeout(this._tTimeout),this._tTimeout=null))}set_pbRunning(e){this.pbRunning=e,this.trigger()}set_piInterval(e){this.piInterval!==e&&(this.piInterval=e,this._tInterval&&(clearInterval(this._tInterval),this._tInterval=null),this.trigger())}set_pbWaitForCall(e){this.pbWaitForCall=e,this.trigger()}showView(e){this.pbAutoStart&&(this.pbRunning=!0,this.trigger())}hideView(e){this.pbAutoStop&&(this.pbRunning=!1,this.trigger())}},r.WebProgressBar=I,r.WebFileUploadButton=class extends B{constructor(e,t){super(e,t),this.prop(r.tString,"psCaption","Select file(s)"),this.prop(r.tInt,"peAlign",-1),this._sControlClass="WebButton WebUploadBtn"}openHtml(e){super.openHtml(e),e.push('<button id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled"'),this.peAlign>=0&&e.push(' style="text-align: ',r.sys.gui.cssTextAlign(this.peAlign),'"'),e.push(">",r.dom.encodeHtml(this.psCaption),"</button>"),this.fileHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"button"),super.afterRender(),r.dom.on("click",this._eControl,this.onBtnClick,this)}onBtnClick(e){const t=this._eElem;this.isEnabled()&&(r.dom.addClass(t,r.CssHit),setTimeout((function(){r.dom.removeClass(t,r.CssHit)}),r.hitTimeout),this.selectFiles())}set_psCaption(e){this._eControl&&r.dom.setText(this._eControl,e)}set_peAlign(e){this._eControl&&(this._eControl.style.textAlign=r.sys.gui.cssTextAlign(e))}applyEnabled(e){super.applyEnabled(e),this._eControl&&(this._eControl.disabled=!e)}},r.WebFileUploadForm=class extends B{constructor(e,t){super(e,t),this.prop(r.tInt,"peState",r.ciUploadStateEmpty),this.prop(r.tBool,"pbShowMime",!1),this.prop(r.tString,"psFileName",""),this.prop(r.tInt,"piFileSize",0),this.prop(r.tString,"psFileMime",""),this.event("OnFileClick",r.cCallModeWait),this.addSync("peState"),this._sControlClass="WebFileFrm"}openHtml(e){super.openHtml(e),e.push('<div class="WebFrm_Wrapper" tabindex="0"><div><div class="WebFile_Btn">'),this.fileHtml(e),e.push('</div><div class="WebFile_Content"></div></div></div>')}afterRender(){this._eControl=this._eWrap=r.dom.query(this._eElem,"div.WebFrm_Wrapper"),this._eContent=r.dom.query(this._eElem,"div.WebFile_Content"),this._ePrompt=r.dom.query(this._eElem,"div.WebFile_Btn"),super.afterRender(),r.dom.on("click",this._eContent,this.onContentClick,this),r.dom.on("click",this._ePrompt,this.onPromptClick,this),r.events.addDomKeyListener(this._eControl,this.onKey,this),this.updateDetails()}onPromptClick(e){this.isEnabled()&&this.selectFiles()}onKey(e){e.matchKey(r.settings.formKeys.prompt)?this.isEnabled()&&(this.selectFiles(),e.stop()):e.matchKey(r.settings.tabKeys.enter)&&this.fireContentClick()&&e.stop()}fireContentClick(){return!(!this.isEnabled()||this.peState!==r.ciUploadStateFinished&&this.peState!==r.ciUploadStateDisplay)&&(this.fire("OnFileClick"),!0)}updateDetails(){let e;this._eWrap&&(this.psFileName?(this.peState===r.ciUploadStateSelected?r.dom.addClass(this._eWrap,"WebFile_Pending"):r.dom.addClass(this._eWrap,"WebFile_HasFile"),e=this.psFileName,this.pbShowMime&&this.piFileSize>0&&this.psFileMime?e+=" (Size: "+r.sys.data.markupDataSize(this.piFileSize)+", Mime: "+this.psFileMime+")":this.piFileSize>0&&(e+=" ("+r.sys.data.markupDataSize(this.piFileSize)+")")):(r.dom.removeClass(this._eWrap,"WebFile_HasFile"),r.dom.removeClass(this._eWrap,"WebFile_Pending"),e=this.getWebApp().getTrans("no_file_selected")),r.dom.toggleClass(this._eContent,"WebFile_OnClick",this.pbServerOnFileClick&&(this.peState===r.ciUploadStateFinished||this.peState===r.ciUploadStateDisplay)),this._eContent.innerHTML='<div class="WebFile_Details">'+e+"</div>")}displaySelectedFileDetails(){if(this._aFiles.length>0){const e=this._aFiles[0].oFile;this.addSync("psFileName"),this.addSync("piFileSize"),this.addSync("psFileMime"),this._eState=this.peState,this.peState===r.ciUploadDisplay&&(this._sDisplayFileName=this.psFileName,this._iDisplayFileSize=this.piFileSize,this._sDisplayFileMime=this.psFileMime),this.peState=r.ciUploadStateSelected,this.psFileName=e.name,this.piFileSize=e.size,this.psFileMime=e.type}this.updateDetails()}displayStartWorking(){this.pbShowDialog?super.displayStartWorking():this._eContent.innerHTML='<div class="WebFile_Working"></div>'}displayProgress(e,t,i,s,o,n){if(this.pbShowDialog)super.displayProgress(e,t,i,s,o,n);else{const e=o/n*100;this._eBar||(this._eContent.innerHTML='<div class="WebFile_Progress"><div class="WebFile_ProgressBar" style="width: 0%;"></div><div class="WebFile_ProgressLabel">0%</div></div>',this._eBar=r.dom.query(this._eContent,"div.WebFile_ProgressBar"),this._eLbl=r.dom.query(this._eContent,"div.WebFile_ProgressLabel")),this._eBar.style.width=Math.round(10*e)/10+"%",r.dom.setText(this._eLbl,Math.round(e)+"%")}}displayFinishWorking(){this.pbShowDialog?super.displayFinishWorking():this._eBar&&(this._eBar.style.width="100%")}displayFinished(e){this._eBar=null,this._eLbl=null,this.peState=e?r.ciUploadStateFinished:r.ciUploadStateSelected,this.updateDetails(),super.displayFinished(e)}onContentClick(e){this.fireContentClick()}applyEnabled(e){super.applyEnabled(e),this._eControl&&r.dom.setTabIndex(this._eControl,e?0:-1)}},r.WebGroup=qe,r.WebBreadcrumb=class extends b{constructor(e,t){super(e,t),this.prop(r.tInt,"peBreadcrumbStyle",r.cCrumbHorizontal),this._eControl=null,this._eList=null,this._eCaption=null,this._eMask=null,this._aItems=[],this._bRedraw=!1,this._bDropDownExpanded=!1,this._tHideTimeout=null,this._bWrapDiv=!0,this._sControlClass="WebBreadcrumb"}openHtml(e){super.openHtml(e),this.peBreadcrumbStyle===r.cCrumbHorizontal?e.push('<div class="WebCrumbs_Body WebCrumbs_Horiz" tabindex="-1">'):e.push('<div class="WebCrumbs_Body WebCrumbs_DropDown" tabindex="-1">')}closeHtml(e){e.push("</div>"),super.closeHtml(e)}afterRender(){this._eControl=r.dom.query(this._eElem,"div.WebCrumbs_Body"),super.afterRender(),r.dom.on("click",this._eControl,this.onBodyClick,this),this.redraw()}set_peBreadcrumbStyle(e){this._eControl&&this.peBreadcrumbStyle!==e&&(this.peBreadcrumbStyle=e,this.redraw())}refresh(){const e=this.deserializeVT(this._tActionData);this.clear();for(let t=0;t<e.length;t++)this.append(e[t]);this.redraw()}onBodyClick(e){let t="",i=e.getTarget(),s=!1,o=!1;if(this.isEnabled()){for(this._tHideTimeout&&(clearTimeout(this._tHideTimeout),this._tHideTimeout=null);i&&!s&&i!==this._eElem;)i.className.indexOf("WebCrumb_Item")>=0?(t=i.getAttribute("data-dfview-name"),t&&this.doSelect(t),s=!0):i.className.indexOf("WebCrumb_DropDownBtn")>=0?(this.showDropDown(),o=!0,s=!0):i=i.parentNode;this._bDropDownExpanded&&!o&&this.hideDropDown(),s&&e.stop()}}onBlur(e){const t=this;super.onBlur(e),this._bDropDownExpanded&&(this._tHideTimeout&&clearTimeout(this._tHideTimeout),this._tHideTimeout=setTimeout((function(){t._tHideTimeout=null,t.hideDropDown()}),150))}onMaskTouch(e){this.hideDropDown(),e.stop()}doSelect(e){this.serverAction("OnSelect",[e])}showDropDown(){this._eList&&this._aItems.length>1&&(r.dom.addClass(this._eList,"WebCrumbs_Expanded"),this._bDropDownExpanded=!0,r.sys.isMobile&&(this._eMask=r.dom.create('<div class="WebMenu_Mask">&nbsp;</div>'),this._eElem.insertBefore(this._eMask,this._eElem.firstChild),r.dom.on("click",this._eMask,this.onMaskTouch,this)))}hideDropDown(){this._eList&&(r.dom.removeClass(this._eList,"WebCrumbs_Expanded"),this._bDropDownExpanded=!1,this._eMask&&(r.dom.off("click",this._eMask,this.onMaskTouch,this),this._eMask.parentNode.removeChild(this._eMask),this._eMask=null))}resize(e){if(this.peBreadcrumbStyle===r.cCrumbHorizontal&&this._eList&&this._eList.hasChildNodes()){const e=r.dom.query(this._eList,"li div.WebCrumb_Caption",!0);this.resetWidths(e),this.adjustWidths()}}resetWidths(e){for(let t=0;t<e.length;t++)e[t].style.width="auto",e[t].removeAttribute("title")}sumElementWidths(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].offsetWidth;return t}reduceWidthsToTarget_li(e,t){let i,s,o=null,n=0;if(0===e.length)return 0;const a=this.sumElementWidths(e)-t;if(a<=0)return 0;const l=Math.ceil(a/e.length);for(let t=0;t<e.length;t++){o=r.dom.query(e[t],"div.WebCrumb_Caption",!1),i=o.offsetWidth-l,i-=r.sys.gui.getHorizBoxDiff(o,0),i<15?(o.style.width="15px",n=n+15-i):(s=i.toString()+"px",o.style.width=s);const a=r.dom.getText(o);a&&o.setAttribute("title",a)}for(let t=0;t<e.length&&n>0;t++)o=r.dom.query(e[t],"div.WebCrumb_Caption",!1),o.offsetWidth>15&&(n=n+15-o.offsetWidth,o.style.width="15px");return n>0?n:0}adjustWidths(){let e,t,i;if(this._eList&&this._eList.hasChildNodes()){const s=this.sumElementWidths(r.dom.query(this._eList,"li",!0));this._eList.clientWidth<s&&(i=this._eList.getElementsByClassName("WebCrumb_Item"),i.length>0?(e=this._eList.clientWidth-this._eList.lastChild.offsetWidth,t=this.reduceWidthsToTarget_li(i,e)):t=this._eList.lastChild.offsetWidth-this._eList.clientWidth,t>0&&(i=this._eList.getElementsByClassName("WebCurrentCrumb"),e=this._eList.lastChild.offsetWidth-t-2,t=this.reduceWidthsToTarget_li(i,e)))}}deserializeVT=r.sys.vt.generateDeserializer([r.tWebBreadcrumbItem]);append(e){this._aItems.push(e)}clear(){this._eList?this._eList.innerHTML="":this._eControl&&(this._eList=this.constructList(),this._eControl.appendChild(this._eList)),this._aItems=[]}redraw(){const e=this._aItems,t=[];if(this._eControl){if(this._bRedraw=!0,this.peBreadcrumbStyle===r.cCrumbHorizontal?(r.dom.removeClass(this._eControl,"WebCrumbs_DropDown"),r.dom.addClass(this._eControl,"WebCrumbs_Horiz")):(r.dom.removeClass(this._eControl,"WebCrumbs_Horiz"),r.dom.addClass(this._eControl,"WebCrumbs_DropDown")),this.peBreadcrumbStyle===r.cCrumbHorizontal)this._eCaption&&(this._eControl.removeChild(this._eCaption),this._eCaption=null);else{if(!this._eCaption){const e=document.createElement("div");r.dom.addClass(e,"WebCrumb_Caption"),this._eControl.appendChild(e),this._eCaption=e}if(e.length){if(""===e[e.length-1].sHeadCaption.trim())t.push("&nbsp;");else{const i=e[e.length-1].sHeadCaption.trim();t.push(r.dom.encodeHtml(i))}this._eCaption.innerHTML=t.join("")}else this._eCaption.innerHTML="&nbsp;";e.length>1&&this.peBreadcrumbStyle===r.cCrumbDropDown?r.dom.addClass(this._eCaption,"WebCrumb_DropDownBtn"):r.dom.removeClass(this._eCaption,"WebCrumb_DropDownBtn")}this._eList?this._eList.innerHTML="":this.peBreadcrumbStyle!==r.cCrumbCaption&&(this._eList=this.constructList(),this._eControl.appendChild(this._eList)),this.peBreadcrumbStyle!==r.cCrumbCaption&&this.constructItems(e),this._bRedraw=!1}}constructList(){const e=document.createElement("ul");return e.setAttribute("class","WebCrumbs"),e}constructItems(e){let t=!1,i="";const s=[];0===e.length&&(s.push('<li class="WebCurrentCrumb">'),this.peBreadcrumbStyle===r.cCrumbHorizontal&&s.push('<div tabindex="-1">'),s.push('<div class="WebCrumb_Caption" tabindex="-1">'),s.push("&nbsp;"),s.push("</div>"),this.peBreadcrumbStyle===r.cCrumbHorizontal&&s.push("</div>"),s.push("</li>"));for(let o=0;o<e.length;o++)o===e.length-1&&(t=!0),i=t?'<li class="WebCurrentCrumb"':'<li class="WebCrumb_Item"',i=i+' data-dfview-name="'+e[o].sViewName+'">',s.push(i),this.peBreadcrumbStyle===r.cCrumbHorizontal&&(t?s.push('<div tabindex="-1">'):s.push('<div class="WebCrumb_Arrow" tabindex="-1">')),s.push('<div class="WebCrumb_Caption" tabindex="-1">'),""===e[o].sCrumbCaption.trim()?s.push("&nbsp;"):s.push(r.dom.encodeHtml(e[o].sCrumbCaption)),s.push("</div>"),this.peBreadcrumbStyle===r.cCrumbHorizontal&&s.push("</div>"),s.push("</li>");this._eList.innerHTML=s.join("")}},r.WebFloatingPanel=z,r.WebMenuButton=class extends O{constructor(e,t){super(e,t),this.prop(r.tBool,"pbRenderAsAnchor",!0),this.prop(r.tBool,"pbHideOnBlur",!0),this.prop(r.tString,"psCaption",""),this.prop(r.tInt,"piMenuWidth",300),this.prop(r.tInt,"piMenuHeight",0),this.prop(r.tString,"psMenuCSSClass",""),this.prop(r.tString,"psMenuRootCaption",""),this.prop(r.tBool,"pbMenuShowCaption",!0),this.prop(r.tBool,"pbMenuShowIcons",!1),this.prop(r.tString,"psGroupName",""),this.prop(r.tBool,"pbOpenOnRoot",!1),this.pbShowLabel=!1,this._oPnl=null,this._oMenuList=null,this._sRealgroupName="",this._bIsMenu=!0,this._sControlClass="WebMenuButton"}create(){this._sRealgroupName=this.psGroupName,this.psGroupName||(this.psGroupName="_WebMenuButtonGrp_"+r.dom.genDomId().toString()),super.create()}openHtml(e){this.pbRenderAsAnchor?this._sControlClass="WebMenuAnchor":this._sControlClass+=" WebButton",super.openHtml(e),this.pbRenderAsAnchor?e.push('<a id="',this._sControlId,'" href="javascript:void(0);" target="_self"',this.isEnabled()?"":' tabindex="-1"',"></a>"):e.push('<button id="',this._sControlId,'"',this.isEnabled()?"":' disabled="disabled"',"></button>")}afterRender(){this._eControl=r.dom.query(this._eElem,"button, a"),super.afterRender(),r.dom.on("click",this._eControl,this.onBtnClick,this),r.events.addDomKeyListener(this._eElem,this.onKey,this),this.set_psCaption(this.psCaption)}onBtnClick(e){this.isEnabled()&&(this._oPnl&&this._oPnl.pbVisible?this.hideMenu():this.showMenu(),e.stop())}showMenu(){if(this._oPnl)this.pbOpenOnRoot&&this._oMenuList.collapseAll();else{const e=this._oPnl=new z(null,this);e.psFloatByControl=this.getLongName(),e.piWidth=this.piMenuWidth||150,e.piColumnCount=1,e.psCSSClass="WebMBPanel "+this.psMenuCSSClass,e.pbHideOnBlur=this.pbHideOnBlur,e.piHeight=this.piMenuHeight,e.create();const t=this._oMenuList=new re(null,this);t._oMenuBtn=this,t.psGroupName=this.psGroupName,t.pbFillHeight=this.piMenuHeight>0,t.pbShowCaption=this.pbMenuShowCaption,t.pbShowIcons=this.pbMenuShowIcons,t.psRootCaption=this.psMenuRootCaption,t.pbAllowHtml=this.pbAllowHtml,t.create(),e.addChild(t);const i=e.render();i&&this._eElem.parentNode.insertBefore(i,this._eElem),e.afterRender(),e.resizeHorizontal(),e.resizeVertical()}this._oPnl.show()}hideMenu(){this._oPnl.hide()}collapseAll(){this._oMenuList?.collapseAll()}levelUp(){this._oMenuList?.levelUp()}set_psCaption(e){this._eControl&&(e?r.dom.setText(this._eControl,e):this._eControl.innerHTML="")}set_psGroupName(e){return this._sRealgroupName=e,e||(e=this.psGroupName="_WebMenuButtonGrp_"+r.dom.genDomId().toString()),this._oMenuList&&this._oMenuList.set("psGroupName",e),super.set_psGroupName(e),!1}get_psGroupName(){return this._sRealgroupName}set_pbMenuShowCaption(e){this._oMenuList&&this._oMenuList.set("pbShowCaption",e)}set_pbMenuShowIcons(e){this._oMenuList&&this._oMenuList.set("pbShowIcons",e)}set_psMenuRootCaption(e){this._oMenuList&&this._oMenuList.set("psRootCaption",e)}set_psMenuCSSClass(e){this._oPnl&&this._oPnl.set("psCSSClass","WebMBPanel "+e)}set_piMenuWidth(e){this._oPnl&&this._oPnl.set("piWidth",e)}set_piMenuHeight(e){this._oPnl&&(this._oMenuList.set("pbFillHeight",e>0),this._oPnl.set("piHeight",e))}set_pbHideOnBlur(e){this._oPnl&&this._oPnl.set("pbHideOnBlur",e)}set_pbAllowHtml(e){this._oMenuList&&this._oMenuList.set("pbAllowHtml",e)}applyEnabled(e){super.applyEnabled(e),this._eControl&&(this._eControl.disabled=!e)}onKey(e){e.matchKey(r.settings.formKeys.submit)&&e.stopPropagation()}resize(){this._oPnl&&this._oPnl.resize()}destroy(){this._oPnl&&this._oPnl.destroy(),super.destroy()}},r.WebMenuList=re,r.WebColorPicker=Ze,r.WebColorForm=class extends N{constructor(e,t){super(e,t),this.prop(r.tInt,"piPickWidth",300),this.prop(r.tInt,"piPickHeight",250),this.prop(r.tInt,"piPaletteItemsPerRow",8),this.prop(r.tInt,"peColorFormat",r.colorFormatHex),this.prop(r.tBool,"pbColorBackground",!1),this.prop(r.tBool,"pbAutoShow",!1),this.pbPromptButton=!0,this._sControlClass="WebForm WebColorForm"}afterRender(){super.afterRender(),r.dom.toggleClass(this._eWrap,"WebCF_ShowBox",!this.pbColorBackground),this._eColorBox=r.dom.create('<div class="WebCF_Box"></div>'),this._eWrap.insertBefore(this._eColorBox,this._eWrap.firstChild),r.dom.on("click",this._eColorBox,this.onColorClick,this),this.refreshDisplay(this._tValue)}initPicker(){const e=this._oFloatingPanel=new z(null,this);e.psFloatByControl=this.getLongName(),e.piWidth=this.piPickWidth,e.piHeight=this.piPickHeight,e.piColumnCount=1,e.pbHideOnBlur=!0,e.pbFocusOnShow=!0,e.pbHideOnEscape=!0,e.psCSSClass="NoWhitespace Shadow WebColorForm_FlPnl",e.OnHide.addListener(this.onPanelClose,this),e.create();const t=this._oColorPicker=new Ze(null,this);t.psValue=this.getServerVal(),t.piColumnSpan=0,t.pbFillHeight=!0,t.pbShowLabel=!1,t.pbShowColorBar=!1,t.peColorFormat=this.peColorFormat,t.psCSSClass="WebColorPicker_Form",t.piPaletteItemsPerRow=this.piPaletteItemsPerRow,t.OnRealtimeChange.addListener(this.onPickerChange,this),t.OnEnter.addListener(this.onPickerEnter,this),t.create(),e.addChild(t)}destroy(){this._oFloatingPanel&&this._oFloatingPanel.destroy(),super.destroy()}renderPicker(){const e=this._oFloatingPanel,t=e.render();t&&this._eElem.parentNode.insertBefore(t,this._eElem),e.afterRender(),e.resizeHorizontal(),e.resizeVertical()}firePrompt(){this.showPicker()}showPicker(){this._oFloatingPanel||this.initPicker(),this._oFloatingPanel._eElem||this.renderPicker(),this._oColorPicker.set("psValue",this.getServerVal()),this._oFloatingPanel.show()}onColorClick(e){this.isEnabled()&&this.showPicker()}onPickerChange(e){this._tValue=e.sColor,this.refreshDisplay(e.sColor)}onPickerEnter(e){this._tValue=e.sColor,this.refreshDisplay(e.sColor),this._oFloatingPanel.hide(),this.focus(),this.fireChange()}onPanelClose(e){const t=e.aParams[0];this.fireChange(),"auto_blur"!==t&&(this._bSkipAutoShow=!0,this.focus())}onPickerClose(e){this._oFloatingPanel.hide()}set_pbColorBackground(e){this.set_psBackgroundColor(e?this.getServerVal():""),this._eWrap&&r.dom.toggleClass(this._eWrap,"WebCF_ShowBox",!e)}setControlValue(e){super.setControlValue(e),this.pbColorBackground&&this.set_psBackgroundColor(e),this._eColorBox&&(this._eColorBox.style.backgroundColor=e)}set_piPickHeight(e){this._oFloatingPanel&&this._oFloatingPanel.set("piHeight",e)}set_piPickWidth(e){this._oFloatingPanel&&this._oFloatingPanel.set("piWidth",e)}set_piPaletteItemsPerRow(e){this._oColorPicker&&this._oColorPicker.set("piPaletteItemsPerRow",e)}addPaletteItem(e,t){this._oFloatingPanel||this.initPicker(),this._oColorPicker.addPaletteItem(e,t)}updatePalette(){this._oFloatingPanel||this.initPicker(),this._oColorPicker._tActionData=this._tActionData,this._oColorPicker.updatePalette(),this._oColorPicker._tActionData=null}onFocus(e){super.onFocus(e),this.pbAutoShow&&this.isEnabled()&&!this.pbReadOnly&&!this._bSkipAutoShow&&this.showPicker(),this._bSkipAutoShow=!1}},r.WebColumnHighlight=class extends be{constructor(e,t){super(e,t),this.prop(r.tString,"psHighlightCSSClass","WebHighlight"),this.prop(r.tString,"psHighlight",""),this.prop(r.tBool,"pbFullText",!0),this.prop(r.tBool,"pbSeparateWords",!0),this.prop(r.tBool,"pbCaseSensitive",!1),this._oRegEx=null}cellHtml(e,t){let i;const s=this.psHighlightCSSClass,o=r.sys.data.serverToType(t.sValue,this.peDataType);if(i=this.typeToDisplay(o),this.pbAllowHtml||(i=r.dom.encodeHtml(i)),this.psHighlight){const e=this.getRegEx();i=i.replace(e,(function(e){return'<span class="'+s+'">'+e+"</span>"}))}return""!==i?i:"&nbsp;"}set_psHighlight(e){this.psHighlight!==e&&(this.psHighlight=e,this._oRegEx=null)}set_psHighlightCSSClass(e){this.psHighlightCSSClass=e,this._oParent.redraw()}set_pbFullText(e){this.pbFullText=e,this._oRegEx=null,this._oParent.redraw()}set_pbSeparateWords(e){this.pbSeparateWords=e,this._oRegEx=null,this._oParent.redraw()}set_pbCaseSensitive(e){this.pbCaseSensitive=e,this._oRegEx=null,this._oParent.redraw()}getRegEx(){let e,t,i;if(!this._oRegEx){e=this.pbSeparateWords?this.psHighlight.split(" "):[this.psHighlight];for(let t=0;t<e.length;t++)e[t]=r.sys.data.escapeRegExp(e[t]);t="("+e.join("|")+")",this.pbFullText||(t="^"+t),i="g",this.pbCaseSensitive||(i+="i"),this._oRegEx=new RegExp(t,i)}return this._oRegEx}},r.WebAccordionContainer=class extends Ue{constructor(e,t){super(e,t),this.prop(df.tBool,"pbOpenFirst",!0),this.prop(df.tBool,"pbAutoHeight",!0),this.prop(df.tBool,"pbMultiOpen",!1),this._sControlClass="WebAccordion",this._sCardClass="WebAC",this._bCC=!1}headHtml(e){}afterRender(){const e=this;super.afterRender(),df.dom.on("transitionend",this._eElem,this.onTransEnd,this),this.openCardsAfterRender(),setTimeout((function(){df.dom.addClass(e._eElem,"WebAc_Rendered")}),100)}openCardsAfterRender(){if(this.pbMultiOpen)for(let e=0;e<this._aCards.length;e++){const t=this._aCards[e];(t.pbExpanded||t._bExpanded)&&this.showCard(t,!1)}}renderChildren(e){let t,i=this.hasDynamicHeight();if(this.pbOpenFirst){this.psCurrentCard&&(this._oCurrent=this.getWebApp().findObj(this.psCurrentCard));for(let e=0;e<this._aCards.length&&!this._oCurrent;e++)this._aCards[e].isActive()&&(this._oCurrent=this._aCards[e])}t=this._eControl=df.dom.query(this._eElem,"div."+this._sCardClass+"_Body");for(let e=0;e<this._aCards.length;e++){const s=[];this._aCards[e].tabButtonHtml(s);const o=df.dom.create(s.join(""));if(t.appendChild(o),this._aCards[e].btnRendered(o),i||this._aCards[e]===this._oCurrent){const i=this._aCards[e].render();t.appendChild(i)}}}showCard(e,t){const i=this;if(this.isEnabled()||t){if(this.pbMultiOpen)e&&!t&&(e._bExpanded=!0,e._show(),e.afterShow());else if(e&&e.isActive()){if(t||e===this._oCurrent||this.fireCardChange(e._sName,this._oCurrent&&this._oCurrent._sName||""),this._eElem)for(let i=0;i<this._aCards.length;i++){const s=this._aCards[i];s===e?(s._show(!!t),df.dom.setText(this._eLabel,s.psCaption)):s._hide(!!t)}this.pbMultiOpen||!t&&this._oCurrent&&this._oCurrent.afterHide(),this._oCurrent=e,t||this._oCurrent.afterShow(),this.getWebApp()&&this.getWebApp().notifyLayoutChange(this)}this.pbFillHeight||this.pbAutoHeight&&!this.pbMultiOpen||(this.sizeChanged(!0),setTimeout((function(){i.sizeChanged(!0)}),1e3))}}renderAllCards(){for(let e=0;e<this._aCards.length;e++){const t=this._aCards[e];if(!t._eElem){const e=t.render();if(!t._eBtn)throw new df.Error(999,"Assertion: Accordion card should have a button element!");t._eBtn.nextSibling?t._eBtn.parentNode.insertBefore(e,t._eBtn.nextSibling):t._eBtn.parentNode.appendChild(e),t.afterRender()}}}sizeHeight(e){let t=-1;if(this.pbFillHeight?t=e:this.piHeight>0&&(t=this.piHeight),t<this.piMinHeight&&(t=this.piMinHeight),this.setHeight(t),t>0)return t}setHeight(e){super.setHeight(e),this.pbFillHeight&&this._oCurrent&&(this._oCurrent._eElem.style.height=this.getCardHeight(this._oCurrent)+"px")}getCardHeight(e,t){let i;if(this.pbAutoHeight||this.pbFillHeight){if(this.piHeight>0||this.pbFillHeight){i=df.dom.clientHeight(this._eControl),i-=df.sys.gui.getVertBoxDiff(this._eControl,2);for(var s=0;s<this._aCards.length;s++)this._aCards[s]._eBtn&&(i-=this._aCards[s]._eBtn.offsetHeight);return i}return this.getNaturalHeight()-this.getHeightDiff()}return e&&df.dom.clientHeight(e._eSizer)||0}attachFocusEvents(){}resize(){let e=0;if(this._eElem&&this._bRendered){(this.pbAutoHeight||this.pbFillHeight)&&(e=this.getCardHeight(null));for(let t=0;t<this._aCards.length;t++)this._aCards[t]._eElem&&(this._aCards[t]._eContainer.style.height=e>0?e+"px":"",this._aCards[t].resizeHorizontal(),this._aCards[t].resizeVertical());this.pbFillHeight||this.sizeHeight(-1)}}onTransEnd(e){this.sizeChanged(!0)}set_pbMultiOpen(e){if(this.pbMultiOpen=e,!e){for(let e=0;e<this._aCards.length;e++)this._aCards[e]._bExpanded=!1;this._oCurrent&&this.showCard(this._oCurrent)}}set_pbAutoHeight(e){this.pbAutoHeight!==e&&(this.pbAutoHeight=e,this.triggerCardResize(!e))}set_pbFillHeight(e){this.pbFillHeight!==e&&(super.set_pbFillHeight(e),this.triggerCardResize(!e))}triggerCardResize(e){if(e)for(let e=0;e<this._aCards.length;e++)this._aCards[e].setInnerHeight(0);if(this.pbMultiOpen)for(let e=0;e<this._aCards.length;e++)this._aCards[e]._bExpanded&&this._aCards[e]._show();else this._oCurrent&&this.showCard(this._oCurrent);this.sizeChanged(!0)}},r.WebAccordionCard=class extends Ge{constructor(e,t){super(e,t),this.prop(df.tBool,"pbExpanded",!1),this.prop(df.tString,"psBtnBackgroundColor",""),this._bExpanded=!1,this.addSync("pbExpanded"),this._sControlClass="WebAcCard",this._sBaseClass="",this._bCC=!1}wrpOpenHtml(e){e.push('<div class="WebContainer">')}wrpCloseHtml(e){e.push("</div>")}afterRender(){super.afterRender(),this._bPanels?df.dom.on("transitionend",this._eMainArea,this.onTransEndCancel,this):df.dom.on("transitionend",this._eContent,this.onTransEndCancel,this),this.psBtnBackgroundColor&&this.set_psBtnBackgroundColor(this.psBtnBackgroundColor)}show(){this._bExpanded||super.show()}hide(){this._bExpanded&&this._oParent.pbMultiOpen&&(this._bExpanded=!1,this._hide(),this.afterHide())}onBtnClick(e){this.isEnabled()&&(this._bExpanded?this._oParent.pbMultiOpen&&this.hide():this.show()),e.stop()}_hide(e){this._eElem&&(this._eElem.style.visibility="hidden",df.dom.addClass(this._eElem,"WebAcCard_Hidden"),df.dom.removeClass(this._eElem,"WebAcCard_Visible"),df.dom.removeClass(this._eBtn,"WebTab_Current"),this._eElem.style.height="0px"),!e&&this._bCurrent&&this.fire("OnHide"),this._bCurrent=!1}_show(e){if(!this._eElem&&this._oParent._eElem){var t=this.render();if(!this._eBtn)throw new df.Error(999,"Assertion: Accordion card should have a button element!");this._eBtn.nextSibling?this._eBtn.parentNode.insertBefore(t,this._eBtn.nextSibling):this._eBtn.parentNode.appendChild(t),this.afterRender(),this._oParent.resize()}this._eElem&&(this._eElem.style.visibility="inherit",df.dom.addClass(this._eElem,"WebAcCard_Visible"),df.dom.removeClass(this._eElem,"WebAcCard_Hidden"),df.dom.addClass(this._eBtn,"WebTab_Current"),this._eElem.style.height=this._oParent.getCardHeight(this)+"px"),e||this._bCurrent||this.fire("OnShow"),this._bCurrent=!0}get_pbExpanded(){return this._bExpanded}set_pbExpanded(e){this._Elem&&e!==this._bExpanded&&this.show()}set_psBtnBackgroundColor(e){this._eBtn&&(this._eBtn.style.background=e||"")}onTransEndCancel(e){e.stopPropagation()}},r.WebHtmlList=class extends _e{constructor(e,t){super(e,t),this.prop(r.tString,"psHtmlBefore",""),this.prop(r.tString,"psHtmlTemplate",""),this.prop(r.tString,"psHtmlAfter",""),this.prop(r.tInt,"peDropPosDetectionMode",0),this._oColMap={},this._sHtmlTemplate,this.event("OnElemClick",r.cCallModeWait),this._sControlClass="WebHtmlList"}create(){this._sHtmlTemplate=this.initTemplate(this.psHtmlTemplate),super.create()}createTouchHandler(){return null}createPlaceHolder(){return null}createHeaderView(){return null}createRowModel(){return new Ye(this,this._oModel)}createView(){return new Je(this,this._oModel,this._oController)}createController(){return new ie(this,this._oModel)}createModel(){return new $(this)}focusHtml(e){}addChild(e){super.addChild(e),e._bIsColumn&&(this._oColMap[e._sName]=e)}initTemplate(e){return e.replace(/<\/?\w+/i,(e=>e+' data-dfisrow="true" data-dfrowid="{{dfrowid}}" draggable="{{isDraggable}}"'))}updateTemplate(e){this.set_psHtmlTemplate(e)}set_psHtmlTemplate(e){this._sHtmlTemplate=this.initTemplate(e),this.redraw()}set_psHtmlBefore(e){this.psHtmlBefore=e,this.redraw()}set_psHtmlAfter(e){this.psHtmlAfter=e,this.redraw()}determineDropPosition(e,t){return 0==this.peDropPosDetectionMode?this.determineDropPosVertical(e,t):this.determineDropPosHorizontal(e,t)}determineDropPosVertical(e,t){const i=r.sys.gui.getBoundRect(t),s=i.bottom-i.height/2;return e.e.clientY>=s?r.dropPositions.ciDropAfter:r.dropPositions.ciDropBefore}determineDropPosHorizontal(e,t){const i=r.sys.gui.getBoundRect(t),s=i.right-i.width/2;return e.e.clientX>=s?r.dropPositions.ciDropAfter:r.dropPositions.ciDropBefore}interactWithDropElem(e,t){if(e._eDropAction==r.dropActions.WebControl.ciDropOnControl)e.highlightElement();else{let i=r.dom.create(this._sHtmlTemplate.replace(this._oRowRenderer.rRegEx,(function(e,t){return"dfrowid"==t?"empty_placeholder":"isDraggable"==t?"false":""})));r.dom.addClass(i,"DfDragDrop_PlaceHolder"),i.appendChild(r.dom.create('<div class="DfDragDrop_PlaceHolder_Overlay"></div>')),e.insertElement(i,t)}}},r.WebHtmlListRowModel=Ye,r.WebGeoLocation=class extends c{constructor(e,t){super(e,t),this.prop(r.tBool,"pbTracking",!1),this.prop(r.tBool,"pbAutoStart",!0),this.prop(r.tBool,"pbAutoStop",!0),this.prop(r.tNum,"pnLatitude",0),this.prop(r.tNum,"pnLongitude",0),this.prop(r.tNum,"pnAccuracy",0),this.prop(r.tNum,"pnSpeed",0),this.prop(r.tNum,"pnHeading",0),this.prop(r.tBool,"pbEnableHighAccuracy",!1),this.prop(r.tInt,"piMaxTimeout",0),this.prop(r.tInt,"piMinTimeout",200),this.prop(r.tInt,"piMaxAge",0),this.event("OnLocationChange",r.cCallModeDefault),this.event("OnError",r.cCallModeDefault),this.addSync("pnLatitude"),this.addSync("pnLongitude"),this.addSync("pnAccuracy"),this.addSync("pnSpeed"),this.addSync("pnHeading"),this._iWatchId=null,this._oView=null,this._iLocChTime=0,this._iLocChTimer=null}create(){super.create(),this.set_pbTracking(this.pbTracking),this._oView=this.getView(),this._oView?(this._oView.OnShow.on(this.showView,this),this._oView.OnHide.on(this.hideView,this)):this.pbAutoStart&&this.set("pbTracking",!1)}destroy(){super.destroy(),this._oView&&(this._oView.OnShow.off(this.showView,this),this._oView.OnHide.off(this.hideView,this))}showView(e){this.pbAutoStart&&this.set("pbTracking",!0)}hideView(e){this.pbAutoStop&&this.set("pbTracking",!1)}queryLocation(e,t){const i=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(s){i.updateProps(s),i.serverAction("QueryLocation_Callback",[e,t,0,r.fromNumber(i.pnLatitude),r.fromNumber(i.pnLongitude),r.fromNumber(i.pnAccuracy),r.fromNumber(i.pnSpeed),r.fromNumber(i.pnHeading)])}),(function(s){i.serverAction("QueryLocation_Callback",[e,t,s.code,"0","0","0","0","0"]),i.fire("OnError",[s.code,s.message])}),this.geoOptions())}updateProps(e){this.pnLatitude=e.coords.latitude,this.pnLongitude=e.coords.longitude,this.pnAccuracy=e.coords.accuracy||0,this.pnSpeed=e.coords.speed||0,this.pnHeading=e.coords.heading||0}fireLocationChange(){this.fireEx({sEvent:"OnLocationChange",aParams:[r.fromNumber(this.pnLatitude),r.fromNumber(this.pnLongitude),r.fromNumber(this.pnAccuracy),r.fromNumber(this.pnSpeed),r.fromNumber(this.pnHeading)],oEnv:this,sAltServerName:"TriggerLocationChange"}),this._iLocChTime=(new Date).getTime()}trackPosition(e){const t=this;this.updateProps(e);const i=(new Date).getTime()-this._iLocChTime;this.piMaxTimeout>0&&i<this.piMaxTimeout?this._iLocChTimer||(this._iLocChTimer=setTimeout((function(){t.fireLocationChange(),this._iLocChTimer=null}),i)):t.fireLocationChange()}set_pbTracking(e){const t=this;e!==(null!==this._iWatchId)&&(e?navigator.geolocation&&(this._iWatchId=navigator.geolocation.watchPosition((function(e){t.trackPosition(e)}),(function(e){t.fire("OnError",[e.code,e.message])}),this.geoOptions())):(navigator.geolocation&&null!==this._iWatchId&&navigator.geolocation.clearWatch(this._iWatchId),this._iWatchId=null))}geoOptions(){return{enableHighAccuracy:this.pbEnableHighAccuracy,maximumAge:this.piMaxAge>0?this.piMaxAge:1/0,timeout:this.piMaxTimeout>0?this.piMaxTimeout:1/0}}},r.WebContextMenu=ae,r.WebDrawing=class extends b{constructor(e,t){super(e,t),this.prop(r.tInt,"peDrawingJustification",0),this.prop(r.tInt,"piDrawingWidth",0),this.prop(r.tInt,"piDrawingHeight",0),this.prop(r.tInt,"peResizeMode",0),this.prop(r.tBool,"pbNoContextMenu",!1),this.prop(r.tBool,"pbZoomable",!1),this.prop(r.tNumber,"pfMinZoom",.125),this.prop(r.tNumber,"pfMaxZoom",4),this.prop(r.tNumber,"pfDefaultZoom",1),this.prop(r.tBool,"pbClientOnResize",!1),this.prop(r.tBool,"pbDebugOutline",!1),this.prop(r.tInt,"piDebugOutlineWidth",1),this.prop(r.tString,"psDebugOutlineColor",""),this.prop(r.tBool,"pbShowBorder",!1),this.prop(r.tString,"psCanvasBackgroundColor",""),this._eDrawing=null,this.drawingItemMap=new Map,this.drawingsBuffered=!1,this.globalScale=1,this.panOffset={x:0,y:0},this.previousMousePosition=void 0,this.ns="http://www.w3.org/2000/svg",this._zoomBtns=void 0,this._btnZoomIn=void 0,this._btnZoomOut=void 0,this._btnZoomReset=void 0,this.wdResizeModeDisabled=0,this.wdResizeModeScale=1,this.wdResizeModeCrop=2,this.wdInteractionOnMouseDown=1,this.wdInteractionOnMouseUp=2,this.wdInteractionOnMouseEnter=4,this.wdInteractionOnMouseLeave=8,this.wdInteractionOnMouseMove=16,this.wdInteractionOnMouseClick=32,this.wdInteractionOnMouseDoubleClick=64,this.wdInteractionOnMouseDrag=128,this._bJSSizing=!0}create(){if(this.peResizeMode===this.wdResizeModeScale&&(this.piDrawingWidth<=0||this.piDrawingHeight<=0))throw new r.Error(999,"A piDrawingWidth and piDrawingHeight have to be defined when peResizeMode is set to Scaling.");if(this.pfMinZoom<0)throw new r.Error(999,"pfMinZoom cannot go below 0");if(this.pfMinZoom>this.pfMaxZoom)throw new r.Error(999,"pfMinZoom cannot be higher than pfMaxZoom");if(this.pfMaxZoom<this.pfMinZoom)throw new r.Error(999,"pfMaxZoom cannot be lower than pfMinZoom");if(this.pfDefaultZoom<this.pfMinZoom||this.pfDefaultZoom>this.pfMaxZoom)throw new r.Error(999,"The default zoom cannot be lower or higher than the pfMinZoom and/or pfMaxZoom")}openHtml(e){super.openHtml(e),e.push('<div class="WebDrawing-wrp">'),e.push('    <div class="WebDrawing-wrp-inner">'),e.push('        <div class="WebDrawing-zoom-buttons" style="display: none;">'),e.push('            <button class="WebDrawing-btn-zoom WebDrawing-btn-zoom-in">+</button>'),e.push('            <button class="WebDrawing-btn-zoom WebDrawing-btn-zoom-reset">&#x21bb</button>'),e.push('            <button class="WebDrawing-btn-zoom WebDrawing-btn-zoom-out">-</button>'),e.push("        </div>"),e.push('        <svg xmlns="http://www.w3.org/2000/svg" style="background-color:'+this.psCanvasBackgroundColor+'"></svg>'),e.push("    </div>"),e.push("</div>")}afterRender(){this.initializeDrawing(),this.drawingsBuffered&&(this.drawingsBuffered=!1,this.createSVGDomElements(this.drawingItemMap)),super.afterRender(),this.set_pbShowBorder(this.pbShowBorder)}initializeDrawing(){this._eControl=r.dom.query(this._eElem,".WebDrawing-wrp"),this._eDrawing=this._eControl.querySelector("svg"),this._zoomBtns=this._eControl.querySelector(".WebDrawing-zoom-buttons"),this._btnZoomIn=this._eControl.querySelector(".WebDrawing-btn-zoom-in"),this._btnZoomOut=this._eControl.querySelector(".WebDrawing-btn-zoom-out"),this._btnZoomReset=this._eControl.querySelector(".WebDrawing-btn-zoom-reset"),this.pbNoContextMenu&&this._eDrawing.addEventListener("contextmenu",(e=>e.preventDefault())),this.pbDebugOutline&&(this._eDrawing.style.border=this.piDebugOutlineWidth+"px solid black",this._eDrawing.style.borderColor=this.psDebugOutlineColor),this.pbZoomable&&(this._zoomBtns.style.display="block",this.globalScale=this.pfDefaultZoom,this._eDrawing.addEventListener("wheel",(e=>{e.preventDefault(),this.globalScale+=-.001*e.deltaY,this.updateViewBox()})),this._eDrawing.addEventListener("mousedown",(e=>{this.previousMousePosition=this.getMousePos(e)})),this._eDrawing.addEventListener("touchstart",(e=>{this.previousMousePosition=this.getTouchPos(e)})),this._eDrawing.addEventListener("mousemove",(e=>{if(0!==e.buttons&&void 0!==this.previousMousePosition){e.preventDefault();const t=this.getMousePos(e);this.viewPanning(t)}})),this._eDrawing.addEventListener("touchmove",(e=>{if(void 0!==this.previousMousePosition){e.preventDefault();const t=this.getTouchPos(e);this.viewPanning(t)}})),this._btnZoomIn.addEventListener("click",(()=>{this.globalScale+=.1,this.updateViewBox()})),this._btnZoomOut.addEventListener("click",(()=>{this.globalScale+=-.1,this.updateViewBox()})),this._btnZoomReset.addEventListener("click",(()=>{this.globalScale=this.pfDefaultZoom,this.updateViewBox()}))),this.updateViewBox()}viewPanning(e){const t=this.previousMousePosition.x-e.x,i=this.previousMousePosition.y-e.y;let s=t/this.globalScale,o=i/this.globalScale;if(this.peResizeMode===this.wdResizeModeScale){const e=Math.min(this._eControl.clientWidth/this.piDrawingWidth,this._eControl.clientHeight/this.piDrawingHeight);s/=e,o/=e}this.panOffset.x+=s,this.panOffset.y+=o,this.updateViewBox(),this.previousMousePosition=e}updateViewBox(){this.globalScale=Math.min(Math.max(this.pfMinZoom,this.globalScale),this.pfMaxZoom);let e=this.piDrawingWidth,t=this.piDrawingHeight;this.peResizeMode===this.wdResizeModeCrop&&(e=this._eControl.clientWidth,t=this._eControl.clientHeight);const i=e/2,s=t/2,o=e/this.globalScale,n=t/this.globalScale,r=this.panOffset.x+(i-o/2),a=this.panOffset.y+(s-n/2);this._eDrawing.setAttributeNS(null,"viewBox",`${r} ${a} ${o} ${n}`)}updateSizes(){if(this.peResizeMode!==this.wdResizeModeDisabled){if(this._eControl.clientHeight&&(this._eDrawing.width.baseVal.value!==this._eControl.clientWidth||this._eDrawing.height.baseVal.value!==this._eControl.clientHeight)){if(this.peResizeMode===this.wdResizeModeScale){const e=this._eControl.clientHeight/this.piDrawingHeight,t=this._eControl.clientWidth/this.piDrawingWidth,i=this.piDrawingWidth*t,s=this.piDrawingHeight*e;this._eDrawing.setAttributeNS(null,"width",i.toString()),this._eDrawing.setAttributeNS(null,"height",s.toString())}else this.peResizeMode===this.wdResizeModeCrop&&(this._eDrawing.setAttributeNS(null,"width",this._eControl.clientWidth.toString()),this._eDrawing.setAttributeNS(null,"height",this._eControl.clientHeight.toString()));if(this.updateViewBox(),this.pbClientOnResize){const e=this.createResizeEventData(this._eDrawing.width.baseVal.value,this._eDrawing.height.baseVal.value);this.serverAction("HandleResize",[],e)}}}else this._eDrawing.setAttributeNS(null,"width",this.piDrawingWidth.toString()),this._eDrawing.setAttributeNS(null,"height",this.piDrawingHeight.toString())}setHeight(e,t){super.setHeight(e,t),t&&r.dom.animFrame(this.updateSizes,this)}createResizeEventData(e,t){const i={};return i.fViewWidth=e,i.fViewHeight=t,i}updateInstructions(){this.drawingItemMap=this.collectInstructions(this._tActionData,this.drawingItemMap),this.setGroupingPositions(),this.updateDrawing()}clearDrawing(){this._eDrawing&&(this.drawingItemMap=new Map,this._eDrawing.innerHTML="",this.initializeDrawing())}updateDrawing(){this._eDrawing?this.createSVGDomElements(this.drawingItemMap):this.drawingsBuffered=!0}setGroupingPositions(){for(const e of this.drawingItemMap.keys()){const t=this.drawingItemMap.get(e);t.subDrawingItemMap.size>0&&(t.drawingItemData.position=this.getCentroidOfGrouping(t),this.drawingItemMap.set(e,t))}}adjustChildrenPosition(e,t){if(e.subDrawingItemMap.size>0)for(const[i,s]of e.subDrawingItemMap.entries()){const o=this.cloneObject(s.drawingItemData.position),n=s.drawingItemData.position.x-t.x,r=s.drawingItemData.position.y-t.y;if(s.drawingItemData.position.x=e.drawingItemData.position.x+n,s.drawingItemData.position.y=e.drawingItemData.position.y+r,void 0!==s.drawingItemData.shape)switch(s.drawingItemData.shape.type){case"rectangle":case"rounded-rectangle":case"image":{const i=s.drawingItemData.shape.data.topLeft.x-t.x,o=s.drawingItemData.shape.data.topLeft.y-t.y,n=s.drawingItemData.shape.data.bottomRight.x-t.x,r=s.drawingItemData.shape.data.bottomRight.y-t.y;s.drawingItemData.shape.data.topLeft.x=e.drawingItemData.position.x+i,s.drawingItemData.shape.data.topLeft.y=e.drawingItemData.position.y+o,s.drawingItemData.shape.data.bottomRight.x=e.drawingItemData.position.x+n,s.drawingItemData.shape.data.bottomRight.y=e.drawingItemData.position.y+r;break}case"path":for(const i of s.drawingItemData.shape.data.subPoints){const s=i.position.x-t.x,o=i.position.y-t.y;if(i.position.x=e.drawingItemData.position.x+s,i.position.y=e.drawingItemData.position.y+o,i.position2){const s=i.position2.x-t.x,o=i.position2.y-t.y;i.position2.x=e.drawingItemData.position.x+s,i.position2.y=e.drawingItemData.position.y+o}}}this.adjustChildrenPosition(s,o),e.subDrawingItemMap.set(i,s)}}collectInstructions(e,t){let i=0;for(let s=0;s<e.length;s++){const o=e[s];let n={subDrawingItemMap:new Map,hasEntered:!1,hasLeft:!0};if(""===o.sId&&(o.sType.startsWith("create-")&&i++,o.sId=`!${i}`),t.has(o.sId)?n=t.get(o.sId):t.forEach((e=>{e.subDrawingItemMap.size>0&&e.subDrawingItemMap.has(o.sId)&&(n=e.subDrawingItemMap.get(o.sId))})),"create-group"===o.sType){const t=e.findIndex((e=>"create-group"===e.sType&&e.sId===o.sId)),i=e.findIndex((e=>"end-create-group"===e.sType&&e.sId===o.sId));if(-1===i)throw new r.Error(999,`Group "${o.sId}" has no corresponding EndCreateGroup instruction.`);const a=e.slice(t+1,i);void 0===n.drawingItemData&&(n.drawingItemData={visible:!0,shadowOffset:{x:0,y:0},position:{x:0,y:0}});const l=a.filter((e=>e.sId===o.sId));for(const e of l){n=this.applyGroupedInstruction(n,e);const t=a.findIndex((t=>t.sId===e.sId&&t.sType===e.sType));a.splice(t,1)}n.subDrawingItemMap=this.collectInstructions(a,n.subDrawingItemMap),s=i}else if("create-layer"===o.sType){const t=e.findIndex((e=>"create-layer"===e.sType&&e.sId===o.sId)),i=e.findIndex((e=>"end-create-layer"===e.sType&&e.sId===o.sId));if(-1===i)throw new r.Error(999,`Layer "${o.sId}" has no corresponding EndCreateLayer instruction.`);const a=e.slice(t+1,i);void 0===n.drawingItemData&&(n.drawingItemData={visible:!0,shadowOffset:{x:0,y:0}}),n.subDrawingItemMap=this.collectInstructions(a,n.subDrawingItemMap),s=i}else"delete-item"===o.sType?(this.deleteItem(o.sId),n=null):n=n.subDrawingItemMap.size>0?this.applyGroupedInstruction(n,o):this.applyInstruction(n,o);n&&t.set(o.sId,n)}return t}applyInstruction(e,t){if(e.drawingItemData=this.applyCreateInstruction(e.drawingItemData,t),void 0===e.drawingItemData)throw new r.Error(999,`There is no shape created for "${t.sId}", cannot apply styling. Maybe you mistyped the ID?`);return e=this.applyNormalInstructions(e,t)}applyGroupedInstruction(e,t){return e=this.applyNormalInstructions(e,t)}applyCreateInstruction(e,t){const i=t.sType,s=t.asParams;if(i.startsWith("create-")&&this.mapHasId(t.sId))throw new r.Error(999,`A shape with the id "${t.sId}" already exists`);switch(void 0===e&&((e={}).position={x:0,y:0},e.scale={width:1,height:1},e.shadowOffset={x:0,y:0},e.visible=!0,e.closed=!1),i){case"create-rectangle":{const[t,i,o,n,r]=s;e.shape={},e.shape.data={topLeft:{x:parseFloat(t),y:parseFloat(i)},bottomRight:{x:parseFloat(t)+parseFloat(o),y:parseFloat(i)+parseFloat(n)}},s.length>4?(e.shape.type="rounded-rectangle",e.shape.data.radius=parseFloat(r)):e.shape.type="rectangle",e.position=this.getCentroid([e.shape.data.topLeft,e.shape.data.bottomRight]);break}case"create-circle":{const[t,i,o]=s;e.shape={},e.shape.type="circle",e.shape.data={radius:parseFloat(o)},e.position.x=parseFloat(t),e.position.y=parseFloat(i);break}case"create-ellipse":{const[t,i,o,n]=s;e.shape={},e.shape.type="ellipse",e.shape.data={radiusX:parseFloat(o),radiusY:parseFloat(n)},e.position.x=parseFloat(t),e.position.y=parseFloat(i);break}case"create-path":e.shape={},e.shape.type="path",e.shape.data={subPoints:[]};break;case"create-line":{const[t,i,o,n]=s;e.shape={},e.shape.type="path",e.shape.data={subPoints:[]},e.shape.data.subPoints.push({type:"moveTo",position:{x:parseFloat(t),y:parseFloat(i)}}),e.shape.data.subPoints.push({type:"lineTo",position:{x:parseFloat(o),y:parseFloat(n)}});break}case"create-text":{const[t,i,o,n,r,a,l,h]=s;e.shape={},e.shape.type="text",e.shape.params=s,e.textContent=o,e.position.x=parseFloat(t),e.position.y=parseFloat(i),e.fontFamily=n,e.fontSize=parseFloat(r),e.fillColor="black",e.strokeColor="transparent",s.length>5&&(e.justification=this.enumJustificationIntToString(parseInt(a))),s.length>6&&(e.fontWeight=l),s.length>7&&(e.textDecoration=h);break}case"create-image":case"create-svg":{const[t]=s;e.shape=this.getImageShapeData(s),e.imagePath=t;break}}return e}getImageShapeData(e){const[t,i,s,o,n]=e,r={type:"image"};return e.length>3?r.data={topLeft:{x:parseFloat(i),y:parseFloat(s)},bottomRight:{x:parseFloat(o),y:parseFloat(n)}}:r.data={topLeft:{x:parseFloat(i),y:parseFloat(s)}},r}applyNormalInstructions(e,t){const i=t.sType,s=t.asParams;switch(i){case"add":e.drawingItemData.shape.data.subPoints.push({type:"add",position:{x:parseFloat(s[0]),y:parseFloat(s[1])}}),e.drawingItemData.position=this.getCentroid(e.drawingItemData.shape.data.subPoints.map((e=>e.position)));break;case"moveTo":e.drawingItemData.shape.data.subPoints.push({type:"moveTo",position:{x:parseFloat(s[0]),y:parseFloat(s[1])}}),e.drawingItemData.position=this.getCentroid(e.drawingItemData.shape.data.subPoints.map((e=>e.position)));break;case"lineTo":e.drawingItemData.shape.data.subPoints.push({type:"lineTo",position:{x:parseFloat(s[0]),y:parseFloat(s[1])}}),e.drawingItemData.position=this.getCentroid(e.drawingItemData.shape.data.subPoints.map((e=>e.position)));break;case"quadraticCurveTo":e.drawingItemData.shape.data.subPoints.push({type:"quadraticCurveTo",position:{x:parseFloat(s[2]),y:parseFloat(s[3])},position2:{x:parseFloat(s[0]),y:parseFloat(s[1])}}),e.drawingItemData.position=this.getCentroid(e.drawingItemData.shape.data.subPoints.map((e=>e.position)));break;case"closePath":e.drawingItemData.shape.data.subPoints.push({type:"closePath"}),e.drawingItemData.closed=!0;break;case"strokeWidth":e.drawingItemData.strokeWidth=parseFloat(s[0]);break;case"strokeColor":e.drawingItemData.strokeColor=s[0];break;case"strokeCap":e.drawingItemData.strokeCap=this.enumStrokeCapIntToString(parseInt(s[0]));break;case"strokeJoin":e.drawingItemData.strokeJoin=this.enumStrokeJoinIntToString(parseInt(s[0]));break;case"dashOffset":e.drawingItemData.dashOffset=parseFloat(s[0]);break;case"strokeDashes":e.drawingItemData.strokeDistance=s[0],s.length>1&&(e.drawingItemData.whitespaceDistance=s[1]);break;case"fillColor":e.drawingItemData.fillColor=s[0];break;case"shadowColor":e.drawingItemData.shadowColor=s[0];break;case"shadowBlur":e.drawingItemData.shadowBlur=parseFloat(s[0]);break;case"shadowOffset":e.drawingItemData.shadowOffset={x:parseFloat(s[0]),y:parseFloat(s[1])};break;case"fontFamily":e.drawingItemData.fontFamily=s[0];break;case"fontSize":e.drawingItemData.fontSize=parseFloat(s[0]);break;case"fontWeight":e.drawingItemData.fontWeight=s[0];break;case"textDecoration":e.drawingItemData.textDecoration=s[0];break;case"fontJustification":e.drawingItemData.justification=this.enumJustificationIntToString(parseInt(s[0]));break;case"textContent":e.drawingItemData.textContent=s[0];break;case"set-visibility":e.drawingItemData.visible=1==s[0];break;case"toggle-visibility":e.drawingItemData.visible=!e.drawingItemData.visible;break;case"add-svg-attribute":e.drawingItemData.customAttribute={customAttributeName:s[0],customAttributeValue:s[1]};break;case"position":{let t;e.drawingItemData.position.x=parseFloat(s[0]),e.drawingItemData.position.y=parseFloat(s[1]),void 0!==e.drawingItemData.position&&(t=this.cloneObject(e.drawingItemData.position),this.adjustChildrenPosition(e,t));break}case"rotation":e.drawingItemData.rotation=parseFloat(s[0]),s.length>1&&(e.drawingItemData.rotateInPlace=s[1]);break;case"scaling":void 0===e.drawingItemData.scale&&(e.drawingItemData.scale={}),e.drawingItemData.scale.width=parseFloat(s[0]),e.drawingItemData.scale.height=parseFloat(s[1]);break;case"enable-interaction":{void 0===e.enabledInteractions&&(e.enabledInteractions=0);const t=parseInt(s[0]);e.enabledInteractions=e.enabledInteractions|t;break}case"disable-interaction":{void 0===e.enabledInteractions&&(e.enabledInteractions=0);const t=parseInt(s[0]);e.enabledInteractions&t&&(e.enabledInteractions=e.enabledInteractions^t);break}case"add-tooltip":e.drawingItemData.tooltip=s[0]}return e}getCentroidOfGrouping(e){const t=[];for(const i of e.subDrawingItemMap.values())i.subDrawingItemMap.size>0&&(i.drawingItemData.position=this.getCentroidOfGrouping(i)),t.push(i.drawingItemData.position);return this.getCentroid(t)}createSVGDomElements(e){for(const[t,i]of e)if(this.createSVGDomElement(t,i),void 0!==i.drawingItemData.pathItem){const e=this._eDrawing.querySelector(`[df-wd-item-id="${t}"]`);null===e?this._eDrawing.appendChild(i.drawingItemData.pathItem):e.isEqualNode(i.drawingItemData.pathItem)||e.replaceWith(i.drawingItemData.pathItem)}}createSVGDomElement(e,t){if(t.subDrawingItemMap.size>0){t.drawingItemData.pathItem=document.createElementNS(this.ns,"g"),t.drawingItemData.pathItem.setAttributeNS(null,"style","pointer-events: bounding-box; transform-origin: center; transform-box: fill-box;");for(const[i,s]of t.subDrawingItemMap.entries()){this.createSVGDomElement(i,s),this.applyStylesForGroupChildren(s,t.drawingItemData),t.drawingItemData.pathItem.setAttribute("df-wd-item-id",e),this.applyTransformStyles(t.drawingItemData);const o=t.drawingItemData.pathItem.querySelector(`:scope > *[df-wd-item-id="${e}"]`);null===o?t.drawingItemData.pathItem.appendChild(s.drawingItemData.pathItem):o.isEqualNode(t.drawingItemData.pathItem)||o.replaceWith(s.drawingItemData.pathItem)}this.assignEvent(e,t)}else{if(void 0===t.drawingItemData.shape||""===t.drawingItemData.shape.type)return;this.createSVGData(e,t.drawingItemData),this.applyStyles(t.drawingItemData),this.applyTransformStyles(t.drawingItemData),this.assignEvent(e,t)}}createSVGData(e,t){switch(t.shape.type){case"rectangle":t.pathItem=document.createElementNS(this.ns,"rect"),t.pathItem.setAttributeNS(null,"x",t.shape.data.topLeft.x.toString()),t.pathItem.setAttributeNS(null,"y",t.shape.data.topLeft.y.toString()),t.pathItem.setAttributeNS(null,"width",(t.shape.data.bottomRight.x-t.shape.data.topLeft.x).toString()),t.pathItem.setAttributeNS(null,"height",(t.shape.data.bottomRight.y-t.shape.data.topLeft.y).toString());break;case"rounded-rectangle":t.pathItem=document.createElementNS(this.ns,"rect"),t.pathItem.setAttributeNS(null,"x",t.shape.data.topLeft.x.toString()),t.pathItem.setAttributeNS(null,"y",t.shape.data.topLeft.y.toString()),t.pathItem.setAttributeNS(null,"width",(t.shape.data.bottomRight.x-t.shape.data.topLeft.x).toString()),t.pathItem.setAttributeNS(null,"height",(t.shape.data.bottomRight.y-t.shape.data.topLeft.y).toString()),t.pathItem.setAttributeNS(null,"rx",t.shape.data.radius.toString()),t.pathItem.setAttributeNS(null,"ry",t.shape.data.radius.toString());break;case"circle":t.pathItem=document.createElementNS(this.ns,"circle"),t.pathItem.setAttributeNS(null,"cx",t.position.x.toString()),t.pathItem.setAttributeNS(null,"cy",t.position.y.toString()),t.pathItem.setAttributeNS(null,"r",t.shape.data.radius.toString());break;case"ellipse":t.pathItem=document.createElementNS(this.ns,"ellipse"),t.pathItem.setAttributeNS(null,"cx",t.position.x.toString()),t.pathItem.setAttributeNS(null,"cy",t.position.y.toString()),t.pathItem.setAttributeNS(null,"rx",t.shape.data.radiusX.toString()),t.pathItem.setAttributeNS(null,"ry",t.shape.data.radiusY.toString());break;case"path":{const e=[];t.pathItem=document.createElementNS(this.ns,"path");for(let i=0;i<t.shape.data.subPoints.length;i++){const s=t.shape.data.subPoints[i];switch(s.type){case"add":case"lineTo":0===i?e.push(`M ${s.position.x},${s.position.y}`):e.push(`L ${s.position.x},${s.position.y}`);break;case"moveTo":e.push(`M ${s.position.x},${s.position.y}`);break;case"quadraticCurveTo":e.push(`Q ${s.position2.x},${s.position2.y} ${s.position.x},${s.position.y}`);break;case"closePath":e.push("Z")}}t.pathItem.setAttributeNS(null,"d",e.join(" "));break}case"text":t.pathItem=document.createElementNS(this.ns,"text"),t.pathItem.setAttributeNS(null,"x",t.position.x.toString()),t.pathItem.setAttributeNS(null,"y",t.position.y.toString()),t.pathItem.setAttributeNS(null,"font-family",t.fontFamily),t.pathItem.setAttributeNS(null,"font-size",t.fontSize.toString()),t.pathItem.setAttributeNS(null,"text-anchor",t.justification),t.pathItem.setAttributeNS(null,"font-weight",t.fontWeight),t.pathItem.setAttributeNS(null,"text-decoration",t.textDecoration),t.pathItem.setAttributeNS(null,"stroke",t.strokeColor),t.pathItem.setAttributeNS(null,"fill",t.fillColor),t.pathItem.textContent=t.textContent;break;case"image":t.pathItem=document.createElementNS(this.ns,"image"),t.pathItem.setAttributeNS(null,"x",t.shape.data.topLeft.x.toString()),t.pathItem.setAttributeNS(null,"y",t.shape.data.topLeft.y.toString()),void 0!==t.shape.data.bottomRight&&(t.pathItem.setAttributeNS(null,"width",(t.shape.data.bottomRight.x-t.shape.data.topLeft.x).toString()),t.pathItem.setAttributeNS(null,"height",(t.shape.data.bottomRight.y-t.shape.data.topLeft.y).toString())),t.pathItem.setAttributeNS(null,"href",t.imagePath),t.pathItem.setAttributeNS(null,"onmousedown","return false")}t.pathItem.setAttribute("df-wd-item-id",e)}applyStylesForGroupChildren(e,t){if(e.subDrawingItemMap.size>0)for(const i of e.subDrawingItemMap.values())this.applyStylesForGroupChildren(i,t);void 0===e.drawingItemData.strokeWidth&&void 0!==t.strokeWidth&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke-width",t.strokeWidth.toString()),void 0===e.drawingItemData.strokeColor&&void 0!==t.strokeColor&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke",t.strokeColor),void 0===e.drawingItemData.strokeCap&&void 0!==t.strokeCap&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke-linecap",t.strokeCap),void 0===e.drawingItemData.strokeJoin&&void 0!==t.strokeJoin&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke-linejoin",t.strokeJoin);const i=[];void 0===e.drawingItemData.strokeDistance&&void 0!==t.strokeDistance&&i.push(t.strokeDistance),void 0===e.drawingItemData.whitespaceDistance&&void 0!==t.whitespaceDistance&&i.push(t.whitespaceDistance),i.length>0&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke-dasharray",i.join()),void 0===e.drawingItemData.dashOffset&&void 0!==t.dashOffset&&e.drawingItemData.pathItem.setAttributeNS(null,"stroke-dashoffset",t.dashOffset),"path"===e.drawingItemData.shape?.type&&void 0===e.drawingItemData.fillColor&&!1===e.drawingItemData.closed&&e.drawingItemData.pathItem.setAttributeNS(null,"fill","none"),void 0===e.drawingItemData.fillColor&&void 0!==t.fillColor&&e.drawingItemData.pathItem.setAttributeNS(null,"fill",t.fillColor);const s=[];if(0===e.drawingItemData.shadowOffset.x&&0===e.drawingItemData.shadowOffset.y&&0!==t.shadowOffset.x&&0!==t.shadowOffset.y?s.push(`${t.shadowOffset.x}px ${t.shadowOffset.y}px`):s.push("0px 0px"),void 0===e.drawingItemData.shadowBlur&&void 0!==t.shadowBlur&&s.push(`${t.shadowBlur}px`),void 0===e.drawingItemData.shadowColor&&void 0!==t.shadowColor&&s.push(t.shadowColor),s.length>1&&e.drawingItemData.pathItem.setAttributeNS(null,"style",`filter: drop-shadow(${s.join(" ")});`),!1===t.visible?e.drawingItemData.pathItem.setAttributeNS(null,"visibility","hidden"):e.drawingItemData.pathItem.setAttributeNS(null,"visibility",""),void 0===e.drawingItemData.customAttribute&&void 0!==t.customAttribute&&e.drawingItemData.pathItem.setAttributeNS(null,t.customAttribute.customAttributeName,t.customAttribute.customAttributeValue),void 0===e.drawingItemData.tooltip&&void 0!==t.tooltip){let i=document.createElementNS(this.ns,"title");i.textContent=t.tooltip,e.drawingItemData.pathItem.append(i)}}applyStyles(e){void 0!==e.strokeWidth&&e.pathItem.setAttributeNS(null,"stroke-width",e.strokeWidth.toString()),void 0!==e.strokeColor?e.pathItem.setAttributeNS(null,"stroke",e.strokeColor):e.pathItem.setAttributeNS(null,"stroke","black"),void 0!==e.strokeCap&&e.pathItem.setAttributeNS(null,"stroke-linecap",e.strokeCap),void 0!==e.strokeJoin&&e.pathItem.setAttributeNS(null,"stroke-linejoin",e.strokeJoin),void 0!==e.strokeDistance&&void 0===e.whitespaceDistance&&e.pathItem.setAttributeNS(null,"stroke-dasharray",e.strokeDistance),void 0!==e.strokeDistance&&void 0!==e.whitespaceDistance&&e.pathItem.setAttributeNS(null,"stroke-dasharray",e.strokeDistance+","+e.whitespaceDistance),void 0!==e.dashOffset&&e.pathItem.setAttributeNS(null,"stroke-dashoffset",e.dashOffset),"path"===e.shape?.type&&void 0===e.fillColor&&!1===e.closed&&e.pathItem.setAttributeNS(null,"fill","none"),void 0!==e.fillColor?e.pathItem.setAttributeNS(null,"fill",e.fillColor):e.pathItem.setAttributeNS(null,"fill","transparent");const t=[];if(0!==e.shadowOffset.x&&0!==e.shadowOffset.y?t.push(`${e.shadowOffset.x}px ${e.shadowOffset.y}px`):t.push("0px 0px"),e.shadowBlur&&t.push(`${e.shadowBlur}px`),e.shadowColor&&t.push(e.shadowColor),t.length>1&&e.pathItem.setAttributeNS(null,"style",`filter: drop-shadow(${t.join(" ")});`),!0===e.visible?e.pathItem.setAttributeNS(null,"visibility",""):e.pathItem.setAttributeNS(null,"visibility","hidden"),void 0!==e.customAttribute&&e.pathItem.setAttributeNS(null,e.customAttribute.customAttributeName,e.customAttribute.customAttributeValue),void 0!==e.tooltip){let t=document.createElementNS(this.ns,"title");t.textContent=e.tooltip,e.pathItem.append(t)}}applyTransformStyles(e){let t=[];void 0!==e.rotation&&t.push(`rotate(${e.rotation})`),void 0!==e.rotateInPlace&&e.pathItem.setAttributeNS(null,"transform-origin",e.position.x+" "+e.position.y),void 0!==e.scale&&1!==e.scale?.width&&1!==e.scale?.height&&t.push(`scale(${e.scale.width}, ${e.scale.height})`),t.length>0&&e.pathItem.setAttributeNS(null,"transform",t.join(" "))}assignEvent(e,t){if(e.startsWith("!"))return;const i=t.drawingItemData.pathItem;t.enabledInteractions&this.wdInteractionOnMouseClick&&i.addEventListener("click",(i=>{this.handleEvent("HandleMouseClick",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseDoubleClick&&i.addEventListener("dblclick",(i=>{this.handleEvent("HandleMouseDoubleClick",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseUp&&i.addEventListener("mouseup",(i=>{this.handleEvent("HandleMouseUp",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseDown&&i.addEventListener("mousedown",(i=>{i.preventDefault(),this.handleEvent("HandleMouseDown",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseMove&&i.addEventListener("mousemove",(i=>{this.handleEvent("HandleMouseMove",i,e,t),0!==i.buttons&&this.handleEvent("HandleMouseDrag",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseDrag&&i.addEventListener("mousemove",(i=>{0!==i.buttons&&this.handleEvent("HandleMouseDrag",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseEnter&&i.addEventListener("mouseenter",(i=>{this.handleEvent("HandleMouseEnter",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseLeave&&i.addEventListener("mouseleave",(i=>{this.handleEvent("HandleMouseLeave",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseUp&&i.addEventListener("touchend",(i=>{this.handleEvent("HandleMouseUp",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseClick&&i.addEventListener("touchstart",(i=>{i.preventDefault(),this.handleEvent("HandleMouseClick",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseDown&&i.addEventListener("touchstart",(i=>{i.preventDefault(),this.handleEvent("HandleMouseDown",i,e,t)})),t.enabledInteractions&this.wdInteractionOnMouseMove&&i.addEventListener("touchmove",(i=>{this.handleEvent("HandleMouseMove",i,e,t)}))}handleEvent(e,t,i,s){const o=this.createEventData(s.drawingItemData,t);this.serverAction("ReceiveEventData",[e,i],o,null)}createEventData(e,t){const i={eMouseButtons:0,tMousePosition:{fX:0,fY:0}};if(void 0!==t.touches&&t.touches.length>0){let e;e=this.getTouchPos(t),i.tMousePosition.fX=e.x,i.tMousePosition.fY=e.y}else if(void 0!==t.buttons){let e;i.eMouseButtons=t.buttons,e=this.getMousePos(t),i.tMousePosition.fX=e.x,i.tMousePosition.fY=e.y}return i.tPosition={},i.tPosition.fX=e.position?.x??0,i.tPosition.fY=e.position?.y??0,i.fRotation=e.rotation??0,i.tScaling={},i.tScaling.fWidth=e.scale?.width??1,i.tScaling.fHeight=e.scale?.height??1,i.sStrokeColor=e.strokeColor??"transparent",i.fStrokeWidth=e.strokeWidth??0,i.iStrokeCap=this.enumStrokeCapStringToInt(e.strokeCap),i.iStrokeJoin=this.enumStrokeJoinStringToInt(e.strokeJoin),i.fDashOffset=e.dashOffset??0,i.sFillColor=e.fillColor??"transparent",i.sShadowColor=e.shadowColor??"transparent",i.fShadowBlur=e.shadowBlur??0,i.tShadowOffset={},i.tShadowOffset.fX=e.shadowOffset?.x??0,i.tShadowOffset.fY=e.shadowOffset?.y??0,i.sTextContent=e.textContent??"",i.sFontFamily=e.fontFamily??"sans-serif",i.fFontSize=e.fontSize??10,i.eJustification=this.enumJustificationStringToInt(e.justification),i.sFontWeight=e.fontWeight??"",i.sTextDecoration=e.textDecoration??"",i}getMousePos(e){const t=this._eDrawing.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}getTouchPos(e){const t=this._eDrawing.getBoundingClientRect();return{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}getCentroid(e){const t=e.map((e=>e.x)).reduce(((e,t)=>e+t)),i=e.map((e=>e.y)).reduce(((e,t)=>e+t)),s={};return s.x=t/e.length,s.y=i/e.length,s}deleteItem(e){this.drawingItemMap=this.recursiveDeleteFromMap(e,this.drawingItemMap)}recursiveDeleteFromMap(e,t){const i=[];for(const[s,o]of t.entries())if(o.subDrawingItemMap.size>0&&(o.subDrawingItemMap=this.recursiveDeleteFromMap(e,o.subDrawingItemMap)),s===e){i.push(s);const e=this._eDrawing.querySelector(`:scope > *[df-wd-item-id="${s}"]`);null!==e&&this._eDrawing.removeChild(e)}for(const e of i)t.delete(e);return t}cloneObject(e){return JSON.parse(JSON.stringify(e))}blobImageToBase64(e){return new Promise(((t,i)=>{const s=new FileReader;s.onloadend=()=>{const e=s.result.replace("data:image/png;base64,","");t(e)},s.readAsDataURL(e)}))}mapHasId(e){return this.checkMapChildren(e,this.drawingItemMap)}checkMapChildren(e,t){for(const[i,s]of t.entries()){if(i===e)return!0;if(s.subDrawingItemMap.size>0){if(this.checkMapChildren(e,s.subDrawingItemMap))return!0}}return!1}async exportDrawingToImage(){const e=this._eDrawing.cloneNode(!0),t=e.querySelectorAll("image");for(const e of t){const t=await fetch(e.href.baseVal),i=await t.blob(),s=new FileReader;s.readAsDataURL(i);const o=await new Promise((e=>{s.onloadend=()=>{e(s.result)}}));e.setAttributeNS(null,"href",o)}const i=document.createElement("drawing");i.width=e.width.baseVal.value,i.height=e.height.baseVal.value;const s=i.getContext("2d"),o=(new XMLSerializer).serializeToString(e),n=new Image,r=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),a=new FileReader;a.readAsDataURL(r),n.src=await new Promise((e=>{a.onloadend=()=>{e(a.result)}})),n.addEventListener("load",(()=>{s.drawImage(n,0,0);let e=i.toDataURL("image/png").replace("data:image/png;base64,","");this.serverAction("OnReceiveImage",[e])}))}exportDrawingDataToJSON(){const e=JSON.stringify(Object.fromEntries(this.drawingItemMap));this.serverAction("OnReceiveJSONExport",[e],null,null)}importDrawingFromJSON(e){this.drawingItemMap=Object.entries(JSON.parse(e)),this.updateDrawing()}enumStrokeCapStringToInt(e){switch(e){case"round":return 0;case"square":return 1;default:return 2}}enumStrokeCapIntToString(e){switch(e){case 0:return"round";case 1:return"square";default:return"butt"}}enumStrokeJoinStringToInt(e){switch(e){case"miter":default:return 0;case"round":return 1;case"bevel":return 2}}enumStrokeJoinIntToString(e){switch(e){case 0:default:return"miter";case 1:return"round";case 2:return"bevel"}}enumJustificationStringToInt(e){switch(e){default:case"start":return 0;case"middle":return 1;case"end":return 2}}enumJustificationIntToString(e){switch(e){default:case 0:return"start";case 1:return"middle";case 2:return"end"}}set_psCanvasBackgroundColor(e){this._eDrawing.style.backgroundColor=e}set_pbShowBorder(e){this.pbShowBorder=e,this._eControl&&r.dom.toggleClass(this._eControl,"WebDrawing_Box",this.pbShowBorder)}},r.WebDropZone=class{constructor(e,t){this._eZone=e,this._oControl=t,this._eInsertedElem=null,this._aHelpers=[],this._eDropPosition=-1,this._eDropElem=null,this._eDropAction=-1,this._iEnterCount=0}highlight(e){df.dom.addClass(this._eZone,"WebCon_DropZone"),this.attachHandlers(),this._aHelpers.push(e)}unhighlight(){df.dom.removeClass(this._eZone,"WebCon_DropZone"),this.detachHandlers(),this.removeDropElemInteractions(),this._aHelpers=[],this._eDropPosition=-1,this._eDropElem=null,this._eDropAction=-1,this._iEnterCount=0}destroy(){this.unhighlight()}attachHandlers(){df.dom.on("dragenter",this._eZone,this.onDragEnter,this),df.dom.on("dragleave",this._eZone,this.onDragLeave,this),df.dom.on("dragover",this._eZone,this.onDragOver,this),df.dom.on("drop",this._eZone,this.onDrop,this)}detachHandlers(){df.dom.off("dragenter",this._eZone,this.onDragEnter,this),df.dom.off("dragleave",this._eZone,this.onDragLeave,this),df.dom.off("dragover",this._eZone,this.onDragOver,this),df.dom.off("drop",this._eZone,this.onDrop,this)}getDropData(){return this._oControl.getDropData(this)}onDrop(e){e.e.preventDefault(),this._oControl.onDrop(e,this,this._eDropAction),this.removeDropElemInteractions(),this._iEnterCount=0}onDragOver(e){if(e.e.preventDefault(),this.controlHasData()){const[t,i]=this.getDropCandidate(e),s=this.isOverDropPlaceHolder(e);let o;null!=t||s||(this.removeDropElemInteractions(),this._eDropElem=null,o=this._eDropPosition=0),null==t||s||(o=this.getDropPosition(e,t));o>0&&null!=t&&(t!=this._eDropElem||this._eDropPosition!=o)&&!s&&(this.removeDropElemInteractions(),this._eDropElem=t,this._eDropPosition=o,this._eDropAction=i,this.interactWithDropElem()),this._oControl.onControlDragOver(e,this,t)}else this._eDropPosition=df.dropPositions.ciDropOnEmpty,this._eDropElem=null,this._eDropAction=this.doEmptyInteraction();return!1}onDragEnter(e){e.e.preventDefault(),this._iEnterCount++}onDragLeave(e){e.e.preventDefault(),this._iEnterCount--,this._iEnterCount<=0&&(this.removeDropElemInteractions(),this._eDropElem=null,this._eDropPosition=0,this._iEnterCount=0)}getDropCandidate(e){const[t,i]=this._oControl.determineDropCandidate(e,this._aHelpers);return[t,i]}getDropPosition(e,t){return this._oControl.determineDropPosition(e,t)}isOverDropPlaceHolder(e){let t=document.elementFromPoint(e.e.x,e.e.y);return!!t&&t.classList.contains("DfDragDrop_PlaceHolder")}controlHasData(){return this._oControl.hasData()}removeDropElemInteractions(){this.removeInsertedElement(),this.clearHighlight()}interactWithDropElem(){this._oControl.interactWithDropElem(this,this._eDropElem)}doEmptyInteraction(){return this._oControl.doEmptyInteraction(this)}highlightElement(){this._eDropElem&&df.dom.addClass(this._eDropElem,"WebCon_DragHover")}clearHighlight(){this._eDropElem&&df.dom.removeClass(this._eDropElem,"WebCon_DragHover")}insertElement(e,t,i){if(!this._eInsertedElem){switch(df.dom.addClass(e,"DfDragDrop_PlaceHolder"),e.setAttribute("data-dfdropplaceholder",!0),i||this._eDropPosition){case df.dropPositions.ciDropBefore:t.insertAdjacentElement("beforebegin",e);break;case df.dropPositions.ciDropAfter:t.insertAdjacentElement("afterend",e);break;case df.dropPositions.ciDropOnEmpty:t.appendChild(e)}this._eInsertedElem=e}}removeInsertedElement(){this._eInsertedElem&&(this._eInsertedElem?.parentNode?.removeChild(this._eInsertedElem),this._eInsertedElem=null)}},r.WebDragDropHelper=Xe,r.WebDragDropFileHelper=class extends $e{constructor(e,t){super(e,t),this._oCurDropZone=null}create(){super.create(),r.dragdrop.registerHelper(this)}onFileDrag(e){this.highlightDropZones()}onDragEnd(e){super.onDragEnd()}onDrop(e,t,i){const s=this._oDragData,o=i.getDropData(),n=r.dragdrop.containsFiles(e.e);if((s||n)&&i&&this.supportsDropAction(i._oControl,i._eDropAction))if(n)this._tempDropData=o,this._oCurDropZone=i,this.initFiles(e.e.dataTransfer.files),this.startUpload();else{var a={DragData:s.oData,DropData:o};this.serverAction("Drop",[this._oDragData.oControl.getLongName(),i._oControl.getLongName(),i._eDropPosition],a)}this.onDragEnd(e)}doStartUpload(e,t){const i={DragData:t,DropData:this._tempDropData};this.serverAction("FileDrop",[this._oCurDropZone._oControl.getLongName(),this._oCurDropZone._eDropPosition],i,e)}cleanupHelper(e){super.cleanupHelper(),this._tempDropData=null}},r.LocalWebDragDropProxy=class extends Xe{constructor(e,t){super(e,t),this._bAcceptAllDrops=!0}highlightDropZones(){this.serverAction("HighlightDropZones",[this._oDragData.oControl.getLongName()],{DragData:this._oDragData.oData})}doHighlightDropZones(){this._oDragData={oControl:null,eElem:null,oData:null},this._aTargets.forEach((e=>{e.oControl.highlightDropZones(this)}))}cleanupHelper(){this.serverAction("CleanupHelper")}doCleanupHelper(){this._aTargets.forEach((e=>{e.oControl.cleanupDropZones()})),this._oDragData=null}},r.WebWidget=class extends qe{constructor(e,t){super(e,t),this.prop(r.tString,"psDynamicWidgetId",""),this.prop(r.tString,"psWidgetName",""),this.prop(r.tBool,"pbAllowResize",!0),this.prop(r.tBool,"pbConfigurable",!1),this._sBaseClass="WebGroup",this._sControlClass="WebWidget",this._bEditMode=!1,this._eSelTop,this._eSelLeft,this._eSelBottom,this._eSelRight,this._eDragMove,this._eResizeHandle,this._eRemoveBtn,this._oInternalDragDropHelper=null}getWidgetProps(){return{sName:this.psWidgetName,sDynId:this.psDynamicWidgetId,iRowIndex:this.piRowIndex,iColIndex:this.piColumnIndex,iRowSpan:this.piRowSpan,iColSpan:this.piColumnSpan,bFillHeight:this.pbFillHeight,aConfig:this.getCurrentConfiguration()}}initInternalDrag(e){this._oInternalDragDropHelper=e,this._oInternalDragDropHelper.registerDragSource(this.getLongName(),r.dragActions.WebWidgetContainer.ciDragWidget)}getCurrentConfiguration(){return[]}setEditMode(e){this._bEditMode=e,this._bEditMode?this.showEditBox():this.hideEditBox()}showEditBox(){let e,t=[];t.push('<div class="WebCon_WebWidget_Edit_Box" style="display: none"'+(this._oInternalDragDropHelper||this.pbDragDropEnabled?' draggable="true"':"")+">"),t.push('    <div class="WebCon_WebWidget_Top_Btns_Wrp">'),t.push('        <span class="WebCon_WebWidget_Drag_Indicator WebCon_Icon"></span>'),t.push('        <span class="WebCon_WebWidget_Edit_Btns_Wrp">'),t.push('            <span class="WebCon_WebWidget_Edit_Btn_Wrp"><span class="WebCon_WebWidget_Function_Btn WebCon_WebWidget_Edit_Btn WebCon_Icon"></span></span>'),t.push('            <span class="WebCon_WebWidget_Edit_Btn_Wrp"><span class="WebCon_WebWidget_Function_Btn WebCon_WebWidget_Remove_Btn WebCon_Icon"></span></span>'),t.push("        </span>"),t.push("    </div>"),t.push('    <div class="WebCon_WebWidget_Bottom_Btns_Wrp">'),t.push('        <span class="WebCon_WebWidget_ResizeHandle_Wrp">'),t.push('            <span class="WebCon_WebWidget_Function_Btn WebCon_WebWidget_ResizeHandle WebCon_Icon"></span>'),t.push("        </span>"),t.push("    </div>"),t.push("</div>"),this._eEditBox=e=r.dom.create(t.join("")),this._eResizeHandle=r.dom.query(e,"span.WebCon_WebWidget_ResizeHandle"),this._eEditBtn=r.dom.query(e,"span.WebCon_WebWidget_Edit_Btn"),this._eRemoveBtn=r.dom.query(e,"span.WebCon_WebWidget_Remove_Btn"),r.events.addDomListener("mousedown",this._eEditBox,this.onWidgetMove,this),r.events.addDomListener("mousedown",this._eResizeHandle,this.onWidgetResize,this),r.events.addDomListener("click",this._eEditBtn,this.onEditClick,this),r.events.addDomListener("click",this._eRemoveBtn,this.onRemoveClick,this),this._eElem.appendChild(e),this.pbConfigurable||(this._eEditBtn.style.display="none"),this.repositionEditBox()}repositionEditBox(){this._eEditBox&&(this._eElem?this.positionEditBox(r.sys.gui.getBoundRect(this._eContainer)):this._eSel.style.display="none")}positionEditBox(e){this._eEditBox.style.display="",this._eEditBox.style.width=Math.round(e.width)+"px",this._eEditBox.style.height=Math.round(e.height)+"px",this.pbAllowResize?this._eResizeHandle.style.display="inline-block":this._eResizeHandle.style.display="none"}onEditClick(e){this.pbConfigurable&&this.editWidget()}editWidget(){this._oParent?.editWidgetEx&&this._oParent.editWidgetEx(this)}onRemoveClick(e){this.removeWidget()}removeWidget(){this._oParent?.removeWidgetEx&&this._oParent.removeWidgetEx(this)}onWidgetMove(e){}onWidgetResize(e){var t,i,s,o,n,a,l,h,d,p=this;if(this._eElem,h=this._oParent,this._oParent.snapshotChildrenPositions(),h&&!h.isGridLayout())return!1;if(!h._eGridOverLay&&!h.drawGridOverlay())return!1;h.showGrid();var u=document.elementsFromPoint(e.getMouseX(),e.getMouseY());for(let e=0;e<u.length;e++)if(u[e].classList.contains("WebCon_WebWidgetContainer_GridOverlay_Cell")){d=u[e];break}function c(e){let r;r=document.elementsFromPoint(e.getMouseX(),e.getMouseY());for(let e=0;e<r.length;e++)if(r[e].classList.contains("WebCon_WebWidgetContainer_GridOverlay_Cell")){d=r[e];break}let l=d.dataset.dfcellid;t=parseInt(l.split("-")[0]),i=parseInt(l.split("-")[1]),a=t-s+1;let h=(n=i-o+1)&&p.piColumnSpan!==n,u=a&&p.piRowSpan!==a;if(h&&(p.piColumnSpan=n),u&&(p.piRowSpan=a),h||u){this._oParent.resetPositionsToSnapshot();let e=this._oParent.getObjRect(p);this._oParent.checkAndResolveCollisions(e,p),this._oParent.position()}}function g(e){r.events.removeDomListener("mouseup",l,g,this),r.events.removeDomListener("mouseup",window,g,this),r.events.removeDomListener("mousemove",l,c,this),h&&h instanceof r.WebWidgetContainerInternal&&(h._eGridOverLay.style.cursor="default",h.redrawGrid(),h.fire("ServerOnWidgetResized",JSON.stringify(this.getWidgetProps))),(l=h._eContainer)&&(l.style.cursor="default",this._eEditBox.style.cursor="grabbing",h.hideGrid())}d?(s=function(e,t){let i=1;if(e.piRowIndex>-1)return e.piRowIndex;let s=t.dataset.dfcellid,o=parseInt(s.split("-")[0]);i=e.piRowSpan<=0?1:e.piRowSpan;return o-(i-1)}(p,d),o=function(e,t){let i=1;if(e.piColumnIndex>-1)return e.piColumnIndex;let s=t.dataset.dfcellid,o=parseInt(s.split("-")[1]);i=e.piColumnSpan<=0?1:e.piColumnSpan;return o-(i-1)}(p,d)):(s=p.piRowIndex>-1?p.piRowIndex:0,o=p.piColumnIndex>-1?p.piColumnIndex:0),this.bAutoRepos=!1,(l=h._eContainer)&&(l.style.cursor=this._eEditBox.style.cursor="nwse-resize",r.events.addDomListener("mousemove",l,c,this),r.events.addDomListener("mouseup",window,g,this),r.events.addDomListener("mouseup",l,g,this),e.stop())}getDragData(e,t){let i={sControlName:this.getLongName(),WidgetProps:this.getWidgetProps()};return this._oParent.initWidgetDrag(e,this),[i,r.dragActions.WebWidgetContainer.ciDragWidget]}moveWidget(e,t){this.piRowIndex!=e&&this.set_piRowIndex(e),this.piColumnIndex!=t&&this.set_piColumnIndex(t)}getParentContainer(e){let t,i=e,s=this.getWebApp();if(s){for(;i&&i!==document&&(!t||!t._bIsContainer||t==this.oObj);)i.hasAttribute("data-dfobj")&&(t=s.findObj(i.getAttribute("data-dfobj"))),i=i.parentNode;return t}}hideEditBox(){this._eEditBox&&(this._eEditBox.parentNode.removeChild(this._eEditBox),this._eEditBox=null)}createObserver(){this._eElem&&!this._oObserver&&(this._oObserver=new ResizeObserver((e=>{let t=e[0]?.contentRect.height;t||(t=this._eElem.getBoundingClientRect()?.height||0),this.sizeHeight(t),this.repositionEditBox()})),this._oObserver.observe(this._eElem),this._oMutationObserver=new MutationObserver((e=>{this.repositionEditBox()})),this._oMutationObserver.observe(this._eElem,{attributes:!0,attributeFilter:["style"],attributeOldValue:!0}))}},r.WebWidgetContainerDragDropHelper=class extends Xe{constructor(e,t){super(e,t)}onDrop(e,t,i){if(this._oDragData&&i&&this.supportsDropAction(i._oControl,i._eDropAction)){const e=i.getDropData();var s={DragData:this._oDragData.oData,DropData:e};this.getWebApp()?.findObj(s.DragData.sControlName)?.moveWidget(e.data.iRow,e.data.iCol),i._oControl.fire("ServerOnWidgetMoved",[s.DragData.sControlName,e.data.iRow,e.data.iCol])}this.onDragEnd(e)}},r.WebWidgetContainerInternal=class extends j{constructor(e,t){super(e,t),t._oWidgetContainer=this,this.prop(r.tBool,"pbAutoToggleGrid",!1),this.prop(r.tBool,"pbDisableInternalDragDropHelper",!1),this.prop(r.tBool,"pbUseCustomConfigurationStorage",!1),this.prop(r.tBool,"pbServerOnToggleEditMode",!1),this.prop(r.tBool,"pbServerOnWidgetMoved",!1),this.prop(r.tBool,"pbServerOnWidgetResized",!1),this.event("OnToggleEditMode",r.cCallModeWait),this._aWidgets=[],this._aHighlightedCells=[],this._eEditMenu,this._oSelectedWidget=null,this._oInternalDragDropHelper=null,this._ePlaceHolder,this._oCurDragControl=null,this._aChildrenSnapShot=[],this._bResolvingCollisions=!1,this._iCurrentHoverCol=-1,this._aWidgetDefaultSizes=[],this._iRowsActual=-1,this._iGhostRows=0,this._sBaseClass="WebDynamicObjectContainer",this._sControlClass="WebWidgetContainer"}afterRender(){super.afterRender(),this._oParent._oWidgetContainer=this,this.applyProps();let e=r.dom.create('<div class="WebCon_WebWidgetContainer_Edit_Wrp"></div>');if(this._eContent.appendChild(e),this._eToggleEditBtn||(this._eToggleEditBtn=r.dom.create('<span class="WebCon_WebWidgetContainer_Toggle_Edit_Btn WebCon_Icon"></span>'),e.appendChild(this._eToggleEditBtn),r.events.addDomListener("click",this._eToggleEditBtn,this.toggleEditMode,this)),!this._eEditMenu){this._eEditMenu=r.dom.create('<span class="WebCon_WebWidgetContainer_Edit_Menu" style="display:none"></span>'),e.appendChild(this._eEditMenu);let t=r.dom.create('<span class="WebCon_WebWidgetContainer_Save_Edits_Btn WebCon_Icon"></span>');this._eEditMenu.appendChild(t),r.events.addDomListener("click",t,this.saveConfiguration,this);let i=r.dom.create('<span class="WebCon_WebWidgetContainer_Cancel_Edits_Btn WebCon_Icon"></span>');this._eEditMenu.appendChild(i),r.events.addDomListener("click",i,this.cancelEdits,this)}this.drawGridOverlay()}create(){super.create(),this.pbDisableInternalDragDropHelper||this.initInternalDragDropHelper()}applyProps(){this.pbAutoToggleGrid=this._oParent?.pbAutoToggleGrid,this.pbDisableInternalDragDropHelper=this._oParent?.pbDisableInternalDragDropHelper,this.pbUseCustomConfigurationStorage=this._oParent?.pbUseCustomConfigurationStorage,this.pbServerOnToggleEditMode=this._oParent?.pbServerOnToggleEditMode,this.pbServerOnWidgetMoved=this._oParent?.pbServerOnWidgetMoved,this.pbServerOnWidgetResized=this._oParent?.pbServerOnWidgetResized}initInternalDragDropHelper(){this._oInternalDragDropHelper||(this._oInternalDragDropHelper=new r.WebWidgetContainerDragDropHelper(this.getLongName()+"int-dragdrop-helper",this),this._oInternalDragDropHelper.registerDropTarget(this.getLongName(),r.dropActions.WebWidgetContainer.ciDropOnCell))}loadDynamicObjects(){if(super.loadDynamicObjects(),!this.pbDisableInternalDragDropHelper)for(let e=0;e<this._aChildren.length;e++)this._aChildren[e]instanceof r.WebWidget&&this._aChildren[e].initInternalDrag(this._oInternalDragDropHelper);this.calcRowsActual(),this.drawGridOverlay()}loadWidgets(e){this._tActionData=e,this.loadDynamicObjects()}calcRowsActual(){let e;this._iRowsActual=this.piRowCount;for(let t=0;t<this._aChildren.length;t++)e=this._aChildren[t],e instanceof r.WebWidget&&(e=this._aChildren[t],e.piRowIndex+e.piRowSpan>this._iRowsActual&&(this._iRowsActual=e.piRowIndex+e.piRowSpan));return this._iRowsActual}registerWidgetDefaultSizes(){let e=this._tActionData;for(let t=0;t<e.length;t++)this._aWidgetDefaultSizes.push({sName:e[t].sName,iRowSpan:e[t].iRowSpan,iColSpan:e[t].iColSpan})}registerWidget(e){let t=this.getWebApp()?.findObj(e);t&&(t.setEditMode(this._bEditMode),this._oInternalDragDropHelper&&t.initInternalDrag(this._oInternalDragDropHelper))}findSpotForWidget(){const e=this._tActionData;e.iRowSpan,e.iColSpan;let[t,i]=this.findSpotForWidgetEx(e.iRowSpan,e.iColSpan);e.iRowIndex=t,e.iColIndex=i,this.serverAction("AppendWidgetEx",[],e,null)}findSpotForWidgetEx(e,t){let i={},s=[];for(let o=0;o<this._iRowsActual;o++)for(let n=0;n<this.piColumnCount-t;n++)if(i={iRowMin:o,iRowMax:o+e,iColMin:n,iColMax:n+t-1,iRowSpan:e,iColSpan:t},s=this.checkForCollisions(i),s.length<=0)return[o,n];return[0,0]}editWidgetEx(e){this.serverAction("RequestConfigWizard",[e.getLongName()],null,null)}removeWidget(e){let t=this.getWebApp()?.findObj(e);t&&this.removeWidgetEx(t)}removeWidgetEx(e){this.serverAction("RemoveWidget",[e._sName],e.getWidgetProps())}saveConfiguration(){let e=this.serializeDashboard()||{};this.serverAction("ServerOnSaveConfiguration",[],e,null,null),this.toggleEditMode()}saveConfigurationToLocalStorage(){const e=this._tActionData;this.saveConfigurationToLocalStorageEx(e)}saveConfigurationToLocalStorageEx(e){if(!r.pbDebugging)try{localStorage.setItem(this.getStorageName("dashboard"),JSON.stringify(e))}catch(e){}}invalidateLocalConfiguration(){this.saveConfigurationToLocalStorageEx({})}getStorageName(e){return e&&e.length>0?window.location.host+"."+window.location.pathname+"."+this.getLongName()+"@"+e:window.location.host+"."+window.location.pathname+"."+this.getLongName()}serializeDashboard(){let e={sConfigVersionCode:this._oParent.psConfigVersionCode,GridDef:{iRowCount:this.piRowCount,iColCount:this.piColumnCount,iDefaultRowHeight:this.piDefaultRowHeight,sDefaultColWidth:this.psDefaultColumnWidth,sRowHeights:this.psRowHeights,sColWidths:this.psColumnWidths},aWidgets:[]};for(let t=0;t<this._aChildren.length;t++)e.aWidgets.push(this._aChildren[t].getWidgetProps());return e}widgetByName(e){return this[e]||null}loadConfigurationFromLocalStorage(e){"boolean"!=typeof e&&(e=!0);let t=null;const i=localStorage.getItem(this.getStorageName("dashboard"));if(i)try{t=JSON.parse(i)}catch(e){i&&localStorage.removeItem(this.getStorageName("dashboard")),t=null}return this.serverAction("LoadConfigurationFromLocalStorage",[r.fromBool(!!t)],t,null,null),t}toggleEditMode(){this._bEditMode=!this._bEditMode;for(let e=0;e<this._aChildren.length;e++){let t=this._aChildren[e];t instanceof r.WebWidget&&t.setEditMode(this._bEditMode)}this._eToggleEditBtn.style.display=this._bEditMode?"none":"",this._eEditMenu.style.display=this._bEditMode?"flex":"none",this.fire("OnToggleEditMode",[r.fromBool(this._bEditMode)])}cancelEdits(){this.serverAction("Reload",[],null,null),this.toggleEditMode()}drawGridOverlay(){this._eGridOverLay&&this.destroyGrid();let e=this;if(e._bPanels)return!1;if(!this.getContainerRect(e))return;let t=this.determineColumns(e),i=this.determineGridOverlayRows(e),s=[];s.push('<Table class="WebCon_WebWidgetContainer_GridOverlay" style="display: none; opacity: 0;" data-dfcontainerobj="',e._eElem.dataset.dfobj,'"><tbody>');for(let e=0;e<i.length;e++){let o=this.genGridRowHtml(e,i[e],t);s.push(o)}return s.push("</tbody></table>"),this._eGridOverLay=r.dom.create(s.join("")),this._eContainer.prepend(this._eGridOverLay),this._iRowCount=i.length,!0}genGridRowHtml(e,t,i,s){let o='<tr style="height: '+t+"px; border-bottom: 1px dashed rgba(84, 175, 255, 0.5);";0==e&&(o+="border-top: 1px dashed rgba(84, 175, 255, 0.5);"),o+='"',s&&(o+=' data-dfisghostrow="true"'),o+=">";let n="";for(let t=0;t<i.length;t++)n+='<td class="WebCon_WebWidgetContainer_GridOverlay_Cell" data-dfcellid="'+e+"-"+t+'" style="position: relative; width: '+(0==t?i[t]-2:i[t]-1)+"px; ",0==t&&(n+="border-left: 1px dashed rgba(84, 175, 255, 0.5); "),n+='border-right: 1px dashed rgba(84, 175, 255, 0.5);">',n+="</td>";return o+=n+"</tr>",o}determineColumns(e,t){return e.determineColumnWidths()}determineRows(e){return e.determineRowHeights()}determineGridOverlayRows(e){let t=this.determineRows(e);if(t.length<this._iRowsActual){let e=this.genBaseRowHeightString();for(let i=t.length;i<this._iRowsActual;i++)t.push(e)}return t}redrawGrid(){this._eGridOverLay?.parentNode?.removeChild(this._eGridOverLay),this._eGridOverLay=null,this.drawGridOverlay(this.oObj)}destroyGrid(){this._eGridOverLay&&(this._eGridOverLay.parentNode.removeChild(this._eGridOverLay),this._eGridOverLay=null)}findParentWidget(e){return e instanceof r.WebWidget||e instanceof r.WebView?e:this.findParentWidget(e._oParent)}toggleGrid(){this._eGridOverLay&&("none"==this._eGridOverLay.style.display?(this._eGridOverLay.style.display="table",this._bGridVisible=!0):(this._eGridOverLay.style.display="none",this._bGridVisible=!1))}showGrid(e){this._eGridOverLay&&(this._eGridOverLay.style.display="table",this._bGridVisible=!0)}hideGrid(){this._eGridOverLay&&(this._eGridOverLay.style.display="none",this._bGridVisible=!1)}getContainerRect(e){if(!e||!e._eContent)return null;let t=r.sys.gui.getBoundRect(e._eContent),i=r.sys.gui.getCurrentStyle(e._eContent),s=t.left+parseFloat(i.paddingLeft),o=t.right-parseFloat(i.paddingRight),n=t.top+parseFloat(i.paddingTop),a=t.bottom-parseFloat(i.paddingBottom);return{left:s,right:o,top:n,bottom:a,width:o-s,height:a-n}}refreshOverlay(){this.redrawGrid()}set_ptContainerDef(e){this.ptContainerDef=e,this.saveConfigurationToLocalStorage()}set_peLayoutType(e){this.peLayoutType=r.layoutType.ciLayoutTypeGrid}layoutType(){return r.layoutType.ciLayoutTypeGrid}genBaseRowHeightString(e){return e+"px"}getDragData(e,t){return[null,null]}getDropData(e,t){let i={data:{iRow:-1,iCol:-1},action:r.dropActions.WebWidgetContainer.ciDropOnCell};const s=e._eDropElem&&e._eDropElem.getAttribute("data-dfcellid")||-1;let o,n;s&&""!=s&&(o=parseInt(s.split("-")[0]),n=parseInt(s.split("-")[1])),this._oWidgetDragInfo&&(o=Math.max(0,o-this._oWidgetDragInfo.iRowOffset),n=Math.max(0,n-this._oWidgetDragInfo.iColOffset)),i.data.iRow=o,i.data.iCol=n;let a=this.findWidgetNameInDragData(e._aHelpers[0]._oDragData);for(let e=0;e<this._aWidgetDefaultSizes.length;e++){let t=this._aWidgetDefaultSizes[e];t.sName==a&&(i.data.iRowSpan=t.iRowSpan,i.data.iColSpan=t.iColSpan)}return i}determineGridCell(e,t){let i=document.elementsFromPoint(e,t);for(let e=0;e<i.length;e++)if(i[e].classList.contains("WebCon_WebWidgetContainer_GridOverlay_Cell"))return i[e];return null}initDropZones(){this._aDropZones=[],super.initDropZones(),this.isSupportedDropAction(r.dropActions.WebWidgetContainer.ciDropOnCell)&&this.addDropZone(this._eElem,this)}determineDropCandidate(e,t){if(t.find((e=>e.supportsDropAction(this,r.dropActions.WebControl.ciDropOnControl))))return[this._eElem,r.dropActions.WebControl.ciDropOnControl];if(!t.find((e=>e.supportsDropAction(this,r.dropActions.WebWidgetContainer.ciDropOnCell))))return[null,null];let i=this.determineGridCell(e.e.x,e.e.y);return i?[i,r.dropActions.WebWidgetContainer.ciDropOnCell]:[null,null]}initWidgetDrag(e,t){this.showGrid();let i=this.determineGridCell(e.e.x,e.e.y);this.hideGrid();let[s,o]=i?.dataset.dfcellid.split("-")||[0,0],n=s-t.piRowIndex,r=o-t.piColumnIndex;this._oWidgetDragInfo={oWidget:t,iRow:s,iCol:o,iRowOffset:n,iColOffset:r}}highlightDropZones(e){super.highlightDropZones(e),this.snapshotChildrenPositions(),this._iCurrentHoverCol=-1,this._oCurDragControl=e._oDragData.oControl,this.showGrid()}cleanupDropZones(){super.cleanupDropZones(),this._aChildrenSnapShot=[],this._iCurrentHoverCol=-1,this._ePlaceHolder?.parentNode.removeChild(this._ePlaceHolder),this._ePlaceHolder=null,this._oCurDragControl=null,this._oWidgetDragInfo=null,this._bResolvingCollisions=!1,this.removeGhostRows(0),this.hideGrid()}interactWithDropElem(e,t){if(e._eDropAction==r.dropActions.WebControl.ciDropOnControl)e.highlightElement();else{e.highlightElement();let[i,s]=t.dataset.dfcellid.split("-");i=parseInt(i),s=parseInt(s);let o={iColMin:s,iColMax:s,iRowMin:i,iRowMax:i};if(this._iCurrentHoverCol!=s||this._iCurrentHoverRow!=i){this.resetPositionsToSnapshot(),this._iCurrentHoverCol=s,this._iCurrentHoverRow=i;let t=e._aHelpers[0]._oDragData.oControl;if(t instanceof r.WebWidget){this._oCurDragControl=t;let e=Math.max(0,i-this._oWidgetDragInfo.iRowOffset),n=Math.max(0,s-this._oWidgetDragInfo.iColOffset);o.iRowMin=e,o.iColMin=n,o.iColSpan=t.piColumnSpan,o.iRowSpan=t.piRowSpan,o.iColMax=o.iColMin+(t.piColumnSpan-1),o.iRowMax=o.iRowMin+t.piRowSpan,t.piRowIndex=e,t.piColumnIndex=n,this.position()}else{let t=this.findWidgetNameInDragData(e._aHelpers[0]._oDragData);if(this.getObjRectFromDefaultSizes(t,o),this._ePlaceHolder)this._ePlaceHolder.style.gridArea=i+1+" / "+(s+1)+" / span "+o.iRowSpan+" / span "+o.iColSpan;else{let e='<div class="WebCon_Widget_PlaceHolder" style="border: 1px dotted black; grid-area: '+(i+1)+" / "+(s+1)+" / span "+o.iRowSpan+" / span "+o.iColSpan+';"></div>';this._ePlaceHolder=r.dom.create(e),this._eContent.appendChild(this._ePlaceHolder)}}this.checkGridBottom(o),this.checkAndResolveCollisions(o)}}}checkGridBottom(e){let t=this._iGhostRows>=0?this._iGhostRows:0,i=e.iRowSpan>1?e.iRowMax:e.iRowMax+1,s=i-(this._iRowsActual+t);s>0?(this._iGhostRows+=s,this.addGhostRows(s)):t>0&&this.removeGhostRows(i)}addGhostRows(e){let t="",i=this.determineColumns(this),s=r.dom.query(this._eGridOverLay,"tr",!0).length,o=this.getDefaultRowHeight(),n=r.dom.query(this._eGridOverLay,"tbody");if(n){for(let n=0;n<e;n++)t+=this.genGridRowHtml(s,o,i,!0);n.innerHTML=n.innerHTML+t}}removeGhostRows(e){let t,i=Array.from(r.dom.query(this._eGridOverLay,"tr",!0));for(;i.length>e;)t=i.pop(),"true"==t.dataset.dfisghostrow&&(t.parentNode.removeChild(t),this._iGhostRows--)}findWidgetNameInDragData(e){return e.oControl instanceof r.WebList?e.oData.data.sRowId:e.oControl instanceof r.WebTreeView?e.oData.data.sValue:e.oData.data}getObjRectFromDefaultSizes(e,t){for(let i=0;i<this._aWidgetDefaultSizes.length;i++){let s=this._aWidgetDefaultSizes[i];s.sName==e&&(t.iColSpan=s.iColSpan,t.iRowSpan=s.iRowSpan,t.iColMax=t.iColMin+(s.iColSpan-1),t.iRowMax=t.iRowMin+s.iRowSpan)}}snapshotChildrenPositions(){for(let e=0;e<this._aChildren.length;e++)this._aChildrenSnapShot.push(this._aChildren[e].piRowIndex)}resetPositionsToSnapshot(){for(let e=0;e<this._aChildren.length;e++)this._aChildren[e].piRowIndex=this._aChildrenSnapShot[e];this.position()}checkForCollisions(e,t){let i=[];for(let s=0;s<this._aChildren.length;s++){let o=this._aChildren[s];o!=this._oCurDragControl&&o!=t&&this.isWithinObjRect(e,o)&&i.push(o)}return i}checkAndResolveCollisions(e,t){let i=this.checkForCollisions(e,t),s=0;for(;s<i.length;)this._bResolvingCollisions||(this.resolveCollision(i[s],e),s++)}resolveCollision(e,t){if(!this._bResolvingCollisions){this._bResolvingCollisions=!0,e.piRowIndex=t.iRowMax,this.position();let i=this.getObjRect(e);this.checkAndResolveCollisions(i,e)}}position(){super.position(),this._bResolvingCollisions=!1}getObjRect(e){return{iColMin:e.piColumnIndex||0,iColMax:e.piColumnIndex+(e.piColumnSpan-1)||0,iRowMin:e.piRowIndex||0,iRowMax:e.piRowIndex+e.piRowSpan||0}}isWithinObjRect(e,t){let i=[],s=[];const o=t.piColumnIndex+(t.piColumnSpan-1);for(let t=e.iColMin;t<=e.iColMax;t++)i.push(t);for(let e=t.piColumnIndex;e<=o;e++)s.push(e);if(this.arrayIntersections(s,i).length>0){let i=[],s=[];const o=t.piRowIndex+(t.piRowSpan-1);for(let t=e.iRowMin;t<=e.iRowMax;t++)i.push(t);for(let e=t.piRowIndex;e<=o;e++)s.push(e);return this.arrayIntersections(s,i).length>0}return!1}arrayIntersections(e,t){const i=new Set(e);return t.filter((e=>i.has(e)))}highlightGridCell(e){for(let e=0;e<this._aHighlightedCells.length;e++)this._aHighlightedCells[e].style.backgroundColor="transparent";this._aHighlightedCells=[],e.style.backgroundColor="rgba(84, 175, 255, 0.5)",this._aHighlightedCells.push(e)}resize(){super.resize(),this._eGridOverLay&&this.redrawGrid()}},r.WebWidgetContainer=class extends qe{constructor(e,t){super(e,t),this.prop(r.tBool,"pbAutoToggleGrid",!1),this.prop(r.tBool,"pbDisableInternalDragDropHelper",!1),this.prop(r.tBool,"pbUseCustomConfigurationStorage",!1),this.prop(r.tBool,"pbServerOnToggleEditMode",!1),this.prop(r.tBool,"pbServerOnWidgetMoved",!1),this.prop(r.tBool,"pbServerOnWidgetResized",!1),this._oWidgetContainer=null,this._sBaseClass="WebGroup",this._sControlClass="WebWidgetContainer"}create(){super.create(),this.peLayoutType=r.layoutType.ciLayoutTypeFlow}afterRender(){super.afterRender()}set_pbAutoToggleGrid(e){this.pbAutoToggleGrid=e,this._oWidgetContainer?.set_pbAutoToggleGrid(e)}set_pbDisableInternalDragDropHelper(e){this.pbDisableInternalDragDropHelper=e,this._oWidgetContainer?.set_pbDisableInternalDragDropHelper(e)}set_pbUseCustomConfigurationStorage(e){this.pbUseCustomConfigurationStorage=e,this._oWidgetContainer?.set_pbUseCustomConfigurationStorage(e)}set_pbServerOnToggleEditMode(e){this.pbServerOnToggleEditMode=e,this._oWidgetContainer?.set_pbServerOnToggleEditMode(e)}set_pbServerOnWidgetMoved(e){this.pbServerOnWidgetMoved=e,this._oWidgetContainer?.set_pbServerOnWidgetMoved(e)}set_pbServerOnWidgetResized(e){this.pbServerOnWidgetResized=e,this._oWidgetContainer?.set_pbServerOnWidgetResized(e)}getDragSourceObj(){return this._oWidgetContainer}getDropTargetObj(){return this._oWidgetContainer}getDragData(e,t){return this._oWidgetContainer.getDragData(e,t)}getDropData(e,t){return this._oWidgetContainer.getDropData(e,t)}}})();
//# sourceMappingURL=df-min.js.map