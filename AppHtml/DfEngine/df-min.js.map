{"version":3,"file":"df-min.js","mappings":"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OACA,UACA,WACA,mBACA,WACA,YACA,WACA,SACA,UACA,kBAGJC,eAAgB,CACZ,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,MACA,QACA,QACA,QACA,SAGJC,WAAY,CACR,cACA,YACA,QACA,cACA,YACA,WACA,aACA,mBACA,aACA,YACA,iBACA,cACA,cACA,YACA,iBACA,qBACA,MACA,OACA,QACA,OACA,cAGJC,iBAAkB,CACd,QACA,SAGJC,MAAO,CACH,mBACA,oBACA,qBACA,uBACA,mBACA,kBACA,iBACA,wBACA,kBACA,gBACA,kBACA,gBACA,kBACA,mBACA,uBACA,qBACA,wBAGJC,OAAQ,CACJ,uBACA,qBAGJC,YAAa,CACT,qBACA,qBACA,iBACA,iBACA,aACA,oBACA,oBACA,cACA,oBACA,oBACA,mBACA,eACA,uBAEJC,QAAS,CACL,cACA,mBACA,iBACA,cACA,iBACA,gBACA,eAEJC,YAAa,CACT,YACA,OACA,SACA,cACA,UACA,SACA,SACA,cACA,mBACA,eACA,aACA,aAEJC,GAAI,CACA,KACA,WACA,iBACA,qBACA,4BACA,0BACA,iBACA,gBACA,UACA,oBACA,oBACA,oBACA,oBACA,eACA,eACA,eACA,eACA,cACA,iBACA,YACA,gBACA,UACA,iBACA,cACA,gBACA,gBACA,oBACA,sBACA,uBACA,WAGJC,cAAe,CACX,WACA,WACA,aACA,eACA,gBACA,cACA,cACA,eACA,sBACA,SACA,cACA,MACA,OACA,iBACA,iBACA,iBACA,iBACA,kBACA,kBACA,kBACA,kBACA,iBACA,iBACA,iBACA,iBACA,QACA,eACA,mBACA,OACA,gBACA,OACA,cACA,cACA,OACA,YACA,kBACA,YACA,oBACA,mBACA,oBACA,mBACA,eACA,aACA,eACA,cACA,mBACA,sBACA,kBACA,WACA,UACA,WACA,WACA,aACA,SACA,gBACA,iBACA,cACA,eACA,eACA,kBACA,WACA,qBACA,iBACA,WACA,oBACA,WACA,WACA,WACA,WACA,gBAC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","sources":["webpack:///./df/sys/dev.js","webpack:///./df/sys/gui.js","webpack:///./df/events.js","webpack:///./df/dom.js","webpack:///./df/sys/json.js","webpack:///./df/sys.js","webpack:///./df/sys/vt.js","webpack:///./df/settings.js","webpack:///./df.js","webpack:///./df/ajax/HttpRequest.js","webpack:///./df/ajax/JSONCall.js","webpack:///./df/MobRuleController.js","webpack:///./df/WebObject.js","webpack:///./df/dragdrop/WebDragDropMixin.js","webpack:///./df/WebBaseUIObject.js","webpack:///./df/WebBaseControl.js","webpack:///./df/WebBaseContainer.js","webpack:///./df/WebBaseDEO.js","webpack:///./df/WebBaseForm.js","webpack:///./df/WebPanel.js","webpack:///./df/WebBaseView.js","webpack:///./df/WebWindow.js","webpack:///./df/WebModalDialog.js","webpack:///./df/WebLabel.js","webpack:///./df/WebProgressBar.js","webpack:///./df/WebButton.js","webpack:///./df/WebSpacer.js","webpack:///./df/WebIFrame.js","webpack:///./df/WebHtmlBox.js","webpack:///./df/BaseApp.js","webpack:///./df/LocalApp.js","webpack:///./df/WebBaseFileUpload.js","webpack:///./df/WebMenuItem.js","webpack:///./df/WebMenuItemCheckbox.js","webpack:///./df/WebBaseMenu.js","webpack:///./df/WebForm.js","webpack:///./df/WebFloatingPanel.js","webpack:///./df/WebDatePicker.js","webpack:///./df/WebDateForm.js","webpack:///./df/WebDynamicObjectContainer.js","webpack:///./df/WebCheckbox.js","webpack:///./df/WebCombo.js","webpack:///./df/WebBaseSelectionForm.js","webpack:///./df/WebSuggestionForm.js","webpack:///./df/WebTagsForm.js","webpack:///./df/WebListModel.js","webpack:///./df/WebListView.js","webpack:///./df/WebListScrollingView.js","webpack:///./df/WebListPagedModel.js","webpack:///./df/WebListController.js","webpack:///./df/weblist/WebListGroupController.js","webpack:///./df/WebListRowModel.js","webpack:///./df/WebMenuList.js","webpack:///./df/WebContextMenu.js","webpack:///./df/WebMenuColumnBase.js","webpack:///./df/WebMenuColumnList.js","webpack:///./df/WebMenuColumnRestorer.js","webpack:///./df/WebListHeaderView.js","webpack:///./df/WebListFooterView.js","webpack:///./df/WebListTouchHandler.js","webpack:///./df/WebListPlaceHolderView.js","webpack:///./df/WebList.js","webpack:///./df/WebListExpandPanel.js","webpack:///./df/WebColumn_mixin.js","webpack:///./df/WebColumn.js","webpack:///./df/WebGridView.js","webpack:///./df/WebGridModel.js","webpack:///./df/WebGridController.js","webpack:///./df/WebGrid.js","webpack:///./df/WebMultiSelectListController.js","webpack:///./df/WebMultiSelectListRowModel.js","webpack:///./df/WebMultiSelectList.js","webpack:///./df/WebColumnCombo.js","webpack:///./df/WebColumnCheckbox.js","webpack:///./df/WebColumnDate.js","webpack:///./df/WebColumnButton.js","webpack:///./df/WebColumnImage.js","webpack:///./df/WebColumnSuggestion.js","webpack:///./df/WebColumnLink.js","webpack:///./df/WebColumnTags.js","webpack:///./df/WebMenuBar.js","webpack:///./df/WebToolBar.js","webpack:///./df/WebMenuGroup.js","webpack:///./df/weblist/WebListGroupSelector.js","webpack:///./df/WebCard.js","webpack:///./df/WebCardContainer.js","webpack:///./df/WebTabPage.js","webpack:///./df/WebTreeView.js","webpack:///./df/WebFileUploadForm.js","webpack:///./df/WebGroup.js","webpack:///./df/WebBreadcrumb.js","webpack:///./df/WebColorPicker.js","webpack:///./df/WebHtmlList.js","webpack:///./df/dragdrop/WebDragDropHelper.js","webpack:///./df/dragdrop/WebDragDropFileHelper.js","webpack:///./df/dashboard/WebWidgetContainerInternal.js","webpack:///./df-lib.js","webpack:///./df/ServerAction.js","webpack:///./df/InfoBalloon.js","webpack:///./df/GroupHub.js","webpack:///./df/WebApp.js","webpack:///./df/WebView.js","webpack:///./df/WebEdit.js","webpack:///./df/WebSelectionForm.js","webpack:///./df/WebListSwipeButton.js","webpack:///./df/WebColumnSelectionIndicator.js","webpack:///./df/WebCommandBar.js","webpack:///./df/WebActionBar.js","webpack:///./df/WebMenuGroupingSelector.js","webpack:///./df/WebTabContainer.js","webpack:///./df/WebImage.js","webpack:///./df/WebRadio.js","webpack:///./df/WebSlider.js","webpack:///./df/WebHorizontalLine.js","webpack:///./df/WebTimer.js","webpack:///./df/WebFileUploadButton.js","webpack:///./df/WebMenuButton.js","webpack:///./df/WebColorForm.js","webpack:///./df/WebColumnHighlight.js","webpack:///./df/WebAccordionContainer.js","webpack:///./df/WebAccordionCard.js","webpack:///./df/WebGeoLocation.js","webpack:///./df/WebDrawing.js","webpack:///./df/dragdrop/WebDropZone.js","webpack:///./df/dashboard/WebWidget.js","webpack:///./df/dashboard/WebWidgetContainerDragDropHelper.js","webpack:///./df/dashboard/WebWidgetContainer.js"],"sourcesContent":["\r\nexport const dev = {\r\n    /*\r\n    If true the browser is supposed to be safari or part of the safari family.\r\n    */\r\n    isSafari: false,\r\n    /*\r\n    True if the browser seems to be Google Chrome.\r\n    */\r\n    isChrome: false,\r\n    /*\r\n    True if the browser seems to be Opera.\r\n    */\r\n    isOpera: false,\r\n    /*\r\n    If true the browser is supposed to be part of the mozilla family (usually\r\n    FireFox).\r\n    */\r\n    isMoz: false,\r\n    /*\r\n    True if the browser seems to be Internet Explorer. Also true if we where not\r\n    able to detect the browser type properly (if browser unknown threat it as IE\r\n    policy).\r\n    */\r\n    isIE: false,\r\n    /* \r\n    True if the browser seems to be Microsoft Edge.\r\n    */\r\n    isEdge: false,\r\n    /*\r\n    True if the WebKit layout engine is used (Safari & Chrome).\r\n    */\r\n    isWebkit: false,\r\n\r\n    isMobile: false,\r\n    isIOS: false,\r\n\r\n    /*\r\n    Indicates the browser version.\r\n    */\r\n    iVersion: 0,\r\n\r\n\r\n    /* \r\n    Performs the device detection based on the user agent string. This sets / updates the isSafari, \r\n    isIE, .. properties!\r\n    */\r\n    detectDevice() {\r\n        //  Check if something actually changed\r\n        if (this._sPrevUA !== navigator.userAgent) {\r\n            this._sPrevUA = navigator.userAgent;\r\n\r\n            //  Reset values\r\n            this.isSafari = false;\r\n            this.isChrome = false;\r\n            this.isOpera = false;\r\n            this.isMoz = false;\r\n            this.isIE = false;\r\n            this.isEdge = false;\r\n            this.isWebkit = false;\r\n            this.isMobile = false;\r\n            this.isIOS = false;\r\n\r\n            /*\r\n            Performing the version checks. In most situations we try to use object\r\n            detection, but sometimes we still need version checks.\r\n            */\r\n            if (navigator.userAgent.indexOf(\"Trident\") >= 0) {    //  Recognize IE 11 and higher\r\n                this.isIE = true;\r\n                if (document.documentMode) {\r\n                    this.iVersion = document.documentMode;\r\n                } else if (navigator.appVersion.indexOf(\"MSIE\") >= 0) {\r\n                    this.iVersion = parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf(\"MSIE\") + 4), 10);\r\n                } else {\r\n                    this.iVersion = parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf(\"rv:\") + 3), 10);\r\n                }\r\n            } else if (navigator.userAgent.indexOf(\"Edge/\") >= 0) {\r\n                this.isEdge = true;\r\n                this.iVersion = parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf(\"Edge/\") + 5));\r\n            } else if (navigator.userAgent.indexOf(\"Chrome\") >= 0) {\r\n                this.isChrome = true;\r\n                this.iVersion = parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf(\"Chrome/\") + 7));\r\n            } else if (navigator.userAgent.indexOf(\"Safari\") >= 0) {\r\n                this.isSafari = true;\r\n                this.iVersion = parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf(\"Version/\") + 8));\r\n            } else if (navigator.product === \"Gecko\") {\r\n                this.isMoz = true;\r\n                this.iVersion = parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf(\"Firefox/\") + 8));\r\n            } else if (navigator.userAgent.indexOf(\"Opera\") >= 0) {\r\n                this.isOpera = true;\r\n                this.iVersion = parseFloat(navigator.appVersion);\r\n            } else {  //  Default to IE if we don't know\r\n                this.isIE = true;\r\n                this.iVersion = parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf(\"MSIE\") + 4), 10);\r\n\r\n                if (document.documentMode) {\r\n                    this.iVersion = document.documentMode;\r\n                }\r\n            }\r\n            /*\r\n            Determine if this is a mobile device (tablet or mobile phone).\r\n            */\r\n            if (/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i.test(navigator.userAgent)) {\r\n                this.isMobile = true;\r\n            }\r\n            if (/(iPad|iPhone|iPod)/g.test(navigator.userAgent)) {\r\n                this.isIOS = true;\r\n            }\r\n\r\n            if (navigator.userAgent.indexOf(\"AppleWebKit\") >= 0) {\r\n                this.isWebkit = true;\r\n            }\r\n\r\n\r\n        }\r\n    }\r\n}\r\n\r\ndev.detectDevice();","import { dom } from '../dom.js';\r\nimport { dev } from './dev.js';\r\n/*\r\nFunctionality to create graphical components.\r\n*/\r\nexport const gui = {\r\n\r\n    /*\r\n    Finds all the child elements of the given element that can be focussed and\r\n    disables the tabindex by setting a negative value.\r\n    \r\n    @param  eParent    DOM element to search.\r\n    */\r\n    disableTabIndexes(eParent) {\r\n        const aElems = df.dom.query(eParent, df.dom.cFocusSelector, true);\r\n\r\n        for (let iElem = 0; iElem < aElems.length; iElem++) {\r\n            const eElem = aElems[iElem];\r\n\r\n            if (eElem.getAttribute(\"data-dfOrigTabIndex\") === null) {\r\n                eElem.setAttribute(\"data-dfTabIndexCount\", 1);\r\n                eElem.setAttribute(\"data-dfOrigTabIndex\", eElem.tabIndex);\r\n                eElem.tabIndex = \"-1\";\r\n            } else {\r\n                eElem.setAttribute(\"data-dfTabIndexCount\", parseInt(eElem.getAttribute(\"data-dfTabIndexCount\"), 10) + 1);\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    Finds all the child elements of the given element that can contain tabs and\r\n    restores their tabindex (if it is modified by by the disableTabIndex method).\r\n    \r\n    @param   eParent    DOM element to search.\r\n    */\r\n    restoreTabIndexes(eParent) {\r\n        const aElems = df.dom.query(eParent, df.dom.cFocusSelector, true);\r\n\r\n        for (let iElem = 0; iElem < aElems.length; iElem++) {\r\n            const eElem = aElems[iElem];\r\n            if (parseInt(eElem.getAttribute(\"data-dfTabIndexCount\"), 10) !== null) {\r\n                if (eElem.getAttribute(\"data-dfTabIndexCount\") <= 1) {\r\n                    eElem.tabIndex = eElem.getAttribute(\"data-dfOrigTabIndex\");\r\n                    eElem.removeAttribute(\"data-dfOrigTabIndex\");\r\n                    eElem.removeAttribute(\"data-dfTabIndexCount\");\r\n                } else {\r\n                    eElem.setAttribute(\"data-dfTabIndexCount\", parseInt(eElem.getAttribute(\"data-dfTabIndexCount\"), 10) - 1);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    Hides plugins inside the element in Internet Explorer by removing them from the document object \r\n    model. Internet Explorer has problems doing that by itself.  It will return an array with \r\n    information which can be used to restore the elements into the DOM. \r\n    \r\n    @param  eElem    The element to search.\r\n    @return Array with details for restorePlugins.\r\n    */\r\n    hidePlugins(eElem) {\r\n        const aHidden = [];\r\n\r\n        //  Only for Internet Explorer\r\n        if (dev.isIE) {\r\n            //  Find problematic elements\r\n            const aElems = df.dom.query(eElem, \"iframe, object, embed\", true);\r\n\r\n            for (let i = 0; i < aElems.length; i++) {\r\n                eElem = aElems[i];\r\n\r\n                //  Check if not already hidden\r\n                if (eElem.getAttribute(\"data-df-hiddenplugin\") !== \"yes\") {\r\n\r\n                    //  Remember\r\n                    aHidden.push(eElem);\r\n\r\n                    //  Hide\r\n                    eElem.style.display = \"none\";\r\n\r\n                    //  Mark as already hidden\r\n                    eElem.setAttribute(\"data-df-hiddenplugin\", \"yes\");\r\n                }\r\n            }\r\n        }\r\n\r\n        return aHidden;\r\n    },\r\n\r\n    /*\r\n    Restores plugin elements that are hidden by hidePlugins. It inserts the elements back into the DOM \r\n    based on the passed details.\r\n    \r\n    @param  aHidden     Details of the hidden elements as it is returned by hidePlugins.\r\n    */\r\n    restorePlugins(aHidden) {\r\n\r\n        for (let i = 0; i < aHidden.length; i++) {\r\n            //  Display\r\n            aHidden[i].style.display = \"\";\r\n\r\n            //  Unmark\r\n            aHidden[i].removeAttribute(\"data-df-hiddenplugin\");\r\n        }\r\n    },\r\n\r\n\r\n    /*\r\n    Bubbles up in the dom measuring the total offsets until the next absolute\r\n    (or fixed) positioned element in the DOM. This is are values that can be used\r\n    as the style.left and style.top to position an absolute (or fixed) element on\r\n    the same position.\r\n    \r\n    @param  eElement The object to get offset(s) from.\r\n    @return Object { top : 500, left : 500 } with the offset values.\r\n    */\r\n    getAbsoluteOffset(eElement) {\r\n        const oReturn = { left: 0, top: 0 };\r\n        let bFirst = true;\r\n\r\n        if (eElement.offsetParent) {\r\n            while (eElement && (bFirst || gui.getCurrentStyle(eElement).position !== \"absolute\") && gui.getCurrentStyle(eElement).position !== \"fixed\" && gui.getCurrentStyle(eElement).position !== \"relative\") {\r\n                bFirst = false;\r\n                oReturn.top += eElement.offsetTop;\r\n                oReturn.left += eElement.offsetLeft;\r\n                eElement = eElement.offsetParent;\r\n            }\r\n        } else if (eElement.y) {\r\n            oReturn.left += eElement.x;\r\n            oReturn.top += eElement.y;\r\n        }\r\n\r\n        return oReturn;\r\n\r\n    },\r\n\r\n    /*\r\n    @return The full display width (of the frame / window).\r\n    */\r\n    getViewportHeight() {\r\n        if (window.innerHeight !== undefined) {\r\n            return window.innerHeight;\r\n        }\r\n\r\n        if (document.compatMode === \"CSS1Compat\") {\r\n            return document.documentElement.clientHeight;\r\n        }\r\n        if (document.body) {\r\n            return document.body.clientHeight;\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /*\r\n    @return The full display height (of the frame / window).\r\n    */\r\n    getViewportWidth() {\r\n        if (document.compatMode === 'CSS1Compat') {\r\n            return document.documentElement.clientWidth;\r\n        }\r\n        if (document.body) {\r\n            return document.body.clientWidth;\r\n        }\r\n        if (window.innerWidth !== undefined) {\r\n            return window.innerWidth;\r\n        }\r\n\r\n        return null;\r\n    },\r\n\r\n    /*\r\n    Determines the 'real size' of the element.\r\n    \r\n    @return Object with width and height property.\r\n    */\r\n    getSize(eElem) {\r\n        if (dev.isIE || dev.isWebkit) {\r\n            return { width: eElem.offsetWidth, height: eElem.offsetHeight };\r\n        }\r\n        const oStyle = gui.getCurrentStyle(eElem);\r\n        return { width: parseInt(oStyle.getPropertyValue(\"width\"), 10), height: parseInt(oStyle.getPropertyValue(\"height\"), 10) };\r\n    },\r\n\r\n\r\n    /*\r\n    Returns the current or computed style of the DOM element.\r\n    \r\n    @param  eElem    Reference to a DOM element.\r\n    @return The browsers current style element.\r\n    */\r\n    getCurrentStyle(eElem) {\r\n        return (typeof (window.getComputedStyle) === \"function\" ? window.getComputedStyle(eElem, null) : eElem.currentStyle);\r\n    },\r\n\r\n\r\n    /*\r\n    Calculates the vertical space consumed by margin, padding and border by querying the browser its \r\n    calculated css values. Several combinations of padding, margin and border values are available as \r\n    different modes.\r\n    \r\n    0 = all (padding + margin + border)\r\n    1 = outside (margin + border) \r\n    2 = inside (padding) \r\n    3 = outside border box (margin only)\r\n    \r\n    @param  iOptType    (optional) The mode to use, if not provided mode 0 is used.\r\n    @return The total number of pixels consumed by the specified parts of the box model.\r\n    */\r\n    getVertBoxDiff(eElem, iOptType) {\r\n        let iDiff = 0; \r\n        const oStyle = gui.getCurrentStyle(eElem);\r\n\r\n        iOptType = iOptType || 0;\r\n\r\n        if (iOptType === 0 || iOptType === 1 || iOptType === 3) {\r\n            iDiff += parseFloat(oStyle.marginTop) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 1) {\r\n            iDiff += parseFloat(oStyle.borderTopWidth) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 2) {\r\n            iDiff += parseFloat(oStyle.paddingTop) || 0;\r\n        }\r\n\r\n        if (iOptType === 0 || iOptType === 1 || iOptType === 3) {\r\n            iDiff += parseFloat(oStyle.marginBottom) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 1) {\r\n            iDiff += parseFloat(oStyle.borderBottomWidth) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 2) {\r\n            iDiff += parseFloat(oStyle.paddingBottom) || 0;\r\n        }\r\n\r\n        return iDiff;\r\n    },\r\n\r\n    /*\r\n    Calculates the horizontal space consumed by margin, padding and border by querying the browser its \r\n    calculated css values. Several combinations of padding, margin and border values are available as \r\n    different modes.\r\n    \r\n    0 = all (padding + margin + border)\r\n    1 = outside (margin + border) \r\n    2 = inside (padding) \r\n    3 = outside border box (margin only)\r\n    \r\n    @param  iOptType    (optional) The mode to use, if not provided mode 0 is used.\r\n    @return The total number of pixels consumed by the specified parts of the box model.\r\n    */\r\n    getHorizBoxDiff(eElem, iOptType) {\r\n        let iDiff = 0;\r\n        const oStyle = gui.getCurrentStyle(eElem);\r\n\r\n        iOptType = iOptType || 0;\r\n\r\n        if (iOptType === 0 || iOptType === 1 || iOptType === 3) {\r\n            iDiff += parseFloat(oStyle.marginLeft) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 1) {\r\n            iDiff += parseFloat(oStyle.borderLeftWidth) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 2) {\r\n            iDiff += parseFloat(oStyle.paddingLeft) || 0;\r\n        }\r\n\r\n        if (iOptType === 0 || iOptType === 1 || iOptType === 3) {\r\n            iDiff += parseFloat(oStyle.marginRight) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 1) {\r\n            iDiff += parseFloat(oStyle.borderRightWidth) || 0;\r\n        }\r\n        if (iOptType === 0 || iOptType === 2) {\r\n            iDiff += parseFloat(oStyle.paddingRight) || 0;\r\n        }\r\n\r\n        return iDiff;\r\n    },\r\n\r\n    /* \r\n    This function tests if the element is sized by its content. It determines this by adding a temporary \r\n    element and if the size changes we know the element is sized by its content.\r\n    \r\n    @param  eElem   DOM Element.\r\n    @return True if the element its size is determined by its content.\r\n    */\r\n    isSizedByContent(eElem) {\r\n        const iCH = eElem.clientHeight;\r\n\r\n        eElem.appendChild(df.dom.create('<div style=\"width: 100%; height: 20px;\">&nbsp</div>'));\r\n\r\n        const bRes = (iCH !== eElem.clientHeight);\r\n\r\n        eElem.removeChild(eElem.lastChild);\r\n\r\n        return bRes;\r\n    },\r\n\r\n    /* \r\n    Cross browser method for getting a boundingclientrect object.\r\n    \r\n    @param  eElem   The DOM element.\r\n    @return Bounding rectangle object { top:x, right:x, bottom:x, left:x, width:x, height:x }.\r\n    */\r\n    getBoundRect(eElem) {\r\n        const oR = eElem.getBoundingClientRect();\r\n\r\n        if (typeof oR.width !== 'number') {  //  Internet Explorer 8 doesn't support width & height\r\n            return {\r\n                top: oR.top,\r\n                right: oR.right,\r\n                bottom: oR.bottom,\r\n                left: oR.left,\r\n                width: oR.right - oR.left,\r\n                height: oR.bottom - oR.top\r\n            };\r\n        }\r\n\r\n        return oR;\r\n    },\r\n\r\n    /* \r\n    Copies the values of a ClientRect into a JavaScript Object. This makes the properties writable so \r\n    they can be used for translations.\r\n    \r\n    @param  oR  ClientRect object.\r\n    @return JavaScript Object.\r\n    */\r\n    rectToObj(oR) {\r\n        return {\r\n            top: oR.top,\r\n            right: oR.right,\r\n            bottom: oR.bottom,\r\n            left: oR.left,\r\n            width: oR.width,\r\n            height: oR.height\r\n        };\r\n    },\r\n\r\n    /* \r\n    Returns the properly prefixed name for setting CSS transformations. As optimization a closure is \r\n    used in which the result is cached.\r\n    \r\n    @return String with the browser dependent property name for transform.\r\n    */\r\n    getTransformProp: (function () {\r\n        let sPrefix = null;\r\n\r\n        function getTrans() {\r\n            const aPre = ['transform', 'WebkitTransform', 'MozTransform', 'OTransform', 'msTransform'];\r\n            for (let i = 0; i < aPre.length; i++) {\r\n                if (document.createElement('div').style[aPre[i]] !== undefined) {\r\n                    return aPre[i];\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        return function () {\r\n            if (sPrefix === null) {\r\n                sPrefix = getTrans();\r\n            }\r\n\r\n            return sPrefix;\r\n        };\r\n    }()),\r\n\r\n    /*\r\n    Sets the CSS class of the body element with a class name that indicates the used\r\n    browser. The used classnames are df-ie, df-safari, df-chrome, df-opera,\r\n    df-mozilla for the different browsers. For internet explorer the extra\r\n    classnames df-ie6, df-ie7, df-ie8 are also attached. Browsers using the\r\n    webkit engine (like chrome and safari) also get the df-webkit class.\r\n    \r\n    The function is called automatically after loading. It uses the is.. and\r\n    dev.iVersion indicators to determine browser versions.\r\n    */\r\n    initCSS() {\r\n        let aC, sB = document.body.className;\r\n\r\n        //  Check if classnames are already applied to the body, if so filter out the device classes and fill array with existing classnames\r\n        if (sB) {\r\n            sB = sB.replace(/\\bdf-ie*|df-safari|df-chrome|df-opera|df-mozilla|df-webkit|df-mobile\\b/g, \"\").trim();\r\n            aC = sB.split(' ');\r\n        } else {\r\n            aC = [];\r\n        }\r\n\r\n        //  Determine browser classes to add\r\n        if (dev.isIE) {\r\n            aC.push(\"df-ie\");\r\n\r\n            aC.push(dev.iVersion <= 6 ? \" df-ie6\" : \" df-ie\" + dev.iVersion); //  For IE we also add version specific classes\r\n        } else if (dev.isSafari) {\r\n            aC.push(\"df-safari\");\r\n        } else if (dev.isChrome) {\r\n            aC.push(\"df-chrome\");\r\n        } else if (dev.isOpera) {\r\n            aC.push(\"df-opera\");\r\n        } else if (dev.isMoz) {\r\n            aC.push(\"df-mozilla\");\r\n        }\r\n\r\n        //  WebKit engine gets its own class\r\n        if (dev.isWebkit) {\r\n            aC.push(\"df-webkit\");\r\n        }\r\n\r\n        //  Mobile devices get the mobile class\r\n        if (dev.isMobile) {\r\n            aC.push(\"df-mobile\");\r\n        }\r\n\r\n        //  Apply the changed classname\r\n        document.body.className = aC.join(\" \");\r\n    },\r\n\r\n    /* \r\n    Checks if the element is on the screen by looking at the scrollbar positions. It doesn't check if \r\n    the the element (or one of its parent elements) are visible or not. \r\n    \r\n    TODO: Extend with support for horizontal scrolling.\r\n    TODO: Check what happens if one of the parents was made invisible using display or visibility.\r\n    \r\n    @param  eElem    DOM Element.\r\n    */\r\n    isOnScreen(el) {\r\n        let rect = el.getBoundingClientRect(); \r\n        const top = rect.top, height = rect.height, left = rect.left, width = rect.width;\r\n\r\n        el = el.offsetParent;\r\n\r\n        while (el && el != document.body) {\r\n            rect = el.getBoundingClientRect();\r\n            if (top > rect.bottom) {\r\n                return false;\r\n            }\r\n\r\n            if (left > rect.right) {\r\n                return false;\r\n            }\r\n\r\n\r\n            // Check if the element is out of view due to a container scrolling\r\n            if ((top + height) <= rect.top) {\r\n                return false;\r\n            }\r\n\r\n            if (left + width <= rect.left) {\r\n                return false;\r\n            }\r\n\r\n            el = el.offsetParent;\r\n        }\r\n\r\n        // Check its within the document viewport\r\n        return top <= document.documentElement.clientHeight;\r\n    },\r\n\r\n    /*\r\n    Checks if the element is fully on screen, if the element falls partially offscreen at anypoint this\r\n    function will return false\r\n    */\r\n    isElementFullyOnScreen(el) {\r\n        const rect = el.getBoundingClientRect();\r\n\r\n        return (\r\n            rect.top >= 0 &&\r\n            rect.left >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\r\n        );\r\n\r\n    },\r\n\r\n\r\n    /* \r\n    Attaches event handlers to all parent elements that can scroll. Because scroll events don't bubble \r\n    this is the only way to find out if an element is moving on the screen because of a scroll event.\r\n    \r\n    @param  eElem       DOM element.\r\n    @param  fListen     Event handler function.\r\n    @param  oEnv        Environment object used for the event handler.\r\n    \r\n    @return     Array of DOM elements used by removeScrollListeners to clean out the event handler.\r\n    */\r\n    addScrollListeners(eElem, fListen, oEnv) {\r\n        const aElems = [];\r\n\r\n        while (eElem) {\r\n            //if(eElem.scrollHeight > eElem.offsetHeight || eElem.scrollWidth > eElem.offsetWidth){\r\n            aElems.push(eElem);\r\n            df.dom.on(\"scroll\", eElem, fListen, oEnv);\r\n            //}\r\n            eElem = eElem.offsetParent;\r\n        }\r\n\r\n        return aElems;\r\n    },\r\n\r\n    /* \r\n    Removes the event handlers attached by addScrollListeners based on the passed array.\r\n    \r\n    @return     Array of DOM elements created by addScrollListeners.\r\n    */\r\n    removeScrollListeners(aElems, fListen, oEnv) {\r\n        let eElem;\r\n\r\n        while (eElem = aElems.shift()) {\r\n            df.dom.off(\"scroll\", eElem, fListen, oEnv);\r\n        }\r\n    },\r\n\r\n\r\n    cssTextAlign(eAlign) {\r\n        switch (eAlign) {\r\n            case df.ciAlignLeft:\r\n                return \"left\";\r\n            case df.ciAlignCenter:\r\n                return \"center\";\r\n            case df.ciAlignRight:\r\n                return \"right\";\r\n        }\r\n\r\n        return \"\";\r\n    }\r\n\r\n}\r\n\r\n","/*\r\nName:\r\n    df.events\r\nType:\r\n    Library (object)\r\nContains:\r\n    df.events.DOMHandler   (Class)\r\n    df.events.DOMEvent     (Class)    \r\n    df.events.JSHandler    (Class)\r\n    df.events.JSEvent      (Class)\r\n\r\nThe events library supplies a special event system for handling and throwing events within the \r\nframework. It supports the handling of DOM events and custom JavaScript events which can be handled \r\nin a consistent way across the different browsers.\r\n    \r\nRevisions:\r\n    2007/12/14  Created the new event system framework based on experiences \r\n    with the event handling methods in previous releases. (HW, DAE)\r\n*/\r\n\r\n\r\n/*\r\nThe AJAX Library has its own event system that works on top of the browsers \r\nevents system and allows custom events to be created and thrown. This layer \r\nstraightens out the differences between browsers and works easier. Events \r\nthrown by the AJAX Library itself work almost the same as browser events so the \r\ndeveloper doesn't have to deal with the differences.\r\n\r\nBrowser/DOM events are attached using a set of global functions. The DOMEvent \r\nprototype defines the interface of the objects that are given as parameters to \r\nthe listener methods. A set of global methods can be used to attach and remove \r\nlisteners for the DOM events. For events thrown by the framework we have the \r\nJSHandler prototype that is actually used to instantiate the events. Listeners \r\nare attached using the addListener method of the JSHandler and will get an \r\ninstantiation of the JSEvent as the parameter. Event specific properties are \r\nadded to this event.\r\n\r\nExample of a DOM event:\r\n@code\r\nfunction initialize(){\r\n     df.events.addDomListener(\"click\", document.getElementById(\"myButton\"), myButton_click, this);\r\n}\r\n\r\nfunction myButton_click(oEvent){\r\n     if(confirm(\"Sure you clicked the button?\")){\r\n        oEvent.eSource.value = \"Clicked!\"; // Use oEvent.oSource property to get a reference to the button\r\n    }else{\r\n        oEvent.stop(); // Make sure no other listeners are called\r\n    }\r\n}\r\n@code\r\n\r\nExample of a framework event:\r\n@code\r\nfunction initMyForm(oForm){\r\n      oForm.getDD(\"customer\").onBeforeDelete.addListener(confirmdelete, this);\r\n}\r\n\r\nfunction confirmdelete(oEvent){\r\n     return confirm(\"Are you sure that you want to delete this record?\"); // Returning false also stops the event\r\n}\r\n@code\r\n*/\r\n/* global df */\r\nexport const events = {\r\n\r\n    keys: {\r\n        modifier: [\r\n            \"Alt\", //The Alt (Alternative) key. This key enables the alternate modifier function for interpreting concurrent or subsequent keyboard input. .This key value is also used for the Apple Option key.\r\n            \"AltGraph\", //The Alternate Graphics (AltGr or AltGraph) key.\tThis key is used enable the ISO Level 3 shift modifier (the standard Shift key is the level 2 modifier). See  [ISO9995-1].\r\n            \"CapsLock\", //The Caps Lock (Capital) key.\tToggle capital character lock function for interpreting subsequent keyboard input event.\r\n            \"Control\", //The Control or Ctrl key, to enable control modifier function for interpreting concurrent or subsequent keyboard input.\r\n            \"Fn\", //The Function switch Fn key. Activating this key simultaneously with another key changes that keys value to an alternate character or function. This key is often handled directly in the keyboard hardware and does not usually generate key events.\r\n            \"FnLock\", //The Function-Lock (FnLock or F-Lock) key.\tActivating this key switches the mode of the keyboard to changes some keys' values to an alternate character or function. This key is often handled directly in the keyboard hardware and does not usually generate key events.\r\n            \"Meta\", //The Meta key, to enable meta modifier function for interpreting concurrent or subsequent keyboard input.\tThis key value is used for the Windows Logo key and the Apple Command or  key.\r\n            \"NumLock\", //The NumLock or Number Lock key, to toggle numpad mode function for interpreting subsequent keyboard input.\r\n            \"ScrollLock\", //The Scroll Lock key, to toggle between scrolling and cursor movement modes.\r\n            \"Shift\", //The Shift key, to enable shift modifier function for interpreting concurrent or subsequent keyboard input.\r\n            \"Symbol\",     //The Symbol modifier key (used on some virtual keyboards).\r\n            \"SymbolLock\" //The Symbol Lock key.\r\n        ],\r\n        legacyModifier: [\r\n            \"Hyper\", //The Hyper key.\r\n            \"Super\" //The Super key.\r\n        ],\r\n        whiteSpace: [\r\n            \"Enter\", //The Enter or  key, to activate current selection or accept current input. This key value is also used for the Return (Macintosh numpad) key. This key value is also used for the Android KEYCODE_DPAD_CENTER.\r\n            \"Tab\" //The Horizontal Tabulation Tab key. The space or spacebar key is encoded as \" \".\r\n        ],\r\n        navigation: [\r\n            \"ArrowDown\", //The down arrow key, to navigate or traverse downward. (KEYCODE_DPAD_DOWN)\r\n            \"Down\", // IE/Edge \r\n            \"ArrowLeft\", //The left arrow key, to navigate or traverse leftward. (KEYCODE_DPAD_LEFT)\r\n            \"Left\", // IE/Edge \r\n            \"ArrowRight\", //The right arrow key, to navigate or traverse rightward. (KEYCODE_DPAD_RIGHT)\r\n            \"Right\", // IE/Edge \r\n            \"ArrowUp\", //The up arrow key, to navigate or traverse upward. (KEYCODE_DPAD_UP)\r\n            \"Up\", // IE/Edge \r\n            \"End\", //The End key, used with keyboard entry to go to the end of content (KEYCODE_MOVE_END).\r\n            \"Home\", //The Home key, used with keyboard entry, to go to start of content (KEYCODE_MOVE_HOME). For the mobile phone Home key (which goes to the phones main screen), use \"GoHome\".\r\n            \"PageDown\", //The Page Down key, to scroll down or display next page of content.\r\n            \"PageUp\" //The Page Up key, to scroll up or display previous page of content.\r\n        ],\r\n        editing: [\r\n            \"Backspace\", //The Backspace key. This key value is also used for the key labeled Delete on MacOS keyboards.\r\n            \"Clear\", //Remove the currently selected input.\r\n            \"Copy\", //Copy the current selection. (APPCOMMAND_COPY)\r\n            \"CrSel\", //The Cursor Select (Crsel) key.\r\n            \"Cut\", //Cut the current selection. (APPCOMMAND_CUT)\r\n            \"Delete\", //The Delete (Del) Key.\tThis key value is also used for the key labeled Delete on MacOS keyboards when modified by the Fn key.\r\n            \"Del\", // IE/Edge \r\n            \"EraseEof\", //The Erase to End of Field key. This key deletes all characters from the current cursor position to the end of the current field.\r\n            \"ExSel\", //The Extend Selection (Exsel) key.\r\n            \"Insert\", //The Insert (Ins) key, to toggle between text modes for insertion or overtyping. (KEYCODE_INSERT)\r\n            \"Paste\", //The Paste key. (APPCOMMAND_PASTE)\r\n            \"Redo\", //Redo the last action. (APPCOMMAND_REDO)\r\n            \"Undo\" //Undo the last action. (APPCOMMAND_UNDO)\r\n        ],\r\n        ui: [\r\n            \"Accept\", //The Accept (Commit, OK) key. Accept current option or input method sequence conversion.\r\n            \"Again\", //The Again key, to redo or repeat an action.\r\n            \"Attn\", //The Attention (Attn) key.\r\n            \"Cancel\", //The Cancel key.\r\n            \"ContextMenu\", //Show the applications context menu.\tThis key is commonly found between the right Meta key and the right Control key.\r\n            \"Escape\", //The Esc key. This key was originally used to initiate an escape sequence, but is now more generally used to exit or \"escape\" the current context, such as closing a dialog or exiting full screen mode.\r\n            \"Esc\", // IE/Edge \r\n            \"Execute\", //The Execute key.\r\n            \"Find\", //Open the Find dialog. (APPCOMMAND_FIND)\r\n            \"Help\", //Open a help dialog or toggle display of help information. (APPCOMMAND_HELP, KEYCODE_HELP)\r\n            \"Pause\", //Pause the current state or application (as appropriate). Do not use this value for the Pause button on media controllers. Use \"MediaPause\" instead.\r\n            \"Play\", //Play or resume the current state or application (as appropriate). Do not use this value for the Play button on media controllers. Use \"MediaPlay\" instead.\r\n            \"Props\", //The properties (Props) key.\r\n            \"Select\", //The Select key.\r\n            \"ZoomIn\", //The ZoomIn key. (KEYCODE_ZOOM_IN)\r\n            \"ZoomOut\" //The ZoomOut key. (KEYCODE_ZOOM_OUT)\r\n        ],\r\n        device: [\r\n            \"BrightnessDown\", //The Brightness Down key. Typically controls the display brightness. (KEYCODE_BRIGHTNESS_DOWN)\r\n            \"BrightnessUp\", //The Brightness Up key. Typically controls the display brightness. (KEYCODE_BRIGHTNESS_UP)\r\n            \"Eject\", //Toggle removable media to eject (open) and insert (close) state. (KEYCODE_MEDIA_EJECT)\r\n            \"LogOff\", //The LogOff key.\r\n            \"Power\", //Toggle power state. (KEYCODE_POWER) Note: Some devices might not expose this key to the operating environment.\r\n            \"PowerOff\", //The PowerOff key. Sometime called PowerDown.\r\n            \"PrintScreen\", //The Print Screen or SnapShot key, to initiate print-screen function.\r\n            \"Hibernate\", //The Hibernate key.\tThis key saves the current state of the computer to disk so that it can be restored. The computer will then shutdown.\r\n            \"Standby\", //The Standby key.\tThis key turns off the display and places the computer into a low-power mode without completely shutting down. It is sometimes labelled Suspend or Sleep key. (KEYCODE_SLEEP)\r\n            \"WakeUp\" //The WakeUp key. (KEYCODE_WAKEUP)\r\n        ],\r\n        imeCompositionKeys: [\r\n            \"AllCandidates\", //The All Candidates key, to initate the multi-candidate mode.\r\n            \"Alphanumeric\", //The Alphanumeric key.\r\n            \"CodeInput\", //The Code Input key, to initiate the Code Input mode to allow characters to be entered by their code points.\r\n            \"Compose\", //The Compose key, also known as Multi_key on the X Window System. This key acts in a manner similar to a\tdead key, triggering a mode where subsequent key presses are combined to produce a different character.\r\n            \"Convert\", //The Convert key, to convert the current input method sequence.\r\n            \"Dead\", //A dead key combining key. It may be any combining key from any keyboard layout. For example, on a\tPC/AT French keyboard, using a French mapping and without any modifier activiated, this is the key value U+0302 COMBINING CIRCUMFLEX ACCENT. In another layout this might be a different unicode combining key. For applications that need to differentiate between specific combining characters, the associated compositionupdate events data attribute provides the specific key value.\r\n            \"FinalMode\", //The Final Mode Final key used on some Asian keyboards, to enable the final mode for IMEs.\r\n            \"GroupFirst\", //Switch to the first character group. (ISO/IEC 9995)\r\n            \"GroupLast\", //Switch to the last character group. (ISO/IEC 9995)\r\n            \"GroupNext\", //Switch to the next character group. (ISO/IEC 9995)\r\n            \"GroupPrevious\", //Switch to the previous character group. (ISO/IEC 9995)\r\n            \"ModeChange\", //The Mode Change key, to toggle between or cycle through input modes of IMEs.\r\n            \"NextCandidate\", //The Next Candidate function key.\r\n            \"NonConvert\", //The NonConvert (\"Dont Convert\") key, to accept current input method sequence without conversion in IMEs.\r\n            \"PreviousCandidate\", //The Previous Candidate function key.\r\n            \"Process\", //The Process key.\r\n            \"SingleCandidate\" //The Single Candidate function key.\r\n        ],\r\n        koreanSpecific: [\r\n            \"HangulMode\", //The Hangul (Korean characters) Mode key, to toggle between Hangul and English modes.\r\n            \"HanjaMode\", //The Hanja (Korean characters) Mode key.\r\n            \"JunjaMode\" //The Junja (Korean characters) Mode key.\r\n        ],\r\n        japaneseSpecific: [\r\n            \"Eisu\", //The Eisu key. This key may close the IME, but its purpose\tis defined by the current IME. (KEYCODE_EISU)\r\n            \"Hankaku\", //The (Half-Width) Characters key.\r\n            \"Hiragana\", //The Hiragana (Japanese Kana characters) key.\r\n            \"HiraganaKatakana\", //The Hiragana/Katakana toggle key. (KEYCODE_KATAKANA_HIRAGANA)\r\n            \"KanaMode\", //The Kana Mode (Kana Lock) key. This key is used to enter\thiragana mode (typically from romaji mode).\r\n            \"KanjiMode\", //The Kanji (Japanese name for ideographic characters of Chinese origin) Mode key.\tThis key is typically used to switch to a hiragana keyboard for the purpose of converting input into kanji. (KEYCODE_KANA)\r\n            \"Katakana\", //The Katakana (Japanese Kana characters) key.\r\n            \"Romaji\", //The Roman characters function key.\r\n            \"Zenkaku\", //The Zenkaku (Full-Width) Characters key.\r\n            \"ZenkakuHankaku\" //The Zenkaku/Hankaku (full-width/half-width) toggle key. (KEYCODE_ZENKAKU_HANKAKU)\r\n        ],\r\n        // The exact number of these general purpose function keys varies on different platforms, and only the first few are defined explicitly here. Additional function key names are implicitly defined by incrementing the base-10 index at the end of the function key name. Thus, \"F24\" and \"Soft8\" are all valid key values.\r\n        commonFunction: [\r\n            \"F1\", //The F1 key, a general purpose function key, as index 1.\r\n            \"F2\", //The F2 key, a general purpose function key, as index 2.\r\n            \"F3\", //The F3 key, a general purpose function key, as index 3.\r\n            \"F4\", //The F4 key, a general purpose function key, as index 4.\r\n            \"F5\", //The F5 key, a general purpose function key, as index 5.\r\n            \"F6\", //The F6 key, a general purpose function key, as index 6.\r\n            \"F7\", //The F7 key, a general purpose function key, as index 7.\r\n            \"F8\", //The F8 key, a general purpose function key, as index 8.\r\n            \"F9\", //The F9 key, a general purpose function key, as index 9.\r\n            \"F10\", //The F10 key, a general purpose function key, as index 10.\r\n            \"F11\", //The F11 key, a general purpose function key, as index 11.\r\n            \"F12\", //The F12 key, a general purpose function key, as index 12.\r\n            \"Soft1\", //General purpose virtual function key, as index 1.\r\n            \"Soft2\", //General purpose virtual function key, as index 2.\r\n            \"Soft3\", //General purpose virtual function key, as index 3.\r\n            \"Soft4\" //General purpose virtual function key, as index 4.\r\n        ],\r\n        // These are extra keys found on \"multimedia\" keyboards.\r\n        multimedia: [\r\n            \"ChannelDown\", //Select next (numerically or logically) lower channel. (APPCOMMAND_MEDIA_CHANNEL_DOWN, KEYCODE_CHANNEL_DOWN)\r\n            \"ChannelUp\", //Select next (numerically or logically) higher channel. (APPCOMMAND_MEDIA_CHANNEL_UP, KEYCODE_CHANNEL_UP)\r\n            \"Close\", //Close the current document or message (Note: This doesnt close the application). (APPCOMMAND_CLOSE)\r\n            \"MailForward\", //Open an editor to forward the current message. (APPCOMMAND_FORWARD_MAIL)\r\n            \"MailReply\", //Open an editor to reply to the current message. (APPCOMMAND_REPLY_TO_MAIL)\r\n            \"MailSend\", //Send the current message. (APPCOMMAND_SEND_MAIL)\r\n            \"MediaClose\", //Close the current media, for example to close a CD or DVD tray. (KEYCODE_MEDIA_CLOSE)\r\n            \"MediaFastForward\", //Initiate or continue forward playback at faster than normal speed, or increase speed if already fast forwarding. (APPCOMMAND_MEDIA_FAST_FORWARD, KEYCODE_MEDIA_FAST_FORWARD)\r\n            \"MediaPause\", //Pause the currently playing media. (APPCOMMAND_MEDIA_PAUSE, KEYCODE_MEDIA_PAUSE) Media controller devices should use this value rather than \"Pause\" for their pause keys.\r\n            \"MediaPlay\", //Initiate or continue media playback at normal speed, if not currently playing at normal speed. (APPCOMMAND_MEDIA_PLAY, KEYCODE_MEDIA_PLAY)\r\n            \"MediaPlayPause\", //Toggle media between play and pause states. (APPCOMMAND_MEDIA_PLAY_PAUSE, KEYCODE_MEDIA_PLAY_PAUSE)\r\n            \"MediaRecord\", //Initiate or resume recording of currently selected media. (APPCOMMAND_MEDIA_RECORD, KEYCODE_MEDIA_RECORD)\r\n            \"MediaRewind\", //Initiate or continue reverse playback at faster than normal speed, or increase speed if already rewinding. (APPCOMMAND_MEDIA_REWIND, KEYCODE_MEDIA_REWIND)\r\n            \"MediaStop\", //Stop media playing, pausing, forwarding, rewinding, or recording, if not already stopped. (APPCOMMAND_MEDIA_STOP, KEYCODE_MEDIA_STOP)\r\n            \"MediaTrackNext\", //Seek to next media or program track. (APPCOMMAND_MEDIA_NEXTTRACK, KEYCODE_MEDIA_NEXT)\r\n            \"MediaTrackPrevious\", //Seek to previous media or program track. (APPCOMMAND_MEDIA_PREVIOUSTRACK, KEYCODE_MEDIA_PREVIOUS)\r\n            \"New\", //Open a new document or message. (APPCOMMAND_NEW)\r\n            \"Open\", //Open an existing document or message. (APPCOMMAND_OPEN)\r\n            \"Print\", //Print the current document or message. (APPCOMMAND_PRINT)\r\n            \"Save\", //Save the current document or message. (APPCOMMAND_SAVE)\r\n            \"SpellCheck\" //Spellcheck the current document or selection. (APPCOMMAND_SPELL_CHECK)\r\n        ],\r\n        // The normal 0 ... 9 numpad keys are encoded as \"0\" ... \"9\", but some multimedia keypads have buttons numbered from 1 ... 12. In these instances, the 10 key is often labeled 10 /0. Note: The 10 or 10 /0 key MUST be assigned a key value of \"0\".\r\n        multimediaNumpad: [\r\n            \"Key11\", //The 11 key found on media numpads that\thave buttons from 1 ... 12.\r\n            \"Key12\" //The 12 key found on media numpads that\thave buttons from 1 ... 12.\r\n        ],\r\n        // Multimedia keys related to audio.\r\n        audio: [\r\n            \"AudioBalanceLeft\", //Adjust audio balance leftward. (VK_AUDIO_BALANCE_LEFT)\r\n            \"AudioBalanceRight\", //Adjust audio balance rightward. (VK_AUDIO_BALANCE_RIGHT)\r\n            \"AudioBassBoostDown\", //Decrease audio bass boost or cycle down through bass boost states. (APPCOMMAND_BASS_DOWN, VK_BASS_BOOST_DOWN)\r\n            \"AudioBassBoostToggle\", //Toggle bass boost on/off. (APPCOMMAND_BASS_BOOST)\r\n            \"AudioBassBoostUp\", //Increase audio bass boost or cycle up through bass boost states. (APPCOMMAND_BASS_UP, VK_BASS_BOOST_UP)\r\n            \"AudioFaderFront\", //Adjust audio fader towards front. (VK_FADER_FRONT)\r\n            \"AudioFaderRear\", //Adjust audio fader towards rear. (VK_FADER_REAR)\r\n            \"AudioSurroundModeNext\", //Advance surround audio mode to next available mode. (VK_SURROUND_MODE_NEXT)\r\n            \"AudioTrebleDown\", //Decrease treble. (APPCOMMAND_TREBLE_DOWN)\r\n            \"AudioTrebleUp\", //Increase treble. (APPCOMMAND_TREBLE_UP)\r\n            \"AudioVolumeDown\", //Decrease audio volume. (APPCOMMAND_VOLUME_DOWN, KEYCODE_VOLUME_DOWN)\r\n            \"AudioVolumeUp\", //Increase audio volume. (APPCOMMAND_VOLUME_UP, KEYCODE_VOLUME_UP)\r\n            \"AudioVolumeMute\", //Toggle between muted state and prior volume level. (APPCOMMAND_VOLUME_MUTE, KEYCODE_VOLUME_MUTE)\r\n            \"MicrophoneToggle\", //Toggle the microphone on/off. (APPCOMMAND_MIC_ON_OFF_TOGGLE)\r\n            \"MicrophoneVolumeDown\", //Decrease microphone volume. (APPCOMMAND_MICROPHONE_VOLUME_DOWN)\r\n            \"MicrophoneVolumeUp\", //Increase microphone volume. (APPCOMMAND_MICROPHONE_VOLUME_UP)\r\n            \"MicrophoneVolumeMute\" //Mute the microphone. (APPCOMMAND_MICROPHONE_VOLUME_MUTE, KEYCODE_MUTE)\r\n        ],\r\n        // Multimedia keys related to speech recognition.\r\n        speech: [\r\n            \"SpeechCorrectionList\", //Show correction list when a word is incorrectly identified. (APPCOMMAND_CORRECTION_LIST)\r\n            \"SpeechInputToggle\" //Toggle between dictation mode and command/control mode. (APPCOMMAND_DICTATE_OR_COMMAND_CONTROL_TOGGLE)\r\n        ],\r\n        // The Application Keys are special keys that are assigned to launch a particular application. Additional application key names can be defined by concatenating \"Launch\" with the name of the application.\r\n        application: [\r\n            \"LaunchApplication1\", //The first generic \"LaunchApplication\" key. This is commonly associated with launching \"My Computer\", and may have a computer symbol on the key. (APPCOMMAND_LAUNCH_APP1)\r\n            \"LaunchApplication2\", //The second generic \"LaunchApplication\" key. This is commonly associated with launching \"Calculator\", and may have a calculator symbol on the key. (APPCOMMAND_LAUNCH_APP2, KEYCODE_CALCULATOR)\r\n            \"LaunchCalendar\", //The \"Calendar\" key. (KEYCODE_CALENDAR)\r\n            \"LaunchContacts\", //The \"Contacts\" key. (KEYCODE_CONTACTS)\r\n            \"LaunchMail\", //The \"Mail\" key. (APPCOMMAND_LAUNCH_MAIL)\r\n            \"LaunchMediaPlayer\", //The \"Media Player\" key. (APPCOMMAND_LAUNCH_MEDIA_SELECT)\r\n            \"LaunchMusicPlayer\", //The \"Music Player\" key.\r\n            \"LaunchPhone\", //The \"Phone\" key.\r\n            \"LaunchScreenSaver\", //The \"Screen Saver\" key.\r\n            \"LaunchSpreadsheet\", //The \"Spreadsheet\" key.\r\n            \"LaunchWebBrowser\", //The \"Web Browser\" key.\r\n            \"LaunchWebCam\", //The \"WebCam\" key.\r\n            \"LaunchWordProcessor\" //The \"Word Processor\" key.\r\n        ],\r\n        browser: [\r\n            \"BrowserBack\", //Navigate to previous content or page in current history. (APPCOMMAND_BROWSER_BACKWARD)\r\n            \"BrowserFavorites\", //Open the list of browser favorites. (APPCOMMAND_BROWSER_FAVORITES)\r\n            \"BrowserForward\", //Navigate to next content or page in current history. (APPCOMMAND_BROWSER_FORWARD)\r\n            \"BrowserHome\", //Go to the users preferred home page. (APPCOMMAND_BROWSER_HOME)\r\n            \"BrowserRefresh\", //Refresh the current page or content. (APPCOMMAND_BROWSER_REFRESH)\r\n            \"BrowserSearch\", //Call up the users preferred search page. (APPCOMMAND_BROWSER_SEARCH)\r\n            \"BrowserStop\" //Stop loading the current page or content. (APPCOMMAND_BROWSER_STOP)\r\n        ],\r\n        mobilePhone: [\r\n            \"AppSwitch\", //The Application switch key, which provides a list of recent apps to switch between. (KEYCODE_APP_SWITCH)\r\n            \"Call\", //The Call key. (KEYCODE_CALL)\r\n            \"Camera\", //The Camera key. (KEYCODE_CAMERA)\r\n            \"CameraFocus\", //The Camera focus key. (KEYCODE_FOCUS)\r\n            \"EndCall\", //The End Call key. (KEYCODE_ENDCALL)\r\n            \"GoBack\", //The Back key. (KEYCODE_BACK)\r\n            \"GoHome\", //The Home key, which goes to the phones main screen. (KEYCODE_HOME)\r\n            \"HeadsetHook\", //The Headset Hook key. (KEYCODE_HEADSETHOOK)\r\n            \"LastNumberRedial\", //The Last Number Redial key.\r\n            \"Notification\", //The Notification key. (KEYCODE_NOTIFICATION)\r\n            \"MannerMode\", //Toggle between manner mode state: silent, vibrate, ring, ... (KEYCODE_MANNER_MODE)\r\n            \"VoiceDial\" //The Voice Dial key.\r\n        ],\r\n        tv: [\r\n            \"TV\", //Switch to viewing TV. (KEYCODE_TV)\r\n            \"TV3DMode\", //TV 3D Mode. (KEYCODE_3D_MODE)\r\n            \"TVAntennaCable\", //Toggle between antenna and cable input. (KEYCODE_TV_ANTENNA_CABLE)\r\n            \"TVAudioDescription\", //Audio description. (KEYCODE_TV_AUDIO_DESCRIPTION)\r\n            \"TVAudioDescriptionMixDown\", //Audio description mixing volume down. (KEYCODE_TV_AUDIO_DESCRIPTION_MIX_DOWN)\r\n            \"TVAudioDescriptionMixUp\", //Audio description mixing volume up. (KEYCODE_TV_AUDIO_DESCRIPTION_MIX_UP)\r\n            \"TVContentsMenu\", //Contents menu. (KEYCODE_TV_CONTENTS_MENU)\r\n            \"TVDataService\", //Contents menu. (KEYCODE_TV_DATA_SERVICE)\r\n            \"TVInput\", //Switch the input mode on an external TV. (KEYCODE_TV_INPUT)\r\n            \"TVInputComponent1\", //Switch to component input #1. (KEYCODE_TV_INPUT_COMPONENT_1)\r\n            \"TVInputComponent2\", //Switch to component input #2. (KEYCODE_TV_INPUT_COMPONENT_2)\r\n            \"TVInputComposite1\", //Switch to composite input #1. (KEYCODE_TV_INPUT_COMPOSITE_1)\r\n            \"TVInputComposite2\", //Switch to composite input #2. (KEYCODE_TV_INPUT_COMPOSITE_2)\r\n            \"TVInputHDMI1\", //Switch to HDMI input #1. (KEYCODE_TV_INPUT_HDMI_1)\r\n            \"TVInputHDMI2\", //Switch to HDMI input #2. (KEYCODE_TV_INPUT_HDMI_2)\r\n            \"TVInputHDMI3\", //Switch to HDMI input #3. (KEYCODE_TV_INPUT_HDMI_3)\r\n            \"TVInputHDMI4\", //Switch to HDMI input #4. (KEYCODE_TV_INPUT_HDMI_4)\r\n            \"TVInputVGA1\", //Switch to VGA input #1. (KEYCODE_TV_INPUT_VGA_1)\r\n            \"TVMediaContext\", //Media context menu. (KEYCODE_TV_MEDIA_CONTEXT_MENU)\r\n            \"TVNetwork\", //Toggle network. (KEYCODE_TV_NETWORK)\r\n            \"TVNumberEntry\", //Number entry. (KEYCODE_TV_NUMBER_ENTRY)\r\n            \"TVPower\", //Toggle the power on an external TV. (KEYCODE_TV_POWER)\r\n            \"TVRadioService\", //Radio. (KEYCODE_TV_RADIO_SERVICE)\r\n            \"TVSatellite\", //Satellite. (KEYCODE_TV_SATELLITE)\r\n            \"TVSatelliteBS\", //Broadcast Satellite. (KEYCODE_TV_SATELLITE_BS)\r\n            \"TVSatelliteCS\", //Communication Satellite. (KEYCODE_TV_SATELLITE_CS)\r\n            \"TVSatelliteToggle\", //Toggle between available satellites. (KEYCODE_TV_SATELLITE_SERVICE)\r\n            \"TVTerrestrialAnalog\", //Analog Terrestrial. (KEYCODE_TV_TERRESTRIAL_ANALOG)\r\n            \"TVTerrestrialDigital\", //Digital Terrestrial. (KEYCODE_TV_TERRESTRIAL_DIGITAL)\r\n            \"TVTimer\" //Timer programming. (KEYCODE_TV_TIMER_PROGRAMMING)\r\n        ],\r\n        // The key attribute values for media controllers (e.g. remote controls for television, audio systems, and set-top boxes) are derived in part from the consumer electronics technical specifications:\r\n        mediaControls: [\r\n            \"AVRInput\", //Switch the input mode on an external AVR (audio/video receiver). (KEYCODE_AVR_INPUT)\r\n            \"AVRPower\", //Toggle the power on an external AVR (audio/video receiver). (KEYCODE_AVR_POWER)\r\n            \"ColorF0Red\", //General purpose color-coded media function key, as index 0 (red). (VK_COLORED_KEY_0, KEYCODE_PROG_RED)\r\n            \"ColorF1Green\", //General purpose color-coded media function key, as index 1 (green). (VK_COLORED_KEY_1, KEYCODE_PROG_GREEN)\r\n            \"ColorF2Yellow\", //General purpose color-coded media function key, as index 2 (yellow). (VK_COLORED_KEY_2, KEYCODE_PROG_YELLOW)\r\n            \"ColorF3Blue\", //General purpose color-coded media function key, as index 3 (blue). (VK_COLORED_KEY_3, KEYCODE_PROG_BLUE)\r\n            \"ColorF4Grey\", //General purpose color-coded media function key, as index 4 (grey). (VK_COLORED_KEY_4)\r\n            \"ColorF5Brown\", //General purpose color-coded media function key, as index 5 (brown). (VK_COLORED_KEY_5)\r\n            \"ClosedCaptionToggle\", //Toggle the display of Closed Captions. (VK_CC, KEYCODE_CAPTIONS)\r\n            \"Dimmer\", //Adjust brightness of device, by toggling between or cycling through states. (VK_DIMMER)\r\n            \"DisplaySwap\", //Swap video sources. (VK_DISPLAY_SWAP)\r\n            \"DVR\", //Select Digital Video Rrecorder. (KEYCODE_DVR)\r\n            \"Exit\", //Exit the current application. (VK_EXIT)\r\n            \"FavoriteClear0\", //Clear program or content stored as favorite 0. (VK_CLEAR_FAVORITE_0)\r\n            \"FavoriteClear1\", //Clear program or content stored as favorite 1. (VK_CLEAR_FAVORITE_1)\r\n            \"FavoriteClear2\", //Clear program or content stored as favorite 2. (VK_CLEAR_FAVORITE_2)\r\n            \"FavoriteClear3\", //Clear program or content stored as favorite 3. (VK_CLEAR_FAVORITE_3)\r\n            \"FavoriteRecall0\", //Select (recall) program or content stored as favorite 0. (VK_RECALL_FAVORITE_0)\r\n            \"FavoriteRecall1\", //Select (recall) program or content stored as favorite 1. (VK_RECALL_FAVORITE_1)\r\n            \"FavoriteRecall2\", //Select (recall) program or content stored as favorite 2. (VK_RECALL_FAVORITE_2)\r\n            \"FavoriteRecall3\", //Select (recall) program or content stored as favorite 3. (VK_RECALL_FAVORITE_3)\r\n            \"FavoriteStore0\", //Store current program or content as favorite 0. (VK_STORE_FAVORITE_0)\r\n            \"FavoriteStore1\", //Store current program or content as favorite 1. (VK_STORE_FAVORITE_1)\r\n            \"FavoriteStore2\", //Store current program or content as favorite 2. (VK_STORE_FAVORITE_2)\r\n            \"FavoriteStore3\", //Store current program or content as favorite 3. (VK_STORE_FAVORITE_3)\r\n            \"Guide\", //Toggle display of program or content guide. (VK_GUIDE, KEYCODE_GUIDE)\r\n            \"GuideNextDay\", //If guide is active and displayed, then display next days content. (VK_NEXT_DAY)\r\n            \"GuidePreviousDay\", //If guide is active and displayed, then display previous days content. (VK_PREV_DAY)\r\n            \"Info\", //Toggle display of information about currently selected context or media. (VK_INFO, KEYCODE_INFO)\r\n            \"InstantReplay\", //Toggle instant replay. (VK_INSTANT_REPLAY)\r\n            \"Link\", //Launch linked content, if available and appropriate. (VK_LINK)\r\n            \"ListProgram\", //List the current program. (VK_LIST)\r\n            \"LiveContent\", //Toggle display listing of currently available live content or programs. (VK_LIVE)\r\n            \"Lock\", //Lock or unlock current content or program. (VK_LOCK)\r\n            \"MediaApps\", //Show a list of media applications: audio/video players and image viewers. (VK_APPS) Do not confuse this key value with the Windows' VK_APPS / VK_CONTEXT_MENU key, which is encoded as \"ContextMenu\".\r\n            \"MediaAudioTrack\", //Audio track key. (KEYCODE_MEDIA_AUDIO_TRACK)\r\n            \"MediaLast\", //Select previously selected channel or media. (VK_LAST, KEYCODE_LAST_CHANNEL)\r\n            \"MediaSkipBackward\", //Skip backward to next content or program. (KEYCODE_MEDIA_SKIP_BACKWARD)\r\n            \"MediaSkipForward\", //Skip forward to next content or program. (VK_SKIP, KEYCODE_MEDIA_SKIP_FORWARD)\r\n            \"MediaStepBackward\", //Step backward to next content or program. (KEYCODE_MEDIA_STEP_BACKWARD)\r\n            \"MediaStepForward\", //Step forward to next content or program. (KEYCODE_MEDIA_STEP_FORWARD)\r\n            \"MediaTopMenu\", //Media top menu. (KEYCODE_MEDIA_TOP_MENU)\r\n            \"NavigateIn\", //Navigate in. (KEYCODE_NAVIGATE_IN)\r\n            \"NavigateNext\", //Navigate to next key. (KEYCODE_NAVIGATE_NEXT)\r\n            \"NavigateOut\", //Navigate out. (KEYCODE_NAVIGATE_OUT)\r\n            \"NavigatePrevious\", //Navigate to previous key. (KEYCODE_NAVIGATE_PREVIOUS)\r\n            \"NextFavoriteChannel\", //Cycle to next favorite channel (in favorites list). (VK_NEXT_FAVORITE_CHANNEL)\r\n            \"NextUserProfile\", //Cycle to next user profile (if there are multiple user profiles). (VK_USER)\r\n            \"OnDemand\", //Access on-demand content or programs. (VK_ON_DEMAND)\r\n            \"Pairing\", //Pairing key to pair devices. (KEYCODE_PAIRING)\r\n            \"PinPDown\", //Move picture-in-picture window down. (VK_PINP_DOWN)\r\n            \"PinPMove\", //Move picture-in-picture window. (VK_PINP_MOVE)\r\n            \"PinPToggle\", //Toggle display of picture-in-picture window. (VK_PINP_TOGGLE)\r\n            \"PinPUp\", //Move picture-in-picture window up. (VK_PINP_UP)\r\n            \"PlaySpeedDown\", //Decrease media playback speed. (VK_PLAY_SPEED_DOWN)\r\n            \"PlaySpeedReset\", //Reset playback to normal speed. (VK_PLAY_SPEED_RESET)\r\n            \"PlaySpeedUp\", //Increase media playback speed. (VK_PLAY_SPEED_UP)\r\n            \"RandomToggle\", //Toggle random media or content shuffle mode. (VK_RANDOM_TOGGLE)\r\n            \"RcLowBattery\", //Not a physical key, but this key code is sent when the remote control battery is low. (VK_RC_LOW_BATTERY)\r\n            \"RecordSpeedNext\", //Toggle or cycle between media recording speeds. (VK_RECORD_SPEED_NEXT)\r\n            \"RfBypass\", //Toggle RF (radio frequency) input bypass mode (pass RF input directly to the RF output). (VK_RF_BYPASS)\r\n            \"ScanChannelsToggle\", //Toggle scan channels mode. (VK_SCAN_CHANNELS_TOGGLE)\r\n            \"ScreenModeNext\", //Advance display screen mode to next available mode. (VK_SCREEN_MODE_NEXT)\r\n            \"Settings\", //Toggle display of device settings screen. (VK_SETTINGS, KEYCODE_SETTINGS)\r\n            \"SplitScreenToggle\", //Toggle split screen mode. (VK_SPLIT_SCREEN_TOGGLE)\r\n            \"STBInput\", //Switch the input mode on an external STB (set top box). (KEYCODE_STB_INPUT)\r\n            \"STBPower\", //Toggle the power on an external STB (set top box). (KEYCODE_STB_POWER)\r\n            \"Subtitle\", //Toggle display of subtitles, if available. (VK_SUBTITLE)\r\n            \"Teletext\", //Toggle display of teletext, if available (VK_TELETEXT, KEYCODE_TV_TELETEXT).\r\n            \"VideoModeNext\", //Advance video mode to next available mode. (VK_VIDEO_MODE_NEXT)\r\n            \"Wink\", //Cause device to identify itself in some manner, e.g., audibly or visibly. (VK_WINK)\r\n            \"ZoomToggle\" //Toggle between full-screen and scaled content, or alter magnification level. (VK_ZOOM, KEYCODE_TV_ZOOM_MODE)\r\n        ]\r\n    },\r\n\r\n    allKeys: null,\r\n\r\n    insertInputTypes: [\r\n        \"insertText\", // \tinsert typed plain text \tNo \tUndefined \tAny\r\n        \"insertReplacementText\", // \treplace existing text by means of a spell checker, auto-correct or similar \tNo \tUndefined \tAny\r\n        \"insertLineBreak\", // \tinsert a line break \tNo \tUndefined \tAny\r\n        \"insertParagraph\", // \tinsert a paragraph break \tNo \tUndefined \tAny\r\n        \"insertOrderedList\", // \tinsert a numbered list \tNo \tYes \tAny\r\n        \"insertUnorderedList\", // \tinsert a bulleted list \tNo \tYes \tAny\r\n        \"insertHorizontalRule\", // \tinsert a horizontal rule \tNo \tYes \tAny\r\n        \"insertFromYank\", // \treplace the current selection with content stored in a kill buffer \tNo \tYes \tAny\r\n        \"insertFromDrop\", // \tinsert content into the DOM by means of drop \tNo \tYes \tAny\r\n        \"insertFromPaste\",          // \tpaste \tNo \tYes \tAny\r\n        \"insertFromPasteAsQuotation\", // paste content as a quotation \tNo \tYes \tAny\r\n        \"insertTranspose\",          // \ttranspose the last two characters that were entered \tNo \tYes \tAny\r\n        \"insertCompositionText\",    // \treplace the current composition string \tYes \tNo \tAny\r\n        \"insertLink\"                // \tinsert a link \tNo \tYes \tAny \r\n    ],\r\n\r\n    /*\r\n    Keycode for the tab key.\r\n    \r\n    @private\r\n    */\r\n    KEY_CODE_TAB: 9,\r\n\r\n    /*\r\n    Keycodes that do not edit a value.\r\n    \r\n    @private\r\n    */\r\n    KEY_CODE_NON_EDIT: { 37: 1, 38: 1, 39: 1, 40: 1, 35: 1, 36: 1, 9: 1 },\r\n\r\n    /*\r\n    Special keys that are almost always allowed.\r\n    \r\n    @private\r\n    */\r\n    KEY_CODE_SPECIAL: { 37: 1, 38: 1, 39: 1, 40: 1, 35: 1, 36: 1, 46: 1, 8: 1, 9: 1 },\r\n    //  37, 38, 39, 40 cursor keys\r\n    //  35  end\r\n    //  36  home\r\n    //  46  delete\r\n    //  8   backspace\r\n    //  9   tab\r\n\r\n    /*\r\n    Adds a capturing listener to a DOM element. This function is only supported by \r\n    browsers that implement the W3C event model. Please do not use this method if \r\n    you don't know what event capturing is because it can places the event listener\r\n    before any other event. It works by adding a \"capture_\" prefix to the event \r\n    name for W3C browsers so the DOMHandler recognizes this as a different event.\r\n    \r\n    @param  sEvent          Name of the event to listen to.\r\n    @param  eElement        Reference to the DOM element that fires the event.\r\n    @param  fListener       Reference to the function that will handle the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).\r\n    */\r\n    addDomCaptureListener(sEvent, eElement, fListener, oEnvironment) {\r\n        //  Attach the listener\r\n        if (window.addEventListener) { // W3C\r\n            sEvent = \"capture_\" + sEvent;\r\n        }\r\n\r\n        this.addDomListener(sEvent, eElement, fListener, oEnvironment);\r\n    },\r\n\r\n    /*\r\n    Removes a capturing listener to of a DOM element.\r\n    \r\n    @param  sEvent      Name of the event.\r\n    @param  eElement    Reference to the DOM element.\r\n    @param  fListener   Reference to the function that is attached to the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).\r\n    */\r\n    removeDomCaptureListener(sEvent, eElement, fListener, oEnvironment) {\r\n        //  Attach the listener\r\n        if (window.addEventListener) { // W3C\r\n            sEvent = \"capture_\" + sEvent;\r\n        }\r\n\r\n        this.removeDomListener(sEvent, eElement, fListener, oEnvironment);\r\n    },\r\n\r\n    /*\r\n    Adds a listener to an event of a DOM element in a browser independent way using\r\n    the df.events.DOMHandler object. The name of the event is according to the W3C\r\n    specifications (so without the microsoft \"on\") usage. Note that for some \r\n    special events like the mousewheel event special methods are available.\r\n    \r\n    @param  sEvent          Name of the event to listen to.\r\n    @param  eElement        Reference to the DOM element that fires the event.\r\n    @param  fListener       Reference to the function that will handle the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).\r\n    */\r\n    addDomListener(sEvent, eElement, fListener, oEnvironment) {\r\n        let oDOMHandler;\r\n\r\n        //  Find or create DOM Handler\r\n        if (eElement._oDfDomH === undefined || !eElement._oDfDomH[sEvent]) {\r\n            oDOMHandler = new events.DOMHandler(sEvent, eElement);\r\n        } else {\r\n            oDOMHandler = eElement._oDfDomH[sEvent];\r\n        }\r\n\r\n        //  Add listener to handler\r\n        oDOMHandler.addListener(fListener, oEnvironment);\r\n    },\r\n\r\n    /*\r\n    Removes the event listener from the DOM element so it won't be called any more \r\n    if the event occurs.\r\n    \r\n    @param  sEvent      Name of the event to which the handler listened.\r\n    @param  eElement    Reference to the element that fired the event.\r\n    @param  fListener   Reference to the method that was handling the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).\r\n    */\r\n    removeDomListener(sEvent, eElement, fListener, oEnvironment) {\r\n        //  Find handler and call remove method\r\n        if (eElement._oDfDomH !== undefined && eElement._oDfDomH[sEvent]) {\r\n            eElement._oDfDomH[sEvent].removeListener(fListener, oEnvironment);\r\n        }\r\n    },\r\n\r\n    /*\r\n    Adds a key listener to the DOM elements. The Internet Explorer only sends the \r\n    correct key information on the keydown event instead of with the keypress \r\n    event.\r\n    \r\n    @param  eElement        Reference to the DOM element that fires the event.\r\n    @param  fListener       Reference to the function that will handle the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).    \r\n    */\r\n    addDomKeyListener(eElement, fListener, oEnvironment) {\r\n        // if(window.addEventListener){ // W3C\r\n        // events.addDomListener(\"keypress\", eElement, fListener, oEnvironment);\r\n        // }else{ // IE\r\n        events.addDomListener(\"keydown\", eElement, fListener, oEnvironment);\r\n        // }\r\n    },\r\n\r\n    /*\r\n    Removes the key listener from the DOM element.\r\n    \r\n    @param  eElement    Reference to the element that fired the event.\r\n    @param  fListener   Reference to the method that was handling the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n            ('this' will reference to this object when the handler is called).   \r\n    */\r\n    removeDomKeyListener(eElement, fListener, oEnvironment) {\r\n        // if(window.addEventListener){ // W3C\r\n        // events.removeDomListener(\"keypress\", eElement, fListener);\r\n        // }else{ // IE\r\n        events.removeDomListener(\"keydown\", eElement, fListener, oEnvironment);\r\n        // }\r\n    },\r\n\r\n    /*\r\n    Adds a listener to the mousewheel event which has different names for the \r\n    different browsers.\r\n    \r\n    @param  eElement        Reference to the DOM element that fires the event.\r\n    @param  fListener       Reference to the function that will handle the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n                        ('this' will reference to this object when the handler is \r\n                        called).       \r\n    */\r\n    addDomMouseWheelListener(eElement, fListener, oEnvironment) {\r\n        if (df.sys.isMoz) { //   Mozilla\r\n            events.addDomListener(\"DOMMouseScroll\", eElement, fListener, oEnvironment);\r\n        } else { // IE, WebKit\r\n            events.addDomListener(\"mousewheel\", eElement, fListener, oEnvironment);\r\n        }\r\n    },\r\n\r\n    /*\r\n    Removes the mousewheel listener from the DOM element.\r\n    \r\n    @param  eElement    Reference to the element that fired the event.\r\n    @param  fListener   Reference to the method that was handling the event.\r\n    @param  oEnvironment    (optional) Reference to the environment of the handler \r\n                        ('this' will reference to this object when the handler is \r\n                        called).       \r\n    */\r\n    removeDomMouseWheelListener(eElement, fListener, oEnvironment) {\r\n        if (df.sys.isMoz) {  //  Mozilla\r\n            events.removeDomListener(\"DOMMouseScroll\", eElement, fListener, oEnvironment);\r\n        } else { // IE, WebKit\r\n            events.removeDomListener(\"mousewheel\", eElement, fListener, oEnvironment);\r\n        }\r\n    },\r\n\r\n    /*\r\n    Generic event listener used to cancel events directly.\r\n    \r\n    @param  oEvent  Event object.\r\n    */\r\n    stop(oEvent) {\r\n        oEvent.stop();\r\n    },\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Administration used to clear the event listeners on window unload.\r\n    */\r\n    iDOMHandlers: 0,\r\n    /*\r\n    @private\r\n    */\r\n    oDOMHandlers: {},\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Clears all the event handlers to prevent memory leaks.\r\n    */\r\n    clearDomHandlers() {\r\n\r\n        for (const iHandlerId in events.oDOMHandlers) {\r\n            if (events.oDOMHandlers.hasOwnProperty(iHandlerId)) {\r\n                if (events.oDOMHandlers[iHandlerId].__DOMHandler) {\r\n                    events.oDOMHandlers[iHandlerId].clear();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    This method clears all the event listeners that are attached to the given DOM \r\n    element. The listeners need to be attached using the AJAX Library event system. \r\n    If bRecursive is true it will move into the child elements and clear those event \r\n    listeners as well. Clearing the listeners is important because these connections \r\n    between the browsers DOM environment and the JavaScript environment can cause \r\n    problems with the garbage collector which can cause memory leaks.\r\n    \r\n    @param  eElement    Reference to the DOM element.\r\n    @param  bRecursive  (optional) If true child elements are also cleared.\r\n    */\r\n    clearDomListeners(eElement, bRecursive) {\r\n\r\n        //  Loop through DOM handlers and remove them\r\n        if (eElement._oDfDomH) {\r\n            for (const sEvent in eElement._oDfDomH) {\r\n                if (eElement._oDfDomH.hasOwnProperty(sEvent)) {\r\n                    eElement._oDfDomH[sEvent].clear();\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Move into children\r\n        if (bRecursive) {\r\n            df.dom.visit(eElement, function (eChild) {\r\n                events.clearDomListeners(eChild, true);\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\n/*\r\nThe handler for one event that can contain multiple listeners. Contains the \r\nfunctionality to attach to the event and to call the registered listeners. \r\nDetaches itself if the last listener is unregistered (or if the page is \r\nunloaded). The _oDfDomH property is added to the element that contains \r\nreferences (as a named array) to all the handlers for that element.\r\n\r\n@private\r\n*/\r\nevents.DOMHandler = class DOMHandler {\r\n    /*\r\n    Constructor that gets the important properties.\r\n\r\n    @param  sEvent      Name of the event.\r\n    @param  eElement    Reference to the DOM element.\r\n    @private\r\n    */\r\n    constructor(sEvent, eElement) {\r\n        //  @privates\r\n        this.sEvent = sEvent;\r\n        this.eElement = eElement;\r\n\r\n\r\n        this.aListeners = [];\r\n        this.aRemoveListeners = [];\r\n        this.bFiring = false;\r\n        this.fHandler = null;\r\n        this.__DOMHandler = true;\r\n\r\n        this.iHandlerId = events.iDOMHandlers++;\r\n\r\n        this.attach();\r\n    }\r\n\r\n    /*\r\n    @private\r\n    \r\n    Attaches itself to the event using an inline anonymous function that calls the \r\n    fire method with the correct envirioment. Registers itself on the element and \r\n    globally.\r\n    */\r\n    attach() {\r\n        let fHandler;\r\n        const oDOMHandler = this;\r\n\r\n        //  Create inline method that calls the handling method with the correct environment\r\n        fHandler = function (e) {\r\n            return oDOMHandler.fire(e);\r\n        };\r\n\r\n        //  Attach the listener\r\n        if (window.addEventListener) { // W3C\r\n            if (this.sEvent.substr(0, 8) === \"capture_\") {\r\n                this.eElement.addEventListener(this.sEvent.substr(8), fHandler, true);\r\n            } else {\r\n                this.eElement.addEventListener(this.sEvent, fHandler, false);\r\n            }\r\n        } else { // IE\r\n            this.eElement.attachEvent(\"on\" + this.sEvent, fHandler);\r\n        }\r\n\r\n        //  Register the handler on the element\r\n        if (!this.eElement._oDfDomH) {\r\n            this.eElement._oDfDomH = {};\r\n        }\r\n        this.eElement._oDfDomH[this.sEvent] = this;\r\n\r\n        //  Register the handler globally\r\n        events.oDOMHandlers[this.iHandlerId] = this;\r\n\r\n        this.fHandler = fHandler;\r\n    }\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Clears the handler by deattaching itself from the event and removing itself \r\n    from the global and elements registration.\r\n    */\r\n    clear() {\r\n        //  Deattach the listener\r\n        if (window.addEventListener) {\r\n            if (this.sEvent.substr(0, 8) === \"capture_\") {\r\n                this.eElement.removeEventListener(this.sEvent.substr(8), this.fHandler, true);\r\n            } else {\r\n                this.eElement.removeEventListener(this.sEvent, this.fHandler, false);\r\n            }\r\n        } else {\r\n            this.eElement.detachEvent(\"on\" + this.sEvent, this.fHandler);\r\n        }\r\n\r\n        //  Unregister the handler on the element\r\n        delete this.eElement._oDfDomH[this.sEvent];\r\n\r\n        //  Unregister the global handler\r\n        delete events.oDOMHandlers[this.iHandlerId];\r\n    }\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Adds a listener to the event that is handled by this handler. It adds the \r\n    listener and environment reference encapsulated in an object to the listeners \r\n    array.\r\n    \r\n    @param  fListener       Reference to the handling method.\r\n    @param  oEnvironment    (optional) Reference to the preferred environment.\r\n    */\r\n    addListener(fListener, oEnvironment) {\r\n        if (typeof (fListener) !== \"function\") {\r\n            throw new df.Error(5131, \"Listener must be a function (event: {{0}})\", oEnvironment || null, [this.sEvent]);\r\n        }\r\n        if (!oEnvironment) {\r\n            console.warn(\"df.events.addListener()/df.dom.on() without an oEnvironment is deprecated, it could cause the wrong listener to be removed.\");\r\n        }\r\n\r\n        this.aListeners.push({ \"fListener\": fListener, \"oEnvironment\": oEnvironment });\r\n    }\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Removes a listener from the event that is handled by the handler. It removes \r\n    the listener from the array and if it is the last listener it clears the \r\n    handler.\r\n    \r\n    @param  fListener   Reference to the handling method.\r\n    @param  oEnvironment    (optional) Reference to the preferred environment.\r\n    */\r\n    removeListener(fListener, oEnvironment) {\r\n        // deprecation check\r\n        // BN: for some reason the oEnvironment was not previously specified.\r\n        //     now that we do, we check whether oEnvironment was not null or undefined.\r\n        //     if so we warn the end-user that the first event with that listener will be removed like it was done before.\r\n        if (oEnvironment) {\r\n            for (let i = 0; i < this.aListeners.length; i++) {\r\n                if (this.aListeners[i].fListener === fListener && this.aListeners[i].oEnvironment === oEnvironment) {\r\n                    if (this.bFiring) {\r\n                        this.aRemoveListeners.push(this.aListeners[i]);\r\n                    } else {\r\n                        if (this.aListeners.length > 1) {\r\n                            this.aListeners.splice(i, 1);\r\n                        } else {\r\n                            this.clear();\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            console.warn(\"df.events.removeListener()/df.dom.off() without an oEnvironment is deprecated, it could cause the wrong listener to be removed.\");\r\n\r\n            for (let i = 0; i < this.aListeners.length; i++) {\r\n                if (this.aListeners[i].fListener === fListener) {\r\n                    if (this.bFiring) {\r\n                        // this will stay the new way as it does not change.\r\n                        this.aRemoveListeners.push(this.aListeners[i]);\r\n                    } else {\r\n                        if (this.aListeners.length > 1) {\r\n                            this.aListeners.splice(i, 1);\r\n                        } else {\r\n                            this.clear();\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /*\r\n    @private\r\n    \r\n    Fires the event by creating a df.events.DOMEvent object and calling the \r\n    listeners in sequence. It \"locks\" the event handling using the bFiring boolean. \r\n    It stops if the event is cancelled. If listeners are removed during the \r\n    handling it will perform this action again.\r\n    \r\n    @param  e   Event object in some browsers.\r\n    */\r\n    fire(e) {\r\n        // df.debug(\"---- \" + this.sEvent + \" ---- (\" + this.aListeners.length + \" handlers) ----\");\r\n        // console.log(this.eElement);\r\n\r\n        //  Create event object\r\n        const oEvent = new events.DOMEvent(e, this.eElement, this.sEvent);\r\n\r\n        //  Lock\r\n        this.bFiring = true;\r\n\r\n        //  Call the listeners\r\n        for (let i = 0; i < this.aListeners.length && !oEvent.bCanceled; i++) {\r\n            if (typeof (this.aListeners[i].fListener) === \"function\") {\r\n                try {\r\n                    if (this.aListeners[i].fListener.call((this.aListeners[i].oEnvironment !== undefined ? this.aListeners[i].oEnvironment : this.eElement), oEvent) === false) {\r\n                        oEvent.stop();\r\n                    }\r\n                } catch (oError) {\r\n                    df.handleError(oError);\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Unlock\r\n        this.bFiring = false;\r\n\r\n        //  Remove the listeners that where placed for removal during the event execution.\r\n        while (this.aRemoveListeners.length > 0) {\r\n            const oListener = this.aRemoveListeners.pop();\r\n            this.removeListener(oListener.fListener, oListener.oEnvironment);\r\n        }\r\n\r\n        //  If the event is canceled we do anything we can to stop the event!\r\n        if (oEvent.bCanceled) {\r\n            // necessary for addEventListener, works with traditional\r\n            if (e.preventDefault) {\r\n                e.preventDefault();\r\n            }\r\n            // necessary for attachEvent, works with traditional\r\n            e.returnValue = false;\r\n\r\n            // works with traditional, not with attachEvent or addEventListener\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n};\r\n\r\n\r\n\r\n/*\r\nThis class is used as a wrapper of the event object when using the AJAX Library \r\nevent system to handle DOM events. It main purpose is to provide a browser \r\nindependent API to handle the events. It is passed as parameter to the event \r\nhandler method.\r\n\r\n@code\r\nfunction myInitForm(oForm){\r\n    df.events.addDomListener(\"click\", document.getElementById(\"mybutton\"), myButtonClick);\r\n}\r\n\r\nfunction myButtonClick(oEvent){\r\n    //  oEvent.eSource always contains a reference to the element on which the listener was attached.\r\n    oEvent.eSource.value = \"I am clicked!\";\r\n}\r\n\r\n...\r\n\r\n<input type=\"button\" id=\"mybutton\" value=\"Click me!\"/>\r\n@code\r\n*/\r\nevents.DOMEvent = class DOMEvent {\r\n    /*\r\n    Constructor that takes the event object of the browser as a parameter.\r\n\r\n    @param  e       Event object (in some browsers).\r\n    @param  eSource Reference to the element to which the listener is attached.\r\n    */\r\n    constructor(e, eSource, sName) {\r\n        /*\r\n        Reference to the element to which the listener is attached.\r\n        */\r\n        this.eSource = eSource;\r\n        /*\r\n        Reference to the browsers event object.\r\n        */\r\n        if (!e) {\r\n            this.e = window.event;\r\n        } else {\r\n            this.e = e;\r\n        }\r\n        /*\r\n        Name of the event (used by the AJAX Library, without the \"on\").\r\n        */\r\n        this.sName = sName;\r\n\r\n        // @privates\r\n        this.bCanceled = false;\r\n    }\r\n\r\n    /*\r\nDetermines which DOM element has thrown the event. This can be a different \r\nelement than to which the listeners is attached because events can bubble up in \r\nthe DOM. Note that there are still some minor differences between the different \r\nbrowsers in the result of this function.\r\n \r\n@return The DOM element that fired the event.\r\n*/\r\n    getTarget() {\r\n        let eTarget;\r\n\r\n        if (this.e.target) {\r\n            eTarget = this.e.target; // W3C\r\n        } else if (this.e.srcElement) {\r\n            eTarget = this.e.srcElement;    // IE\r\n        }\r\n\r\n        if (eTarget.nodeType === 3) {\r\n            eTarget = eTarget.parentNode; // Safari bug\r\n        }\r\n\r\n        return eTarget;\r\n    }\r\n\r\n    /*\r\n    @return The horizontal mouse position.\r\n    */\r\n    getMouseX() {\r\n        return this.e.clientX;\r\n    }\r\n\r\n    /*\r\n    @return The vertical mouse position.\r\n    */\r\n    getMouseY() {\r\n        return this.e.clientY;\r\n    }\r\n\r\n    /*\r\n    @return The keycode from the key that is pressed.\r\n    */\r\n    getKeyCode() {\r\n        //    if(this.e.keyCode){\r\n        return this.e.keyCode;  // IE\r\n        //    }else{\r\n        //        return this.e.which; // W3C\r\n        //    }\r\n    }\r\n\r\n    /*\r\n    Determines wether the key event represents an special key (delete, home, \r\n    end, up, ...).\r\n    \r\n    @return True if the key is supposed to be special.\r\n    */\r\n    isSpecialKey() {\r\n        const iKeyCode = this.getKeyCode();\r\n\r\n        //  IE and webkit browsers do not fire keypress events for special keys\r\n        if ((df.sys.isIE || df.sys.isSafari) && this.e.type === \"keypress\") {\r\n            return false;\r\n        }\r\n\r\n        return (this.getAltKey() || this.getCtrlKey() || (events.KEY_CODE_SPECIAL[iKeyCode] && iKeyCode !== 0));\r\n    }\r\n\r\n    /*\r\n    Determines if a key is printable based on the KeyboardEvent.key value.\r\n    \r\n    @return True if the keydown will result in a printable key.\r\n    */\r\n    isKeyPrintable() {\r\n        return !this.getCtrlKey() && !this.getAltKey() && events.allKeys.indexOf(this.e.key) === -1;\r\n    }\r\n\r\n    /*\r\n    @return String describing the pressed key (KeyboardEvent.key).\r\n    */\r\n    key() {\r\n        return this.e.key;\r\n    }\r\n\r\n    /*\r\n    Determines if an onInput event is caused by an insert operation.\r\n    \r\n    @return True if the input event is an insert operation.\r\n    */\r\n    inputIsInsert() {\r\n        return events.insertInputTypes.indexOf(this.e.inputType) !== -1;\r\n    }\r\n\r\n\r\n    /*\r\n    Returns the charcode fort his key press indicating the resulting character. 0 will be returned if \r\n    the keypress does not result in a character (except for older browsers where the difference can not \r\n    be established). \r\n    \r\n    @return ASCII Character code.\r\n    */\r\n    getCharCode() {\r\n        if (this.e.charCode) {\r\n            return this.e.charCode;\r\n        }\r\n\r\n        //  For old browsers we use the keyCode which sometimes contains the charCode (Internet Explorer 8)\r\n        if (typeof this.e.charCode !== \"number\") {\r\n            return this.e.keyCode;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /*\r\n    @return True if the ctrl key was pressed.\r\n    */\r\n    getCtrlKey() {\r\n        return this.e.ctrlKey;\r\n    }\r\n\r\n    /*\r\n    @return True if the shift key was pressed.\r\n    */\r\n    getShiftKey() {\r\n        return this.e.shiftKey;\r\n    }\r\n\r\n    /*\r\n    @return True if the alt key was pressed.\r\n    */\r\n    getAltKey() {\r\n        return this.e.altKey;\r\n    }\r\n\r\n    /*\r\n    Checks which mouse button has been pressed if the event is a mouse event. \r\n    \r\n    @return Integer indicating the clicked button according to the microsoft standard \r\n        (left: 1, middle: 4, right: 2).\r\n    */\r\n    getMouseButton() {\r\n        if (this.e.which) { // W3C\r\n            switch (this.e.which) {\r\n                case 0:\r\n                    return 1;\r\n                case 1:\r\n                    return 4;\r\n                case 2:\r\n                    return 2;\r\n                default:\r\n                    return 0;\r\n            }\r\n        } else { // IE\r\n            return this.e.button;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Determines the mousewheel action performed by the user.\r\n    \r\n    @return Integer indicating the action (up: >0, down: <0, none:0).\r\n    */\r\n    getMouseWheelDelta() {\r\n        let iDelta = 0;\r\n\r\n        if (this.e.detail) {\r\n            //  Mozilla has multiple of 3 as detail\r\n            iDelta = -this.e.detail / 3;\r\n        } else if (this.e.wheelDelta) { // IE / Opera\r\n            iDelta = this.e.wheelDelta / 120;\r\n        }\r\n\r\n        return iDelta;\r\n    }\r\n\r\n    /*\r\n    Stops the event chain by setting bCanceled to true so the handling object \r\n    won't call other listeners and tries to stop the event bubbling further.\r\n    */\r\n    stop() {\r\n        this.bCanceled = true;\r\n        this.e.returnValue = false;\r\n        this.e.cancelBubble = true;\r\n        this.e.canceled = true;\r\n\r\n        if (this.e.preventDefault) {\r\n            this.e.preventDefault();\r\n        }\r\n        if (this.e.stopPropagation) {\r\n            this.e.stopPropagation();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Stops the event from bubbling to parent elements without canceling the event and its default \r\n    behaviors.\r\n    */\r\n    stopPropagation() {\r\n        if (this.e.stopPropagation) {\r\n            this.e.stopPropagation();\r\n        } else if (this.e.cancelBubble !== undefined) {\r\n            this.e.cancelBubble = true;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Checks if the current event (only works for key events) matches the provided key definition(s). \r\n    \r\n    @param  keydef  Object (or array of objects) representing a key combination \r\n                    { iKeyCode : 1, bCtrl : false, bShift : false, bAlt : false }.\r\n    @return True if the key event matches one of the provided key definitions.\r\n    */\r\n    matchKey(keydef) {\r\n\r\n        if (keydef) {\r\n            if (keydef instanceof Array) {\r\n                for (let i = 0; i < keydef.length; i++) {\r\n                    if (keydef[i].iKeyCode === this.getKeyCode() &&\r\n                        !!keydef[i].bCtrl === this.getCtrlKey() &&\r\n                        !!keydef[i].bShift === this.getShiftKey() &&\r\n                        !!keydef[i].bAlt === this.getAltKey()) {\r\n                        return true;\r\n                    }\r\n                }\r\n            } else {\r\n                return (keydef.iKeyCode === this.getKeyCode() &&\r\n                    !!keydef.bCtrl === this.getCtrlKey() &&\r\n                    !!keydef.bShift === this.getShiftKey() &&\r\n                    !!keydef.bAlt === this.getAltKey());\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n};\r\n\r\n\r\n/*\r\nAttach the clearDomHandlers method to the windows unload event to clean the \r\nevents when the page is unloaded.\r\n*/\r\nevents.addDomListener(\"unload\", window, events.clearDomHandlers, window);\r\n\r\n/*\r\nThe df.events.JShandler class contains the logic that is used to throw AJAX \r\nLibrary events. An event within the AJAX Library is nothing more than an \r\ninstance of this class. The class maintains an array of listeners (and their \r\nenvironment references) that are added to this event. If the object throwing the \r\nevent calls the fire method it will go through this array calling all the \r\nmethods attached to this event. \r\n\r\nThe example below shows how the event object can be used. The AJAX Library \r\ncomponents have several events (usually with names startin with \"on\") that can \r\nbe handled this way.\r\n@code\r\nfunction listener1(oEvent){\r\n    //  Access the sPersonName property given with the event\r\n    df.gui.alert(\"Hello \" + oEvent.sPersonName);\r\n    \r\n    //  Stop the event so listener2 never gets called\r\n    oEvent.stop();\r\n}\r\n\r\nfunction listener2(oEvent){\r\n    df.gui.alert(\"This method should never be called..\");\r\n}\r\n\r\n//  Create event object\r\nvar myEvent = new df.events.JSHandler();\r\n\r\n//  Add listeners\r\nmyEvent.addListener(listener1);\r\nmyEvent.addListener(listener2);\r\n\r\n//  Fire event\r\nmyEvent.fire(this, { sPersonName : \"John\" })\r\n@code\r\n*/\r\nevents.JSHandler = class JSHandler {\r\n    /*\r\n    Represents an event within the AJAX Library.\r\n    */\r\n    constructor(sOptServerName) {\r\n        this.sServerName = sOptServerName || null;\r\n\r\n        // @privates\r\n        this.aListeners = [];\r\n\r\n        this.aRemoveListeners = [];\r\n        this.bFiring = false;\r\n    }\r\n\r\n    /*\r\n    Adds a new listener to the handler by putting it into the aListeners array.\r\n    \r\n    @param  fListener       Function that will be called when the event occurs.\r\n    @param  oEnvironment    The environment (this reference) in which the listeners \r\n            will be called.\r\n            \r\n    @deprecated\r\n    */\r\n    addListener(fListener, oEnvironment) {\r\n        this.on(fListener, oEnvironment);\r\n    }\r\n\r\n    /* \r\n    Adds a new listener to the event.\r\n    \r\n    @param  fListener       Function that will be called when the event occurs.\r\n    @param  oEnvironment    The environment (this reference) in which the listeners \r\n            will be called.\r\n    */\r\n    on(fListener, oEnv) {\r\n        if (typeof (fListener) !== \"function\") {\r\n            throw new df.Error(5131, \"Listener must be a function\", oEnv || null, [this.sEvent]);\r\n        }\r\n\r\n        this.aListeners.push({ \"fListener\": fListener, \"oEnvironment\": oEnv });\r\n    }\r\n\r\n    /*\r\n    Removes the given listener from the handler by removing it from the aListeners\r\n    array.\r\n    \r\n    @param  fListener   Function that was listening to the event.\r\n    @param  oEnvironment    The environment (this reference) in which the listeners \r\n            will be called.\r\n    */\r\n    off(fListener, oEnv) {\r\n\r\n        for (let iListener = 0; iListener < this.aListeners.length; iListener++) {\r\n            if (this.aListeners[iListener].fListener === fListener && this.aListeners[iListener].oEnvironment === oEnv) {\r\n                if (this.bFiring) {\r\n                    this.aRemoveListeners.push(this.aListeners[iListener]);\r\n                } else {\r\n                    this.aListeners.splice(iListener, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Removes the given listener from the handler by removing it from the aListeners\r\n    array.\r\n    \r\n    @param  fListener   Function that was listening to the event.\r\n    @param  oEnvironment    The environment (this reference) in which the listeners \r\n            will be called.\r\n    @deprecated\r\n    */\r\n    removeListener(fListener, oEnv) {\r\n        this.off(fListener, oEnv);\r\n    }\r\n\r\n    /*\r\n    The fire method that calls the listeners in a first registered = first called \r\n    sequence as long as bCanceled is false.\r\n    \r\n    @return bCanceled property of the event object.\r\n    */\r\n    fire(oSource, oOptions) {\r\n        if (this.aListeners.length > 0) {\r\n\r\n            const oEvent = (oOptions instanceof events.JSEvent ? oOptions : new events.JSEvent(oSource, oOptions));\r\n\r\n            //  Lock\r\n            this.bFiring = true;\r\n\r\n            //  Call the listeners\r\n            for (let iListener = 0; iListener < this.aListeners.length && !oEvent.bCanceled; iListener++) {\r\n                if (typeof (this.aListeners[iListener].fListener) === \"function\") {\r\n                    try {\r\n                        if (this.aListeners[iListener].fListener.call((this.aListeners[iListener].oEnvironment !== undefined ? this.aListeners[iListener].oEnvironment : this.eElement), oEvent) === false) {\r\n                            oEvent.stop();\r\n                        }\r\n                    } catch (oError) {\r\n                        df.handleError(oError, oSource);\r\n                    }\r\n                }\r\n            }\r\n\r\n            //  Unlock\r\n            this.bFiring = false;\r\n\r\n            //  Remove the listeners that where placed for removal during the event execution.\r\n            while (this.aRemoveListeners.length > 0) {\r\n                const oListener = this.aRemoveListeners.pop();\r\n                this.off(oListener.fListener, oListener.oEnvironment);\r\n            }\r\n\r\n            return !oEvent.bCanceled;\r\n        }\r\n\r\n\r\n\r\n        return true;\r\n    }\r\n};\r\n\r\n/*\r\nThis class defines the API of the event that is given to event listeners by the \r\nAJAX Library event system. See df.events.JSHandler for an example of how this \r\nobject can be used. Most events add event specific properties to this object. \r\nThe important methods and properties are oSource and stop.\r\n*/\r\nevents.JSEvent = class JSEvent {\r\n    /*\r\n    Constructor of the df.events.JSEvent class which takes two parameters.\r\n\r\n    @param  oSource     Reference to the object throwing the event.\r\n    @param  oOptions    Object with event options that are added to the object.\r\n    */\r\n    constructor(oSource, oOptions) {\r\n\r\n        /*\r\n        Reference to the object that has fired the event.\r\n        */\r\n        this.oSource = oSource;\r\n\r\n        //  @privates\r\n        this.bCanceled = false;\r\n\r\n        if (typeof (oOptions) === \"object\") {\r\n            for (const sProp in oOptions) {\r\n                if (oOptions.hasOwnProperty(sProp)) {\r\n                    this[sProp] = oOptions[sProp];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Alternative for the oSource property so it is compatible with the DOMEvent.\r\n    \r\n    @return Reference to the element that fired event (this.oSource).\r\n    */\r\n    getTarget() {\r\n        return this.oSource;\r\n    }\r\n\r\n    /*\r\n    Can be used to stop the firing of the event. The rest of the listeners won't be\r\n    called and true will be returned which usually causes the action that follows \r\n    by \"Before\" events to cancel.\r\n    */\r\n    stop() {\r\n        this.bCanceled = true;\r\n    }\r\n};\r\n\r\n//  Assemble flat array of all keys\r\nevents.allKeys = Object.keys(events.keys).reduce(function (acc, sKey) {\r\n    return acc.concat(events.keys[sKey]);\r\n}, []);","/*\r\nName:\r\n    df.dom\r\nType:\r\n    Library (object)\r\n\r\nThis library contains a generic layer of methods that perform Document Object Model (DOM) \r\nmanipulations in a browser independent manner. It also extends the browser API with functionality \r\nthat makes it easier to work with the DOM.\r\n    \r\nRevisions:\r\n    2011/08/10 (HW, DAW)\r\n        Initial version splitted from the df.sys library.\r\n*/\r\nimport { gui } from './sys/gui.js';\r\nimport { events } from './events.js';\r\n\r\n\r\nexport const dom = {\r\n\r\n    /*\r\n    Selector string for usage with df.dom.query that gives all elements that can have the focus.\r\n    \r\n    @private\r\n    */\r\n    cFocusSelector: 'a, button, textarea, input, iframe, select, *[tabindex]',\r\n\r\n    /* \r\n    Counter for unique DOM ID's.\r\n    \r\n    @private\r\n    */\r\n    piDomCounter: 0,\r\n\r\n    /* \r\n    Shorthand API for adding DOM listeners. Can attach multiple listeners to multiple elements if arrays \r\n    are passed.\r\n    \r\n    @param  eElem   DOM element (or array of DOM elements)\r\n    @param  sEvent  Name of the handled DOM event (or array / space separated string)\r\n    @param  fHan    Handler function.\r\n    @param  oEnv    Environment object (what this will point to when handler is called).\r\n    */\r\n    on(sEvent, eElem, fHan, oEnv) {\r\n        let aEv;\r\n\r\n        if (eElem instanceof Array || eElem instanceof NodeList) {\r\n            eElem.forEach(function (eItem) {\r\n                this.on(sEvent, eItem, fHan, oEnv);\r\n            }, this);\r\n            return;\r\n        }\r\n\r\n        if (sEvent instanceof Array) {\r\n            aEv = sEvent;\r\n        } else {\r\n            aEv = sEvent.split(' ');\r\n        }\r\n\r\n        aEv.forEach(function (sItem) {\r\n            events.addDomListener(sItem, eElem, fHan, oEnv);\r\n        });\r\n    },\r\n\r\n    /* \r\n    Shorthand API for removind DOM listeners. Can remove multiple listeners of multiple elements at once.\r\n    \r\n    @param  eElem   DOM element (or array of DOM elements)\r\n    @param  sEvent  Name of the handled DOM event (or array / space separated string)\r\n    @param  fHan    Handler function.\r\n    @param  oEnv    Environment object (what this will point to when handler is called).\r\n    */\r\n    off(sEvent, eElem, fHan, oEnv) {\r\n        let aEv;\r\n\r\n        if (eElem instanceof Array) {\r\n            eElem.forEach(function (eItem) {\r\n                this.off(eItem, sEvent, fHan, oEnv);\r\n            }, this);\r\n            return;\r\n        }\r\n\r\n        if (sEvent instanceof Array) {\r\n            aEv = sEvent;\r\n        } else {\r\n            aEv = sEvent.split(' ');\r\n        }\r\n\r\n        aEv.forEach(function (sItem) {\r\n            events.removeDomListener(sItem, eElem, fHan, oEnv);\r\n        });\r\n    },\r\n\r\n    /* \r\n    Shorthand API for clearing all DOM listeners on an element.\r\n    \r\n    @param  eElem       DOM Element (or array of DOM elements).\r\n    @param  bRecursive  If true it will also clear handlers of child elements.\r\n    */\r\n    clear(eElem, bRecursive) {\r\n        if (eElem instanceof Array) {\r\n            eElem.forEach(function (eItem) {\r\n                this.clear(eItem, bRecursive);\r\n            }, this);\r\n            return;\r\n        }\r\n\r\n        events.clearDomListeners(eElem, bRecursive);\r\n    },\r\n\r\n    /* \r\n    Generates a unique ID using a counter. These unique ID's can be used by controls whenever a \r\n    generated id is necessary.\r\n    \r\n    @return String with unique ID.\r\n    */\r\n    genDomId() {\r\n        return \"_df_\" + this.piDomCounter++;\r\n    },\r\n\r\n    /*\r\n    Adds one or more classes to the elements className. Make sure the added classes \r\n    aren't already applied.\r\n    \r\n    @param  eElem   The element.\r\n    @param  sClass  Space separated list of CSS class names.\r\n    */\r\n    addClass(eElem, sClass) {\r\n        let sClassName, bFound = false;\r\n\r\n        if (!eElem) return;\r\n\r\n        if (eElem.className) {\r\n            const aClasses = (sClass || \"\").split(/\\s+/);\r\n            sClassName = \" \" + eElem.className + \" \";\r\n            for (let i = 0; i < aClasses.length; i++) {\r\n                if (sClassName.indexOf(\" \" + aClasses[i] + \" \") < 0) {\r\n                    sClassName += \" \" + aClasses[i];\r\n                    bFound = true;\r\n                }\r\n            }\r\n            if (bFound) {\r\n                eElem.className = sClassName.trim();\r\n            }\r\n        } else {\r\n            eElem.className = sClass;\r\n        }\r\n    },\r\n\r\n    /*\r\n    Removes one or more classes from the elements className.\r\n    \r\n    @param  eElem   The element.\r\n    @param  sClass  Space separated list of CSS class names.\r\n    */\r\n    removeClass(eElem, sClass) {\r\n        let sClassName, bFound = false;\r\n\r\n        if (!eElem) return;\r\n\r\n        if (eElem.className) {\r\n            sClass = \" \" + sClass + \" \";\r\n            const aClasses = eElem.className.split(/\\s+/);\r\n            sClassName = \"\";\r\n            for (let i = 0; i < aClasses.length; i++) {\r\n                if (sClass.indexOf(\" \" + aClasses[i] + \" \") < 0) {\r\n                    sClassName += \" \" + aClasses[i];\r\n                    bFound = true;\r\n                }\r\n            }\r\n            if (bFound) {\r\n                eElem.className = sClassName.trim();\r\n            }\r\n        }\r\n    },\r\n\r\n    toggleClass(eElem, sClass, bVal) {\r\n        if (bVal) {\r\n            this.addClass(eElem, sClass);\r\n        } else {\r\n            this.removeClass(eElem, sClass);\r\n        }\r\n    },\r\n\r\n    createCSSElem(sFile) {\r\n        const eStyle = document.createElement('link');\r\n        eStyle.rel = 'stylesheet';\r\n        eStyle.type = 'text/css';\r\n        eStyle.href = sFile;\r\n\r\n        return eStyle;\r\n    },\r\n\r\n    /**\r\n     * Determines if one sibbling is located before another.\r\n     * \r\n     * @param {DOM Element} eElem1 \r\n     * @param {DOM Element} eElem2 \r\n     * @returns True is the elements are sibblings and eElem1 is located before eElem2.\r\n     */\r\n    isBefore(eElem1, eElem2) {\r\n        if (eElem2.parentNode === eElem1.parentNode) {\r\n            for (let cur = eElem1.previousSibling; cur; cur = cur.previousSibling) {\r\n                if (cur === eElem2) return true\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    /*\r\n    Sets the text / content of the element.\r\n    \r\n    @param  eElem    DOM Element.\r\n    @param  sValue      The new text.\r\n    */\r\n    setText(eElem, sValue) {\r\n        if (sValue === \" \") {\r\n            eElem.innerHTML = \"&nbsp;\";\r\n        } else {\r\n            //  Replace \\n\\r with newline (note that we only add the newline character and not the carriage return because WebKit will add a two newlines)\r\n            sValue = sValue.toString().replace(/\\\\n\\\\r/gi, '\\n');\r\n\r\n            //  Set the innerText property\r\n            if (\"innerText\" in eElem) {   //  Use \".. in ..\" syntax so it doesn't actually query the DOM element (performance)\r\n                eElem.innerText = sValue;\r\n            } else {\r\n                eElem.textContent = sValue;\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    Gets the text / content of the element.\r\n    \r\n    @param  eElem    DOM Element.\r\n    @return The content text.\r\n    */\r\n    getText(eElem) {\r\n        if (eElem.innerText !== undefined) {\r\n            return eElem.innerText;\r\n        }\r\n\r\n        return eElem.textContent;\r\n    },\r\n\r\n    /*\r\n    This is a browser independent method to fetch the outerHTML of a DOM element. If the browser doesn't \r\n    support the outerHTML property the method will generate a temporary element and use the innerHTML \r\n    attribute.\r\n    \r\n    @param  eElem   Reference to a DOM element.\r\n    @return The outerHTML of the element (null if not available).\r\n    */\r\n    getOuterHTML(eElem) {\r\n\r\n        if (eElem.outerHTML) {\r\n            return eElem.outerHTML;\r\n        }\r\n        if (eElem.parentNode) {\r\n            const eParent = eElem.parentNode;\r\n            const eFake = document.createElement(eParent.tagName);\r\n\r\n            eFake.appendChild(eElem);\r\n            const sHTML = eFake.innerHTML;\r\n            eParent.appendChild(eElem);\r\n\r\n            return sHTML;\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /*\r\n    Makes an exact clone of the given element and its sub element. It uses the \r\n    cloneNode method of the DOM but goes through the structure to \"repair\" the \r\n    flaws of the cloneNode method.\r\n    \r\n    @param  eOrig   The element to clone.\r\n    @return Clone of the element (and its children).\r\n    */\r\n    deepClone(eOrig) {\r\n        let fChecker;\r\n\r\n        const eClone = eOrig.cloneNode(true);\r\n\r\n        fChecker = function (eClone, eOrig) {\r\n            var iChild;\r\n\r\n            if (eClone.tagName === \"SELECT\" || eClone.tagName === \"TEXTAREA\") {\r\n                eClone.value = eOrig.value;\r\n            }\r\n\r\n            for (iChild = 0; iChild < eClone.childNodes.length; iChild++) {\r\n                if (eClone.childNodes[iChild].nodeType !== 3 && eClone.childNodes[iChild].nodeType !== 8) {\r\n                    fChecker(eClone.childNodes[iChild], eOrig.childNodes[iChild]);\r\n                }\r\n            }\r\n        };\r\n\r\n        fChecker(eClone, eOrig);\r\n\r\n        return eClone;\r\n    },\r\n\r\n    /*\r\n    Replaces the node with the new one.\r\n    \r\n    @param  eOrig   DOM Node to be replaced.\r\n    @param  eNew    New DOM node.\r\n    */\r\n    swapNodes(eOrig, eNew) {\r\n        if (eOrig) {\r\n            if (eNew) {\r\n                if (eOrig.replaceNode !== undefined) {\r\n                    eOrig.replaceNode(eNew);\r\n                } else {\r\n                    eOrig.parentNode.replaceChild(eNew, eOrig);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    Inserts the new element into the DOM after the given element.\r\n    \r\n    @param eNewElement  The new element to insert.\r\n    @param eElem     The element to insert after.\r\n    */\r\n    insertAfter(eNewElement, eElem) {\r\n        if (eElem.nextSibling !== null) {\r\n            eElem.parentNode.insertBefore(eNewElement, eElem.nextSibling);\r\n        } else {\r\n            eElem.parentNode.appendChild(eNewElement);\r\n        }\r\n    },\r\n\r\n    /*\r\n    Recursive function that checks if the searched element is a parent of the\r\n    start element.\r\n    \r\n    @param  eStart  Start element.\r\n    @param  eSearch Searched element.\r\n    @return True if the searched element is a parent.\r\n    */\r\n    isParent(eStart, eSearch) {\r\n        if (eStart === null) {\r\n            return false;\r\n        }\r\n        if (eStart === eSearch) {\r\n            return true;\r\n        }\r\n        if (eStart.parentNode !== undefined) {\r\n            return this.isParent(eStart.parentNode, eSearch);\r\n        }\r\n        return false;\r\n    },\r\n\r\n    /*\r\n    Returns the a parent object (or itself) with the requested tagname\r\n    \r\n    @param  eElem       Element where to startt the search.\r\n    @param  sTagName    Tagname of searched object.\r\n    @return First parent with the given tagname (null if not found).\r\n    */\r\n    searchParent(eElem, sTagName) {\r\n        sTagName = sTagName.toUpperCase();\r\n\r\n        if (eElem.tagName === sTagName) {\r\n            return eElem;\r\n        }\r\n        if (eElem.parentNode !== undefined && eElem !== document) {\r\n            return this.searchParent(eElem.parentNode, sTagName);\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /*\r\n    Gives the focus to the given element. It has a try catch block because some\r\n    browsers tend to throw strange errors here. It also calls the setActive method\r\n    if it is available.\r\n    \r\n    @param  eElem    Reference to the DOM element that should receive the focus.\r\n    @param  bSelect     If true the content of the element will also be selected.\r\n    */\r\n    focus(eElem, bSelect) {\r\n        try {\r\n            eElem.focus();\r\n            if (bSelect && eElem.select) {\r\n                eElem.select();\r\n            }\r\n\r\n            if (typeof (eElem.setActive) === \"function\") {\r\n                eElem.setActive();\r\n            }\r\n        } catch (err) {\r\n            //ignore focus error\r\n        }\r\n\r\n\r\n    },\r\n\r\n    /*\r\n    Tries to determine the current caret position of the text field.\r\n    \r\n    @param  eField  Reference to the field DOM element.\r\n    @return The caret position (0 if not found).\r\n    */\r\n    getCaretPosition(eField) {\r\n        return this.getSelection(eField).start;\r\n    },\r\n\r\n    /*\r\n    Determines the length of the selection.\r\n    \r\n    @param  eField  Reference to a DOM element (usually a input type=\"text\").\r\n    @return Length of the selection (0 if no selection).\r\n    @deprecated\r\n    */\r\n    getSelectionLength(eField) {\r\n        return this.getSelection(eField).length;\r\n    },\r\n\r\n    /* \r\n    Determines the text selection within the DOM element (usually an input type=text or textarea). An \r\n    object with the details of the selection will be returned. This allows input filters and masks to \r\n    easily use this information.\r\n    \r\n    @param  eField  Reference to a DOM element.\r\n    @return Object with selection details: { start: 4, end: 7, length: 3 }\r\n    */\r\n    getSelection(eField) {\r\n        let iStart = 0, iEnd = 0;\r\n\r\n        //  Use simple selectionStart and selectionEnd when available\r\n        if (\"selectionStart\" in eField && (/text|password|search|tel|url/).test(eField.type)) {   //  Use \".. in ..\" syntax so it doesn't actually query the DOM element (performance)\r\n            iStart = eField.selectionStart;\r\n            iEnd = eField.selectionEnd;\r\n\r\n        } else if (document.selection) {   // Internet Explorer 8 Support\r\n            try {\r\n                const oRange = document.selection.createRange();\r\n\r\n                if (oRange && oRange.parentElement() === eField) {\r\n                    const iLen = eField.value.length;\r\n                    const sNormalizedValue = eField.value.replace(/\\r\\n/g, \"\\n\");\r\n\r\n                    // Create a working TextRange that lives only in the input\r\n                    const oTextInputRange = eField.createTextRange();\r\n                    oTextInputRange.moveToBookmark(oRange.getBookmark());\r\n\r\n                    // Check if the start and end of the selection are at the very end\r\n                    // of the input, since moveStart/moveEnd doesn't return what we want\r\n                    // in those cases\r\n                    const oEndRange = eField.createTextRange();\r\n                    oEndRange.collapse(false);\r\n\r\n                    if (oTextInputRange.compareEndPoints(\"StartToEnd\", oEndRange) > -1) {\r\n                        iStart = iEnd = iLen;\r\n                    } else {\r\n                        iStart = -oTextInputRange.moveStart(\"character\", -iLen);\r\n                        iStart += sNormalizedValue.slice(0, iStart).split(\"\\n\").length - 1;\r\n\r\n                        if (oTextInputRange.compareEndPoints(\"EndToEnd\", oEndRange) > -1) {\r\n                            iEnd = iLen;\r\n                        } else {\r\n                            iEnd = -oTextInputRange.moveEnd(\"character\", -iLen);\r\n                            iEnd += sNormalizedValue.slice(0, iEnd).split(\"\\n\").length - 1;\r\n                        }\r\n                    }\r\n                }\r\n\r\n\r\n\r\n            } catch (e) {\r\n\r\n            }\r\n        }\r\n        return {\r\n            start: iStart,\r\n            end: iEnd,\r\n            length: iEnd - iStart\r\n        };\r\n    },\r\n\r\n    /*\r\n    Changes the caret position of the text field to the given position.\r\n    \r\n    @param  eField  Reference to the field.\r\n    @param  iCaretPos   The new caret position.\r\n    */\r\n    setCaretPosition(eField, iCaretPos) {\r\n        try {\r\n            // IE Support\r\n            if (document.selection) {\r\n\r\n                // Set focus on the element\r\n                eField.focus();\r\n\r\n                // Create empty selection range\r\n                const oSel = document.selection.createRange();\r\n\r\n                // Move selection start and end to 0 position\r\n                oSel.moveStart('character', -eField.value.length);\r\n                oSel.moveEnd('character', -eField.value.length);\r\n\r\n                // Move selection start and end to desired position\r\n                oSel.moveStart('character', iCaretPos);\r\n                oSel.select();\r\n            } else if (((/text|password|search|tel|url/).test(eField.type) && eField.selectionStart) || eField.selectionStart === 0) { // Firefox support\r\n                eField.selectionStart = iCaretPos;\r\n                eField.selectionEnd = iCaretPos;\r\n                eField.focus();\r\n            }\r\n        } catch (e) {\r\n\r\n        }\r\n    },\r\n\r\n    /*\r\n    Gives the focus to the first focusable child element that can receive the\r\n    focus. Is a recursive method that loops through the DOM.\r\n    \r\n    @param  eElem    Reference to the DOM element.\r\n    @return First child element that can receive the focus.\r\n    */\r\n    getFirstFocusChild(eElem) {\r\n        const aElems = this.query(eElem, this.cFocusSelector, true);\r\n\r\n        for (let i = 0; i < aElems.length; i++) {\r\n            if (aElems[i].tabIndex >= 0 && aElems[i].type !== \"hidden\") {\r\n                return aElems[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    },\r\n\r\n    /*\r\n    This methods loops through the child elements of the DOM element and calls the \r\n    worker method for each child element. Using this method will reduce the amount \r\n    of code in the components and keep all checks on a single place. If the worker \r\n    method returns false the next children won't be processed any more.\r\n    \r\n    @param  eElem    Reference to the element.\r\n    @param  fWorker     Method to call for each child.\r\n    @param  oEnv        (optional) Environment object used when calling the worker.\r\n    @return False if worker stopped processing the children.\r\n    */\r\n    visit(eElem, fWorker, oEnv) {\r\n\r\n        //  Go into children\r\n        if (eElem.childNodes) {\r\n            for (let iChild = 0; iChild < eElem.childNodes.length; iChild++) {\r\n                if (eElem.childNodes[iChild].nodeType !== 3 && eElem.childNodes[iChild].nodeType !== 8) {\r\n                    if (fWorker.call(oEnv || this, eElem.childNodes[iChild]) === false) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    /*\r\n    Disables the textselection for the element.\r\n    \r\n    @param  eElem    Reference to DOM element.\r\n    */\r\n    disableTextSelection(eElem) {\r\n        // eElement.onselectstart = function() {\r\n        // return false;\r\n        // };\r\n        eElem.unselectable = \"on\";\r\n        eElem.style.MozUserSelect = \"none\";\r\n        eElem.style.webkitUserSelect = \"none\";\r\n    },\r\n\r\n    /*\r\n    Disables the textselection for the element.\r\n    \r\n    @param  eElem    Reference to DOM element.\r\n    */\r\n    enableTextSelection(eElem) {\r\n        // eElement.onselectstart = function() {\r\n        // return false;\r\n        // };\r\n        eElem.unselectable = \"off\";\r\n        eElem.style.MozUserSelect = \"text\";\r\n        eElem.style.webkitUserSelect = \"text\";\r\n    },\r\n\r\n    /*\r\n    The passed method will be called as soon as the browser has finished initializing the Document \r\n    Object Model (DOM) and is ready for manipulation. If the DOM was already initialized the method will \r\n    be called right away. The sample code below shows how to make sure that a piece of code is executed \r\n    after the DOM is ready.\r\n    \r\n    @code\r\n    df.dom.ready(function(){\r\n        //  Code executed after DOM initialization\r\n        document.getElementById(\"mydiv\").innerHTML = \"<b>Browser is finished!</b>\";\r\n    });\r\n    @code\r\n    \r\n    @param  fWorker     Function that will be executed after the DOM is ready.\r\n    @param  oEnv        Environment object used when calling the worker function.\r\n    \r\n    */\r\n    ready(fWorker, oEnv) {\r\n        function call() {\r\n            fWorker.call(oEnv);\r\n\r\n            //  Cleanup\r\n            if (window.addEventListener) { // W3C\r\n                window.removeEventListener(\"load\", call, false);\r\n            } else { // IE\r\n                window.detachEvent(\"onload\", call);\r\n            }\r\n        }\r\n\r\n        if (document.readyState === \"complete\") {\r\n            call();\r\n        } else {\r\n            //  Attach the listener\r\n            if (window.addEventListener) { // W3C\r\n                window.addEventListener(\"load\", call, false);\r\n            } else { // IE\r\n                window.attachEvent(\"onload\", call);\r\n            }\r\n        }\r\n    },\r\n\r\n    /* \r\n    This function converts a string of HTML into DOM elements. It creates a temporary div element of \r\n    which the innerHTML is set to let the browser parse the HTML. The outermost element is returned (the \r\n    first if there are multiple elements at root level).\r\n    \r\n    @return Wrapping DOM element.\r\n    */\r\n    create(sHtml) {\r\n        const eWrapper = document.createElement(\"div\");\r\n\r\n        eWrapper.innerHTML = (Array.isArray(sHtml) ? sHtml.join(\"\") : sHtml);\r\n\r\n        return eWrapper.firstChild;\r\n    },\r\n\r\n    /* \r\n    This function searches the DOM based on a selector query. The selector query is comparable to CSS \r\n    selectors. It searches inside the element passed as the first parameter. Depending on bOptMulti it \r\n    will return the first match or an array with all matches. It uses the querySelector API from the \r\n    browser.\r\n    \r\n    @param  eElem       The element to search.\r\n    @param  sSelect     The selector string.\r\n    @param  bOptMulti   (optional) If true an array will be returned)\r\n    \r\n    @return The first matched element or if bOptMulti is true an array with all matched elements.\r\n    */\r\n    query(eElem, sSelect, bOptMulti) {\r\n        if (!bOptMulti && eElem.querySelector) {\r\n            return eElem.querySelector(sSelect);\r\n        }\r\n        if (eElem.querySelectorAll) {\r\n            const aRes = eElem.querySelectorAll(sSelect);\r\n\r\n            if (bOptMulti) {\r\n                return aRes;\r\n            }\r\n            return (aRes.length > 0 ? aRes[0] : null);\r\n        }\r\n        /* Note: We could use Sizzle Selector library to support Internet Explorer 7 here\r\n        \r\n        var aRes = Sizzle(sSelect, eElem);\r\n        \r\n        if(bOptMulti){\r\n            return aRes;\r\n        }else{\r\n            return (aRes.length > 0 ? aRes[0] : null);\r\n        }*/\r\n        throw new df.Error(999, \"This browser doesn't support querySelectorAll\");\r\n    },\r\n\r\n    /* \r\n    Sets the translateY transformation on the passed element. Makes sure to use the right browser \r\n    specific prefix and supports a fallback to setting the top style. Note that the fallback requires \r\n    the element to be displayed using position absolute in order to work.\r\n    \r\n    @param  eElem   DOM Element.\r\n    @param  iY      Y offset in pixels.\r\n    @param  bTopFB  If true the CSS top will be set for unsupportive browsers.\r\n    @return True if succeeded.\r\n    */\r\n    translateY(eElem, iY, bTopFB) {\r\n        const sPre = gui.getTransformProp();\r\n\r\n        if (sPre) {\r\n            eElem.style[sPre] = 'translateY(' + iY + 'px)';\r\n\r\n            return true;\r\n        }\r\n        if (bTopFB) {\r\n            eElem.style.top = iY + 'px';\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n    /* \r\n    Sets the translateX transformation on the passed element. Makes sure to use the right browser \r\n    specific prefix and supports a fallback to setting the top style. Note that the fallback requires \r\n    the element to be displayed using position absolute in order to work.\r\n    \r\n    @param  eElem   DOM Element.\r\n    @param  iX      Y offset in pixels.\r\n    @param  bTopFB  If true the CSS top will be set for unsupportive browsers.\r\n    @return True if succeeded.\r\n    */\r\n    translateX(eElem, iX, bLeftFB) {\r\n        const sPre = gui.getTransformProp();\r\n\r\n        if (sPre) {\r\n            if (iX !== null) {\r\n                eElem.style[sPre] = 'translateX(' + iX + 'px)';\r\n            } else {\r\n                eElem.style[sPre] = '';\r\n            }\r\n\r\n            return true;\r\n        }\r\n        if (bLeftFB) {\r\n            if (iX !== null) {\r\n                eElem.style.left = iX + 'px';\r\n            } else {\r\n                eElem.style.left = '';\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n    /* \r\n    Helper function for performing a single transition. The passed transition is set on the DOM element \r\n    and removed once it is finished. One can also pass a function to be executed after the transition. \r\n    Use this function before making a change to the dom to animate that change and know when it is \r\n    finished.\r\n    \r\n    @param  eElem           DOM Element.\r\n    @param  sTransition     CSS transition string (like 'all 200ms').\r\n    @param  fFinish         Handler function called after animation.\r\n    @param  oEnv            Environment object to which this will point when the handler is called.\r\n    */\r\n    transition(eElem, sTransition, fFinish, oEnv) {\r\n        function transEnd(oEv) {\r\n            this.off(\"transitionend\", eElem, transEnd, this);\r\n            eElem.style.transition = \"\";\r\n\r\n            if (fFinish) {\r\n                fFinish.call(oEnv || this);\r\n            }\r\n        }\r\n\r\n        //  We can safely use transactionend since all browsers that support swiping support it.. :)\r\n        this.on(\"transitionend\", eElem, transEnd, this);\r\n        eElem.style.transition = sTransition;\r\n    },\r\n\r\n    /*\r\n    Encodes special HTML characters so the string can safely be send in an XML message or displayed as \r\n    source in the page.\r\n    \r\n    @param  sValue  String containing HTML code.\r\n    @return String containing the encoded HTML.\r\n    */\r\n    encodeHtml(sValue) {\r\n        return (sValue || \"\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n    },\r\n\r\n    /* \r\n    Encodes the quote inside attribute strings so that invalid values never break out of their \r\n    attribute.\r\n    \r\n    @param  sValue  String containing an attribute value in html.\r\n    @return String containing encoded attribute value.\r\n    */\r\n    encodeAttr(sValue) {\r\n        return (sValue || \"\").replace(/\\\"/g, '&quot;');\r\n    },\r\n\r\n    /* \r\n    Determines the current window width.\r\n    \r\n    @return Current window width in (virtual) pixels.\r\n     */\r\n    windowWidth() {\r\n        return Math.max(\r\n            (document.body && Math.max(\r\n                document.body.scrollWidth,\r\n                document.body.offsetWidth\r\n            )) || 0,\r\n            (document.documentElement && Math.max(\r\n                document.documentElement.scrollWidth,\r\n                document.documentElement.offsetWidth,\r\n                document.documentElement.clientWidth\r\n            )) || 0\r\n        );\r\n    },\r\n\r\n    /* \r\n    Determines the current window height.\r\n    \r\n    @return Current window height in (virtual) pixels.\r\n     */\r\n    windowHeight() {\r\n        return Math.max(\r\n            (document.body && Math.max(\r\n                document.body.scrollHeight,\r\n                document.body.offsetHeight\r\n            )) || 0,\r\n            (document.documentElement && Math.max(\r\n                document.documentElement.scrollHeight,\r\n                document.documentElement.offsetHeight,\r\n                document.documentElement.clientHeight\r\n            )) || 0\r\n        );\r\n    },\r\n\r\n    animFrame(fCallback, oEnv) {\r\n        if (window.requestAnimationFrame) {\r\n            window.requestAnimationFrame(function aniFrmCallback() {\r\n                fCallback.call(oEnv || this);\r\n            });\r\n        } else {\r\n            setTimeout(function aniFrmCallback() {\r\n                fCallback.call(oEnv || this);\r\n            }, 40);\r\n        }\r\n    },\r\n\r\n    /*\r\n    Returns the offsetHeight for a DOM element. The offsetHeight is the full height of the element \r\n    including borders margins & paddings. \r\n    \r\n    Note that this method includes the fraction and does not round like the offsetHeight property!\r\n    */\r\n    offsetHeight(eElem) {\r\n        return eElem?.getBoundingClientRect().height || 0;\r\n    },\r\n\r\n    /*\r\n    Returns the clientHeight for a DOM element. The clientHeight is the height of the element without \r\n    margin and border. The clientHeight does include the padding. \r\n    \r\n    Note that this method includes the fraction and does not round like the clientHeight property!\r\n    */\r\n    clientHeight(eElem) {\r\n        return this.offsetHeight(eElem) - ((eElem?.offsetHeight || 0) - (eElem?.clientHeight || 0));\r\n    },\r\n\r\n    /*\r\n    Returns the offsetWidth for a DOM element. The offsetWidth is the full width of the element \r\n    including borders margins & paddings. \r\n    \r\n    Note that this method includes the fraction and does not round like the offsetWidth property!\r\n    */\r\n    offsetWidth(eElem) {\r\n        return eElem?.getBoundingClientRect().width || 0;\r\n    },\r\n\r\n    /*\r\n    Returns the clientWidth for a DOM element. The clientWidth is the height of the element without \r\n    margin and border. The clientWidth does include the padding. \r\n    \r\n    Note that this method includes the fraction and does not round like the clientWidth property!\r\n    */\r\n    clientWidth(eElem) {\r\n        return this.offsetWidth(eElem) - ((eElem?.offsetWidth || 0) - (eElem?.clientWidth || 0));\r\n    },\r\n\r\n    /*\r\n    Updates the tabIndex of the element but takes the gui.restoreTabIndexes fake modality hack \r\n    into account. So it will only set the actual tabIndex directly if the tabIndex is not disabled by \r\n    the fake modality logic.\r\n    */\r\n    setTabIndex(eElem, iVal) {\r\n        if (eElem.hasAttribute(\"data-dfOrigTabIndex\") && parseInt(eElem.getAttribute(\"data-dfTabIndexCount\"), 10) > 0) {\r\n            eElem.setAttribute(\"data-dfOrigTabIndex\", iVal);\r\n        } else {\r\n            eElem.tabIndex = iVal;\r\n        }\r\n    }\r\n\r\n};\r\n\r\n//  Make sure that the autoInit function after the DOM is initialized (Which can be in the future but also can be right now)\r\ndom.ready(gui.initCSS, window);","/*\r\nName:\r\n    df.sys.json\r\nType:\r\n    Library (static object)\r\nRevisions:\r\n    2011/08/02  Refactored to df.sys.json. (HW, DAW)\r\n    2009/06/02  Created the initial version. (HW, DAE)\r\n*/\r\n\r\n\r\n/*\r\nLibrary that contains the functionality to serialize and parse JSON strings to \r\nJavaScript objects. Functions and properties starting with a double underscore \r\nare skipped. If the browser supports native JSON.stringify and JSON.parse \r\nmethods these are used (Like IE 8+ and FireFox 3.1+). For parsing the JSON the \r\nJSON.parse method is used. Dates are serialized into strings and parsed as \r\nstring.\r\n*/\r\nexport const json = {\r\n\r\n    /*\r\n    Deserializes a JSON string into a object structure. It uses the native \r\n    JSON.parse function if it is available. Otherwise it will perform a few checks \r\n    (to make sure the string is save for eval) and then use eval.\r\n    \r\n    @param  sString String with JSON.\r\n    @return Object structure.\r\n    */\r\n    parse(sString) {\r\n        if (typeof JSON === \"object\" && typeof JSON.parse === \"function\") {\r\n            return JSON.parse(sString);\r\n        }\r\n\r\n        throw new SyntaxError('This browser does not support JSON');\r\n    },\r\n\r\n    /*\r\n    Serializes JavaScript object structure into a JSON string. It uses the native \r\n    JSON.stringify function if it is available. Note that properties starting with \r\n    double underscores are skipped.\r\n    \r\n    @param  oObject Reference to the object to be serialized.\r\n    @return String with JSON.\r\n    */\r\n    stringify(oObject) {\r\n        // If native support is available we will use it\r\n        // FIX: except for Internet Explorer 8 which has a bug serializing \"\" to \"null\" if the value comes from the value property of an input DOM element\r\n        if (typeof JSON === \"object\" && typeof JSON.stringify === \"function\") {\r\n            // Call native JSON stringify function \r\n            // replacer function is given to make sure properties with \"__\" are skipped\r\n            return JSON.stringify(oObject, function (sKey, sValue) {\r\n                return (typeof sKey === \"string\" && sKey.substr(0, 2) === \"__\" ? undefined : sValue);\r\n            });\r\n        }\r\n        \r\n        throw new SyntaxError('This browser does not support JSON');\r\n    }\r\n\r\n};\r\n\r\n","/*\r\nName:\r\nsys\r\nType:\r\n    Library(object)\r\n\r\nRevisions:\r\n    2005/09/01  Created the initial version with a basic set of browser\r\n    independent functions. (HW, DAE)\r\n\r\n    2006/11/05  Restructured into dom, events, data, gui categories. (HW, DAE)\r\n\r\n    2007/12/14  Converted into 2.0 structure. It is now called sys and the\r\n    events functionallity is moved to a separate df.events version. (HW, DAE)\r\n\r\n*/\r\n/* global df */\r\n/*\r\nAn important part of the Visual DataFlex AJAX Library is the layer that is build\r\nbetween the browser and the engine. Its main goal is to straighten out the\r\ndifferences between the supported browsers. It contains a lot of functionality\r\nthat cover the various parts of client side web development.\r\n*/\r\n\r\nimport { json } from './sys/json.js';\r\nimport { vt } from './sys/vt.js';\r\nimport { gui } from './sys/gui.js';\r\nimport { dom } from './dom.js';\r\nimport { dev } from './sys/dev.js'\r\n\r\nexport const sys = {\r\n    json : json,\r\n    vt : vt,\r\n    gui : gui,\r\n    dev : dev,\r\n\r\n    /*\r\n    If true the browser is supposed to be safari or part of the safari family.\r\n    */\r\n    isSafari: dev.isSafari,\r\n    /*\r\n    True if the browser seems to be Google Chrome.\r\n    */\r\n    isChrome: dev.isChrome,\r\n    /*\r\n    True if the browser seems to be Opera.\r\n    */\r\n    isOpera: dev.isOpera,\r\n    /*\r\n    If true the browser is supposed to be part of the mozilla family (usually\r\n    FireFox).\r\n    */\r\n    isMoz: dev.isMoz,\r\n    /*\r\n    True if the browser seems to be Internet Explorer. Also true if we where not\r\n    able to detect the browser type properly (if browser unknown threat it as IE\r\n    policy).\r\n    */\r\n    isIE: dev.isIE,\r\n    /* \r\n    True if the browser seems to be Microsoft Edge.\r\n    */\r\n    isEdge: dev.isEdge,\r\n    /*\r\n    True if the WebKit layout engine is used (Safari & Chrome).\r\n    */\r\n    isWebkit: dev.isWebkit,\r\n\r\n    isMobile: dev.isMobile,\r\n    isIOS: dev.isIOS,\r\n\r\n    /*\r\n    Indicates the browser version.\r\n    */\r\n    iVersion: dev.iVersion,\r\n\r\n    /*\r\n    The reflection library contains functionality related to prototypes, objects\r\n    and functions. Some of this functionality is closely related to the Visual DataFlex\r\n    AJAX Library and might not work on objects from outside the library.\r\n    */\r\n    ref: {\r\n\r\n        /*\r\n        Determines the object type using \"typeof\" and for objects it tries to determine\r\n        the constructorname.\r\n        \r\n        @param  oObject     Reference to the object of which the type should be determined.\r\n        @return The type of the object (\"object\", \"function\", \"array\", \"undefined\", ..).\r\n        */\r\n        getType(oObject) {\r\n            let sType = typeof (oObject);\r\n\r\n            if (sType === \"object\") {\r\n                if (oObject === null || oObject === undefined) {\r\n                    sType = \"null\";\r\n                } else if (oObject.constructor === Array) {\r\n                    sType = \"array\";\r\n                } else if (oObject.constructor === Date) {\r\n                    sType = \"date\";\r\n                } else {\r\n                    sType = this.getConstructorName(oObject);\r\n                }\r\n            }\r\n\r\n            return sType;\r\n        },\r\n\r\n        /*\r\n        It tries to determine the name of the constructor of the object. If the\r\n        constructor is not found \"object\" is returned.\r\n        \r\n        @param  oObject     Reference to the object of which we want to determine the\r\n                constructor name.\r\n        @return String with the constructorname (\"object\" if not found).\r\n        */\r\n        getConstructorName(oObject) {\r\n            let sName = this.getMethodName(oObject.constructor);\r\n\r\n            if (sName === \"\") {\r\n                sName = \"object\";\r\n            }\r\n\r\n            return sName;\r\n        },\r\n\r\n        /*\r\n        Determines the name of the given function by converting the function its string\r\n        definition.\r\n        \r\n        @param  fFunction   Reference to the function.\r\n        @return Name of the function (\"unknownType\" if not able to determine).\r\n        */\r\n        getMethodName(fFunction) {\r\n\r\n            try {\r\n                const sString = fFunction.toString();\r\n                return sString.substring(sString.indexOf(\"function\") + 8, sString.indexOf('(')).replace(/ /g, '');\r\n            } catch (e) {\r\n                return \"\";\r\n            }\r\n        },\r\n\r\n        /*\r\n        Determines the global scope object. Within browsers this usually is the window\r\n        object.\r\n        \r\n        @return Reference to the global scope object.\r\n        */\r\n        getGlobalObj() {\r\n            return window;\r\n        },\r\n\r\n        /*\r\n        Finds the (nested) object property by a path string (like \"df.core.List\")\r\n        without using an eval. Always starts at the global object.\r\n        \r\n        @param  sPath   Path to the property (like \"df.core.List\").\r\n        @return The property (null if not found).\r\n        */\r\n        getNestedProp(sPath) {\r\n            let oProp;\r\n\r\n            //  Split into parts\r\n            const aParts = sPath.split(\".\");\r\n\r\n            //  We start our search at the global object\r\n            oProp = this.getGlobalObj();\r\n\r\n            //  Loop through parts and object properties\r\n            for (let iPart = 0; iPart < aParts.length; iPart++) {\r\n                if (typeof oProp === \"object\" && oProp !== null) {\r\n                    oProp = oProp[aParts[iPart]];\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return oProp;\r\n        },\r\n\r\n        /*\r\n        Sets the (nested) object property by a path string (like \"df.core.List\") without using eval. Always starts at the global object.\r\n        @param sPath    Path to the property (like \"df.core.List\").\r\n        @param oValue   The value to set.\r\n\r\n        @return  True if the property was set.\r\n        */\r\n        setNestedProp(sPath, oValue) {\r\n            let oProp;\r\n\r\n            //  Split into parts\r\n            const aParts = sPath.split(\".\");\r\n\r\n            //  We start our search at the global object\r\n            oProp = this.getGlobalObj();\r\n\r\n            //  Loop through parts and object properties\r\n            for (let iPart = 0; iPart < aParts.length - 1; iPart++) {\r\n                if (typeof oProp === \"object\" && oProp !== null) {\r\n                    oProp = oProp[aParts[iPart]];\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            oProp[aParts[aParts.length - 1]] = oValue;\r\n\r\n            return true;\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    The math library contains functionality to perform calculations.\r\n    */\r\n    math: {\r\n        /*\r\n        Fills out the given number with zero's until it has the required amount of digits.\r\n        \r\n        @param  iNum    Number to convert.\r\n        @param  iDigits Number of digits.\r\n        @return String with the number outfilled with zero's.\r\n        */\r\n        padZero(iNum, iDigits) {\r\n            let sResult = iNum.toString();\r\n\r\n            while (sResult.length < iDigits) {\r\n                sResult = \"0\" + sResult;\r\n            }\r\n\r\n            return sResult;\r\n        },\r\n\r\n        isNumeric(n) {\r\n            return !isNaN(parseFloat(n)) && isFinite(n);\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    Functionality for data conversions and other data related functions.\r\n    */\r\n    data: {\r\n\r\n        /*\r\n        Parses a string into a number using the correct thousands and decimal separator.\r\n        \r\n        @param  sVal            String containing the number to parse.\r\n        @param  sDecSep        The decimal separator used.\r\n        @param  sOptThousSepp   (optional) The thousands separator used.\r\n        @return Number.\r\n        \r\n        */\r\n        stringToNum(sVal, sDecSep, sOptThousSepp) {\r\n            return sVal && parseFloat(sVal.replace(sOptThousSepp || \"\", \"\").replace(sDecSep, \".\"));\r\n        },\r\n\r\n        /*\r\n        This method converts a numeric value to a string using the decimal separator that is configured.\r\n        \r\n        @param  nVal        The numeric value.\r\n        @param  sDecSep     The decimal separator used.\r\n        @param  iPrecision  Number of decimals.\r\n        @return The string with the number.\r\n        @private\r\n        */\r\n        numToString(nVal, sDecSep, iPrecision) {\r\n            let aVal, sVal;\r\n\r\n            //  Make sure that we have a number\r\n            nVal = nVal || 0.0;\r\n\r\n            //  Parse to string\r\n            sVal = nVal.toString().replace(\".\", sDecSep);\r\n\r\n            //  Format\r\n            if (iPrecision > 0) {\r\n                aVal = sVal.split(sDecSep);\r\n\r\n                if (aVal.length < 2) {\r\n                    aVal[1] = \"\";\r\n                }\r\n                aVal[1] = (aVal[1] + \"0000000000000000000\").substr(0, iPrecision);\r\n\r\n                sVal = aVal[0] + sDecSep + aVal[1];\r\n            }\r\n\r\n\r\n            return sVal;\r\n        },\r\n\r\n        /*\r\n        Applies the date mask on the date.\r\n        \r\n        @param  dValue          The date object.\r\n        @param  sMask           The mask string.\r\n        @param  sDateSeparator  Separator character that will be used in the date mask.\r\n        @return String with the masked data.\r\n        */\r\n        applyDateMask(dValue, sMask, sDateSeparator, sOptTimeSeparator) {\r\n            let bMinute = false;\r\n\r\n            return sMask.replace(/(m{1,4}|d{1,4}|yyyy|yy|\\/|hh|ss|fff|f|\\:)/gi, function (sValue, iPos) {\r\n\r\n                switch (sValue.toLowerCase()) {\r\n                    case \"m\":\r\n                        bMinute = true;\r\n                        return dValue.getMonth() + 1;\r\n                    case \"mm\":\r\n                        if (bMinute) {\r\n                            bMinute = false;\r\n                            return sys.math.padZero(dValue.getMinutes(), 2);\r\n                        }\r\n                        bMinute = true;\r\n                        return sys.math.padZero(dValue.getMonth() + 1, 2);\r\n                    case \"mmm\":\r\n                        bMinute = true;\r\n                        return sys.string.copyCase(df.lang.monthsShort[dValue.getMonth()], sValue);\r\n                    case \"mmmm\":\r\n                        bMinute = true;\r\n                        return sys.string.copyCase(df.lang.monthsLong[dValue.getMonth()], sValue);\r\n\r\n                    case \"d\":\r\n                        bMinute = false;\r\n                        return dValue.getDate();\r\n                    case \"dd\":\r\n                        bMinute = false;\r\n                        return sys.math.padZero(dValue.getDate(), 2);\r\n                    case \"ddd\":\r\n                        bMinute = false;\r\n                        return sys.string.copyCase(df.lang.daysShort[dValue.getDay()], sValue);\r\n                    case \"dddd\":\r\n                        bMinute = false;\r\n                        return sys.string.copyCase(df.lang.daysLong[dValue.getDay()], sValue);\r\n\r\n                    case \"yy\":\r\n                        bMinute = false;\r\n                        return sys.math.padZero(dValue.getFullYear() % 100, 2);\r\n                    case \"yyyy\":\r\n                        bMinute = false;\r\n                        return sys.math.padZero(dValue.getFullYear(), 4);\r\n\r\n                    case \"/\":\r\n                        bMinute = false;\r\n                        return sDateSeparator;\r\n\r\n                    case \"hh\":\r\n                        bMinute = true;\r\n                        return sys.math.padZero(dValue.getHours(), 2);\r\n                    case \"ss\":\r\n                        bMinute = true;\r\n                        return sys.math.padZero(dValue.getSeconds(), 2);\r\n                    case \"f\":\r\n                        bMinute = true;\r\n                        return dValue.getMilliseconds();\r\n                    case \"fff\":\r\n                        bMinute = true;\r\n                        return sys.math.padZero(dValue.getMilliseconds(), 3);\r\n                    case \":\":\r\n                        bMinute = true;\r\n                        return sOptTimeSeparator || \":\";\r\n                }\r\n\r\n                return sValue;\r\n            });\r\n        },\r\n\r\n        /*\r\n        This method applies a numeric mask to a number. \r\n        \r\n        @param  nValue      Value as a number.\r\n        @param  sMask       The mask string.\r\n        @param  sDecSep     The decimal separator to use.\r\n        @param  sThousSep   The thousands separator to use.\r\n        @param  sCurSym     The currency symbol to use.\r\n        @return The string containing the masked number.\r\n        */\r\n        applyNumMask(nValue, sMask, sDecSep, sThousSep, sCurSym) {\r\n            let aParts, aResult = [], sChar, bEscape, iChar, iNumChar, iCount, sBefore, sDecimals,\r\n                sMaskBefore, sMaskDecimals = null, sValue, iMaskBefore = 0, iMaskDecimals = 0,\r\n                bThousands = false, bBefore = true;\r\n\r\n            // Replace &curren;\r\n            sMask = sMask.replace(/&curren;/g, sCurSym);\r\n\r\n            //  Zero suppress (indicated by the \"Z\" as first mask character)\r\n            if (sMask.charAt(0) === \"Z\") {\r\n                if (nValue === 0.0) {\r\n                    return \"\";\r\n                }\r\n                sMask = sMask.substr(1);\r\n            }\r\n\r\n            //  Determine which mask to use :D\r\n            aParts = sMask.split(\";\");\r\n            if (nValue < 0.0) {\r\n                if (aParts.length > 1) {\r\n                    sMask = aParts[1];\r\n                } else {\r\n                    sMask = \"-\" + aParts[0];\r\n                }\r\n            } else {\r\n                sMask = aParts[0];\r\n            }\r\n\r\n            //  Split into before and and after decimal separator\r\n            aParts = sMask.split(\".\");\r\n            sMaskBefore = aParts[0];\r\n            if (aParts.length > 1) {\r\n                sMaskDecimals = aParts[1];\r\n            }\r\n\r\n\r\n            //  Pre process mask\r\n            for (iChar = 0; iChar < sMask.length; iChar++) {\r\n                switch (sMask.charAt(iChar)) {\r\n                    case \"\\\\\":\r\n                        iChar++;\r\n                        break;\r\n                    case \"#\":\r\n                    case \"0\":\r\n                        if (bBefore) {\r\n                            if (iMaskBefore >= 0) {\r\n                                iMaskBefore++;\r\n                            }\r\n                        } else {\r\n                            if (iMaskDecimals >= 0) {\r\n                                iMaskDecimals++;\r\n                            }\r\n                        }\r\n                        break;\r\n                    case \"*\":\r\n                        if (bBefore) {\r\n                            iMaskBefore = -1;\r\n                        } else {\r\n                            iMaskDecimals = -1;\r\n                        }\r\n                        break;\r\n                    case \",\":\r\n                        bThousands = true;\r\n                        break;\r\n                    case \".\":\r\n                        bBefore = false;\r\n                        break;\r\n                }\r\n            }\r\n\r\n            //  Convert number into string with number before and numbers after\r\n            if (iMaskDecimals >= 0) {\r\n                nValue = nValue.toFixed(iMaskDecimals);\r\n            }\r\n            sValue = (nValue === 0.0 ? \"\" : String(nValue));\r\n            aParts = sValue.split(\".\");\r\n            sBefore = aParts[0];\r\n            if (aParts.length > 1) {\r\n                sDecimals = aParts[1];\r\n            } else {\r\n                sDecimals = \"\";\r\n            }\r\n            if (sBefore.charAt(0) === \"-\") {\r\n                sBefore = sBefore.substr(1);\r\n            }\r\n\r\n            //  BEFORE DECIMAL SEPARATOR\r\n            iChar = sMaskBefore.length - 1;\r\n            iNumChar = sBefore.length - 1;\r\n            iCount = 0;\r\n            while (iChar >= 0) {\r\n                sChar = sMaskBefore.charAt(iChar);\r\n                bEscape = (iChar > 0 && sMaskBefore.charAt(iChar - 1) === \"\\\\\");\r\n\r\n                if (!bEscape && (sChar === \"#\" || sChar === \"*\" || sChar === \"0\")) {\r\n                    while (iNumChar >= 0 || sChar === \"0\") {\r\n                        //  Append thousands separator if needed\r\n                        if (iCount >= 3) {\r\n                            iCount = 0;\r\n                            if (bThousands) {\r\n                                aResult.unshift(sThousSep);\r\n                            }\r\n                        }\r\n\r\n                        //  Append number\r\n                        aResult.unshift((iNumChar >= 0 ? sBefore.charAt(iNumChar) : \"0\"));\r\n                        iNumChar--;\r\n                        iCount++;\r\n\r\n                        //  Break out for non repeative characters\r\n                        if (sChar === \"#\" || sChar === \"0\") {\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // if(sChar === \"$\" && !bEscape){\r\n                    // sChar = sCurSym;\r\n                    // }\r\n                    if ((sChar !== \",\" && sChar !== \"\\\\\") || bEscape) {\r\n                        aResult.unshift(sChar);\r\n                    }\r\n                }\r\n                iChar--;\r\n            }\r\n\r\n            //  AFTER DECIMAL SEPARATOR\r\n            if (sMaskDecimals !== null) {\r\n\r\n                let aAfter = [];\r\n\r\n                iNumChar = 0;\r\n                for (iChar = 0; iChar < sMaskDecimals.length; iChar++) {\r\n                    sChar = sMaskDecimals.charAt(iChar);\r\n                    bEscape = (iChar > 0 && sMaskBefore.charAt(iChar - 1) === \"\\\\\");\r\n\r\n\r\n                    if (!bEscape && (sChar === \"#\" || sChar === \"*\" || sChar === \"0\")) {\r\n                        while (iNumChar < sDecimals.length || sChar === \"0\") {\r\n                            //  Append number\r\n                            aAfter.push((iNumChar >= 0 ? sDecimals.charAt(iNumChar) : \"0\"));\r\n                            iNumChar++;\r\n\r\n                            //  Break out for non repeative characters\r\n                            if (sChar === \"#\" || sChar === \"0\") {\r\n                                break;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        // if(sChar === \"$\" && !bEscape){\r\n                        // sChar = sCurSym;\r\n                        // }\r\n                        if (sChar !== \"\\\\\" || bEscape) {\r\n                            aAfter.push(sChar);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (aAfter.length) {\r\n                    aResult.push(sDecSep, aAfter.join(\"\"));\r\n                }\r\n            }\r\n\r\n            return aResult.join(\"\");\r\n        },\r\n\r\n        /*\r\n        Applies the windows mask the to the value by adding the mask characters. If \r\n        the value doesn't matches the mask the value isn't completely displayed.\r\n        \r\n        Params:\r\n            sValue  Value to apply the mask on.\r\n        Returns:\r\n            Masked value.\r\n        */\r\n        applyWinMask(sValue, sMask) {\r\n            var iChar = 0, iValChar = 0, bFound;\r\n            const aResult = [];\r\n\r\n            if (sValue === \"\") {\r\n                return \"\";\r\n            }\r\n            if (sMask === \"\") {\r\n                return sValue;\r\n            }\r\n\r\n            while (iChar < sMask.length) {\r\n                const sChar = sMask.charAt(iChar);\r\n\r\n                if (sChar === \"\\\\\" && sMask.length > (iChar + 1)) {\r\n                    aResult.push(sMask.charAt(iChar + 1));\r\n                } else {\r\n                    if (sChar === \"#\" || sChar === \"@\" || sChar === \"!\" || sChar === \"*\") {\r\n                        bFound = false;\r\n                        while (iValChar < sValue.length && !bFound) {\r\n                            if (this.acceptWinMaskChar(sValue.charAt(iValChar), sChar)) {\r\n                                aResult.push(sValue.charAt(iValChar));\r\n                                bFound = true;\r\n                            }\r\n                            iValChar++;\r\n                        }\r\n                        if (!bFound) {\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        //  Append mask display character\r\n                        aResult.push(sChar);\r\n                    }\r\n                }\r\n                iChar++;\r\n            }\r\n\r\n            return aResult.join(\"\");\r\n        },\r\n\r\n        /*\r\n        Checks if the given character is allowed at the given position for windows \r\n        masks.\r\n        \r\n        Params:\r\n            sChar   Character to check.\r\n            iPos    Position to check. \r\n        Returns:\r\n            True if the character is allowed at the given position.\r\n        \r\n        @private\r\n        */\r\n        acceptWinMaskChar(sValChar, sChar) {\r\n            return ((sChar === \"#\" && sValChar.match(/[0-9]/)) ||\r\n                (sChar === \"@\" && sValChar.match(/[a-zA-Z]/)) ||\r\n                (sChar === \"!\" && sValChar.match(/[^a-zA-Z0-9]/)) ||\r\n                sChar === \"*\");\r\n        },\r\n\r\n        /*\r\n        Parses a date or datetime string into a date object.\r\n        \r\n        @param  sValue          String date (that confirms the format).\r\n        @param  sFormat         Date format (basic date format).\r\n        @return Date object representing the date (returns null if no value given).\r\n        */\r\n        stringToDate(sValue, sFormat) {\r\n            let bMinute = false, iDate = 0, iMonth = 0, iYear = 0, iHour = 0, iSecond = 0, iMinute = 0, iFraction = 0, dResult;\r\n            const dToday = new Date();\r\n\r\n            //  Empty string return null.\r\n            if (sValue.trim() === \"\") {\r\n                return null;\r\n            }\r\n\r\n            //  Parse the values into an array\r\n            const aValues = sValue.split(/[^0-9]+/gi);\r\n\r\n            //  Parse the format into an array\r\n            const aFormat = sFormat.split(/[^mdyhmsf]+/gi);\r\n\r\n            //  Loop over values and put into the right variable\r\n            for (let i = 0; i < aValues.length; i++) {\r\n                const sV = aValues[i];\r\n                switch (aFormat[i]) {\r\n                    case \"d\":\r\n                    case \"dd\":\r\n                        iDate = parseInt(sV, 10);\r\n                        bMinute = false;\r\n                        break;\r\n                    case \"m\":\r\n                        iMonth = parseInt(sV, 10);\r\n                        bMinute = true;\r\n                        break;\r\n                    case \"mm\":\r\n                        if (bMinute) {\r\n                            iMinute = parseInt(sV, 10);\r\n                        } else {\r\n                            iMonth = parseInt(sV, 10);\r\n                        }\r\n                        break;\r\n                    case \"yy\":\r\n                    case \"yyyy\":\r\n                        iYear = parseInt(sV, 10);\r\n                        if (sV.length === 2) {\r\n                            iYear = (iYear > 50 ? iYear + 1900 : iYear + 2000);\r\n                        } else if (sV.length === 0) {\r\n                            iYear = dToday.getFullYear();\r\n                        }\r\n                        bMinute = false;\r\n                        break;\r\n                    case \"hh\":\r\n                        iHour = parseInt(sV, 10);\r\n                        bMinute = true;\r\n                        break;\r\n                    case \"ss\":\r\n                        iSecond = parseInt(sV, 10);\r\n                        bMinute = true;\r\n                        break;\r\n                    case \"f\":\r\n                    case \"fff\":\r\n                        iFraction = parseInt(sV, 10);\r\n                        break;\r\n                }\r\n            }\r\n\r\n            //  Validate values\r\n            if (!iYear) {\r\n                iYear = dToday.getFullYear();\r\n            } else {\r\n                iYear = (iYear > 0 ? (iYear < 9999 ? iYear : 9999) : 0);\r\n            }\r\n            if (!iMonth) {\r\n                iMonth = dToday.getMonth();\r\n            } else {\r\n                iMonth = (iMonth > 0 ? (iMonth <= 12 ? iMonth - 1 : 11) : 0);\r\n            }\r\n            if (!iDate) {\r\n                iDate = dToday.getDate();\r\n            } else {\r\n                iDate = (iDate > 0 ? (iDate <= 32 ? iDate : 31) : 1);\r\n            }\r\n\r\n            iHour = (iHour > 0 ? (iHour <= 23 ? iHour : (iHour === 24 ? 0 : 23)) : 0);\r\n            iMinute = (iMinute > 0 ? (iMinute < 60 ? iMinute : 59) : 0);\r\n            iSecond = (iSecond > 0 ? (iSecond < 60 ? iSecond : 59) : 0);\r\n            iFraction = (iFraction > 0 ? (iFraction < 999 ? iFraction : 999) : 0);\r\n\r\n            //  Set the determined values to the new data object, decrement if to high\r\n            dResult = new Date(iYear, iMonth, iDate, iHour, iMinute, iSecond, iFraction);\r\n            while (dResult.getMonth() !== iMonth) {\r\n                iDate--;\r\n                dResult = new Date(iYear, iMonth, iDate, iHour, iMinute, iSecond, iFraction);\r\n            }\r\n\r\n            return dResult;\r\n        },\r\n\r\n        /*\r\n        Generates a string for the given date using the given format.\r\n        \r\n        @param  dValue      Data object.\r\n        @param  sFormat     Date format (basic date format).\r\n        @return String representing the given date.\r\n        */\r\n        dateToString(dValue, sFormat, sDateSeparator) {\r\n            return this.applyDateMask(dValue, sFormat, sDateSeparator || \"/\");\r\n        },\r\n\r\n        /*\r\n        Determines the week number of the given date object.\r\n        \r\n        @param  dDate   Date object.\r\n        @return The week number.\r\n        */\r\n        dateToWeek(dDate) {\r\n            const date = new Date(dDate.getTime());\r\n\r\n            date.setHours(0, 0, 0, 0);\r\n            // Thursday in current week decides the year.\r\n            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);\r\n            // January 4 is always in week 1.\r\n            const week1 = new Date(date.getFullYear(), 0, 4);\r\n            // Adjust to Thursday in week 1 and count number of weeks from date to week1.\r\n            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);\r\n        },\r\n\r\n        /*\r\n        Loops through the array and removes all items that match the given object.\r\n        \r\n        @param  aArray  Reference to the array.\r\n        @param  oObj    Object reference or value to remove.\r\n        */\r\n        removeFromArray(aArray, oObj) {\r\n\r\n            for (let i = 0; i < aArray.length; i++) {\r\n                if (aArray[i] === oObj) {\r\n                    aArray.splice(i, 1);\r\n                }\r\n            }\r\n        },\r\n\r\n        /*\r\n        Expression used by the format method.\r\n        \r\n        @private\r\n        */\r\n        formatRegExp: /\\{\\{([0-9a-zA-Z]+)\\}\\}/gi,\r\n        /*\r\n        Formats a string based on a past object or array. Markers {{prop}} will be replaced with properties \r\n        from the passed object or array. \r\n        \r\n        @code\r\n        sStr = sys.data.format('Hi {{name}}!', { name : 'John' }); // sStr will contain 'Hi John!'\r\n        sStr = sys.data.format('The {{0}} and {{1}}!', [ 'first', 'second' ]); // sStr will contain 'The first and second'\r\n        @code\r\n        \r\n        @param  sStr    String containing markers to replace.\r\n        @param  oReps   Object or array containing properties to replace markers with.\r\n        @return Formatted string.\r\n        */\r\n        format(sStr, oReps) {\r\n            const reps = oReps || {};\r\n\r\n\r\n            return sStr.replace(this.formatRegExp, function (str, p1, offset, s) {\r\n                if (reps.hasOwnProperty(p1)) {\r\n                    return reps[p1];\r\n                }\r\n                return str;\r\n            });\r\n        },\r\n\r\n        /*\r\n        Properly formats a data size in the appropriate unit (like 131 kB or 15.4 MB or 900 GB).\r\n        \r\n        @param  iBytes      The data size in bytes.\r\n        @return String containing the formatted size.\r\n        */\r\n        markupDataSize(iBytes) {\r\n            let nVal;\r\n\r\n            if (iBytes < 1024) {\r\n                return iBytes + \" B\";\r\n            }\r\n\r\n            //  kilobytes\r\n            nVal = iBytes / 1024;\r\n            if (nVal < 2048) {\r\n                return Math.round(nVal) + \" kB\";\r\n            }\r\n\r\n            //   megabytes\r\n            nVal = nVal / 1024;\r\n            if (nVal < 2048) {\r\n                if (nVal < 100) {\r\n                    return ((Math.round(nVal) * 10) / 10) + \" MB\";\r\n                }\r\n                return Math.round(nVal) + \" MB\";\r\n            }\r\n\r\n            //  gigabytes\r\n            nVal = nVal / 1024;\r\n            if (nVal < 2048) {\r\n                if (nVal < 100) {\r\n                    return ((Math.round(nVal) * 10) / 10) + \" GB\";\r\n                }\r\n                return Math.round(nVal) + \" GB\";\r\n            }\r\n\r\n            //  terabyte\r\n            nVal = nVal / 1024;\r\n            if (nVal < 2048) {\r\n                if (nVal < 100) {\r\n                    return ((Math.round(nVal) * 10) / 10) + \" TB\";\r\n                }\r\n                return Math.round(nVal) + \" TB\";\r\n            }\r\n\r\n            //  petabyte\r\n            nVal = nVal / 1024;\r\n            if (nVal < 100) {\r\n                return ((Math.round(nVal) * 10) / 10) + \" PB\";\r\n            }\r\n            return Math.round(nVal) + \" PB\";\r\n\r\n        },\r\n\r\n        /* \r\n        Escapes a string for safe usage within a regular expression.\r\n        \r\n        @param  sStr    The string to escape.\r\n        @return Escaped string.\r\n        */\r\n        escapeRegExp(sStr) {\r\n            return sStr.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\r\n        },\r\n\r\n        /*\r\n        Comparison function used by the sortData function that compares text columns.\r\n        \r\n        @param  sVal1   First string value.\r\n        @param  sVal2   Second string value.\r\n        @return Negative number if sVal1 < sVal2, positive for sVal1 > sVal2 and 0 when equal.\r\n        \r\n        @private\r\n        */\r\n        compareText(sVal1, sVal2) {\r\n            return sVal1.localeCompare(sVal2);\r\n        },\r\n        compareRevText(sVal1, sVal2) {\r\n            return -(sVal1.localeCompare(sVal2));\r\n        },\r\n\r\n\r\n        /*\r\n        Comparison function used by the sortData function that compares numeric columns.\r\n        \r\n        @param  sVal1   First string value.\r\n        @param  sVal2   Second string value.\r\n        @return -1 if sVal1 < sVal2, 1 if sVal1 > sVal2 and 0 when equal.\r\n        \r\n        @private\r\n        */\r\n        compareBCD(sVal1, sVal2) {\r\n            return parseFloat(sVal1) - parseFloat(sVal2);\r\n        },\r\n        compareRevBCD(sVal1, sVal2) {\r\n            return -(parseFloat(sVal1) - parseFloat(sVal2));\r\n        },\r\n\r\n\r\n        /*\r\n        Comparison function used by the sortData function that compares date columns.\r\n        \r\n        @param  sVal1   First string value.\r\n        @param  sVal2   Second string value.\r\n        @return -1 if sVal1 < sVal2, 1 if sVal1 >= sVal2.\r\n        \r\n        @private\r\n        */\r\n        compareDate(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"yyyy/mm/dd\", \"-\") < sys.data.stringToDate(sVal2, \"yyyy/mm/dd\", \"-\") ? -1 : 1;\r\n        },\r\n        compareRevDate(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"yyyy/mm/dd\", \"-\") < sys.data.stringToDate(sVal2, \"yyyy/mm/dd\", \"-\") ? 1 : -1;\r\n        },\r\n\r\n\r\n\r\n        /*\r\n        Comparison function used by the sortData function that compares date columns.\r\n        \r\n        @param  sVal1   First string value.\r\n        @param  sVal2   Second string value.\r\n        @return -1 if sVal1 < sVal2, 1 if sVal1 >= sVal2.\r\n        \r\n        @private\r\n        */\r\n        compareDateTime(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\") < sys.data.stringToDate(sVal2, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\") ? -1 : 1;\r\n        },\r\n        compareRevDateTime(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\") < sys.data.stringToDate(sVal2, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\") ? 1 : -1;\r\n        },\r\n\r\n\r\n\r\n        /*\r\n        Comparison function used by the sortData function that compares date columns.\r\n        \r\n        @param  sVal1   First string value.\r\n        @param  sVal2   Second string value.\r\n        @return -1 if sVal1 < sVal2, 1 if sVal1 >= sVal2.\r\n        \r\n        @private\r\n        */\r\n        compareTime(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"hh:mm:ss\", \"-\") < sys.data.stringToDate(sVal2, \"hh:mm:ss\", \"-\") ? -1 : 1;\r\n        },\r\n        compareRevTime(sVal1, sVal2) {\r\n            if (sVal1 == sVal2) return 0;\r\n            return sys.data.stringToDate(sVal1, \"hh:mm:ss\", \"-\") < sys.data.stringToDate(sVal2, \"hh:mm:ss\", \"-\") ? 1 : -1;\r\n        },\r\n\r\n\r\n        /* \r\n        Returns the right comparison function based on the passed data type (ciTypeBCD, ciTypeDate, ..).\r\n        \r\n        @param  eDataType   Integer indicating the data type.\r\n        @return Function that properly compares both type for usage within sorting algoritms (can be passed \r\n                to Array.sort).\r\n        */\r\n        compareFunction(eDataType, bRev) {\r\n            switch (eDataType) {\r\n                case df.ciTypeBCD:\r\n                    return (bRev ? this.compareRevBCD : this.compareBCD);\r\n                case df.ciTypeDate:\r\n                    return (bRev ? this.compareRevDate : this.compareDate);\r\n                case df.ciTypeDateTime:\r\n                    return (bRev ? this.compareRevDateTime : this.compareDateTime);\r\n                case df.ciTypeTime:\r\n                    return (bRev ? this.compareRevTime : this.compareTime);\r\n                default:\r\n                    return (bRev ? this.compareRevText : this.compareText);\r\n            }\r\n        },\r\n\r\n        /*\r\n        This method determines the type specific value with a new value which is usually received from the \r\n        server. The value is supplied in the 'server format' and is parsed into the private type specific \r\n        value.\r\n        \r\n        @param  sVal     The new value provided in the 'server format'.\r\n        @param eDataType The datatype that sVal needs to be converted to.\r\n        @return The type specific value (date object or number).\r\n        @private\r\n        */\r\n        serverToType(sVal, eDataType) {\r\n            let tVal = sVal;\r\n\r\n            if (eDataType === df.ciTypeBCD) {\r\n                tVal = sys.data.stringToNum(sVal, \".\");\r\n            } else if (eDataType === df.ciTypeDate) {\r\n                tVal = sys.data.stringToDate(sVal, \"yyyy/mm/dd\", \"-\");\r\n            } else if (eDataType === df.ciTypeDateTime) {\r\n                tVal = sys.data.stringToDate(sVal, \"yyyy/mm/ddThh:mm:ss.fff\");\r\n            } else if (eDataType === df.ciTypeTime) {\r\n                tVal = sys.data.stringToDate(sVal, \"hh:mm:ss\");\r\n            }\r\n\r\n            return tVal;\r\n        },\r\n\r\n        /*\r\n        This method converts a type specific value to a display value.\r\n        \r\n        @param  tVal        Value in type specific format (number or date object).\r\n        @param  eDataType   Indicates the type to convert the value to.\r\n        @param  oWebApp     Indicates the webapp context for fetching locale.\r\n        @param  bInputMask  Indicates whether the applied mask should be the one used in edit/input mode (focus).\r\n        @param  sMask       Indicates the mask to apply to the value.\r\n        @param  iPrecision  Indicates the precision of double (e.g. 1.234) if no mask is applied.\r\n        \r\n        @return String with the display value.\r\n        */\r\n        typeToDisplay(tVal, eDataType, oWebApp, bInputMask, sMask, iPrecision) {\r\n            let sVal = tVal;\r\n\r\n            if (!bInputMask && sMask && eDataType !== df.ciTypeText) {    //  If the field doesn't have the focus we need to apply a mask\r\n                if (eDataType === df.ciTypeDate || eDataType === df.ciTypeDateTime || eDataType === df.ciTypeTime) { // Date mask\r\n                    sVal = (tVal && sys.data.applyDateMask(tVal, sMask, oWebApp.psDateSeparator, oWebApp.psTimeSeparator)) || \"\";\r\n                } else if (eDataType === df.ciTypeBCD) { // Numeric mask\r\n                    sVal = (tVal !== null && sys.data.applyNumMask(tVal || 0.0, sMask, oWebApp.psDecimalSeparator, oWebApp.psThousandsSeparator, oWebApp.psCurrencySymbol)) || \"\";\r\n                }\r\n            } else if (sMask && eDataType === df.ciTypeText) {  //  Window mask\r\n                sVal = sys.data.applyWinMask(sVal, sMask);\r\n            } else {  //  No mask\r\n                if (tVal !== \"\") {    // Leave blank value alone\r\n                    if (eDataType === df.ciTypeBCD) {   //  Plain number\r\n                        sVal = (tVal !== null && sys.data.numToString(tVal, oWebApp.psDecimalSeparator, iPrecision));\r\n                    } else if (eDataType === df.ciTypeDate) {   //  Plain date\r\n                        sVal = (tVal && sys.data.dateToString(tVal, oWebApp.psDateFormat, oWebApp.psDateSeparator, oWebApp.psTimeSeparator)) || \"\";\r\n                    } else if (eDataType === df.ciTypeDateTime) {   //  Plain date time\r\n                        sVal = (tVal && sys.data.dateToString(tVal, oWebApp.psDateTimeFormat, oWebApp.psDateSeparator, oWebApp.psTimeSeparator)) || \"\";\r\n                    } else if (eDataType === df.ciTypeTime) {   //  Plain time\r\n                        sVal = (tVal && sys.data.dateToString(tVal, oWebApp.psTimeFormat, oWebApp.psDateSeparator, oWebApp.psTimeSeparator)) || \"\";\r\n                    }\r\n                }\r\n            }\r\n\r\n            return sVal;\r\n        }\r\n\r\n    },\r\n\r\n    /*\r\n    Functions that ease the access of cookies.\r\n    */\r\n    cookie: {\r\n\r\n        /*\r\n        Places a cookie.\r\n        \r\n        @param  sVar            Name of cookie variable.\r\n        @param  sValue            Value of cookie variable.\r\n        @param  iExpires        Determines when the cookie expires in hours from right now.\r\n        @param  sOptPath        Optional path for which the cookie should be stored. Use '/' for the entire \r\n                                domain.\r\n        */\r\n        set(sVar, sValue, iExpires, sOptPath) {\r\n            const date = new Date();\r\n            let sParams = \"\";\r\n\r\n            if (iExpires) {\r\n                date.setHours(date.getHours() + iExpires);\r\n                sParams += \"; expires=\" + date.toGMTString();\r\n            }\r\n\r\n            if (sOptPath) {\r\n                sParams += \"; path=\" + sOptPath;\r\n            }\r\n\r\n            document.cookie = sVar + \"=\" + sValue + sParams;\r\n        },\r\n\r\n        /*\r\n        Removes cookie by expiring.\r\n        \r\n        @param  sVar    Name of cookie variable.\r\n        */\r\n        del(sVar) {\r\n            const date = new Date();\r\n\r\n            date.setTime(date.getTime() - 1);\r\n\r\n            document.cookie = sVar + \"=; expires=\" + date.toGMTString();\r\n        },\r\n\r\n        /*\r\n        Fetches cookie value.\r\n        \r\n        @param  sVar        Name of cookie variable.\r\n        @param  sDefault    Variable to return when not found.\r\n        @return Value of the cookie variable (sDefault if not found).\r\n        */\r\n        get(sVar, sDefault) {\r\n            let sResult = null;\r\n\r\n            if (document.cookie) {\r\n                const aVars = document.cookie.split(';');\r\n\r\n                for (let iVar = 0; iVar < aVars.length && sResult === null; iVar++) {\r\n                    const aVar = aVars[iVar].split('=');\r\n\r\n                    if (aVar.length > 1) {\r\n                        if (aVar[0].trim() === sVar.trim()) {\r\n                            sResult = aVar[1];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (sResult !== null) {\r\n                return sResult;\r\n            }\r\n            return sDefault;\r\n        }\r\n\r\n\r\n    },\r\n\r\n\r\n\r\n    /*\r\n    Library object that contains several string functions that seem to be missing\r\n    the in the ECMAScript standard.\r\n    */\r\n    string: {\r\n\r\n        /*\r\n        Removes spaces before and after the given string.\r\n        \r\n        @param  sString        String to trim.\r\n        @return Trimmed string.\r\n        @deprecated\r\n        */\r\n        trim(sString) {\r\n            return sString.trim();\r\n        },\r\n\r\n        /*\r\n        Removes spaces before the given string.\r\n        \r\n        @param  sString    String to trim.\r\n        @return Trimmed string.\r\n        */\r\n        ltrim(sString) {\r\n            return sString.replace(/^\\s+/, \"\");\r\n        },\r\n\r\n        /*\r\n        Removes spaces after the given string.\r\n        \r\n        @param  sString    String to trim.\r\n        @return Trimmed string.\r\n        */\r\n        rtrim(sString) {\r\n            return sString.replace(/\\s+$/, \"\");\r\n        },\r\n\r\n        /*\r\n        Modifies the casing of the value string according to the sample string.\r\n        \r\n        @param  sValue  String of which the casing is adjusted.\r\n        @param  sSample String determining the casing.\r\n        @return String with the modified casing.\r\n        */\r\n        copyCase(sValue, sSample) {\r\n            let sResult = \"\";\r\n\r\n            for (let iChar = 0; iChar < sValue.length; iChar++) {\r\n                const bUpper = (iChar < sSample.length ? sSample.charAt(iChar) === sSample.charAt(iChar).toUpperCase() : bUpper);\r\n\r\n                sResult += (bUpper ? sValue.charAt(iChar).toUpperCase() : sValue.charAt(iChar).toLowerCase());\r\n            }\r\n\r\n            return sResult;\r\n        },\r\n    },\r\n\r\n    /* \r\n    Determines if the HTML5 input type is supported by creating a test DOM element. It caches the \r\n    responses to keep the performance high on multiple requests.\r\n    \r\n    @param  sType   The HTML5 input type (\"date\", \"number\", \"email\").\r\n    */\r\n    supportHtml5Input: (function () {\r\n        const oCache = {};\r\n\r\n        return function test(sType) {\r\n            let eElem;\r\n\r\n            if (typeof oCache[sType] === \"boolean\") {\r\n                return oCache[sType];\r\n            }\r\n            eElem = document.createElement(\"input\");\r\n            eElem.setAttribute(\"type\", sType);\r\n\r\n            oCache[sType] = (eElem.type === sType);\r\n            return oCache[sType];\r\n        };\r\n    }()),\r\n\r\n   \r\n\r\n};\r\n\r\n\r\n\r\n\r\n//  - - - - Add missing JavaScript features for older browsers - - - - \r\n\r\n// <=IE11 Array.find\r\nif (!Array.prototype.find) {\r\n    Array.prototype.find = function (callback) {\r\n        if (this === null) {\r\n            throw new TypeError('Array.prototype.find called on null or undefined');\r\n        } else if (typeof callback !== 'function') {\r\n            throw new TypeError('callback must be a function');\r\n        }\r\n        const list = Object(this);\r\n        // Makes sures is always has an positive integer as length.\r\n        const length = list.length >>> 0;\r\n        const thisArg = arguments[1];\r\n        for (let i = 0; i < length; i++) {\r\n            const element = list[i];\r\n            if (callback.call(thisArg, element, i, list)) {\r\n                return element;\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n//  Polyfull for NodeList forEach (IE11)\r\nif (window.NodeList && !NodeList.prototype.forEach) {\r\n    NodeList.prototype.forEach = function (callback, thisArg) {\r\n        thisArg = thisArg || window;\r\n        for (let i = 0; i < this.length; i++) {\r\n            callback.call(thisArg, this[i], i, this);\r\n        }\r\n    };\r\n}\r\n\r\n//  Polyfill for Object.values (IE)\r\nif (!Object.values) {\r\n    Object.values = function values(obj) {\r\n        const vals = [];\r\n        for (var key in obj) {\r\n            if (obj.hasOwnProperty(key) && obj.propertyIsEnumerable(key)) {\r\n                vals.push(obj[key]);\r\n            }\r\n        }\r\n        return vals;\r\n    };\r\n}\r\n\r\n// <=IE11 does not have a replaceAll; allocate it here.\r\nif (!String.prototype.replaceAll) {\r\n    String.prototype.replaceAll = function (search, replacement) {\r\n        return this.split(search).join(replacement);\r\n    };\r\n}\r\n\r\n// <=IE11 matches\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches =\r\n        Element.prototype.msMatchesSelector ||\r\n        Element.prototype.webkitMatchesSelector;\r\n}\r\n\r\n// <=IE11 closest\r\nif (!Element.prototype.closest) {\r\n    Element.prototype.closest = function (s) {\r\n        let el = this;\r\n\r\n        do {\r\n            if (Element.prototype.matches.call(el, s)) return el;\r\n            el = el.parentElement || el.parentNode;\r\n        } while (el !== null && el.nodeType === 1);\r\n        return null;\r\n    };\r\n}\r\n\r\n","/*\r\nNamespace:\r\n    df.sys.vt\r\n\r\nThis namespace contains the functionality needed to work with valuetrees. It can serialize and \r\ndeserialize the valuetrees from and to usable objects. It is capable of generating a serialize and \r\ndeserialize function based on a provided format as optimization. For the generation and live \r\ndeserialization it is required to provide the format which can be done by passing an example object\r\n structure where actual values are replaced with integer constants representing the type. An example \r\n is given below.\r\n@code\r\n{ aArray : [ { sMember : df.tString, iMember : df.tInt } ], bMember : df.tBool }\r\n@code\r\n\r\nRevision:\r\n    2013/11/02  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport const vt = {\r\n\r\n    /* \r\n    Generates a deserialization function based on the provided format definition. The function will know \r\n    the format allowing it parse the valuetree faster. The resulting function has a single parameter \r\n    (the value tree) and returns the object structure.\r\n    \r\n    @code\r\n    myParser = df.sys.vt.generateDeserializer({ aArray : [ { sMember : df.tString, iMember : df.tInt } ], bMember : df.tBool });\r\n    oObj = myParser(tVT);\r\n    @code\r\n    \r\n    @param  tDef    Format definition.\r\n    @return Function that can parse a value tree into an object structure with the provided format.\r\n    */\r\n    generateDeserializer(tDef) {\r\n        var aCode = [], iFC = 0, aObjs = [];\r\n\r\n        function parseObj(sC, tDef) {\r\n            var sM, i = 0, iFunc, aFunc = [];\r\n\r\n            //  Check for recursive objects (if so we simply use that function)\r\n            iFunc = aObjs.indexOf(tDef);\r\n            if (iFunc < 0) {\r\n\r\n                //  Generate new function and store its number\r\n                iFunc = iFC++;\r\n                aObjs[iFunc] = tDef;\r\n\r\n                aFunc.push('function p', iFunc, '(tVT){',\r\n                    'return {');\r\n\r\n                for (sM in tDef) {\r\n                    if (tDef.hasOwnProperty(sM)) {\r\n                        if (i > 0) {\r\n                            aFunc.push(',');\r\n                        }\r\n                        aFunc.push(sM, ':', switchType('tVT.c[' + i + ']', tDef[sM]));\r\n\r\n                        i++;\r\n                    }\r\n                }\r\n\r\n                aFunc.push('};',\r\n                    '}');\r\n\r\n                aCode.push(aFunc.join(''));\r\n            }\r\n\r\n            return 'p' + iFunc + '(' + sC + ')';\r\n        }\r\n\r\n        function parseArray(sC, tDef) {\r\n            var iFunc = iFC++, aFunc = [];\r\n\r\n            aFunc.push('function p', iFunc, '(tVT){',\r\n                'var a = [], i; ',\r\n                'for(i = 0; i < tVT.c.length; i++){');\r\n\r\n            aFunc.push('a.push(', switchType('tVT.c[i]', tDef[0]), ');');\r\n\r\n            aFunc.push('}',\r\n                'return a;',\r\n                '}');\r\n\r\n            aCode.push(aFunc.join(''));\r\n\r\n            return 'p' + iFunc + '(' + sC + ')';\r\n        }\r\n\r\n        function parseEndNode(sC, tDef) {\r\n            switch (tDef) {\r\n                case df.tBool:\r\n                    return 'df.toBool(' + sC + '.v)';\r\n                case df.tInt:\r\n                    return 'df.toInt(' + sC + '.v)';\r\n                case df.tNumber:\r\n                    return 'df.toNumber(' + sC + '.v)';\r\n                case df.tDate:\r\n                    return 'df.toDate(' + sC + '.v)';\r\n                default:\r\n                    return sC + '.v';\r\n            }\r\n        }\r\n\r\n        function switchType(sC, tDef) {\r\n            if (typeof (tDef) === \"number\") {\r\n                return parseEndNode(sC, tDef);\r\n            }\r\n            if (tDef instanceof Array) {\r\n                return parseArray(sC, tDef);\r\n            }\r\n            return parseObj(sC, tDef);\r\n        }\r\n\r\n\r\n\r\n        aCode.push('try{',\r\n            'return ', switchType(\"tVT\", tDef), ';',\r\n            '}catch(oErr){',\r\n            'throw new df.Error(999, \"Unable to deserialize valuetree, invalid data format!\\\\n\\\\r\\\\n\\\\rMSG: {{0}}\", this, [ oErr.message ]);',\r\n            '}');\r\n\r\n        // aCode.push('})');\r\n\r\n        return new Function(\"tVT\", aCode.join('')); //eval(aCode.join(\"\"));\r\n    },\r\n\r\n    /*\r\n    Generates a serialization function based on the provided format definition. The function will know \r\n    the format allowing it to generate the valuetree faster than when using object reflection.\r\n    \r\n    @code\r\n    serializeVT = df.sys.vt.generateSerializer({ aArray : [ { sMember : df.tString, iMember : df.tInt } ], bMember : df.tBool });\r\n    tVT = serializeVT(tStruct);\r\n    @code\r\n    \r\n    @param  tDef    Definition object.\r\n    @return Function that can generate a value tree for objects of this format.\r\n    */\r\n    generateSerializer(tDef) {\r\n        var aCode = [], iFC = 0;\r\n\r\n        function parseObj(sC, tDef) {\r\n            var sM, i = 0, iFunc = iFC++, aFunc = [];\r\n\r\n            aFunc.push('function p', iFunc, '(oObj){',\r\n                'return {',\r\n                'v : \"\",',\r\n                'c : [');\r\n\r\n            for (sM in tDef) {\r\n                if (tDef.hasOwnProperty(sM)) {\r\n                    if (i > 0) {\r\n                        aFunc.push(',');\r\n                    }\r\n                    aFunc.push(switchType('oObj[\"' + sM + '\"]', tDef[sM]));\r\n\r\n                    i++;\r\n                }\r\n            }\r\n\r\n            aFunc.push(']',\r\n                '};',\r\n                '}');\r\n\r\n            aCode.push(aFunc.join(''));\r\n\r\n            return 'p' + iFunc + '(' + sC + ')';\r\n        }\r\n\r\n        function parseArray(sC, tDef) {\r\n            var iFunc = iFC++, aFunc = [];\r\n\r\n            aFunc.push('function p', iFunc, '(aArray){',\r\n                'var tVT = { v : \"\", c : [] }, i;',\r\n                'for(i = 0; i < aArray.length; i++){');\r\n\r\n            aFunc.push('tVT.c.push(', switchType('aArray[i]', tDef[0]), ');');\r\n\r\n            aFunc.push('}',\r\n                'return tVT;',\r\n                '}');\r\n\r\n            aCode.push(aFunc.join(''));\r\n\r\n            return 'p' + iFunc + '(' + sC + ')';\r\n        }\r\n\r\n        function parseEndNode(sC, tDef) {\r\n            switch (tDef) {\r\n                case df.tBool:\r\n                    return '{ v : df.fromBool(' + sC + '), c : [] }';\r\n                case df.tDate:\r\n                    return '{ v : df.fromDate(' + sC + '), c : [] }';\r\n                default:\r\n                    return '{ v : ' + sC + '.toString(), c : [] }';\r\n            }\r\n        }\r\n\r\n        function switchType(sC, tDef) {\r\n            if (typeof (tDef) === \"number\") {\r\n                return parseEndNode(sC, tDef);\r\n            }\r\n            if (tDef instanceof Array) {\r\n                return parseArray(sC, tDef);\r\n            }\r\n            return parseObj(sC, tDef);\r\n        }\r\n\r\n\r\n\r\n        aCode.push('try{',\r\n            'return ', switchType(\"tStruct\", tDef), ';',\r\n            '}catch(oErr){',\r\n            'throw new df.Error(999, \"Unable to serialize valuetree, invalid data format!\\\\n\\\\r\\\\n\\\\rMSG: {{0}}\", this, [ oErr.message ]);',\r\n            '}');\r\n\r\n\r\n        // aCode.push('})');\r\n\r\n        return new Function(\"tStruct\", aCode.join('')); //eval(aCode.join(\"\"));\r\n    },\r\n\r\n    /*\r\n    Deserializes a valuetree into usable objects based on the provided format.\r\n    \r\n    @param  tVT     The value tree.\r\n    @param  tDef    Definition object.\r\n    @return Objects based on the definition containing the data from the value tree.\r\n    */\r\n    deserialize(tVT, tDef) {\r\n\r\n        function parseObj(tVT, tDef) {\r\n            var sM, i = 0, oRes = {};\r\n\r\n            for (sM in tDef) {\r\n                if (tDef.hasOwnProperty(sM)) {\r\n                    oRes[sM] = switchType(tVT.c[i], tDef[sM]);\r\n\r\n                    i++;\r\n                }\r\n            }\r\n\r\n            return oRes;\r\n        }\r\n\r\n        function parseArray(tVT, tDef) {\r\n            var i, aRes = [];\r\n\r\n            for (i = 0; i < tVT.c.length; i++) {\r\n                aRes.push(switchType(tVT.c[i], tDef[0]));\r\n            }\r\n\r\n            return aRes;\r\n        }\r\n\r\n        function parseEndNode(tVT, tDef) {\r\n            switch (tDef) {\r\n                case df.tBool:\r\n                    return df.toBool(tVT.v);\r\n                case df.tInt:\r\n                    return df.toInt(tVT.v);\r\n                case df.tNumber:\r\n                    return df.toNumber(tVT.v);\r\n                case df.tDate:\r\n                    return df.toDate(tVT.v);\r\n                default:\r\n                    return tVT.v;\r\n            }\r\n        }\r\n\r\n        function switchType(tVT, tDef) {\r\n            if (typeof (tDef) === \"number\") {\r\n                return parseEndNode(tVT, tDef);\r\n            }\r\n            if (tDef instanceof Array) {\r\n                return parseArray(tVT, tDef);\r\n            }\r\n            return parseObj(tVT, tDef);\r\n        }\r\n\r\n        try {\r\n            return switchType(tVT, tDef);\r\n        } catch (oErr) {\r\n            throw new df.Error(999, \"Unable to deserialize valuetree, invalid data format!\\\\n\\\\r\\\\n\\\\rMSG: {{0}}\", this, [oErr.message]);\r\n        }\r\n    },\r\n\r\n    /* \r\n    Serializes the passed objects into a value tree. It will serialize all the available properties of \r\n    the objects themselves (so not of the prototype).\r\n    \r\n    @param  tStruct Data objects to serialize.\r\n    @return Valuetree with the data.\r\n    */\r\n    serialize(tStruct) {\r\n        function parseObj(oObj) {\r\n            var sM, oRes = { v: \"\", c: [] };\r\n\r\n            for (sM in oObj) {\r\n                if (oObj.hasOwnProperty(sM)) {\r\n                    oRes.c.push(switchType(oObj[sM]));\r\n                }\r\n            }\r\n\r\n            return oRes;\r\n        }\r\n\r\n        function parseArray(aArray) {\r\n            var i, oRes = { v: \"\", c: [] };\r\n\r\n            for (i = 0; i < aArray.length; i++) {\r\n                oRes.c.push(switchType(aArray[i]));\r\n            }\r\n\r\n            return oRes;\r\n        }\r\n\r\n        function parseEndNode(oObj) {\r\n            if (typeof oObj === \"boolean\") {\r\n                return { v: df.fromBool(oObj), c: [] };\r\n            }\r\n            if (oObj instanceof Date) {\r\n                return { v: df.fromDate(oObj), c: [] };\r\n            }\r\n            return { v: oObj.toString(), c: [] };\r\n        }\r\n\r\n        function switchType(tStruct) {\r\n            if (typeof (tStruct) === \"object\") {\r\n                if (tStruct instanceof Array) {\r\n                    return parseArray(tStruct);\r\n                }\r\n                if (tStruct instanceof Date) {\r\n                    return parseEndNode(tStruct);\r\n                }\r\n                return parseObj(tStruct);\r\n            }\r\n            return parseEndNode(tStruct);\r\n\r\n        }\r\n\r\n        try {\r\n            return switchType(tStruct);\r\n        } catch (oErr) {\r\n            throw new df.Error(999, \"Unable to serialize valuetree, invalid data format!\\\\n\\\\r\\\\n\\\\rMSG: {{0}}\", this, [oErr.message]);\r\n        }\r\n    }\r\n\r\n};","/*\r\nName:\r\n    df.settings\r\nType:\r\n    Library(object)\r\n\r\nSettings that configure the default behavior of the JavaScript engine. These are not settings that \r\nwould be changed regularly (those are controlled from the server) but mainly things like key-codes.\r\n    \r\nRevisions:\r\n    2008/10/05  Created the initial version and so added the support for it in \r\n    the further library. (HW, DAE)\r\n    2011/09/25  Refactored into the new VDF 17.1 framework. (HW, DAW)\r\n*/\r\n\r\n\r\n/*\r\nUsing the settings object the AJAX Library default settings can be configured. \r\nThis object contains a JSON notation with the settings that are available. Most \r\nsettings are key codes and are used to attach listeners for default behavior. \r\nThese settings can be modified in the settings.js file itself but note that the \r\nfile is overwritten during upgrades. The best way to override these settings is \r\nby using the following code in your own includes or pages (after the AJAX \r\nLibrary includes).\r\n\r\n@code\r\n//  Change the search key of the lookup from ctrl-f to crtl-s\r\ndf.settings.listKeys.search = {\r\n    iKeyCode : 83,\r\n    bCtrl : true,\r\n    bShift : false,\r\n    bAlt : false\r\n};\r\n@code\r\n\r\nNote that this code should be executed (advised to be placed/included directly \r\nin the <head> element) before the List object is initialized.\r\n*/\r\nexport const settings = {\r\n    /*\r\n    The keys that are used by the df.core.Form for the default actions.\r\n    */\r\n    formKeys : {\r\n        findGT : {\r\n            iKeyCode : 119,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        findLT : {\r\n            iKeyCode : 118,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        findGE : {\r\n            iKeyCode : 120,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        findFirst : {\r\n            iKeyCode : 36,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        findLast : {\r\n            iKeyCode : 35,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        save : {\r\n            iKeyCode : 113,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        clear : {\r\n            iKeyCode : 116,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        clearAll : {\r\n            iKeyCode : 116,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        remove : {\r\n            iKeyCode : 113,\r\n            bCtrl : false,\r\n            bShift : true,\r\n            bAlt : false\r\n        },\r\n        prompt : {\r\n            iKeyCode : 115,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        tabOut : {\r\n            iKeyCode : 9,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        submit : {\r\n            iKeyCode : 13, // Enter\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        escape : {\r\n            iKeyCode : 27,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    \r\n    /*\r\n    The keys that are used by the df.core.List engine. The deriving prototypes \r\n    df.deo.Grid and df.deo.Lookup will also use these settings.\r\n    */\r\n    listKeys : {\r\n        scrollUp : {    //  arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        scrollDown : {  //  arrow down\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        scrollRangeUp : {    //  arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : true,\r\n            bAlt : false\r\n        },\r\n        scrollRangeDown : {  //  arrow down\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : true,\r\n            bAlt : false\r\n        },\r\n        scrollPageUp : {    //  page up\r\n            iKeyCode : 33,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        scrollPageDown : {  //  page down\r\n            iKeyCode : 34,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        scrollTop : [{      //  ctrl - home\r\n            iKeyCode : 36,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },{                 //  ctrl - arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        }],\r\n        scrollBottom : [{   //  ctrl - end\r\n            iKeyCode : 35,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },{                 //  ctrl -arrow  down\r\n            iKeyCode : 40,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        }],\r\n        search : {          //  ctrl - f\r\n            iKeyCode : 70,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        leftSwipeBtns : {   // Right arrow\r\n            iKeyCode : 39   \r\n        },\r\n        rightSwipeBtns : {  //  Left arrow\r\n            iKeyCode : 37   \r\n        },\r\n        select : {          // Space\r\n            iKeyCode : 32\r\n        },\r\n        selectAll : {       // Ctrl - a\r\n            iKeyCode : 65,\r\n            bCtrl : true\r\n        },\r\n        deSelectAll : {     //  Escape\r\n            iKeyCode : 27,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        collapseAllGrp : {  // Ctrl - -\r\n            iKeyCode : 109,\r\n            bCtrl : true\r\n        },\r\n        expandAllGrp : {    // Ctrl - +\r\n            iKeyCode : 107,\r\n            bCtrl : true\r\n        },\r\n        collapseGrp : {     // shift - -\r\n            iKeyCode : 109,\r\n            bShift : true\r\n        },\r\n        expandGrp : {       // shift - +\r\n            iKeyCode : 107,\r\n            bShift : true\r\n        }\r\n    },\r\n    gridKeys : {\r\n        nextCol : {         //  tab\r\n            iKeyCode : 9,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt: false\r\n        },\r\n        prevCol : {         //  shift - tab\r\n            iKeyCode : 9,\r\n            bCtrl : false,\r\n            bShift : true,\r\n            bAlt: false\r\n        },\r\n        newRow : {          //  shift - F10\r\n            iKeyCode : 121,\r\n            bCtrl : false,\r\n            bShift : true,\r\n            bAlt : false\r\n        }\r\n    },\r\n    tabKeys : {\r\n        enter : {\r\n            iKeyCode : 13,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    /*\r\n    The keys used by the df.gui.Calendar control. The df.gui.PopupCalendar and \r\n    df.deo.DatePicker also use these settings.\r\n    */\r\n    calendarKeys : {\r\n        dayUp : {           //  Arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        dayDown : {         //  Arrow down\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        dayLeft : {         //  Arrow left\r\n            iKeyCode : 37,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        dayRight : {        //  Arrow right\r\n            iKeyCode : 39,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        monthUp : {         //  Page up\r\n            iKeyCode : 33,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        monthDown : {       //  Page down\r\n            iKeyCode : 34,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        yearUp : {          //  Ctrl - Page up\r\n            iKeyCode : 33,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        yearDown : {        //  Ctrl - page down\r\n            iKeyCode : 34,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        enter : {           //  Enter\r\n            iKeyCode : 13,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        close : {           //  Escape\r\n            iKeyCode : 27,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    \r\n    /*\r\n    The keys that are used by the df.gui.TreeView component.\r\n    */\r\n    treeKeys : {\r\n        moveUp : {\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveDown : {\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        collapse : {\r\n            iKeyCode : 37,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        extend : {\r\n            iKeyCode : 39,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveFirst : {\r\n            iKeyCode : 36,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveLast : {\r\n            iKeyCode : 35,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        enter : {\r\n            iKeyCode : 13,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    \r\n    sliderKeys : {\r\n        sliderUp : {           //  Arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        sliderDown : {         //  Arrow down\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        sliderLeft : {         //  Arrow left\r\n            iKeyCode : 37,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        sliderRight : {        //  Arrow right\r\n            iKeyCode : 39,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    menuKeys : {\r\n        moveUp : {           //  Arrow up\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveDown : {         //  Arrow down\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveLeft : {         //  Arrow left\r\n            iKeyCode : 37,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveRight : {        //  Arrow right\r\n            iKeyCode : 39,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    \r\n    spinKeys : {\r\n        moveUp : {\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveDown : {\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    },\r\n    \r\n    suggestionKeys : {\r\n        backSpace : {\r\n            iKeyCode : 8,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        delete : {\r\n            iKeyCode : 46,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveUp : {\r\n            iKeyCode : 38,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        moveDown : {\r\n            iKeyCode : 40,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        select : {\r\n            iKeyCode : 13,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },\r\n        escape : [{ //  ESC & Tab\r\n            iKeyCode : 27,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        },{\r\n            iKeyCode : 9,\r\n            bCtrl : false,\r\n            bShift : false,\r\n            bAlt : false\r\n        }],\r\n        forceDisplay : { // CTRL - Space\r\n            iKeyCode : 32,\r\n            bCtrl : true,\r\n            bShift : false,\r\n            bAlt : false\r\n        }\r\n    }\r\n};","/**\r\n * @license\r\n * \r\n * This is here so that webpack inserts the license banner here..\r\n */\r\n\r\nimport { dom } from './df/dom.js';\r\nimport { sys } from './df/sys.js';\r\nimport { events } from './df/events.js';\r\nimport { settings } from './df/settings.js';\r\n\r\n/*\r\nName:\r\n    df\r\nType:\r\n    Namespace\r\n\r\nRevisions:\r\n    2007/12/14  Created the initial structure and the first edition of dynamic\r\n    library loading using the df.require method. (HW, DAE)\r\n    \r\n    2008/03/19  Removed dynamic library loading. (HW, DAE)\r\n    \r\n    2011/06/28  Refactored for usage in the new Visual DataFlex 17.1 Web Framework (HW, DAW)\r\n    \r\n    2013/03/04  Renamed from vdf to df in preparation of the upcoming name change and to allow the \r\n    17.1 framework to run side by side with the AJAX Library. (HW, DAW)\r\n*/\r\n/* global bDfDebug */\r\n\r\n/* \r\nThis is the main namespace where the entire JavaScript engine of the web application framework \r\nresides under. It is the only global object of the framework itself other than any application \r\nobjects that may be created. It contains classes, other namespaces and constants.\r\n*/\r\n\r\n\r\n\r\nconst sDfVersion =  \"25.0.11.22\";\r\n\r\nexport const df = {\r\n\r\ndom : dom,\r\nsys : sys,\r\nevents : events,\r\nsettings : settings,\r\n\r\n//  GLOBALS\r\n/*\r\nString containing the actual version number of the library. The df-include.js places it in the \r\ntemporary df object.\r\n*/\r\npsVersionId : sDfVersion,\r\n\r\n/* \r\nNumber containing the DataFlex revision (Major and Minor like 18.2). This can be used for hot \r\nfixes to make sure that they do not override the actual fix.\r\n*/\r\npnDataFlexVersion : (function(){\r\n    var aV;\r\n    \r\n    aV = sDfVersion.split(\".\");\r\n    if(aV.length > 1){\r\n        return parseFloat(aV[0] + \".\" + aV[1]);\r\n    }else{\r\n        return 0.0;\r\n    }\r\n}()),\r\n\r\n//  CONSTANTS\r\n\r\n//  piDataType  (df.WebBaseDEO)\r\nciTypeText      : 0,\r\nciTypeBCD       : 1,\r\nciTypeDate      : 2,\r\nciTypeDateTime  : 3,\r\nciTypeTime      : 4,\r\n\r\n//  peRegion    (df.WebPanel)\r\nciRegionCenter  : 0,\r\nciRegionLeft    : 1,\r\nciRegionRight   : 2,\r\nciRegionTop     : 3,\r\nciRegionBottom  : 4,\r\n\r\n//  peLabelAlign (df.WebControl)\r\nciLabelLeft     : 0,\r\nciLabelTop      : 1,\r\nciLabelRight    : 2,\r\nciLabelFloat    : 3,\r\n\r\n//  peAlign      (df.WebLabel, df.WebBaseDEO)\r\nciAlignLeft     : 0,\r\nciAlignCenter   : 1,\r\nciAlignRight    : 2,\r\n\r\n//  Server communication (df.WebList)\r\nciDirGT         : 0,\r\nciDirLT         : 1,\r\n\r\n//  Modes for opening a new page (df.WebApp:navigateToPage)\r\nciOpenSameWindow    : 0,\r\nciOpenNewTab        : 1,\r\nciOpenNewWindow     : 2,\r\n\r\n//  pePosition of cWebImage\r\ncwiActual            : 0,\r\ncwiStretch           : 1,\r\ncwiStretchHoriz      : 2,\r\ncwiCenter            : 3,\r\ncwiFit               : 4,\r\ncwiCover             : 5,\r\n\r\n//  peSortItems of cWebCombo\r\ncsUnsorted      : 0,\r\ncsDescription   : 1,\r\ncsValue         : 2,\r\n\r\n//  peBreadcrumbStyle of cWebBreadcrumb\r\ncCrumbHorizontal  :0,\r\ncCrumbDropDown    :1,\r\ncCrumbCaption     :2,\r\n\r\n// web property data types\r\ntUnknown            : 0,\r\ntString             : 1,\r\ntInt                : 2,\r\ntNumber             : 3,\r\ntDate               : 4,\r\ntBool               : 5,\r\ntAdv                : 6,\r\n\r\n//  WebList.peDbGridType\r\ngtAutomatic         : 0,\r\ngtAllData           : 1,\r\ngtManual            : 2,\r\n\r\n//  WebList.peGrouping\r\ngrpDisabled         : 0,\r\ngrpCustom           : 1,\r\ngrpAutomatic        : 2,\r\n\r\n//  Server call modes\r\ncCallModeDefault    : 1,\r\ncCallModeWait       : 2,\r\ncCallModeProgress   : 3,\r\n\r\n//  WebSuggestionForm.peSuggestionMode\r\nsmFind              : 0,\r\nsmValidationTable   : 1,\r\nsmCustom            : 2,\r\n\r\n//  Client action modes\r\nctExecDefault       : 0,    // Regular client actions\r\nctExecEarly         : 1,    // Early client actions that need to be executed before web property values are applied\r\nctExecViewLoad      : 2,    // Client actions that are part of the loading / initialization of a view\r\n\r\nmodeDesktop         : 10,   // This is the default mode (i.e. desktop mode). This mode is not normally explicitly used.\r\nmodeTablet          : 20,   // Default Tablet mode\r\nmodeTabletLandscape : 21,   // Tablet mode when in landscape orientation\r\nmodeTabletPortrait  : 22,   // Tablet mode when in portrait\r\nmodeMobile          : 30,   // Default Mobile mode\r\nmodeMobileLandscape : 31,   // Mobile mode when in landscape\r\nmodeMobilePortrait  : 32,   // Mobile mode when in portrait\r\n\r\n//  WebMenuItem.peActionDisplay (used by cWebActionBar)\r\nadActionBar  : 1,\r\nadMenu       : 2,\r\nadBoth       : 3,\r\n\r\n//  peWordBreak options\r\nwbNone          : 0,    // No wrapping, no line breaks\r\nwbWrap          : 1,    // Wrap on words, no line breaks\r\nwbPre           : 2,    // No wrapping, line breaks\r\nwbPreWrap       : 3,    // Word wrapping and line breaks\r\nwbEllipsis      : 4,    // No wrapping and \"...\" when clipping\r\n\r\n// Drag drop constants\r\ndropPositions : {\r\n    ciDropUnknown   : 0,    // Unknown (shouldn't happen)\r\n    ciDropOn        : 1,    // Drop on element\r\n    ciDropBefore    : 2,    // Drop before element\r\n    ciDropAfter     : 3,    // Drop after element\r\n    ciDropOnEmpty   : 4,    // Drop in empty control (empty list, tree, tagform, etc.)\r\n},\r\n\r\ndragActions : {\r\n    WebList : {\r\n        ciDragRow : 111\r\n    },\r\n    WebMultiSelectList : {\r\n        ciDragRowSelection : 141\r\n    },\r\n    WebTreeView : {\r\n        ciDragFolder : 121,\r\n        ciDragItem : 122,\r\n    },\r\n    WebTagsForm : {\r\n        ciDragTag : 131\r\n    },\r\n    WebWidgetContainer : {\r\n        ciDragWidget : 151\r\n    }\r\n},\r\n\r\ndropActions : {\r\n    WebControl : {\r\n        ciDropOnControl : 201\r\n    },\r\n    WebList : {\r\n        ciDropOnRow : 211\r\n    },\r\n    WebTreeView : {\r\n        ciDropOnRoot : 221,\r\n        ciDropOnFolder : 222,\r\n        ciDropOnItem : 223\r\n    },\r\n    WebTagsForm : {\r\n        ciDropOnInput : 231\r\n    },\r\n    WebWidgetContainer : {\r\n        ciDropOnCell : 241\r\n    }\r\n},\r\n\r\nWebUIContext : {\r\n    WebUIContextCustom : 0,\r\n    WebUIContextListHead: 1,\r\n    WebUIContextListRow : 2,\r\n    WebUIContextListFull : 3,\r\n    WebUIContextListSelection : 4,\r\n    WebUIContextTreeviewFolder : 5,\r\n    WebUIContextTreeviewItem : 6,\r\n    WebUIContextTagsFormTag : 7,\r\n\r\n    isChildScopeCompatible : function (eContext) {\r\n        return eContext !== df.WebUIContext.WebUIContextListHead;\r\n    }\r\n},\r\n\r\nlayoutType : {\r\n    ciLayoutTypeInherit : 0,\r\n    ciLayoutTypeFlow : 1,\r\n    ciLayoutTypeGrid : 2\r\n},\r\n\r\nrowColValType : {\r\n    ciTypeDefault : 0,\r\n    ciTypeFixed : 1,\r\n    ciTypeFraction : 2,\r\n    ciTypeOther : 3\r\n},\r\n\r\n//  Generic CSS classnames used throughout the framework, the designer might change these to disable specific behavior\r\nCssEnabled : 'Web_Enabled',\r\nCssDisabled : 'Web_Disabled',\r\nCssHit : 'Web_Hit',\r\nhitTimeout : 1000,\r\n\r\n//  GLOBALS\r\n/*\r\nWill contain the url from where this script is included (determined at global execution).\r\n*/\r\npsIncludeLocation : (function(){\r\n    var aScripts;\r\n    \r\n    //  Determine current include location\r\n    aScripts = document.getElementsByTagName(\"script\");\r\n    return aScripts[aScripts.length - 1].src;\r\n}()),\r\n\r\n/*\r\nWill contain the root path based on the include location of this script.\r\n*/\r\npsRootPath : (function(){\r\n    var aScripts, sPath;\r\n    \r\n    //  Determine current include location\r\n    aScripts = Array.from(document.getElementsByTagName(\"script\"));\r\n    sPath = aScripts.findLast(eScript => eScript.src.indexOf('DfEngine') > 0)?.src;\r\n    \r\n    //  Remove DfEngine.. so we keep the root path\r\n    if(sPath){\r\n        return sPath.substr(0, sPath.indexOf('DfEngine'));\r\n    }\r\n    \r\n    return null;\r\n}()),\r\n\r\n\r\n//  NAMESPACES\r\n/*\r\nNamespace that contains components used for communication with the server. \r\nImportant are the HttpRequest inheritantance tree and and the xmlSerialize \r\nobject.\r\n*/\r\najax : {},\r\n\r\n/* \r\nNamespace that contains translations. These translations are shared between different instances of \r\napplications and contain things like the dates. \r\n*/\r\nlang : {\r\n    monthsLong : [\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\r\n    monthsShort : [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n    daysShort : [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\r\n    daysLong : [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]\r\n},\r\n\r\n/*\r\nNamespace containing graphical components for building interactive user interfaces.\r\n*/\r\ngui : {\r\n\r\n/*\r\nArray with Z-Index reservations.\r\n\r\n@private\r\n@deprecated\r\n*/\r\naZReservations : [true],\r\n\r\n/*\r\nUsed to reserve a new z-index which is always on top of all other components \r\nthat have reserved their z-index.\r\n\r\n@return Z-Index number.\r\n@deprecated\r\n*/\r\nreserveZIndex : function(){\r\n    return this.aZReservations.push(true) - 1;\r\n},\r\n\r\n/*\r\nReleases a z-index reservation.\r\n\r\n@param iIndex  The index to free.\r\n@deprecated\r\n*/\r\nfreeZIndex : function(iIndex){\r\n    var iRes;\r\n\r\n    this.aZReservations[iIndex] = false;\r\n\r\n    for(iRes = this.aZReservations.length - 1; iRes >= 0; iRes--){\r\n        if(!this.aZReservations[iRes]){\r\n            this.aZReservations.pop();\r\n        }else{\r\n            break;\r\n        }\r\n    }\r\n},\r\n\r\n/*\r\nCreates a div with the classname \"WebApp_DragMask\" and inserts it directly into the DOM. This mask \r\nis used in the implementation of drag and resize actions to make sure no other elements interfere.\r\n\r\n@param eParent  Insertion point for the dragmask.\r\n@return Div mask element\r\n*/\r\ndragMask : function(eParent){\r\n\tvar eMask;\r\n\t\r\n\teMask = df.dom.create('<div class=\"WebApp_DragMask\"></div>');\r\n    \r\n    (eParent || document.body).appendChild(eMask);\r\n\t\r\n\treturn eMask;\r\n}\r\n\r\n},\r\n\r\n/*\r\nJavaScript is a prototypal language with lots of different types of notations. \r\nWithin the AJAX Library we decided that we needed a more easy form of \r\ninheritance with a more readable notation. This method makes it easy to define \r\nprototypes with inheritance. Note that throughout the documentation prototypes \r\nwill be called classes for the convenience of developers moving from classical \r\nprogramming languages.\r\n\r\nThis method is called with a reference to the constructor an optional super \r\nconstructor (to inherit from) and an object with the prototype definition. The \r\nprototype.constructor reference is set correctly and a reference to the super \r\nconstructor is stored in prototype[<supername>] so it can be called from the \r\nsub constructor.\r\n\r\nExample of how a prototype should be defined inside the AJAX Library:\r\n@code\r\ndf.gui.List = function List(oForm){\r\n    this.oForm = oForm;\r\n}\r\ndf.defineClass(df.gui.List, {\r\n\r\ndisplayRow : function(oRow){\r\n    ..\r\n},\r\n\r\nscroll : function(iDirection){\r\n    ..\r\n}\r\n});\r\n@code\r\n\r\nExample of how a prototype that extends another prototype should be defined\r\ninside the AJAX Library:\r\n@code\r\ndf.gui.Grid = function Grid(oForm){\r\n    this.List(oForm);\r\n    this.aFields = [];\r\n}\r\ndf.defineClass(\"df.gui.Grid\", \"df.gui.List\", {\r\n\r\nsave : function(){\r\n    ..\r\n}\r\n\r\n});\r\n@code\r\n\r\n@param  constructor Reference to the constructor function (a string name is \r\n                    also allowed).\r\n@param  sSuper      (optional)  String name of constructor of the object to \r\n                    inherit (a string name is also allowed).\r\n@param  oProto      Reference to the object with the new prototype content.\r\n*/\r\ndefineClass : function(constructor, sSuper, oProto){\r\n    var fConstructor, fSuper, oPrototype;\r\n    console.warn(`df.defineClass is deprecated, use ES6 classes instead (${constructor})`);\r\n\r\n    \r\n    //  Constructor can be given as string or as reference\r\n    if(typeof(constructor) === \"string\"){\r\n        fConstructor = sys.ref.getNestedProp(constructor);\r\n    }else{\r\n        alert(\"Constructor for new class must be specified as string!\");\r\n        return;\r\n    }\r\n    \r\n    //  Check if constructor exists\r\n    if(typeof fConstructor !== \"function\"){\r\n        alert(\"Constructor for the new class must be a function!\");\r\n        return;\r\n    }\r\n\r\n    //  Three parameters means the second points to prototype to extend\r\n    if(arguments.length > 2){ // Three or more parameters means a Prototype to extend is given\r\n        oPrototype = arguments[arguments.length - 1];\r\n\r\n        //  The inherited constructor can be given as string or as reference\r\n        if(typeof(arguments[1]) === \"string\"){\r\n            fSuper = sys.ref.getNestedProp(arguments[1]);\r\n        }else{  \r\n            fSuper = arguments[1];\r\n        }\r\n        \r\n        //  Check if super exists\r\n        if(typeof fSuper !== 'function'){\r\n            alert(\"Super class for '\" + constructor + \"' must be defined first ('\" + arguments[1] + \"')\");\r\n            return;\r\n        }\r\n\r\n        //  The third parameter is the prototype object\r\n        oPrototype = arguments[2];\r\n\r\n        if(!oPrototype){\r\n            alert(\"Prototype for new class must be specified!\");\r\n            return;\r\n        }\r\n\r\n        const newClass = class extends fSuper {\r\n            constructor() {\r\n                // Unfortunately we have to call the base constructor first, so we just pass in the arguments\r\n                super(...arguments);\r\n                fConstructor.apply(this, arguments);\r\n            }\r\n        }\r\n        \r\n        Object.assign(newClass.prototype, oPrototype);\r\n\r\n        newClass.base = fSuper.prototype;\r\n        //  Base constructor is now an empty dummy function\r\n        newClass.base.constructor = function(){}\r\n\r\n        sys.ref.setNestedProp(constructor, newClass);\r\n\r\n        return;\r\n    }if(arguments.length === 2){\r\n        oPrototype = arguments[1];\r\n\r\n        fConstructor.prototype = oPrototype;\r\n    }\r\n\r\n    fConstructor.prototype.constructor = fConstructor;\r\n},\r\n\r\n/*\r\nThis function generates a new class based on a super class and a mixin class. A mixin class is a \r\nregular class that does not inherit from other classes. The function returns the new constructor \r\nfunction. The mixin class can use the 'getBase' method to get the base class prototype. The getBase \r\nmethod takes the classname of the mixin as a parameter which is needed when multiple mixins are used \r\nin the inheritance tree.\r\n\r\n@code\r\nfunction MyExtra_mixin(sSomething){\r\n    this.getBase(\"MyExtra_mixin\").constructor.call(this, sSomething);\r\n    \r\n    this.sProp = \"\";\r\n}\r\ndf.defineClass(\"MyExtra_mixin\", {\r\n\r\ndoSomething : function(){\r\n    // Forward send\r\n    this.getBase(\"MyExtra_mixin\").doSomething.call(this);\r\n    \r\n    this.sProp = \"Something\";\r\n}\r\n\r\n});\r\n\r\nMyClass = df.mixin(\"MyExtra_mixin\", \"MySuperClass\");\r\n@code\r\n\r\nThis is used with the columns of the df.WebList where the df.WebColumn_mixin is used on all column \r\ntypes providing a generic API for the list to talk to. \r\n\r\n@param  sMixin  String name of the mixin class (like \"df.WebColumn_mixin\").\r\n@param  sSuper  String name of the super class (like \"df.WebForm\").\r\n*/\r\nmixin : function(sMixin, sSuper){\r\n    console.error(`df.mixin is deprecated, use ES6 classes instead (${sMixin})`);\r\n},\r\n\r\n\r\n//  DataFlex TYPE CONVERSION\r\n\r\n/*\r\nThis method converts a string value to a boolean where it converts \"0\" and \"-1\" to false which is \r\nagainst the regular JavaScript behavior. Reason for doing this is because booleans received from the \r\nserver are sent by Visual DataFlex as string \"1\" (true) and \"0\" (false). Then there is are the \r\n'three state booleans' for Data Dictionary properties that can be \"-1\" which means that they are not \r\ndetermined which is interpreted as false.\r\n\r\n@param  val     The value (usually a string).\r\n@return The value as a boolean.\r\n*/\r\ntoBool : function(val){\r\n    //  Booleans come from the server as \"1\" or \"0\" where \"0\" evaluates to true\r\n    //  Booleans can have -1 as value when they support the C_WebDefault value which always evaluates to false\r\n    return (val === \"0\" || val === \"-1\" || val === \"false\" ? false : !!val);\r\n},\r\n\r\n/* \r\nThis method converts a boolean value to the DataFlex string representation \"1\" or \"0\".\r\n\r\n@param  bVal    The boolean value.\r\n@return String \"1\" for true and \"0\" for false.\r\n*/\r\nfromBool : function(bVal){\r\n    return (bVal ? \"1\" : \"0\");\r\n},\r\n\r\nfromDate : function(dDate){\r\n    return sys.data.dateToString(dDate, \"yyyy/mm/dd\", \"-\");\r\n},\r\n\r\nfromNumber : function(nNumber){\r\n    return nNumber.toString();\r\n},\r\n\r\n/*\r\nThis method converts a string value to an integer.\r\n\r\n@param  val     The value (usually a string).\r\n@return The value as an integer.\r\n*/\r\ntoInt : function(val){\r\n    return parseInt(val, 10);\r\n},\r\n\r\n/*\r\nThis method converts a string value to a number (JavaScript float).\r\n\r\n@param  val     The value (usually a string).\r\n@return The value as a float.\r\n*/\r\ntoNumber : function(val){\r\n    return parseFloat(val);\r\n},\r\n\r\ntoDate : function(val){\r\n    return sys.data.stringToDate(val, \"yyyy/mm/dd\", \"-\");\r\n},\r\n\r\ntoDateTime : function(val){\r\n    return sys.data.stringToDate(val, \"yyyy/mm/ddThh:mm:ss.fff\");\r\n},\r\n\r\nfromDateTime : function(dDate){\r\n    return sys.data.dateToString(this._tValue, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\", \":\");\r\n},\r\n\r\n//  LOGGING\r\n/*\r\n@private\r\n*/\r\ntimeValues : {},\r\n\r\ntimeStart : function(sLbl, sLog){\r\n    sLog = sLbl + \":: Timing Start * \" + sLog;\r\n    \r\n    df.log(sLog);\r\n    \r\n    this.timeValues[sLbl] = new Date().getTime();\r\n},\r\n\r\n\r\ntimeStop : function(sLbl, sLog){\r\n    var time = new Date().getTime();\r\n    \r\n    if(this.timeValues[sLbl]){\r\n        time = (time - this.timeValues[sLbl]) / 1000;\r\n        sLog = sLbl + \":: \" + time + \" * Timing Stop * \" + sLog;\r\n    }else{\r\n        sLog = sLbl + \":: <NAV> * Timing Stop * \" + sLog;\r\n    }\r\n    \r\n    df.log(sLog);\r\n},\r\n\r\n/*\r\nLog method used for development usage. The log is shown on the FireBug console \r\nwith some extra information.\r\n\r\n@param  sLog    Text to log.\r\n*/\r\nlog : function(sLog){\r\n\r\n\r\n    \r\n    //  Console object is not always available in IE\r\n    if(typeof(console) === \"object\" && console.log){\r\n        console.log(sLog);\r\n    }\r\n},\r\n\r\npbDebugging : ((typeof(bDfDebug) === \"boolean\" && bDfDebug) || document.location.href.toLowerCase().indexOf('dfdebug=true') > 0),\r\n\r\n/*\r\nLogging method that only outputs when running in debug mode (dfdebug=true get parameter of \r\nbDfDebug global).\r\n\r\n@param  sLog    Text to write to the log.\r\n*/\r\ndebug : function(sLog){\r\n    if(this.pbDebugging){\r\n        df.log(sLog);\r\n    }\r\n},\r\n\r\n/*\r\nThis is the global handler method that can be called to handle errors. If possible it is adviced to \r\ncall the error handler of the WebApp object. If an source object is passed of the WebObject type \r\nthen it will try to forward this error to the WebApp object anyway.\r\n\r\n@param  oError      The error object (instance of df.Error)\r\n@param  oOptSource  (optional) The source object that caused the error.\r\n*/\r\nhandleError : function(oError, oOptSource){\r\n    var oWebApp = null, oSource;\r\n    \r\n    //  We only handle it if it is a framework error (JS Debuggers are made to handle script errors)\r\n    if(oError instanceof df.Error){\r\n        oSource = oOptSource || oError.oSource || null;\r\n    \r\n        //  We search for a webapp object based on the source\r\n        if(oSource && oSource.getWebApp){\r\n            oSource = oSource.getWebApp();\r\n        } else if (oError.oSource && oError.oSource.getWebApp){\r\n            oSource = oError.oSource.getWebApp();\r\n        }\r\n        if(oSource && (oSource instanceof df.WebApp)){\r\n            oWebApp = oSource;\r\n        } else if (oError.oSource && (oError.oSource instanceof df.WebApp)){\r\n            oWebApp = oError.oSource;\r\n        }\r\n        \r\n        //  Pass to the webapp\r\n        if(oWebApp){\r\n            oWebApp.handleError(oError);\r\n        }else{\r\n            //  Give ugly alert\r\n            alert(oError.iNumber + \": \" + oError.sText + \"\\n\\r Line: \" + oError.iLine + \"\\n\\r Target: \" + oError.sTarget + \"\\n\\r User error: \" + oError.bUserError);\r\n        }\r\n    }else{\r\n        throw oError;\r\n    }\r\n},\r\n\r\nclassWordBreak : function(eMode){\r\n    switch(eMode){\r\n        case df.wbWrap:\r\n            return \"WebWrp_Wrap\";\r\n        case df.wbPre:\r\n            return \"WebWrp_Pre\";\r\n        case df.wbPreWrap:\r\n            return \"WebWrp_PreWrap\";\r\n        case df.wbEllipsis:\r\n            return \"WebWrp_Ellipsis\";\r\n            \r\n    }\r\n    //  df.wbNone\r\n    return \"WebWrp_None\";\r\n}\r\n\r\n};\r\n\r\n\r\n/*\r\nDumb error class that represents errors within the framework. It doesn't have any functionality but \r\nits format is known by the error handling methods.\r\n*/\r\ndf.Error = function Error(iNumber, sText, oOptSource, aOptReplacements, sOptDetailHtml, bOptSrv, bOptUsr, sOptCaption, oOptTarget, iOptLine){\r\n    this.iNumber = iNumber;\r\n    this.sText = sText;\r\n    this.bUserError = !!bOptUsr;\r\n    this.sCaption = sOptCaption || null;\r\n    this.oSource = oOptSource || null;\r\n    this.oTarget = oOptTarget || null;\r\n    this.bServer = !!bOptSrv;\r\n    this.iLine = iOptLine;\r\n    this.sDetailHtml = sOptDetailHtml || null;\r\n    \r\n    \r\n    if(aOptReplacements){\r\n        this.sText = sys.data.format(this.sText, aOptReplacements);\r\n    }\r\n};\r\n","import { df } from '../../df.js';\r\nimport { events } from '../events.js';\r\n\r\n/*\r\nName:\r\n    df.ajax.HttpRequest\r\nType:\r\n    Prototype\r\n    \r\nWrapper of the XmlHttpRequest object that allows easy usage for generic HTTP requests. Includes \r\nframework event handling and error checking.\r\n    \r\nRevisions:\r\n    2008/01/15  Restructured into the new namespacing system with the new \r\n    notation. Moved the soap functionallity to the SoapCall prototype to \r\n    simplify the usage. (HW, DAE)\r\n    2006/04/24  Upgraded the object with the inline method trick for the \r\n    onreadystatechange event so the buggy ugly global array sollution isn't \r\n    necessary any more. (HW, DAE)\r\n    2005/08/15  Created the first version using the array to reference back to \r\n    object sending the call. (HW, DAE)\r\n*/\r\n\r\n\r\n/*\r\nA basic wrapper for the XmlHttpRequest object. It contains basic functionality \r\nfor sending a HttpRequest using the XmlHttpRequest object. Performs first error \r\nchecks and fires a onFinished event if finished. \r\n\r\nUsage example:\r\n@code\r\nfunction requestTestData(){\r\n    var oRequest = new df.ajax.HttpRequest(\"TestData.txt\", null);\r\n    oRequest.onFinished.addListener(handleTestData);\r\n    oRequest.send(true);\r\n}\r\nfunction handleTestData(oEvent){\r\n    alert(oEvent.sResponseText);\r\n}\r\n@code\r\n*/\r\nexport class HttpRequest {\r\n\r\n    static states = {\r\n        REQUEST_STATE_UNITIALIZED  : 0,\r\n        REQUEST_STATE_LOADING      : 1,\r\n        REQUEST_STATE_LOADED       : 2,\r\n        REQUEST_STATE_INTERACTIVE  : 3,\r\n        REQUEST_STATE_COMPLETE     : 4\r\n    }\r\n\r\n\r\n    /*\r\n    Constructor creating the properties and initializing them with the given \r\n    attributes.\r\n\r\n    @param  sUrl    The requested URL.\r\n    @param  sData   (optional) String with post data.\r\n    */\r\n    constructor(sUrl, sData, oSource) {\r\n        if (sData === undefined) {\r\n            sData = null;\r\n        }\r\n        //  Public\r\n        /*\r\n        The URL to which the request is send. Might be relative to the URL of the\r\n        page.\r\n        */\r\n        this.sUrl = sUrl;\r\n        /*\r\n        Controls if the withCredentials option is used which enables cookies for cross domain calls.\r\n        */\r\n        this.pbWithCredentials = false;\r\n        /*\r\n        If not null this string is send as POST data with the request.\r\n        */\r\n        this.sData = sData;\r\n        /*\r\n        Determines wether the request is send synchronous or asynchronously.\r\n        */\r\n        this.bAsynchronous = true;\r\n\r\n        /*\r\n        If set then the Content-Type is validated against this value.\r\n        */\r\n        this.sExpectedContentType = null;\r\n\r\n        //  Events\r\n        /*\r\n        Called after the response is received. The event object has the\r\n        sResponseText and the oResponseXml properties that contain the response\r\n        text and XML.\r\n        \r\n        @prop oResponseXml  Reference to the XML DOM that contains the response.\r\n        @prop sResponseText String with the response text.\r\n        */\r\n        this.onFinished = new events.JSHandler();\r\n        /*\r\n        Called if an error occured. The event object has the oError object that\r\n        contains the error object. If the event is stopped the error is not given\r\n        to the error handling system.\r\n        \r\n        @prop oError    Reference to the error object.\r\n        */\r\n        this.onError = new events.JSHandler();\r\n\r\n        // @privates\r\n        this.onClose = new events.JSHandler();\r\n\r\n        this.oLoader = null;\r\n        this.oSource = oSource || null;\r\n        this.bSilent = false;\r\n    }\r\n\r\n    /*\r\n    Sends the AJAX request. If the response is received and after error checking \r\n    the onFinished event is fired.\r\n    \r\n    Note that Asynchronous calls might not be send directly because the AJAX \r\n    Library by default limits the amount of concurrent calls.\r\n    \r\n    @param  bAsynchronous   If true the request is made asynchronously.\r\n    */\r\n    send(bAsynchronous) {\r\n        var that = this, sData;\r\n\r\n        if (typeof bAsynchronous === \"boolean\") {\r\n            this.bAsynchronous = bAsynchronous;\r\n        }\r\n\r\n        this.oLoader = new XMLHttpRequest(); //df.sys.xml.getXMLRequestObject();\r\n        sData = this.getData();\r\n\r\n        //  If asynchronousattach onreadystatechange function (if synchronous it\r\n        //  is called mannualy)\r\n        if (this.bAsynchronous) {\r\n            this.oLoader.onreadystatechange = function () {\r\n                that.onReadyStateChange();\r\n            };\r\n        }\r\n\r\n        //  Open connection, set headers, send request\r\n        try {\r\n            this.oLoader.open((sData) ? \"POST\" : \"GET\", this.getRequestUrl(), this.bAsynchronous);\r\n            this.oLoader.withCredentials = this.pbWithCredentials;\r\n            this.setHeaders(this.oLoader);\r\n            this.oLoader.send(sData);\r\n        } catch (oErr) {\r\n            throw new df.Error(5121, \"The application was unable to communicate with the server.\", this);\r\n        }\r\n\r\n        //  If synchronous request call readyStateChange manually (IE won't do \r\n        //  it)\r\n        if (!this.bAsynchronous) {\r\n            this.onReadyStateChange();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Called if the readystate of the XmlRequest object changes when the request is \r\n    send asynchrone. If the request is send synchrone this method is called \r\n    manually. The method checks the readyState of the XmlRequest object, calls the \r\n    checkErrors method and fires the onFinished even.\r\n    \r\n    @private\r\n    */\r\n    onReadyStateChange() {\r\n        // var oRequest = this;\r\n\r\n        try {\r\n            if (this.oLoader.readyState === HttpRequest.states.REQUEST_STATE_COMPLETE) {\r\n                if (this.oLoader.status > 0) {    //  Scary check but it prevents firefox from throwing the could not parse XML error on page load\r\n                    this.onClose.fire(this);\r\n\r\n                    this.checkErrors();\r\n\r\n                    this.onFinished.fire(this, this.getFinishedDetails());\r\n                } else {\r\n                    throw new df.Error(5121, \"The application was unable to communicate with the server.\", this);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            if (!this.bSilent) {\r\n                df.handleError(e, this);\r\n            }\r\n            this.onError.fire(this, { oError: e });\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    /*\r\n    Creates the event object that is fired with the onFinished event.\r\n    \r\n    @private\r\n    @return Object with onFinished event information.\r\n    */\r\n    getFinishedDetails() {\r\n        return { oResponseXml: this.getResponseXml(), sResponseText: this.getResponseText() };\r\n    }\r\n\r\n    /*\r\n    Checks if any errors occurred while sending the request using its status \r\n    property.\r\n    \r\n    @param  bSkip500    (optional) If true no error is given on status 500 (some \r\n                        subclasses can give more detailed information on this error)\r\n    @private\r\n    */\r\n    checkErrors(bSkip500) {\r\n        //  TODO: Handle HTTP 404 (page not found), 301 (redirect), 302 (redirect)...\r\n\r\n        if (this.oLoader.status >= 300 && (!bSkip500 || this.oLoader.status !== 500)) {\r\n            var sDetailHtml = this.oLoader.responseText;\r\n\r\n            throw new df.Error(5120, \"Received HTTP error '{{0}} {{1}}' while loading URL '{{2}}'.\", this, [this.oLoader.status, this.oLoader.statusText, this.getRequestUrl()], sDetailHtml);// aDetails.join(\"\"));\r\n        }\r\n\r\n        if (this.oLoader.status == 200 && this.sExpectedContentType) {\r\n            let sResponseContentType = this.oLoader.getResponseHeader(\"Content-Type\") || \"\";\r\n\r\n            if (sResponseContentType.indexOf(';')) {\r\n                sResponseContentType = sResponseContentType.substring(0, sResponseContentType.indexOf(';'));\r\n            }\r\n\r\n            if (sResponseContentType.trim().toLowerCase() != this.sExpectedContentType.toLowerCase()) {\r\n                throw new df.Error(5124, \"Invalid response for HTTP request, content-type mismatch.\", this, [], `Received content-type header '${sResponseContentType}' while expecting '${this.sExpectedContentType}'.`);// aDetails.join(\"\"));\r\n            }\r\n\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Sets the \"custom\" headers for the call. Currently empty, we might add custom \r\n    header functionality tot the HttpRequest later.\r\n    \r\n    @param  oLoader Reference to the XmlHttpRequest object.\r\n    @private\r\n    */\r\n    setHeaders(oLoader) {\r\n\r\n    }\r\n\r\n    /*\r\n    @return The URL to which the request is send.\r\n    */\r\n    getRequestUrl() {\r\n        return this.sUrl;\r\n    }\r\n\r\n    /*\r\n    @return The XML document containing the response XML (null if not valid XML).\r\n    */\r\n    getResponseXml() {\r\n        return this.oLoader.responseXML;\r\n    }\r\n\r\n    /*\r\n    @return String containing the response text.\r\n    */\r\n    getResponseText() {\r\n        return this.oLoader.responseText;\r\n    }\r\n\r\n    /*\r\n    @return The this.sData string, used to make it overloadable.\r\n    @private\r\n    */\r\n    getData() {\r\n        return this.sData;\r\n    }\r\n\r\n    /*\r\n    Cancels the request. Note that cancelling requests is dangerous! You don't know \r\n    exactly if the server will still handle the request or not. Never use this on \r\n    requests that manipulate data!\r\n    */\r\n    cancel() {\r\n        if (this.oLoader !== null) {\r\n            this.onClose.fire(this);\r\n\r\n            this.oLoader.onreadystatechange = function () { };\r\n            this.oLoader.abort();\r\n            this.oLoader = null;\r\n        }\r\n\r\n        this.onFinished.aListener = [];\r\n    }\r\n\r\n    /*\r\n    This method clears the loader object of the call to prevent memory leaking. It \r\n    is called automatically by the handling methods of the call after a timeout of a \r\n    second.\r\n    */\r\n    destroy() {\r\n        try {\r\n            if (this.bAsynchronous && this.oLoader && this.oLoader.onreadystatechange) {\r\n                this.oLoader.onreadstatechange = null;\r\n            }\r\n        } catch (oErr) {\r\n\r\n        }\r\n        this.oLoader = null;\r\n    }\r\n\r\n    getWebApp() {\r\n        if (this.oSource && this.oSource.getWebApp) {\r\n            return this.oSource.getWebApp();\r\n        }\r\n\r\n        return null;\r\n    }\r\n}","import { HttpRequest } from './HttpRequest.js';\r\nimport { df } from '../../df.js';\r\n\r\n/*\r\nName:\r\n    df.ajax.JSONCall\r\nType:\r\n    Class\r\nExtends:\r\n    df.ajax.HttpRequest\r\n\r\nExtends the HttpRequest with specific functionally for calling JSON WebServices built with DataFlex.   \r\n    \r\nRevisions:\r\n    2009/06/03  Created the JSONCall based on the HttpRequest and the new \r\n    jsonSerializer which calls the VDF 2009 JSON webservices. (HW, DAE)\r\n    \r\n    2008/01/16  Created the initial prototype with functionallity from the old \r\n    XmlRequest object which covered the SoapCall and the HttpRequest \r\n    functionallity in the 1.x versions. (HW, DAE)\r\n    \r\n    2012/04/14  Extended the component with support for sending JSON to the server introduced in \r\n    Visual DataFlex 17.1. (HW, DAW)\r\n*/\r\n\r\n/*\r\nThis class contains the functionality to send an AJAX JSON call to the server. \r\nIt does this according to the standards of the Visual DataFlex JSON services. \r\nUsually a http POST is made which means that the parameters are added to the \r\nbody of the request but it can also be switched to GET which will add the \r\nparameters to the URL. Note that only primitive types can be used as parameters. \r\nThis means that only string, integer and boolean types are supported. The return \r\nvalue can be a complex type and will be deserialized into an object structure. \r\nWhen complex parameters are required the df.ajax.SoapCall class should be used \r\nto send the call.\r\n\r\nServer (inside Web Service Object):\r\n@code\r\nStruct TCarInfo\r\n    String sFullName\r\n    Integer iHorsePower\r\n    String sEngine\r\nEnd_Struct\r\n\r\n\r\n{ Published = True  }\r\n{ Description = \"\"  }\r\nFunction CarDetails String sBranch String sType Returns TCarInfo\r\n    TCarInfo tResult\r\n    \r\n    If (sBranch = \"BMW\" and sType = \"X5\") Begin\r\n        Move \"BMW X5\" to tResult.sFullName\r\n        Move 153 to tResult.iHorsePower\r\n        Move \"V8 3.0L\" to tResult.sEngine\r\n    End\r\n    \r\n    Function_Return tResult\r\nEnd_Function\r\n@code\r\n\r\nClient:\r\n@code\r\nfunction loadCarDetails(sBranch, sType){\r\n    var oCall;\r\n    \r\n    oCall = new df.ajax.JSONCall(\"AutoDetails\");\r\n    oCall.addParam(\"sBranch\", sBranch);\r\n    oCall.addParam(\"sType\", sType);\r\n    oCall.onFinished.addListener(handleCarDetails);\r\n    oCall.send(true);\r\n}\r\n\r\nfunction handleCarDetails(oEvent){\r\n    var oResult = oEvent.oSource.getResponseValue();\r\n    \r\n    if(oResult.sFullName !== \"\"){\r\n        alert(\"Car \" + oResult.sFullName + \" has a \" + oResult.sEngine + \" with \" + String(oResult.iHorsePower) + \"HP\");\r\n    }else{\r\n        alert(\"Car not found!\");\r\n    }\r\n}\r\n\r\nloadCarDetails('BMW', 'X5');\r\n@code\r\n*/\r\nexport class JSONCall extends HttpRequest {\r\n    /*\r\n    Constructor that initializes the settings with the given values.\r\n\r\n    @param  sFunction   The name of the webservice method that should be called.\r\n    @param  oParams     Object with the parameters { <param1> : <value>, <param2>, \r\n                        <value>}.\r\n    @param  sUrl        (default: WebService.wso) Url to the webservice.\r\n    */\r\n    constructor(sFunction, oParams, sUrl, oSource) {\r\n        if (sUrl === undefined || sUrl === null) {\r\n            sUrl = \"WebService.wso\";\r\n        }\r\n        super(sUrl, null, oSource);\r\n\r\n        /*\r\n        The webservice function that should be called.\r\n        */\r\n        this.sFunction = sFunction;\r\n        /*\r\n        Object with the function parameters. The property names should match the\r\n        parameter names.\r\n        */\r\n        this.oParams = oParams || {};\r\n        /*\r\n        If set to false a GET request will be made instead of a POST request. It is\r\n        advised to use POST requests due to limitation in the amount and length of\r\n        parameters that can be passed in the URL.\r\n        */\r\n        this.bUsePOST = true;\r\n        /*\r\n        If set to false the URL won't be extended with the \"methodname/JSON\" part.\r\n        The \"methodname/JSON\" part is added to the URL since Visual DataFlex web\r\n        services respond with JSON instead of SOAP if \"methodname/JSON\" is added.\r\n        */\r\n        this.bExtendURL = true;\r\n\r\n\r\n        this.sExpectedContentType = 'application/json';\r\n\r\n        this._oJSON = null;\r\n    }\r\n\r\n    /*\r\n    Adds a parameter for the function call. Note that we can only use simple values \r\n    which are all send as string.\r\n    \r\n    @param  sName   Name of the parameter.\r\n    @param  sValue  Value of the parameter.\r\n    */\r\n    addParam(sName, sValue) {\r\n        this.oParams[sName] = sValue;\r\n    }\r\n\r\n    /*\r\n    Augments the setHeaders method with the functionality that sets the \r\n    \"Content-Type\" header to \"application/x-www-form-urlencoded\" when the call is \r\n    made as a POST request.\r\n    \r\n    @param  oLoader     Reference to the XmlHttpRequest object.\r\n    @private\r\n    */\r\n    setHeaders(oLoader) {\r\n        super.setHeaders(oLoader);\r\n\r\n        if (this.bUsePOST) {\r\n            oLoader.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        }\r\n    }\r\n\r\n    /*\r\n    Overrides the orrigional method of HttpRequest \r\n    \r\n    @private\r\n    */\r\n    getData() {\r\n        if (this.bUsePOST) {\r\n            //  Append parameters\r\n            return df.sys.json.stringify(this.oParams);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    Augments the getRequestUrl with the functionallity that adds the parameters and \r\n    the /JSON extension.\r\n    \r\n    @return The complete URL to which the request is send.\r\n    */\r\n    getRequestUrl() {\r\n        var sUrl, sParam, aParams = [];\r\n\r\n        //  Call super method for start URL\r\n        sUrl = super.getRequestUrl();\r\n\r\n        //  Append /JSON\r\n        if (sUrl.indexOf(\"/JSON\") >= 0) {\r\n            sUrl = sUrl.replace(\"/JSON\", \"/\" + this.sFunction + \"/JSON\");\r\n        } else {\r\n            if (sUrl.indexOf(\"?\") >= 0) {\r\n                sUrl = sUrl.replace(\"?\", \"/\" + this.sFunction + \"/JSON\");\r\n            } else {\r\n                sUrl = sUrl + (sUrl.charAt(sUrl.length - 1) !== \"/\" ? \"/\" : \"\") + this.sFunction + \"/JSON\";\r\n            }\r\n        }\r\n\r\n        if (!this.bUsePOST) {\r\n            //  Append parameters\r\n            for (sParam in this.oParams) {\r\n                if (this.oParams.hasOwnProperty(sParam)) {\r\n                    aParams.push((aParams.length <= 0 && sUrl.indexOf(\"?\") < 0 ? \"?\" : \"&\"));\r\n                    aParams.push(encodeURIComponent(sParam));\r\n                    aParams.push(\"=\");\r\n                    aParams.push(encodeURIComponent(String(this.oParams[sParam])));\r\n                }\r\n            }\r\n\r\n            //  Return the url\r\n            return sUrl + aParams.join(\"\");\r\n        }\r\n        return sUrl;\r\n    }\r\n\r\n    /*\r\n    Override getResponseXml to return null.\r\n    \r\n    @return null\r\n    */\r\n    getResponseXml() {\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    Checks if the webservice returned any errors after calling the checkErrors \r\n    method from the super prototype.\r\n    \r\n    @return True if no errors are found.\r\n    @private\r\n    */\r\n    checkErrors() {\r\n        var tError;\r\n\r\n        if (this.oLoader.status >= 400 && this.oLoader.status < 600) {\r\n            try {\r\n                tError = df.sys.json.parse(this.getResponseText());\r\n            } catch (oErr) {\r\n\r\n            }\r\n\r\n            //  Legacy style\r\n            if (tError && tError.errorCode) {\r\n                throw new df.Error(5122, tError.errorDescription, this, [], null, false, false, \"Server returned HTTP error 500\");\r\n            }\r\n            if (tError && tError.error) {\r\n                throw new df.Error(5122, tError.error.message, this, [], null, false, false, \"HTTP Status \" + this.oLoader.status + \": \" + (tError.error.reason || this.oLoader.statusText || \"\"));\r\n            }\r\n        }\r\n\r\n        super.checkErrors();\r\n    }\r\n\r\n    /*\r\n    Searches the result node in the response and deserializes the value into \r\n    objects.\r\n    \r\n    @return Object presentation of the response.\r\n    */\r\n    getResponseValue() {\r\n        var sJSON = this.getResponseText();\r\n\r\n        try {\r\n            return df.sys.json.parse(sJSON);\r\n        } catch (oErr) {\r\n            throw new df.Error(5123, \"Received invalid JSON from the server.\", this, [], oErr.message);\r\n        }\r\n    }\r\n};","import { dev } from './sys/dev.js';\r\n\r\n/*\r\nClass:\r\n    df.MobRuleController\r\nExtends:\r\n    Object\r\n\r\nThis class is the client-side handler of web property rules. While the rules are stored on the \r\nWebObject itself this class is responsible for enforcing modes and rules. It detects the initial \r\nmode and listens to the window resize to update the mode when needed. The WebApp class will \r\ninitialize an instance of the class.\r\n    \r\nThe web property rules are defined in DataFlex code using the WebSetRule command and send to the \r\nclient as client actions on the WebObject. The WebObject stores them in its oPropRuleStore object so \r\nthat this controller can use them. When a WebObject has rules defined it will register itself on \r\nthis object as mode listener.\r\n    \r\nRevision:\r\n    2014/12/09  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class MobRuleController {\r\n    constructor(oWebApp) {\r\n        this._oWebApp = oWebApp;\r\n        this.peMode = -1;\r\n        this.pbActive = true;\r\n\r\n        this._aWOs = [];\r\n\r\n        this._aModes = [\r\n            { eM: df.modeDesktop, sCSS: \"df-ModeDesktop\" },\r\n            { eM: df.modeTablet, sCSS: \"df-ModeTablet\" },\r\n            { eM: df.modeTabletLandscape, sCSS: \"df-ModeTabletLandscape\" },\r\n            { eM: df.modeTabletPortrait, sCSS: \"df-ModeTabletPortrait\" },\r\n            { eM: df.modeMobile, sCSS: \"df-ModeMobile\" },\r\n            { eM: df.modeMobileLandscape, sCSS: \"df-ModeMobileLandscape \" },\r\n            { eM: df.modeMobilePortrait, sCSS: \"df-ModeMobilePortrait\" }\r\n        ];\r\n\r\n        this.init();\r\n    }\r\n\r\n    /* \r\n    Initialize when the DOM is ready.\r\n    */\r\n    init() {\r\n        this.detectMode();\r\n\r\n        df.dom.ready(function () {\r\n            df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n            df.dom.on(\"orientationchange\", document, this.onWindowResize, this);\r\n            this.detectMode();\r\n        }, this);\r\n    }\r\n\r\n    /* \r\n    Clear event handlers when destroying the object.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        df.dom.off(\"resize\", window, this.onWindowResize, this);\r\n        df.dom.off(\"orientationchange\", document, this.onWindowResize, this);\r\n    }\r\n\r\n    /* \r\n    Called by the WebObject to register itself as mode listener when it gets its first rule.\r\n    \r\n    @param  oWO     The web object.\r\n    */\r\n    regWO(oWO) {\r\n        this._aWOs.push(oWO);\r\n    }\r\n\r\n    /* \r\n    Unregisters a WebObject as mode listener.\r\n    \r\n    @param  oWO     The web object.\r\n    */\r\n    remWO(oWO) {\r\n        const i = this._aWOs.indexOf(oWO);\r\n        if (i >= 0) {\r\n            this._aWOs.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Enforces a specific mode.\r\n    \r\n    @param  eMode   The mode constant.\r\n    */\r\n    enforceMode(eMode) {\r\n        const that = this;\r\n\r\n        //  Store the mode\r\n        this.peMode = eMode;\r\n\r\n        //  Update CSS classes on body element\r\n        df.dom.ready(function () {\r\n            const eMode = (that.pbActive ? that.peMode : 0);\r\n            for (let i = 0; i < that._aModes.length; i++) {\r\n                df.dom.toggleClass(document.body, that._aModes[i].sCSS, that._aModes[i].eM <= eMode);\r\n            }\r\n\r\n            that._oWebApp.sizeChanged();\r\n        }, this);\r\n\r\n        //  Loop over objects with rules\r\n        for (let i = 0; i < this._aWOs.length; i++) {\r\n            const oWO = this._aWOs[i];\r\n\r\n            //  Loop over properties with rules of the object\r\n            for (const sProp in oWO._oPropRuleStore) {\r\n                if (oWO._oPropRuleStore.hasOwnProperty(sProp)) {\r\n                    this.enforceRule(oWO, sProp);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Enforces a property its rules based on the current mode.\r\n    \r\n    @param  oWO     WebObject.\r\n    @param  sProp   Name of the property.\r\n    */\r\n    enforceRule(oWO, sProp) {\r\n        const eMode = (this.pbActive ? this.peMode : 0);\r\n\r\n        //  Check if mode set\r\n        if (eMode >= 0) {\r\n            //  Get property rules\r\n            const tDet = oWO._oPropRuleStore[sProp];\r\n\r\n            //  Only proceed if not synchronized\r\n            if (!oWO._oSynced[sProp]) {\r\n\r\n                //  Store default value\r\n                if (tDet.sDefault === null) {\r\n                    tDet.sDefault = oWO.get(sProp);\r\n                }\r\n\r\n                //  Detect which rule to apply (loop over the sorted rules)\r\n                for (let i = 0; i < tDet.aRules.length; i++) {\r\n                    if (tDet.aRules[i].eM <= eMode) {\r\n                        oWO._set(sProp, tDet.aRules[i].sV, true, false);\r\n                        tDet.bActive = true;\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                //  If a rule was applied but the current mode doesn't apply a specific rule we reset the original rule.\r\n                if (tDet.bActive) {\r\n                    oWO.set(sProp, tDet.sDefault, true);\r\n                    tDet.bActive = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Standard mode detect (works purely on screen size). Will update the mode if it actually changed.\r\n    */\r\n    detectMode() {\r\n        let eMode = df.modeDesktop, iWidth, iHeight, bLandscape;\r\n\r\n        dev.detectDevice();\r\n        if (dev.isMobile) {\r\n            eMode = this.detectOrientation();\r\n            bLandscape = (eMode == df.modeMobileLandscape);\r\n\r\n            // We need this to determine mobile or tablet.\r\n            iWidth = window.screen.width;\r\n            iHeight = window.screen.height;\r\n        } else {\r\n            //  On desktop browsers we use the screen size as this allows us to do good demo's\r\n            iWidth = df.dom.windowWidth();\r\n            iHeight = df.dom.windowHeight();\r\n\r\n            bLandscape = iWidth > iHeight;\r\n        }\r\n\r\n        //  Now that we have established dimensions and landscape vs portrait we can us that to guess the device\r\n        if (iWidth < 580 || (bLandscape && iHeight < 420)) {\r\n            eMode = (bLandscape ? df.modeMobileLandscape : df.modeMobilePortrait);\r\n        } else if (iWidth < 1100 || dev.isMobile) {\r\n            eMode = (bLandscape ? df.modeTabletLandscape : df.modeTabletPortrait);\r\n        }\r\n\r\n\r\n        if (eMode !== this.peMode && this.pbActive) {\r\n            //alert(\"Detected mode: \" + eMode + \" Landscape: \" + bLandscape + \" Screenwidht: \" + iWidth + \" Screenheight: \" + iHeight + \" isMobile:  \"+ dev.isMobile + \" orientation: \" + window.orientation);\r\n            this.enforceMode(eMode);\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    In mobile, uses native browser API's to determine the current orientation (landscape or portrait) and returns this as a DF constant for convenience.\r\n    */\r\n    detectOrientation() {\r\n        let dfOrientation = df.modeMobilePortrait; // Default to portrait just in case..\r\n\r\n        if (window.screen.orientation) {\r\n            if (window.screen.orientation.type.indexOf(\"portrait\") >= 0) {\r\n                dfOrientation = df.modeMobilePortrait;\r\n            } else if (window.screen.orientation.type.indexOf(\"landscape\") >= 0) {\r\n                dfOrientation = df.modeMobileLandscape;\r\n            }\r\n        } else if (window.orientation) { // Fallback for older browsers, but checking for existence just to be sure as this has been deprecated for a while\r\n            if (window.orientation == 90 || window.orientation == -90) {\r\n                dfOrientation = df.modeMobileLandscape;\r\n            }\r\n        }\r\n\r\n        return dfOrientation;\r\n    }\r\n\r\n    /*\r\n    Listens to the window resize event and calls the mode detection on resize.\r\n    \r\n    @param  oEvent  See df.events.DomEvent.\r\n    */\r\n    onWindowResize(oEvent) {\r\n        this.detectMode();\r\n    }\r\n\r\n    /* \r\n    Activates the responsive system which means setting pbActive to true and reapplying the current \r\n    mode.\r\n    */\r\n    activate() {\r\n        if (!this.pbActive) {\r\n            this.pbActive = true;\r\n\r\n            this.enforceMode(this.peMode);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Deactivates the responsive system which means setting pbActive to true and reapplying the mode where \r\n    enforeMode will look at pbActive and use 0 as the mode when deactivated. \r\n    */\r\n    deactivate() {\r\n        if (this.pbActive) {\r\n            this.pbActive = false;\r\n\r\n            this.enforceMode(this.peMode);\r\n        }\r\n    }\r\n}","import { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebObject\r\nExtends:\r\n    Object\r\n\r\nThis class is the core of the new web application framework. It represents a Visual DataFlex Web \r\nObject on the client. It has the core functionality to support synchronized properties, getters, \r\nsetters, server actions and the object tree structure as we know it in Visual DataFlex. It will be \r\ncreated and managed by the df.WebApp class. All classes represented as server-side web objects in \r\nVisual DataFlex will inherit from this class.\r\n    \r\nRevision:\r\n    2011/06/26  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebObject {\r\n    constructor(sName, oParent) {\r\n\r\n        this._sName = sName;\r\n        this._oParent = oParent || null;\r\n\r\n        this._oTypes = {}; //  Stores the property types used for automatic type conversion.\r\n        this._oSynced = {}; //  Stores which properties are being synchronized.\r\n        this._aChildren = []; //  Array of child web objects.\r\n\r\n\r\n        this._oServerActionModes = {};\r\n        this._oServerWaitMsg = {};\r\n\r\n        this._tActionData = null; //  Will contain custom data (two dimensional string array) if a client-action contains data\r\n        this._oPropRuleStore = null; //  Will store the property rules for mobile solutions\r\n\r\n        this._bStandalone = !sName; //  If true this object isn't bound to a server-side object and not part of the tree\r\n\r\n        this._oWebApp = null; //  Optimization: will contain reference to the webapp object\r\n        this._oView = null; //  Optimization: will contain reference to wrapping view object\r\n\r\n        this._bIsWO = true; //  Used to identify initialized web objects\r\n        this._bIsDynamic = false; // Client side flag to indicate if this object was dynamically created (by the WebDynamicObjectContainer)\r\n    }\r\n\r\n    /*\r\n    This function is called after the web object is created and the web properties have received their \r\n    initial values. It can be implemented to do initialization based on the web property values before \r\n    the rendering process starts.\r\n    */\r\n    create(tDef) {\r\n\r\n    }\r\n\r\n    /* \r\n    Called to destroy a web object. We destroy child web objects as well and clear the standard \r\n    references from and to the parent element.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        let oWO;\r\n\r\n        //  Unregister from web property store\r\n        if (this._oPropRuleStore) {\r\n            this.getWebApp()._oModeControl.remWO(this);\r\n        }\r\n\r\n        //  Destroy children\r\n        while (oWO = this._aChildren.pop()) {\r\n            oWO.destroy();\r\n        }\r\n\r\n        //  Clear references between parent\r\n        this._oWebApp = null;\r\n        this._oView = null;\r\n\r\n        if (this._oParent) {\r\n            delete this._oParent[this._sName];\r\n        }\r\n        this._oParent = null;\r\n    }\r\n\r\n    /*\r\n    Called to register a direct child.\r\n    \r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        this._aChildren.push(oChild);\r\n    }\r\n\r\n    /*\r\n    This method defines a property on the current object. It will create the regular JavaScript \r\n    property, set its initial value and it will store its type. The property type will be used for data \r\n    conversions when values are received from the server (as a string).\r\n    \r\n    @code\r\n    this.prop(df.tString, \"psHtml\", \"\");\r\n    this.prop(df.tInt, \"piMaxLength\", 0);\r\n    this.prop(df.tBool, \"pbFillHeight\", false);\r\n    @code\r\n    \r\n    @param  eType   The property type (df.tString, df.tInt, df.tBool, ..).\r\n    @param  sName   Name of the property.\r\n    @param  sVal    Intial value of the property.\r\n    */\r\n    prop(eType, sName, sVal) {\r\n        this[sName] = sVal;\r\n\r\n        this._oTypes[sName] = eType;\r\n    }\r\n\r\n    /*\r\n    This method converts values received from the server to the local JavaScript type. For example a \r\n    df.tBool value \"1\" becomes true and \"0\" or \"-1\" becomes false.\r\n    \r\n    @param  val     The value (usually of type string).\r\n    @param  eType   The value type to convert to (df.tString, df.tInt, df.tBool, ..).\r\n    */\r\n    toLocalType(val, eType) {\r\n        switch (eType) {\r\n            case df.tString:\r\n                return val;\r\n            case df.tBool:\r\n                return df.toBool(val);\r\n            case df.tInt:\r\n                return df.toInt(val);\r\n            case df.tNumber:\r\n                return df.toNumber(val);\r\n            case df.tAdv:\r\n                return val;\r\n            default:\r\n                return val;\r\n        }\r\n    }\r\n\r\n    /* \r\n    This method converts local values to the type / format expected by the server. This means that they \r\n    are converted to strings and a Boolean for example becomes \"1\" or \"0\". \r\n    \r\n    @param  val     The value in the local type.\r\n    @param  eType   The value type to convert to (df.tString, df.tInt, df.tBool, ..).\r\n    */\r\n    toServerType(val, eType) {\r\n        switch (eType) {\r\n            case df.tString:\r\n                if (typeof val === \"string\") {\r\n                    return val;\r\n                }\r\n                if (val) {\r\n                    return val.toString();\r\n                }\r\n                return \"\";\r\n            case df.tBool:\r\n                return df.fromBool(val);\r\n            case df.tNumber:\r\n                return df.fromNumber(val);\r\n            case df.tAdv:\r\n                return val;\r\n            default:\r\n                if (val !== null) {\r\n                    return val.toString();\r\n                } else {\r\n                    return val;\r\n                }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method gets a property value. If a getter method is defined (get_<propname>) then this function \r\n    will be called else it will return the value of the actual property.\r\n    \r\n    @param  sProp       The name of the property.\r\n    @returns    The value of the property (in its actual type).\r\n    */\r\n    get(sProp) {\r\n        //  Use getter if available\r\n        if (this['get_' + sProp]) {\r\n            return this['get_' + sProp]();\r\n        }\r\n        return this[sProp];\r\n    }\r\n\r\n    /*\r\n    This method sets a property value. If a setter function is defined it will call that \r\n    (set_<propname>) with the value. The real property will be set after the setter is called. If a \r\n    property is not synchronized yet it will be marked as synchronized unless bOptNoSync is passed as \r\n    true. Note that the value is not converted so it needs to be provided in the proper type.\r\n    \r\n    @param  sProp       The name of the property.\r\n    @param  val         The value of the property (in its actual type).\r\n    @param  bOptNoSync  (optional) If true the property will not become a synchronized property by setting it.\r\n    */\r\n    set(sProp, val, bOptNoSync) {\r\n        let bRes;\r\n\r\n        //  Call setter if available\r\n        if (this['set_' + sProp]) {\r\n            bRes = this['set_' + sProp](val);\r\n        }\r\n\r\n        //  Set real property if available\r\n        if (this[sProp] !== undefined && bRes !== false) {\r\n            this[sProp] = val;\r\n        }\r\n\r\n        //  Mark as synchronized\r\n        if (bOptNoSync !== true) {\r\n            this.addSync(sProp);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is used when the value is set from the server. If it is called for a synchronized \r\n    property then the setter will need to be executed and the property needs to be marked as \r\n    synchronized while that doesn't happen for an initial value. The extra parameters control this. It \r\n    also passes an extra Boolean parameter to the setter indicating that it is called from the server. \r\n    Some setters might use this to behave slightly different.\r\n    \r\n    @param  sProp       The name of the property.\r\n    @param  val         The value of the property (in its actual type).\r\n    @param  bSetter     If true the setter is executed if available.\r\n    @param  bSync       If true the property is marked as synchronized.\r\n    @private\r\n    */\r\n    _set(sProp, val, bSetter, bSync) {\r\n        //  Cast value to type if known\r\n        if (this._oTypes[sProp]) {\r\n            val = this.toLocalType(val, this._oTypes[sProp]);\r\n        }\r\n\r\n        //  Call setter if available\r\n        if (bSetter) {\r\n            if (this['set_' + sProp]) {\r\n                this['set_' + sProp](val, true);\r\n            }\r\n        }\r\n\r\n        //  Always set real value\r\n        this[sProp] = val;\r\n\r\n        if (bSync) {\r\n            this.addSync(sProp);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method marks a property as synchronized property.\r\n    \r\n    @param  sProp       The name of the property.\r\n    @private\r\n    */\r\n    addSync(sProp) {\r\n        if (!this._oSynced.hasOwnProperty(sProp)) {\r\n            this._oSynced[sProp] = true;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method removes a property from the synchronized list so it won't be synchronized any more.\r\n    \r\n    @param  sProp       The name of the property.\r\n    @private\r\n    */\r\n    unSync(sProp) {\r\n        if (this._oSynced.hasOwnProperty(sProp)) {\r\n            delete this._oSynced[sProp];\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method gathers the synchronized properties for this Web Object.\r\n    \r\n    @param  aObjs   Reference to the array of synchronized property objects to which the properties are added.\r\n    @param  aAdvProps   Reference to the array in which the advanced sync props are gathered.\r\n    @private\r\n    */\r\n    getSynced(aObjs, aAdvProps) {\r\n        let val\r\n        const aProps = [], sObj = this.getLongName();\r\n\r\n        //  Gather synchronized properties\r\n        for (const sProp in this._oSynced) {\r\n            if (this._oSynced.hasOwnProperty(sProp)) {\r\n                val = this.get(sProp);\r\n\r\n                if (this._oTypes[sProp]) {\r\n                    val = this.toServerType(val, this._oTypes[sProp]);\r\n                }\r\n                if (val === undefined) {\r\n                    val = null;\r\n                }\r\n\r\n                //  Switch between advanced and local synchronized properties\r\n                if (this._oTypes[sProp] === df.tAdv) {\r\n                    aAdvProps.push({\r\n                        sO: sObj,\r\n                        sP: sProp,\r\n                        tV: val\r\n                    });\r\n                } else {\r\n                    aProps.push({\r\n                        sN: sProp,\r\n                        sV: val\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        //  If synced props where found we add it to the list with wrappers\r\n        if (aProps.length > 0) {\r\n            aObjs.push({\r\n                sO: sObj,\r\n                aP: aProps\r\n            });\r\n        }\r\n\r\n        //  Move into children\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (!this._aChildren[i]._bStandalone) {\r\n                this._aChildren[i].getSynced(aObjs, aAdvProps);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Function that generates the full name like \"oWebApp.oCustomerView.oCustomer_Name\".\r\n    \r\n    @returns String with the full name.\r\n    */\r\n    getLongName() {\r\n        if (this._oParent) {\r\n            return this._oParent.getLongNamePrnt(this) + this._sName;\r\n        }\r\n        return this._sName;\r\n    }\r\n\r\n    /*\r\n    Recurses up to the parent, used by getLongName();. Can be augmented to change the separator (like dynamic container does).\r\n    \r\n    @private\r\n    */\r\n    getLongNamePrnt() {\r\n        return this.getLongName() + \".\";\r\n    }\r\n\r\n    /*\r\n    @returns The WebApp object to which this web object belongs.\r\n    @private\r\n    */\r\n    getWebApp() {\r\n        if (this._oWebApp) {\r\n            return this._oWebApp;\r\n        }\r\n\r\n        this._oWebApp = (this._oParent && this._oParent.getWebApp && this._oParent.getWebApp()) || null;\r\n\r\n        return this._oWebApp;\r\n    }\r\n\r\n    /*\r\n    @returns The WebView object to which this web object belongs.\r\n    @private\r\n    */\r\n    getView() {\r\n        if (this._oView) {\r\n            return this._oView;\r\n        }\r\n\r\n        this._oView = (this._oParent && this._oParent.getView && this._oParent.getView()) || null;\r\n\r\n        return this._oView;\r\n    }\r\n\r\n    /*\r\n    @returns The depth of the object as seen from the view it is located in.\r\n    @private\r\n    */\r\n    getObjectLevel() {\r\n        const oView = this.getView();\r\n        let iLevel = 0, oObj = this;\r\n\r\n        while (oObj !== oView) {\r\n            oObj = oObj._oParent;\r\n            iLevel++;\r\n        }\r\n\r\n        return iLevel;\r\n    }\r\n\r\n    /*\r\n    This method calls a server method on the server. It will perform all necessary synchronizations. \r\n    Note that the method on the server should be defined inside the corresponding object and needs to be \r\n    published using WebPublish.\r\n    \r\n    @param  sMethod    Name of the method that needs to be called.\r\n    @param  aOptParams  Array with the parameters (as primitive types).\r\n    @param  fOptHandler  (optional) Method that needs to be called when the AJAX call is finished.\r\n    @param  oOptEnv   (optional) Object that is used as the context when the handler is called.\r\n    */\r\n    serverAction(sMethod, aOptParams, tOptData, fOptHandler, oOptEnv) {\r\n        this.serverActionEx({\r\n            sMethod: sMethod,\r\n            aParams: aOptParams || [],\r\n            tData: tOptData || null,\r\n            fHandler: fOptHandler,\r\n            oHandlerEnv: oOptEnv\r\n        });\r\n    }\r\n\r\n    /*\r\n    Extended version of serverAction where parameters are passed in using a configuration object. It \r\n    allows more options to be provided.\r\n    \r\n    {\r\n        sMethod : \"..\",         // Name the of the server-side method\r\n        aParams: [\"..\", \"..\"],  // Array with parameters\r\n        tData : [ .. ],         // Action data (value tree)\r\n        fHandler : ..,          // Reference to a handler function when finished\r\n        oHandlerEnv : ..,       // Reference to environment object when handler function is called\r\n        aViews : [ .. ]         // Array of views that need to be synchronized, is extended with the \r\n                                   view to which the object belongs. Can contain object references and \r\n                                   string view names.\r\n    }\r\n    \r\n    @param oConf    Configuration object with details for the calls. See example above.\r\n    */\r\n    serverActionEx(oConf) {\r\n        let sMethod;\r\n        const oAction = new df.ServerAction();\r\n\r\n        //  Configure action\r\n        oAction.oWO = this;\r\n        oAction.sAction = sMethod = oConf.sMethod;\r\n        oAction.aParams = oConf.aParams || [];\r\n        oAction.tData = oConf.tData || null;\r\n        oAction.fHandler = oConf.fHandler || null;\r\n        oAction.oHandlerEnv = oConf.oHandlerEnv || this;\r\n        oAction.aViews = oConf.aViews || [];\r\n        oAction.oPlatformSpecific = oConf.oPlatformSpecific || {};\r\n\r\n        //  Add current view\r\n        const oView = this.getView();\r\n        if (oView) {\r\n            oAction.aViews.push(oView);\r\n        }\r\n\r\n        //  Determine call mode\r\n        if (oConf.eCallMode) {\r\n            oAction.eCallMode = oConf.eCallMode;\r\n        } else {\r\n            oAction.eCallMode = this._oServerActionModes[sMethod.toLowerCase()] || df.cCallModeDefault;\r\n            if (oAction.eCallMode === df.cCallModeProgress && this._oServerWaitMsg[sMethod.toLowerCase()]) {\r\n                oAction.sProcessMessage = this._oServerWaitMsg[sMethod.toLowerCase()];\r\n            }\r\n        }\r\n\r\n        //  Pass on to webapp object\r\n        this.getWebApp().handleAction(oAction);\r\n    }\r\n\r\n    /* \r\n    Cancels a server action (if it isn't already sent).\r\n    \r\n    @param  sMethod     The name of the server method that is being called.\r\n    */\r\n    cancelServerAction(sMethod) {\r\n        this.getWebApp().cancelAction(this, sMethod);\r\n    }\r\n\r\n    /* \r\n    Determines if a server action is pending (waiting to be sent to the server).\r\n    \r\n    @param  sMethod     Name of the server action.\r\n    @return True if the action is pending.\r\n    */\r\n    hasPendingServerAction(sMethod) {\r\n        return this.getWebApp().hasPendingAction(this, sMethod);\r\n    }\r\n\r\n    /* \r\n    This client action is called when an extra round-trip is needed. This is usually done to update the \r\n    UI before performing an operation that needs more time. The first parameter is the name of the \r\n    published procedure on the server handling the call-back where the other parameters are passed back \r\n    together with the action data.\r\n    \r\n    @param  sFunction   Name of the server action to call back to.\r\n    @param  [1-17]      Are sent back to the server as parameters.\r\n    \r\n    @client-action\r\n    */\r\n    callBack(sFunction) {\r\n        const aParams = [];\r\n\r\n        for (let i = 1; i < arguments.length; i++) {\r\n            aParams.push(arguments[i]);\r\n        }\r\n\r\n        this.serverAction(sFunction, aParams, this._tActionData);\r\n    }\r\n\r\n\r\n    /*\r\n    This method registers the call mode for when server action occurs. It stores the mode combined with \r\n    the name of the method so that the serverAction method knows in which mode a call should be send. \r\n    \r\n    Supported modes are:\r\n    cCallModeDefault - The request is sent asynchronously, the user interface still responds and other \r\n    calls can be made/registered while it happens.\r\n    cCallModeWait - The request is sent asynchronously but no other calls can be registered during \r\n    the call and the user interface will become unresponsive. A waiting cursor is shown.\r\n    cCallModeProgress - The request is sent asynchronously but no other calls can be registered during \r\n    the call and a modal progress dialog will be shown.\r\n    \r\n    @param  sMethod      Name of the server action (like 'OnClick' or 'Request_Find').\r\n    @param  eMode        The call mode.\r\n    \r\n    @client-action\r\n    */\r\n    setActionMode(sMethod, eMode, sOptWaitMessage) {\r\n        if (eMode) {\r\n            this._oServerActionModes[sMethod.toLowerCase()] = df.toInt(eMode);\r\n\r\n            if (sOptWaitMessage) {\r\n                this._oServerWaitMsg[sMethod.toLowerCase()] = sOptWaitMessage;\r\n            }\r\n        } else {\r\n            throw new df.Error(999, \"Assertion: Invalid server-action mode '{{0}}' for message '{{1}}'\", this, [eMode, sMethod]);\r\n        }\r\n    }\r\n\r\n    getActionMode(sMethod) {\r\n        return this._oServerActionModes[sMethod.toLowerCase()] || df.cCallModeDefault;\r\n    }\r\n\r\n    /*\r\n    This method is used to declare events and replaces the separate declaration of the properties. It \r\n    automatically defines the 'pbServer..' and 'psClient..' properties and creates the client-side event \r\n    object.\r\n    \r\n    @param  sName       Name of the event (like 'OnClick')\r\n    @param  eOptMode    The call mode (see setActionMode).\r\n    */\r\n    event(sName, eOptMode, sOptServerName) {\r\n        this.setActionMode(sName, (arguments.length > 1 ? eOptMode : df.cCallModeDefault));\r\n\r\n        this[sName] = new df.events.JSHandler(sOptServerName || sName);\r\n\r\n        this.prop(df.tBool, \"pbServer\" + sName, false);\r\n        this.prop(df.tString, \"psClient\" + sName, \"\");\r\n    }\r\n\r\n    /*\r\n    This method fires an event by calling its client-side and server-side handlers. It will first call \r\n    the global JavaScript method defined as the property psClientOnEvent. Then it calls the advanced \r\n    client-side handlers in the OnEvent object. If pbServerOnEvent is set to true then it will call the \r\n    server. If psLoadViewOnEvent property set then it will display this view. If it is not loaded it \r\n    will load this by calling the server-side event.\r\n    \r\n    @param  sName       Name of the event.\r\n    @param  aOptParams  Optional array with parameters passed to the event handler.\r\n    @param  fOptHandler Optional handler function called after the event is handled (eventually after the server call).\r\n    @param  oOptEnv     Optional environment object for the fOptHandler function (the current WO is used if nothing is passed).\r\n    @return True if an event handler is being called.\r\n    */\r\n    fire(sName, aOptParams, fOptHandler, oOptEnv) {\r\n        return this.fireEx({\r\n            sEvent: sName,\r\n            aParams: aOptParams,\r\n            fHandler: fOptHandler,\r\n            oEnv: oOptEnv\r\n        });\r\n    }\r\n\r\n    /* \r\n    Extended version of fire which takes a configuration object as parameter. \r\n    \r\n    this.fireEx({\r\n        sEvent : \"OnSomething\",\r\n        aParams : [ .. ],\r\n        fHandler : func..,\r\n        oEnv : this,\r\n        aViews : [ .. ],\r\n        bSkipClient : false,\r\n        bSkipServer : false,\r\n        tActionData : null,\r\n        sAltServerName : null\r\n    }\r\n    */\r\n    fireEx(oConf) {\r\n        let bResult = false, bASync = false, oJsHandler = null;\r\n\r\n        //df.debug('Event: ' + sName + \" \" + df.sys.json.stringify(aOptParams || []) + \" on \" + this.getLongName() + \"  (Call mode: \" + this._oServerActionModes[sName.toLowerCase()] + \" )\");\r\n\r\n        const sName = oConf.sEvent;\r\n\r\n        if (!sName) {\r\n            throw new df.Error(999, \"Event name missing in fireEx.\", this);\r\n        }\r\n\r\n        if (!oConf.aParams || !(oConf.aParams instanceof Array)) {\r\n            oConf.aParams = [];\r\n        }\r\n\r\n        //  Create event object\r\n        const oEvent = new df.events.JSEvent(this, {\r\n            aParams: oConf.aParams,\r\n            oConf: oConf,\r\n            bClient: false,\r\n            bServer: false,\r\n            sReturnVal: null,\r\n            aViews: oConf.aView || []\r\n        });\r\n\r\n        //  Search for & call global event listener\r\n        if (this['psClient' + sName] && !oConf.bSkipClient) {\r\n            const oFunc = this.findFunc(this['psClient' + sName]);\r\n            if (typeof oFunc.fFunc === 'function') {\r\n                oEvent.bClient = bResult = true;\r\n                try {\r\n                    if (oFunc.fFunc.call(oFunc.oEnv, oEvent) === false) {\r\n                        oEvent.stop();\r\n                    }\r\n                } catch (oError) {\r\n                    this.getWebApp().handleError(oError);\r\n                }\r\n            } else {\r\n                this.getWebApp().handleError(new df.Error(999, \"Event handler function '{{0}}' set as 'psClient{{1}}' not found.\", this, [this['psClient' + sName], sName]));\r\n            }\r\n        }\r\n\r\n        //  Search for advanced client-side handler\r\n        if (!oEvent.bCanceled) {\r\n            if (this[sName] instanceof df.events.JSHandler) {\r\n                oJsHandler = this[sName];\r\n                //  Determine if there are clients\r\n                oEvent.bClient = bResult = (bResult || oJsHandler.aListeners.length > 0);\r\n                oJsHandler.fire(this, oEvent);\r\n            }\r\n        }\r\n\r\n        //  Call the server\r\n        if (!oEvent.bCanceled) {\r\n            var sServerName = oConf.sAltServerName || (oJsHandler && oJsHandler.sServerName) || sName;\r\n\r\n            if (this['pbServer' + sName] && df.toBool(this['pbServer' + sName]) && !oConf.bSkipServer) {\r\n                bResult = true;\r\n                bASync = true;\r\n\r\n                //  Perform server call\r\n                this.serverAction(sServerName, oConf.aParams, oConf.tActionData || null, function (oActEvent) {\r\n                    //  Set results\r\n                    oEvent.sReturnValue = oActEvent.sReturnValue;\r\n                    oEvent.bServer = true;\r\n\r\n                    //  Call the handler\r\n                    if (oConf.fHandler) {\r\n                        oConf.fHandler.call(oConf.oEnv || this, oEvent);\r\n                    }\r\n                }, this);\r\n            }\r\n        }\r\n\r\n        //  Call the handler\r\n        if (!bASync) {\r\n            if (oConf.fHandler) {\r\n                oConf.fHandler.call(oConf.oEnv || this, oEvent);\r\n            }\r\n        }\r\n\r\n        return bResult;\r\n    }\r\n\r\n    /*\r\n    Inserts a new child after the passed existing child.\r\n    */\r\n    insertChild(oChild, iIndex) {\r\n        this._aChildren.splice(iIndex, 0, oChild);\r\n    }\r\n\r\n    /*\r\n    Renders the given child. \r\n    \r\n    If eOptChild is passed as a parameter, this function will not freshly \r\n    render the oChild object, but rather used the passed DOM element.\r\n    */\r\n    renderChild(oChild, eOptChild) {\r\n        // Subclasses of cWebObject class will implement this method\r\n    }\r\n\r\n    /*\r\n    Removes the child from the parent's list of children.\r\n    */\r\n    removeChild(oChild) {\r\n        const iIndex = this._aChildren.indexOf(oChild);\r\n        if (iIndex !== -1) {\r\n            this._aChildren.splice(iIndex, 1);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Unrenders the given child.\r\n    */\r\n    unrenderChild(oChild) {\r\n        // Subclasses of cWebObject class will implement this method\r\n    }\r\n\r\n    /* \r\n    Called by the server for each rule (or when a rule changes at runtime). It stores the rule in the \r\n    property rule store (_oPropRuleStore).\r\n    \r\n    @param  sProp   Name of the property.\r\n    @param  eMode   The mode constant (integer).\r\n    @param  sValue  Value for the rule.\r\n    @client-action\r\n    */\r\n    propRule(sProp, eMode, sValue) {\r\n        const oWebApp = this.getWebApp();\r\n        let bFound = false;\r\n\r\n        eMode = df.toInt(eMode);\r\n\r\n        //  Create the rule store and register with the mode controller\r\n        if (!this._oPropRuleStore) {\r\n            this._oPropRuleStore = {};\r\n\r\n            if (oWebApp._oModeControl) {\r\n                oWebApp._oModeControl.regWO(this);\r\n            } else {\r\n                throw new df.Error(999, \"Mobile mode controller not available!\", this);\r\n            }\r\n        }\r\n\r\n        if (!this._oPropRuleStore[sProp]) {\r\n            //  Create property entry when needed\r\n            this._oPropRuleStore[sProp] = {\r\n                sDefault: null,\r\n                aRules: [],\r\n                bActive: false\r\n            };\r\n        } else {\r\n            //  Check and update for existing rule\r\n            for (let i = 0; i < this._oPropRuleStore[sProp].aRules.length; i++) {\r\n                if (this._oPropRuleStore[sProp].aRules[i].eM === eMode) {\r\n                    bFound = true;\r\n                    this._oPropRuleStore[sProp].aRules[i].sV = sValue;\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        //  If no existing property was found we need to add the rule\r\n        if (!bFound) {\r\n            this._oPropRuleStore[sProp].aRules.push({\r\n                eM: eMode,\r\n                sV: sValue\r\n            });\r\n\r\n            //  Sort the rules by the mode for quick applying\r\n            this._oPropRuleStore[sProp].aRules.sort(function (a, b) {\r\n                return b.eM - a.eM;\r\n            });\r\n        }\r\n\r\n\r\n        //  Signal the mode controller so that it can apply the changed rules\r\n        oWebApp._oModeControl.enforceRule(this, sProp);\r\n    }\r\n\r\n    /* \r\n    This is the standardized way of finding functions to execute on client actions and psClient... events. \r\n    It gets passed the function name as a string and it will return a reference to that function and the \r\n    object it found it on. Dot notation is allowed to find the object on which the function is executed \r\n    where this and window are supported to explicitly search in the local (the current web object) or \r\n    global scope. If window or this is not used as the first identifier it will automatically try to \r\n    find the function locally first and if not available there it will look for it globally.\r\n    \r\n    Examples:\r\n    \"myFunction\"         -> Returns the function with the name \"myFunction\" on the the current object. If \r\n                            not found it will return the global function with name \"myFunction\".\r\n    \"this.myFunction\"    -> Only searches for \"myFunction\" on the current object.  \r\n    \"window.myFunction\"  -> Only searches for \"myFunction\" on the global (window) object.\r\n    \"oObj.myFunction\"    -> Searches for the function on the oObj property of the current object, if \r\n                            oObj is not available locally it searches for a global oObj object.\r\n    \"window.oObj.oObj2.myFunction\" -> Searches for the function on the oObj2 \r\n                                      property of the global oObj object.\r\n    \r\n    @param  sFunc   String containing the function path.\r\n    @return An object with both the function (fFunc) and the object where it is found on (oEnv) where \r\n            fFunc will be null or undefined if not found. { fFunc : <function>, oEnv : <environment> }\r\n    */\r\n    findFunc(sFunc) {\r\n        let fFunc = null, oCur = null;\r\n        if (sFunc) {\r\n\r\n            //  Split into parts\r\n            const aParts = sFunc.split(\".\");\r\n\r\n            //  Go over objects in the string\r\n            while (aParts.length > 1) {\r\n                const sCur = aParts.shift();\r\n\r\n                if (!oCur) {\r\n                    //  At first level window and this are supported to explicitly determine local or global\r\n                    if (sCur === \"window\") {\r\n                        oCur = window;\r\n                    } else if (sCur === \"this\") {\r\n                        oCur = this;\r\n                    } else {\r\n                        //  If not explicitly defined we first look locally\r\n                        if (typeof (this[sCur]) === \"object\") {\r\n                            oCur = this[sCur];\r\n                        } else {\r\n                            const oGlob = df.sys.ref.getGlobalObj();  //  If window is used we assume that window is the global object but here we establish that dynamically\r\n                            if (typeof (oGlob[sCur]) === \"object\") {\r\n                                oCur = oGlob[sCur];\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    oCur = oCur[sCur];\r\n                }\r\n            }\r\n\r\n            //  Find the function\r\n            const sCur = aParts[0];\r\n            if (oCur) {   //  If an object was specified we look in there\r\n                fFunc = oCur[sCur];\r\n            } else if (typeof (this[sCur]) === \"function\") {    //  Else we first look locally\r\n                fFunc = this[sCur];\r\n                oCur = this;\r\n            } else {\r\n                const oGlob = df.sys.ref.getGlobalObj();  //  If window is used we assume that window is the global object but here we establish that dynamically\r\n                if (typeof (oGlob[sCur]) === \"function\") {  //  Then we look at the global scope\r\n                    fFunc = oGlob[sCur];\r\n                    oCur = oGlob;\r\n                }\r\n            }\r\n        }\r\n\r\n        return { fFunc: fFunc, oEnv: oCur };\r\n    }\r\n\r\n    /* \r\n    Checks if the passed web object is a parent of this web object.\r\n    \r\n    @param  oPrnt   Web object to search.\r\n    @return True if the passed web object is a parent of this. \r\n    */\r\n    isParent(oPrnt) {\r\n        let oObj = this;\r\n\r\n        while (oObj) {\r\n            if (oObj == oPrnt) {\r\n                return true;\r\n            }\r\n            oObj = oObj._oParent;\r\n        }\r\n\r\n        return false;\r\n    }\r\n};","import { WebDropZone } from './WebDropZone.js';\r\nimport { df } from '../../df.js';\r\n// Usage df.WebControlNameBase = df.mixin(\"df.WebDragDrop_Mixin\", \"df.WebBaseControl\");\r\n\r\nexport const WebDragDrop_Mixin = superclass => class extends superclass {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbDragDropEnabled\", false);\r\n\r\n        // Privates\r\n        this._sRawDragData = \"\";\r\n        this._aDragDropHelpers = new Set();     // Internal reference to DragDropHelpers this component is registered with - this is a set as we want each helper to only register once\r\n        this._aDropZones = [];                  // Array that stores drop zone elements\r\n        this._aDragActions = new Set();         // Internal reference to the supported drop actions\r\n        this._aDropActions = new Set();         // Internal reference to the supported drop actions\r\n\r\n        //  Events\r\n        this.event(\"OnDragStart\", df.cCallModeWait);\r\n        this.event(\"OnDrop\", df.cCallModeDefault);\r\n    }\r\n\r\n    addDragDropEventListeners() {\r\n        if (!this._eElem) return;\r\n\r\n        df.dom.off(\"dragstart\", this._eElem, this.onDragStart, this);\r\n        df.dom.off(\"dragend\", this._eElem, this.onDragEnd, this);\r\n\r\n        if (this._aDragActions.size > 0) {\r\n            df.dom.on(\"dragstart\", this._eElem, this.onDragStart, this);\r\n            df.dom.on(\"dragend\", this._eElem, this.onDragEnd, this);\r\n        }\r\n    }\r\n\r\n    registerDragSource(oHelper, eAction) {\r\n        this._aDragDropHelpers.add(oHelper);\r\n        this._aDragActions.add(eAction);\r\n\r\n        // Trigger resize to draw draggable elements\r\n        this.resize();\r\n\r\n        if (this._eElem) {\r\n            // Also called from afterRender\r\n            this.addDragDropEventListeners();\r\n        }\r\n    }\r\n\r\n    registerDropTarget(oHelper, eAction) {\r\n        if (this._aDropActions.size > 0) {\r\n            if (eAction == df.dropActions.WebControl.ciDropOnControl || this._aDropActions.has(df.dropActions.WebControl.ciDropOnControl)) {\r\n                throw new df.Error(999,\r\n                    'Drop Action \"DropOnControl\" cannot be used in conjunction with other Drop Actions. Ensure only \"DropOnControl\" or any of the other actions are registered exclusively.',\r\n                    this);\r\n            }\r\n        }\r\n\r\n        this._aDragDropHelpers.add(oHelper);\r\n        this._aDropActions.add(eAction);\r\n\r\n        // Check if control rendered, if so we can (re-) init all dropzones immediately\r\n        // If not, this is also called from afterRender\r\n        if (this._eElem) {\r\n            this.initDropZones();\r\n        }\r\n    }\r\n\r\n    // Convenience function to allow for mapping a different object to the registering helper\r\n    getDragSourceObj() {\r\n        return this;\r\n    }\r\n\r\n    // Convenience function to allow for mapping a different object to the registering helper\r\n    getDropTargetObj() {\r\n        return this;\r\n    }\r\n    \r\n    // setDragActions () {\r\n    //     this._aDragActions = this._tActionData;\r\n    // }\r\n\r\n    // setDropActions () {\r\n    //     this._aDropActions = this._tActionData;\r\n    // }\r\n\r\n    // ===== Initializing drag an drop elements\r\n\r\n    // Empty method, implementing controls use this to mark certain areas (elements) in the control as a dropzone\r\n    initDropZones() {\r\n    }\r\n\r\n    // Convenience method to add a drop zone\r\n    addDropZone(eZone, oOptControl) {\r\n        if (!oOptControl) {\r\n            oOptControl = this;\r\n        }\r\n        var oDropZone = new df.WebDropZone(eZone, oOptControl);\r\n        this._aDropZones.push(oDropZone);\r\n    }\r\n\r\n    removeDropZone(oDropZone) {\r\n        this._aDropZones = this._aDropZones.filter(DropZone => DropZone !== oDropZone);\r\n    }\r\n\r\n    removeDropZoneByElem(eZone) {\r\n        this._aDropZones = this._aDropZones.filter(DropZone => DropZone._eZone !== eZone);\r\n    }\r\n\r\n    // Empty method, implementing controls use this to mark certain areas (elements) in the control as a draggable\r\n    initDraggableElements() {\r\n    }\r\n\r\n    dragDropInit() {\r\n        this._aDropZones = []\r\n\r\n        this.addDragDropEventListeners();\r\n        this.initDropZones();\r\n    }\r\n\r\n    // ===== Cleanup\r\n    dragDropCleanup() {\r\n    }\r\n\r\n\r\n    // Drag drop event stubs\r\n    onDragStart(oEv) {\r\n        // oEv.e.preventDefault();\r\n        // oEv.e.stopPropagation();\r\n\r\n        var [oDragData, eDragAction] = this.getDragData(oEv, oEv.e.target);\r\n\r\n        if (oDragData && eDragAction) {\r\n            oEv.e.stopPropagation();\r\n\r\n            // Notify helpers we're starting a drag\r\n            this._aDragDropHelpers.forEach(oHelper => {\r\n                oHelper.onDragStart(oEv, this, oEv.e.target, oDragData, eDragAction);\r\n            });\r\n        }\r\n\r\n        // return false;\r\n    }\r\n\r\n    onDragEnd(oEv) {\r\n        // Notify helpers we've stopped dragging, regardless of where we ended\r\n        this._aDragDropHelpers.forEach(oHelper => {\r\n            oHelper.onDragEnd(oEv);\r\n        });\r\n    }\r\n\r\n    onDrop(oEv, oDropZone, eDropAction) {\r\n        // Notify helpers we're performing a drop\r\n        this._aDragDropHelpers.forEach(oHelper => {\r\n            oHelper.onDrop(oEv, this, oDropZone, eDropAction);\r\n        });\r\n    }\r\n\r\n    // This is needed to allow for for example scrolling on dragging over certain sections of the list or expand a folder upon hovering\r\n    onControlDragOver(oEv, oDropZone, eDropElem) {\r\n        // Implement in control\r\n    }\r\n\r\n    getDragData(oEv, eElem) {\r\n        // Implement in control\r\n        let oData, eDragAction;\r\n\r\n        return [oData, eDragAction];\r\n    }\r\n\r\n    getDropData(oDropZone) {\r\n        // Augment at control level\r\n        return [];\r\n    }\r\n\r\n    // Highlighting\r\n    highlightDropZones(oHelper) {\r\n        this._aDropZones.forEach(dropZone => {\r\n            dropZone.highlight(oHelper);\r\n        });\r\n    }\r\n\r\n    cleanupDropZones() {\r\n        this._aDropZones.forEach(dropZone => {\r\n            dropZone.unhighlight();\r\n            dropZone.removeDropElemInteractions();\r\n        });\r\n    }\r\n\r\n    hasData() {\r\n        // Check for data in control\r\n        return false;\r\n    }\r\n\r\n    // This returns the element dropped on (determined by the control), as well as the corresponding drop action in array form (to be destructured after returning)\r\n    determineDropCandidate(oEv, aHelpers) {\r\n        let eDropElem, eDropAction;\r\n\r\n        return [eDropElem, eDropAction];\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        // Returns df.dropPositions.ciDropOn, ciDropBefore or ciDropAfter\r\n        return df.dropPositions.ciDropUnknown; // unknown\r\n    }\r\n\r\n    interactWithDropElem(dropZone, eElem) {\r\n        // default to highlighting\r\n        dropZone.highlightElement(eElem);\r\n    }\r\n\r\n    doEmptyInteraction(dropZone) {\r\n        // Implement in control\r\n    }\r\n\r\n    isSupportedDragAction(eAction) {\r\n        return this._aDragActions.has(eAction);\r\n    }\r\n\r\n    isSupportedDropAction(eAction) {\r\n        return this._aDropActions.has(eAction);\r\n    }\r\n\r\n};\r\n","import { WebDragDrop_Mixin } from './dragdrop/WebDragDropMixin.js';\r\nimport { WebObject } from './WebObject.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebBaseUIObject\r\nExtends:\r\n    df.WebObject\r\n\r\nThe WebBaseUIObject is a central class in the inheritance structure of the webapp framework. It \r\ndefines the interface/API for all objects having a user interface. All control classes inherit this \r\ninterface. There is a standardized API for initializing the control by generating the HTML and later \r\non attaching the events. Central methods are openHtml, closeHtml, render and afterRender. Properties \r\nthat are standard for all controls are psCSSClass, psHtmlId, pbVisible, pbRender and pbEnabled.\r\n    \r\nRevision:\r\n    2011/07/02  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n// Inherit DragDrop functionality\r\nconst WebBaseUIObjectBase = class WebBaseUIObject extends WebDragDrop_Mixin(WebObject) { }\r\n\r\nexport class WebBaseUIObject extends WebBaseUIObjectBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Public properties for all UI Objects\r\n        this.prop(df.tString, \"psCSSClass\", \"\");\r\n        this.prop(df.tString, \"psHtmlId\", \"\");\r\n\r\n        this.prop(df.tString, \"psTextColor\", \"\");\r\n        this.prop(df.tString, \"psBackgroundColor\", \"\");\r\n\r\n        this.prop(df.tBool, \"pbRender\", true);\r\n        this.prop(df.tBool, \"pbVisible\", true);\r\n        this.prop(df.tBool, \"pbEnabled\", true);\r\n\r\n        this.event(\"OnRender\", df.cCallModeDefault);\r\n\r\n        this.OnAfterRender = new df.events.JSHandler();\r\n        this.OnAfterShow = new df.events.JSHandler();\r\n        this.OnAfterHide = new df.events.JSHandler();\r\n\r\n        //@privates\r\n        this._eElem = null; //  Outermost DOM element\r\n\r\n        this._bWrapDiv = false; //  Enables generation of the wrapping DIV element\r\n        this._bRenderChildren = false; //  Enables rendering of child components (some controls support children)\r\n\r\n        this._bFocusAble = false; //  Determines if this control is capable of having the focus\r\n\r\n        this._sControlClass = \"\"; //  CSS Class of the final control class\r\n        this._sBaseClass = \"WebUIObj\"; //  CSS Class of the 'base' class\r\n\r\n        this._aKeyHandlers = [];\r\n\r\n        this._bShown = false;\r\n\r\n    }\r\n\r\n    // - - - - - - - Rendering API - - - - - - -\r\n\r\n    /*\r\n    This function is responsible for generating the opening HTML during initialization. It is called by \r\n    the framework and an array is passed as string builder. It will add its HTML to this string. The \r\n    closeHtml function is responsible for closing the opened HTML tags. It is common practice that sub \r\n    classes add their HTML before or after doing a forward send.\r\n    \r\n    @param aHtml     Array that is used as string builder.\r\n    */\r\n    openHtml(aHtml) {\r\n        if (this._bWrapDiv) {\r\n            aHtml.push('<div class=\"', this.genClass(), '\"');\r\n            if (this.psHtmlId) {\r\n                aHtml.push(' id=\"', this.psHtmlId, '\"');\r\n            }\r\n\r\n            //  Insert the object name so the HTML element can be traced back to the right object\r\n            aHtml.push(' data-dfobj=\"', this.getLongName(), '\"');\r\n\r\n            aHtml.push(' tabindex=\"-1\" style=\" ', (this.pbRender ? '' : 'display: none;'), (this.pbVisible ? '' : 'visibility: hidden;'), '\"');\r\n            aHtml.push('>');\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    This function is responsible for generating the HTML that closes the elements that are left open by \r\n    the openHtml function. It is common practice that sub classes add their HTML before or after doing a \r\n    forward send.\r\n    \r\n    @param aHtml     Array that is used as string builder.\r\n    */\r\n    closeHtml(aHtml) {\r\n        if (this._bWrapDiv) {\r\n            aHtml.push('</div>');\r\n        }\r\n    }\r\n\r\n    /*\r\n    Main function of the rendering process. It calls openHtml, closeHtml and genets the DOM elements for \r\n    them. If needed it will call renderChildren to render nested controls.\r\n    \r\n    @return Reference to the outermost DOM element.\r\n    */\r\n    render() {\r\n        const aHtml = [];\r\n\r\n        this.openHtml(aHtml);\r\n        this.closeHtml(aHtml);\r\n\r\n        this._eElem = df.dom.create(aHtml.join(\"\"));\r\n\r\n        this.getRef();\r\n\r\n        if (this._bRenderChildren) {\r\n            this.renderChildren();\r\n        }\r\n\r\n        return this._eElem;\r\n    }\r\n\r\n    /* \r\n    This function is part of the rendering process and is called after the DOM elements are created and \r\n    before the child elements are rendering itself. Its purpose is to get references to DOM elements \r\n    without nesting issues.\r\n    */\r\n    getRef() {\r\n\r\n    }\r\n\r\n    /*\r\n    This function is part of the initialization process and is called after the DOM elements are \r\n    created. Its main purpose is to get the needed references to the DOM elements, attach focus events \r\n    and do further initialization (call setters for example). Most of the subclasses will augment this \r\n    method for their initialization. If needed it calls the afterRenderChildren method to initialize \r\n    nested controls.\r\n    */\r\n    afterRender() {\r\n        if (this._bRenderChildren) {\r\n            this.afterRenderChildren();\r\n        }\r\n\r\n        //  Add key listener if handlers are registered\r\n        if (this._aKeyHandlers.length > 0) {\r\n            df.dom.on(\"keydown\", this._eElem, this.onKeyDownHandler, this);\r\n        }\r\n\r\n        this.fire(\"OnRender\");\r\n\r\n        this.attachFocusEvents();\r\n\r\n        //  Apply properties\r\n        this.set_psTextColor(this.psTextColor);\r\n        if (this.psBackgroundColor) {\r\n            this.set_psBackgroundColor(this.psBackgroundColor);\r\n        }\r\n\r\n        this.dragDropInit();\r\n\r\n        this.OnAfterRender.fire(this);\r\n    }\r\n\r\n    /* \r\n    Destroy the DOM elements and remove all DOM Event handlers to prevent memory leaks.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        super.destroy();\r\n\r\n        if (this._eElem) {\r\n            df.dom.clear(this._eElem, true);\r\n            if (this._eElem.parentNode) {\r\n                this._eElem.parentNode.removeChild(this._eElem);\r\n            }\r\n        }\r\n        this._eElem = null;\r\n    }\r\n\r\n\r\n    /*\r\n    This function is called after this control is shown. It recursively calls its children if \r\n    _bRenderChildren is true. It is triggered by the webapp, views, card container and the pbRender \r\n    setter. It is meant to be augmented by controls when they need to execute special code when this \r\n    happens.\r\n    */\r\n    afterShow() {\r\n        this._bShown = true;\r\n        this.OnAfterShow.fire(this);\r\n\r\n        if (this._bRenderChildren) {\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof WebBaseUIObject && this._aChildren[i].pbRender) {\r\n                    this._aChildren[i].afterShow();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function is called after this control is hidden. It recursively calls its children if \r\n    _bRenderChildren is true. It is triggered by the webapp, views, card container and the pbRender \r\n    setter. It is meant to be augmented by controls when they need to execute special code when this \r\n    happens.\r\n    */\r\n    afterHide() {\r\n\r\n        this._bShown = false;\r\n        this.OnAfterHide.fire(this);\r\n\r\n        if (this._bRenderChildren) {\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof WebBaseUIObject && this._aChildren[i].pbRender) {\r\n                    this._aChildren[i].afterHide();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    attachFocusEvents() {\r\n\r\n    }\r\n\r\n    renderChildren(eContainer) {\r\n        eContainer = eContainer || this._eElem;\r\n\r\n        //  Call children and append them to ourselves\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            const oChild = this._aChildren[i];\r\n\r\n            //  Check if we can actually render the object\r\n            if (oChild instanceof WebBaseUIObject) {\r\n                const eChild = oChild.render();\r\n\r\n                if (eChild) {\r\n                    eContainer.appendChild(eChild);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    afterRenderChildren() {\r\n        //  Call children\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (this._aChildren[i] instanceof WebBaseUIObject) {\r\n                this._aChildren[i].afterRender();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Determines if the UI object is active which means that it is visible and enabled. The previewer will \r\n    override this function to enable functionality inside the previewer.  \r\n    \r\n    @return True if the UI object is active.\r\n    @private\r\n    */\r\n    isActive() {\r\n        return this.pbRender && this.pbVisible && this.isEnabled();\r\n    }\r\n\r\n    /* \r\n    Determines if the UI Object is enabled. As controls inside disabled containers should disable as \r\n    well it also looks at the enabled state of the parents. \r\n    \r\n    @return True if the control is enabled.\r\n    */\r\n    isEnabled() {\r\n        if (!this.pbEnabled) {\r\n            return false;\r\n        } else if (this._oParent instanceof WebBaseUIObject) {\r\n            return this._oParent.isEnabled();\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /* \r\n    Updates the enabled state of the control. It makes sure the right enabled state is applied and it \r\n    notifies child controls to update their enabled state.\r\n    */\r\n    updateEnabled() {\r\n\r\n        this.applyEnabled(this.isEnabled());\r\n\r\n        if (this._bRenderChildren) {\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof WebBaseUIObject) {\r\n                    this._aChildren[i].updateEnabled();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Applies the current enabled state by setting / removing the \"Web_Enabled\" and \"Web_Disabled\" CSS \r\n    classes. Subclasses will augment this function to properly disable the specific controls.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        // df.debug(\"applyEnabled called on: (\" + df.sys.ref.getConstructorName(this) + \") \" + this.getLongName());\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, df.CssDisabled, !bVal);\r\n            df.dom.toggleClass(this._eElem, df.CssEnabled, bVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method generates the CSS classname that is applied to the outermost DOM element of this \r\n    control. It combines _sBaseClass, _sControlClass, psCSSClass and pbEnabled. Subclasses that want to \r\n    add more CSS classes will augment this method. It is called during initialization and when the \r\n    psCSSClass is set.\r\n    \r\n    Note: Changes made here should also be made in WebAppPreviewer.js!\r\n    \r\n    @return String containing the CSS Classes.\r\n    @private\r\n    */\r\n    genClass() {\r\n        return this._sBaseClass + \" \" + this._sControlClass + \" \" + (this.isEnabled() ? df.CssEnabled : df.CssDisabled) + (this.psCSSClass ? \" \" + this.psCSSClass : \"\");\r\n    }\r\n\r\n    // - - - - - - - Setters & Getters - - - - - - -\r\n\r\n    set_psTextColor(sVal) {\r\n        if (this._eElem) {\r\n            this._eElem.style.color = sVal || '';\r\n        }\r\n    }\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eElem) {\r\n            this._eElem.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    set_pbVisible(bVal) {\r\n        if (this._eElem) {\r\n            this._eElem.style.visibility = (bVal ? '' : 'hidden');\r\n        }\r\n    }\r\n\r\n    set_pbRender(bVal) {\r\n        if (this._eElem) {\r\n            this._eElem.style.display = (bVal ? '' : 'none');\r\n\r\n            if (this.pbRender !== bVal) {\r\n                this.pbRender = bVal;\r\n\r\n                //  Trigger after hide / show\r\n                if (this.pbRender) {\r\n                    this.afterShow();\r\n                } else {\r\n                    this.afterHide();\r\n                }\r\n\r\n                //  The parent panel to recalculate its sizes\r\n                this.sizeChanged(true);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter of pbEnabled which updates the enabled state (only if it actually changed).\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbEnabled(bVal) {\r\n        if (bVal !== this.pbEnabled) {\r\n            this.pbEnabled = bVal;\r\n\r\n            this.updateEnabled();\r\n        }\r\n    }\r\n\r\n    set_psCSSClass(sVal) {\r\n        this.psCSSClass = sVal;\r\n\r\n        if (this._eElem) {\r\n            this._eElem.className = this.genClass();\r\n        }\r\n    }\r\n\r\n    set_psHtmlId(sVal) {\r\n        if (this._eElem) {\r\n            this._eElem.id = sVal;\r\n        }\r\n    }\r\n\r\n    // - - - - - - - Supportive - - - - - - -\r\n\r\n    /* \r\n    Registers a key handler for the provided key combination. The key handlers are stored in an array \r\n    and are accessed when a key event occurs. An array of messages that need to be triggered on the \r\n    server is stored with the key information.\r\n    \r\n    @param  sServerMsg  String message name of server-side handler message.\r\n    @param  iKeyCode    Integer key code (event.keyCode).\r\n    @param  bShift      Idicates if shift needs to be pressed.\r\n    @param  bAlt        Indicates if alt needs to be pressed.\r\n    @param  bCtrl       Indicates if ctrl needs to be pressed.\r\n    \r\n    @client-action\r\n    */\r\n    addKeyHandler(sServerMsg, iKeyCode, bShift, bAlt, bCtrl) {\r\n\r\n        //  Convert to JS type\r\n        iKeyCode = df.toInt(iKeyCode);\r\n        bShift = df.toBool(bShift);\r\n        bAlt = df.toBool(bAlt);\r\n        bCtrl = df.toBool(bCtrl);\r\n\r\n        //  Check if no key handler is defined for this key\r\n        const oKH = this.findKeyHandler(iKeyCode, bShift, bAlt, bCtrl);\r\n\r\n        if (oKH) {\r\n            //  Add to existing handler if message isn't already registered\r\n            for (let i = 0; i < oKH.aMsg.length; i++) {\r\n                if (oKH.aMsg[i] === sServerMsg) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            oKH.aMsg.push(sServerMsg);\r\n        } else {\r\n            //  Add key handler if not already added\r\n            if (this._aKeyHandlers.length === 0 && this._eElem) {\r\n                df.dom.on(\"keydown\", this._eElem, this.onKeyDownHandler, this);\r\n            }\r\n\r\n            //  Register new key handler\r\n            this._aKeyHandlers.push({\r\n                iKey: iKeyCode,\r\n                aMsg: [sServerMsg],\r\n                bShift: bShift,\r\n                bAlt: bAlt,\r\n                bCtrl: bCtrl\r\n            });\r\n        }\r\n    }\r\n\r\n    /* \r\n    Removes a registered key handler based on the details used when it is added. \r\n    \r\n    @param  sServerMsg  String message name of server-side handler message.\r\n    @param  iKeyCode    Integer key code (event.keyCode).\r\n    @param  bShift      Idicates if shift needs to be pressed.\r\n    @param  bAlt        Indicates if alt needs to be pressed.\r\n    @param  bCtrl       Indicates if ctrl needs to be pressed.\r\n    \r\n    @client-action\r\n    */\r\n    removeKeyHandler(sServerMsg, iKeyCode, bShift, bAlt, bCtrl) {\r\n\r\n        //  Convert to JS types\r\n        iKeyCode = df.toInt(iKeyCode);\r\n        bShift = df.toBool(bShift);\r\n        bAlt = df.toBool(bAlt);\r\n        bCtrl = df.toBool(bCtrl);\r\n\r\n        //  Search key handler\r\n        const oKH = this.findKeyHandler(iKeyCode, bShift, bAlt, bCtrl);\r\n\r\n        if (oKH) {\r\n            //  Remove message\r\n            for (let i = 0; i < oKH.aMsg.length; i++) {\r\n                if (oKH.aMsg[i] === sServerMsg) {\r\n                    oKH.aMsg.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            //  Remove entire handler no more messages\r\n            if (!oKH.aMsg.length) {\r\n                this._aKeyHandlers.slice(oKH.iIndex, 1);\r\n            }\r\n        }\r\n\r\n        //  Remove DOM handler if no more handlers\r\n        if (this._aKeyHandlers.length === 0 && this._eElem) {\r\n            df.dom.off(\"keydown\", this._eElem, this.onKeyDownHandler, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Searches the array of key handlers for a specific key and returns the handler object. It adds an \r\n    extra property iIndex to the object that contains the array index of the key handler.\r\n    \r\n    @param  iKeyCode    Integer key code (event.keyCode).\r\n    @param  bShift      Idicates if shift needs to be pressed.\r\n    @param  bAlt        Indicates if alt needs to be pressed.\r\n    @param  bCtrl       Indicates if ctrl needs to be pressed.\r\n    \r\n    @return Key handler object (null if none found).\r\n    @private\r\n    */\r\n    findKeyHandler(iKeyCode, bShift, bAlt, bCtrl, iIndexOut) {\r\n\r\n        //  Loop all handlers to find specific handler\r\n        for (let i = 0; i < this._aKeyHandlers.length; i++) {\r\n            const oH = this._aKeyHandlers[i];\r\n\r\n            if (oH.iKey === iKeyCode && oH.bShift === bShift && oH.bAlt === bAlt && oH.bCtrl === bCtrl) {\r\n                oH.iIndex = i;\r\n\r\n                return oH;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /* \r\n    Event handler for the onkey event. It searches for a key handler and if found it triggers the server \r\n    actions that belong to it. \r\n    \r\n    @param  oEvent  Event object.\r\n    */\r\n    onKeyDownHandler(oEvent) {\r\n\r\n        //  Search handler\r\n        const oKH = this.findKeyHandler(oEvent.getKeyCode(), oEvent.getShiftKey(), oEvent.getAltKey(), oEvent.getCtrlKey());\r\n\r\n        if (oKH) {\r\n            // Trigger validate on the focussed object before triggering the key handler (if this is a\r\n            // different object than the focussed object). Validate will fire OnChange and autofind if\r\n            // nessecary. This prevents those events from triggering after a view change that this key \r\n            // action could trigger.\r\n            if (this.getWebApp()._oCurrentObj && this.getWebApp()._oCurrentObj != this && this.getWebApp()._oCurrentObj.validate) {\r\n                this.getWebApp()._oCurrentObj.validate();\r\n            }\r\n\r\n            //  Perform server actions if found\r\n            for (let i = 0; i < oKH.aMsg.length; i++) {\r\n                this.serverAction(oKH.aMsg[i], [oKH.iKey, df.fromBool(oKH.bShift), df.fromBool(oKH.bAlt), df.fromBool(oKH.bCtrl)]);\r\n            }\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called by the server to pass the focus to this control.\r\n    \r\n    @client-action\r\n    */\r\n    svrFocus() {\r\n        const oW = this.getWebApp();\r\n        if (oW) {\r\n            oW.ready(()=>{\r\n                this.focus();\r\n            }, this);\r\n        }else{\r\n            this.focus();\r\n        }\r\n    }\r\n\r\n    updateFocus(bFocus) {\r\n        if (bFocus) {\r\n            this.objFocus();\r\n        } else {\r\n            this.getWebApp()?.objBlur(this);\r\n        }\r\n    }\r\n\r\n    onFocus(oEvent) {\r\n        this.updateFocus(true);\r\n    }\r\n\r\n    onBlur(oEvent) {\r\n        this.updateFocus(false);\r\n    }\r\n\r\n    /* \r\n    Registers this ui object as having the focus at the view and the webapp.\r\n    \r\n    @private\r\n    */\r\n    objFocus() {\r\n        const oV = this.getView(), oW = this.getWebApp();\r\n        if (oV) {\r\n            oV.objFocus(this);\r\n        }\r\n        if (oW) {\r\n            oW.objFocus(this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Gives the focus to the control. It will give the focus to the DOM element. This function is \r\n    overridden in sub classes if a different element actually holds the focus.\r\n    \r\n    @return     True if the object successfully takes the focus (false if not enabled or focusable).\r\n    @private\r\n    */\r\n    focus(bOptSelect) {\r\n        if (this._bFocusAble && this.isEnabled() && this._eElem && this._eElem.focus) {\r\n            this._eElem.focus();\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    The conditionalFocus only really gives the focus to an element on desktop browsers where on mobile \r\n    browsers it only registers the object as having the focus without actually giving the focus to the \r\n    DOM. It is used when the framework itself passes the focus to a control to prevent the on-screen \r\n    keyboard from popping up.\r\n    \r\n    @param  bOptSelect      Select the text in forms if true.\r\n    @return True if the focus is taken.\r\n    */\r\n    conditionalFocus(bOptSelect) {\r\n        if (!df.sys.isMobile) {\r\n            return this.focus(bOptSelect);\r\n        }\r\n        if (this._bFocusAble && this.isEnabled()) {\r\n            this.objFocus();\r\n\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Scrolls the main element of this UI object into the view. Relies on the scrollIntoView of browsers.\r\n    \r\n    @param  bAlignToTop     Tries to align the top element to the top of the view.\r\n    @client-action\r\n    */\r\n    scrollIntoView(bAlignToTop) {\r\n        if (this._eElem) {\r\n            this._eElem.scrollIntoView(df.toBool(bAlignToTop));\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function passes the focus to the next control. The next control is the next focussable sibling. \r\n    If not available it will go to the parent and try to focus thats next focusable sibling. Note that \r\n    this can be different the regular tab order. Used by pbAutoTab of cWebForm.\r\n    \r\n    @param  bOptSelect  Select the text in forms if true.\r\n    @return True if the focus is taken by a next control.\r\n    */\r\n    focusNext(bOptSelect) {\r\n        let oC = this, oP;\r\n\r\n        //  Go up in the structure untill we find a sibling that takes the focus\r\n        while ((oP = oC._oParent)) {\r\n\r\n            for (let i = oP._aChildren.indexOf(oC) + 1; i > 0 && i < oP._aChildren.length; i++) {\r\n                if (oP._aChildren[i].focus(bOptSelect)) {\r\n                    return true;\r\n                }\r\n            }\r\n            oC = oP;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called by setters or by child controls when the size has changes which mean that \r\n    everything might need to resize. We try to resize from the parent down but if no parent is available \r\n    we start at this level.\r\n    \r\n    @param  bPosition   True if the column layout positioning is affected by the size change and needs \r\n                        recalculation.\r\n    @private\r\n    */\r\n    sizeChanged(bPosition) {\r\n        const oWebApp = this.getWebApp();\r\n        let oObj = this;\r\n\r\n        if (bPosition) {\r\n            //  Set switch to trigger a position resize\r\n            if (this._oParent && this._oParent._bIsContainer) {\r\n                this._oParent._bPositionChanged = true;\r\n            }\r\n            if (this._bIsContainer) {\r\n                this._bPositionChanged = true;\r\n            }\r\n        }\r\n\r\n        if (oWebApp) {\r\n            oWebApp.objSizeChanged(this);\r\n            oWebApp.notifyLayoutChange(this);\r\n        } else {\r\n            //  Find view or webapp (we always want to start a resize there)\r\n            while (oObj._oParent && !(oObj._bIsView || oObj._bIsBaseApp)) {\r\n                oObj = oObj._oParent;\r\n            }\r\n\r\n            if (oObj && oObj.resize) {\r\n                oObj.resize();\r\n            }\r\n        }\r\n    }\r\n\r\n    fireSubmit() {\r\n        return (this._oParent && this._oParent.fireSubmit && this._oParent.fireSubmit());\r\n    }\r\n\r\n\r\n    /* \r\n    Makes sure that the control is visible by going up in the object structure looking for controls \r\n    that can hide the current control (like WebCards / WebTabPages).\r\n    \r\n    @private\r\n    */\r\n    makeVisible() {\r\n        this._oParent?.makeVisible?.();\r\n    }\r\n\r\n    /*\r\n    This function returns a CSS selector for the given df.WebUIContext.\r\n    \r\n    Any contexthandler, using this function, is able to request the selector.\r\n    The control can deduplicate the selector to make sure a change is reflected everywhere.\r\n    \r\n    @param eContext     A value repesented in df.WebUIContext\r\n    \r\n    @returns Either [null] if it is not a valid context for this control, or a string with the CSS selector.\r\n    */\r\n    determineSelectorForWebUIContext(eContext) {\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    This function returns either to true or false to verify whether the element is valid.\r\n    \r\n    Some controls don't use any different css selectors. As such we have to verify it by a referenced object.\r\n    For example this is the case in the treeView and the bFolder member.\r\n    \r\n    After the match is made we verify with this function whether it is a valid choice.\r\n    Otherwise we simply cancel the contextOpen.\r\n    \r\n    @param eElem The supposed valid element.\r\n    @param eContext The context it should be valid for.\r\n    \r\n    @returns Either true or false to make it a valid element.\r\n    */\r\n    verifyElementForWebUIContext(eElem, eContext) {\r\n        return true;\r\n    }\r\n\r\n    /*\r\n    This function retrieves the represented value from a WebUIContext.\r\n    \r\n    Any contexthandler, using this function, is able to request the data from an element given its df.WebUIContext.\r\n    \r\n    @param eElem        The element to get the context from.\r\n    @param eContext     The context wished to retrieve from the passed element.\r\n    \r\n    @returns Either [null] if the element is not valid for the df.WebUIContext, any type of value.\r\n    */\r\n    retrieveValueFromWebUIContext(eElem, eContext) {\r\n        return null;\r\n    }\r\n\r\n    // Drag drop\r\n\r\n    getDropData(oDropZone, oPosition) {\r\n        if (oDropZone && oDropZone._eDropElem) {\r\n            const dropData = {\r\n                data: (this.getControlValue && this.getControlValue()) || \"\",\r\n                action: df.dropActions.WebTagsForm.ciDropOnControl\r\n            }\r\n\r\n            return dropData;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    initDropZones() {\r\n        if (this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)) {\r\n            // mark entire elem as dropzone\r\n            this.addDropZone(this._eElem);\r\n        }\r\n    }\r\n\r\n    determineDropCandidate(oEv, aHelpers) {\r\n        if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebControl.ciDropOnControl))) {\r\n            return [this._eElem, df.dropActions.WebControl.ciDropOnControl];\r\n        }\r\n\r\n        return [null, null];\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        // Returns df.dropPositions.ciDropOn, ciDropBefore or ciDropAfter\r\n        return df.dropPositions.ciDropOn; // unknown\r\n    }\r\n\r\n    // We want to highlight the entire drop zone here, might have to change this a bit to make it more visible\r\n    interactWithDropElem(dropZone, eElem) {\r\n        dropZone.highlightElement();\r\n    }\r\n\r\n    // Should not be possible, but let's provide some default interaction just in case\r\n    doEmptyInteraction(dropZone) {\r\n        dropZone.highlightElement();\r\n\r\n        return df.dropActions.WebTagsForm.ciDropOnControl;\r\n    }\r\n\r\n    // We simply always want to return true to control the drop so that there is never an empty interaction\r\n    hasData() {\r\n        return true;\r\n    }\r\n\r\n    /*\r\n    Returns the 'top layer' element. This is the insertion point for controls like floating panels. \r\n    Usually this will return document.body, unless a control is located inside a modal dialog.\r\n    */\r\n    topLayer() {\r\n        return this._oParent?.topLayer?.() || null;\r\n    }\r\n\r\n    /**\r\n     * Determines the layout type for this container. If peLayoutType is set to ltInherit it will look at \r\n     * its parent container.\r\n     * \r\n     * @returns The layout type (constant df.layoutType).\r\n     */\r\n    layoutType() {\r\n        return this._oParent?.layoutType?.() || df.layoutType.ciLayoutTypeFlow;\r\n    }\r\n}","import { WebBaseUIObject } from './WebBaseUIObject.js';\r\n/* globals df */\r\n/* \r\nClass:\r\n    df.WebBaseControl\r\nExtends:\r\n    df.WebBaseUIObject\r\n\r\nThe WebBaseControl defines the API for all controls that participate within the column flow layout \r\nsystem. This makes it one of the core classes of the framework. It defines properties like \r\npiColumnIndex and piColumnSpan and has the API for setting the height of the controls. It can \r\ngenerate the wrapping DOM elements (several DIVs) that almost all controls need where subclasses \r\nwill usually fill these. As every control supports a label this class also generates and positions \r\nthe label.\r\n\r\nRevisions:\r\n    2011/08/02 (HW, DAW)\r\n        Initial version.\r\n*/\r\n\r\nexport class WebBaseControl extends WebBaseUIObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piColumnIndex\", 0);\r\n        this.prop(df.tInt, \"piColumnSpan\", 1);\r\n\r\n        this.prop(df.tInt, \"piRowSpan\", 1);\r\n        this.prop(df.tInt, \"piRowIndex\", 0);\r\n\r\n        this.prop(df.tBool, \"pbShowLabel\", true);\r\n        this.prop(df.tString, \"psLabel\", \"\");\r\n        this.prop(df.tInt, \"peLabelPosition\", 0);\r\n        this.prop(df.tInt, \"peLabelAlign\", -1);\r\n        this.prop(df.tInt, \"piLabelOffset\", -1);\r\n        this.prop(df.tString, \"psLabelColor\", \"\");\r\n\r\n        this.prop(df.tString, \"psToolTip\", \"\");\r\n\r\n        this.prop(df.tBool, \"pbFillHeight\", false);\r\n        this.prop(df.tInt, \"piHeight\", -1);\r\n        this.prop(df.tInt, \"piMinHeight\", 0);\r\n\r\n        this.event(\"OnFocus\", df.cCallModeDefault);\r\n        this.event(\"OnBlur\", df.cCallModeDefault);\r\n\r\n        //  @privates\r\n        this._eInner = null;\r\n        this._eLbl = null;\r\n        this._eControlWrp = null;\r\n        this._eControl = null;\r\n\r\n        this._oInfoBalloon = null;\r\n        this._oObserver = null;\r\n\r\n        this._sControlId = df.dom.genDomId();\r\n\r\n        //  Configure super classes\r\n        this._bFocusAble = true;\r\n        this._bHasFocus = false;\r\n        this._sBaseClass = \"WebControl\";\r\n        /*\r\n        Determines if this control needs setHeight to be called to stretch to the full cell height in\r\n        grid layout mode with pbFillHeight set to true. Defaults to true for compatiblity.\r\n        */\r\n        this._bJSSizing = true;\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        //  Outermost div for positioning by parent, inner div for margins / paddings\r\n        aHtml.push('<div class=\"', this.genClass(), '\"');\r\n        if (this.psHtmlId) {\r\n            aHtml.push(' id=\"', this.psHtmlId, '\"');\r\n        }\r\n\r\n        //  Insert the object name so the HTML element can be traced back to the right object\r\n        aHtml.push(' data-dfobj=\"', this.getLongName(), '\"');\r\n\r\n        aHtml.push(' style=\" ', (this.pbRender ? '' : 'display: none;'), (this.pbVisible ? '' : 'visibility: hidden;'), '\"');\r\n        aHtml.push('>');\r\n\r\n        //  Optionally label\r\n        if (this.pbShowLabel) {\r\n            // aHtml.push('<div class=\"WebCon_Inner\">');\r\n            aHtml.push('<div class=\"WebCon_Inner ', (this.pbFillHeight ? 'WebCon_FillRow' : ''), '\">');\r\n            if (this.peLabelPosition != df.ciLabelRight) {\r\n                aHtml.push(this.genLabelHtml());\r\n            }\r\n        } else {\r\n            aHtml.push('<div class=\"WebCon_Inner ', (this.pbFillHeight ? 'WebCon_FillRow' : ''), '\">');\r\n        }\r\n\r\n        //  Wrapper div for positioning of control\r\n        aHtml.push('<div>');\r\n    }\r\n\r\n    /*\r\n    Augment genClass to add the Web_FillHeight CSS class based on pbFillHeight.\r\n    */\r\n    genClass() {\r\n        return super.genClass() + (this.pbFillHeight ? \" Web_FillHeight\" : \"\") + (this._bJSSizing ? \" Web_JS_Sizing\" : \"\");\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        if (this.pbShowLabel && this.peLabelPosition == df.ciLabelRight) {\r\n            aHtml.push(this.genLabelHtml());\r\n        }\r\n\r\n        aHtml.push('</div></div>');\r\n    }\r\n\r\n    genLabelHtml() {\r\n        const aHtml = [];\r\n\r\n        if (!df.sys.isMobile) {\r\n            aHtml.push('<label for=\"', this._sControlId, '\" class=\"', ((this.peLabelPosition == df.ciLabelFloat && this.psValue == '') ? 'WebCon_Unfloat' : 'WebCon_Float'), '\" >', df.dom.encodeHtml(this.psLabel), '</label>');\r\n        } else {\r\n            aHtml.push('<label>', df.dom.encodeHtml(this.psLabel), '</label>');\r\n        }\r\n\r\n        return aHtml.join('');\r\n    }\r\n\r\n    afterRender() {\r\n        //  Get references\r\n        this._eInner = df.dom.query(this._eElem, \"div.WebCon_Inner\");\r\n        this._eControlWrp = df.dom.query(this._eElem, \"div.WebCon_Inner > div\");\r\n        if (this.pbShowLabel) {\r\n            this._eLbl = df.dom.query(this._eElem, \"div > label\");\r\n        }\r\n\r\n        super.afterRender();\r\n        if (this._eLbl) {\r\n            df.dom.on(\"click\", this._eLbl, this.onLblClick, this);\r\n        }\r\n\r\n        //  Call setters to apply properties\r\n        this.posLabel(true);\r\n        this.set_psLabelColor(this.psLabelColor);\r\n        this.set_peLabelAlign(this.peLabelAlign);\r\n\r\n        this.set_psToolTip(this.psToolTip);\r\n\r\n        if (this._bJSSizing || this.piHeight > 0) {\r\n            this.sizeHeight(-1);\r\n        }\r\n\r\n        if (this._oInfoBalloon) {\r\n            this._oInfoBalloon.init();\r\n            if (this._bShowInfoBallon) {\r\n                this._oInfoBalloon.show();\r\n            }\r\n        }\r\n\r\n        this.initObserver();\r\n    }\r\n\r\n    /*\r\n    Augment to initialize size observer if nessecary.\r\n    */\r\n    afterShow() {\r\n        super.afterShow();\r\n\r\n        this.initObserver();\r\n    }\r\n\r\n    /*\r\n    Augment to stop size observer if nessecary.\r\n    */\r\n    afterHide() {\r\n        super.afterHide();\r\n\r\n        this.destroyObserver();\r\n    }\r\n\r\n    /* \r\n    Augment destroy to destroy the infoballoon that might have been created.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        super.destroy();\r\n\r\n        this._eLbl = null;\r\n        this._eControlWrp = null;\r\n        this._eInner = null;\r\n        this._eControl = null;\r\n\r\n        if (this._oInfoBalloon) {\r\n            this._oInfoBalloon.destroy();\r\n            this._oInfoBalloon = null;\r\n        }\r\n\r\n        this.destroyObserver();\r\n    }\r\n\r\n\r\n    /*\r\n    Handler for the click event on the label. It calls the focus method to pass the focus to the \r\n    control. This is done manually here to emulate this behavior for controls with an artificial focus.\r\n    \r\n    @param  oEvent      DOM Event Object.\r\n    @private\r\n    */\r\n    onLblClick(oEvent) {\r\n        if (!df.sys.isMobile) {\r\n            this.focus();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    set_psLabel(sVal) {\r\n        if (this._eLbl) {\r\n            if (!sVal) {\r\n                sVal = \" \";\r\n            }\r\n            df.dom.setText(this._eLbl, sVal);\r\n        }\r\n    }\r\n\r\n    set_pbShowLabel(bVal) {\r\n        this.pbShowLabel = bVal;\r\n\r\n        this.posLabel(false);\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_psLabelColor(sVal) {\r\n        if (this._eLbl) {\r\n            this._eLbl.style.color = sVal;\r\n        }\r\n    }\r\n\r\n    set_peLabelAlign(iVal) {\r\n        if (this._eLbl) {\r\n            this._eLbl.style.textAlign = (iVal === df.ciAlignLeft ? \"left\" : (iVal === df.ciAlignCenter ? \"center\" : (iVal === df.ciAlignRight ? \"right\" : \"\")));\r\n        }\r\n    }\r\n\r\n    set_piLabelOffset(iVal) {\r\n        this.piLabelOffset = iVal;\r\n\r\n        this.posLabel(false);\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_peLabelPosition(iVal) {\r\n        this.peLabelPosition = iVal;\r\n\r\n        this.posLabel(false);\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_psToolTip(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.title = sVal;\r\n        }\r\n    }\r\n\r\n    set_piColumnIndex(iVal) {\r\n        if (this.piColumnIndex !== iVal) {\r\n            this.piColumnIndex = iVal;\r\n\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    set_piColumnSpan(iVal) {\r\n        if (this.piColumnSpan !== iVal) {\r\n            this.piColumnSpan = iVal;\r\n\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    set_psTextColor(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.color = sVal || '';\r\n        }\r\n    }\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.background = sVal || '';\r\n            // this._eControl.style.backgroundColor = sVal || '';\r\n            // this._eControl.style.backgroundImage = (sVal ? 'none' :'');\r\n        }\r\n    }\r\n\r\n    set_piMinHeight(iVal) {\r\n        if (this._eControl) {\r\n            if (this.piMinHeight !== iVal) {\r\n                this.piMinHeight = iVal;\r\n\r\n                // Call sizing sytem to recalculate sizes\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    set_piHeight(iVal) {\r\n        if (this._eControl) {\r\n            if (this.piHeight !== iVal) {\r\n                this.piHeight = iVal;\r\n\r\n                // Call sizing sytem to recalculate sizes\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    set_pbFillHeight(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eElem, \"Web_FillHeight\", bVal);\r\n\r\n            if (this.pbFillHeight !== bVal) {\r\n                this.pbFillHeight = bVal;\r\n\r\n                // Call sizing sytem to recalculate sizes\r\n                this.sizeChanged(true);\r\n            }\r\n\r\n            this.initObserver();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Initializes the ResizeObserver if nessecary. This allows us to listen to size changes in the grid so that\r\n    our control can respond to that. In grid layout the grid determines the height of controls with pbFillHeight\r\n    set to true. So the ResizeObserver is only created when this control is inside a grid layout and pbFillHeight\r\n    is true and _bJSSizing is set to false.\r\n    */\r\n    initObserver() {\r\n        if (this._bJSSizing && this.isInGridContainer() && this.pbFillHeight) {\r\n            this.createObserver();\r\n        } else {\r\n            this.destroyObserver();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Creates the size observer object.\r\n    */\r\n    createObserver() {\r\n        if (!this._eElem || this._oObserver) return;\r\n\r\n        this._oObserver = new ResizeObserver((entries) => {\r\n            let nHeight = entries[0]?.contentRect.height;\r\n            if (!nHeight) {\r\n                nHeight = this._eElem.getBoundingClientRect()?.height || 0;\r\n            }\r\n            this.sizeHeight(nHeight);\r\n        });\r\n\r\n        this._oObserver.observe(this._eElem);\r\n    }\r\n\r\n    /*\r\n    Destroys the size observer object.\r\n    */\r\n    destroyObserver() {\r\n        if (this._oObserver) {\r\n            this._oObserver.disconnect();\r\n            this._oObserver = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Augment sizeChanged and perform a sizeHeight if we are not fill height. If we are fillheight the \r\n     * sizeHeight will be triggered via the resize logic of the container. The sizeHeight will recalculate \r\n     * internal control sizes if the control implements setHeight.\r\n     * \r\n     * @param {Boolean} bPosition \r\n     */\r\n    sizeChanged(bPosition) {\r\n        if (this._eControl && !this.pbFillHeight) {\r\n            this.sizeHeight(-1);\r\n        }\r\n\r\n        super.sizeChanged(bPosition);\r\n    }\r\n\r\n    sizeHeight(iExtHeight) {\r\n        let iHeight = -1, bSense = false;\r\n\r\n        //  Determine which height to use\r\n        if (this.pbFillHeight) {\r\n            iHeight = iExtHeight;\r\n\r\n            bSense = iExtHeight > 0;\r\n        } else if (this.piHeight > 0) {\r\n            iHeight = this.piHeight;\r\n            bSense = true;\r\n        }\r\n\r\n        //  Respect minimal height\r\n        if (iHeight < this.piMinHeight) {\r\n            iHeight = this.piMinHeight;\r\n\r\n            bSense = bSense || !this.pbFillHeight;\r\n        }\r\n\r\n        //  Update the height\r\n        this.setHeight(iHeight, bSense);\r\n\r\n        //  Return the final height\r\n        if (iHeight > 0) {\r\n            return iHeight;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Sets the height of the control taking margins, borders and the label into account.\r\n    \r\n    @param  iHeight     The height in pixels.\r\n    @param  bSense      If false the size is expected to not be the final size.\r\n    */\r\n    setHeight(iHeight, bSense) {\r\n        if (this._eControl) {\r\n            //  If a negative value is given we should size 'naturalEly'\r\n            if (iHeight > 0) {\r\n                iHeight -= this.getVertHeightDiff();\r\n\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height\r\n                this._eControl.style.height = iHeight + \"px\";\r\n            } else {\r\n                this._eControl.style.height = \"\";\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Calculates the height difference that is substracted from the height before applied on _eControl. \r\n    It looks at the vertical box difference of several elements and the label.\r\n    \r\n    @return Number of pixels to substract from the height.\r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = 0;\r\n\r\n        //  If the label is on top we reduce that (note that this means that piMinHeight and piHeight are including the label)\r\n        if ((this.peLabelPosition === df.ciLabelTop || this.peLabelPosition === df.ciLabelFloat) && this._eLbl) {\r\n            iResult += this._eLbl.offsetHeight;\r\n        }\r\n\r\n        //  Substract the wrapping elements\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eInner);\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eControlWrp);\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eControl);\r\n\r\n        return iResult;\r\n    }\r\n\r\n    /* \r\n    Updates the control its label based on the pbShowLabel, psLabel, peLabelPostion and piLabelOffset \r\n    properties. It will do this by setting CSS Classnames, calculating margins and removing / generating \r\n    the label element. This method is called by the setters of these properties.\r\n    \r\n    @private\r\n    */\r\n    posLabel(bFirst) {\r\n        const iPos = this.peLabelPosition, iOffset = this.piLabelOffset;\r\n        let sClass, sColumns = \"\", sRows = \"\";\r\n\r\n        if (this._eElem) {\r\n            //  Remove all label classes\r\n            if (!bFirst) {\r\n                df.dom.removeClass(this._eInner, \"WebCon_HasLabel WebCon_TopLabel WebCon_RightLabel WebCon_LeftLabel\");\r\n            }\r\n\r\n            if (!this.pbShowLabel) {\r\n                //  Remove from the DOM\r\n                if (this._eLbl) {\r\n                    df.dom.off(\"click\", this._eLbl, this.onLblClick, this);\r\n                    this._eLbl.parentNode.removeChild(this._eLbl);\r\n                    this._eLbl = null;\r\n                }\r\n            } else {\r\n                //  Add to the DOM \r\n                if (!this._eLbl) {\r\n                    if (!df.sys.isMobile) {\r\n                        this._eLbl = df.dom.create('<label for=\"' + this._sControlId + '\" class=\"' + ((this.peLabelPosition == df.ciLabelFloat && this.psValue == '') ? 'unfloat' : 'float') + '\">&nbsp;</label>');\r\n                    } else {\r\n                        this._eLbl = df.dom.create('<label>&nbsp;</label>');\r\n                    }\r\n\r\n                    this.set_psLabel(this.psLabel);\r\n                    this.set_psLabelColor(this.psLabelColor);\r\n                    this.set_peLabelAlign(this.peLabelAlign);\r\n\r\n                    this._eInner.insertBefore(this._eLbl, this._eInner.firstChild);\r\n\r\n                    df.dom.on(\"click\", this._eLbl, this.onLblClick, this);\r\n                }\r\n                if (!bFirst) {\r\n                    df.dom.addClass(this._eInner, \"WebCon_HasLabel\");\r\n                }\r\n\r\n                //  Determine the classname and the required margin\r\n                switch (iPos) {\r\n                    case df.ciLabelLeft:\r\n                        sClass = \"WebCon_LeftLabel\";\r\n                        if (iOffset > 0) sColumns = `${iOffset}px minmax(0, 1fr)`;\r\n                        break;\r\n                    case df.ciLabelTop:\r\n                        if (iOffset > 0) sRows = `${iOffset}px minmax(0, 1fr)`;\r\n                        sClass = \"WebCon_TopLabel\";\r\n                        break;\r\n                    case df.ciLabelFloat:\r\n                        sClass = \"WebCon_TopLabel WebCon_FloatEnabled\";\r\n                        break;\r\n                    case df.ciLabelRight:\r\n                        sClass = \"WebCon_RightLabel\";\r\n                        if (iOffset > 0) sColumns = `minmax(0, 1fr) ${iOffset}px`;\r\n                        break;\r\n                }\r\n\r\n                //  Set CSS class on the inner div\r\n                df.dom.addClass(this._eInner, sClass);\r\n            }\r\n            this._eInner.style.gridTemplateColumns = sColumns;\r\n            this._eInner.style.gridTemplateRows = sRows;\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - Information Balloon API - - - - - - - \r\n    /* \r\n    Used by the InfoBalloon class to determine where to align the info ballon on to.\r\n    \r\n    @private\r\n    */\r\n    getTooltipElem() {\r\n        return this._eControlWrp;\r\n    }\r\n\r\n    /*\r\n    Shows the info balloon with the provided CSS classname and content (html). \r\n    \r\n    @param  sCssClass   The CSS classname applied to the balloon for styling.\r\n    @param  sText       The HTML content displayed inside the balloon.\r\n    @param  bShow       True if the the info balloon should be shown immediately\r\n    @client-action\r\n    */\r\n    showInfoBalloon(sCssClass, sText, bShow) {\r\n        bShow = df.toBool(bShow);\r\n\r\n        if (this._oInfoBalloon) {\r\n            this._oInfoBalloon.psCssClass = sCssClass;\r\n            this._oInfoBalloon.psMessage = sText;\r\n            this._oInfoBalloon.update();\r\n        } else {\r\n            this._oInfoBalloon = new df.InfoBalloon(this, sCssClass, sText);\r\n        }\r\n        if (this._eElem) {\r\n            this._oInfoBalloon.init();\r\n\r\n            if (bShow) {\r\n                this._oInfoBalloon.show();\r\n            }\r\n        } else {\r\n            this._bShowInfoBallon = bShow;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides the info balloon that is shown using showInfoBalloon.\r\n    \r\n    @client-action\r\n    */\r\n    hideInfoBalloon() {\r\n        if (this._oInfoBalloon) {\r\n            this._oInfoBalloon.hide();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Implement the resize method to resize & reposition the info balloon (if displayed).\r\n    */\r\n    resize() {\r\n        if (this._oInfoBalloon) {\r\n            this._oInfoBalloon.resize();\r\n        }\r\n\r\n        this._aChildren.forEach(function (oC) {\r\n            if (oC.resize) {\r\n                oC.resize();\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @returns True if this control is located inside a container that uses the grid layout.\r\n     */\r\n    isInGridContainer() {\r\n        return this._oParent?.isGridLayout?.();\r\n    }\r\n\r\n    // - - - - - - - - - Focus Handling - - - - - - - - - \r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eControl && this._eControl.focus) {\r\n            try {\r\n                this._eControl.focus();\r\n            } catch (oErr) {\r\n\r\n            }\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    attachFocusEvents() {\r\n        //  Every major browser now supports focusin & focusout, so we don't need to capture\r\n        df.dom.on(\"focusin\", this._eElem, this.onFocus, this);\r\n        df.dom.on(\"focusout\", this._eElem, this.onBlur, this);\r\n    }\r\n\r\n\r\n    updateFocus(bFocus) {\r\n        super.updateFocus(bFocus);\r\n\r\n        df.dom.toggleClass(this._eElem, \"WebCon_Focus\", bFocus);\r\n\r\n        if (bFocus) {\r\n            this.fire(\"OnFocus\");\r\n        } else {\r\n            this.fire(\"OnBlur\");\r\n        }\r\n\r\n        this._bHasFocus = bFocus;\r\n    }\r\n\r\n\r\n}","import { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { WebBaseControl } from './WebBaseControl.js';\r\n\r\n/*\r\nClass:\r\n    df.WebBaseContainer\r\nExtends:\r\n    df.WebBaseUIObject\r\n\r\nThis class is the client-side representation of the WebBaseContainer class. It is implemented as a \r\nmixing (WebBaseContainer_mixin) but usually the WebBaseContainer inheriting from WebBaseUIObject is \r\nused by (WebPanel, WebApp, WebWindow..). The WebGroup uses the mixin and there WebBaseControl is \r\nused as the main class.\r\n\r\nRevision:\r\n    2011/08/01  (HW, DAW) \r\n        Initial version.\r\n    2011/10/06  (HW, DAW)\r\n        Rewrote the sizing.\r\n    2013/11/11  (HW, DAW)\r\n        Refactored into a mixin to support the new WebGroup.\r\n*/\r\n/*global df*/\r\nexport const WebBaseContainer_mixin = superclass => class extends superclass {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piColumnCount\", 1);\r\n        this.prop(df.tInt, \"piWidth\", 0);\r\n        this.prop(df.tInt, \"piMinWidth\", 0);\r\n        this.prop(df.tInt, \"piHeight\", 0);\r\n        this.prop(df.tInt, \"piMinHeight\", 0);\r\n        this.prop(df.tBool, \"pbScroll\", false);\r\n\r\n        this.prop(df.tInt, \"peLayoutType\", df.layoutType.ciLayoutTypeFlow); // 0 = flow, 1 = grid\r\n        this.prop(df.tInt, \"piRowCount\", 0); // 0 = auto, anything above is a fixed row grid\r\n        this.prop(df.tString, \"psRowHeights\", ''); // format : \"ROWNUM/PXVALUE ROWNUM/PXVALUE,...\" eg. \"1/30 4/70 5/1fr\" can also use fractions\r\n        this.prop(df.tInt, \"piDefaultRowHeight\", -1); // Default height for rows if no specific value is given (-1 = use engine default, currently 20px)\r\n        this.prop(df.tString, \"psColumnWidths\", ''); // format : \"COLNUM/PXVALUE COLNUM/PXVALUE,...\" eg. \"1/30 5/1fr\" can also use fractions\r\n        this.prop(df.tString, \"psDefaultColumnWidth\", '1fr'); // Default width for columns if no specific value is given\r\n\r\n\r\n        // @privates\r\n        this._oRegionTop = null;\r\n        this._oRegionLeft = null;\r\n        this._oRegionCenter = null;\r\n        this._oRegionRight = null;\r\n        this._oRegionBottom = null;\r\n\r\n        this._eRegionTop = null;\r\n        this._eMainArea = null;\r\n        this._eRegionLeft = null;\r\n        this._eRegionCenter = null;\r\n        this._eContent = null;\r\n        this._eRegionRight = null;\r\n        this._eRegionBottom = null;\r\n        this._eContainer = null;\r\n\r\n        this._aUIObjects = [];\r\n        this._aPanels = [];\r\n        this._aFloats = [];\r\n\r\n        this._bHasFill = false;\r\n        this._iContentHeight = null;\r\n        this._bRendered = false;\r\n        this._bPanels = false;\r\n        this._bIsPanel = false;\r\n\r\n        this._bPositionChanged = true; //  Switch indicating that the column / panel layout positioning has changed and needs to be reapplied\r\n        this._bIsContainer = true; //  Indicator used to recognize containers as instanceof won't always work for mixins\r\n        this._iWantedHeight = null;\r\n        this._bWantedChanged = false;\r\n        this._iWhiteSpaceHeight = 0; // Total whitespace height reserved by setting row heights in grid mode\r\n        this._aRowsTemplate = [];\r\n        this._aColsTemplate = [];\r\n        this._iTotalRowHeight = 0;\r\n\r\n        //  Configure super classes\r\n        this._bRenderChildren = true;\r\n        this._sBaseClass = \"WebContainer\";\r\n    }\r\n\r\n    // - - - - Rendering - - - -\r\n\r\n    /*\r\n    Augment the openHtml method and add the HTML with the panel wrapper DIV elements.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        //  Call the super\r\n        super.openHtml(aHtml);\r\n\r\n        //  Allow subclass to slip in HTML\r\n        this.wrpOpenHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebCon_Sizer\">');\r\n    }\r\n\r\n    /*\r\n    Augment the closeHtml method and add the HTML with the panel wrapper DIV elements.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n\r\n        if (this._bPanels) {\r\n            aHtml.push('<div class=\"WebCon_Main\">');\r\n        } else {\r\n            aHtml.push('<div class=\"WebCon_Content' + (this.isGridLayout() ? ' WebCon_GridLayout' : '') + '\">');\r\n        }\r\n\r\n        aHtml.push('</div></div>');\r\n\r\n        //  Allow subclass to slip in HTML\r\n        this.wrpCloseHtml(aHtml);\r\n\r\n        //  Call the super\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpOpenHtml(aHtml) {\r\n\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpCloseHtml(aHtml) {\r\n\r\n    }\r\n\r\n\r\n    /*\r\n    Augment afterRender to call setters.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        this._bRendered = true;\r\n\r\n        df.events.addDomListener(\"scroll\", this._eElem, this.onScroll, this);\r\n    }\r\n\r\n    /*\r\n    Panels are containers so we have to call our child components to render themselves.\r\n    \r\n    @private\r\n    */\r\n    render() {\r\n\r\n        //  Call super (make sure that it doesn't render children right away\r\n        this._bRenderChildren = false;\r\n        const eElem = super.render();\r\n        this._bRenderChildren = true;\r\n\r\n        //  Get references to the regions\r\n        this._eSizer = df.dom.query(this._eElem, \"div.WebCon_Sizer\");\r\n        this._iLastInnerHeight = -1;\r\n\r\n        if (this._bPanels) {\r\n            this._eMainArea = df.dom.query(this._eElem, \"div.WebCon_Main\");\r\n        } else {\r\n            this._eContent = df.dom.query(this._eElem, \"div.WebCon_Content\");\r\n        }\r\n\r\n        //    Also get reference to container already (when doing that later there are multiple containers inside while for WebWindow the container is a sub element as well)\r\n        this._eContainer = df.dom.query(this._eElem, \"div.WebContainer\") || this._eElem;\r\n\r\n\r\n\r\n        //  Render children\r\n        this.renderChildren();\r\n\r\n        // Call positioning system\r\n        this.position();\r\n\r\n        return eElem;\r\n    }\r\n\r\n    /*\r\n    Override the renderChildren method with support for panels.\r\n    \r\n    @private\r\n    */\r\n    renderChildren() {\r\n        let eChild;\r\n\r\n        //  Render floating controls\r\n        for (let i = 0; i < this._aFloats.length; i++) {\r\n            eChild = this._aFloats[i].render();\r\n\r\n            if (eChild) {\r\n                this._eSizer.appendChild(eChild);\r\n            }\r\n        }\r\n\r\n        //  Call children and append them to ourselves\r\n        if (this._bPanels) {\r\n            //  Give a nice error when controls and panels are mixed up\r\n            if (this._aUIObjects.length > 0) {\r\n                throw new df.Error(999, \"Web controls and panels cannot be siblings within the same container object '{{0}}'. Consider placing them within a panel.\", this, [(this.getLongName() || 'oWebApp')]);\r\n            }\r\n\r\n            this._eMainArea.style.position = \"relative\";\r\n\r\n            this._eMainArea.appendChild(df.dom.create('<div style=\"clear: both;\"></div>'));\r\n\r\n\r\n            //  Render the panels\r\n            for (let i = 0; i < this._aPanels.length; i++) {\r\n                eChild = this._aPanels[i].render();\r\n            }\r\n\r\n            //  Place the panels in the DOM\r\n            this.placePanels();\r\n            this._bPositionChanged = false;\r\n        } else {\r\n            //  Render children and append them to the DOM\r\n            for (let i = 0; i < this._aUIObjects.length; i++) {\r\n                eChild = this._aUIObjects[i].render();\r\n\r\n                if (eChild) {\r\n                    this._eContent.appendChild(eChild);\r\n                }\r\n            }\r\n\r\n            //  Append clear element\r\n            if (this.isFlowLayout()) {\r\n                this._eContent.appendChild(df.dom.create('<div style=\"clear: both;\"></div>'));\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augmenting the addChild method to register UIObjects and panels separately.\r\n    \r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        if (oChild instanceof WebBaseUIObject) {\r\n            if (oChild._bFloating) {\r\n                this._aFloats.push(oChild);\r\n            } else if (oChild.peRegion !== undefined) {\r\n                this._bPanels = true;\r\n\r\n                this._aPanels.push(oChild);\r\n            } else {\r\n                this._aUIObjects.push(oChild);\r\n            }\r\n        }\r\n\r\n        super.addChild(oChild);\r\n    }\r\n\r\n\r\n    /*\r\n    Inserts a single object (and its children) into the child structure of this object, \r\n    at a specific index.\r\n    */\r\n    insertChild(oChild, iIndex) {\r\n        if (oChild instanceof WebBaseUIObject) {\r\n            if (oChild._bFloating) {\r\n                this._aFloats.push(oChild);\r\n            } else if (oChild.peRegion !== undefined) {\r\n                this._bPanels = true;\r\n                this._aPanels.push(oChild);\r\n            } else {\r\n                this._aUIObjects.splice(iIndex, 0, oChild);\r\n            }\r\n        }\r\n\r\n        super.insertChild(oChild, iIndex);\r\n    }\r\n\r\n    /*\r\n    Renders a specific child object. \r\n    eOptChild is an optional parameter that contains an existing DOM object for this web object.\r\n    */\r\n    renderChild(oChild, eOptChild) {\r\n        let eBefore, bMoveOperation;\r\n\r\n        if (eOptChild) {\r\n            bMoveOperation = true;\r\n        }\r\n\r\n        const iIndex = this._aUIObjects.indexOf(oChild);\r\n        const oInsertAfter = iIndex >= 1 ? this._aUIObjects[iIndex - 1] : null;\r\n        const eChild = eOptChild || oChild.render();\r\n\r\n        if (oChild._bIsPanel) {\r\n            switch (oChild.peRegion) {\r\n                case df.ciRegionBottom:\r\n                    this._eRegionBottom = eChild;\r\n                    this._oRegionBottom = oChild;\r\n                    break;\r\n\r\n                case df.ciRegionCenter:\r\n                    this._eRegionCenter = eChild;\r\n                    this._oRegionCenter = oChild;\r\n                    break;\r\n\r\n                case df.ciRegionLeft:\r\n                    this._eRegionLeft = eChild;\r\n                    this._oRegionLeft = oChild;\r\n                    break;\r\n\r\n                case df.ciRegionRight:\r\n                    this._eRegionRight = eChild;\r\n                    this._oRegionRight = oChild;\r\n                    break;\r\n\r\n                case df.ciRegionTop:\r\n                    this._eRegionTop = eChild;\r\n                    this._oRegionTop = oChild;\r\n                    break;\r\n            }\r\n\r\n            this.placePanels();\r\n        } else if (this._eContent) {\r\n            if (eChild) {\r\n                if (oInsertAfter !== null) {\r\n                    eBefore = oInsertAfter._eElem.nextElementSibling;\r\n                } else {\r\n                    // oInsertAfter is null when the element to be inserted is the first\r\n                    // child object of its parent. \r\n                    eBefore = this._eContent.firstElementChild;\r\n\r\n                    if (eBefore) {\r\n                        while (!eBefore.getAttribute(\"data-dfobj\") && eBefore.nextElementSibling) {\r\n                            eBefore = eBefore.nextElementSibling;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this._eContent.insertBefore(eChild, eBefore);\r\n            }\r\n        }\r\n\r\n\r\n        if (!bMoveOperation) {\r\n            oChild.afterRender();\r\n        }\r\n\r\n        this.position();\r\n\r\n        super.renderChild(oChild, eOptChild);\r\n    }\r\n\r\n    /*\r\n    Removes a child object from the parent's list of children.\r\n    */\r\n    removeChild(oChild) {\r\n        let iIndex;\r\n\r\n        if (oChild instanceof WebBaseUIObject) {\r\n            if (oChild._bFloating) {\r\n                iIndex = this._aFloats.indexOf(oChild);\r\n                this._aFloats.splice(iIndex, 1);\r\n            } else if (oChild.peRegion !== undefined) {\r\n                iIndex = this._aPanels.indexOf(oChild);\r\n\r\n                if (this._aPanels.length === 0) {\r\n                    this._bPanels = false;\r\n                }\r\n\r\n                this._aPanels.splice(iIndex, 1);\r\n            } else {\r\n                iIndex = this._aUIObjects.indexOf(oChild);\r\n                this._aUIObjects.splice(iIndex, 1);\r\n            }\r\n        }\r\n\r\n        super.removeChild(oChild);\r\n    }\r\n\r\n\r\n    /* \r\n    Unrenders a child object.\r\n    */\r\n    unrenderChild(oChild) {\r\n        const eChild = oChild._eElem;\r\n\r\n        if (oChild._bIsPanel) {\r\n            switch (oChild.peRegion) {\r\n                case df.ciRegionBottom:\r\n                    this._eRegionBottom = null;\r\n                    this._oRegionBottom = null;\r\n                    break;\r\n\r\n                case df.ciRegionCenter:\r\n                    this._eRegionCenter = null;\r\n                    this._oRegionCenter = null;\r\n                    break;\r\n\r\n                case df.ciRegionLeft:\r\n                    this._eRegionLeft = null;\r\n                    this._oRegionLeft = null;\r\n                    break;\r\n\r\n                case df.ciRegionRight:\r\n                    this._eRegionRight = null;\r\n                    this._oRegionRight = null;\r\n                    break;\r\n\r\n                case df.ciRegionTop:\r\n                    this._eRegionTop = null;\r\n                    this._oRegionTop = null;\r\n                    break;\r\n            }\r\n        } else if(oChild instanceof WebBaseControl){\r\n            this._eContent.removeChild(eChild);\r\n        }\r\n\r\n        this.position();\r\n\r\n        super.unrenderChild(oChild);\r\n    }\r\n\r\n    /* \r\n    Loops over the panels and assigns them to the proper regions moving their DOM elements to the right \r\n    place. Is called from preparesize when positioning has changed and during initialization.\r\n    \r\n    The dom structure is:\r\n    \r\n    _eRegionTop\r\n    _eMainPanel\r\n        _eRegionLeft    (no specific order)\r\n        _eRegionCenter  (no specific order)\r\n        _eRegionRight   (no specific order)\r\n    _eRegionBottom\r\n    \r\n    @private\r\n    */\r\n    placePanels() {\r\n        let ePnl;\r\n\r\n        this._oRegionTop = null;\r\n        this._oRegionLeft = null;\r\n        this._oRegionCenter = null;\r\n        this._oRegionRight = null;\r\n        this._oRegionBottom = null;\r\n\r\n        this._eRegionTop = null;\r\n        this._eRegionLeft = null;\r\n        this._eRegionCenter = null;\r\n        this._eRegionRight = null;\r\n        this._eRegionBottom = null;\r\n\r\n        for (let i = 0; i < this._aPanels.length; i++) {\r\n            const oPnl = this._aPanels[i];\r\n\r\n            if (oPnl.peRegion === df.ciRegionCenter) {\r\n                if (this._oRegionCenter) {\r\n                    throw new df.Error(999, \"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.\", this, [oPnl._sName, this._oRegionCenter._sName]);\r\n                }\r\n\r\n                this._oRegionCenter = oPnl;\r\n\r\n                this._eRegionCenter = ePnl = oPnl._eElem;\r\n                if (ePnl.parentNode != this._eMainArea) {\r\n                    this._eMainArea.appendChild(ePnl);\r\n                }\r\n\r\n                ePnl.style.position = \"absolute\";\r\n                ePnl.style.top = \"0px\";\r\n                ePnl.style.right = \"0px\";\r\n                ePnl.style.left = \"0px\";\r\n                ePnl.style.bottom = \"0px\";\r\n            } else if (oPnl.peRegion === df.ciRegionTop) {\r\n                if (this._oRegionTop) {\r\n                    throw new df.Error(999, \"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.\", this, [oPnl._sName, this._oRegionTop._sName]);\r\n                }\r\n\r\n                this._oRegionTop = oPnl;\r\n\r\n                this._eRegionTop = ePnl = oPnl._eElem;\r\n                if (ePnl.parentNode != this._eMainArea.parentNode || ePnl.nextElementSibling != this._eMainArea) {\r\n                    this._eMainArea.parentNode.insertBefore(ePnl, this._eMainArea);\r\n                }\r\n\r\n                ePnl.style.position = \"\";\r\n                ePnl.style.top = \"\";\r\n                ePnl.style.left = \"\";\r\n                ePnl.style.right = \"\";\r\n                ePnl.style.bottom = \"\";\r\n            } else if (oPnl.peRegion === df.ciRegionLeft) {\r\n                if (this._oRegionLeft) {\r\n                    throw new df.Error(999, \"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.\", this, [oPnl._sName, this._oRegionLeft._sName]);\r\n                }\r\n\r\n                this._oRegionLeft = oPnl;\r\n                this._eRegionLeft = ePnl = oPnl._eElem;\r\n                if (ePnl.parentNode != this._eMainArea) {\r\n                    this._eMainArea.appendChild(ePnl);\r\n                }\r\n\r\n                ePnl.style.position = \"absolute\";\r\n                ePnl.style.top = \"0px\";\r\n                ePnl.style.left = \"0px\";\r\n                ePnl.style.right = \"\";\r\n                ePnl.style.bottom = \"0px\";\r\n            } else if (oPnl.peRegion === df.ciRegionRight) {\r\n                if (this._oRegionRight) {\r\n                    throw new df.Error(999, \"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.\", this, [oPnl._sName, this._oRegionRight._sName]);\r\n                }\r\n\r\n                this._oRegionRight = oPnl;\r\n\r\n                this._eRegionRight = ePnl = oPnl._eElem;\r\n                if (ePnl.parentNode != this._eMainArea) {\r\n                    this._eMainArea.appendChild(ePnl);\r\n                }\r\n\r\n                ePnl.style.position = \"absolute\";\r\n                ePnl.style.top = \"0px\";\r\n                ePnl.style.left = \"\";\r\n                ePnl.style.right = \"0px\";\r\n                ePnl.style.bottom = \"0px\";\r\n            } else if (oPnl.peRegion === df.ciRegionBottom) {\r\n                if (this._oRegionBottom) {\r\n                    throw new df.Error(999, \"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.\", this, [oPnl._sName, this._oRegionBottom._sName]);\r\n                }\r\n\r\n                this._oRegionBottom = oPnl;\r\n\r\n                this._eRegionBottom = ePnl = oPnl._eElem;\r\n                if (ePnl.parentNode != this._eMainArea.parentNode || ePnl.previousElementSibling != this._eMainArea) {\r\n                    this._eMainArea.parentNode.appendChild(ePnl);\r\n                }\r\n\r\n                ePnl.style.position = \"\";\r\n                ePnl.style.top = \"\";\r\n                ePnl.style.left = \"\";\r\n                ePnl.style.right = \"\";\r\n                ePnl.style.bottom = \"\";\r\n            } else {\r\n                throw new df.Error(999, \"Invalid value for peRegion of '{{0}}'\", this, [oPnl._sName]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Extend the element class with the WebScroll classname if pbScroll is true.\r\n    */\r\n    genClass() {\r\n        let sClass = super.genClass();\r\n\r\n        if (this.pbScroll) {\r\n            sClass += \" WebScroll\";\r\n        }\r\n\r\n        return sClass;\r\n    }\r\n\r\n    // - - - - Sizing - - - -\r\n\r\n    /*\r\n    This recursive method is called as the start of a resize action. It calculates the minimal height \r\n    that a container needs and it determines if the panel wants to stretch or not. Center, left and \r\n    right panels can stretch and if they stretch then their parent wants to stretch as well. The \r\n    resizeHorizontal and resizeVertical methods depend on the results of this method.\r\n\r\n\r\n    _iMinHeight:    The minimal height that this container needs to display its content.\r\n    _iWantedHeight: The ideal height for this container (the natural height of the content).\r\n    _bStretch:      True if this container wants to stretch (there are things inside that want to stretch or pbFillHeight is set).\r\n\r\n    \r\n    @private\r\n    */\r\n    prepareSize() {\r\n        let iNeeded = 0, iHeight = 0, iMiddleNeeded = 0, iMiddle = 0, iCur;\r\n        const iPrevWanted = this._iWantedHeight;\r\n\r\n        this._bStretch = false;\r\n\r\n        for (let i = 0; i < this._aFloats.length; i++) {\r\n            if (this._aFloats[i].prepareSize) {\r\n                this._aFloats[i].prepareSize();\r\n            }\r\n        }\r\n\r\n        //  Determine content size\r\n        if (this._bPanels) {\r\n            //  Recalculate positioning if switch is set\r\n            if (this._bPositionChanged) {\r\n                this.placePanels();\r\n\r\n                this._bPositionChanged = false;\r\n            }\r\n\r\n            //  Visit all panels and determine what height they want\r\n            if (this._oRegionTop && this._oRegionTop.pbRender) {\r\n                iNeeded += this._oRegionTop.prepareSize();\r\n                iHeight += this._oRegionTop._iWantedHeight;\r\n            }\r\n\r\n            //  We take the highest of left, right and center\r\n            if (this._oRegionCenter && this._oRegionCenter.pbRender) {\r\n                iMiddleNeeded = this._oRegionCenter.prepareSize();\r\n                iMiddle = this._oRegionCenter._iWantedHeight;\r\n\r\n                this._bStretch = this._oRegionCenter._bStretch || this._bStretch;\r\n            }\r\n            if (this._oRegionLeft && this._oRegionLeft.pbRender) {\r\n                iCur = this._oRegionLeft.prepareSize();\r\n                iMiddleNeeded = (iCur > iMiddleNeeded ? iCur : iMiddleNeeded);\r\n                iMiddle = (this._oRegionLeft._iWantedHeight > iMiddle ? this._oRegionLeft._iWantedHeight : iMiddle);\r\n\r\n                //  Stretch if left panel wants to stretch\r\n                this._bStretch = this._oRegionLeft._bStretch || this._bStretch;\r\n            }\r\n            if (this._oRegionRight && this._oRegionRight.pbRender) {\r\n                iCur = this._oRegionRight.prepareSize();\r\n                iMiddleNeeded = (iCur > iMiddleNeeded ? iCur : iMiddleNeeded);\r\n                iMiddle = (this._oRegionRight._iWantedHeight > iMiddle ? this._oRegionRight._iWantedHeight : iMiddle);\r\n\r\n                //  Stretch if right panel wants to stretch\r\n                this._bStretch = this._oRegionRight._bStretch || this._bStretch;\r\n            }\r\n            iHeight += iMiddle;\r\n\r\n            if (this._oRegionBottom && this._oRegionBottom.pbRender) {\r\n                iNeeded += this._oRegionBottom.prepareSize();\r\n                iHeight += this._oRegionBottom._iWantedHeight;\r\n            }\r\n\r\n            const iDiff =  this.getHeightDiff(true, true, true, true);\r\n            iHeight += iDiff;\r\n            iNeeded += iDiff;\r\n        } else {\r\n            //  Recalculate positioning if switch is set\r\n            if (this._bPositionChanged) {\r\n                this.position();\r\n\r\n                this._iContentHeight = null;\r\n\r\n                this._bPositionChanged = false;\r\n            }\r\n\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i].prepareSize && !(this._aChildren[i]._bIsView)) { //  Skip views, they are called by the WebApp\r\n                    this._aChildren[i].prepareSize();\r\n                }\r\n            }\r\n\r\n            if (this._bHasFill) {\r\n                if (this.isGridLayout()) {\r\n                    iHeight = 1; // Grid layout does not calculate heights in JavaScript\r\n                } else {\r\n                    if (!this._iContentHeight) {\r\n                        this.resizeColumnLayout();\r\n                    }\r\n                    iHeight += this._iContentHeight + this.getHeightDiff(true, true, true, true);\r\n                }\r\n\r\n            } else {\r\n                iHeight += df.dom.clientHeight(this._eContent) + this.getHeightDiff(true, true, true, false);\r\n            }\r\n        }\r\n\r\n        //  Determine _iWantedHeight & _iMinHeight\r\n        this._iMinHeight = iNeeded;\r\n        if ((this._bIsPanel && this.piHeight > 0 && (this.peRegion == df.ciRegionBottom || this.peRegion == df.ciRegionTop)) ||\r\n            (!this._bIsPanel && this.piHeight > 0)) {\r\n            this._iWantedHeight = this.piHeight;\r\n        } else {\r\n            this._iWantedHeight = (iHeight > this.piMinHeight ? iHeight : this.piMinHeight);\r\n        }\r\n\r\n        //  Indicate if the size changed (so parents like the tab container can respond)\r\n        this._bWantedChanged = iPrevWanted !== this._iWantedHeight;\r\n\r\n        //  Determine if we want to stretch\r\n        if (this.peRegion !== df.ciRegionTop && this.peRegion !== df.ciRegionBottom) {\r\n            if ((this.piHeight <= 0 && this._bHasFill) || (this._bIsView && this.pbFillHeight)) {\r\n                this._bStretch = true;\r\n            }\r\n        }\r\n\r\n        //  Mark ourself as prepared for sizing\r\n        this._bSizePrep = true;\r\n        \r\n        return (this.pbScroll ? 0 : this._iWantedHeight);\r\n    }\r\n\r\n    /*\r\n    This recursive method performs the horizontal size actions that are needed. It sizes left and right \r\n    panels and sets the inner width (based on piMinWidth) which might cause a scrollbar. Horizontal \r\n    sizing is done first so that vertical sizing can handle scrollbars that might appear.\r\n    \r\n    @private\r\n    */\r\n    resizeHorizontal() {\r\n        let iWidth = 0;\r\n\r\n        if (this._eElem) {\r\n            if (this._bPanels) {\r\n                //  Size the middle panels\r\n                if (this._oRegionLeft) {\r\n                    //  Determine width (use piWidth or calculate if not set)\r\n                    if (this._oRegionLeft.piWidth > 0) {\r\n                        iWidth = this._oRegionLeft.piWidth;\r\n                    } else if (this._oRegionRight && this._oRegionRight.pbRender) {\r\n                        iWidth = (this._eMainArea.clientWidth - (this._oRegionRight.piWidth || this._eMainArea.clientWidth / 3)) / 2;\r\n                    } else {\r\n                        iWidth = (this._eMainArea.clientWidth / 2);\r\n                    }\r\n\r\n                    //  Apply the width\r\n                    this._oRegionLeft.setOuterWidth(iWidth);\r\n                    if (this._eRegionCenter) {\r\n                        this._eRegionCenter.style.left = (this._oRegionLeft.pbRender ? iWidth + \"px\" : \"0px\");\r\n                    }\r\n                }\r\n                if (this._oRegionRight) {\r\n                    //  Determine width (use piWidth or calculate if not set)\r\n                    if (this._oRegionRight.piWidth > 0) {\r\n                        iWidth = this._oRegionRight.piWidth;\r\n                    } else if (this._oRegionLeft && this._oRegionLeft.pbRender) {\r\n                        iWidth = (this._eMainArea.clientWidth - (this._oRegionLeft.piWidth || this._eMainArea.clientWidth / 3)) / 2;\r\n                    } else {\r\n                        iWidth = (this._eMainArea.clientWidth / 2);\r\n                    }\r\n\r\n                    //  Apply width\r\n                    this._oRegionRight.setOuterWidth(iWidth);\r\n                    if (this._eRegionCenter) {\r\n                        this._eRegionCenter.style.right = (this._oRegionRight.pbRender ? iWidth + \"px\" : \"0px\");\r\n                    }\r\n                }\r\n            } else {\r\n                //  No panels, we apply piMinWidth\r\n                this.updateMinWidth();\r\n            }\r\n\r\n\r\n            //  Call children\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof WebBaseUIObject && !(this._aChildren[i]._bIsView)) { //  Skip views, they are called by the WebApp\r\n                    if (this._aChildren[i].pbRender && this._aChildren[i].resizeHorizontal) {\r\n\r\n                        this._aChildren[i].resizeHorizontal();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This recursive method performs the vertical sizing. It determines the size of sub panels and sets \r\n    the inner size when needed. The height of the top and bottom panels is determined by their piHeight \r\n    or their pre-calculated _iWantedHeight. Height of the middle area (left, center and right panels) is \r\n    determined by the available space and whether they are set to stretch or not.\r\n    \r\n    @private\r\n    */\r\n    resizeVertical() {\r\n        let iHeight, iMiddle, iCenter = 0, iLeft = 0, iRight = 0, iVSpace, iPanelHeight, bStretch = false;\r\n\r\n        if (this._eElem) {\r\n            //  Make sure we are prepared for sizing (pre calculations are done)\r\n            if (!this._bSizePrep) {\r\n                this.prepareSize();\r\n            }\r\n\r\n            if (this._bStretch || (this._bIsPanel && (this.peRegion === df.ciRegionLeft || this.peRegion === df.ciRegionCenter || this.peRegion === df.ciRegionRight))) {\r\n                iHeight = df.dom.clientHeight(this._eContainer) + this.getHeightDiff(true, false, false, false);\r\n                bStretch = true;\r\n\r\n                //  This is needed to make oOrder function when rendered into a div with no height using displayView (pbFillHeight inside a panel)\r\n                if (iHeight < this._iMinHeight) {\r\n                    iHeight = this._iMinHeight;\r\n                }\r\n            } else {\r\n                iHeight = this._iWantedHeight;\r\n            }\r\n\r\n            if (iHeight < this.piMinHeight) {\r\n                iHeight = this.piMinHeight;\r\n                bStretch = true;\r\n            }\r\n\r\n            if (this._bPanels) {\r\n                iVSpace = iHeight;\r\n                if (this._oRegionTop && this._oRegionTop.pbRender) {\r\n                    iPanelHeight = this._oRegionTop._iWantedHeight;\r\n\r\n                    //  We need to stretch ourself if more space is required\r\n                    if (iPanelHeight > iVSpace) {\r\n                        iHeight = iHeight + this._oRegionTop._iWantedHeight - iVSpace;\r\n                        iVSpace = iPanelHeight;\r\n                    }\r\n                    iVSpace -= iPanelHeight;\r\n\r\n                    this._oRegionTop.setOuterHeight(iPanelHeight);\r\n                }\r\n\r\n                if (this._oRegionBottom && this._oRegionBottom.pbRender) {\r\n                    iPanelHeight = this._oRegionBottom._iWantedHeight;\r\n\r\n                    //  We need to stretch ourself if more space is required\r\n                    if (iPanelHeight > iVSpace) {\r\n                        iHeight = iHeight + iPanelHeight - iVSpace;\r\n                        iVSpace = iPanelHeight;\r\n                    }\r\n                    iVSpace -= iPanelHeight;\r\n\r\n                    this._oRegionBottom.setOuterHeight(iPanelHeight);\r\n                }\r\n\r\n                //  Determine the available space for the middle section\r\n                const iMiddleSpace = iVSpace - this.getHeightDiff(true, true, true, true);\r\n\r\n                //  Determine the wanted height of the middle section\r\n                if (this._oRegionLeft && this._oRegionLeft.pbRender) {\r\n                    iLeft = this._oRegionLeft._iWantedHeight;\r\n                }\r\n                if (this._oRegionCenter && this._oRegionCenter.pbRender) {\r\n                    iCenter = this._oRegionCenter._iWantedHeight;\r\n                }\r\n                if (this._bIsBaseApp) {\r\n                    iCenter = (this._oCurrentView && this._oCurrentView._iWantedHeight) || 0;\r\n                }\r\n                if (this._oRegionRight && this._oRegionRight.pbRender) {\r\n                    iRight = this._oRegionRight._iWantedHeight;\r\n                }\r\n                const iMiddleWanted = Math.max(iLeft, iCenter, iRight);\r\n\r\n                //  Determine if we should stretch to occupy the available space or if we only take whats needed\r\n                if(this.pbScroll){\r\n                    iMiddle = Math.max(iMiddleWanted, iMiddleSpace);\r\n                }else if (bStretch || (this._oRegionLeft && this._oRegionLeft._bStretch) || (this._oRegionCenter) || (this._oRegionRight && this._oRegionRight._bStretch)) {\r\n                    iMiddle = iMiddleSpace;\r\n                } else {\r\n                    iMiddle = iMiddleWanted;\r\n                }\r\n\r\n\r\n                //  Apply middle height to the main area\r\n                if (iMiddle > 0) {\r\n                    this._eMainArea.style.height = iMiddle + \"px\";\r\n                }\r\n\r\n                //  Provide a hook for the webapp to size the view\r\n                this._iMiddleHeight = iMiddle;\r\n            } else {\r\n                if (this.isFlowLayout()) {\r\n                    this.resizeColumnLayout();\r\n                }\r\n\r\n                //  Scrollbars\r\n                this.setInnerHeight(iHeight);\r\n            }\r\n\r\n\r\n\r\n            //  Call children\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof WebBaseUIObject && !(this._aChildren[i]._bIsView)) {  //  Skip views, they are called by the WebApp\r\n                    if (this._aChildren[i].pbRender) {\r\n                        if (this._aChildren[i].resizeVertical) {\r\n                            this._aChildren[i].resizeVertical();\r\n                        } else if (this._aChildren[i].resize) {\r\n                            this._aChildren[i].resize();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._bSizePrep = false;\r\n        }\r\n    }\r\n\r\n    setOuterHeight(iHeight) {\r\n        iHeight -= this.getHeightDiff(true, false, false, false);\r\n        this._eElem.style.height = (iHeight > 0 ? iHeight + \"px\" : \"\");\r\n    }\r\n\r\n    setInnerHeight(iHeight) {\r\n        if (iHeight > 0) {\r\n            if (iHeight !== this._iLastInnerHeight) {\r\n                this._iLastInnerHeight = iHeight;\r\n\r\n                iHeight -= this.getHeightDiff(true, true, false, false);\r\n                this._eSizer.style.minHeight = (iHeight > 0 ? iHeight + \"px\" : \"\");\r\n            }\r\n        } else if (this._iLastInnerHeight > 0) {\r\n            this._iLastInnerHeight = iHeight;\r\n            this._eSizer.style.minHeight = \"\";\r\n        }\r\n    }\r\n\r\n    setOuterWidth(iWidth) {\r\n        iWidth -= df.sys.gui.getHorizBoxDiff(this._eElem, 1);\r\n        this._eElem.style.width = (iWidth > 0 ? iWidth + \"px\" : \"\");\r\n    }\r\n\r\n    setInnerWidth(iWidth) {\r\n        iWidth -= df.sys.gui.getHorizBoxDiff(this._eElem, 0);\r\n        iWidth -= df.sys.gui.getHorizBoxDiff(this._eSizer, 1);\r\n        this._eSizer.style.width = (iWidth > 0 ? iWidth + \"px\" : \"\");\r\n    }\r\n\r\n    updateMinWidth() {\r\n        let iWidth = this.piMinWidth;\r\n        iWidth -= df.sys.gui.getHorizBoxDiff(this._eElem, 0);\r\n        iWidth -= df.sys.gui.getHorizBoxDiff(this._eSizer, 1);\r\n\r\n        this._eSizer.style.minWidth = (iWidth > 0 ? iWidth + \"px\" : \"\");\r\n\r\n    }\r\n\r\n    /*\r\n    This method is called by the resize method to calculate to resize controls inside this container. It \r\n    calculates the heights of the controls with pbFillHeight set to true.\r\n    \r\n    @private\r\n    */\r\n    resizeColumnLayout() {\r\n        let iHeight = 0, iCol = 0, iRowHeight = 0, iMinHeight, iSpace, iSize, oStretch, iSpan;\r\n        const aStretch = [], iCount = this.piColumnCount;\r\n\r\n        //  FIX: On IE8 we are missing three pixels (don't know why)\r\n        if (df.sys.isIE && df.sys.iVersion <= 8) {\r\n            iHeight = 3;\r\n        }\r\n\r\n        //  Only do this if there are stretching controls\r\n        if (this._bHasFill) {\r\n            //  Loop through children\r\n            for (let i = 0; i < this._aUIObjects.length; i++) {\r\n                const oChild = this._aUIObjects[i];\r\n\r\n                if (oChild.pbRender) {\r\n                    //  Determine child index and span\r\n                    const iChildColIndex = (oChild.piColumnIndex == -1 ? 0 : oChild.piColumnIndex);\r\n                    const iIndex = (iChildColIndex + oChild.piColumnSpan <= iCount ? iChildColIndex : 0);\r\n                    if (iIndex + oChild.piColumnSpan > iCount || oChild.piColumnSpan <= 0) {\r\n                        iSpan = iCount - iIndex;\r\n                    } else {\r\n                        iSpan = oChild.piColumnSpan;\r\n                    }\r\n\r\n                    //  Detect that we move to the next row\r\n                    if (iCol > iIndex || iCol + iSpan > iCount) {\r\n                        //  Switch between stretch row\r\n                        if (oStretch) {\r\n                            oStretch.iHeight = iRowHeight;\r\n                            aStretch.push(oStretch);\r\n                            oStretch = null;\r\n                        } else {\r\n                            iHeight = iHeight + iRowHeight;\r\n                        }\r\n\r\n                        //  Reset values\r\n                        iRowHeight = 0;\r\n                        iCol = 0;\r\n                    }\r\n\r\n                    //  Check if this is a stretcher\r\n                    if (oChild.pbFillHeight) {\r\n                        //  Remember stretcher\r\n                        if (oStretch) {\r\n                            oStretch.aItems.push(oChild);\r\n                        } else {\r\n                            oStretch = {\r\n                                aItems: [oChild],\r\n                                iHeight: 0\r\n                            };\r\n                        }\r\n\r\n                        //  Obey minimum height\r\n                        if (oChild.getMinHeight) {\r\n                            iMinHeight = oChild.getMinHeight();\r\n                        } else {\r\n                            iMinHeight = oChild.piMinHeight;\r\n                        }\r\n\r\n                        if (iRowHeight < iMinHeight) {\r\n                            iRowHeight = iMinHeight;\r\n                        }\r\n                    } else {\r\n                        //  Check if this is the highest item in this row, if so we count this one\r\n                        const nOffset = df.dom.offsetHeight(oChild._eElem);\r\n                        if (nOffset > iRowHeight) {\r\n                            iRowHeight = nOffset;\r\n                        }\r\n                    }\r\n\r\n                    //  Remember current pos\r\n                    iCol = iIndex + (iSpan || 1);\r\n                }\r\n            }\r\n\r\n            //  Update administration for the last row\r\n            if (oStretch) {\r\n                oStretch.iHeight = iRowHeight;\r\n                aStretch.push(oStretch);\r\n            } else {\r\n                iHeight += iRowHeight;\r\n            }\r\n\r\n            this._iContentHeight = iHeight;\r\n\r\n            //  Determine available space\r\n            iSpace = df.dom.clientHeight(this._eContainer);\r\n\r\n            if (iSpace < this.piMinHeight) {\r\n                iSpace = this.piMinHeight;\r\n            }\r\n            iSpace = iSpace - this.getHeightDiff(false, true, true, true);\r\n            iSpace = iSpace - iHeight;\r\n            iSpace -= this._iWhiteSpaceHeight;\r\n\r\n            //  Loop through stretch rows\r\n            for (let i = 0; i < aStretch.length; i++) {\r\n                oStretch = aStretch[i];\r\n\r\n                //  Calculate height for this stretch row\r\n                iSize = iSpace / (aStretch.length - i);\r\n                iSize--;    // FIX: Take an extra pixel here (don't know why, needed for firefox)\r\n\r\n                //  Obey minimum row height\r\n                this._iContentHeight = this._iContentHeight + oStretch.iHeight;\r\n\r\n                if (iSize < oStretch.iHeight) {\r\n                    iSize = oStretch.iHeight;\r\n                }\r\n\r\n                //  Set heights\r\n                for (let x = 0; x < oStretch.aItems.length; x++) {\r\n                    oStretch.aItems[x].sizeHeight(iSize);\r\n                }\r\n\r\n                //  Space is now taken\r\n                iSpace -= iSize;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Determines the layout type for this container. If peLayoutType is set to ltInherit it will look at \r\n     * its parent container.\r\n     * \r\n     * @returns The layout type (constant df.layoutType).\r\n     */\r\n    layoutType() {\r\n        if (this.peLayoutType == df.layoutType.ciLayoutTypeInherit) {\r\n            return this._oParent?.layoutType?.() || df.layoutType.ciLayoutTypeFlow;\r\n        }\r\n        return this.peLayoutType;\r\n    }\r\n\r\n    /**\r\n     * @returns True if this container is using flow layout positioning.\r\n     */\r\n    isFlowLayout() {\r\n        return this.layoutType() == df.layoutType.ciLayoutTypeFlow;\r\n    }\r\n\r\n    /**\r\n     * @returns True if this container is using grid layout positioning.\r\n     */\r\n    isGridLayout() {\r\n        return this.layoutType() == df.layoutType.ciLayoutTypeGrid;\r\n    }\r\n\r\n    position() {\r\n        if (this.isFlowLayout() || this._bPanels) {\r\n            this.positionFlow();\r\n        } else {\r\n            this.positionGrid();\r\n        }\r\n    }\r\n\r\n    positionGrid() {\r\n        let iIndex, iColSpan;\r\n        const iColCount = this.piColumnCount;\r\n        const aRows = [];\r\n        const aCols = [];\r\n\r\n        const eContent = df.dom.query(this._eElem, '.WebCon_Content');\r\n\r\n        if (!eContent) { return; }\r\n\r\n        // Configure this container's grid\r\n        eContent.style.display = \"grid\";\r\n\r\n        const aColsCustWidths = this.parsePsColumnWidths();\r\n\r\n        for (let c = 0; c < iColCount; c++) {\r\n            const oCol = {\r\n                iIndex: c,\r\n                sWidth: -1, // -1 = use default\r\n                eType: df.rowColValType.ciTypeDefault\r\n            }\r\n\r\n            const oCustWidthCol = aColsCustWidths.find((col) => {\r\n                return col.iIndex == c;\r\n            });\r\n\r\n            if (oCustWidthCol) {\r\n                const sWidth = oCustWidthCol.sWidth;\r\n\r\n                // if (df.sys.math.isNumeric(sWidth)) {\r\n                //     sWidth = \"\" + sWidth + \"p\";\r\n                // }\r\n\r\n                oCol.sWidth = sWidth;\r\n                oCol.eType = oCustWidthCol.eType\r\n            }\r\n\r\n            aCols.push(oCol);\r\n        }\r\n        const sDefaultColumnWidth = this.getDefaultColumnWidth();\r\n\r\n        if (aColsCustWidths.length == 0) {\r\n            eContent.style.gridTemplateColumns = (\"repeat(\" + iColCount + \", \" + sDefaultColumnWidth + \")\");\r\n        } else {\r\n            eContent.style.gridTemplateColumns = aCols.map(tCol => {\r\n                switch (tCol.eType) {\r\n                    case df.rowColValType.ciTypeDefault:\r\n                        return sDefaultColumnWidth;\r\n                    case df.rowColValType.ciTypeFixed:\r\n                        return tCol.sWidth + \"px\";\r\n                    case df.rowColValType.ciTypeFraction:\r\n                        return tCol.sWidth\r\n                    case df.rowColValType.ciTypeOther:\r\n                        return tCol.sWidth\r\n                    default:\r\n                        return sDefaultColumnWidth;\r\n                }\r\n            }).join(' ');\r\n        }\r\n\r\n        const iDefaultHeight = this.getDefaultRowHeight();\r\n        const sDefaultRowHeight = this.genBaseRowHeightString(iDefaultHeight); \r\n\r\n        eContent.style.gridAutoRows = sDefaultRowHeight;\r\n\r\n        // Sort and extract total rows based on children\r\n        let [aChildren, iTotalRows] = this.sortChildren(this._aUIObjects);\r\n\r\n        if (iTotalRows < this.piRowCount) { iTotalRows = this.piRowCount }\r\n\r\n        // Check if we have any custom row heights or fill height rows\r\n        let aRowsCustHeights = [];\r\n        if (this.psRowHeights && this.psRowHeights != '') {\r\n            let iHighestRowNum;\r\n            [aRowsCustHeights, iHighestRowNum] = this.parsePsRowHeights();\r\n            if (iTotalRows <= iHighestRowNum) { iTotalRows = iHighestRowNum + 1 };\r\n        }\r\n\r\n        // \"Create\" all our rows, set custom row heights where needed\r\n        for (let r = 0; r < iTotalRows; r++) {\r\n            const oRow = {\r\n                iIndex: r,\r\n                sHeight: -1, // TODO: Determine which rows have controls. Empty rows get the default row height, rows with controls use 'auto'\r\n                eType: df.rowColValType.ciTypeDefault\r\n            };\r\n\r\n            const oCustHeightRow = aRowsCustHeights.find((row) => {\r\n                return row.iIndex == r;\r\n            });\r\n\r\n            if (oCustHeightRow) {\r\n                oRow.sHeight = oCustHeightRow.sHeight;\r\n                oRow.eType = oCustHeightRow.eType;\r\n            }\r\n\r\n            aRows.push(oRow);\r\n        }\r\n\r\n        // Store reference, needed for sizing children later\r\n        this._aRowsTemplate = aRows;\r\n        this._aColsTemplate = aCols;\r\n\r\n        // Construct grid row template\r\n        this._bHasFill = false; //  Set _bHasFill for resizeVertical\r\n\r\n        eContent.style.gridTemplateRows = aRows.map(tRow => {\r\n            switch (tRow.eType) {\r\n                case df.rowColValType.ciTypeDefault:\r\n                    return sDefaultRowHeight;\r\n                case df.rowColValType.ciTypeFixed:\r\n                    return tRow.sHeight + \"px\";\r\n                case df.rowColValType.ciTypeFraction:\r\n                    this._bHasFill = true;\r\n                    return tRow.sHeight\r\n                case df.rowColValType.ciTypeOther:\r\n                    return tRow.sHeight\r\n                default:\r\n                    return sDefaultRowHeight;\r\n            }\r\n        }).join(' ');\r\n\r\n        // Configure child positioning\r\n        aChildren.forEach(oChild => {\r\n            if (oChild._eElem && oChild.pbRender && oChild instanceof WebBaseControl) {\r\n\r\n                //  Determine child index and span\r\n                const iColIndex = (oChild.piColumnIndex + oChild.piColumnSpan <= iColCount ? oChild.piColumnIndex : 0);\r\n                if (iColIndex + oChild.piColumnSpan > iColCount || oChild.piColumnSpan <= 0) {\r\n                    iColSpan = iColCount - iIndex;\r\n                } else {\r\n                    iColSpan = oChild.piColumnSpan;\r\n                }\r\n\r\n                const sColIndex = (iColIndex > -1 ? (oChild.piColumnIndex + 1) : 'auto');\r\n                const sRowIndex = (oChild.piRowIndex > -1 ? (oChild.piRowIndex + 1) : 'auto');\r\n\r\n                iColSpan = (oChild.piColumnSpan > 0) ? oChild.piColumnSpan : 1;\r\n                const iRowSpan = (oChild.piRowSpan > 0) ? oChild.piRowSpan : 1;\r\n\r\n                oChild._eElem.style.gridColumn = \"\" + sColIndex + \" / span \" + iColSpan;\r\n                oChild._eElem.style.gridRow = sRowIndex + \" / span \" + iRowSpan;\r\n            }\r\n        });\r\n    }\r\n\r\n    determineRowHeights() {\r\n        const aRowHeights = [];\r\n\r\n        const eContent = df.dom.query(this._eElem, '.WebCon_Content');\r\n\r\n        if (!eContent) { return; }\r\n\r\n        let asRowHeights = window.getComputedStyle(eContent).gridTemplateRows.split(\" \");\r\n\r\n        for (let i = 0; i < asRowHeights.length; i++) {\r\n            aRowHeights.push(parseFloat(asRowHeights[i]));\r\n        }\r\n\r\n        return (aRowHeights);\r\n    }\r\n\r\n    determineColumnWidths() {\r\n        const aColWidths = [];\r\n\r\n        const eContent = df.dom.query(this._eElem, '.WebCon_Content');\r\n\r\n        if (!eContent) { return; }\r\n\r\n        const asColWidths = window.getComputedStyle(eContent).gridTemplateColumns.split(\" \");\r\n\r\n        for (let i = 0; i < asColWidths.length; i++) {\r\n            aColWidths.push(parseFloat(asColWidths[i]));\r\n        }\r\n\r\n        return (aColWidths);\r\n    }\r\n\r\n    parsePsColumnWidths() {\r\n        const aColsCustWidths = [];\r\n\r\n        try {\r\n            if (this.psColumnWidths && this.psColumnWidths != '') {\r\n                let asColsTemplate = this.psColumnWidths.split(' ');\r\n                for (let c = 0; c < asColsTemplate.length; c++) {\r\n                    let aColWidthParts = asColsTemplate[c].split('/');\r\n\r\n                    let eType = df.rowColValType.ciTypeOther;\r\n                    if (aColWidthParts[1].includes('fr')) {\r\n                        eType = df.rowColValType.ciTypeFraction;\r\n                    } else if (df.sys.math.isNumeric(aColWidthParts[1])) {\r\n                        eType = df.rowColValType.ciTypeFixed;\r\n                    }\r\n\r\n                    aColsCustWidths.push({\r\n                        iIndex: parseInt(aColWidthParts[0]),\r\n                        sWidth: aColWidthParts[1],\r\n                        eType: eType\r\n                    });\r\n                }\r\n            }\r\n        } catch (err) {\r\n            throw new df.Error(999, \"Unable to parse psColumnWidths, check the documentation for more info on the correct format\", this, []);\r\n        }\r\n\r\n        return aColsCustWidths;\r\n    }\r\n\r\n    parsePsRowHeights() {\r\n        // Check format before?\r\n        let iHighestRowIndex = 0;\r\n        const aRowsCustHeights = [];\r\n\r\n        try {\r\n            // Parse psRowHeights\r\n            let asRowHeights = this.psRowHeights.split(' ');\r\n            for (let i = 0; i < asRowHeights.length; i++) {\r\n                let aRowHeightParts = asRowHeights[i].split('/');\r\n                if (aRowHeightParts.length >= 2) {    // Ignore incorrect syntax\r\n                    let iIndex = parseInt(aRowHeightParts[0]);\r\n\r\n                    let eType = df.rowColValType.ciTypeOther;\r\n                    if (aRowHeightParts[1].includes('fr')) {\r\n                        eType = df.rowColValType.ciTypeFraction;\r\n                    } else if (df.sys.math.isNumeric(aRowHeightParts[1])) {\r\n                        eType = df.rowColValType.ciTypeFixed;\r\n                    }\r\n\r\n\r\n                    aRowsCustHeights.push({\r\n                        iIndex: iIndex,\r\n                        sHeight: aRowHeightParts[1],\r\n                        eType: eType\r\n                    });\r\n\r\n                    if (iIndex > iHighestRowIndex) { iHighestRowIndex = iIndex; }\r\n                }\r\n\r\n            }\r\n        } catch (err) {\r\n            throw new df.Error(999, \"Unable to parse psRowHeights, check the documentation for more info on the correct format\", this, []);\r\n        }\r\n\r\n        return [aRowsCustHeights, iHighestRowIndex];\r\n    }\r\n\r\n\r\n    sortChildren(aObjects) {\r\n        let iRowTotal = 1;\r\n\r\n        // Sort based on row index\r\n        const aSorted = aObjects.sort((a, b) => {\r\n            if (a.piRowIndex > b.piRowIndex) {\r\n                return 1;\r\n            }\r\n\r\n            if (a.piRowIndex < b.piRowIndex) {\r\n                return -1;\r\n            }\r\n\r\n            return 0;\r\n        });\r\n\r\n        return [aSorted, iRowTotal]\r\n    }\r\n\r\n    getDefaultRowHeight() {\r\n        if (this.piDefaultRowHeight > -1) {\r\n            return this.piDefaultRowHeight;\r\n        }\r\n\r\n        // ToDo: get this from somewhere...\r\n        return 20;\r\n    }\r\n\r\n    getDefaultColumnWidth() {\r\n        if ((this.psDefaultColumnWidth.trim()) != '') {\r\n            return this.psDefaultColumnWidth;\r\n        }\r\n\r\n        return '1fr';\r\n    }\r\n\r\n    /*\r\n    This method calculates and sets the positioning CSS attributes for controls inside this container \r\n    based on the column layout system. The horizontal positioning is done in percentages where the \r\n    number of columns determines the precision that is used.\r\n    \r\n    @private\r\n    */\r\n    positionFlow() {\r\n        let iCol = 0, iSpan;\r\n        const iCount = this.piColumnCount;\r\n\r\n        if (iCount <= 0) {\r\n            throw new df.Error(999, \"Invalid column count on '{{0}}'\", this, [this.getLongName() || \"oWebApp\"]);\r\n        }\r\n\r\n        //  Reset indicator for fill height components\r\n        this._bHasFill = false;\r\n\r\n        //  Loop through children\r\n        for (let i = 0; i < this._aUIObjects.length; i++) {\r\n            const oChild = this._aUIObjects[i];\r\n\r\n            if (oChild._eElem && oChild.pbRender && oChild instanceof WebBaseControl) {\r\n                //  Determine child index and span\r\n                const iChildColIndex = (oChild.piColumnIndex == -1 ? 0 : oChild.piColumnIndex);\r\n                const iIndex = (iChildColIndex + (oChild.piColumnSpan || 1) <= iCount ? iChildColIndex : 0);\r\n                if (iIndex + oChild.piColumnSpan > iCount || oChild.piColumnSpan <= 0) {\r\n                    iSpan = iCount - iIndex;\r\n                } else {\r\n                    iSpan = oChild.piColumnSpan;\r\n                }\r\n\r\n                //  All controls float\r\n                oChild._eElem.style.styleFloat = \"left\";    // IE8 FIX\r\n                oChild._eElem.style.cssFloat = \"left\";\r\n\r\n                //  Detect new row\r\n                if (iCol > iIndex || iCol + iSpan > iCount) {\r\n                    oChild._eElem.style.clear = \"left\";\r\n                    iCol = 0;\r\n                } else {\r\n                    oChild._eElem.style.clear = \"none\";\r\n                }\r\n\r\n                //  Calculate whitespace on the left\r\n                oChild._eElem.style.marginLeft = ((Math.floor((10000 / iCount)) / 100) * (iIndex - iCol)) + \"%\";\r\n\r\n                //  Remember current pos\r\n                iCol = iIndex + (iSpan || 1);\r\n\r\n                //  Calculate width\r\n                if (iSpan === iCount) {\r\n                    oChild._eElem.style.width = \"100%\";\r\n                } else {\r\n                    oChild._eElem.style.width = ((Math.floor((10000 / iCount)) / 100) * iSpan) + \"%\";\r\n                }\r\n            }\r\n\r\n            //  Indicate when we find a fill height component (that means we need to resize it)\r\n            this._bHasFill = this._bHasFill || oChild.pbFillHeight;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /*\r\n    This method determines the 'minimal height' required by this panel and its children. If there are \r\n    nested panels it will return the sum of the content height of these panels. If this panel has \r\n    controls it will measure the total size of these. When stretching controls are there \r\n    (with pbFillHeight) set to true it uses the _iContentHeight property which is calculated by the \r\n    resizeColumnLayout method. Else it simply takes the height of the content div element.\r\n    \r\n    @private\r\n    */\r\n    getRequiredHeight() {\r\n        //  Make sure we are prepared for sizing (pre calculations are done)\r\n        if (!this._bSizePrep) {\r\n            this.prepareSize();\r\n        }\r\n\r\n        this._bSizePrep = false;\r\n\r\n        return this._iWantedHeight;\r\n    }\r\n\r\n    // Convenience function to generate the \"default\" clause string for row heights\r\n    // Used so we can override this in subclasses\r\n    genBaseRowHeightString(iHeight) {\r\n        return (\"minmax(\" + iHeight + \"px, max-content)\");\r\n    }\r\n\r\n    /*\r\n    Calculates the height differences between the elements of the container. These are margins, paddings \r\n    and borders. The parameter Booleans indicate which parts should be included. The illustration shows  \r\n    the different parts.\r\n    \r\n    bOut        Container\r\n                +------\r\n    bIn         |  Sizer\r\n                |  +------\r\n    bContentOut |  |  Content\r\n                |  |  +------\r\n    bContentIn  |  |  |\r\n    \r\n    @param  bOut        Margin & border of the container element.\r\n    @param  bIn         Padding of the container + margin & border of the sizer.\r\n    @param  bContentOut Padding of the sizer + margin & border of the content element.\r\n    @param  bCOntentIn  Padding of the content element.\r\n    @private\r\n    */\r\n    getHeightDiff(bOut, bIn, bContentOut, bContentIn) {\r\n        let iHeight = 0;\r\n\r\n        if (bOut) {\r\n            if (this._eContainer) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eContainer, 3);\r\n            }\r\n        }\r\n        if (bIn) {\r\n            if (this._eContainer) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eContainer, 2);\r\n                iHeight += (this._eContainer.offsetHeight - this._eContainer.clientHeight); //  Horizontal Scrollbar!\r\n            }\r\n            if (this._eSizer) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eSizer, 1);\r\n            }\r\n        }\r\n        if (bContentOut) {\r\n            if (this._eSizer) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eSizer, 2);\r\n            }\r\n            if (this._eMainArea) {//  Allow paddings on the main area, even while this space will be below the top panel it still needs to be recogned with\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eMainArea, 2);\r\n            }\r\n            if (this._eContent) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eContent, 1);\r\n            }\r\n        }\r\n        if (bContentIn) {\r\n            if (this._eContent) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eContent, 2);\r\n                iHeight += 1; // Always add 1 pixel for pixel rounding issues\r\n            }\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /*\r\n    Calculates the width differences between the elements of the container. These are margins, paddings \r\n    and borders. The parameter Booleans indicate which parts should be included. The illustration shows  \r\n    the different parts.\r\n    \r\n    bOut        Container\r\n                +------\r\n    bIn         |  Sizer\r\n                |  +------\r\n    bContentOut |  |  Content\r\n                |  |  +------\r\n    bContentIn  |  |  |\r\n    \r\n    @param  bOut        Margin & border of the container element.\r\n    @param  bIn         Padding of the container + margin & border of the sizer.\r\n    @param  bContentOut Padding of the sizer + margin & border of the content element.\r\n    @param  bCOntentIn  Padding of the content element.\r\n    @private\r\n    */\r\n    getWidthDiff(bOut, bIn, bContentOut, bContentIn) {\r\n        let iWidth = 0;\r\n\r\n        if (bOut && this._eElem) {\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eElem, 0);\r\n        }\r\n        if ((bOut || bIn) && this._eContainer) {\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eContainer, (bOut && bIn ? 0 : (bOut ? 1 : 2)));\r\n        }\r\n        if ((bIn || bContentOut) && this._eSizer) {\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eSizer, (bIn && bContentOut ? 0 : (bIn ? 1 : 2)));\r\n        }\r\n        if (bContentOut && this._eMainArea) {//  Allow paddings on the main area, even while this space will be below the top panel it still needs to be recognized with\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eMainArea, 2);\r\n        }\r\n        if ((bContentOut || bContentIn) && this._eContent) {\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eContent, (bContentOut && bContentIn ? 0 : (bContentOut ? 1 : 2)));\r\n        }\r\n\r\n        return iWidth;\r\n    }\r\n\r\n    /*\r\n    This method determines the vertical space taken by the container component itself. It only \r\n    calculates the space that is inside the element that is actually sized.\r\n    \r\n    @return Amount of pixels taken.\r\n    */\r\n    getContentWidthDiff() {\r\n        let iWidth = 0;\r\n\r\n        if (this._eContent) {\r\n            iWidth += df.sys.gui.getHorizBoxDiff(this._eContent);\r\n        }\r\n\r\n        return iWidth;\r\n    }\r\n\r\n    onScroll(oEvent) {\r\n        const oWebApp = this.getWebApp();\r\n        if (oWebApp) {\r\n            oWebApp.notifyScroll(this);\r\n        }\r\n    }\r\n\r\n    // - - - - Special - - - -\r\n\r\n    focus(bOptSelect) {\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (this._aChildren[i].focus) {\r\n                if (this._aChildren[i].focus(bOptSelect)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    The conditionalFocus only really gives the focus to an element on desktop browsers where on mobile \r\n    browsers it only registers the object as having the focus without actually giving the focus to the \r\n    DOM.\r\n    \r\n    @param  bOptSelect      Select the text in forms if true.\r\n    @return True if the focus is taken.\r\n    */\r\n    conditionalFocus(bOptSelect) {\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (this._aChildren[i].conditionalFocus) {\r\n                if (this._aChildren[i].conditionalFocus(bOptSelect)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // - - - - Setters - - - - \r\n\r\n    set_piWidth(iVal) {\r\n        this.piWidth = iVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_piHeight(iVal) {\r\n        this.piHeight = iVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_piMinHeight(iVal) {\r\n        this.piMinHeight = iVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_piMinWidth(iVal) {\r\n        this.piMinWidth = iVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_piColumnCount(iVal) {\r\n        this.piColumnCount = iVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    set_psRowHeights(sVal) {\r\n        this.psRowHeights = sVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    set_psColumnWidths(sVal) {\r\n        this.psColumnWidths = sVal;\r\n\r\n        if (this._eElem) {\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eContainer) {\r\n            this._eContainer.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    /* \r\n    Enables / disables scrolling by toggling the WebScroll CSS class on the main element.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbScroll(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebScroll\", bVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n};\r\n\r\n//  Generate the actuall class based on WebBaseUIObject using the mixin\r\nexport class WebBaseContainer extends WebBaseContainer_mixin(WebBaseUIObject) {}\r\n","import { WebBaseControl } from './WebBaseControl.js';\r\n\r\n/*\r\nClass:\r\n    df.WebBaseDEO\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class is the client-side representation of the WebBaseDEO class that has most of the Data Entry \r\nObject logic.\r\n    \r\nRevision:\r\n    2011/07/16  (HW, DAW) \r\n        Initial version.\r\n*/\r\n/* global df */\r\n\r\n/*\r\nThis class adds most Data Entry Object logic to the inheritance tree. It contains a lot of the \r\nvalidation functionality and has support for masking & input filtering.\r\n*/\r\nexport class WebBaseDEO extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psValue\", \"\");\r\n        this.prop(df.tBool, \"pbChanged\", false);\r\n\r\n        this.prop(df.tInt, \"peDataType\", df.ciTypeText);\r\n        this.prop(df.tInt, \"piPrecision\", 0);\r\n        this.prop(df.tInt, \"piMaxLength\", 0);\r\n        this.prop(df.tBool, \"pbCapslock\", false);\r\n        this.prop(df.tBool, \"pbRequired\", false);\r\n        this.prop(df.tBool, \"pbLimitDateRange\", true)\r\n\r\n        this.prop(df.tInt, \"peAlign\", -1);\r\n        this.prop(df.tString, \"psMask\", \"\");\r\n\r\n        //  Events\r\n        this.event(\"OnAutoFind\", df.cCallModeDefault);\r\n        this.event(\"OnChange\", df.cCallModeDefault);\r\n        this.event(\"OnValidate\", df.cCallModeDefault);\r\n\r\n        //@privates\r\n        this._tValue = null;\r\n        this._sOrigValue = \"\";\r\n        this._sPrevChangeVal = null;\r\n        this._bValueInvalid = false;    // Indicates if the field value is invalid and shouldn't be sent to the server (if true psValue returns the origional value instead of the displayed value)\r\n\r\n        this._bMasks = true;\r\n        this._oMask = null;\r\n\r\n        this._bAutoFind = false;\r\n        this._bReplaceDecSepp = false; //  Used by filterNumeric (keypress) that the decimal separator needs to be corrected by enhanceNumeric (keyup).\r\n\r\n        this._oErrorBalloon = null;\r\n        this._aErrors = []; //  Array of errors shown in the format { iNumber : df.tInt, sText : df.tString }\r\n\r\n\r\n\r\n\r\n\r\n        // this.setActionMode(\"Request_Save\", df.cCallModeWait);\r\n        // this.setActionMode(\"Request_Delete\", df.cCallModeWait);\r\n        //  Always mark psValue & pbChanged as synchronized properties\r\n        this.addSync(\"psValue\");\r\n        this.addSync(\"pbChanged\");\r\n    }\r\n\r\n    /*\r\n    This method is called after the control is rendered and provides an opportunity to further \r\n    initialize the DOM elements.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._bRendering = true;\r\n\r\n        super.afterRender();\r\n\r\n        //  Set property value to apply them to to the DOM\r\n        var sVal = this.psValue;\r\n        this.set_peDataType(this.peDataType);\r\n        this.set_psValue(sVal);\r\n        this.set_pbCapslock(this.pbCapslock);\r\n        this.set_peAlign(this.peAlign);\r\n        this.set_pbRequired(this.pbRequired);\r\n\r\n        df.dom.enableTextSelection(this._eControlWrp);\r\n\r\n        //  Attach listener\r\n        if (this._eControl) {\r\n            df.dom.on(\"change\", this._eControl, this.onChange, this);\r\n            df.events.addDomKeyListener(this._eControl, this.onKey, this);\r\n\r\n            df.dom.enableTextSelection(this._eControl);\r\n        }\r\n\r\n        this.updateErrorDisp();\r\n        this._bRendering = false;\r\n    }\r\n\r\n    /* \r\n    Augment destroy to destroy the error balloon that might have been created.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        if (this._oErrorBalloon) {\r\n            this._oErrorBalloon.destroy();\r\n            this._oErrorBalloon = null;\r\n        }\r\n        if (this._oMask) {\r\n            this._oMask.detach();\r\n            this._oMask = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    /*\r\n    This method is called to attach the focus event handlers. These can be attached differently for the \r\n    different controls. For data entry objects they are attached pretty straight forward to the control \r\n    element.\r\n    \r\n    @private\r\n    */\r\n    attachFocusEvents() {\r\n        //  We use a simpler focus detection on the control\r\n        if (this._eControl) {\r\n            df.dom.on(\"focus\", this._eControl, this.onFocus, this);\r\n            df.dom.on(\"blur\", this._eControl, this.onBlur, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augments applyEnabled to set the disabled and tabindex attributes of the control element.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl) {\r\n            this._eControl.disabled = !bVal;\r\n            df.dom.setTabIndex(this._eControl, (bVal ? 0 : -1));\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - Server API - - - - - -\r\n\r\n    /*\r\n    This getter determines the changed state. It will first look at the pbChanged property (which can be \r\n    set to true by user interface events). If pbChanged was false it will also compare the original \r\n    value with current value.\r\n    */\r\n    get_pbChanged() {\r\n        if (!this.pbChanged && this._eElem) {\r\n            this.updateTypeVal();\r\n        }\r\n\r\n        return this.pbChanged || this._sOrigValue !== this.getServerVal();\r\n    }\r\n\r\n    /*\r\n    This setter updates the current value of the component. It will first update the internal typed \r\n    values and then update the displayed value according to the proper masking rules.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psValue(sVal) {\r\n        // this._sOrigValue = sVal;\r\n\r\n        //  Set the type specific value\r\n        this._tValue = df.sys.data.serverToType(sVal, this.peDataType);\r\n        this.psValue = sVal;\r\n\r\n        // this.tValue = toTypeVal(sVal);\r\n        this._sPrevChangeVal = this._sOrigValue = this.getServerVal();\r\n\r\n        //  Update the displayed value\r\n        this.refreshDisplay(this._tValue);\r\n\r\n        //  If a new value is set we assume that errors don't apply any more\r\n        if (!this._bRendering) {\r\n            this.hideAllControlErrors();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This getter returns the current value in the 'server format'. First it updates the current value \r\n    according to the current value inside the control then it gets it in the 'server format' using the \r\n    getServerVal method.\r\n    */\r\n    get_psValue() {\r\n        //  Update the type specific value from the DOM\r\n        if (this._eElem) {\r\n            this.updateTypeVal();\r\n        }\r\n\r\n        //  Return the 'server' value\r\n        if (this._bValueInvalid) {\r\n            return this._sOrigValue;\r\n        }\r\n\r\n        return this.getServerVal();\r\n    }\r\n\r\n    /*\r\n    This setter changes the data type. It will attach the event handlers for the input filters and apply \r\n    the CSS class for the markup of the type.\r\n    \r\n    @param  iVal    The new value.\r\n    */\r\n    set_peDataType(iVal, bSvr) {\r\n        let sValue;\r\n\r\n        if (this._eControl) {\r\n\r\n            //  Preserve value & changed-state\r\n            if (bSvr) {\r\n                sValue = this.get_psValue();\r\n            }\r\n            // this.pbChanged = this.get_pbChanged();\r\n\r\n            //  Make sure the new data type is properly applied\r\n            this.peDataType = iVal;\r\n            this.initMask();\r\n\r\n            //  Update the displayed value with the new data type\r\n            if (bSvr) {\r\n                this.set_psValue(sValue);\r\n            }\r\n\r\n            //  Set CSS class based on data type\r\n            df.dom.removeClass(this._eControl, \"dfData_BCD dfData_Date dfDate_Text\");\r\n            if (iVal === df.ciTypeBCD) {\r\n                df.dom.addClass(this._eControl, \"dfData_BCD\");\r\n            } else if (iVal === df.ciTypeDate) {\r\n                df.dom.addClass(this._eControl, \"dfData_Date\");\r\n            } else {\r\n                df.dom.addClass(this._eControl, \"dfData_Text\");\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    This setter updates the used mask. It makes sure that the new mask is properly initialized and tries \r\n    to keep the value correct by calling updateTypeVal and refreshDisplay before and after the change.\r\n    \r\n    @param  sVal    The new mask.\r\n    */\r\n    set_psMask(sVal) {\r\n        //  Make sure the current value is correct using the 'old mask'\r\n        this.updateTypeVal();\r\n        this.psMask = sVal;\r\n        this.initMask();\r\n\r\n        //  Update the displayed value with the new mask\r\n        this.refreshDisplay(this._tValue);\r\n    }\r\n\r\n    set_pbCapslock(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"Web_Uppercase\", bVal);\r\n            //        this._eControl.style.textTransform = (bVal ? \"uppercase\" : \"\");\r\n        }\r\n    }\r\n\r\n    /*\r\n    This setters adds css styling to the input field if its required. Adds a red asterix to the side of the form.\r\n\r\n    @param bVal true or false depending on if the field is required\r\n    */\r\n    set_pbRequired(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"Web_FieldRequired\", bVal);\r\n        }\r\n    }\r\n\r\n    set_peAlign(eVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.textAlign = df.sys.gui.cssTextAlign(eVal);\r\n        }\r\n    }\r\n\r\n    // - - - - - - Data type logic - - - - - -\r\n\r\n    /*\r\n    This method updates the displayed value. It does this based on the type specific value and uses \r\n    typeToDisplay to markup the value.\r\n    \r\n    @param  tVal    The new value in the type specific format.\r\n    @private\r\n    */\r\n    refreshDisplay(tVal) {\r\n\r\n        if (this._eElem) {\r\n            const sVal = this.typeToDisplay(tVal);\r\n            this.setControlValue(sVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    !!! Use only for backwards compatibility !!!\r\n    !!! Please see df.sys.data.serverToType  !!!\r\n    \r\n    This method determines the type specific value with a new value which is usually received from the \r\n    server. The value is supplied in the 'server format' and is parsed into the private type specific \r\n    value.\r\n    \r\n    @param  sVal    The new value provided in the 'server format'.\r\n    @return The type specific value (date object or number).\r\n    @private\r\n    */\r\n    serverToType(sVal) {\r\n        return df.sys.data.serverToType(sVal, this.peDataType);\r\n    }\r\n\r\n    /*\r\n    !!! Use only for backwards compatibility !!!\r\n    !!! Please see df.sys.data.typeToDisplay  !!!\r\n    \r\n    This method converts a type specific value to a display value.\r\n    \r\n    @param  tVal    Value in type specific format (number or date object).\r\n    @return String with the display value.\r\n    */\r\n    typeToDisplay(tVal) {\r\n        return df.sys.data.typeToDisplay(tVal, this.peDataType, this.getWebApp(),\r\n            this._bHasFocus, this.psMask, this.piPrecision);\r\n    }\r\n\r\n    dateFormat() {\r\n        return this.getWebApp().psDateFormat;\r\n    }\r\n\r\n    dateTimeFormat() {\r\n        return this.getWebApp().psDateTimeFormat;\r\n    }\r\n\r\n    timeFormat() {\r\n        return this.getWebApp().psTimeFormat;\r\n    }\r\n\r\n    dateSep() {\r\n        return this.getWebApp().psDateSeparator;\r\n    }\r\n\r\n    decSep() {\r\n        return this.getWebApp().psDecimalSeparator;\r\n    }\r\n\r\n    thousSep() {\r\n        return this.getWebApp().psThousandsSeparator;\r\n    }\r\n\r\n    timeSep() {\r\n        return this.getWebApp().psTimeSeparator;\r\n    }\r\n\r\n    /*\r\n    This method updates the value properties from the user interface. It uses the getControlValue method \r\n    to get the value from the user interface (usually the DOM). If a numeric or date mask is applied \r\n    then it doesn't update since those are not changed. The type specific properties (_nValue and \r\n    _dValue) are also updated.\r\n    \r\n    @private\r\n    */\r\n    updateTypeVal() {\r\n        let sVal = this.getControlValue();\r\n\r\n        if (this.pbCapslock) {\r\n            sVal = sVal.toUpperCase();\r\n        }\r\n\r\n        this._bValueInvalid = false;\r\n\r\n        if (this.peDataType === df.ciTypeText && this.psMask) {    //  Window mask is always read from the DOM\r\n            //  Read the value and remove the mask characters\r\n            this.psValue = this._tValue = this.clearWinMask(sVal);\r\n        } else if (this._bHasFocus || !this.psMask) {      //  The value is not updated when masked value is shown (exept window mask)\r\n            this.psValue = sVal;\r\n\r\n            //  Parse to the typed value if needed.\r\n            if (this.peDataType === df.ciTypeBCD) {\r\n                this._tValue = df.sys.data.stringToNum(sVal, this.decSep(), this.thousSep());\r\n                if (isNaN(this._tValue)) {\r\n                    this._tValue = 0;\r\n                }\r\n            } else if (this.peDataType === df.ciTypeDate) {\r\n                this._tValue = df.sys.data.stringToDate(sVal, this.dateFormat(), this.dateSep());\r\n                this._bValueInvalid = !this.validateDateRange(this._tValue);\r\n            } else if (this.peDataType === df.ciTypeDateTime) {\r\n                this._tValue = df.sys.data.stringToDate(sVal, this.dateTimeFormat(), this.dateSep(), this.timeSep());\r\n            } else if (this.peDataType === df.ciTypeTime) {\r\n                this._tValue = df.sys.data.stringToDate(sVal, this.timeFormat(), this.dateSep(), this.timeSep());\r\n            } else {\r\n                this._tValue = sVal;\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Validates if the date to fits into the DataFlex Date Type. \r\n\r\n    @param dDate    Date object.\r\n    @return True if valid, false if invalid.\r\n    */\r\n    validateDateRange(dDate) {\r\n        if (dDate && this.pbLimitDateRange) {\r\n            return (dDate.getFullYear() <= 2500 && dDate.getFullYear() >= 1);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n    /*\r\n    This method returns the current format as a string in the server format. It uses the type specific \r\n    properties (_nValue and _dValue) or psValue as the current value.\r\n     \r\n    @return The current value in server format.\r\n    @private\r\n    */\r\n    getServerVal() {\r\n        if (this._tValue !== null) {\r\n            if (this.peDataType === df.ciTypeBCD) {\r\n                return this._tValue.toString(); //df.sys.data.numToString(this._tValue, \".\", this.piPrecision);\r\n            }\r\n            if (this.peDataType === df.ciTypeDate) {\r\n                return (this._tValue instanceof Date && df.sys.data.dateToString(this._tValue, \"yyyy/mm/dd\", \"-\")) || \"\";\r\n            }\r\n            if (this.peDataType === df.ciTypeDateTime) {\r\n                return (this._tValue instanceof Date && df.sys.data.dateToString(this._tValue, \"yyyy/mm/ddThh:mm:ss.fff\", \"-\", \":\")) || \"\";\r\n            }\r\n            if (this.peDataType === df.ciTypeTime) {\r\n                return (this._tValue instanceof Date && df.sys.data.dateToString(this._tValue, \"hh:mm:ss\", \"-\", \":\")) || \"\";\r\n            }\r\n        }\r\n\r\n        return this.psValue;\r\n    }\r\n\r\n    /*\r\n    This method reads the current value from the user interface. It will be overridden by the different \r\n    type of Data Entry Objects. The default implementation reads the value property of the control DOM \r\n    element.\r\n     \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        if (this._eControl) {\r\n            return this._eControl.value;\r\n        }\r\n\r\n        return this.psValue;\r\n    }\r\n\r\n    /*\r\n    This method sets a value to the user interface. It will be overridden by the different type of Data \r\n    Entry Objects. The default implementation sets the value property of the control DOM element.\r\n     \r\n    @param  sVal    The new value to display.\r\n    */\r\n    setControlValue(sVal) {\r\n        if (this._eControl && this._eControl.value !== sVal) {\r\n            this._eControl.value = sVal;\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - Window masks - - - - - - \r\n\r\n    /*\r\n    This method initializes the window mask system. It will attach the listeners (after removing them \r\n    first so a clean situation exists after changing from a window mask to another mask). The mask \r\n    characters are analyzed and an array of describing objects is created. That array is used for quick \r\n    access by the filterWinMask and correctWinMask method.\r\n     \r\n    @private\r\n    */\r\n    initMask() {\r\n        if (this._bMasks && this._eControl) {\r\n            if (this._oMask) {\r\n                this._oMask.detach();\r\n                this._oMask = null;\r\n            }\r\n\r\n            if (this.peDataType === df.ciTypeBCD) {\r\n                this._oMask = this.genNumMask();\r\n            } else if (this.peDataType === df.ciTypeDate || this.peDataType === df.ciTypeDateTime || this.peDataType === df.ciTypeTime) {\r\n                //aMask = this.genDateMask(this.peDataType);\r\n                this._oMask = this.genDateMask(this.peDataType);\r\n            } else if (this.peDataType === df.ciTypeText && this.psMask) {\r\n                this._oMask = this.genWinMask(this.psMask);\r\n            }\r\n        }\r\n    }\r\n\r\n    // - - - - Masking event handlers - - - -\r\n\r\n    /*\r\n    Windows mask handling (custom masks set via psMask).\r\n     \r\n    The stages:\r\n    -   Intialization\r\n        It gathers all details and parses the mask into the aMask array.\r\n    -   Parsing (during key handling)\r\n        It parses the value according to the aMask array and stores the details in that same array.\r\n    -   Filtering (onKeyDown)\r\n        It looks at the parsed data to determine if a keypress is allowed.\r\n    -   Correction (onInput)\r\n        It looks at the parsed data and adjusts the value to become legal.\r\n     \r\n    Some (older) browsers only support keydown and some (mobile) browser only support onInput. The \r\n    logic works fine with both or just one or the other.\r\n     \r\n    @return Object with control functions (detach, clearVal).\r\n    */\r\n    genWinMask(sMask) {\r\n        const that = this, aMask = [];\r\n\r\n        //  Fill character information array for quick access (also take in account the \"\\\" exception) which is used only by the filterWinMask\r\n        for (let i = 0; i < sMask.length; i++) {\r\n            const sChar = sMask.charAt(i);\r\n\r\n            if (sChar === \"\\\\\" && i + 1 < this.sMask.length && (sMask.charAt(i + 1) === \"#\" || sMask.charAt(i + 1) === \"@\" || sMask.charAt(i + 1) === \"!\" || sMask.charAt(i + 1) === \"*\")) {\r\n                i++;\r\n                aMask.push({ bEnter: false, bNumeric: false, bAlpha: false, bPunct: false, sChar: sMask.charAt(i + 1) });\r\n            } else {\r\n                aMask.push({\r\n                    bEnter: (sChar === \"#\" || sChar === \"@\" || sChar === \"!\" || sChar === \"*\"),\r\n                    bNumeric: (sChar === \"#\" || sChar === \"*\"),\r\n                    bAlpha: (sChar === \"@\" || sChar === \"*\"),\r\n                    bPunct: (sChar === \"!\" || sChar === \"*\"),\r\n                    sChar: sChar\r\n                });\r\n            }\r\n        }\r\n\r\n        /*\r\n        Adds/skips mask characters if the caret is located before them. It cancels \r\n        characters that are not allowed at that position.\r\n        */\r\n        function filterWinMask(oEv) {\r\n            let iPos, iNewPos, sValue;\r\n\r\n            if (oEv.isKeyPrintable()) {\r\n                const sOrig = sValue = this._eControl.value;\r\n                const oSel = df.dom.getSelection(this._eControl);\r\n                iPos = oSel.start;\r\n                const sChar = oEv.key();\r\n\r\n                //  Emulate how the value will look when the selection is replaced\r\n                if (oSel.length > 0) {\r\n                    sValue = sValue.substr(0, oSel.start) + sValue.substr(oSel.end);\r\n                }\r\n\r\n                //  Skip no enter characters (add them if they aren't already there)\r\n                iNewPos = iPos;\r\n                while (iNewPos < aMask.length && !aMask[iNewPos].bEnter) {\r\n                    if (sValue.length <= iNewPos) {\r\n                        sValue = sValue + aMask[iNewPos].sChar;\r\n                    }\r\n                    iNewPos++;\r\n                }\r\n\r\n                if (sValue !== sOrig) {\r\n                    this._eControl.value = sValue;\r\n                }\r\n\r\n                //  Set the new caret position if it is moved\r\n                if (iPos !== iNewPos && iNewPos < aMask.length) {\r\n                    df.dom.setCaretPosition(this._eControl, iNewPos);\r\n                    iPos = iNewPos;\r\n                }\r\n\r\n                //  Check if character allowed by mask\r\n                if (iPos >= aMask.length || !df.sys.data.acceptWinMaskChar(sChar, aMask[iPos].sChar)) {\r\n                    oEv.stop();\r\n                }\r\n            }\r\n        }\r\n        df.dom.on(\"keydown\", this._eControl, filterWinMask, this);\r\n\r\n        /*\r\n        Corrects the value according to the mask. It tries to preserve the caret \r\n        position and only updates if the value needs to.\r\n        */\r\n        function correctWinMask(oEv) {\r\n            let iMaskPos = 0, sNew = \"\", iAdded = 0;\r\n            const sOrig = this._eControl.value;\r\n\r\n            //  Loop over \r\n            for (let iPos = 0; iPos < sOrig.length && iMaskPos < aMask.length; iPos++) {\r\n                const sChar = sOrig.charAt(iPos);\r\n\r\n                if (aMask[iMaskPos].bEnter) {\r\n                    if (df.sys.data.acceptWinMaskChar(sChar, aMask[iMaskPos].sChar)) {\r\n                        sNew += sChar;\r\n                        iMaskPos++;\r\n                    }\r\n                } else {\r\n                    sNew += aMask[iMaskPos].sChar;\r\n                    iMaskPos++;\r\n                }\r\n            }\r\n\r\n            if (oEv.inputIsInsert()) {\r\n                while (iMaskPos < aMask.length && !aMask[iMaskPos].bEnter) {\r\n                    sNew += aMask[iMaskPos].sChar;\r\n                    iMaskPos++;\r\n                    iAdded++;\r\n                }\r\n            }\r\n            //  If the correct value is different than the current value update the value (and try to preserve the caret position)\r\n            if (sNew !== this._eControl.value) {\r\n                const iPos = df.dom.getCaretPosition(this._eControl);\r\n                this._eControl.value = sNew;\r\n                df.dom.setCaretPosition(this._eControl, iPos + iAdded);\r\n            }\r\n        }\r\n        df.dom.on(\"input\", this._eControl, correctWinMask, this);\r\n\r\n        return {\r\n            clearVal(sVal) {\r\n                let i = 0, sResult = \"\";\r\n\r\n                while (i < sVal.length && i < aMask.length) {\r\n                    if (aMask[i].bEnter || sVal.charAt(i) !== aMask[i].sChar) {\r\n                        sResult += sVal.charAt(i);\r\n                    }\r\n\r\n                    i++;\r\n                }\r\n\r\n                return sResult;\r\n            },\r\n            detach() {\r\n                if (that._eControl) {\r\n                    df.dom.off(\"keydown\", that._eControl, filterWinMask, that);\r\n                    df.dom.off(\"input\", that._eControl, correctWinMask, that);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Clears the windows mask from the value by removing the mask characters. If the\r\n    value doesn't match the mask the value might be returned incomplete.\r\n     \r\n    @param  sVal  Value to apply the mask on.\r\n    @return Clean value to store in the database.\r\n     \r\n    @private\r\n    */\r\n    clearWinMask(sVal) {\r\n        if (this._oMask) {\r\n            return this._oMask.clearVal(sVal);\r\n        }\r\n        return sVal;\r\n    }\r\n\r\n    /*\r\n    Date masking logic which includes date, datetime and time masking.\r\n     \r\n    The stages:\r\n    -   Intialization (when field receives focus)\r\n        It gathers all details and parses the format into the aFormat array.\r\n    -   Parsing (during key handling)\r\n        It parses the value according to the aFormat array and stores the details in that same array.\r\n    -   Filtering (onKeyDown)\r\n        It looks at the parsed data to determine if a keypress is allowed.\r\n    -   Correction (onInput)\r\n        It looks at the parsed data and adjusts the value to become legal.\r\n     \r\n    Some (older) browsers only support keydown and some (mobile) browser only support onInput. The \r\n    logic works fine with both or just one or the other.\r\n     \r\n    @return Object with control functions (detach).\r\n    */\r\n    genDateMask(eDataType) {\r\n        let aFormat, regex = null;\r\n        const that = this;\r\n\r\n        //  Gather data and parse the mask into format and regex\r\n        function updateFormat() {\r\n            let sFormat;\r\n\r\n            if (eDataType === df.ciTypeDateTime) {\r\n                sFormat = this.dateTimeFormat();\r\n            } else if (eDataType === df.ciTypeTime) {\r\n                sFormat = this.timeFormat();\r\n            } else {\r\n                sFormat = this.dateFormat();\r\n            }\r\n            const sDateSepp = this.dateSep();\r\n            const sTimeSepp = this.timeSep();\r\n\r\n            // Split format and value into blocks\r\n            const asFormat = sFormat.match(/([^mdyhsf]+)|([mdyhsf]+)/gi) || [];\r\n\r\n            let sRegex = \"\";\r\n            aFormat = [];\r\n            asFormat.forEach(function (sPart) {\r\n                let oNew = { oNext: null, bVal: true };\r\n                switch (sPart.toLowerCase()) {\r\n                    case \"yyyy\":\r\n                        oNew.iMax = 4;\r\n                        sRegex += \"(\\\\d{1,4})?\";\r\n                        break;\r\n                    case \"dd\":\r\n                    case \"mm\":\r\n                    case \"yy\":\r\n                    case \"hh\":\r\n                    case \"ss\":\r\n                        oNew.iMax = 2;\r\n                        sRegex += \"(\\\\d{1,2})?\";\r\n                        break;\r\n                    case \"fff\":\r\n                        oNew.iMax = 3;\r\n                        sRegex += \"(\\\\d{1,3})?\";\r\n                        break;\r\n                    default:\r\n                        oNew.bVal = false;\r\n                        oNew.sText = sPart.replace(\"/\", sDateSepp).replace(\":\", sTimeSepp);\r\n                        oNew.iMax = oNew.sText.length;\r\n                        sRegex += \"(\\\\D{1\" + (oNew.iMax > 1 ? \",\" + oNew.iMax : \"\") + \"})?\";\r\n                }\r\n                if (aFormat.length) {\r\n                    aFormat[aFormat.length - 1].oNext = oNew;\r\n                }\r\n                aFormat.push(oNew)\r\n            });\r\n\r\n            regex = new RegExp(sRegex, \"\");\r\n        }\r\n        updateFormat.call(this);\r\n\r\n        df.dom.on(\"focus\", this._eControl, updateFormat, this);\r\n\r\n        //  Parses value according to aFormat, storing details in aFormat as well\r\n        function parseValue(sValue) {\r\n            const match = regex.exec(sValue);\r\n            // console.log(match);\r\n            let iOffset = 0;\r\n            let bDirty = false;\r\n\r\n            aFormat.forEach(function (oPart, iIndex) {\r\n                oPart.iStart = iOffset;\r\n                oPart.sVal = match[iIndex + 1] || \"\";\r\n                if (oPart.sVal) {\r\n                    iOffset += oPart.sVal.length;\r\n                    oPart.bFound = true;\r\n                } else {\r\n                    bDirty = true;\r\n                    oPart.bFound = false;\r\n                }\r\n                oPart.bDirty = bDirty;\r\n                oPart.iEnd = iOffset;\r\n                oPart.bAdd = false;\r\n            });\r\n\r\n\r\n            // console.log(aFormat);\r\n            // console.log(`Result dec=${iDecimals} dirty=${bDirty} separators=${iSeparators}.`);\r\n        }\r\n\r\n\r\n        //  Filter key events (keydown)\r\n        function filterDate(oEv) {\r\n            if (oEv.isKeyPrintable()) {\r\n                //  Gather details\r\n                let bAllow = false, iMoveCarret = 0;\r\n                const sChar = oEv.key();\r\n                const oSel = df.dom.getSelection(this._eControl);\r\n                const iCarret = oSel.start;\r\n                const bNum = ((\"0123456789\").indexOf(sChar) !== -1);\r\n                let sValue = this._eControl.value;\r\n\r\n                //  Emulate how the value will look when the selection is replaced\r\n                if (oSel.length > 0) {\r\n                    sValue = sValue.substr(0, oSel.start) + sValue.substr(oSel.end);\r\n                }\r\n\r\n                const bAppend = iCarret == sValue.length;\r\n\r\n                parseValue(sValue);\r\n\r\n                //  Find carret pos part\r\n                let oCP = aFormat[0];\r\n                while (oCP.oNext && oCP.iEnd < iCarret) {\r\n                    oCP = oCP.oNext;\r\n                }\r\n\r\n                //console.log(oCP);\r\n\r\n                if (bAppend) {\r\n                    if (bNum) {\r\n                        if (oCP.bVal && oCP.sVal.length < oCP.iMax) {     //  check for space in current value\r\n                            bAllow = true;\r\n                        } else {                                          //  move to next value  (if possible)\r\n                            oCP = oCP.oNext;\r\n                            while (oCP && !oCP.bVal) {\r\n                                oCP.bAdd = !oCP.bFound;\r\n                                oCP = oCP.oNext;\r\n                            }\r\n                            bAllow = oCP && oCP.bVal;\r\n                        }\r\n                    } else {\r\n                        if (oCP.bVal && oCP.sVal.length > 0 && oCP.oNext) {       //  validate current value\r\n                            oCP = oCP.oNext;                                    //  see if next separator matches\r\n                            if (!oCP.bVal && oCP.sText.charAt(0) == sChar) {\r\n                                bAllow = true;\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (bNum) {\r\n                        if (oCP.bVal) {\r\n                            if (oCP.sVal.length < oCP.iMax) {\r\n                                bAllow = true;\r\n                            }\r\n                        } else if (oCP.iEnd == iCarret && oCP.oNext) {\r\n                            oCP = oCP.oNext;\r\n                            bAllow = (oCP.bVal && oCP.sVal.length < oCP.iMax);\r\n                        } else if (oCP.bDirty) {\r\n                            bAllow = true;\r\n                        }\r\n                    } else {  //  Inserting non numeric\r\n                        if (oCP.bVal) { // We are inside a value\r\n                            //  That value is valid\r\n                            if (oCP.sVal.length > 0 && iCarret - oCP.iStart > 0 && iCarret - oCP.iStart <= oCP.iMax && oCP.oNext) {\r\n                                oCP = oCP.oNext;\r\n                                if (!oCP.bVal && oCP.sText.charAt(0) == sChar) {\r\n                                    if (!oCP.bFound) {\r\n                                        bAllow = true;\r\n                                    } else {\r\n                                        let oNext = oCP.oNext;\r\n                                        while (oNext) {\r\n                                            if (!oNext.bVal && !oNext.bFound && oNext.sText == oCP.sText) {\r\n                                                bAllow = true;\r\n                                            }\r\n                                            oNext = oNext.oNext;\r\n                                        }\r\n                                    }\r\n\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }\r\n\r\n                if (aFormat.reduce(function (bVal, oPart) { return bVal || oPart.bAdd; }, false)) {\r\n                    let sNewVal = \"\";\r\n                    aFormat.forEach(function (oPart) {\r\n                        if (oPart.bVal) {\r\n                            sNewVal += oPart.sVal;\r\n                        } else if (oPart.bFound || oPart.bAdd) {\r\n                            sNewVal += oPart.sText;\r\n                            iMoveCarret += oPart.sText.length - oPart.sVal.length;\r\n                        }\r\n                    })\r\n                    this._eControl.value = sNewVal;\r\n                }\r\n\r\n                if (iMoveCarret) {\r\n                    df.dom.setCaretPosition(this._eControl, iCarret + iMoveCarret);\r\n                }\r\n\r\n                if (!bAllow) {\r\n                    oEv.stop();\r\n                }\r\n            }\r\n        }\r\n        df.dom.on(\"keydown\", this._eControl, filterDate, this);\r\n\r\n        //  Correct value after input (onInput)\r\n        function correctDate(oEv) {\r\n            //  Gather details\r\n\r\n            if (oEv.inputIsInsert()) {\r\n\r\n\r\n                let iMoveCarret = 0;\r\n                const oSel = df.dom.getSelection(this._eControl);\r\n                const iCarret = oSel.start;\r\n                const sValue = this._eControl.value;\r\n\r\n                parseValue(sValue);\r\n\r\n                let sNewVal = \"\";\r\n                aFormat.forEach(function (oPart) {\r\n                    if (oPart.bVal) {\r\n                        sNewVal += oPart.sVal;\r\n                    } else if (oPart.bFound || (oPart.oNext && oPart.oNext.bFound)) {\r\n                        sNewVal += oPart.sText;\r\n                        iMoveCarret += oPart.sText.length - oPart.sVal.length;\r\n                    }\r\n                });\r\n\r\n                if (sNewVal !== sValue) {\r\n                    this._eControl.value = sNewVal;\r\n                    //console.log(`correctDate update '${sValue}' => '${sNewVal}' :${iCarret} += ${iMoveCarret} `);\r\n\r\n                    df.dom.setCaretPosition(this._eControl, iCarret + iMoveCarret);\r\n                }\r\n            }\r\n        }\r\n        df.dom.on(\"input\", this._eControl, correctDate, this);\r\n\r\n        return {\r\n            detach() {\r\n                if (that._eControl) {\r\n                    df.dom.off(\"keydown\", that._eControl, filterDate, that);\r\n                    df.dom.off(\"input\", that._eControl, correctDate, that);\r\n                    df.dom.off(\"focus\", that._eControl, updateFormat, that);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Numeric masking logic.\r\n     \r\n    The stages:\r\n    -   Intialization (when field receives focus)\r\n        It gathers all details.\r\n    -   Parsing (during key handling)\r\n        It parses the value into separate variables (bNegative, sNum, bSeparator, sDecimals)\r\n    -   Filtering (onKeyDown)\r\n        It looks at the parsed data to determine if a keypress is allowed.\r\n    -   Correction (onInput)\r\n        It looks at the parsed data and adjusts the value to become legal.\r\n     \r\n    Some (older) browsers only support keydown and some (mobile) browser only support onInput. The \r\n    logic works fine with both or just one or the other.\r\n     \r\n    @return Object with control functions (detach).\r\n    */\r\n    genNumMask() {\r\n        let sDecSepp, sDecSepparators, iLength, iPrecision;\r\n        const that = this;\r\n\r\n        //  Initialize quick access variables\r\n        function updateFormat() {\r\n            sDecSepp = this.decSep();\r\n            sDecSepparators = sDecSepp + \".,\"; //   Make sure that , and . are always accepted as decimal character\r\n            iPrecision = this.piPrecision;\r\n            iLength = this.piMaxLength - this.piPrecision;\r\n        }\r\n        updateFormat.call(this);\r\n        df.dom.on(\"focus\", this._eControl, updateFormat, this);\r\n\r\n        //  Parsed values\r\n        let bNegative, sNum, bHasDecSep, iDecSepOffset, sDec;\r\n\r\n        function parseValue(sValue) {\r\n            bNegative = false;\r\n            sNum = \"\";\r\n            bHasDecSep = false;\r\n            iDecSepOffset = 0;\r\n            sDec = \"\";\r\n\r\n            for (let iOffset = 0; iOffset < sValue.length; iOffset++) {\r\n                const sChar = sValue.charAt(iOffset);\r\n                const bNum = ((\"0123456789\").indexOf(sChar) !== -1);\r\n\r\n                if (bNum) {\r\n                    if (!bHasDecSep && sNum.length < iLength) {\r\n                        sNum += sChar\r\n                    } else if (iPrecision > 0 && sDec.length < iPrecision) {  //  Deliberately keep decimals without separator so that it won't correct a missing separator (which would prevent moving them)\r\n                        sDec += sChar;\r\n                    }\r\n                } else if (sChar == \"-\") {\r\n                    bNegative = true;\r\n                } else if (sDecSepparators.indexOf(sChar) != -1) {\r\n                    if (iPrecision > 0) {\r\n                        bHasDecSep = true;\r\n                        iDecSepOffset = iOffset\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Filters key input (keydown)\r\n        function filterNumeric(oEv) {\r\n            if (oEv.isKeyPrintable()) {\r\n                //  Gather details\r\n                let bAllow = false, bAdjust = false, iMoveCarret = 0;\r\n                const sChar = oEv.key();\r\n                const oSel = df.dom.getSelection(this._eControl);\r\n                const iCarret = oSel.start;\r\n                const bNum = ((\"0123456789\").indexOf(sChar) !== -1);\r\n                const sOrig = this._eControl.value;\r\n                let sValue = sOrig;\r\n\r\n                //  Emulate how the value will look when the selection is replaced\r\n                if (oSel.length > 0) {\r\n                    sValue = sValue.substr(0, oSel.start) + sValue.substr(oSel.end);\r\n                }\r\n\r\n                const bAppend = iCarret == sValue.length;\r\n\r\n                parseValue(sValue);\r\n\r\n                if (bNum) {\r\n                    if (!bHasDecSep || iCarret <= iDecSepOffset) {\r\n                        if (sNum.length < iLength) {\r\n                            if (bNegative && iCarret == 0) {\r\n                                iMoveCarret += 1;\r\n                            }\r\n                            bAllow = true;\r\n                        } else if (bAppend && !bHasDecSep && iPrecision > 0) {\r\n                            bHasDecSep = true;\r\n                            bAdjust = true;\r\n                            iMoveCarret += 1;\r\n                            bAllow = true;\r\n                        }\r\n                    } else {\r\n                        if (sDec.length < iPrecision) {\r\n                            bAllow = true;\r\n                        }\r\n                    }\r\n                } else if (sChar == \"-\") {\r\n                    if (iCarret == 0) {\r\n                        if (!bNegative) {\r\n                            bAllow = true;\r\n                        } else {\r\n                            iMoveCarret += 1;\r\n                        }\r\n                    }\r\n                } else if (sDecSepparators.indexOf(sChar) != -1) {\r\n                    if (!bHasDecSep && iPrecision > 0) {\r\n                        bAllow = true;\r\n                    }\r\n                }\r\n\r\n                if (bAdjust) {\r\n                    sValue = (bNegative ? \"-\" : \"\") + sNum + (bHasDecSep ? sDecSepp : \"\") + sDec;\r\n                    if (sOrig != sValue) {\r\n                        this._eControl.value = sValue;\r\n                    }\r\n                }\r\n\r\n                if (iMoveCarret || bAdjust) {\r\n                    df.dom.setCaretPosition(this._eControl, iCarret + iMoveCarret);\r\n                }\r\n\r\n                if (!bAllow) {\r\n                    oEv.stop();\r\n                }\r\n            }\r\n        }\r\n        df.dom.on(\"keydown\", this._eControl, filterNumeric, this);\r\n\r\n        //  Corrects value after input (onInput)\r\n        function correctNumeric(oEv) {\r\n            //  Gather details\r\n            const oSel = df.dom.getSelection(this._eControl);\r\n            const iCarret = oSel.start;\r\n            const sValue = this._eControl.value;\r\n\r\n            //  Parse\r\n            parseValue(sValue);\r\n\r\n            //  Reassemble\r\n            let sNewVal = (bNegative ? \"-\" : \"\") + sNum + (bHasDecSep ? sDecSepp : \"\") + sDec;\r\n\r\n            if (sNewVal !== sValue) {\r\n                this._eControl.value = sNewVal;\r\n                // console.log(\"correctNumeric update '\" + sValue + \"' => '\" + sNewVal + \"+' :\" + iCarret + \"\");\r\n                df.dom.setCaretPosition(this._eControl, iCarret);\r\n            }\r\n        }\r\n        df.dom.on(\"input\", this._eControl, correctNumeric, this);\r\n\r\n        return {\r\n            detach() {\r\n                if (that._eControl) {\r\n                    df.dom.off(\"keydown\", that._eControl, filterNumeric, that);\r\n                    df.dom.off(\"input\", that._eControl, correctNumeric, that);\r\n                    df.dom.off(\"focus\", that._eControl, updateFormat, that);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    This method performs the validations that are needed. It performs some client-side validations and \\\r\n    will trigger the server-side validation by firing the OnValidate event.\r\n     \r\n    @return True if no validation errors occurred. Note that server-side validatione errors are \r\n                triggered later.\r\n    */\r\n    validate() {\r\n        let bResult = true, sVal;\r\n\r\n        if (this.pbRequired) {\r\n            sVal = this.get_psValue();\r\n\r\n            if ((this.peDataType === df.ciTypeBCD && parseFloat(sVal) === 0.0) || sVal === \"\") {\r\n                bResult = false;\r\n                this.showControlError(13, this.getWebApp().getTrans(\"err_entry_required\"));\r\n            } else {\r\n                this.hideControlError(13);\r\n            }\r\n        }\r\n\r\n        if (this.peDataType === df.ciTypeDate) {\r\n            this.updateTypeVal();\r\n            if (!this.validateDateRange(this._tValue)) {\r\n                bResult = false;\r\n                this.showControlError(16, this.getWebApp().getTrans(\"err_enter_valid_date\"));\r\n            } else {\r\n                this.hideControlError(16);\r\n            }\r\n        }\r\n\r\n\r\n        if (bResult) {\r\n            //  Make sure that OnChange is fired before OnValidate\r\n            this.fireChange();\r\n            this.fireAutoFind();\r\n\r\n            this.fire(\"OnValidate\", [], function (oEvent) {\r\n                if (oEvent.bServer) {\r\n                    //  If handled on the server this means ASynchronous so we have to put the focus back manually if a problem occurred\r\n                    if (oEvent.sReturnValue === \"0\") {\r\n                        if (this.selectAndFocus) {\r\n                            this.selectAndFocus();\r\n                        } else {\r\n                            this.focus();\r\n                        }\r\n                    } else {\r\n                        this.hideAllControlErrors();\r\n                    }\r\n                } else {\r\n                    //  If handled on the client we can make bResult false if event stopped to cancel moving out of the field\r\n                    if (oEvent.bCanceled) {\r\n                        bResult = false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        return bResult;\r\n    }\r\n\r\n\r\n    // - - - - - - Event handling - - - - - -\r\n\r\n    /*\r\n    This method handles the onKey event and performs the various actions like finds, saves & deletes. It \r\n    also initiates the validations when tabbing out of the field.\r\n     \r\n    @param oEvent   The event object.\r\n    */\r\n    onKey(oEvent) {\r\n        if (oEvent.matchKey(df.settings.formKeys.tabOut)) {\r\n            if (!this.validate()) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the onFocus event listener and calls the refreshDisplay method after forwarding the onFocus \r\n    event. This will make sure that the value will be displayed in the proper edit format.\r\n     \r\n    @param  oEvent   Event object.\r\n    @private\r\n    */\r\n    updateFocus(bFocus) {\r\n        super.updateFocus(bFocus);\r\n\r\n        if (!bFocus) {\r\n            this.updateTypeVal();\r\n\r\n            this.fireAutoFind();\r\n        }\r\n\r\n        this.refreshDisplay(this._tValue);\r\n    }\r\n\r\n    /*\r\n    This method checks if the value is changed and if so it will trigger the OnChange event.\r\n    */\r\n    fireChange() {\r\n        //  Check the new value\r\n        this.updateTypeVal();\r\n        const sNewVal = this.getServerVal();\r\n\r\n        //  Only fire events if it changed\r\n        if (this._sPrevChangeVal !== sNewVal) {\r\n            this.pbChanged = true;\r\n\r\n            //  Fire events (OnSelectedChange on every radio and OnSelect on the selected one)\r\n            this.fire('OnChange', [sNewVal, this._sPrevChangeVal]);\r\n\r\n            this._bAutoFind = true;\r\n\r\n            //  Remember the value\r\n            this._sPrevChangeVal = sNewVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method fires the autofind event when needed. The fireChanged method updates a Boolean when the \r\n    value is changed telling us that we need to do an autofind. We reset the Boolean so that we don't do \r\n    an autofind too often. The autofind is called from the blur event and the validation method because \r\n    it should fire on the blur but before OnValidate.\r\n    */\r\n    fireAutoFind() {\r\n        if (this._bAutoFind) {\r\n            //  Fire autofind event\r\n            this.fire('OnAutoFind');\r\n\r\n            this._bAutoFind = false;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the onBlur event and calls the updateTypeVal to update the value properties before \r\n    forwarding the onBlur. The refreshDisplay method is called after the onBlur to display the properly \r\n    masked value.\r\n     \r\n    @param  oEvent   Event object.\r\n    @private\r\n    */\r\n    onChange(oEvent) {\r\n        this.fireChange();\r\n    }\r\n\r\n    // - - - - - - Error handling - - - - - -\r\n\r\n    /* \r\n    Displays an error in a info balloon next to the control. As multiple errors can be active at the \r\n    same time an array of errors is maintained and updated. Will also apply the WebError class to the \r\n    control.\r\n     \r\n    @param  iErrNum     Error ID.\r\n    @param  sErrText    Error description / text.\r\n    @client-action\r\n    */\r\n    showControlError(iErrNum, sErrText) {\r\n\r\n        iErrNum = parseInt(iErrNum, 10);\r\n\r\n        for (let i = 0; i < this._aErrors.length; i++) {\r\n            if (this._aErrors[i].iNumber === iErrNum) {\r\n                this._aErrors[i].sText = sErrText;\r\n                this.updateErrorDisp();\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._aErrors.push({\r\n            iNumber: iErrNum,\r\n            sText: sErrText\r\n        });\r\n\r\n        this.updateErrorDisp();\r\n    }\r\n\r\n    /* \r\n    Hides a specific error displayed using showControlError. Removes the error from the administration \r\n    and updates the display.\r\n     \r\n    @param  iErrNum   Error ID.\r\n    @client-action\r\n    */\r\n    hideControlError(iErrNum) {\r\n\r\n        iErrNum = df.toInt(iErrNum);\r\n\r\n        for (let i = 0; i < this._aErrors.length; i++) {\r\n            if (this._aErrors[i].iNumber === iErrNum) {\r\n                this._aErrors.splice(i, 1);\r\n\r\n                this.updateErrorDisp();\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides all errors by clearing the administration and hiding the error balloon.\r\n     \r\n    @client-action\r\n    */\r\n    hideAllControlErrors() {\r\n        this._aErrors = [];\r\n        this.updateErrorDisp();\r\n    }\r\n\r\n    /* \r\n    Updates the error display according to the _aErrors administration. Will show / hide the info \r\n    balloon and add / remove the \"WebError\" CSS class.\r\n     \r\n    @private\r\n    */\r\n    updateErrorDisp() {\r\n        const aHtml = [];\r\n\r\n        if (this._aErrors.length > 0) {\r\n            this.makeVisible();\r\n\r\n            //  Generate errors html\r\n            for (let i = 0; i < this._aErrors.length; i++) {\r\n                if (i > 0) {\r\n                    aHtml.push('<br>');\r\n                }\r\n                aHtml.push(this._aErrors[i].sText);\r\n            }\r\n\r\n            //  Create tooltip if needed\r\n            if (!this._oErrorBalloon) {\r\n                this._oErrorBalloon = new df.InfoBalloon(this, \"WebErrorTooltip\", aHtml.join(''));\r\n            } else {\r\n                //  Update & show tooltip\r\n                this._oErrorBalloon.psMessage = aHtml.join('');\r\n                this._oErrorBalloon.update();\r\n            }\r\n            this._oErrorBalloon.show();\r\n\r\n\r\n            if (this.getErrorElem()) {\r\n                df.dom.addClass(this.getErrorElem(), \"WebError\");\r\n            }\r\n\r\n            this.focus();\r\n        } else {\r\n            //  Hide tooltip if needed\r\n            if (this._oErrorBalloon) {\r\n                this._oErrorBalloon.hide();\r\n\r\n                df.dom.removeClass(this.getErrorElem(), \"WebError\");\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Used by the showControlError logic to determine on which element the \"WebError\" class needs to be \r\n    applied. Can be overridden by sub-classes.\r\n     \r\n    @private\r\n    */\r\n    getErrorElem() {\r\n        return this._eElem;\r\n    }\r\n\r\n    /* \r\n    Augment the resize method to make sure that the error balloon is resized / repositioned when needed.\r\n     \r\n    @private\r\n    */\r\n    resize() {\r\n        super.resize();\r\n\r\n        if (this._oErrorBalloon) {\r\n            this._oErrorBalloon.resize();\r\n        }\r\n    }\r\n\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\n/*\r\nClass:\r\n    df.WebBaseForm\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nBase class for text input data entry objects like WebForm and WebEdit. It implements the pbReadOnly \r\nproperty.\r\n    \r\nRevision:\r\n    2011/08/26  (HW, DAW) \r\n        Initial version.\r\n    2020/06/08  (HR, DAE) \r\n        Added floating labels\r\n*/\r\n/* global df */\r\nexport class WebBaseForm extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent)\r\n\r\n        this.prop(df.tBool, \"pbReadOnly\", false);\r\n        this.prop(df.tString, \"psAutoComplete\", \"off\");\r\n\r\n        this.event(\"OnKey\", df.cCallModeDefault);\r\n        this.event(\"OnInput\", df.cCallModeDefault);\r\n    }\r\n\r\n    /* \r\n    Augment the afterRender to execute setters.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        this.set_pbReadOnly(this.pbReadOnly);\r\n\r\n        df.dom.on(\"keydown\", this._eControl, this.onKeyDownSrv, this);\r\n        df.dom.on(\"input\", this._eControl, this.onInputSrv, this);\r\n\r\n        if (this._eLbl && this.peLabelPosition === df.ciLabelFloat) {\r\n            this.floatLabel(false);\r\n            df.dom.on(\"click\", this._eLbl, this.onFocus, this);\r\n\r\n            this.checkAutoFill();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment to set the maxlength html attribute limiting the amount of characters that can be entered.\r\n    \r\n    @private\r\n    */\r\n    initMask() {\r\n        super.initMask();\r\n\r\n        if (this._eControl) {\r\n            if (this.peDataType === df.ciTypeText && !this.psMask) {\r\n                this._eControl.maxLength = (this.piMaxLength > 0 ? this.piMaxLength : 0);\r\n            } else {\r\n                this._eControl.maxLength = 1048576;\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Implementation of the pbReadOnly property which maps to the DOM readOnly property and sets / removes\r\n    the Web_ReadOnly property.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbReadOnly(bVal) {\r\n        if (this._eControl) {\r\n            this._eControl.readOnly = bVal;\r\n\r\n            df.dom.toggleClass(this._eElem, \"Web_ReadOnly\", bVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter for piMaxLength that sets the maximum field length to the input control.\r\n    \r\n    @param  iVal    New value.\r\n    */\r\n    set_piMaxLength(iVal) {\r\n        this.piMaxLength = iVal;\r\n        this.initMask();\r\n    }\r\n\r\n    /*\r\n    Setter for psAutoComplete that directly updates the DOM attribute.\r\n    \r\n    @param  sVal    New value.\r\n    */\r\n    set_psAutoComplete(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.autocomplete = sVal;\r\n        }\r\n    }\r\n\r\n    /* Setter for peLabelPosition that triggers a float / unfloat and adds / removes handlers if needed\r\n    \r\n    @param  iVal    New value.\r\n    */\r\n    set_peLabelPosition(iVal) {\r\n        this.peLabelPosition = iVal;\r\n\r\n        this.posLabel(false);\r\n\r\n        if (this._eLbl) {\r\n            // Always remove handler first\r\n            df.dom.off(\"click\", this._eLbl, this.onFocus, this);\r\n\r\n            if (iVal === df.ciLabelFloat) {\r\n                df.dom.on(\"click\", this._eLbl, this.onFocus, this);\r\n                this.floatLabel(false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Transform the KeyDown into the server OnKey event.\r\n    \r\n    @param  oEv     Event object.\r\n    @private\r\n    */\r\n    onKeyDownSrv(oEv) {\r\n        this.fire(\"OnKey\", [df.fromBool(oEv.isKeyPrintable()), oEv.key()]);\r\n    }\r\n\r\n    /*\r\n    Transform the Input into the server OnInput event.\r\n    \r\n    @param  oEv     Event object.\r\n    @private\r\n    */\r\n    onInputSrv(oEv) {\r\n        this.fire(\"OnInput\", [oEv.inputIsInsert(), oEv.e.inputType || \"Undefined\"]);\r\n    }\r\n\r\n    updateFocus(bFocus) {\r\n        super.updateFocus(bFocus);\r\n\r\n        if (this.peLabelPosition === df.ciLabelFloat) {\r\n            this.floatLabel(bFocus);\r\n        }\r\n    }\r\n\r\n    floatLabel(bFocus) {\r\n        if (this.getControlValue() != '' || (bFocus & this.isEnabled()) || this.matchSelector(this._eControl, \":-webkit-autofill\")) {\r\n            if (this._eLbl != null) {\r\n                df.dom.addClass(this._eLbl, \"WebCon_Float\");\r\n                df.dom.removeClass(this._eLbl, \"WebCon_Unfloat\");\r\n            }\r\n        }\r\n        else {\r\n            if (this._eLbl != null) {\r\n                df.dom.addClass(this._eLbl, \"WebCon_Unfloat\");\r\n                df.dom.removeClass(this._eLbl, \"WebCon_Float\");\r\n            }\r\n        }\r\n    }\r\n\r\n    setControlValue(sVal) {\r\n        super.setControlValue(sVal);\r\n\r\n        if (this._eControl) {\r\n            if (this.peLabelPosition === df.ciLabelFloat) {\r\n                this.floatLabel(this._bHasFocus);\r\n            }\r\n        }\r\n    }\r\n\r\n    checkAutoFill() {\r\n        const that = this;\r\n        let iTries = 20;\r\n\r\n        function doCheckAutoFill() {\r\n            iTries--;\r\n            if (that._eControl && that.matchSelector(that._eControl, \":-webkit-autofill\")) {\r\n                that.floatLabel(false);\r\n            } else if (iTries > 0) {\r\n                setTimeout(doCheckAutoFill, 100);\r\n            }\r\n        }\r\n\r\n        doCheckAutoFill();\r\n    }\r\n\r\n    matchSelector(el, selector) {\r\n        // For now, we can only really check this in Chrome, while waiting for an actual OnAutoComplete event across browsers...\r\n        if (df.sys.isChrome) {\r\n            return (el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector).call(el, selector);\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebPanel\r\nExtends:\r\n    df.WebBaseContainer\r\n\r\nThe panel is a very flexible UI container component that can be docked inside other container \r\ncomponents. It can docked into 5 regions: top, left, center, right, bottom. Within the container it \r\nis possible to place controls or other panels. There should always be a main panel. Panels can be \r\nresizable. The panel is a fairly complicated component as it relies a lot on the floating of HTML \r\nelements combined with some pixel calculations. Especially the fact that panels can be scrollable \r\nmakes the panel pretty sensitive to browser differences.\r\n\r\n+------------------+\r\n|        TOP       |\r\n+------------------+\r\n| L |          | R |\r\n| E |          | I | \r\n| F |  CENTER  | G |\r\n| T |          | H |\r\n|   |          | T |\r\n+------------------+\r\n|      BOTTOM      |\r\n+------------------+\r\n    \r\nRevision:\r\n    2011/08/02  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebPanel extends WebBaseContainer {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"peRegion\", 0);\r\n        this.prop(df.tBool, \"pbResizable\", false);\r\n\r\n        //@privates\r\n        this._eDivider = null;\r\n\r\n        //  Configure super classes\r\n        this._bWrapDiv = true;\r\n        this._sControlClass = \"WebPanel\";\r\n\r\n        this._bIsPanel = true;\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        this.set_pbResizable(this.pbResizable);\r\n    }\r\n\r\n    set_pbResizable(bVal) {\r\n        if (this._eElem) {\r\n            if (bVal && this.peRegion !== df.ciRegionCenter) {\r\n                //  Create divider if not there\r\n                if (!this._eDivider) {\r\n                    this._eDivider = df.dom.create('<div></div>');\r\n                    this._eElem.appendChild(this._eDivider);\r\n                    df.dom.on(\"mousedown\", this._eDivider, this.onResize, this);\r\n                }\r\n\r\n                this._eDivider.className = (this.peRegion === df.ciRegionLeft || this.peRegion === df.ciRegionRight ? 'WebPanel_DividerVertical' : 'WebPanel_DividerHorizontal');\r\n                this._eDivider.style.right = \"\";\r\n                this._eDivider.style.left = \"\";\r\n                this._eDivider.style.top = \"\";\r\n                this._eDivider.style.bottom = \"\";\r\n                if (this.peRegion === df.ciRegionLeft) {\r\n                    this._eDivider.style.right = \"0px\";\r\n                } else if (this.peRegion === df.ciRegionRight) {\r\n                    this._eDivider.style.left = \"0px\";\r\n                } else if (this.peRegion === df.ciRegionBottom) {\r\n                    this._eDivider.style.top = \"0px\";\r\n                } else if (this.peRegion === df.ciRegionTop) {\r\n                    this._eDivider.style.bottom = \"0px\";\r\n                }\r\n            } else {\r\n                if (this._eDivider) {\r\n                    df.dom.off(\"mousedown\", this._eDivider, this.onResize, this);\r\n                    this._eElem.removeChild(this._eDivider);\r\n                    this._eDivider = null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    set_peRegion(eVal) {\r\n        if (this._eElem && this.peRegion !== eVal) {\r\n            this.peRegion = eVal;\r\n\r\n            this.setOuterWidth(0);\r\n            this.setOuterHeight(0);\r\n\r\n            this.sizeChanged(true);\r\n            this.set_pbResizable(this.pbResizable);\r\n        }\r\n    }\r\n\r\n    onResize(oEvent) {\r\n        let iCurLeft, iMin = 0, iMax = 0, iCurTop;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        const eGhost = df.dom.create('<div class=\"' + (this.peRegion === df.ciRegionLeft || this.peRegion === df.ciRegionRight ? 'WebPanel_DividerVertical_Ghost' : 'WebPanel_DividerHorizontal_Ghost') + '\"></div>');\r\n\r\n        const eMask = df.gui.dragMask(this.topLayer() || document.body);\r\n\r\n        if (this.peRegion === df.ciRegionTop || this.peRegion === df.ciRegionBottom) {  //  Horizontal\r\n            eMask.style.cursor = \"n-resize\";\r\n\r\n            //  Determine start position\r\n            if (this.peRegion === df.ciRegionTop) {\r\n                iCurTop = this._eElem.clientHeight;\r\n\r\n                iMin = (this.piMinHeight > 2 ? this.piMinHeight : 2);\r\n                iMax = iCurTop + this._oParent._eMainArea.clientHeight;\r\n                if (this._oParent._oRegionCenter && this._oParent._oRegionCenter.piMinHeight > 0) {\r\n                    iMax = iMax - this._oParent._oRegionCenter.piMinHeight;\r\n                }\r\n            } else {  //  Bottom\r\n                iCurTop = this._oParent._eMainArea.clientHeight;\r\n                if (this._oParent._eRegionTop) {\r\n                    iCurTop += this._oParent._eRegionTop.clientHeight;\r\n\r\n                    iMin = this._oParent._eRegionTop.clientHeight;\r\n                }\r\n\r\n                if (this._oParent._oRegionCenter && this._oParent._oRegionCenter.piMinHeight > 0) {\r\n                    iMin += this._oParent._oRegionCenter.piMinHeight;\r\n                }\r\n                iMax = iCurTop + this._eElem.clientHeight - (this.piMinHeight > 0 ? this.piMinHeight : 0) - 10;\r\n            }\r\n\r\n            //  Configure ghost slider\r\n            eGhost.style.top = iCurTop + \"px\";\r\n\r\n            this._oParent._eMainArea.parentNode.appendChild(eGhost);\r\n        } else { //   Vertical\r\n            eMask.style.cursor = \"e-resize\";\r\n\r\n            //  Determine start position\r\n            if (this.peRegion === df.ciRegionLeft) {\r\n                iCurLeft = this._eElem.clientWidth;\r\n\r\n                iMin = (this.piMinWidth > 2 ? this.piMinWidth : 2);\r\n\r\n                iMax = iCurLeft + this._oParent._eRegionCenter.clientWidth;\r\n                if (this._oParent._oRegionCenter && this._oParent._oRegionCenter.piMinWidth > 0) {\r\n                    iMax = iMax - this._oParent._oRegionCenter.piMinWidth;\r\n                } else {\r\n                    iMax = iMax - 4;\r\n                }\r\n            } else {  //  Right\r\n                iCurLeft = this._oParent._eMainArea.clientWidth - this._eElem.clientWidth;\r\n\r\n                if (this._oParent._eRegionLeft) {\r\n                    iMin = this._oParent._eRegionLeft.clientWidth;\r\n                }\r\n\r\n                if (this._oParent._oRegionCenter && this._oParent._oRegionCenter.piMinWidth > 0) {\r\n                    iMin += this._oParent._oRegionCenter.piMinWidth;\r\n                }\r\n                iMax = iCurLeft + this._eElem.clientWidth - (this.piMinWidth > 0 ? this.piMinWidth : 0) - 10;\r\n            }\r\n\r\n            //  Configure ghost divider\r\n            eGhost.style.left = iCurLeft + \"px\";\r\n\r\n            this._oParent._eMainArea.appendChild(eGhost);\r\n\r\n        }\r\n\r\n        const iStartLeft = iCurLeft;\r\n        const iStartTop = iCurTop;\r\n        const iStartMouseX = oEvent.getMouseX();\r\n        const iStartMouseY = oEvent.getMouseY();\r\n\r\n        function onResize(oEvent) {\r\n\r\n            if (this.peRegion === df.ciRegionTop || this.peRegion === df.ciRegionBottom) {\r\n                iCurTop = iStartTop - (iStartMouseY - oEvent.getMouseY());\r\n\r\n                iCurTop = (iCurTop < iMax ? (iCurTop > iMin ? iCurTop : iMin) : iMax);\r\n                eGhost.style.top = iCurTop + \"px\";\r\n            } else {\r\n                iCurLeft = iStartLeft - (iStartMouseX - oEvent.getMouseX());\r\n                iCurLeft = (iCurLeft < iMax ? (iCurLeft > iMin ? iCurLeft : iMin) : iMax);\r\n\r\n                eGhost.style.left = iCurLeft + \"px\";\r\n            }\r\n        }\r\n\r\n        function onStopResize(oEvent) {\r\n            df.dom.off(\"mouseup\", eMask, onStopResize, this);\r\n            df.dom.off(\"mouseup\", window, onStopResize, this);\r\n            df.dom.off(\"mousemove\", eMask, onResize, this);\r\n\r\n            eMask.parentNode.removeChild(eMask);\r\n            if (eGhost) {\r\n                eGhost.parentNode.removeChild(eGhost);\r\n            }\r\n\r\n            if (this.peRegion === df.ciRegionTop) {\r\n                this.piHeight = iCurTop;\r\n                this._eElem.style.height = this.piHeight + \"px\";\r\n            } else if (this.peRegion === df.ciRegionBottom) {\r\n                this.piHeight = this._eElem.clientHeight + (iStartTop - iCurTop);\r\n                this._eElem.style.height = this.piHeight + \"px\";\r\n            } else if (this.peRegion === df.ciRegionLeft) {\r\n                this.piWidth = iCurLeft;\r\n                this._eElem.style.width = this.piWidth + \"px\";\r\n            } else if (this.peRegion === df.ciRegionRight) {\r\n                this.piWidth = this._eElem.clientWidth + (iStartLeft - iCurLeft);\r\n                this._eElem.style.width = this.piWidth + \"px\";\r\n            }\r\n\r\n\r\n            this.sizeChanged();\r\n        }\r\n\r\n        df.dom.on(\"mousemove\", eMask, onResize, this);\r\n        df.dom.on(\"mouseup\", window, onStopResize, this);\r\n        df.dom.on(\"mouseup\", eMask, onStopResize, this);\r\n\r\n        oEvent.stop();\r\n    }\r\n\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebBaseView\r\nExtends:\r\n    df.WebBaseContainer\r\n\r\nThis class contains the shared code between WebView and WebWindow.\r\n    \r\nRevision:\r\n    2023/05/17  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebBaseView extends WebBaseContainer {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Properties\r\n        this.prop(df.tInt, \"piMaxWidth\", 0);\r\n        this.prop(df.tInt, \"piMinWidth\", 0);\r\n        this.prop(df.tInt, \"piMinHeight\", 0);\r\n\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tBool, \"pbShowCaption\", true);\r\n        this.prop(df.tBool, \"pbFocusFirstOnShow\", true);\r\n        this.prop(df.tBool, \"pbFillHeight\", false);\r\n\r\n        //  Events\r\n        this.event(\"OnSubmit\", df.cCallModeWait);\r\n        this.event(\"OnShow\", df.cCallModeWait);\r\n        this.event(\"OnHide\", df.cCallModeDefault); // Note that OnHide must be a default call because it is usually followed by an OnShow that should not be cancelled\r\n        this.event(\"OnResizeWindow\", df.cCallModeDefault);\r\n\r\n        //  Set action modes\r\n        this.setActionMode(\"HandleDeleteKey\", df.cCallModeWait);\r\n        this.setActionMode(\"HandleSaveKey\", df.cCallModeWait);\r\n\r\n        //  Privates\r\n        this._oCurrentObj = null; // The (last) object inside the view that currently had / has the focus\r\n        this._eRenderTo = null;\r\n        this._bRendered = false;\r\n        this._bIsView = true;\r\n\r\n        //  Configure parents\r\n        this.pbScroll = true;\r\n    }\r\n\r\n    show() {\r\n        if (this._bStandalone) {\r\n            this._show();\r\n        } else {\r\n            this.getWebApp().showView(this._sName, false);\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (this._bStandalone) {\r\n            this._hide(false);\r\n        } else {\r\n            this.getWebApp().hideView(this._sName);\r\n        }\r\n    }\r\n\r\n    windowResize(iBrowserWidth, iBrowserHeight) {\r\n        if (this._bRendered) {\r\n            this.fire(\"OnResizeWindow\", [iBrowserWidth, iBrowserHeight], function () {\r\n                this.centerWindow();\r\n            });\r\n        } else {\r\n            this._bFireOnResize = true;\r\n        }\r\n    }\r\n\r\n    centerWindow() {\r\n\r\n    }\r\n\r\n    /*\r\n    This method is called by the panel layout system to set the width of this panel. If 0 is passed then \r\n    the panel is allowed to take all space available so we don't need to set it on the DOM elements. We \r\n    override this method here because the HTML structure is different and this might be a floating \r\n    window instead of a panel (which means that we can ignore this call).\r\n    \r\n    @param  iWidth  The new panel width.\r\n    */\r\n    setOuterWidth(iWidth) {\r\n\r\n    }\r\n\r\n\r\n    /* \r\n    Determines the invoking view based on the psInvokingView web property. It makes sure that the object \r\n    exists and is a valid view.\r\n    \r\n    @return Reference to the invoking view object (null if not set / available).\r\n    */\r\n    getInvoking() {\r\n\r\n        if (this.psInvokingView) {\r\n            const oWebApp = this.getWebApp();\r\n\r\n            if (oWebApp[this.psInvokingView] instanceof WebBaseView) {\r\n                return oWebApp[this.psInvokingView];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /* \r\n    Returns the focus to this view, to the last object that had the focus. This method is called by \r\n    WebWindow when a modal window is closed and this is the invoking view.\r\n    \r\n    @private\r\n    */\r\n    returnFocus() {\r\n        if (this._oCurrentObj) {\r\n            this._oCurrentObj.conditionalFocus();\r\n        } else {\r\n            this.conditionalFocus();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called by WebBaseUIObject whenever an object receives the focus. The view remembers this object so \r\n    that returnFocus can return the focus to the right object.\r\n    \r\n    @param  oObj    The object that now has the focus.\r\n    @private\r\n    */\r\n    objFocus(oObj) {\r\n        this._oCurrentObj = oObj;\r\n    }\r\n\r\n    set_piHeight(iVal) {\r\n        this.piHeight = iVal;\r\n\r\n        iVal = (iVal > this.piMinHeight ? iVal : this.piMinHeight);\r\n\r\n        if (iVal > 0) {\r\n            if (this._eElem) {\r\n                //this.setOuterHeight(iVal);\r\n                this.setInnerHeight(iVal);\r\n            }\r\n        }\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_psCaption(sVal) {\r\n        this.psCaption = sVal;\r\n\r\n        this.updateCaption();\r\n    }\r\n\r\n    set_pbShowCaption(bVal) {\r\n        this.pbShowCaption = bVal;\r\n\r\n        this.updateCaption();\r\n    }\r\n\r\n    /* \r\n    Updates the caption based on the psCaption and pbShowCaptiona properties. The label element should \r\n    only be there if pbShowCaption is true and psCaption is set.\r\n    \r\n    @private\r\n    */\r\n    updateCaption() {\r\n        if (!this._eElem) return;\r\n\r\n        this._eLbl.style.display = (this.pbShowCaption ? \"\" : \"none\");\r\n        df.dom.setText(this._eLbl, this.psCaption);\r\n    }\r\n\r\n    /*\r\n    Fires the submit event to the server.\r\n    \r\n    @return True if event handlers where active.\r\n    */\r\n    fireSubmit() {\r\n        // Trigger validate on the focussed object before triggering the key handler. Validate will\r\n        // fire OnChange and autofind if nessecary. This prevents those events from triggering after a\r\n        // view change that this key action could trigger.\r\n        if (this.getWebApp()._oCurrentObj && this.getWebApp()._oCurrentObj.validate) {\r\n            this.getWebApp()._oCurrentObj.validate();\r\n        }\r\n\r\n        return this.fire('OnSubmit');\r\n    }\r\n\r\n    /*\r\n    This method handles the keypress event of the window. It will initiate actions that belong to the pressed key if needed.\r\n    \r\n    @param  oEvent  The event object with event details.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        if (oEvent.matchKey(df.settings.formKeys.submit)) {\r\n            if (this.fireSubmit()) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override getView to return this object.\r\n    */\r\n    getView() {\r\n        return this;\r\n    }\r\n}","import { df } from '../df.js';\r\nimport { WebBaseView } from './WebBaseView.js';\r\nimport { WebBaseControl } from './WebBaseControl.js';\r\n\r\n/*\r\nClass:\r\n    df.WebWindow\r\nExtends:\r\n    df.WebBaseView\r\n\r\nThis class contains the functionality to render a floating modal window. Non modal window support \r\nwas never exposed as part of the product and is now removed.\r\n    \r\nRevision:\r\n    2023/05/17  (HW, DAW)\r\n        Refactored into real dialog element.\r\n    2011/07/11  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebWindow extends WebBaseView {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbResizable\", true);\r\n        this.prop(df.tBool, \"pbShowClose\", true);\r\n\r\n        this.prop(df.tInt, \"piLeft\", 0);\r\n        this.prop(df.tInt, \"piTop\", 0);\r\n\r\n        //  Privates\r\n        this._bHasLeft = false;\r\n        this._bHasTop = false;\r\n\r\n        this._eMask = null;\r\n        this._oPrevFocus = null;\r\n        this.pbModal = false;\r\n\r\n        //  Configure super classes\r\n        this._bWrapDiv = false;\r\n        this._sBaseClass = \"WebWindow\";\r\n    }\r\n\r\n    create() {\r\n        this._bHasLeft = (this.piLeft > 0);\r\n        this._bHasTop = (this.piTop > 0);\r\n    }\r\n\r\n    genClass() {\r\n        this._sBaseClass = \"WebWindow\" + (this.pbResizable ? \" WebWin_Resizable\" : \"\");\r\n        return super.genClass();\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        //  Manually generate wrapper div (due to inheritance structure)\r\n        aHtml.push('<dialog class=\"', this.genClass(), '\"');\r\n        if (this.psHtmlId) {\r\n            aHtml.push(' id=\"', this.psHtmlId, '\"');\r\n        }\r\n\r\n        //  Insert the object name so the HTML element can be traced back to the right object\r\n        aHtml.push(' data-dfobj=\"', this.getLongName(), '\"');\r\n\r\n        aHtml.push(' style=\" ', (this.pbRender ? '' : 'display: none;'), (this.pbVisible ? '' : 'visibility: hidden;'), 'top:10px;\"');\r\n        aHtml.push('>');\r\n\r\n\r\n        aHtml.push(\r\n            '<div class=\"WebWin_top_l\">',\r\n            '<div class=\"WebWin_top_r\">',\r\n            '<div class=\"WebWin_top_c\">',\r\n            '</div>',\r\n            '</div>',\r\n            '</div>',\r\n            '<div class=\"WebWin_main_l\">',\r\n            '<div class=\"WebWin_main_r\">',\r\n            '<div class=\"WebWin_header\">',\r\n            '<div class=\"WebWin_header_r\">',\r\n            '<div class=\"WebWin_header_c\">');\r\n        aHtml.push('             <label class=\"WebWin_title\"', (!this.pbShowCaption ? 'style=\"display: none\"' : ''), '>', df.dom.encodeHtml(this.psCaption), '</label>');\r\n        aHtml.push('<div class=\"WebWin_controls\">');\r\n\r\n\r\n        aHtml.push('<div class=\"WebWin_close\" tabindex=\"0\"', (this.pbShowClose ? '' : ' style=\"display:none\"'), '></div>');\r\n\r\n\r\n        aHtml.push(\r\n            '</div>',\r\n            '<div style=\"clear: both;\"></div>',\r\n            '</div>',\r\n            '</div>',\r\n            '</div>',\r\n\r\n            '<div class=\"WebWin_main_c\">',\r\n            '<div class=\"WebContainer\">'\r\n        );\r\n\r\n        super.openHtml(aHtml);\r\n\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        super.closeHtml(aHtml);\r\n\r\n        aHtml.push('</div>',\r\n            '</div>',\r\n            '</div>',\r\n            '</div>',\r\n            '<div class=\"WebWin_bottom_l\">',\r\n            '<div class=\"WebWin_bottom_r\">',\r\n            '<div class=\"WebWin_bottom_c\">',\r\n            '</div>',\r\n            '<div class=\"WebWin_resizer\">',\r\n            '</div>',\r\n            '</div>',\r\n            '</dialog>');\r\n    }\r\n\r\n    afterRender() {\r\n        //  Get references to generated elements\r\n        this._eLbl = df.dom.query(this._eElem, \"label.WebWin_title\");\r\n\r\n        this._eHeader = df.dom.query(this._eElem, \"div.WebWin_header\");\r\n        this._eHeaderContent = df.dom.query(this._eElem, \"div.WebWin_header_c\");\r\n        this._eControlWrap = df.dom.query(this._eElem, \"div.WebWin_main_c\");\r\n        this._eMainRight = df.dom.query(this._eElem, \"div.WebWin_main_r\");\r\n        this._eMainLeft = df.dom.query(this._eElem, \"div.WebWin_main_l\");\r\n        this._eTopLeft = df.dom.query(this._eElem, \"div.WebWin_top_l\");\r\n        this._eTopRight = df.dom.query(this._eElem, \"div.WebWin_top_r\");\r\n        this._eTopContent = df.dom.query(this._eElem, \"div.WebWin_top_c\");\r\n        this._eBottomLeft = df.dom.query(this._eElem, \"div.WebWin_bottom_l\");\r\n        this._eBottomRight = df.dom.query(this._eElem, \"div.WebWin_bottom_r\");\r\n        this._eResizer = df.dom.query(this._eElem, \"div.WebWin_resizer\");\r\n        this._eBottomContent = df.dom.query(this._eElem, \"div.WebWin_bottom_c\");\r\n        this._eCloseBtn = df.dom.query(this._eElem, \"div.WebWin_close\");\r\n\r\n        //  Call super\r\n        super.afterRender();\r\n\r\n        this.set_piHeight(this.piHeight);\r\n        this.set_piWidth(this.piWidth);\r\n\r\n\r\n        //  Drag\r\n        df.dom.on(\"mousedown\", this._eHeader, this.onStartDrag, this);\r\n\r\n        //  Resizable\r\n        df.dom.on(\"mousedown\", this._eMainRight, this.onStartResize, this);\r\n        df.dom.on(\"mousedown\", this._eMainLeft, this.onStartResize, this);\r\n        df.dom.on(\"mousedown\", this._eTopLeft, this.onStartResize, this);\r\n        df.dom.on(\"mousedown\", this._eBottomLeft, this.onStartResize, this);\r\n\r\n        //  Buttons\r\n        df.dom.on(\"mousedown\", this._eCloseBtn, function (oEvent) { oEvent.stop(); }, this);\r\n        df.dom.on(\"click\", this._eCloseBtn, this.onCloseClick, this);\r\n\r\n        //  Sizing\r\n        if (this._bStandalone) {\r\n            df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n        }\r\n\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n    }\r\n\r\n\r\n\r\n    _show(eRenderTo) {\r\n        const bRender = !this._eElem;\r\n        const oWebApp = this.getWebApp();\r\n\r\n        this.fireEx({\r\n            sEvent: \"OnShow\"\r\n        });\r\n\r\n        //  Render to DOM elements if that didn't happen before\r\n        if (bRender) {\r\n            const eElem = this.render();\r\n            df.dom.addClass(eElem, \"WebWin_Hidden\");\r\n        }\r\n\r\n        //  Insert as first child (hidden)\r\n\r\n        //  When modal we assume that we should give back the focus so we remember where the focus was\r\n        this._oPrevFocus = oWebApp._oCurrentObj;\r\n\r\n        if (this._eElem.parentNode) {\r\n            this._eElem.parentNode.removeChild(this._eElem);\r\n        }\r\n\r\n\r\n        //  Insert into the DOM \r\n        this._eRenderTo = eRenderTo = eRenderTo || oWebApp?._eViewPort || document.body;\r\n        eRenderTo.appendChild(this._eElem);\r\n\r\n        //  Remove \"hidden\" class\r\n        df.dom.removeClass(this._eElem, \"WebWin_Hidden\");\r\n        if (this.pbModal) {\r\n            this._eElem.showModal();\r\n        } else {\r\n            this._eElem.show();\r\n        }\r\n\r\n        //  We still need to call the afterRender method if we freshly rendered\r\n        if (bRender) {\r\n            this.afterRender();\r\n        }\r\n\r\n        //  Make sure sizes are correct and then unhide\r\n        this._bRendered = true;\r\n\r\n        //  Calculate start position (centered) for floating windows, resizing of views must always be initiated by the webapp\r\n        if (this.pbFloating) {\r\n            this.resize();\r\n            this.centerWindow();\r\n        }\r\n\r\n        //  Trigger afterShow\r\n        this.afterShow();\r\n\r\n        this._oCurrentObj = null;\r\n\r\n        //  Make sure that this view is the currentwindow and the focus object is inside this view\r\n        if (oWebApp) {\r\n            oWebApp.objFocus(this);\r\n        }\r\n\r\n        //  Set a small timeout so the framework will resize controls\r\n        setTimeout(() => {\r\n            if (oWebApp && this._bRendered) {\r\n\r\n                //  Add visible CSS class\r\n                df.dom.addClass(this._eElem, \"WebWin_Visible\");\r\n\r\n                //  Give focus to first element\r\n                if (this.pbFocusFirstOnShow && !this._oCurrentObj) {\r\n                    this.conditionalFocus(true);\r\n                }\r\n\r\n                //  Some browsers do not trigger onFocus when opening a dialog\r\n                const eElem = document.activeElement.closest(\"[data-dfobj]\");\r\n                if (eElem) {\r\n                    const oControl = this.getWebApp().findObj(eElem.dataset.dfobj);\r\n                    if (oControl instanceof WebBaseControl) {\r\n                        oControl.updateFocus(true);\r\n                    }\r\n                }\r\n\r\n                //  Fire event\r\n                oWebApp.OnShowWindow.fire(oWebApp, {\r\n                    oWindow: this,\r\n                    eElem: this._eElem,\r\n                    bModal: this.pbModal\r\n                });\r\n            }\r\n        }, 20);\r\n    }\r\n\r\n    _hide(bNoServerEvents) {\r\n        const oWebApp = this.getWebApp();\r\n        let bCanceled = false;\r\n\r\n        if (this._bRendered) {\r\n            if (!bNoServerEvents) {\r\n                this.fire(\"OnHide\", []);\r\n            }\r\n\r\n            //  Restore the focus, this is done by returning the focus to the invoking view, if this is a standalone window that will be the current window\r\n            const oInvoking = this.getInvoking() || oWebApp._oCurrentWindow;  //  \r\n            if (oInvoking) {\r\n                oInvoking.returnFocus();\r\n            } else if (this._oPrevFocus) { //  If there is no invoking view there might be specific object that should receive the focus.\r\n                this._oPrevFocus.conditionalFocus();\r\n            }\r\n\r\n            this._eRenderTo = null;\r\n\r\n            this._eElem.close();\r\n            df.dom.addClass(this._eElem, \"WebWin_Hidden\");\r\n            df.dom.removeClass(this._eElem, \"WebWin_Visible\");\r\n\r\n            //  Fire webapp event\r\n            if (oWebApp) {\r\n                bCanceled = !oWebApp.OnHideWindow.fire(oWebApp, {\r\n                    oWindow: this,\r\n                    eElem: this._eElem,\r\n                    bModal: this.pbModal\r\n                });\r\n            }\r\n        }\r\n\r\n        this._bRendered = false;\r\n        //  Trigger afterHide\r\n        this.afterHide();\r\n\r\n        //  Remove window from DOM\r\n        if (this._bStandalone) {\r\n            //  If the OnHideWindow event was stopped we wait with the removal of the element so an animation or so can be performed, else we do it immediately to not disturb anything\r\n            if (bCanceled) {\r\n                setTimeout(() => {\r\n                    if (this._eElem && this._eElem.parentNode) {\r\n                        this._eElem.parentNode.removeChild(this._eElem);\r\n                    }\r\n                }, 5000);\r\n            } else {\r\n                if (this._eElem && this._eElem.parentNode) {\r\n                    this._eElem.parentNode.removeChild(this._eElem);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* - - - - - - - - - Public API - - - - - - - - - - */\r\n\r\n    set_pbResizable(bVal) {\r\n        if (!this._eElem) return;\r\n\r\n        df.dom.toggleClass(this._eElem, \"WebWin_Resizable\", bVal);\r\n    }\r\n\r\n    set_pbShowClose(bVal) {\r\n        if (!this._eCloseBtn) return;\r\n\r\n        this._eCloseBtn.style.display = (bVal ? '' : 'none');\r\n    }\r\n\r\n    set_piWidth(iVal) {\r\n        let sWidth;\r\n\r\n        iVal = (iVal > this.piMinWidth ? iVal : this.piMinWidth);\r\n        this.piWidth = iVal;\r\n\r\n        sWidth = (iVal > 0 ? parseInt(iVal, 10) + 'px' : '');\r\n\r\n        if (this._eControlWrap) {\r\n            this._eControlWrap.style.width = sWidth;\r\n            this._eHeader.style.width = sWidth;\r\n\r\n            if (this._eElem && iVal > 0) {\r\n                this.setOuterWidth(iVal);\r\n            }\r\n        }\r\n    }\r\n\r\n    set_piHeight(iVal) {\r\n        super.set_piHeight(iVal);\r\n\r\n        if (this._eElem && iVal > 0) {\r\n            this.setOuterHeight(iVal);\r\n        }\r\n    }\r\n\r\n    set_piTop(iVal) {\r\n        this._bHasTop = true;\r\n\r\n        if (this._eElem) {\r\n            this._eElem.style.top = parseInt(iVal, 10) + 'px';\r\n        }\r\n    }\r\n\r\n    set_piLeft(iVal) {\r\n        this._bHasLeft = true;\r\n\r\n        if (this._eElem) {\r\n            this._eElem.style.left = parseInt(iVal, 10) + 'px';\r\n        }\r\n    }\r\n\r\n    /* - - - - - - - - Resizing & Dragging - - - - - - - */\r\n\r\n    createGhost() {\r\n        let eGhost, eGhostContent, eGhostHeader, oSize, aHtml = [], sOrigId;\r\n\r\n        //  Generate HTML\r\n        sOrigId = this.psHtmlId;\r\n        this.psHtmlId = \"\";\r\n\r\n        this._bWrapDiv = false;\r\n        this.openHtml(aHtml);\r\n        this.closeHtml(aHtml);\r\n        this._bWrapDiv = true;\r\n\r\n        this.psHtmlId = sOrigId;\r\n\r\n        //  Create ghost\r\n\r\n        eGhost = df.dom.create(aHtml.join(''));\r\n        eGhost.className = this.genClass() + \" WebWin_ghost\";\r\n        this._eElem.parentNode.appendChild(eGhost);\r\n        //eGhost.innerHTML = aHtml.join('');\r\n        df.dom.disableTextSelection(eGhost);\r\n\r\n        //  Set ghost content properties\r\n        eGhostContent = df.dom.query(eGhost, \".WebWin_main_c\");\r\n        eGhostHeader = df.dom.query(eGhost, \".WebWin_header\");\r\n        oSize = df.sys.gui.getSize(this._eControlWrap);\r\n        eGhostHeader.style.width = oSize.width + 'px';\r\n        eGhostContent.style.width = oSize.width + 'px';\r\n        eGhostContent.style.height = oSize.height + 'px';\r\n        eGhost.style.top = this.piTop + 'px';\r\n        eGhost.style.left = this.piLeft + 'px';\r\n        eGhost.showModal();\r\n        return eGhost;\r\n    }\r\n\r\n    onStartDrag(oEvent) {\r\n        let eMask, eGhost, oSize, iTopLim, iLeftLim, iDragOffsetTop, iDragOffsetLeft;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n\r\n        }\r\n        //  Get drag offset\r\n        iDragOffsetTop = oEvent.getMouseY() - this.piTop;\r\n        iDragOffsetLeft = oEvent.getMouseX() - this.piLeft;\r\n\r\n        //  Determine size, we take in account that some designs have the close button sticking out\r\n        oSize = df.sys.gui.getSize(this._eElem);\r\n        if (this._eCloseBtn) {\r\n            if (this._eCloseBtn.offsetLeft + this._eCloseBtn.offsetWidth > oSize.width) {\r\n                oSize.width = this._eCloseBtn.offsetLeft + this._eCloseBtn.offsetWidth;\r\n            }\r\n        }\r\n\r\n        iLeftLim = this.getViewportWidth() - oSize.width - 1;\r\n        iTopLim = this.getViewportHeight() - oSize.height - 1;\r\n\r\n        //  Create ghost and mask\r\n        eGhost = this.createGhost();\r\n        this._eElem.classList.add(\"Web_Moving\");\r\n\r\n        eMask = df.gui.dragMask();\r\n        eGhost.appendChild(eMask);\r\n        eMask.style.cursor = \"move\";\r\n\r\n\r\n        function onDrag(oEvent) {\r\n            this.piTop = oEvent.getMouseY() - iDragOffsetTop;\r\n            this.piLeft = oEvent.getMouseX() - iDragOffsetLeft;\r\n\r\n            this.piTop = (this.piTop <= 0 ? 1 : (this.piTop >= iTopLim ? iTopLim : this.piTop));\r\n            this.piLeft = (this.piLeft <= 0 ? 1 : (this.piLeft >= iLeftLim ? iLeftLim : this.piLeft));\r\n\r\n            eGhost.style.top = this.piTop + 'px';\r\n            eGhost.style.left = this.piLeft + 'px';\r\n        }\r\n\r\n        function onStopDrag(oEvent) {\r\n            df.dom.off(\"mouseup\", eMask, onStopDrag, this);\r\n            df.dom.off(\"mouseup\", window, onStopDrag, this);\r\n            //df.dom.off(\"mouseout\", eMask, onStopDrag, this);\r\n            df.dom.off(\"mousemove\", eMask, onDrag, this);\r\n\r\n            eMask.parentNode.removeChild(eMask);\r\n            if (eGhost) {\r\n                this._eElem.parentNode.removeChild(eGhost);\r\n            }\r\n\r\n            this._eElem.style.top = this.piTop + 'px';\r\n            this._eElem.style.left = this.piLeft + 'px';\r\n            this._eElem.classList.remove(\"Web_Moving\");\r\n\r\n            this.resize();\r\n        }\r\n\r\n        //  Add eventlisteners\r\n        df.dom.on(\"mouseup\", eMask, onStopDrag, this);\r\n        df.dom.on(\"mouseup\", window, onStopDrag, this);\r\n        //df.dom.on(\"mouseout\", eMask, onStopDrag, this);\r\n        df.dom.on(\"mousemove\", eMask, onDrag, this);\r\n    }\r\n\r\n    onStartResize(oEvent) {\r\n        if (this.pbResizable && this.isEnabled()) {\r\n            const eTar = oEvent.getTarget();\r\n\r\n            if (eTar === this._eMainRight) {\r\n                this.resizeDrag(oEvent, true, false, false, false, \"e-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eMainLeft) {\r\n                this.resizeDrag(oEvent, true, true, false, false, \"e-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eTopRight) {\r\n                this.resizeDrag(oEvent, true, false, true, true, \"ne-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eTopLeft) {\r\n                this.resizeDrag(oEvent, true, true, true, true, \"nw-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eTopContent) {\r\n                this.resizeDrag(oEvent, false, false, true, true, \"n-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eBottomRight || eTar === this._eResizer) {\r\n                this.resizeDrag(oEvent, true, false, true, false, \"nw-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eBottomLeft) {\r\n                this.resizeDrag(oEvent, true, true, true, false, \"ne-resize\");\r\n                oEvent.stop();\r\n            } else if (eTar === this._eBottomContent) {\r\n                this.resizeDrag(oEvent, false, false, true, false, \"n-resize\");\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    resizeDrag(oEvent, bWidth, bLeft, bHeight, bTop, sCursor) {\r\n        let eMask, eGhost, eGhostContent, eGhostHeader, oSize, iStartWidth, iStartLeft, iStartMouseX, iStartHeight, iStartMouseY, iStartTop, iMarginRight = 0, aHiddenPlugins;\r\n\r\n\r\n\r\n        oSize = df.sys.gui.getSize(this._eControlWrap);\r\n        iStartWidth = oSize.width;\r\n        iStartMouseX = oEvent.getMouseX();\r\n        iStartLeft = this.piLeft;\r\n\r\n        iStartHeight = oSize.height;\r\n        iStartMouseY = oEvent.getMouseY();\r\n        iStartTop = this.piTop;\r\n\r\n        this.piHeight = (this.piHeight > 0 ? this.piHeight : this._eControlWrap.clientHeight);\r\n\r\n        //  Some designs have the close button sticking out, we need to take a margin for those designs to prevent scrollbars\r\n        if (this._eCloseBtn) {\r\n            if (this._eCloseBtn.offsetLeft + this._eCloseBtn.offsetWidth > oSize.width) {\r\n                iMarginRight = (this._eCloseBtn.offsetLeft + this._eCloseBtn.offsetWidth) - oSize.width;\r\n            }\r\n        }\r\n\r\n        //  Create ghost and dragmask\r\n        eGhost = this.createGhost();\r\n        eGhostContent = df.dom.query(eGhost, \".WebWin_main_c\");\r\n        eGhostHeader = df.dom.query(eGhost, \".WebWin_header\");\r\n        this._eElem.classList.add(\"Web_Resizing\");\r\n\r\n        eMask = df.gui.dragMask();\r\n        eGhost.appendChild(eMask);\r\n        eMask.style.cursor = sCursor;\r\n\r\n        function onResize(oEvent) {\r\n\r\n\r\n            if (bWidth) {\r\n                if (bLeft) {\r\n                    this.piWidth = iStartWidth - (oEvent.getMouseX() - iStartMouseX);\r\n                    this.piWidth = (this.piWidth > this.piMinWidth ? this.piWidth : this.piMinWidth);\r\n                    this.piLeft = iStartLeft - (this.piWidth - iStartWidth);\r\n                } else {\r\n                    this.piWidth = iStartWidth + (oEvent.getMouseX() - iStartMouseX);\r\n                    this.piWidth = (this.piWidth > this.piMinWidth ? this.piWidth : this.piMinWidth);\r\n\r\n                    //  Resprect the right margin\r\n                    if (this.piWidth + this.piLeft > this.getViewportWidth() - iMarginRight) {\r\n                        this.piWidth = this.getViewportWidth() - iMarginRight - this.piLeft;\r\n                    }\r\n                }\r\n\r\n\r\n                eGhost.style.left = this.piLeft + \"px\";\r\n                eGhostContent.style.width = this.piWidth + \"px\";\r\n                eGhostHeader.style.width = this.piWidth + \"px\";\r\n            }\r\n            if (bHeight) {\r\n                if (bTop) {\r\n                    this.piHeight = iStartHeight - (oEvent.getMouseY() - iStartMouseY);\r\n                    this.piHeight = (this.piHeight > this.piMinHeight ? this.piHeight : this.piMinHeight);\r\n                    this.piTop = iStartTop - (this.piHeight - iStartHeight);\r\n                } else {\r\n                    this.piHeight = iStartHeight + (oEvent.getMouseY() - iStartMouseY);\r\n                    this.piHeight = (this.piHeight > this.piMinHeight ? this.piHeight : this.piMinHeight);\r\n                }\r\n\r\n\r\n                eGhost.style.top = this.piTop + \"px\";\r\n                eGhostContent.style.height = this.piHeight + \"px\";\r\n            }\r\n        }\r\n\r\n\r\n        function onStopResize(oEvent) {\r\n            df.dom.off(\"mouseup\", eMask, onStopResize, this);\r\n            df.dom.off(\"mouseup\", window, onStopResize, this);\r\n            df.dom.off(\"mousemove\", eMask, onResize, this);\r\n\r\n            eMask.parentNode.removeChild(eMask);\r\n            if (eGhost) {\r\n                this._eElem.parentNode.removeChild(eGhost);\r\n            }\r\n\r\n            if (aHiddenPlugins) {\r\n                df.sys.gui.restorePlugins(aHiddenPlugins);\r\n            }\r\n\r\n            this._eControlWrap.style.width = this.piWidth + \"px\";\r\n            this._eHeader.style.width = this.piWidth + \"px\";\r\n            this._eElem.style.left = this.piLeft + \"px\";\r\n            this._eElem.style.top = this.piTop + \"px\";\r\n            this._eElem.classList.remove(\"Web_Resizing\");\r\n            this.setOuterHeight(this.piHeight);\r\n            this.resize();\r\n        }\r\n\r\n        df.dom.on(\"mousemove\", eMask, onResize, this);\r\n        df.dom.on(\"mouseup\", window, onStopResize, this);\r\n        df.dom.on(\"mouseup\", eMask, onStopResize, this);\r\n    }\r\n\r\n    /* - - - - - - - - Supportive - - - - - - - */\r\n\r\n\r\n\r\n    getViewportElem() {\r\n        if (this.pbFloating && this.pbModal) {\r\n            return document.body;\r\n        }\r\n        return this._eRenderTo;\r\n    }\r\n\r\n    blur() {\r\n\r\n    }\r\n\r\n    /*\r\n    Closes the dialog is pbShowClose is set to true.\r\n    */\r\n    doClose() {\r\n        if (this.pbShowClose) {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        if (!this._bRendered) return;\r\n\r\n        //  We have to 'fix' the size for a floating dialog else it won't behave well if the window is \r\n        //  resized. This is only done once when no width & height is set.\r\n        if (this._eControlWrap && !this.piHeight && !this.piWidth) {\r\n            this.piHeight = df.dom.clientHeight(this._eControlWrap);\r\n            this.piWidth = df.dom.clientWidth(this._eControlWrap);\r\n\r\n            this._eControlWrap.style.width = this.piWidth + \"px\";\r\n            this._eHeader.style.width = this.piWidth + \"px\";\r\n            this._eControlWrap.style.height = this.piHeight + \"px\";\r\n        }\r\n\r\n        this.resizeHorizontal();\r\n        this.resizeVertical();\r\n    }\r\n\r\n    setOuterHeight(iHeight) {\r\n        if (iHeight > 0) {\r\n            this._eControlWrap.style.height = iHeight + 'px';\r\n\r\n            iHeight -= this.getHeightDiff(true, true, false, false);\r\n\r\n            this._eContainer.style.height = iHeight + 'px';\r\n        } else {\r\n            this._eControlWrap.style.height = '';\r\n            this._eContainer.style.height = '';\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    Called by the WebApp object to trigger a resize. It gets the maximum available space for views as a \r\n    parameter. If we are floating we just look at the screen dimensions.\r\n    \r\n    @param  iMaxH   Maximum height determined by the WebApp.\r\n    @private\r\n    */\r\n    viewResize(iMaxH) {\r\n        let iDiff, iHeight;\r\n\r\n        this.prepareSize();\r\n\r\n\r\n        //  For dialogs take the ehader and footer into account\r\n        iDiff = df.dom.offsetHeight(this._eHeader) + df.dom.offsetHeight(this._eBottomLeft);\r\n\r\n        //  Dialogs are only limited by the screen / window size\r\n        iMaxH = df.dom.windowHeight() - 20;\r\n\r\n        //  If piHeight is 0 we use the 'wanted' / 'natural' height, else we use piHeight itself\r\n        if (this.piHeight <= 0) {\r\n            iHeight = this._iWantedHeight;\r\n        } else {\r\n            iHeight = this.piHeight;\r\n        }\r\n\r\n        //  Apply the height\r\n        if (iHeight > 0 && iHeight + iDiff < iMaxH) {\r\n            this.setOuterHeight(iHeight);\r\n        } else {\r\n            this.setOuterHeight(iMaxH - iDiff);\r\n        }\r\n\r\n        this.resize();\r\n\r\n    }\r\n\r\n    /*\r\n    Determines the available width for moving and resizing the window.\r\n    \r\n    @return Viewport width in pixels.\r\n    */\r\n    getViewportWidth() {\r\n        return df.sys.gui.getViewportWidth();\r\n    }\r\n\r\n    /*\r\n    Determines the available height for moving and resizing the window.\r\n    \r\n    @return Viewport width in pixels.\r\n    */\r\n    getViewportHeight() {\r\n        return df.sys.gui.getViewportHeight();\r\n    }\r\n\r\n    /*\r\n    This method handles the onclick event of the close button. It calls the doClose method has the logic for handling a close initiated by the client.\r\n    \r\n    @param  oEvent  The event object with event details.\r\n    @private\r\n    */\r\n    onCloseClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.doClose();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method handles the keypress event of the window. It will initiate actions that belong to the pressed key if needed.\r\n    \r\n    @param  oEvent  The event object with event details.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        if (oEvent.matchKey(df.settings.formKeys.escape)) {\r\n            this.doClose();\r\n        } else {\r\n            super.onKey(oEvent);\r\n        }\r\n    }\r\n\r\n    onWindowResize(oEvent) {\r\n        this.centerWindow();\r\n    }\r\n\r\n    centerWindow() {\r\n        if (this._bRendered && this._eElem) {\r\n            if (!this._bHasTop) {\r\n                this.piTop = this.getViewportHeight() / 2 - (this._eElem.clientHeight || this.piHeight) / 2;\r\n\r\n                if (df.sys.isMobile) {\r\n                    this.piTop = this.piTop * 0.65;\r\n                }\r\n\r\n                this.piTop = (this.piTop > 0 ? this.piTop : 0);\r\n            }\r\n            if (!this._bHasLeft) {\r\n                this.piLeft = this.getViewportWidth() / 2 - (this._eElem.clientWidth || this.piWidth) / 2;\r\n\r\n                this.piLeft = (this.piLeft > 0 ? this.piLeft : 0);\r\n            }\r\n            this._eElem.style.top = parseInt(this.piTop, 10) + 'px';\r\n            this._eElem.style.left = parseInt(this.piLeft, 10) + 'px';\r\n        }\r\n    }\r\n\r\n}","import { WebWindow } from './WebWindow.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebModalDialog\r\nExtends:\r\n    df.WebWindow\r\n\r\nThe modal dialog is basically a floating view that is modal. It is rendered as a window. The logic \r\nfor making it floating and modal is in the WebWindow class so we keep the possibility to support MDI \r\nat some point in the future. Special functionality for the 'invoking view' is available in the class \r\nwhich is needed for the chained scope system.\r\n\r\nRevision:\r\n    2011/09/01  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebModalDialog extends WebWindow {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.event(\"OnEscape\", df.cCallModeWait);\r\n\r\n        this.pbFloating = true;\r\n        this.pbModal = true;\r\n        this.pbScroll = false;\r\n        this.psFloatByControl = null;\r\n    }\r\n\r\n    /*\r\n    This method will fire the OnEscape event. If this event is not handled it will close the dialog if \r\n    pbShowClose is true.\r\n    */\r\n    doClose() {\r\n        if (!this.fire('OnEscape')) {\r\n            super.doClose();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Positions the modal dialog next to the object that is referenced in psFloatByControl.\r\n    */\r\n    floatByControl() {\r\n        const oObj = this.getWebApp().findObj(this.psFloatByControl);\r\n        const boundRect = df.sys.gui.getBoundRect(oObj._eElem);\r\n        let oldPiTop, oldPiLeft;\r\n\r\n        oldPiLeft = this.piLeft;\r\n        oldPiTop = this.piTop;\r\n\r\n        this.piTop = boundRect.bottom;\r\n        this.piLeft = boundRect.left;\r\n\r\n        //Attempt to float the modal dialog under the control\r\n        this._eElem.style.top = this.piTop + \"px\";\r\n        this._eElem.style.left = this.piLeft + \"px\";\r\n\r\n        //If the modal dialog falls even slightly offscreen, default it back to the center of the screen\r\n        if (!df.sys.gui.isElementFullyOnScreen(this._eElem)) {\r\n            this.piTop = oldPiTop;\r\n            this.piLeft = oldPiLeft;\r\n            this._eElem.style.top = oldPiTop + \"px\";\r\n            this._eElem.style.left = oldPiLeft + \"px\";\r\n        };\r\n\r\n    }\r\n\r\n    /*\r\n    Returns the 'top layer' element. This is the insertion point for controls like floating panels. \r\n    Usually this will return document.body, but for modal dialogs this is the dialog element, else \r\n    the floating panel would show behind the the dialog.\r\n    */\r\n    topLayer() {\r\n        return this._eElem;\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n/* \r\nClass:\r\n    df.WebLabel\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThe WebLabel is a simple control that shows a piece of text. Compared to the HTML box it isn't \r\ncreated to support HTML / rich text but is implemented for developers that don't want to use the \r\nlabel integrated into controls.\r\n\r\nRevisions:\r\n    2012/03/03  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebLabel extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Properties\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tInt, \"peAlign\", 0);\r\n        this.prop(df.tBool, \"pbShowBorder\", false);\r\n        this.prop(df.tInt, \"peWordBreak\", df.wbPreWrap);\r\n\r\n        //  Configure super classes\r\n        this.pbShowLabel = false;\r\n\r\n        //  @privates\r\n        this._bFocusAble = false;\r\n        this._sControlClass = \"WebLabel\";\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebLabel_content ', df.classWordBreak(this.peWordBreak), '\">&nbsp;</div>');\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebLabel_content\");\r\n\r\n        super.afterRender();\r\n\r\n        this.set_peAlign(this.peAlign);\r\n        this.set_psCaption(this.psCaption);\r\n        this.set_pbShowBorder(this.pbShowBorder);\r\n    }\r\n\r\n    set_psCaption(sVal) {\r\n        if (this._eControl) {\r\n            df.dom.setText(this._eControl, sVal);\r\n\r\n            if (sVal !== this.psCaption) {\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    set_peWordBreak(iVal) {\r\n        if (this._eControl) {\r\n            df._eControl.className = \"WebLabel_content \" + df.classWordBreak(iVal);\r\n        }\r\n    }\r\n\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebLabel_border\", bVal);\r\n\r\n            if (this.pbShowBorder !== bVal) {\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    set_peAlign(iVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.textAlign = (iVal === df.ciAlignLeft ? \"left\" : (iVal === df.ciAlignCenter ? \"center\" : (iVal === df.ciAlignRight ? \"right\" : \"\")));\r\n        }\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebProgressBar\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThe progressbar control is a simple control that consists of multiple div elements where the width \r\nas an percentage is used to show the progress.\r\n    \r\nRevision:\r\n    2013/07/24  (RH, DAE) \r\n        Initial version.\r\n*/\r\nexport class WebProgressBar extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web Properties\r\n        this.prop(df.tInt, \"piMaxValue\", 100);\r\n        this.prop(df.tInt, \"piValue\", 0);\r\n        this.prop(df.tBool, \"pbShowPercentage\", true);\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tInt, \"piDecimals\", \"\");\r\n\r\n        // @privates\r\n        this._eProgressBarWrp = null;\r\n        this._eProgress = null;\r\n        this._ePercentage = null;\r\n\r\n        //  Configure super classes\r\n        this.piColumnSpan = 0;\r\n        this.pbShowLabel = false;\r\n        this._sControlClass = \"WebProgressBar\";\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML for the progressbar.\r\n    \r\n    @param  aHtml   Array used as string builder for the HTML.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebPB_Wrp', (this.pbShowPercentage || this.psCaption ? ' WebPB_ShowPercentage' : ''), '\">');\r\n        aHtml.push('<div>');\r\n        aHtml.push('<div class=\"WebPB_Progress\"></div>');\r\n        if (this.psCaption !== \"\") {\r\n            aHtml.push('<div class=\"WebPB_Percentage\">', df.dom.encodeHtml(this.psCaption), '</div>');\r\n        } else {\r\n            aHtml.push('<div class=\"WebPB_Percentage\"></div>');\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method closes the progressbar wrapper\r\n    \r\n    @param  aHtml   Array string builder to add HTML to.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div></div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after the HTML is added to the DOM and gets a reference to the\r\n    Wrapper, progress and percentage divs\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eProgressBarWrp = df.dom.query(this._eElem, \".WebPB_Wrp\");\r\n        this._eProgress = df.dom.query(this._eElem, \".WebPB_Progress\");\r\n        this._ePercentage = df.dom.query(this._eElem, \".WebPB_Percentage\");\r\n\r\n        this.set_piValue(this.piValue);\r\n\r\n        super.afterRender();\r\n    }\r\n\r\n\r\n    //-------------Helper functions\r\n\r\n    /*\r\n    This function calculates the current percentage of the progress bar\r\n    */\r\n    getPercentage(iCustomDecimals) {\r\n        let iDecimals = this.piDecimals;\r\n        if (iCustomDecimals !== undefined) {\r\n            iDecimals = iCustomDecimals;\r\n        }\r\n        iDecimals = Math.pow(10, iDecimals);\r\n        const fPercentage = (this.piValue / this.piMaxValue) * 100;\r\n\r\n        return Math.round(fPercentage * iDecimals) / iDecimals;\r\n    }\r\n\r\n\r\n    //-------------Setters\r\n    /*\r\n    This function sets the new value of the progressbar and updates the DOM\r\n    */\r\n    set_piValue(iVal) {\r\n        if (this._eProgress) {\r\n            iVal = (iVal >= 0 ? (iVal <= this.piMaxValue ? iVal : this.piMaxValue) : 0);\r\n\r\n            this.piValue = iVal;\r\n            this._eProgress.style.width = this.getPercentage(2) + \"%\";\r\n            df.dom.toggleClass(this._eProgress, \"WebPB_Zero\", iVal === 0);\r\n            if (!this.psCaption) {\r\n                df.dom.setText(this._ePercentage, this.getPercentage() + \"%\");\r\n            }\r\n        }\r\n    }\r\n\r\n    set_pbShowPercentage(bVal) {\r\n        if (this._ePercentage) {\r\n            df.dom.toggleClass(this._eProgressBarWrp, 'WebPB_ShowPercentage', bVal || this.psCaption);\r\n        }\r\n    }\r\n\r\n    set_psCaption(sVal) {\r\n        if (this._ePercentage) {\r\n            this.psCaption = sVal;\r\n\r\n            df.dom.toggleClass(this._eProgressBarWrp, 'WebPB_ShowPercentage', sVal || this.pbShowPercentage);\r\n            if (sVal) {\r\n                df.dom.setText(this._ePercentage, sVal);\r\n            } else {\r\n                //  Update with percentage value\r\n                this.set_piValue(this.piValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    set_piMaxValue(iVal) {\r\n        this.piMaxValue = iVal;\r\n        this.set_piValue(this.piValue);\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\n/*\r\nClass:\r\n    df.WebButton\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class is the client-side implementation of the cWebButton. It renders a button using the \r\n<button html element. The OnClick is usually implemented on the server. Special support is available \r\nfor showing a waiting dialog when the call is being sent (pbShowWaitDialog and pbWaitMessage).\r\n    \r\nRevision:\r\n    2011/08/02  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebButton extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web Properties\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tString, \"psTextColor\", \"\");\r\n        this.prop(df.tString, \"psWaitMessage\", \"\");\r\n        this.prop(df.tBool, \"pbShowWaitDialog\", false);\r\n        this.prop(df.tInt, \"peAlign\", -1);\r\n\r\n        //  Events\r\n        this.event(\"OnClick\", df.cCallModeWait);\r\n\r\n\r\n\r\n        //  Configure super classes\r\n        this.pbShowLabel = false;\r\n\r\n        // @privates\r\n        this._sControlClass = \"WebButton\";\r\n        this._bJSSizing = false;\r\n    }\r\n\r\n    create() {\r\n        super.create();\r\n\r\n        this.set_pbShowWaitDialog(this.pbShowWaitDialog);\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML for the button.\r\n    \r\n    @param  aHtml   Array used as string builder for the HTML.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<button id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\"' : ''));\r\n        if (this.peAlign >= 0) {\r\n            aHtml.push(' style=\"text-align: ', df.sys.gui.cssTextAlign(this.peAlign), '\"');\r\n        }\r\n        aHtml.push('>', df.dom.encodeHtml(this.psCaption), '</button>');\r\n    }\r\n\r\n    /*\r\n    This method is called after the HTML is added to the DOM and provides a hook for doing additional implementation. It gets references to the DOM elements, adds event handlers and executes setters t\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"button\");\r\n\r\n        super.afterRender();\r\n\r\n        //  Attach listeners\r\n        df.dom.on(\"click\", this._eControl, this.onBtnClick, this);\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n    }\r\n\r\n    /*\r\n    Event handler for the OnClick event of the button. It fires the OnClick event of the framework which \r\n    is usually handled on the server.\r\n    \r\n    @param  oEvent  Event object (df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBtnClick(oEvent) {\r\n        let tTimer = null, bDone = false;\r\n        const eElem = this._eElem;\r\n\r\n        if (this.isEnabled()) {\r\n            df.dom.addClass(eElem, df.CssHit);\r\n            tTimer = setTimeout(function () {\r\n                if (bDone) {\r\n                    df.dom.removeClass(eElem, df.CssHit);\r\n                }\r\n                tTimer = null;\r\n            }, df.hitTimeout);\r\n\r\n            this.fire('OnClick', [], function (oEvent) {\r\n                //  Determine if a view needs to be loaded\r\n                if (!oEvent.bCanceled) {\r\n                    if (this.psLoadViewOnClick) {\r\n                        this.getWebApp().showView(this.psLoadViewOnClick, false);\r\n                    }\r\n                }\r\n\r\n                if (!tTimer) {\r\n                    df.dom.removeClass(eElem, df.CssHit);\r\n                }\r\n                bDone = true;\r\n            });\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the applyEnabled method to disable the button by setting the disabled attribute of the \r\n    button HTML element.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl) {\r\n            this._eControl.disabled = !bVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter method for psCaption which is the text shown on the button.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eControl) {\r\n            df.dom.setText(this._eControl, sVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /*\r\n    The setter method for pbShowWaitDialog which changes the action mode of the 'OnClick' from \r\n    df.cCallModeWait to df.cCalModeProgress so that the framework will display the waiting dialog \r\n    during the server call.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbShowWaitDialog(bVal) {\r\n        this.setActionMode(\"OnClick\", (bVal ? df.cCallModeProgress : df.cCallModeWait), this.psWaitMessage);\r\n    }\r\n\r\n    /* \r\n    Ther setter method for psWaitMessage which updates the action mode of the OnClick server call with \r\n    the new wait message.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psWaitMessage(sVal) {\r\n        this.setActionMode(\"OnClick\", (this.pbShowWaitDialog ? df.cCallModeProgress : df.cCallModeWait), sVal);\r\n    }\r\n\r\n    /*\r\n    Handles the onKey event and makes sure that it doesn't propagate the enter key to stop the onsubmit \r\n    event of the view / dialog.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        //  Make sure that the OnSubmit doesn't fire by canceling the propagation (but leaving the default behavior, OnClick intact)\r\n        if (oEvent.matchKey(df.settings.formKeys.submit)) {\r\n            oEvent.stopPropagation();\r\n        }\r\n    }\r\n\r\n    set_peAlign(eVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.textAlign = df.sys.gui.cssTextAlign(eVal);\r\n        }\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebSpacer\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the cWebSpacer class. The WebSpacer control is meant to \r\nadd whitespace to between controls in the column layout flow. While this could be done with other \r\ncontrols this is the official supported way to do it.\r\n    \r\nRevision:\r\n    2012/08/30  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebSpacer extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piHeight\", 0);\r\n        this.prop(df.tInt, \"piMinHeight\", 0);\r\n\r\n        this._sControlClass = \"WebSpacer\";\r\n        this._bFocusAble = false;\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and adds the div.WebSpacer_Spacer element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebSpacer_Spacer\">');\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and closes the div.WebSpacer_Spacer element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and is used the get references to DOM elements, attach event \r\n    listeners and do other initialization.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebSpacer_Spacer\");\r\n\r\n        super.afterRender();\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebIFrame\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the cWebIFrame class. It is capable of rendering an IFrame \r\nusing the IFrame element. The psUrl property allows to set and update the URL being shown within the \r\nIFrame. Its main usage will be to display reports and other external components within a dataflex \r\nweb applications.\r\n    \r\nRevision:\r\n    2012/12/17  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebIFrame extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Public properties\r\n        this.prop(df.tString, \"psUrl\", \"\");\r\n\r\n        this.prop(df.tBool, \"pbShowBorder\", true);\r\n\r\n        this.event(\"OnLocationChange\", df.cCallModeDefault);\r\n\r\n        //  Private properties\r\n        this._eWrapper = null;\r\n        this._sContentHtml = null;\r\n\r\n        this._sControlClass = \"WebIFrame\";\r\n    }\r\n\r\n    /*\r\n    Augments the openHtml method to generate the HTML for rendering the IFrame.\r\n    \r\n    @param  aHtml   Array string builder to add HTML to.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n\r\n        super.openHtml(aHtml);\r\n\r\n        const sName = \"df_webiframe_\" + df.dom.piDomCounter++;\r\n\r\n        aHtml.push('<div class=\"WebIFrm_Wrp\"><iframe name=\"', sName, '\" scrolling=\"auto\" frameborder=\"no\"></iframe></div>');\r\n    }\r\n\r\n    /*\r\n    Augments the afterRender method to get references to the generated elements and execute setter \r\n    methods to further initialize the control.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"iframe\");\r\n        this._eWrapper = df.dom.query(this._eElem, \"div.WebIFrm_Wrp\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"load\", this._eControl, this.onFrameLoad, this);\r\n\r\n        this.set_pbShowBorder(this.pbShowBorder);\r\n        this.set_psUrl(this.psUrl);\r\n\r\n        if (this._sContentHtml != null) {\r\n            this.writeHtmlContent();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the OnChange event of the iframe element. This fires when the location changes. It will \r\n    trigger the OnLocationChange if the url has changed. The psUrl property value will be updated.\r\n    \r\n    @param  oEv     Event object (df.events.DomEvent)\r\n    */\r\n    onFrameLoad(oEv) {\r\n        const sNewLoc = this._eControl.contentWindow.location.href;\r\n\r\n        if (sNewLoc && this.psUrl !== sNewLoc) {\r\n            this.psUrl = sNewLoc;\r\n            this.addSync(\"psUrl\");\r\n\r\n            this.fire(\"OnLocationChange\", [sNewLoc]);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter method for the psUrl property. Updating this property will navigate the iframe to this URL.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psUrl(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.src = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines if the iframe is shown with a border and background. It does this by removing \r\n    or adding the \"WebIFrm_Box\" CSS class.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eWrapper) {\r\n            df.dom.toggleClass(this._eWrapper, \"WebIFrm_Box\", bVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the setHeight method with a custom implementation for this IFrame. It sets the height of the wrapper so that the IFrame element can have a height of 100%. The pixel calculation is also adjusted for this.\r\n    \r\n    @param  iHeight     The height in pixels.\r\n    @param  bSense      If false the size is expected to not be the final size.\r\n    */\r\n    setHeight(iHeight, bSense) {\r\n        if (this._eControl) {\r\n            //  If a negative value is given we should size 'naturally'\r\n            if (iHeight > 0) {\r\n                iHeight -= this.getVertHeightDiff();\r\n\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height\r\n                this._eWrapper.style.height = iHeight + \"px\";\r\n            } else {\r\n                this._eWrapper.style.height = \"80px\";\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    We override this method because the form has an extra wrapper of which the Box Difference needs to \r\n    be taken into account.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eWrapper);\r\n        return iResult;\r\n    }\r\n\r\n\r\n\r\n    /* \r\n    Sets the HTML content of the IFrame. Used by the WebApp class for error display.\r\n    \r\n    @param  sHtml   HTML to display inside the iframe.\r\n    */\r\n    setHtmlContent(sHtml) {\r\n        this._sContentHtml = sHtml;\r\n\r\n        this.writeHtmlContent();\r\n    }\r\n\r\n    /* \r\n    Updates the content of the iframe with the HTML received in setHtmlContent.\r\n    */\r\n    writeHtmlContent() {\r\n        if (this._eControl) {\r\n            this._eControl.contentWindow.document.open('text/htmlreplace');\r\n            this._eControl.contentWindow.document.write(this._sContentHtml);\r\n            this._eControl.contentWindow.document.close();\r\n        }\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebHtmlBox\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the WebHtmlBox class. The WebHtmlBox control can be used \r\nto insert a random piece of HTML into the system. It tries to put the HTML inside the control \r\nrendering flow. This means that it will squeeze itself into the column layout. It can have a dynamic \r\nor a static height and scrollbars and / or a border.\r\n    \r\nRevision:\r\n    2012/06/18  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebHtmlBox extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbScroll\", true);\r\n        this.prop(df.tString, \"psHtml\", \"\");\r\n        this.prop(df.tBool, \"pbShowBorder\", false);\r\n\r\n        //  Events\r\n        this.event(\"OnClick\", df.cCallModeWait);\r\n\r\n        //  @privates\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebHtmlBox\";\r\n        this._bFocusAble = false;\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and adds the div.WebHtml_Wrp element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebHtml_Wrp\">');\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and closes the div.WebHtml_Wrp element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and is used the get references to DOM elements, attach event \r\n    listeners and do other initialization.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebHtml_Wrp\");\r\n\r\n        super.afterRender();\r\n\r\n        this.set_piHeight(this.piHeight);\r\n        this.set_pbShowBorder(this.pbShowBorder);\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onHtmlClick, this);\r\n\r\n        this.updateHtml(this.psHtml);\r\n    }\r\n\r\n    // - - - - - - Public API - - - - - -\r\n\r\n    /*\r\n    Updates the HTML that is shown inside the box. It doesn't perform any checking and if not rendered \r\n    yet it will update psHtml so that it will be set when rendering.\r\n    \r\n    @param  sHtml   String with HTML.\r\n    @client-action\r\n    */\r\n    updateHtml(sHtml) {\r\n        this.psHtml = sHtml;\r\n\r\n        if (this._eControl) {\r\n            this._eControl.innerHTML = this.psHtml;\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates the HTML that is shown inside the box. \r\n    \r\n    It doesn't perform any checking and if not rendered \r\n    yet it will update psHtml so that it will be set when rendering.\r\n    \r\n    @param  sHtml   String with HTML.\r\n    @client-action\r\n    */\r\n    appendHtml(sHtml) {\r\n        this.psHtml += sHtml;\r\n\r\n        if (this._eControl) {\r\n            this._eControl.innerHTML = this.psHtml;\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates the HTML that is shown inside the box. It doesn't perform any checking and if not rendered \r\n    yet it will update psHtml so that it will be set when rendering.\r\n    \r\n    @param  sHtml   String with HTML.\r\n    @client-action\r\n    */\r\n    prependHtml(sHtml) {\r\n        this.psHtml = sHtml + this.psHtml;\r\n\r\n        if (this._eControl) {\r\n            this._eControl.innerHTML = this.psHtml;\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates the HTML that is shown inside the box based on an array passed from the server. It \r\n    concatenates the array and calls updateHtml.\r\n    \r\n    @client-action\r\n    */\r\n    updateHtmlArray() {\r\n        const aArray = df.sys.vt.deserialize(this._tActionData, [df.tString]);\r\n\r\n        this.updateHtml(aArray.join(\"\"));\r\n    }\r\n\r\n    /*\r\n    The setter of pbScroll enables or disabled the scrollbar. Note that no vertical scrollbar will be \r\n    displayed unless the a fixed height is set. A fixed height means that piHeight is set or \r\n    pbFillHeight is true. \r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbScroll(bVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.overflowY = (this.pbFillHeight || this.piHeight > 0 ? (bVal ? \"auto\" : \"hidden\") : \"visible\");    // There should be a fixed height else setting this makes no sense\r\n            this._eControl.style.overflowX = (bVal ? \"auto\" : \"\");\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines if the image is shown with a border and background. It does this by removing \r\n    or adding the \"WebHtml_Box\" CSS class.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebHtml_Box\", bVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    \r\n    @param  iVal    The new value.\r\n    */\r\n    set_piHeight(iVal) {\r\n        if (this._eControl) {\r\n            super.set_piHeight(iVal);\r\n\r\n            //  Update pbScroll since it depends on piHeight\r\n            this.piHeight = iVal;\r\n            this.set_pbScroll(this.pbScroll);\r\n        }\r\n    }\r\n\r\n    set_psHtml(sVal) {\r\n        this.updateHtml(sVal);\r\n    }\r\n\r\n    // - - - - - - Rendering - - - - - -\r\n\r\n    set_pbFillHeight(bVal) {\r\n        super.set_pbFillHeight(bVal);\r\n\r\n        this.pbFillHeight = bVal;\r\n        this.set_pbScroll(this.pbScroll);\r\n    }\r\n\r\n    // - - - - - - Supportive - - - - - -\r\n    /*\r\n    This method handles the onclick event on the div containing the HTML. It will determine which child \r\n    element was actually clicked and then bubble up in the structure to see if a data-serverOnClick \r\n    attribute was set to define a onclick handler. If it finds one it will fire the OnClick event with \r\n    the value of data-serverOnClick and data-OnClickParam as parameters.\r\n    \r\n    @param  oEvent  The event object with event details.\r\n    @private\r\n    */\r\n    onHtmlClick(oEvent) {\r\n        let eElem = oEvent.getTarget();\r\n\r\n        while (eElem && eElem !== this._eControl) {\r\n            if (eElem.getAttribute('data-ServerOnClick')) {\r\n                this.fire('OnClick', [eElem.getAttribute('data-ServerOnClick'), (eElem.getAttribute('data-OnClickParam') || \"\")]);\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n    }\r\n\r\n\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { MobRuleController } from './MobRuleController.js';\r\nimport { WebBaseView } from './WebBaseView.js';\r\nimport { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { WebModalDialog } from './WebModalDialog.js';\r\nimport { WebLabel } from './WebLabel.js';\r\nimport { WebButton } from './WebButton.js';\r\nimport { WebPanel } from './WebPanel.js';\r\nimport { WebIFrame } from './WebIFrame.js';\r\nimport { WebHtmlBox } from './WebHtmlBox.js';\r\nimport { WebObject } from './WebObject.js';\r\n\r\n/*\r\nClass:\r\n    df.BaseApp\r\nExtends:\r\n    df.WebBaseContainer\r\n\r\nThe shared implementation of apps that is shared between LocalApp and WebApp.\r\n*/\r\n\r\n/* global df, sDfPreloadTheme, sDfBuildNr */\r\n\r\nexport class BaseApp extends WebBaseContainer {\r\n    constructor() {\r\n        super(\"oWebApp\", null);\r\n\r\n        this.pbViewApp = false; //  If true this app works with views\r\n\r\n        //  Server properties\r\n        this.prop(df.tString, \"psTheme\", (typeof (sDfPreloadTheme) === \"string\" && sDfPreloadTheme) || \"Df_Web_Creme\");\r\n        this.prop(df.tString, \"psVersionID\", \"\");\r\n\r\n        //  Localization properties\r\n        this.prop(df.tString, \"psDecimalSeparator\", \",\");\r\n        this.prop(df.tString, \"psThousandsSeparator\", \".\");\r\n        this.prop(df.tString, \"psDateFormat\", \"dd/mm/yyyy\");\r\n        this.prop(df.tString, \"psDateSeparator\", \"-\");\r\n        this.prop(df.tString, \"psDateTimeFormat\", \"dd/mm/yyyy hh:mm:ss\");\r\n        this.prop(df.tString, \"psTimeFormat\", \"hh:mm:ss\");\r\n        this.prop(df.tString, \"psTimeSeparator\", \":\");\r\n        this.prop(df.tString, \"psCurrencySymbol\", \"$\");\r\n        this.prop(df.tInt, \"peAlignView\", df.ciAlignCenter);\r\n\r\n        //  Client Details\r\n        this.prop(df.tInt, \"piScreenWidth\", screen.width);\r\n        this.prop(df.tInt, \"piScreenHeight\", screen.height);\r\n\r\n        this.prop(df.tInt, \"piWindowWidth\", 0);\r\n        this.prop(df.tInt, \"piWindowHeight\", 0);\r\n\r\n        this.prop(df.tInt, \"peMode\", 0);\r\n        this.prop(df.tBool, \"pbResponsive\", true);\r\n        this.prop(df.tBool, \"pbIsMobile\", true);\r\n\r\n        this.prop(df.tString, \"psLocationHash\", \"\");\r\n\r\n        this.prop(df.tAdv, \"pasBrowserLanguages\", null);\r\n        this.prop(df.tInt, \"piBrowserTimezoneOffset\", 0);\r\n\r\n        this.prop(df.tBool, \"pbUpdateApplicationTitle\", true);\r\n        this.prop(df.tString, \"psApplicationTitle\", \"\");\r\n\r\n        this.event(\"OnOrientationChange\", df.cCallModeWait);\r\n        this.event(\"OnResizeWindow\", df.cCallModeDefault);\r\n\r\n        //  Client-side Events\r\n        this.OnError = new df.events.JSHandler();\r\n        this.OnShowProgress = new df.events.JSHandler();\r\n        this.OnShowWindow = new df.events.JSHandler();\r\n        this.OnHideWindow = new df.events.JSHandler();\r\n        this.OnHideProgress = new df.events.JSHandler();\r\n\r\n        // @privates\r\n        this._oPreLoaded = {}; //  Administration of views that are preloaded. Will be filled with arrays of queued actions.\r\n\r\n        this._oModeControl = new MobRuleController(this); //  Controller for the mobile modes (web property rules)\r\n        this._oMenuHub = null; //  Hub for menu groups (created on first usage)\r\n\r\n\r\n        this._aSyncPropCache = []; //  Cache of synchronized property values for objects that aren't loaded yet\r\n        this._aAdvSyncPropCache = []; //  Cache of advanced synchronized properties for objects that aren't loaded yet\r\n\r\n        this._oCurrentWindow = null;\r\n        this._oCurrentView = null;\r\n        this._oCurrentObj = null;\r\n        this._aViews = [];\r\n        this._aFocussed = [];\r\n\r\n        this._bReady = false;\r\n        this._aLoadQueue = []; //  Queue of functions to be called after initialization\r\n        this._oLoadViewQueue = {}; //  Queue of functions to be called when a view is loaded\r\n        this._aPreLoadViewActions = []; //  Array with queued actions performed on a view that isn't loaded yet \r\n        this._bInitStarted = false; //  Indicate used by the ready function to see if initialize was already called\r\n\r\n\r\n        this._bCallTimeout = false; //  Determines if server actions are delayed with a timeout (usually true after initialization)\r\n        this._oPendingCall = null; //  Call waiting to be sent\r\n        this._oSendingCall = null; //  Call currently being sent / processed\r\n\r\n        this._eLocked = -1;\r\n        this._aLockwaiters = [];\r\n\r\n        this._eStyleSystem = null;\r\n        this._eStyleTheme = null;\r\n        this._eStyleApplication = null;\r\n        this._sRootPath = df.psRootPath || \"\";\r\n\r\n        this._oTranslations = {};\r\n\r\n        this._aModalQueue = []; //  Queue of modal dialogs waiting for previous one to close\r\n\r\n        this._tResizeTimer = null; //  Timeout set to queue a resize\r\n        this._bSizeChanged = false; //  Switch indicating that a resize is needed after processing the call.\r\n        this._bContainerStretch = false; //  Switch that determines if the webapp should stretch to fill its container or if it should determine its own size\r\n        this._aResponseAttachments = null;\r\n        \r\n        this._bIsBaseApp = true;\r\n\r\n        //  Configure super classes\r\n        this._bWrapDiv = true;\r\n        this._sControlClass = \"WebApp\";\r\n\r\n        this._eViewPort = null;\r\n\r\n        this.addSync(\"peMode\");\r\n        this.addSync(\"pbIsMobile\");\r\n        this.addSync(\"piScreenWidth\");\r\n        this.addSync(\"piScreenHeight\");\r\n        this.addSync(\"piWindowWidth\");\r\n        this.addSync(\"piWindowHeight\");\r\n        this.addSync(\"psLocationHash\");\r\n        this.addSync(\"pasBrowserLanguages\");\r\n        this.addSync(\"piBrowserTimezoneOffset\");\r\n\r\n        this.setActionMode(\"loadView\", df.cCallModeWait);\r\n\r\n        this.ready(this.attachGlobalHandlers);\r\n\r\n        df.log(\"DataFlex Web Application Framework \" + df.psVersionId);\r\n        df.log(\"Copyright 2005-2025 Data Access Corporation. All rights reserved.\"); \r\n\r\n    }\r\n\r\n    /* \r\n    Called after the initial web property values are set and performs non UI related initialization.\r\n    \r\n    @private\r\n    */\r\n    create() {\r\n        super.create();\r\n\r\n        //  Activate / deactivate the responsive system\r\n        this.set_pbResponsive(this.pbResponsive);\r\n    }\r\n\r\n    //  - - - - - - - - - Rendering - - - - - - - - -\r\n\r\n\r\n    attachGlobalHandlers() {\r\n        df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n        df.dom.on(\"scroll\", window, this.onScroll, this);\r\n        df.dom.on(\"orientationchange\", window, this.onOrientationChange, this);\r\n        df.dom.on(\"popstate\", window, this.onPopState, this);\r\n        df.dom.on(\"hashchange\", window, this.onHashChange, this);\r\n\r\n        //  Update screen height and width as some browsers now that browsers are further initialized\r\n        this.piScreenHeight = screen.height;\r\n        this.piScreenWidth = screen.width;\r\n    }\r\n\r\n    /* \r\n    Augment destroy to destroy the mode controller object and remove global event handlers.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        df.dom.off(\"resize\", window, this.onWindowResize, this);\r\n        df.dom.off(\"scroll\", window, this.onScroll, this);\r\n        df.dom.off(\"orientationchange\", window, this.onOrientationChange, this);\r\n\r\n        super.destroy();\r\n\r\n        if (this._oModeControl) {\r\n            this._oModeControl.destroy();\r\n            this._oModeControl = null;\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    Child objects register themselves at their parents. Views are not considered to be regular children.\r\n    \r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        //  Filter out child components since they are not considered regular children\r\n        if (!(oChild instanceof WebBaseView)) {\r\n            if (oChild.peRegion === df.ciRegionCenter) {\r\n                throw new df.Error(999, \"The 'oWebApp' object should not have panels set to the center region, this space is reserved for the WebView.\", this, [oChild.getLongName()]);\r\n            }\r\n\r\n            super.addChild(oChild);\r\n        } else {\r\n            this._aViews.push(oChild);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment the updateEnabled function to notify views of the change in enabled state as well.\r\n    */\r\n    updateEnabled() {\r\n\r\n        super.updateEnabled();\r\n\r\n        for (let i = 0; i < this._aViews.length; i++) {\r\n            if (this._aViews[i] instanceof WebBaseUIObject) {\r\n                this._aViews[i].updateEnabled();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    For the BaseApp object the view region is the implicit center panel. Augment placePanels to create \r\n    the view region element and set it as the center panel. This function can be executed multiple \r\n    times so we make sure to only touch the DOM if nessecary.\r\n    */\r\n    placePanels() {\r\n        super.placePanels();\r\n\r\n        if (this.pbViewApp) {\r\n            if (!this._eViewRegion) {\r\n                this._eViewRegion = df.dom.create('<div class=\"BaseApp_ViewRegion\" style=\"position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px\"></div>');\r\n            }\r\n            this._eRegionCenter = this._eViewRegion;\r\n\r\n            //  Make sure that we insert the viewregion before the clear div created by WebBaseContainer\r\n            if (this._eRegionCenter.parentNode != this._eMainArea || this._eRegionCenter.nextElementSibling != this._eMainArea.lastChild) {\r\n                this._eMainArea.insertBefore(this._eRegionCenter, this._eMainArea.lastChild);\r\n            }\r\n        }\r\n    }\r\n\r\n    //  - - - - - - - - - Initialization - - - - - - - - -\r\n\r\n    /*\r\n    This method initializes the webapp by making the LoadWebApp call to the server. This will return the \r\n    definition of the global objects including the webapp itself and the session key. Optionally there \r\n    can be a startup view returned. After this call is returned the proper CSS is included and we wait \r\n    for the DOM and the CSS to become finished. Finally the waiting handlers are called (usually \r\n    displayView or displayApp). \r\n    \r\n    @private\r\n    */\r\n    initialize(bLoadDefault) {\r\n        this._bInitStarted = true;\r\n\r\n        try {\r\n            if (this.checkBrowser()) {\r\n                this.serverAction(\"LoadWebApp\", [df.fromBool(!!bLoadDefault)], null, function (oEvent) {\r\n                    //  Make sure the proper CSS is included\r\n                    this.updateCSS(false);\r\n\r\n                    //  Check if DOM is ready\r\n                    df.dom.ready(function () {\r\n                        //  Check is CSS is ready\r\n                        this.testCSS(function () {\r\n\r\n                            this._bCallTimeout = true;\r\n\r\n                            try {\r\n                                //  Mark ready\r\n                                this._bReady = true;\r\n\r\n                                //  Call waiters\r\n                                for (let i = 0; i < this._aLoadQueue.length; i++) {\r\n                                    this._aLoadQueue[i].fHandler.call(this._aLoadQueue[i].oEnv || this);\r\n                                }\r\n                            } catch (oErr) {\r\n                                this.handleError(oErr);\r\n                            }\r\n                        });\r\n                    }, this);\r\n                });\r\n            }\r\n        } catch (oErr) {\r\n            this.handleError(oErr);\r\n        }\r\n    }\r\n\r\n    checkBrowser() {\r\n        if (df.sys.isIE && df.sys.iVersion < 11) {\r\n            alert(\"Unfortunately the browser you are using is not supported by this framework. Please upgrade to a more modern browser.\\n\\r\\n\\rThe minimal version required is Internet Explorer 11. We advise to use the latest version of Microsoft Edge, Google Chrome or Mozilla FireFox.\");\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n    /*\r\n    The method passed to this function will be called when the webapp is initialized. Initialization is \r\n    an asynchronous process which requires other functionality to wait. Optionally the name of a view \r\n    can be passed when waiting for a specific view to be synchronized.\r\n    \r\n    The example below waits for the webapp to be synchronized before manipulating global objects.\r\n    @code\r\n    oWebApp.ready(function(){\r\n        oWebApp.oCommandbar.oMenuBar.oDemoMenu.set(\"pbRender\", false);\r\n    });\r\n    @code\r\n    \r\n    The example below waits for the oWebCustomer view to be initialized before manipulating objects \r\n    inside the view.\r\n    @code\r\n    oWebApp.ready(\"oWebCustomer\", function(){\r\n        oWebApp.oWebCustomer.oTabContainer.oBalancesTabPage.set('pbRender', false);\r\n    });\r\n    @code\r\n    \r\n    @param  sOptView    (optional) Objects name of the view to wait for.\r\n    @param  fHandler    Function that needs to be called when ready.\r\n    @param  sOptEnv     (optional) Environment object when the handler is called.\r\n    */\r\n    ready(sView, fHandler, oOptEnv) {\r\n        if (typeof (sView) === \"string\") {\r\n            this.ready(function () {\r\n                if (this[sView] instanceof WebBaseView) {\r\n                    fHandler.call(oOptEnv || this);\r\n                } else {\r\n                    if (!this._oLoadViewQueue[sView]) {\r\n                        this._oLoadViewQueue[sView] = {\r\n                            aWaiters: [],\r\n                            bLoading: false\r\n                        };\r\n                    }\r\n                    this._oLoadViewQueue[sView].aWaiters.push({\r\n                        fHandler: fHandler,\r\n                        oEnv: oOptEnv\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            oOptEnv = fHandler;\r\n            fHandler = sView;\r\n\r\n\r\n            if (!this._bReady) {\r\n                this._aLoadQueue.push({\r\n                    fHandler: fHandler,\r\n                    oEnv: oOptEnv\r\n                });\r\n            } else {\r\n                fHandler.call(oOptEnv || this);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method should be called to render the application. It will render the application as soon as \r\n    the initialization finished to the passed DOM element. The DOM element can be passed as an object \r\n    reference or as a query selector string (like '#viewport'). Using a query selector string allows to \r\n    call this method before the DOM is initialized. The application will render itself inside the \r\n    provided DOM element. \r\n    \r\n    @code\r\n    var oWebApp = new df.WebApp('WebService.wso');\r\n    oWebApp.displayApp('#viewport');\r\n    \r\n    ...\r\n    \r\n    <div id=\"viewport\"></div>\r\n    @code\r\n    \r\n    @param  oRenderTo   The DOM element to render to (object reference or query selector string).\r\n    */\r\n    displayApp(oRenderTo) {\r\n\r\n        if (!this._bInitStarted) {\r\n            this.initialize(true);\r\n        }\r\n\r\n        this.ready(function () {\r\n            let eRenderTo;\r\n\r\n            try {\r\n                //  Get reference to element\r\n                if (typeof (oRenderTo) === \"string\") {\r\n                    eRenderTo = df.dom.query(document.body, oRenderTo);\r\n                } else {\r\n                    eRenderTo = oRenderTo;\r\n                }\r\n                if (!eRenderTo) {\r\n                    throw new df.Error(999, \"No proper element passed\", this);\r\n                }\r\n\r\n                this._eViewPort = eRenderTo;\r\n\r\n                //  Determine if the renderto element has a defined height\r\n                this._bContainerStretch = !df.sys.gui.isSizedByContent(eRenderTo);\r\n\r\n                //  Start rendering the application\r\n                const eContent = this.render();\r\n                this.afterRender();\r\n                eContent.style.visibility = \"hidden\";\r\n                eRenderTo.appendChild(eContent);\r\n                this.afterShow();\r\n                this.forceResize();\r\n                eContent.style.visibility = \"\";\r\n            } catch (oErr) {\r\n                this.handleError(oErr);\r\n            }\r\n        });\r\n    }\r\n\r\n    /*\r\n    This method should be called to render a single view of the application. It will make sure that the \r\n    view is or gets loaded and render it to the passed DOM element. The DOM element can be passed as \r\n    object reference or as a query selector string (like '#viewport'). This method should only be used \r\n    when rendering a view separate of the rest of the application. The view will render itself inside \r\n    the provided DOM element. This is the adviced method to integrate a single view inside an existing \r\n    web page. To show a view within the rendered application please use the showView method.\r\n    \r\n    @code\r\n    var oWebApp = new df.WebApp('WebService.wso');\r\n    oWebApp.displayView('oCustomerView', '#customerdiv');\r\n    \r\n    ...\r\n    \r\n    <div id=\"customerdiv\"></div>\r\n    @code\r\n    \r\n    @param  sView       Name of the view.\r\n    @param  oRenderTo   DOM element to render to (object reference or query selector string).\r\n    */\r\n    displayView(sView, oRenderTo) {\r\n        if (!this._bInitStarted) {\r\n            this.initialize(false);\r\n        }\r\n\r\n        this.ready(function () {\r\n            let eRenderTo;\r\n\r\n            try {\r\n                //  Get reference to element\r\n                if (typeof (oRenderTo) === \"string\") {\r\n                    eRenderTo = df.dom.query(document.body, oRenderTo);\r\n                } else {\r\n                    eRenderTo = oRenderTo;\r\n                }\r\n                if (!eRenderTo) {\r\n                    throw new df.Error(999, \"No proper element passed\", this);\r\n                }\r\n                this._eViewPort = eRenderTo;\r\n\r\n                this.serverActionEx({\r\n                    sMethod: \"ShowView_FromClient\",\r\n                    aParams: [sView, df.fromBool(true)],\r\n                    aViews: [sView],\r\n                    fHandler(oEv) {\r\n                        var oView;\r\n\r\n                        oView = this[sView];\r\n                        if (oView && oView instanceof WebBaseView) {\r\n                            oView._show(eRenderTo);\r\n                        }\r\n\r\n                    },\r\n                    oHandlerEnv: this\r\n                });\r\n            } catch (oErr) {\r\n                this.handleError(oErr);\r\n            }\r\n        });\r\n    }\r\n\r\n    //  - - - - - - - - - View logic - - - - - - - - - - -\r\n\r\n    /* \r\n    Renders the specified view in the center region of the webapp panel. Triggered by the server from \r\n    the ShowView_Exec procedure.\r\n    \r\n    @param  sView   Web object name of the view.\r\n    @client-action\r\n    */\r\n    renderView(sView) {\r\n        this.ready(function () {\r\n            const oView = this[sView];\r\n            if (!oView) {\r\n                throw new df.Error(999, \"Cannot render view '{{0}}' as it is not initialized.\", this, [sView]);\r\n            }\r\n            if (!oView._bRendered) {\r\n\r\n                if (oView instanceof WebModalDialog) {\r\n                    //  For a dialog the current view becomes the invoker\r\n                    oView.psInvokingView = (this._oCurrentWindow && this._oCurrentWindow._sName) || \"\";\r\n                    if (oView.psInvokingView) {\r\n                        oView.addSync(\"psInvokingView\");\r\n                    }\r\n\r\n                    //  Modal dialogs are queued using the 'modal queue' to prevent them from showing on top of errors or info boxes displayed before the dialog.\r\n                    this.queueModal(function () {\r\n                        oView._show(this._eRegionCenter);\r\n                        this.forceResize();\r\n                    }, this);\r\n                } else {\r\n                    this.hideView(this._oCurrentView, (oView === this._oCurrentView));\r\n\r\n                    oView._show(this._eRegionCenter);\r\n                    this.forceResize();\r\n\r\n                    this._oCurrentView = oView;\r\n                }\r\n                this._oCurrentWindow = oView;\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /* \r\n    Shows a view by calling the ShowView_FromClient server action. It makes sure that the view to be \r\n    shown is synchronized. Can be called from the server when showing a view that is loaded to the \\\r\n    client but not synchronized with the call triggering the show.\r\n    \r\n    @param  sView   Web object name of the view.\r\n    @client-action\r\n    */\r\n    showView(sView, sOptCallbackMsg, sOptCallbackObj) {\r\n        const aParams = [sView, df.fromBool(false)];\r\n\r\n        if (sOptCallbackMsg) {\r\n            aParams.push(sOptCallbackMsg);\r\n            aParams.push(sOptCallbackObj);\r\n        }\r\n\r\n        this.serverActionEx({\r\n            sMethod: \"ShowView_FromClient\",\r\n            aParams: aParams,\r\n            aViews: [sView]\r\n        });\r\n    }\r\n\r\n    /*\r\n    This function closes a view or a dialog. That means that it stops rendering the view and with MDI or \r\n    a modal dialog it determines which view will be the new current view.\r\n    \r\n    @param  sView   String with the name of the view.\r\n    @param  bOptNoServerEvents  If true no server calls like OnHide will be executed.\r\n    @client-action\r\n    */\r\n    hideView(sView, bOptNoServerEvents) {\r\n\r\n        //  Param can be name or object\r\n        const oView = (typeof sView === \"string\" ? this[sView] : sView);\r\n\r\n        //  Make sure we are dealing with a view here\r\n        if (oView instanceof WebBaseView) {\r\n            const oInvoking = oView.getInvoking();\r\n            oView._hide(df.toBool(bOptNoServerEvents));\r\n\r\n            if (this._oCurrentWindow === oView) {\r\n                this._oCurrentWindow = null;\r\n            }\r\n            if (this._oCurrentView === oView) {\r\n                this._oCurrentView = null;\r\n            }\r\n\r\n            if (oView instanceof WebModalDialog) {\r\n                if (oInvoking) {\r\n                    this._oCurrentWindow = oInvoking;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method loads a view from the server by making an AJAX Call.\r\n    \r\n    @param  sName       The name of the view.\r\n    @param  bPreLoaded  Should only be sent as true if the view has been initialized already. Used by \r\n                        the server for the pbOverrideStateOnShow logic.\r\n    @param  fHandler    Handler method that is called when the view is loaded.\r\n    @param  oEnv        (Optional) Object used as context when calling the handler method.\r\n    */\r\n    loadView(sName, bPreLoaded, sOptInvoker, fHandler, oEnv) {\r\n\r\n        //  Register as preloaded view\r\n        if (bPreLoaded) {\r\n            this._oPreLoaded[sName] = [];\r\n        }\r\n\r\n        this.ready(function () {\r\n            //  Load a view\r\n            if (this[sName] && this[sName] instanceof WebBaseView) {\r\n                if (fHandler) {\r\n                    fHandler.call(oEnv || this, this[sName]);\r\n                }\r\n            } else {\r\n                //  Register view loading\r\n                if (!this._oLoadViewQueue[sName]) {\r\n                    this._oLoadViewQueue[sName] = {\r\n                        aWaiters: [],\r\n                        bLoading: false\r\n                    };\r\n                }\r\n                if (this._oLoadViewQueue[sName].bLoading) {\r\n                    return;\r\n                }\r\n                this._oLoadViewQueue[sName].bLoading = true;\r\n\r\n                //  Add handler method to waiting queue\r\n                if (fHandler) {\r\n                    this._oLoadViewQueue[sName].aWaiters.push({\r\n                        fHandler: fHandler,\r\n                        oEnv: oEnv\r\n                    });\r\n                }\r\n\r\n                //  Fire the loadView action\r\n                const oAction = new df.ServerAction();\r\n                oAction.oWO = this;\r\n                oAction.sAction = \"loadView\";\r\n                oAction.aParams = [sName, sOptInvoker || \"\", df.fromBool(bPreLoaded)];\r\n\r\n                oAction.eCallMode = df.cCallModeWait;\r\n\r\n                oAction.fHandler = function (oEvent) {\r\n                    let tAct;\r\n                    const oView = this[sName];\r\n\r\n                    if (df.toBool(oEvent.sReturnValue)) {\r\n\r\n                        try {\r\n                            if (oView instanceof WebBaseView) {\r\n                                //  If this is a preloaded view this view is already initialized so there can be queued client actions under _oPreLoaded which we need to execute and then clear\r\n                                if (bPreLoaded && this._oPreLoaded[sName]) {\r\n                                    tAct =  this._oPreLoaded[sName].shift();\r\n                                    while (tAct) {\r\n                                        this.execClientAction(tAct);\r\n                                        tAct =  this._oPreLoaded[sName].shift();\r\n                                    }\r\n                                    delete this._oPreLoaded[sName];\r\n                                }\r\n\r\n\r\n                                //  Call handlers\r\n                                const aWaiters = this._oLoadViewQueue[sName].aWaiters;\r\n                                for (let i = 0; i < aWaiters.length; i++) {\r\n                                    aWaiters[i].fHandler.call(aWaiters[i].oEnv || this, oView);\r\n                                }\r\n\r\n                                //  Remove from registration\r\n                                this._oLoadViewQueue[sName] = null;\r\n                            } else {\r\n                                this._oLoadViewQueue[sName].bLoading = false;\r\n                                throw new df.Error(999, \"No view definition received for '{{0}}'\", this, [sName]);\r\n\r\n                            }\r\n                        } catch (oErr) {\r\n                            this.handleError(oErr);\r\n                        }\r\n                    }\r\n                };\r\n                oAction.oHandlerEnv = this;\r\n\r\n                oAction.aViews.push(sOptInvoker || null);\r\n                oAction.aViews.push(sName);\r\n\r\n                this.handleAction(oAction);\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    /*\r\n    This method unloads a view completely by destroying the associated objects. It will make sure that \r\n    the view has to be loaded freshly from the server when it is opened the next time.\r\n    \r\n    @param  sView       The object name of the view to unload.\r\n    @param  bDefinition If true then the cached view definition should be removed as well.\r\n    \r\n    @client-action\r\n    */\r\n    unloadView(sView, bDefinition) {\r\n\r\n        bDefinition = df.toBool(bDefinition);\r\n\r\n        if (this[sView] && this[sView] instanceof WebBaseView) {\r\n            //  Get reference\r\n            const oView = this[sView];\r\n\r\n            //  Make sure it is hidden\r\n            if (oView._bRendered) {\r\n                this.hideView(sView, true);\r\n            }\r\n\r\n            //  Clear focussed object if inside view\r\n            if (this._oCurrentObj && this._oCurrentObj.getView() === oView) {\r\n                this._oCurrentObj = null;\r\n            }\r\n\r\n            //  Destroy\r\n            oView.destroy();\r\n\r\n            //  Remove from WebObject children array\r\n            const i = this._aChildren.indexOf(oView);\r\n            if (i >= 0) {\r\n                this._aChildren.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        if (bDefinition && this._oWODefStore[sView]) {\r\n            delete this._oWODefStore[sView];\r\n        }\r\n    }\r\n\r\n    //  - - - - - - - - - Window logic - - - - - - - - - - -\r\n\r\n    /* \r\n    This method is called by WebBaseUIObject to register that it has received the focus. The name of the \r\n    focused object is passed to the server during server actions and is sometimes used to determine \r\n    where to return to the focus to.\r\n    \r\n    @param  oObj    The object that has received the focus.\r\n    @private\r\n    */\r\n    objFocus(oObj) {\r\n        const oWin = oObj.getView();\r\n\r\n        //  Update the current window if this object is inside a window. This is needed when using the displayview api, especially with multiple views\r\n        if (oWin && !oWin._bStandalone && oWin._bRendered) {\r\n            this._oCurrentWindow = oWin;\r\n        }\r\n\r\n        if (!oWin || oWin._bRendered) {\r\n            this._oCurrentObj = oObj;\r\n        }\r\n    }\r\n\r\n    /*  \r\n    This method is called by WebBaseUIObject to register that an object has lost the focus.\r\n    \r\n    @param  oObj    The object that lost the focus.\r\n    @private\r\n    */\r\n    objBlur(oObj) {\r\n\r\n    }\r\n\r\n    /* \r\n    This method returns the focus to the object that is known to have focus. The WebMenuItem class uses \r\n    it to return the focus when a menu item is clicked.\r\n    \r\n    @private\r\n    */\r\n    returnFocus() {\r\n        if (this._oCurrentObj) {\r\n            this._oCurrentObj.conditionalFocus();\r\n        }\r\n    }\r\n\r\n    getFocusObjName() {\r\n        if (this._oCurrentObj instanceof WebBaseUIObject && !this._oCurrentObj._bStandalone) {\r\n            return this._oCurrentObj.getLongName();\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n    set_pbMDI(bVal) {\r\n        if (this._eRegionCenter) {\r\n            this._eRegionCenter.style.position = (bVal ? \"relative\" : \"\");\r\n        }\r\n    }\r\n\r\n    notifyScroll(oWO) {\r\n        this.notifyPosChange(oWO);\r\n    }\r\n\r\n    notifyLayoutChange(oWO) {\r\n        this.notifyPosChange(oWO);\r\n    }\r\n\r\n    notifyPosChange(oWO) {\r\n\r\n    }\r\n\r\n    //  - - - - - - - - - Object creation - - - - - - - - - - -\r\n\r\n    /*\r\n    Method that creates the instances of the JavaScript objects based on the JSON description. It will \r\n    walk through the structure and instantiates all the objects. The resulting objects structure will be \r\n    equal to the nested object structure on the server.\r\n    \r\n    @param  tDef    JSON data objects containing object definitions.\r\n    @private\r\n    */\r\n    initJSON(tDef) {\r\n\r\n        function initObj(tDef, oContext) {\r\n            let sP, oObj;\r\n\r\n            //  If no name is given it must be the global webapp object\r\n            if (tDef.sType === \"df.WebApp\") {\r\n                oObj = this;\r\n            } else {\r\n                //  Check for name conflict\r\n                if (!oContext[tDef.sName]) {\r\n\r\n                    //  Find constructor\r\n                    const FConstructor = this.getConstructor(tDef.sType, tDef);\r\n                    if (typeof (FConstructor) === \"function\") {\r\n\r\n                        //  Create new instance\r\n                        oContext[tDef.sName] = oObj = new FConstructor(tDef.sName, oContext);\r\n                    } else {\r\n                        throw new df.Error(999, \"Could not find class '{{0}}'\", this, [tDef.sType]);\r\n                    }\r\n                } else {\r\n                    throw new df.Error(999, \"Naming conflict with child object '{{0}}'\", this, [tDef.sName]);\r\n                }\r\n            }\r\n\r\n            //  Set the published property values\r\n            for (let i = 0; i < tDef.aProps.length; i++) {\r\n                sP = tDef.aProps[i].sN;\r\n\r\n                //  Check naming convention\r\n                if (sP.charAt(0) !== \"_\") {\r\n                    //  Check if not conficting with child object or function\r\n                    if (!oObj[sP] || (typeof (oObj[sP]) !== \"object\" && typeof (oObj[sP]) !== \"function\")) {\r\n                        oObj._set(sP, tDef.aProps[i].sV, false, false);\r\n                    } else {\r\n                        throw new df.Error(999, \"Naming conflict with property '{{0}}' of object '{{1}}'\", this, [sP, tDef.sName]);\r\n                    }\r\n                } else {\r\n                    throw new df.Error(999, \"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'\", this, [tDef.aProps[i].sV, tDef.sName]);\r\n                }\r\n            }\r\n\r\n            //  Set the advanced typed published property values\r\n            if (tDef.aAdvP) {\r\n                for (let i = 0; i < tDef.aAdvP.length; i++) {\r\n                    sP = tDef.aAdvP[i].sN;\r\n\r\n                    //  Check naming convention\r\n                    if (sP.charAt(0) !== \"_\") {\r\n                        if (!oObj[sP] || (typeof (oObj[sP]) !== \"object\" && typeof (oObj[sP]) !== \"function\")) {\r\n                            //  Make sure to mark it as advanced (this is used to determine this when sending a call\r\n                            if (!oObj._oTypes[sP]) {\r\n                                oObj._oTypes[sP] = df.tAdv;\r\n                            }\r\n\r\n                            //  Actually set the property value\r\n                            oObj._set(sP, tDef.aAdvP[i].tV, false, false);\r\n                        } else {\r\n                            throw new df.Error(999, \"Naming conflict with property '{{0}}' of object '{{1}}'\", this, [sP, tDef.sName]);\r\n                        }\r\n                    } else {\r\n                        throw new df.Error(999, \"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'\", this, [tDef.aAdvP[i].sV, tDef.sName]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            //  Register the object\r\n            this.newWebObject(oObj, oContext, tDef);\r\n\r\n            //  Create children\r\n            for (let i = 0; i < tDef.aObjs.length; i++) {\r\n                initObj.call(this, tDef.aObjs[i], oObj);\r\n            }\r\n\r\n            //  Call create\r\n            oObj.create(tDef);\r\n\r\n            return oObj;\r\n        }\r\n\r\n        return initObj.call(this, tDef, this);\r\n    }\r\n\r\n    /*\r\n    Called whenever a new Web Object is created. Registers the Web Object with its parent.\r\n    \r\n    @param  oObj    The newly created web object.\r\n    @param  oParent The parent of the new web object.\r\n    @param  tDef    The JSON definition received from the server.\r\n    */\r\n    newWebObject(oObj, oParent, tDef) {\r\n        //  Register new child control\r\n        if (oParent.addChild && oParent !== oObj) {\r\n            oParent.addChild(oObj);\r\n        }\r\n    }\r\n\r\n    getConstructor(sType) {\r\n        return df.sys.ref.getNestedProp(sType);\r\n    }\r\n\r\n    findObj(sName) {\r\n        let oObj;\r\n\r\n        if (sName === \"\") {\r\n            return this;\r\n        }\r\n\r\n        const aParts = sName.split(/[\\. | \\$]/);\r\n\r\n        oObj = this;\r\n        for (let i = 0; i < aParts.length && oObj; i++) {\r\n            oObj = oObj[aParts[i]];\r\n        }\r\n\r\n        return (typeof oObj === \"object\" && oObj) || null;\r\n    }\r\n\r\n\r\n    //  - - - - - - - - - Server actions - - - - - - - - - - -\r\n\r\n    waitForCall(fFunc, oEnv) {\r\n\r\n        if (this._eLocked >= df.cCallModeDefault) {\r\n            for (let i = 0; i < this._aLockwaiters.length; i++) {\r\n                if (this._aLockwaiters[i].fFunc === fFunc && this._aLockwaiters[i].oEnv === oEnv) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this._aLockwaiters.push({ fFunc: fFunc, oEnv: oEnv });\r\n        } else {\r\n            fFunc.call(oEnv);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function locks a webapp during a call. It generates the locking mask and optionally generates a \r\n    waiting dialog. Key entry is blocked by intercepting the keydown event at document level. The \r\n    function can be called multiple times without problems and will upgrade the lock with a waiting \r\n    dialog when needed.\r\n    \r\n    @param  bWaitDialog     If true a waiting dialog will be shown.\r\n    @param  sWaitMessage    String with message shown in the waiting dialog.\r\n    */\r\n    lock(eCallMode, sWaitMessage) {\r\n        let oDialog;\r\n        const that = this;\r\n\r\n        this._eLocked = eCallMode;\r\n\r\n        if (document && document.body) {  //  Check if the DOM is ready\r\n\r\n            // Lock the webapp\r\n            if (eCallMode >= df.cCallModeWait) {\r\n                if (!this._eLockMask) {\r\n                    this._eLockMask = df.gui.dragMask(this._oCurrentWindow?.topLayer() || document.body);\r\n                    this._tLockCursor = setTimeout(function () {\r\n                        if (that._eLockMask) {\r\n                            that._eLockMask.style.cursor = \"wait\";\r\n                        }\r\n                        that._tLockCursor = null;\r\n                    }, 140);\r\n                }\r\n                df.events.addDomCaptureListener(\"keydown\", document.body, this.onBlockKey, this);\r\n            }\r\n\r\n            // Show wait dialog\r\n            if ((eCallMode >= df.cCallModeProgress) && !this._bLockWait) {\r\n                this._bLockWait = true;\r\n                if (this.OnShowProgress.fire(this, { sMessage: sWaitMessage })) {\r\n\r\n                    //  Block the modal queue (due to focus issues)\r\n                    this._aModalQueue.push(this._oLockModalBlock = {\r\n                        fFunc: null,\r\n                        bFinished: false,\r\n                        bDisplayed: true\r\n                    });\r\n\r\n                    //  Create waiting dialog\r\n                    this._oLockDialog = oDialog = new WebModalDialog(null, this);\r\n                    oDialog.psCaption = \"\";\r\n                    oDialog.pbResizable = false;\r\n                    oDialog.pbShowClose = false;\r\n                    oDialog.psCSSClass = \"WebMsgBox WebMsgBoxProgress\";\r\n\r\n                    const oLabel = new WebLabel(null, oDialog);\r\n                    oLabel.psCaption = sWaitMessage || this.getTrans(\"loading\") + \"..\";\r\n                    oLabel.psCSSClass = \"WebMsgBoxProgress\";\r\n                    oDialog.addChild(oLabel);\r\n\r\n                    oDialog.show();\r\n                    oDialog._oPrevFocus = null; //  Stop dialog from messing with the focus\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    This function unlocks the webapp removing the mask, wait dialog and keydown interception handler. It \r\n    belongs to the lock function. Note that calling lock multiple times doesn't mean that unlock needs \r\n    to be called multiple times.\r\n    */\r\n    unlock() {\r\n        let oHandler;\r\n\r\n        this._eLocked = -1;\r\n\r\n        //  Unlock the webapp\r\n        if (this._eLockMask) {\r\n            this._eLockMask.style.cursor = \"\";\r\n            this._eLockMask.parentNode.removeChild(this._eLockMask);\r\n            this._eLockMask = null;\r\n            if (this._tLockCursor) {\r\n                clearTimeout(this._tLockCursor);\r\n                this._tLockCursor = null;\r\n            }\r\n        }\r\n        if (document && document.body) {  //  Check if the DOM is ready\r\n            df.events.removeDomCaptureListener(\"keydown\", document.body, this.onBlockKey, this);\r\n        }\r\n\r\n        //  Hide the wait dialog\r\n        if (this._bLockWait) {\r\n            this._bLockWait = false;\r\n\r\n            this.OnHideProgress.fire(this, {});\r\n\r\n            if (this._oLockDialog) {\r\n                this._oLockDialog.hide();\r\n                this._oLockDialog = null;\r\n\r\n                // Unblock the modal queue\r\n                this._oLockModalBlock.bFinished = true;\r\n                this.processModal();\r\n            }\r\n        }\r\n\r\n        //  Call functions waiting for call to finish processing\r\n        while (oHandler = this._aLockwaiters.pop()) {\r\n            oHandler.fFunc.call(oHandler.oEnv);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Event handler that will cancel the event if the webapp is in locked state. Is used by the lock \r\n    system to intercept key events at the highest level.\r\n    \r\n    @param  oEvent  Event object (df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBlockKey(oEvent) {\r\n        if (this._eLocked >= df.cCallModeWait) {\r\n            oEvent.stop();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /* \r\n    This function initiates the proper handling of an action by creating a call or adding it to an \r\n    existing call. It will lock the application and initiate the server call process.\r\n    \r\n    @param  oAction     Action object (df.ServerAction).\r\n    @private\r\n    */\r\n    handleAction(oAction) {\r\n        //  Immediately lock the webapp\r\n\r\n        this.lock(oAction.eCallMode, oAction.sProcessMessage);\r\n\r\n        //  Always add the current view\r\n        oAction.aViews.push(this._oCurrentWindow);\r\n\r\n        //  Add action to queue (no actions are ignored any more)\r\n        if (this._oPendingCall) {\r\n            this._oPendingCall.aActions.push(oAction);\r\n            if (this._oPendingCall.eCallMode < oAction.eCallMode) {\r\n                this._oPendingCall.eCallMode = oAction.eCallMode;\r\n            }\r\n        } else {\r\n            this._oPendingCall = new df.ServerCall();\r\n\r\n            this._oPendingCall.aActions.push(oAction);\r\n            this._oPendingCall.sFocus = this.getFocusObjName();\r\n            this._oPendingCall.eCallMode = oAction.eCallMode;\r\n        }\r\n\r\n        //  Process calls\r\n        this.processCall();\r\n    }\r\n\r\n    /*\r\n    Cancels an action based on its name of web object. It will remove all matching actions from the \r\n    pending call and from the call that is being sent but didn't start processing yet.\r\n    \r\n    @param  oWO     Web object.\r\n    @param  sAction Action name.\r\n    @private\r\n    */\r\n    cancelAction(oWO, sAction) {\r\n\r\n        //  For a pending call we remove the entire action if found and cancel the call if empty\r\n        if (this._oPendingCall) {\r\n            const aActions = this._oPendingCall.aActions;\r\n\r\n            for (let i = 0; i < aActions.length; i++) {\r\n                if (aActions[i].oWO === oWO && aActions[i].sAction === sAction) {\r\n                    aActions.splice(i, 1);\r\n                    i--;\r\n                }\r\n                if (aActions.length === 0) {\r\n                    this._oPendingCall = null;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*  \r\n    Determines if a server action is already pending (waiting to be sent) for a specific web object.\r\n    \r\n    @param  oWO     Web Object.\r\n    @param  sAction Action name.\r\n    @return True if the action is pending.\r\n    */\r\n    hasPendingAction(oWO, sAction) {\r\n\r\n        if (this._oPendingCall) {\r\n            const aActions = this._oPendingCall.aActions;\r\n\r\n            for (let i = 0; i < aActions.length; i++) {\r\n                if (aActions[i].oWO === oWO && aActions[i].sAction === sAction) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    processResponse(tData, oCall) {\r\n        if (tData && tData.r && tData.r.Header && tData.r.asReturnValues) {\r\n            const tResponse = tData.r;\r\n\r\n            this._aResponseAttachments = tData.a || [];\r\n\r\n            //  Handle header\r\n            this.handleHeader(tResponse.Header);\r\n\r\n            //  Call handlers\r\n            if (oCall && oCall.aActions.length === tResponse.asReturnValues.length) {\r\n                const oEvent = new df.events.JSEvent(this);\r\n                for (let i = 0; i < oCall.aActions.length; i++) {\r\n                    oEvent.sReturnValue = tResponse.asReturnValues[i];\r\n\r\n                    if (oCall.aActions[i].fHandler) {\r\n                        oCall.aActions[i].fHandler.call(oCall.aActions[i].oHandlerEnv || null, oEvent);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._aResponseAttachments = null;\r\n        } else {\r\n            throw new df.Error(5123, \"Unexpected response format.\", this);\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Checks if a pending call is available and can be sent. This happens after a short timeout so that \r\n    actions can still be added to the pending call from the current execution flow. This method is \r\n    called after processing a call or when a new action is registered.\r\n    \r\n    @private\r\n    */\r\n    processCall() {\r\n\r\n        const process = () => {\r\n            try {\r\n                const oCall = this._oPendingCall;\r\n                if (oCall) {\r\n                    if (!this._oSendingCall) {\r\n\r\n                        //  Register as the call currently being sent\r\n                        this._oSendingCall = oCall;\r\n\r\n                        this.sendCall(oCall).then(tData => {\r\n                            this.processResponse(tData, oCall);\r\n                        }).catch(oErr => {\r\n                            this.handleError(oErr);\r\n                        }).finally(() => {\r\n                            //  Make sure that we always unlock!!!\r\n                            if (!this._oPendingCall) {\r\n                                this.unlock();\r\n                            }\r\n                            this._oSendingCall = null;\r\n\r\n                            //  Initiate next call if needed\r\n                            this.processCall();\r\n                        });\r\n                        this._oPendingCall = null;\r\n                    }\r\n                }\r\n            } catch (oErr) {\r\n                //  Make sure that we always unlock!!!\r\n                this.unlock();\r\n                this._oPendingCall = null;\r\n                this._oSendingCall = null;\r\n\r\n                this.handleError(oErr);\r\n            }\r\n        }\r\n\r\n        if (this._bCallTimeout) {\r\n            if (window.requestIdleCallback) {\r\n                window.requestIdleCallback(process, { timeout: 30 });\r\n            } else {\r\n                window.setTimeout(process, 10);\r\n            }\r\n        } else {\r\n            process();\r\n        }\r\n    }\r\n\r\n    assembleRequest(oCall) {\r\n        //  Generate request data\r\n        let aViews = [];\r\n        let aAttachments = [];\r\n        const aActions = [];\r\n\r\n        oCall.aActions.forEach(oAction => {\r\n            aActions.push({\r\n                sTarget: oAction.oWO.getLongName(),\r\n                sAction: oAction.sAction,\r\n                aParams: oAction.aParams,\r\n                iAttached: (oAction.tData && aAttachments.push(oAction.tData) || 0)\r\n            });\r\n\r\n            aViews = aViews.concat(oAction.aViews);\r\n        });\r\n\r\n        //  Assemble request data\r\n        return {\r\n            v: df.psVersionId,\r\n            r: {\r\n                Header: this.getHeader(aViews, oCall.sFocus),\r\n                aActions: aActions\r\n            },\r\n            a: aAttachments\r\n        };\r\n    }\r\n\r\n    sendCall(oCall) {\r\n        return new Promise((resolve, reject) => {\r\n            reject(new df.Error(99, \"Not implemented\"));\r\n        });\r\n    }\r\n\r\n\r\n    /*\r\n    This core method of the framework is responsible for generating the header of a call that is sent to \r\n    the server. This header consists of the session key, name of the focused object, DDO definitions per \r\n    view and the set of synchronized properties. It gets a list of views (or a single view) that \r\n    determines which views are involved in the call. For each view it will add the DDO definitions and \r\n    the synchronized properties.  To get the synchronized properties the recursive getSynched method is \r\n    called.\r\n    \r\n    @param  oView       The view(s) that need to be incorporated. Can be an array of views or a single \r\n                        view. A view can be passed as a string name or an object reference. May contian \r\n                        duplicates.\r\n    @param  sFocus      Name of the currently focussed object.\r\n    @private\r\n    */\r\n    getHeader(oView, sFocus) {\r\n        const oDone = {};\r\n\r\n        const tHead = {\r\n            sFocus: sFocus,\r\n            aDDOViews: [],\r\n            aSyncProps: [],\r\n            aAdvSyncP: []\r\n        };\r\n\r\n        //  Gather global synchronized properties\r\n        this.getSynced(tHead.aSyncProps, tHead.aAdvSyncP);\r\n\r\n        function addView(oView) {\r\n            var oViewObj, oInvoking, sViewName;\r\n\r\n            //  Try to find the view object\r\n            if (typeof (oView) === \"string\") {\r\n                oViewObj = this.findObj(oView);\r\n                sViewName = oView;\r\n            } else {\r\n                oViewObj = oView;\r\n                sViewName = oViewObj._sName;\r\n            }\r\n\r\n            if (!oDone[sViewName]) {\r\n                oDone[sViewName] = true; //  Make sure that we don't add views twice\r\n\r\n\r\n                if (oViewObj instanceof WebBaseView) {\r\n                    //  Add invoker view\r\n                    oInvoking = oViewObj.getInvoking();\r\n                    if (oInvoking) {\r\n                        addView.call(this, oInvoking);\r\n                    }\r\n\r\n                    //  Get synchonized props\r\n                    oViewObj.getSynced(tHead.aSyncProps, tHead.aAdvSyncP);\r\n\r\n                    //  Add DDO details\r\n                    tHead.aDDOViews.push(sViewName);\r\n\r\n                } else {\r\n                    //  This means that the view doesn't exist yet so we load synchronized properties from the cache\r\n                    this.getCachedSyncProps(oView, tHead.aSyncProps, tHead.aAdvSyncP);\r\n\r\n                    //  With the pbOverrideStateOnShow property it can be that we are loading a view that already has a DDO state\r\n                    tHead.aDDOViews.push(sViewName);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (oView instanceof Array) {\r\n            for (let i = 0; i < oView.length; i++) {\r\n                if (oView[i]) {\r\n                    addView.call(this, oView[i]);\r\n                }\r\n            }\r\n        } else if (oView) {\r\n            addView.call(this, oView);\r\n        }\r\n\r\n        return tHead;\r\n    }\r\n\r\n    /*\r\n    This is one of the most important methods of the framework as it handles the header section received \r\n    back from the server after a call. This header section can contain object definitions of new \r\n    objects, updates synchronized properties, updated DDO definitions, client actions that need to be \r\n    executed and possible errors.\r\n    \r\n    @param  oHeader     The header data.\r\n    @private\r\n    */\r\n    handleHeader(oHeader) {\r\n        //  Execute early client actions\r\n        for (let i = 0; i < oHeader.aActions.length; i++) {\r\n            if (oHeader.aActions[i].eType === df.ctExecEarly) {\r\n                this.execClientAction(oHeader.aActions[i]);\r\n            }\r\n        }\r\n\r\n        //  Create objects if a definition has returned\r\n        for (let i = 0; i < oHeader.aObjectDefs.length; i++) {\r\n            this.initJSON(oHeader.aObjectDefs[i]);\r\n        }\r\n\r\n        //  Process synchronized properties\r\n        this.handleSyncProps(oHeader.aSyncProps);\r\n        this.handleAdvSyncProps(oHeader.aAdvSyncP);\r\n\r\n        //  Call the action methods\r\n        for (let i = 0; i < oHeader.aActions.length; i++) {\r\n            if (oHeader.aActions[i].eType !== df.ctExecEarly) {\r\n                this.execClientAction(oHeader.aActions[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates web properties based on the set of web property values provided. It expects the web property \r\n    values to be provided in the format they are received from the server.\r\n    \r\n    @param  aProps  Array of web property values.\r\n    @private\r\n    */\r\n    handleSyncProps(aProps) {\r\n\r\n        //  Loop through objects with synced props\r\n        for (let i = 0; i < aProps.length; i++) {\r\n            const tObj = aProps[i];\r\n\r\n            //  Find WebObject\r\n            const oWO = this.findObj(tObj.sO);\r\n            if (oWO) {\r\n                //  Loop through props and set them\r\n                for (let x = 0; x < tObj.aP.length; x++) {\r\n                    oWO._set(tObj.aP[x].sN, tObj.aP[x].sV, true, true);\r\n                }\r\n\r\n            } else {\r\n                //  We place it in the cache\r\n                this.cacheSyncProps(tObj);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates advanced web properties based on the set of web property values provided. It expects the web \r\n    property values to be provided in the format they are received from the server.\r\n    \r\n    @param  aProps  Array of web property values.\r\n    @private\r\n    */\r\n    handleAdvSyncProps(aAdvSyncP) {\r\n\r\n        //  Store advanced sync props\r\n        for (let i = 0; i < aAdvSyncP.length; i++) {\r\n            const tP = aAdvSyncP[i];\r\n            //  Find WebObject\r\n            const oWO = this.findObj(tP.sO);\r\n\r\n            if (oWO) {\r\n                //  Loop through props and set them\r\n                oWO._set(tP.sP, tP.tV, true, true);\r\n            } else {\r\n                //  We place it in the cache\r\n                this.cacheAdvProp(tP);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Executes a single client action based on the passed information.\r\n    \r\n    @param tAct Details of the client-action.\r\n    @private\r\n    */\r\n    execClientAction(tAct) {\r\n        //  Find object and function\r\n        const oWO = this.findObj(tAct.sTarget)\r\n        let sViewName;\r\n\r\n        if (oWO) {\r\n            const oFunc = oWO.findFunc(tAct.sName);\r\n            if (typeof oFunc.fFunc === \"function\") {\r\n\r\n                //  Make action data available as property\r\n                if (tAct.iAttached > 0) {\r\n                    if (tAct._tActionData) {  //  If this is a cached action then the attachment is stored in _tActionData (see storeViewLoadAction)\r\n                        oWO._tActionData = tAct._tActionData;\r\n                    } else {\r\n                        oWO._tActionData = this.responseAttachment(tAct.iAttached);\r\n                    }\r\n                }\r\n\r\n                //  Call client action\r\n                try {\r\n\r\n                    oFunc.fFunc.apply(oFunc.oEnv, tAct.aParams);\r\n                } catch (oErr) {\r\n                    this.handleError(oErr);\r\n                }\r\n\r\n                //  Clear action data\r\n                oWO._tActionData = null;\r\n\r\n            } else {\r\n                this.handleError(new df.Error(999, \"Action method not found '{{0}}' on object '{{1}}'\", this, [tAct.sName, tAct.sTarget]));\r\n            }\r\n        } else {\r\n            //  Determine the view name by parsing it out of the full target object\r\n            sViewName = tAct.sTarget;\r\n            if (sViewName.indexOf('.') > 0) {\r\n                sViewName = sViewName.substr(0, sViewName.indexOf('.'));\r\n            }\r\n\r\n            //  Queue client actions performed on a view that is \"preloaded\" (pbOverrideStateOnShow functionality)\r\n            if (this._oPreLoaded[sViewName]) {\r\n                if (tAct.iAttached) {\r\n                    tAct._tActionData = this.responseAttachment(tAct.iAttached);\r\n                }\r\n                this._oPreLoaded[sViewName].push(tAct);\r\n            } else {\r\n                this.handleError(new df.Error(999, \"Could not find object '{{0}}'\", this, [tAct.sTarget]));\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    responseAttachment(iIndex) {\r\n        if (this._aResponseAttachments && this._aResponseAttachments.length > (iIndex - 1)) {\r\n            return this._aResponseAttachments[iIndex - 1];\r\n        }\r\n        throw new df.Error(999, \"Invalid response attachment index.\", this);\r\n    }\r\n\r\n    /*\r\n    This method puts new synchronized property values in the cache. This cache has the same structure as \r\n    in which the synchronized properties are sent. If properties where already in the cache it will \r\n    merge them and update to the new value. The cache is allows synchronized properties to be set on \r\n    views before they are loaded. The synchronized loading of views creates a need for this. This method \r\n    is called when synchronized properties are received for objects that don't exist.\r\n    \r\n    @param  tObj    The struct / JSON object representing the synchronized properties.\r\n    @private\r\n    */\r\n    cacheSyncProps(tObj) {\r\n        let bFound;\r\n\r\n        //  See if we already have this object in cache\r\n        for (let i = 0; i < this._aSyncPropCache.length; i++) {\r\n            if (this._aSyncPropCache[i].sO === tObj.sO) {\r\n\r\n                //  Now we need to merge the synced props into the existing cache object\r\n                const tCacheObj = this._aSyncPropCache[i];\r\n\r\n                for (let x = 0; x < tObj.aP.length; x++) {\r\n                    bFound = false;\r\n\r\n                    for (let y = 0; y < tCacheObj.aP.length && !bFound; y++) {\r\n                        if (tCacheObj.aP[y].sN === tObj.aP[x].sN) {\r\n                            tCacheObj.aP[y].sV = tObj.aP[x].sV;\r\n\r\n                            bFound = true;\r\n                        }\r\n                    }\r\n                    if (!bFound) {\r\n                        tCacheObj.aP.push(tObj.aP[x]);\r\n                    }\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        //  Else we can simply add the new object\r\n        this._aSyncPropCache.push(tObj);\r\n    }\r\n\r\n    /* \r\n    This method puts a new advanced synchronized property in the cache. This cache has a flat structure \r\n    as in which advanced sync props are sent. If the property is already in the cache it will override \r\n    its value. This cache allows advanced synchronized properties to be set before their view is loaded \r\n    to the client.\r\n    \r\n    @param  tP      The struct / JSON object representing a single synchronized property..\r\n    @private\r\n    */\r\n    cacheAdvProp(tP) {\r\n\r\n        for (let i = 0; i < this._aAdvSyncPropCache.length; i++) {\r\n            if (this._aAdvSyncPropCache[i].sO === tP.sO && this._aAdvSyncPropCache[i].sP === tP.sP) {\r\n                this._aAdvSyncPropCache[i].tV = tP.tV;\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._aAdvSyncPropCache.push(tP);\r\n    }\r\n\r\n    /*\r\n    This method gets cached synchronized properties for a specific view. It goes through the cache and \r\n    returns and removes all the synchronized properties for that view. This happens when loading a view \r\n    and the caching of synchronized properties allows developers to WebSet on views before they are on \r\n    the client (the ASynchronized loading creates a need for this).\r\n    \r\n    @param  sView       The object name of the view.\r\n    @param  aSyncProps  Reference to the synchronized properties array to which the result is added.\r\n    @private\r\n    */\r\n    getCachedSyncProps(sView, aSyncProps, aAdvSyncP) {\r\n        const sStart = sView + '.';\r\n        const iLen = sStart.length;\r\n\r\n        for (let i = 0; i < this._aSyncPropCache.length; i++) {\r\n            //  Check if part of the view\r\n            if (this._aSyncPropCache[i].sO === sView || this._aSyncPropCache[i].sO.substr(0, iLen) === sStart) {\r\n                //  Add to result\r\n                aSyncProps.push(this._aSyncPropCache[i]);\r\n\r\n                //  Remove from cache\r\n                this._aSyncPropCache.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._aAdvSyncPropCache.length; i++) {\r\n            //  Check if part of the view\r\n            if (this._aAdvSyncPropCache[i].sO === sView || this._aAdvSyncPropCache[i].sO.substr(0, iLen) === sStart) {\r\n                aAdvSyncP.push(this._aAdvSyncPropCache[i]);\r\n\r\n                //  Remove from cache\r\n                this._aAdvSyncPropCache.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - -  Positioning and styling - - - - - - - - \r\n\r\n\r\n\r\n    set_psTheme(sVal) {\r\n        if (this.psTheme !== sVal) {\r\n            //  Remove the old theme from the body element\r\n            if (document.body) {\r\n                df.dom.removeClass(document.body, this.psTheme);\r\n            }\r\n\r\n            this.psTheme = sVal;\r\n            this.updateCSS(true);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter for pbResponsive which will activate or deactivate the responsive system. It forwards this \r\n    call to the separate mode controller object.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbResponsive(bVal) {\r\n        if (this._oModeControl) {\r\n            if (bVal) {\r\n                this._oModeControl.activate();\r\n            } else {\r\n                this._oModeControl.deactivate();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter for the view alignment. The view is aligned during the resize process so just sending a \r\n    resize should do the job after the property is updated.\r\n    \r\n    @param  iVal    The new value.\r\n     */\r\n    set_peAlignView(iVal) {\r\n        this.peAlignView = iVal;\r\n\r\n        this.sizeChanged();\r\n    }\r\n\r\n    updateCSS(bResize) {\r\n        let sV;\r\n        const that = this, sTheme = this.psTheme.trim();\r\n\r\n\r\n        if (!this._eStyleSystem || !this._eStyleTheme || !this._eStyleApplication) {\r\n            //  Determine version GET parameter\r\n            sV = \"?v=\" + df.psVersionId;\r\n            if (typeof (sDfBuildNr) === \"string\" && sDfBuildNr) {  //  Add a custom string to the version GET parameter of the URL\r\n                sV += \".\" + sDfBuildNr;\r\n            }\r\n\r\n            //  Get references to existing CSS elements\r\n            const aStyles = df.dom.query(document, \"link\", true);\r\n            for (let i = 0; i < aStyles.length; i++) {\r\n                if (aStyles[i].href.indexOf(\"DfEngine/system.css\") > 0) {\r\n                    this._eStyleSystem = aStyles[i];\r\n                }\r\n                if (aStyles[i].href.indexOf(\"CssThemes/\") > 0 && aStyles[i].href.indexOf(\"theme.css\") > 0) {\r\n                    this._eStyleTheme = aStyles[i];\r\n                }\r\n                if (aStyles[i].href.indexOf(\"CssStyle/application.css\") > 0) {\r\n                    this._eStyleApplication = aStyles[i];\r\n                }\r\n            }\r\n\r\n            //  Create system CSS include if needed\r\n            if (!this._eStyleSystem) {\r\n                this._eStyleSystem = df.dom.createCSSElem(this._sRootPath + \"DfEngine/system.css\" + sV);\r\n\r\n                const eHead = document.head || document.getElementsByTagName(\"head\")[0];\r\n                if (eHead.firstChild) {\r\n                    eHead.insertBefore(this._eStyleSystem, eHead.firstChild);\r\n                } else {\r\n                    eHead.appendChild(this._eStyleSystem);\r\n                }\r\n            }\r\n\r\n            //  Create theme CSS include if needed\r\n            if (!this._eStyleTheme) {\r\n                this._eStyleTheme = df.dom.createCSSElem(this._sRootPath + \"CssThemes/\" + sTheme + \"/theme.css\" + sV);\r\n                df.dom.insertAfter(this._eStyleTheme, this._eStyleSystem);\r\n                // document.body.appendChild(this._eStyleTheme);\r\n            }\r\n\r\n            //  Create application CSS include if needed\r\n            if (!this._eStyleApplication) {\r\n                this._eStyleApplication = df.dom.createCSSElem(this._sRootPath + \"CssStyle/application.css\" + sV);\r\n                df.dom.insertAfter(this._eStyleApplication, this._eStyleTheme);\r\n            }\r\n\r\n            if (document.body) {\r\n                document.body.id = \"OWEBAPP\";\r\n            }\r\n\r\n\r\n\r\n        }\r\n\r\n        //  Set theme classname on the body element\r\n        if (document.body) {\r\n            df.dom.addClass(document.body, this.psTheme);\r\n        }\r\n\r\n        //  Update theme path if needed\r\n        if (this._eStyleTheme.href.indexOf(this._sRootPath + \"CssThemes/\" + sTheme + \"/theme.css\") < 0) {\r\n            this._eStyleTheme.href = this._sRootPath + \"CssThemes/\" + sTheme + \"/theme.css\";\r\n        }\r\n\r\n        //  Call resize method after 'CSS Test' has finished\r\n        if (bResize) {\r\n            this.testCSS(function () {\r\n                this.resize();\r\n\r\n                setTimeout(function () {\r\n                    try {\r\n                        that.resize();\r\n                    } catch (oErr) {\r\n                        that.handleError(oErr);\r\n                    }\r\n                }, 200);\r\n            });\r\n        }\r\n    }\r\n\r\n    /*\r\n    Tests if the CSS is loaded by creating an element with df_load_test ID and waiting to see if it gets a \r\n    size. It uses an observer to respond as soon as possible but also check with a timer in case the observer \r\n    somehow does not work.\r\n    \r\n    If no fFailed function is passed then fSuccess will always be called after a longer wait period. If fFailed \r\n    is passed (in the designer it is) we'll call it after 500ms.\r\n    */\r\n    testCSS(fSuccess, fFailed) {\r\n        let oObserver, iCount = 0, bDone = false;\r\n\r\n        const eTest = df.dom.create('<div id=\"df_load_test\" style=\"position: absolute\"></div>');\r\n\r\n        const checksize = () => {\r\n            if (!bDone && eTest.clientHeight >= 1) {\r\n                oObserver.disconnect();\r\n                eTest.parentNode.removeChild(eTest);\r\n\r\n                bDone = true;\r\n                fSuccess.call(this);\r\n            }\r\n            return bDone;\r\n        };\r\n\r\n        oObserver = new ResizeObserver((entries) => {\r\n            checksize();\r\n        });\r\n\r\n        oObserver.observe(eTest);\r\n        document.body.appendChild(eTest);\r\n\r\n        const timer = () => {\r\n            if (!checksize()) {\r\n                if (fFailed) {\r\n                    fFailed.call(this);\r\n                } else {\r\n                    if (iCount < 50) {\r\n                        iCount++;\r\n                        setTimeout(timer, 50);\r\n                    } else {\r\n                        fSuccess.call(this);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        setTimeout(timer, 500);\r\n    }\r\n\r\n    /* \r\n    Handles the resize event of the browser window. It triggers the layout systems to recalculate sizes \r\n    and fires the OnResizeWindow and OnOrientationChange events to the server if needed. A small timeout \r\n    is used to reduce the number of times this process is performed as browsers might throw the resize\r\n    event very often.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onWindowResize(oEvent) {\r\n        const that = this;\r\n\r\n        if (this._tResizeTimeout) {\r\n            clearTimeout(this._tResizeTimeout);\r\n            this._tResizeTimeout = null;\r\n        }\r\n\r\n        this._tResizeTimeout = setTimeout(function () {\r\n            try {\r\n                that._tResizeTimeout = null;\r\n                that.resize();\r\n                that.windowResize();\r\n            } catch (oErr) {\r\n                that.handleError(oErr);\r\n            }\r\n        }, 50);\r\n        // this.resize();\r\n\r\n        //  Manually trigger the orientationchange event for internet explorer\r\n        if (this.piScreenHeight === screen.width && this.piScreenWidth === screen.height) {\r\n            if (df.sys.isIE) {\r\n                this.onOrientationChange(oEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Triggers the OnResizeWindow event and notifies the views that they should trigger this event as \r\n    well.\r\n    \r\n    @private\r\n    */\r\n    windowResize() {\r\n\r\n        //  Trigger OnResize events (on window and and views)\r\n        this.fire(\"OnResizeWindow\", [this.get_piWindowWidth(), this.get_piWindowHeight()]);\r\n\r\n        for (let i = 0; i < this._aViews.length; i++) {\r\n            this._aViews[i].windowResize(this.get_piWindowWidth(), this.get_piWindowHeight());\r\n        }\r\n    }\r\n\r\n    onScroll(oEvent) {\r\n        this.notifyScroll(this);\r\n    }\r\n\r\n    prepareSize() {\r\n        const iRes = super.prepareSize();\r\n\r\n        this._bStretch = this._bContainerStretch;\r\n\r\n        return iRes;\r\n    }\r\n\r\n    resize() {\r\n        let iMxVwH;\r\n\r\n        //    Call standard resize procedures\r\n        this.resizeHorizontal();\r\n        this.resizeVertical();\r\n\r\n        if (this.pbViewApp) {\r\n            //  Determine viewport size\r\n            if (this._eElem) {\r\n                iMxVwH = this._iMiddleHeight - df.sys.gui.getVertBoxDiff(this._eRegionCenter, 0);\r\n            }\r\n\r\n            for (let i = 0; i < this._aViews.length; i++) {\r\n                const oView = this._aViews[i];\r\n\r\n                //  Views can be rendered without the webapp, so then we use the _eRenderTo element.\r\n                if (!this._eElem && oView._eRenderTo) {\r\n                    iMxVwH = df.dom.clientHeight(oView._eRenderTo) - df.sys.gui.getVertBoxDiff(oView._eRenderTo, 2);\r\n                }\r\n\r\n\r\n                if (oView._bRendered) {\r\n                    oView.viewResize(iMxVwH);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.notifyPosChange(this);\r\n\r\n        // df.timeStop(\"resize\", \"Finished resizing!\");\r\n        //  Turn off size change switch\r\n        this._bSizeChanged = false;\r\n    }\r\n\r\n\r\n\r\n    /* \r\n    Called by WebBaseUIObject to notify that a resize is needed because of a size change within the \r\n    control or container. As this usually occurs from within setters it is not uncommon for this to \r\n    occur multiple times the resize is not performed immediately but when the processing of the current \r\n    call is completed (using the _bSizeChanged switch). Another resize is performed after a small \r\n    timeout as there are still some unexplainable cases where a second resize causes a better result \r\n    than the first.\r\n    \r\n    @param  oSrcWO  The Web Object notifying the size change.\r\n    @private\r\n    */\r\n    objSizeChanged(oSrcWO) {\r\n        const that = this;\r\n\r\n        this._bSizeChanged = true;\r\n\r\n        if (!this._tResizeTimer) {\r\n            that._tResizeTimer = setTimeout(function () {\r\n                try {\r\n                    that.resize();\r\n                    that._tResizeTimer = null;\r\n                } catch (oErr) {\r\n                    that.handleError(oErr);\r\n                }\r\n            }, 30);\r\n        }\r\n    }\r\n\r\n    /* \r\n    This method is called from the server when a resize needs to be forced somehow. It uses the \r\n    sizeChanged method which will force a resize after processing the call is finished and sets a timer \r\n    for a delayed resize.\r\n    \r\n    @client-action\r\n    */\r\n    forceResize() {\r\n        const that = this;\r\n\r\n        this.sizeChanged(true);\r\n\r\n        setTimeout(function () {\r\n            that.sizeChanged(true);\r\n        }, 60);\r\n    }\r\n\r\n    /* \r\n    Handles the browsers OrientationChange event and triggers the server event. Note that for Internet \r\n    Explorer this method is called manually.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onOrientationChange(oEvent) {\r\n        let iOrientation;\r\n\r\n        //  Update screen dimensions (these most likely changed!)\r\n        this.piScreenHeight = screen.height;\r\n        this.piScreenWidth = screen.width;\r\n\r\n        //  Determine orientation (use own logic if DOM doesn't provide)\r\n        if (typeof window.orientation === \"number\") {\r\n            iOrientation = window.orientation;\r\n        } else {\r\n            iOrientation = (screen.height > screen.width ? 90 : 0);\r\n        }\r\n\r\n        //  Fire event to the server\r\n        this.fire(\"OnOrientationChange\", [iOrientation]);\r\n\r\n    }\r\n\r\n\r\n    // - - - - - - -  Generic framework functions - - - - - - - - \r\n\r\n    /*\r\n    This method shows an info box with a message and a title. It tempolary uses the alert but will use \r\n    the WebModalDialog later.\r\n    \r\n    @param  sMessage   The message to display.\r\n    @param  sCaption          Text displayed in the title bar.\r\n    \r\n    @client-action\r\n    */\r\n    showInfoBox(sMessage, sCaption) {\r\n        function showInfo(tDetails) {\r\n            var that = this;\r\n            const iWindowWidth = this.get_piWindowWidth();\r\n\r\n            const oDialog = new WebModalDialog(null, this);\r\n            oDialog.psCaption = sCaption;\r\n            oDialog.piMinWidth = (iWindowWidth > 420 ? 400 : iWindowWidth - 20);\r\n            oDialog.piMinHeight = 80;   // 150;\r\n            oDialog.psCSSClass = \"WebMsgBox WebMsgBoxInfo\";\r\n            oDialog.pbScroll = true;\r\n\r\n            const iViewArrayPos = this._aViews.length;\r\n            that._aViews.push(oDialog);\r\n\r\n            oDialog.OnSubmit.addListener(function (oEvent) {\r\n                oDialog.hide();\r\n            }, this);\r\n\r\n            oDialog.OnHide.addListener(function (oEvent) {\r\n                tDetails.bFinished = true;\r\n                setTimeout(function () {\r\n                    try {\r\n                        that.processModal();\r\n                        oDialog.destroy();\r\n                        that._aViews.splice(iViewArrayPos, 1);\r\n                    } catch (oErr) {\r\n                        that.handleError(oErr);\r\n                    }\r\n\r\n                }, 20);\r\n            }, this);\r\n\r\n            const oContentPnl = new WebPanel(null, oDialog);\r\n            oContentPnl.peRegion = df.ciRegionCenter;\r\n\r\n            oDialog.addChild(oContentPnl);\r\n\r\n            const oLabel = new WebLabel(null, oDialog);\r\n            oLabel.psCaption = sMessage;\r\n            oLabel.psCSSClass = \"WebMsgBox_Text\";\r\n            oContentPnl.addChild(oLabel);\r\n\r\n            const oButtonPnl = new WebPanel(null, oDialog);\r\n            oButtonPnl.peRegion = df.ciRegionBottom;\r\n            oButtonPnl.piColumnCount = 3;\r\n            oButtonPnl.psCSSClass = \"WebMsgBoxOneBtn\";\r\n\r\n            oDialog.addChild(oButtonPnl);\r\n\r\n            const oCloseBtn = new WebButton(null, oDialog);\r\n            oCloseBtn.psCaption = this.getTrans(\"ok\");\r\n            oCloseBtn.piColumnIndex = 2;\r\n            oCloseBtn.pbShowLabel = false;\r\n            oCloseBtn.OnClick.addListener(function (oEvent) {\r\n                oDialog.hide();\r\n            }, this);\r\n            oButtonPnl.addChild(oCloseBtn);\r\n\r\n\r\n            oDialog.show();\r\n\r\n            this.ready(function () {\r\n                oDialog.resize();\r\n                oCloseBtn.focus();\r\n            });\r\n        }\r\n\r\n        this._aModalQueue.push({\r\n            fFunc: showInfo,\r\n            bFinished: false,\r\n            bDisplayed: false\r\n        });\r\n\r\n        this.processModal();\r\n    }\r\n\r\n    /*\r\n    This method shows a message box with a message, title and a set of buttons. After a button is \r\n    clicked it will fire a server action to the provided object & message to handle the response. It \r\n    receives the message, title and list of buttons from the server. Note that the message box will be \r\n    queued in the alert queue so it will wait for other alerts to be closed before displaying. \r\n    \r\n    @param  sMessage   The message to display.\r\n    @param  sCaption   Text displayed in the title bar.\r\n    \r\n    @client-action\r\n    */\r\n    showMessageBox(sReturnObj, sReturnMsg, sMessage, sCaption, sLabelCSSClass, iDefaultButton) {\r\n\r\n        //  Search for return object\r\n        const oReturnObj = this.findObj(sReturnObj);\r\n        if (!oReturnObj) {\r\n            throw new df.Error(999, \"Return WebObject not found '{{0}}'\", this, [sReturnObj]);\r\n        }\r\n\r\n        //  Get reference to action data specifying the buttons\r\n        const aButtons = this._tActionData;\r\n        if (!aButtons) {\r\n            throw new df.Error(999, \"No buttons specified\", this);\r\n        }\r\n\r\n        //  Call the real message box function\r\n        this.showMsgBox(sMessage, sCaption, sLabelCSSClass, aButtons, iDefaultButton, function (iBtn, oDialog) {\r\n            //  Make sure that the action mode for there return call is at least mode wait\r\n            if (oReturnObj.getActionMode(sReturnMsg) < df.cCallModeWait) {\r\n                oReturnObj.setActionMode(sReturnMsg, df.cCallModeWait);\r\n            }\r\n\r\n            //  Call the return message\r\n            oReturnObj.serverAction(sReturnMsg, [iBtn], null, function () {\r\n                oDialog.hide();\r\n            });\r\n        });\r\n    }\r\n\r\n    showMsgBox(sMessage, sCaption, sLabelCSSClass, aButtons, iDefaultButton, fHandler) {\r\n\r\n\r\n\r\n        function showInfo(tDetails) {\r\n            let oDialog, oLabel,  oContentPnl, oButtonPnl, oDefaultBtn = null, iWindowWidth = this.get_piWindowWidth();\r\n\r\n            //  Create dialog with panel\r\n            oDialog = new WebModalDialog(null, this);\r\n            oDialog.psCaption = sCaption;\r\n            oDialog.piMinWidth = (iWindowWidth > 500 ? 480 : iWindowWidth - 20);\r\n            oDialog.piMinHeight = 100;    // 150;\r\n            oDialog.pbShowClose = false;\r\n            oDialog.psCSSClass = (\"WebMsgBox \" + sLabelCSSClass);\r\n            oDialog.pbScroll = true;\r\n\r\n            this._aViews.push(oDialog);\r\n\r\n            oDialog.OnHide.addListener(function (oEvent) {\r\n                tDetails.bFinished = true;\r\n                setTimeout(() => {\r\n                    try {\r\n                        this.processModal();\r\n                        oDialog.destroy();\r\n                        let iIndex = this._aViews.indexOf(oDialog);\r\n                        if (iIndex = -1) {\r\n                            this._aViews.splice(iIndex, 1);\r\n                        }\r\n                    } catch (oErr) {\r\n                        this.handleError(oErr);\r\n                    }\r\n\r\n                }, 20);\r\n\r\n            }, this);\r\n\r\n            //  Create content panel with message\r\n            oContentPnl = new WebPanel(null, oDialog);\r\n            oContentPnl.peRegion = df.ciRegionCenter;\r\n\r\n            oDialog.addChild(oContentPnl);\r\n\r\n            oLabel = new WebLabel(null, oDialog);\r\n            oLabel.psCaption = sMessage;\r\n            oLabel.psCSSClass = \"WebMsgBox_Text\";\r\n            oContentPnl.addChild(oLabel);\r\n\r\n            //  Create button panel\r\n            oButtonPnl = new WebPanel(null, oDialog);\r\n            oButtonPnl.peRegion = df.ciRegionBottom;\r\n            oButtonPnl.piColumnCount = (aButtons.length * 2) + 2;\r\n\r\n            // Mobile Adjustments....\r\n            if (df.sys.isMobile) {\r\n                if (aButtons.length === 2) {\r\n                    // if two buttons let them occupy the entire width of the panel\r\n                    oButtonPnl.piColumnCount = (aButtons.length * 2);\r\n                }\r\n                else if (aButtons.length > 2) {\r\n                    oButtonPnl.piColumnCount = 1;\r\n                }\r\n            }\r\n\r\n            // Set the panel's CSS class if there is only one button\r\n            if (aButtons.length === 1) {\r\n                oButtonPnl.psCSSClass = \"WebMsgBoxOneBtn\";\r\n            } else if (aButtons.length === 2) {\r\n                oButtonPnl.psCSSClass = \"WebMsgBoxTwoButtons\";\r\n            } else {\r\n                oButtonPnl.psCSSClass = \"WebMsgBoxButtons\";\r\n            }\r\n\r\n            oDialog.addChild(oButtonPnl);\r\n\r\n            //  Handler executed when a button is clicked\r\n            function handleBtnClick(oEvent) {\r\n                fHandler.call(this, oEvent.oSource._iConfirmId, oDialog);\r\n            }\r\n\r\n            //  Generate buttons\r\n            iDefaultButton = parseInt(iDefaultButton, 10);\r\n\r\n            for (let i = 0; i < aButtons.length; i++) {\r\n                const oBtn = new WebButton(null, oDialog);\r\n                oBtn.psCaption = aButtons[i];\r\n                oBtn.piColumnIndex = ((i * 2) + 1);\r\n                oBtn.piColumnSpan = 2;\r\n                oBtn.pbShowLabel = false;\r\n                oBtn._iConfirmId = (i + 1);\r\n                oBtn.OnClick.addListener(handleBtnClick);\r\n\r\n                // Handle Mobile Adjustments....\r\n                if (df.sys.isMobile) {\r\n                    if (aButtons.length === 2) {\r\n                        // if two buttons let them occupy the entire width of the panel\r\n                        oBtn.piColumnIndex = (i * 2);\r\n                    }\r\n                    else if (aButtons.length > 2) {\r\n                        oBtn.piColumnIndex = 0;\r\n                        oBtn.piColumnSpan = 0;\r\n                    }\r\n                }\r\n                else {\r\n                    if (i === 0) {\r\n                        oBtn.psCSSClass = \"WebMsgBoxFirstBtn\";\r\n                    }\r\n                    else if (i === (aButtons.length - 1)) {\r\n                        oBtn.psCSSClass = \"WebMsgBoxLastBtn\";\r\n                    }\r\n                }\r\n\r\n                oButtonPnl.addChild(oBtn);\r\n\r\n                if (oBtn._iConfirmId === iDefaultButton) {\r\n                    oDefaultBtn = oBtn;\r\n                }\r\n            }\r\n\r\n            oDialog.show();\r\n\r\n            //  Resize and give focus when application is ready\r\n            this.ready(function () {\r\n                oDialog.resize();\r\n                if (oDefaultBtn) {\r\n                    oDefaultBtn.focus();\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        this._aModalQueue.push({\r\n            fFunc: showInfo,\r\n            bFinished: false,\r\n            bDisplayed: false\r\n        });\r\n\r\n        this.processModal();\r\n    }\r\n\r\n    /* \r\n    Easy API for showing a WAF Yes No confirmation. It still is asynchronous and the passed handler \r\n    will be called when finished.\r\n    \r\n    @code\r\n    oWebApp.showYesNo(\"Sure?\", function(bYes){\r\n        alert(bYes);\r\n    } this);\r\n    @code\r\n    \r\n    @param  sMessage    Message shown.\r\n    @param  fHandler    Handler message handling the response (get boolean parameter indicating yes or no).\r\n    @param  oOptEnv     (optional) Environment object for handler function.\r\n    */\r\n    showYesNo(sMessage, fHandler, oOptEnv) {\r\n        this.showMsgBox(sMessage, this.getTrans(\"confirm\"), \"WebMsgBoxConfirm\", [this.getTrans(\"yes\"), this.getTrans(\"no\")], 0, function (iBtn, oDialog) {\r\n            try {\r\n                if (fHandler) {\r\n                    fHandler.call(oOptEnv || this, (iBtn === 1));\r\n                }\r\n            } catch (oErr) {\r\n                this.handleError(oErr);\r\n            }\r\n            oDialog.hide();\r\n        });\r\n    }\r\n\r\n    /*\r\n    This method will process the next item in the modal queue. It starts by removing dialogs marked as \r\n    finished from the queue. Then it will display the next dialog in the queue (if there is one and it \r\n    isn't already displayed). The modal queue contains dialogs that need to be displayed modally. We \r\n    don't want to display them on top of each other and since they are not really modal we will have to \r\n    queue them. In practice the queue contains methods that will display the dialog.\r\n    */\r\n    processModal() {\r\n        if (this._aModalQueue.length > 0) {\r\n            //  Clear finished alerts from the queue\r\n            while (this._aModalQueue[0] && this._aModalQueue[0].bFinished) {\r\n                this._aModalQueue.shift();\r\n            }\r\n\r\n            //  Display next (if needed)\r\n            if (this._aModalQueue.length > 0 && !this._aModalQueue[0].bDisplayed) {\r\n                this._aModalQueue[0].bDisplayed = true;\r\n                this._aModalQueue[0].fFunc.call(this, this._aModalQueue[0]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Used to queue an action in the modal queue. Note that this action won't be blocking the modal queue \r\n    once it is finished. Examples of usage are showView, navigateToPage, navigateRefresh and \r\n    navigateOpenWindow.\r\n    \r\n    @param  fFunc   Function that executes the action.\r\n    @param  oEnv    Environment used to execute the function (this).\r\n    @private\r\n    */\r\n    queueModal(fFunc, oEnv) {\r\n        this._aModalQueue.push({\r\n            fFunc(tDetails) {\r\n                fFunc.call(oEnv || null);\r\n\r\n                //  We don't want to hold up other dialogs in the queue\r\n                tDetails.bFinished = true;\r\n                this.processModal();\r\n            },\r\n            bFinished: false,\r\n            bDisplayed: false\r\n        });\r\n\r\n        this.processModal();\r\n    }\r\n\r\n    /*\r\n    This method writes text to the console of JavaScript debuggers. This can be used for debugging \r\n    purposes. A singleton method df.log is used to do this which adds timing and checks if the console \r\n    is available. \r\n    \r\n    @param  sText   String with text to show on the console.\r\n    @client-action\r\n    */\r\n    log(sText) {\r\n        df.log(sText);\r\n    }\r\n\r\n    /*\r\n    This method determines the translation based on a label.\r\n    \r\n    @param  sLbl        The label of the translation.\r\n    @param  bOptNull    If true then null is returned if the translation is not found, else it returns\r\n                        the label wrapped by {{ ... }}.\r\n    @return The translation.\r\n    @private\r\n    */\r\n    getTrans(sLbl, bOptNull) {\r\n        if (this._oTranslations[sLbl]) {\r\n            return this._oTranslations[sLbl];\r\n        }\r\n        if (bOptNull) {\r\n            return null;\r\n        }\r\n        return \"{{\" + sLbl + \"}}\";\r\n    }\r\n\r\n    /*\r\n    Override because the webapp object is referred to as \"\".\r\n    */\r\n    getLongName() {\r\n        return \"\";\r\n    }\r\n\r\n    /*\r\n    Override as the webapp object name is not part of the long name.\r\n    @private\r\n    */\r\n    getLongNamePrnt() {\r\n        return \"\";\r\n    }\r\n\r\n    /*\r\n    Initializes the translation system. The translations are delivered as name value pairs and we store \r\n    them as object properties for quick access. Translations for dates are stored globally because they \r\n    are also accessed by some of the global date formatting functions in the system library.\r\n    \r\n    @client-action\r\n    @private\r\n    */\r\n    initTranslations() {\r\n        this.initTrans(this._tActionData);\r\n    }\r\n\r\n    /* \r\n    Initializes the translation system based on the array of translations.\r\n    \r\n    @param  aTrans  Array of translations [{ sN : \"label\", sV : \"translation\" }].\r\n    @private\r\n    */\r\n    initTrans(aTrans) {\r\n        //  Store tanslations in quick access object\r\n        for (let i = 0; i < aTrans.length; i++) {\r\n            this._oTranslations[aTrans[i].sN] = aTrans[i].sV;\r\n        }\r\n\r\n        //  We store the dates globally\r\n        df.lang = {\r\n            monthsLong: [\r\n                this.getTrans(\"january\"),\r\n                this.getTrans(\"february\"),\r\n                this.getTrans(\"march\"),\r\n                this.getTrans(\"april\"),\r\n                this.getTrans(\"may\"),\r\n                this.getTrans(\"june\"),\r\n                this.getTrans(\"july\"),\r\n                this.getTrans(\"august\"),\r\n                this.getTrans(\"september\"),\r\n                this.getTrans(\"october\"),\r\n                this.getTrans(\"november\"),\r\n                this.getTrans(\"december\")\r\n            ],\r\n            monthsShort: [\r\n                this.getTrans(\"jan\"),\r\n                this.getTrans(\"feb\"),\r\n                this.getTrans(\"mar\"),\r\n                this.getTrans(\"apr\"),\r\n                this.getTrans(\"mayShort\"),\r\n                this.getTrans(\"jun\"),\r\n                this.getTrans(\"jul\"),\r\n                this.getTrans(\"aug\"),\r\n                this.getTrans(\"sep\"),\r\n                this.getTrans(\"oct\"),\r\n                this.getTrans(\"nov\"),\r\n                this.getTrans(\"dec\")\r\n            ],\r\n            daysShort: [\r\n                this.getTrans(\"sun\"),\r\n                this.getTrans(\"mon\"),\r\n                this.getTrans(\"tue\"),\r\n                this.getTrans(\"wed\"),\r\n                this.getTrans(\"thu\"),\r\n                this.getTrans(\"fri\"),\r\n                this.getTrans(\"sat\")\r\n            ],\r\n            daysLong: [\r\n                this.getTrans(\"sunday\"),\r\n                this.getTrans(\"monday\"),\r\n                this.getTrans(\"tuesday\"),\r\n                this.getTrans(\"wednesday\"),\r\n                this.getTrans(\"thursday\"),\r\n                this.getTrans(\"friday\"),\r\n                this.getTrans(\"saturday\")\r\n            ]\r\n        };\r\n    }\r\n\r\n    // - - - - - - -  Error handling - - - - - - - - \r\n\r\n    showError(iErrNum, iErrLine, sErrText, sCaption, bUserError) {\r\n        //  Create error object and call default handler function\r\n        this.handleError(new df.Error(\r\n            df.toInt(iErrNum),\r\n            sErrText,\r\n            this,\r\n            null,\r\n            null,\r\n            true,\r\n            df.toBool(bUserError),\r\n            sCaption,\r\n            null,\r\n            df.toInt(iErrLine)\r\n        ));\r\n    }\r\n\r\n\r\n    /*\r\n    df.Error = function Error(iNumber, sText, bOptUsr, oOptSource, oOptTarget, bOptSrv){\r\n        this.iNumber = iNumber;\r\n        this.sText = sText;\r\n        this.bUserError = !!bOptUsr;\r\n        this.oSource = oOptSource || null;\r\n        this.oTarget = oOptTarget || null;\r\n        this.bServer = !!bOptSrv;\r\n        this.iLine = iOptLine;\r\n        this.sDetailHtml = sOptDetailHtml || null;\r\n    }\r\n    */\r\n\r\n    /*\r\n    Handles a single error and displays it in a modal dialog unless it is a JavaScript error which it \r\n    leaves to the JavaScript debuggers. The modal queue is used to make sure that we don't display \r\n    dialogs on top of each other.\r\n    \r\n    @param  oError  The error object.\r\n    */\r\n    handleError(oError) {\r\n        function displayError(tDetails) {\r\n            let that = this, oLabel, oDetailsBox, sCaption;\r\n            const aDetails = [], iWindowWidth = this.get_piWindowWidth();\r\n\r\n            //  Determine title\r\n            if (!oError.bServer) {\r\n                sCaption = oError.sCaption || this.getTrans(\"error_title_client\", true) || \"Unhandled Program Error on the client\";\r\n            } else {\r\n                sCaption = oError.sCaption || this.getTrans(\"error_title_server\");\r\n            }\r\n\r\n\r\n            //  Create dialog\r\n            const oDialog = new WebModalDialog(null, this);\r\n            oDialog.psCaption = sCaption;\r\n            oDialog.piMinWidth = (iWindowWidth > 520 ? 500 : iWindowWidth - 20);\r\n            oDialog.piMinHeight = (oError.bUserError ? 80 : 180);    // (oError.bUserError ? 150 : 240);\r\n            oDialog.psCSSClass = (oError.bUserError ? \"WebMsgBox WebMsgBoxWarning\" : \"WebMsgBox WebMsgBoxError\");\r\n\r\n            const iViewArrayPos = this._aViews.length;\r\n            that._aViews.push(oDialog);\r\n\r\n            oDialog.OnSubmit.addListener(function (oEvent) {\r\n                try {\r\n                    oDialog.hide();\r\n                } catch (oErr) {\r\n                    that.handleError(oErr);\r\n                }\r\n            }, this);\r\n\r\n            oDialog.OnHide.addListener(function (oEvent) {\r\n                tDetails.bFinished = true;\r\n                setTimeout(function () {\r\n                    try {\r\n                        that.processModal();\r\n                        oDialog.destroy();\r\n                        that._aViews.splice(iViewArrayPos, 1);\r\n                    } catch (oErr) {\r\n                        that.handleError(oErr);\r\n                    }\r\n\r\n                }, 20);\r\n            }, this);\r\n\r\n            const oContentPnl = new WebPanel(null, oDialog);\r\n            oContentPnl.peRegion = df.ciRegionCenter;\r\n\r\n            oDialog.addChild(oContentPnl);\r\n\r\n            //  Create label\r\n            oLabel = new WebLabel(null, oContentPnl);\r\n            oLabel.psCaption = oError.sText;\r\n            oLabel.psCSSClass = \"WebMsgBox_Text\";\r\n            oContentPnl.addChild(oLabel);\r\n\r\n            //  Create error details\r\n            if (!oError.bUserError) {\r\n                oLabel = new WebLabel(null, oContentPnl);\r\n                aDetails.push('Error: ', oError.iNumber);\r\n\r\n                if (oError.bServer) {\r\n                    if (oError.iLine) {\r\n                        aDetails.push('\\nLine:', oError.iLine);\r\n                    }\r\n                } else {\r\n                    if (oError.oSource) {\r\n                        if (oError.oSource instanceof WebObject) {\r\n                            aDetails.push('\\nObject:', oError.oSource.getLongName());\r\n                        }\r\n                    }\r\n                }\r\n                oLabel.psCaption = aDetails.join(\"\");\r\n                oContentPnl.addChild(oLabel);\r\n\r\n                //  Add details field\r\n                if (oError.sDetailHtml) {\r\n                    oDialog.piMinHeight = 300;\r\n                    oDialog.piHeight = 400;\r\n\r\n                    if (oError.sDetailHtml.match(/<body*>|<html*>/gi)) {\r\n                        oDetailsBox = new WebIFrame(null, oContentPnl);\r\n                        oDetailsBox.pbFillHeight = true;\r\n                        oDetailsBox.pbShowLabel = false;\r\n                        oDetailsBox.psCSSClass = \"WebErrorDetails\";\r\n                        oDetailsBox.setHtmlContent(oError.sDetailHtml);\r\n                        oContentPnl.addChild(oDetailsBox);\r\n                    } else {\r\n                        oDetailsBox = new WebHtmlBox(null, oContentPnl);\r\n                        oDetailsBox.pbFillHeight = true;\r\n                        oDetailsBox.pbShowBox = true;\r\n                        oDetailsBox.pbScroll = true;\r\n                        oDetailsBox.pbShowLabel = false;\r\n                        oDetailsBox.psCSSClass = \"WebErrorDetails\";\r\n                        oDetailsBox.psHtml = oError.sDetailHtml;\r\n\r\n                        oContentPnl.addChild(oDetailsBox);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            //  Create buttons\r\n            const oButtonPnl = new WebPanel(null, oDialog);\r\n            oButtonPnl.peRegion = df.ciRegionBottom;\r\n            oButtonPnl.piColumnCount = 3;\r\n            oButtonPnl.psCSSClass = \"WebMsgBoxOneBtn\";\r\n\r\n            oDialog.addChild(oButtonPnl);\r\n\r\n            const oCloseBtn = new WebButton(null, oDialog);\r\n            oCloseBtn.psCaption = this.getTrans(\"ok\", true) || \"OK\";\r\n            oCloseBtn.piColumnIndex = 2;\r\n            oCloseBtn.pbShowLabel = false;\r\n            oCloseBtn.OnClick.addListener(function (oEvent) {\r\n                oDialog.hide();\r\n            }, this);\r\n            oButtonPnl.addChild(oCloseBtn);\r\n\r\n\r\n            oDialog.show();\r\n            this.ready(function () {\r\n                oDialog.resize();\r\n                oCloseBtn.focus();\r\n            });\r\n\r\n        }\r\n\r\n        //  We only handle our own errors, we throw the others \r\n        if (oError instanceof df.Error) {\r\n\r\n            //  Fire user event for custom display\r\n            if (this.OnError.fire(this, { oError: oError })) {\r\n                //  See if the object has custom error handling (usually DEO's)\r\n                if (oError.oTarget && oError.oTarget.displayError && oError.oTarget.pbRender && oError.oTarget.pbVisible) {\r\n                    oError.oTarget.displayError(oError.iNumber, oError.sText);\r\n                } else {\r\n                    // Queue a special alert\r\n                    this._aModalQueue.push({\r\n                        fFunc: displayError,\r\n                        bFinished: false,\r\n                        bDisplayed: false\r\n                    });\r\n                    this.processModal();\r\n                }\r\n            }\r\n        } else {\r\n            throw oError;\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - -  Generic web functionallity - - - - - - - - \r\n\r\n    /* \r\n    Updates the title of the page.\r\n    \r\n    @param  sTitle  The new title for the page.\r\n    @client-action\r\n    */\r\n    setPageTitle(sTitle) {\r\n        document.title = sTitle;\r\n    }\r\n\r\n    /*\r\n    Lets the browser navigate to a different page. The mode determines if the page is opened in a new \r\n    window / new tab or the current window.\r\n    \r\n    @param  sUrl    The URL to open.\r\n    @param  eMode   The mode to upen the URL (df.ciOpenNewWindow, df.ciOpenNewTab or \r\n                    df.ciOpenCurrentWindow).\r\n    \r\n    @client-action\r\n    */\r\n    navigateToPage(sUrl, eMode) {\r\n        this.queueModal(function () {\r\n            eMode = parseInt(eMode, 10); // Convert from string\r\n\r\n            if (eMode === df.ciOpenSameWindow) {\r\n                window.location.href = sUrl;\r\n            } else {\r\n                if (eMode === df.ciOpenNewWindow) {\r\n                    window.open(sUrl, '_blank_' + df.dom.piDomCounter++, 'width=700, height=500, resizable=yes');\r\n                } else { // df.ciOpenNewTab\r\n                    window.open(sUrl, '_blank');// +  df.dom.piDomCounter++);\r\n                }\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    /*\r\n    Opens a new window that will load the specified URL. Note that popup blockers might block this new window.\r\n    \r\n    @param  sUrl     The URL to open.\r\n    @param  iWidth   The width of the window in pixels.\r\n    @param  iHeight  The height of the window in pixels.\r\n    \r\n    @client-action\r\n    */\r\n    navigateNewWindow(sUrl, iWidth, iHeight) {\r\n        this.queueModal(function () {\r\n            window.open(sUrl, '_blank_' + df.dom.piDomCounter++, 'width=' + iWidth + ', height=' + iHeight + ', resizable=yes, location=yes');\r\n        });\r\n    }\r\n\r\n    /*\r\n    Reloads the current page. This is usually done after a logout.\r\n    \r\n    @client-action\r\n    */\r\n    navigateRefresh() {\r\n        this.queueModal(function () {\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    /* \r\n    Pushes an item to the history stack (HTML5 history management). If action data is available it will \r\n    be added as extra data.\r\n    \r\n    @param  sUrl    The new current URL.\r\n    @param  sTitle  The new page title.\r\n    @client-action    \r\n    */\r\n    historyPushState(sUrl, sTitle) {\r\n        const state = { df: true, vt: this._tActionData };\r\n\r\n        if (history && history.pushState) {\r\n            history.pushState(state, (sTitle || null), (sUrl || null));\r\n        }\r\n    }\r\n\r\n    /* \r\n    Replaces the current item on the history stack (HTML5 history management). If action data is \r\n    available it will be added as extra data.\r\n    \r\n    @param  sUrl    The new current URL.\r\n    @param  sTitle  The new page title.\r\n    @client-action    \r\n    */\r\n    historyReplaceState(sUrl, sTitle) {\r\n        const state = { df: true, vt: this._tActionData };\r\n\r\n        if (history && history.replaceState) {\r\n            history.replaceState(state, (sTitle || null), (sUrl || null));\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the browser popstate event and triggers the HistoryPopState server action passing on the \r\n    details. If an extra information object is attached to the event and it appears to be a valuetree \r\n    then it will pass that as well.\r\n    \r\n    @param  oEvent  DOM Event\r\n    @private\r\n    */\r\n    onPopState(oEvent) {\r\n        const state = oEvent.e.state;\r\n        let vt = null;\r\n\r\n        if (state && state.df) {\r\n            if (state.vt && typeof state.vt.v !== \"undefined\" && state.vt.c) {\r\n                vt = state.vt;\r\n            }\r\n        }\r\n        this.serverAction(\"HistoryPopState\", [document.title, document.location.href], vt);\r\n\r\n        oEvent.stop();\r\n    }\r\n\r\n    /* \r\n    Handles the browser OnHashChange event and triggers the LocationHashChange event. Note that if a \r\n    HistoryPopState just occurred it will be canceled to prevent duplicate reaction.\r\n    \r\n    @param  oEvent  DOM Event\r\n    @private\r\n    */\r\n    onHashChange(oEvent) {\r\n        //  Only send hashchange if this isn't a popstate\r\n        this.cancelServerAction(\"HistoryPopState\");\r\n        this.serverAction(\"LocationHashChange\", [document.location.hash]);\r\n    }\r\n\r\n\r\n    /* \r\n    Getter function that reads the current window width.\r\n    \r\n    @return The current window width in (virtual) pixels.\r\n     */\r\n    get_piWindowWidth() {\r\n        return df.dom.windowWidth();\r\n    }\r\n\r\n    /* \r\n    Getter function that reads the current window height.\r\n    \r\n    @return The current window height in (virtual) pixels.\r\n     */\r\n    get_piWindowHeight() {\r\n        return df.dom.windowHeight();\r\n    }\r\n\r\n    /* \r\n    Getter function that reads the current mode directly of the mode controller.\r\n    \r\n    @return Current mode in which we are running.\r\n    */\r\n    get_peMode() {\r\n        if (this._oModeControl) {\r\n            return this._oModeControl.peMode;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Getter function that reads the result of the device detection isMobile check.\r\n    \r\n    @return True if this device is detected as a mobile device.\r\n    */\r\n    get_pbIsMobile() {\r\n        return df.sys.isMobile;\r\n    }\r\n\r\n    /*\r\n    Getter function that returns the current location hash (part of the URL behing the hash bang #).\r\n    \r\n    @return Location hash like \"Dashboard/Order-1231\"\r\n    */\r\n    get_psLocationHash() {\r\n        return window.location.hash;\r\n    }\r\n\r\n    /*\r\n    Getter function that determines the current timezone offset in minutes.\r\n    \r\n    @return Time zone offset in minutes (-120 for UTC+2).\r\n    */\r\n    get_piBrowserTimezoneOffset() {\r\n        return new Date().getTimezoneOffset();\r\n    }\r\n\r\n    /*\r\n    Getter function that reads the browser language.\r\n    \r\n    @return Browser language string (\"en-US\" or \"nl\" or ..).\r\n    */\r\n    get_pasBrowserLanguages = function () {\r\n        const vt = df.sys.vt.serialize(navigator.languages || (navigator.language && [navigator.language]) || [\"en-US\"]);\r\n\r\n        return function () { return vt; };\r\n    }();\r\n\r\n    /*\r\n    Returns the 'top layer' element. This is the insertion point for controls like floating panels. \r\n    Usually this will return document.body, unless a control is located inside a modal dialog.\r\n    */\r\n    topLayer() {\r\n        return document.body;\r\n    }\r\n\r\n    /*\r\n    Override since we are webapp.\r\n    */\r\n    getWebApp() {\r\n        return this;\r\n    }\r\n}","import { BaseApp } from './BaseApp.js';\r\n\r\n/*\r\nClass:\r\n    df.LocalApp\r\nExtends:\r\n    df.BaseApp\r\n\r\nUsed by the cLocalWebControlHost and cLocalWebAppHost classes to display framework controls.\r\n*/\r\nexport class LocalApp extends BaseApp {\r\n    constructor(bViewHost) {\r\n        super();\r\n\r\n        if (window.chrome.webview) {\r\n            df.dom.on(\"message\", window.chrome.webview, this.onWebMessageReceived, this);\r\n        } else {\r\n            throw new df.Error(999, \"LocalApp requires chromium webview message API to function!\");\r\n        }\r\n\r\n        this._bPanels = bViewHost;\r\n        this.pbViewApp = bViewHost;\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        this.syncObserver();\r\n    }\r\n\r\n    /*\r\n    Observes the document object model to detect changes. If there are it will synchronize the web \r\n    properties because changes to the DOM potentially mean changes to web properties.\r\n    */\r\n    syncObserver() {\r\n        let bIdle = false;\r\n\r\n        const sync = () => {\r\n            bIdle = false;\r\n            this._bCallTimeout = false;\r\n            this.serverAction(\"SynchronizeProps\");\r\n            this._bCallTimeout = true;\r\n        }\r\n\r\n\r\n        // create a new instance of `MutationObserver` named `observer`,\r\n        // passing it a callback function\r\n        const observer = new MutationObserver(function () {\r\n            if (!bIdle) {\r\n                bIdle = true;\r\n                window.requestIdleCallback(sync);\r\n            }\r\n        });\r\n\r\n        // call `observe()` on that MutationObserver instance,\r\n        // passing it the element to observe, and the options object\r\n        observer.observe(this._eElem, {\r\n            subtree: true,\r\n            childList: true,\r\n            attributes: true\r\n        });\r\n\r\n        // observe does not catch input changes, so we also listen to the input element (and rely on bubbling)\r\n        df.dom.on(\"input\", this._eElem, function (oEv) {\r\n            if (!bIdle) {\r\n                bIdle = true;\r\n                window.requestIdleCallback(sync);\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    /*\r\n    Implements the sending of call to send the call via a webmessage to the host process.\r\n    */\r\n    sendCall(oCall) {\r\n        return oCall.oPromise = new Promise((resolve, reject) => {\r\n            let aAddionalObjects = [];\r\n            oCall.aActions.forEach((oAct) => {\r\n                if (oAct.oPlatformSpecific.aAdditionalObjects) {\r\n                    aAddionalObjects = aAddionalObjects.concat(oAct.oPlatformSpecific.aAdditionalObjects)\r\n                }\r\n            });\r\n\r\n            const tReq = this.assembleRequest(oCall);\r\n            oCall._resolve = resolve;\r\n            oCall._reject = reject;\r\n\r\n            df.debug(\"Sending call..\");\r\n            df.debug(tReq);\r\n\r\n            if (aAddionalObjects.length > 0) {\r\n                window.chrome.webview.postMessageWithAdditionalObjects(tReq, aAddionalObjects);\r\n            } else {\r\n                window.chrome.webview.postMessage(tReq);\r\n            }\r\n        });\r\n    }\r\n\r\n    /*\r\n    Handles calls from the host, which are usually in response to a pending call but they \r\n    can also be triggered by the host.\r\n    */\r\n    onWebMessageReceived(oEvent, bSuccess) {\r\n        const tData = oEvent.e.data;\r\n\r\n        if (this._oSendingCall) {\r\n            df.debug(\"Received response:\");\r\n            df.debug(tData);\r\n\r\n            this._oSendingCall._resolve(tData);\r\n        } else {\r\n            df.debug(\"Received host message..\");\r\n            df.debug(tData);\r\n\r\n            this.processResponse(tData, null);\r\n        }\r\n    }\r\n}","import { HttpRequest } from './ajax/HttpRequest.js';\r\nimport { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebPanel } from './WebPanel.js';\r\nimport { WebModalDialog } from './WebModalDialog.js';\r\nimport { WebLabel } from './WebLabel.js';\r\nimport { WebProgressBar } from './WebProgressBar.js';\r\nimport { WebButton } from './WebButton.js';\r\nimport { WebSpacer } from './WebSpacer.js';\r\nimport { LocalApp } from './LocalApp.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebBaseFileUpload\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class contains the core implementation of file upload using HTML5 with a fallback to HTML4. Its \r\nsubclasses provide the different UI and API options that can be used by the developer. This class \r\ncontains the implementation of the progress dialog (that can be turned on / off using pbShowDialog) \r\nwhich can be overridden by implementing the different display methods. The class supports \r\nmulti-file uploads for HTML5 browsers and drag & drop support. The drag & drop support works using \r\nthe global namespace df.dragdrop that is implemented in this file. If further drag & drop support \r\nwill be implemented within the framework this namespace will need to be expanded and moved to a \r\ngeneric library file.\r\n    \r\nRevision:\r\n    2012/12/18  (HW, DAW) \r\n        Initial version.\r\n    2013/09/10  (HW, DAW)\r\n        Refactored from WebFileUploader into WebBaseFileUpload with WebFileUploadForm and \r\n        WebFileUploadButton sub-classes.\r\n    2021/10/19  (HR, DAW)\r\n        Added logic to support WebDragDropFileHelper (registering and calls)\r\n*/\r\n/*global df */\r\n\r\n\r\n/*  \r\nThe dragdrop library provides a generic implementation to support drag and drop. It currently only \r\nsupports dropping and has a pretty generic interface. Controls can add themselves as drop handlers \r\nusing df.dragdrop.addHandler and remove themselves using df.dragdrop.remHandler. If something is \r\ndragged onto the screen the getDropDetails method is called on the control. The control should \r\nreturn an object with drop details in the following format:\r\n{\r\n    sDropContent : \"\",          //  Text displayed inside the dropzone\r\n    sDropClass : \"\",            //  Extra CSS Classname for the dropzone\r\n    oRect : BoundingClientRect  //  Bounding Rectangle to position the dropzone\r\n}\r\n\r\nIf null is returned the control is ignored and will not get a drop zone. For all other handler \r\ncontrols a dropzone is displayed. If the user drops on one of these dropzones the handleDrop method \r\nis called on the control.\r\n*/\r\ndf.dragdrop = (function dragdrop() {\r\n    var aHandlers = [], aZones = [], bInDrag = false, iEnterCount = 0, tResizeInt;\r\n    var aHelpers = new Set();\r\n\r\n    function initDropZones() {\r\n        if (bInDrag) {\r\n            return;\r\n        }\r\n\r\n        //  Generate dropzones\r\n        aHandlers.forEach(function (oHandler) {\r\n            var eZone, oDropDetails = oHandler.getDropDetails();\r\n\r\n            if (oDropDetails) {\r\n                eZone = df.dom.create('<div data-dropzone=\"yes\" class=\"WebDropZone ' + oDropDetails.sDropClass + '\"><div>' + oDropDetails.sDropContent + '</div></div>');\r\n                eZone.style.width = oDropDetails.oRect.width + \"px\";\r\n                eZone.style.height = oDropDetails.oRect.height + \"px\";\r\n                eZone.style.left = oDropDetails.oRect.left + \"px\";\r\n                eZone.style.top = oDropDetails.oRect.top + \"px\";\r\n                oDropDetails.eZoneParent.appendChild(eZone);\r\n\r\n                aZones.push({\r\n                    oObj: oHandler,\r\n                    oDetails: oDropDetails,\r\n                    eZone: eZone\r\n                });\r\n\r\n            }\r\n        });\r\n\r\n        tResizeInt = setInterval(repositionDropZones, 300);\r\n        bInDrag = true;\r\n    }\r\n\r\n    function repositionDropZones() {\r\n        aZones.forEach(function (oZone) {\r\n            var oDropDetails = oZone.oDetails = oZone.oObj.getDropDetails();\r\n            oZone.eZone.style.width = oDropDetails.oRect.width + \"px\";\r\n            oZone.eZone.style.height = oDropDetails.oRect.height + \"px\";\r\n            oZone.eZone.style.left = oDropDetails.oRect.left + \"px\";\r\n            oZone.eZone.style.top = oDropDetails.oRect.top + \"px\";\r\n        });\r\n    }\r\n\r\n    function stopDropZones() {\r\n        if (!bInDrag) {\r\n            return;\r\n        }\r\n\r\n        //  Remove & destroy drop zones\r\n        aZones.forEach(function (oZone) {\r\n            oZone.eZone.parentNode.removeChild(oZone.eZone);\r\n            oZone.eZone = null;\r\n        });\r\n        aHelpers.forEach(function (oHelper) {\r\n            oHelper.cleanupHelper();\r\n        });\r\n        aZones = [];\r\n        bInDrag = false;\r\n        iEnterCount = 0;\r\n\r\n        clearInterval(tResizeInt);\r\n    }\r\n\r\n    function onWindowEnter(oEvent) {\r\n        iEnterCount++;\r\n        if (!bInDrag) {\r\n            if (containsFiles(oEvent.e)) {\r\n                initDropZones();\r\n                aHelpers.forEach(oHelper => {\r\n                    oHelper.onFileDrag(oEvent);\r\n                });\r\n            }\r\n        }\r\n        bInDrag = true;\r\n\r\n        // console.log(\"onWindowEnter(\" + iEnterCount + \")\");\r\n        oEvent.stop();\r\n    }\r\n\r\n    function onWindowOver(oEvent) {\r\n        var eElem = oEvent.getTarget();\r\n        while (eElem && eElem !== document.body) {\r\n            if (eElem.hasAttribute(\"data-dropzone\")) {\r\n                oEvent.e.dataTransfer.dropEffect = \"copy\";\r\n                oEvent.stop();\r\n                return;\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        // console.log(\"onWindowOver\");\r\n        oEvent.e.dataTransfer.dropEffect = \"none\";\r\n\r\n        oEvent.stop();\r\n\r\n    }\r\n\r\n    function onWindowDrop(oEvent) {\r\n        var eElem = oEvent.getTarget();\r\n\r\n        while (eElem && eElem !== document.body) {\r\n            if (eElem.hasAttribute(\"data-dropzone\")) {\r\n                break;\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        //  Notify drop receiver\r\n        if (eElem) {\r\n            aZones.forEach(function (oZone) {\r\n                if (oZone.eZone === eElem) {\r\n                    oZone.oObj.handleDrop(oEvent);\r\n                    stopDropZones();\r\n                    oEvent.stop();\r\n                    return false;\r\n                }\r\n            });\r\n        }\r\n\r\n        // console.log(\"onWindowDrop\");\r\n    }\r\n\r\n\r\n    function onWindowLeave(oEvent) {\r\n        iEnterCount--;\r\n        if (iEnterCount <= 0) {\r\n            stopDropZones();\r\n            iEnterCount = 0;\r\n        }\r\n        // console.log(\"onWindowLeave(\" + iEnterCount + \")\");\r\n\r\n    }\r\n\r\n    function containsFiles(event) {\r\n        if (event.dataTransfer.types) {\r\n            for (var i = 0; i < event.dataTransfer.types.length; i++) {\r\n                if (event.dataTransfer.types[i] == \"Files\") {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    df.dom.ready(function () {\r\n        df.dom.on(\"dragenter\", document, onWindowEnter, window);\r\n        df.dom.on(\"dragover\", document, onWindowOver, window);\r\n        df.dom.on(\"drop\", document, onWindowDrop, window);\r\n        df.dom.on(\"dragleave\", document, onWindowLeave, window);\r\n    }, window);\r\n\r\n    return {\r\n        addHandler(oObj) {\r\n            aHandlers.push(oObj);\r\n        },\r\n\r\n        remHandler(oObj) {\r\n            var i;\r\n\r\n            while ((i = aHandlers.indexOf(oObj)) >= 0) {\r\n                aHandlers.splice(i, 1);\r\n            }\r\n        },\r\n\r\n        registerHelper(oHelper) {\r\n            aHelpers.add(oHelper);\r\n        },\r\n\r\n        removeHelper(oHelper) {\r\n            aHelpers.remove(oHelper);\r\n        },\r\n\r\n        containsFiles,\r\n        stopDropZones\r\n    }\r\n\r\n})();\r\n\r\n\r\n/* \r\nThe big worker function with the upload logic. Extracted out of the class so it can be used by \r\nother controls as well. Extra advantage is the usage of local variables inside the closure.\r\n\r\nThe oOpts parameter is used too pass in the details and also contains the status while uploading \r\nand has references to the functions showing the status.\r\n*/\r\ndf.uploadFiles = function uploadFile(oOpts) {\r\n    var i, fEmpty, aFiles, oWO, aRows = [], bCanceled, bUploading = true, oCurRec;\r\n\r\n    aFiles = oOpts.aFiles;\r\n    oWO = oOpts.oWO;\r\n\r\n    oOpts.iTotal = 0;\r\n    oOpts.iLoaded = 0;\r\n\r\n    fEmpty = function () { };\r\n    oOpts.displayStartWorking = oOpts.displayStartWorking || fEmpty;\r\n    oOpts.displayProgress = oOpts.displayProgress || fEmpty;\r\n    oOpts.displayFinishWorking = oOpts.displayFinishWorking || fEmpty;\r\n    oOpts.displayFinished = oOpts.displayFinished || fEmpty;\r\n\r\n    /* \r\n    Actual uploader function doing the HTML5 upload.\r\n    */\r\n    function uploadFileHtml5(oFile, iFile, fFinished) {\r\n        oOpts.displayProgress.call(oWO, iFile, aFiles.length, 0, oFile.oFile.size, oOpts.iLoaded, oOpts.iTotal);\r\n\r\n        if (oWO.getWebApp() instanceof LocalApp && window.chrome?.webview?.postMessageWithAdditionalObjects) {\r\n            //  If we are in FlexTron file upload is handled by passing the file object to WebView2 using postMessageWithAdditionalObjects\r\n            oWO.serverActionEx({\r\n                sMethod: \"DoHandleLocalFileUpload\",\r\n                aParams: [oFile.sResourceId],\r\n                tData: null,\r\n                fHandler: () => {\r\n                    oOpts.iLoaded += oFile.oFile.size;\r\n                    oOpts.displayProgress.call(oWO, iFile, aFiles.length, oFile.oFile.size, oFile.oFile.size, oOpts.iLoaded, oOpts.iTotal);\r\n                    oFile.bFinished = true;\r\n                    fFinished(true);\r\n                },\r\n                oHandlerEnv: null,\r\n                oPlatformSpecific: {\r\n                    aAdditionalObjects: [oFile.oFile]\r\n                }\r\n            });\r\n        } else {\r\n            // Regular HTML5 file upload\r\n            let oData, oReq;\r\n            //  Prepare request\r\n            oCurRec = oReq = new XMLHttpRequest();\r\n\r\n            oReq.upload.addEventListener('progress', function (ev) {\r\n                var iTotal = oOpts.iLoaded + ev.loaded;\r\n\r\n                iTotal = (iTotal < oOpts.iTotal ? iTotal : oOpts.iTotal);\r\n                oOpts.displayProgress.call(oWO, iFile, aFiles.length, ev.loaded, ev.total, iTotal, oOpts.iTotal);\r\n            }, false);\r\n\r\n            oReq.onreadystatechange = function (ev) {\r\n                try {\r\n                    if (oReq.readyState === HttpRequest.states.REQUEST_STATE_COMPLETE) {\r\n                        if (!bCanceled) {\r\n                            if (oReq.status === 201) {\r\n                                oFile.bFinished = true;\r\n                                oOpts.iLoaded += oFile.oFile.size;\r\n                                fFinished(true);\r\n                                oReq.onreadystatechange = null;\r\n                            } else {\r\n                                //  Throw errorr\r\n                                throw new df.Error(999, \"Received HTTP error '{{0}} {{1}}' while uploading file.\", this, [oReq.status, oReq.statusText], oReq.responseText);\r\n                            }\r\n                        }\r\n\r\n                        oReq = null;\r\n                    }\r\n                } catch (oErr) {\r\n                    //  Fix control state..\r\n                    fFinished(false);\r\n\r\n                    //  Handle error\r\n                    oWO.getWebApp().handleError(oErr);\r\n\r\n                    oReq = null;\r\n                }\r\n\r\n            };\r\n            oReq.open('POST', oWO.psUploadUrl, true);\r\n\r\n            oData = new FormData();\r\n            oData.append('hash', oFile.sResourceId);\r\n            oData.append('v', 'html5');\r\n            oData.append('file', oFile.oFile);\r\n            oReq.send(oData);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Initiates uploading the of the next file in the list.\r\n    */\r\n    function uploadFilesHtml5() {\r\n        var i, bLast = true, oFile = null, iIndex;\r\n\r\n        if (bCanceled) {\r\n            return;\r\n        }\r\n\r\n        //  Determine next file to upload and check if that is the last file\r\n        for (i = 0; i < aFiles.length; i++) {\r\n            if (!aFiles[i].bFinished) {\r\n                if (!oFile) {\r\n                    oFile = aFiles[i];\r\n                    iIndex = i;\r\n                } else {\r\n                    bLast = false;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        uploadFileHtml5(oFile, iIndex, function (bSuccess) {\r\n            var i;\r\n\r\n\r\n            if (bSuccess) {\r\n                if (bLast) {\r\n                    oOpts.displayFinishWorking.call(oWO);\r\n                }\r\n\r\n                if (oWO.pbNotifyIndividualFile) {\r\n                    oWO.serverAction(\"DoFileFinished\", [oFile.oFile.name, oFile.sResourceId], null, function (oEvent) {\r\n                        oFile.sFinishedResult = oEvent.sReturnValue;    //  This is used by the froala editor\r\n                        if (!bLast) {\r\n                            uploadFilesHtml5();\r\n                        }\r\n                    }, oWO);\r\n                } else {\r\n                    if (bLast) {\r\n                        for (i = 0; i < aFiles.length; i++) {\r\n                            oWO.serverAction(\"DoFileFinished\", [aFiles[i].oFile.name, aFiles[i].sResourceId], null, function (oEvent) {\r\n                                oFile.sFinishedResult = oEvent.sReturnValue;    //  This is used by the froala editor\r\n                            });\r\n                        }\r\n                    } else {\r\n                        uploadFilesHtml5();\r\n                    }\r\n                }\r\n\r\n                if (bLast) {\r\n                    oWO.fire(\"OnUploadFinished\", [], function (oEvent) {\r\n                        oOpts.displayFinished.call(oWO, true);\r\n                        bUploading = false;\r\n\r\n                        if (oOpts.finished) {\r\n                            oOpts.finished.call(oWO, true, aFiles);\r\n                        }\r\n                    });\r\n                    oWO.processUpload = null;\r\n\r\n                }\r\n            } else {\r\n                if (oWO._eControl) {\r\n                    oWO._eControl.value = \"\";\r\n                }\r\n                oOpts.displayFinished.call(oWO, false);\r\n                bUploading = false;\r\n            }\r\n        });\r\n    }\r\n\r\n    /* \r\n    Cancels the upload.\r\n    */\r\n    oOpts.cancel = function () {\r\n        bCanceled = true;\r\n\r\n        aFiles = [];\r\n\r\n        if (oCurRec) {\r\n            oCurRec.abort();\r\n        }\r\n\r\n        oOpts.displayFinished.call(oWO, false);\r\n        bUploading = false;\r\n    };\r\n\r\n    var fUploadCallback = function (oEv) {\r\n        var i, aRows = JSON.parse(oEv.sReturnValue);\r\n\r\n        //  Get resource id's out of action data\r\n        for (i = 0; i < aRows.length; i++) {\r\n            if (aRows[i].length >= 2 && aFiles[aRows[i][0]]) {\r\n                aFiles[aRows[i][0]].sResourceId = aRows[i][1];\r\n            } else {\r\n                throw new df.Error(999, \"Received invalid resource id from the server.\", this);\r\n            }\r\n        }\r\n\r\n        //  Filter out cancelled files & init stats\r\n        oOpts.iTotal = 0;\r\n        oOpts.iLoaded = 0;\r\n        for (i = 0; i < aFiles.length; i++) {\r\n            if (!aFiles[i].sResourceId) {\r\n                aFiles.splice(i, 1);\r\n                i--;\r\n            } else {\r\n                oOpts.iTotal += aFiles[i].oFile.size;\r\n            }\r\n        }\r\n\r\n        if (aFiles.length > 0) {\r\n            bCanceled = false;\r\n\r\n            uploadFilesHtml5();\r\n        } else {\r\n            oOpts.displayFinished.call(oWO, false);\r\n            bUploading = false;\r\n        }\r\n    }\r\n\r\n    //  Initialization of the files array\r\n    if (aFiles && aFiles.length > 0) {\r\n        for (i = 0; i < aFiles.length; i++) {\r\n            const oCurFile = aFiles[i].oFile;\r\n            aRows.push([\r\n                i,\r\n                (oCurFile.name || \"Unknown\"),\r\n                (oCurFile.size || 0),\r\n                (oCurFile.type || \"Unknown\")\r\n            ]);\r\n\r\n            oOpts.iTotal += oCurFile.size || 0;\r\n        }\r\n\r\n        oOpts.displayStartWorking.call(oWO);\r\n\r\n        // Call control to init upload call on server (controls can have their own implementation for this)\r\n        oWO.doStartUpload(fUploadCallback, aRows);\r\n    } else {\r\n        throw new df.Error(999, \"No file details found to start upload.\", this);\r\n    }\r\n};\r\n\r\n/* \r\nFile upload function with file upload dialog UI.\r\n*/\r\ndf.uploadFilesProgressDialog = function (oOpts) {\r\n    var oDialog, oMainPnl, oLbl, oFileLbl, oRemLbl, oSpacer, oTotalPrg, oFilePrg, oBtnPnl, oCancelBtn, oWO;\r\n\r\n    oWO = oOpts.oWO;\r\n    let sFilesTrans = oWO.getWebApp().getTrans(\"files\");\r\n    let sFileTrans = oWO.getWebApp().getTrans(\"file\");\r\n\r\n    function onCancel(oEvent) {\r\n        oOpts.cancel();\r\n    }\r\n\r\n    /* \r\n    Displays the dialog and controls.\r\n    */\r\n    oOpts.displayStartWorking = function () {\r\n        var iWindowWidth = df.dom.windowWidth()\r\n\r\n        oDialog = new WebModalDialog(null, oWO);\r\n        oDialog.psCaption = oWO.getWebApp().getTrans(\"file_cap_uploading\");\r\n        oDialog.pbShowClose = this.pbAllowCancel;\r\n        oDialog.piMinWidth = (iWindowWidth > 520 ? 500 : iWindowWidth - 20);\r\n        oDialog.OnEscape.addListener(onCancel, this);\r\n\r\n        oMainPnl = new WebPanel(null, oDialog);\r\n        oMainPnl.peRegion = df.ciRegionCenter;\r\n        oMainPnl.piColumnCount = 10;\r\n        oDialog.addChild(oMainPnl);\r\n\r\n        oLbl = new WebLabel(null, oMainPnl);\r\n        oLbl.psCaption = sFileTrans + \":\";\r\n        oLbl.piColumnSpan = 2;\r\n        oLbl.peAlign = df.ciAlignRight;\r\n        oMainPnl.addChild(oLbl);\r\n\r\n        oFileLbl = new WebLabel(null, oMainPnl);\r\n        oFileLbl.psCaption = \"...\";\r\n        oFileLbl.piColumnSpan = 0;\r\n        oFileLbl.piColumnIndex = 2;\r\n        oMainPnl.addChild(oFileLbl);\r\n\r\n        oLbl = new WebLabel(null, oMainPnl);\r\n        oLbl.psCaption = oWO.getWebApp().getTrans(\"file_remain\") + \":\";\r\n        oLbl.piColumnSpan = 2;\r\n        oLbl.peAlign = df.ciAlignRight;\r\n        oMainPnl.addChild(oLbl);\r\n\r\n        oRemLbl = new WebLabel(null, oMainPnl);\r\n        oRemLbl.psCaption = oOpts.aFiles.length + \" \" + sFilesTrans + \" (\" + df.sys.data.markupDataSize(oOpts.iTotal) + \")\";\r\n        oRemLbl.piColumnSpan = 0;\r\n        oRemLbl.piColumnIndex = 2;\r\n        oMainPnl.addChild(oRemLbl);\r\n\r\n        oSpacer = new WebSpacer(null, oMainPnl);\r\n        oMainPnl.addChild(oSpacer);\r\n\r\n        if (oWO.pbMultiFile) {\r\n            oTotalPrg = new WebProgressBar(null, oMainPnl);\r\n            oTotalPrg.piMaxValue = (oOpts.iTotal > 0 ? oOpts.iTotal : oOpts.aFiles.length);\r\n            oMainPnl.addChild(oTotalPrg);\r\n        }\r\n\r\n        oFilePrg = new WebProgressBar(null, oMainPnl);\r\n        oMainPnl.addChild(oFilePrg);\r\n\r\n        if (oWO.pbAllowCancel) {\r\n            oBtnPnl = new WebPanel(null, oDialog);\r\n            oBtnPnl.peRegion = df.ciRegionBottom;\r\n            oBtnPnl.piColumnCount = 12;\r\n            oDialog.addChild(oBtnPnl);\r\n\r\n            oCancelBtn = new WebButton(null, oBtnPnl);\r\n            oCancelBtn.psCaption = oWO.getWebApp().getTrans(\"cancel\");\r\n            oCancelBtn.piColumnIndex = 9;\r\n            oCancelBtn.piColumnSpan = 3;\r\n            oCancelBtn.OnClick.addListener(onCancel, this);\r\n            oBtnPnl.addChild(oCancelBtn);\r\n        }\r\n\r\n        oDialog.show();\r\n\r\n        oWO.getWebApp().ready(function () {\r\n            oDialog.resize();\r\n            if (oCancelBtn) {\r\n                oCancelBtn.focus();\r\n            }\r\n        });\r\n    };\r\n\r\n    /* \r\n    Updates the displayed progress with the provided details.\r\n    */\r\n    oOpts.displayProgress = function (iFile, iFiles, iFileLoaded, iFileTotal, iTotalLoaded, iTotal) {\r\n        oFileLbl.set(\"psCaption\", (oOpts.aFiles[iFile] && oOpts.aFiles[iFile].oFile && oOpts.aFiles[iFile].oFile.name) || \"\");\r\n\r\n        let iRem = iFiles - (iFile + 1);\r\n        let iBytesRem = iTotal - iTotalLoaded;\r\n\r\n        oRemLbl.set(\"psCaption\", (iRem > 0 ? (iRem.toString() + \" \" + sFilesTrans + \" (\" + df.sys.data.markupDataSize(iBytesRem) + \")\") : df.sys.data.markupDataSize(iBytesRem)));\r\n\r\n        if (oWO.pbMultiFile) {\r\n            oTotalPrg.set(\"piMaxValue\", iTotal);\r\n            oTotalPrg.set(\"piValue\", iTotalLoaded);\r\n        }\r\n\r\n\r\n        oFilePrg.set(\"piMaxValue\", iFileTotal);\r\n        oFilePrg.set(\"piValue\", iFileLoaded);\r\n    };\r\n\r\n    /* \r\n    Displays 100%.\r\n    */\r\n    oOpts.displayFinishWorking = function () {\r\n        oFilePrg.set(\"piValue\", oFilePrg.get(\"piMaxValue\"));\r\n\r\n        if (oWO.pbMultiFile) {\r\n            oTotalPrg.set(\"piValue\", oTotalPrg.get(\"piMaxValue\"));\r\n        }\r\n        oRemLbl.set(\"psCaption\", \"0 KB\");\r\n    };\r\n\r\n    /* \r\n    Hides the dialog\r\n    */\r\n    oOpts.displayFinished = function (bSuccess) {\r\n        if (oDialog) {\r\n            oDialog.hide();\r\n            oDialog.destroy();\r\n            oDialog.OnEscape.removeListener(onCancel, this);\r\n\r\n            if (oCancelBtn) {\r\n                oCancelBtn.OnClick.removeListener(onCancel, this);\r\n            }\r\n\r\n            oDialog = null;\r\n        }\r\n    };\r\n\r\n\r\n\r\n\r\n    // Call actual upload logic\r\n    df.uploadFiles(oOpts);\r\n};\r\n\r\n// Mixin to be used in WebBaseFileUpload and WebDragDropHelper to add file upload logic\r\nexport const WebFileUpload_Mixin = superclass => class extends superclass {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbShowDialog\", true);\r\n        this.prop(df.tBool, \"pbCapture\", false);\r\n        this.prop(df.tString, \"psAccept\", \"\");\r\n\r\n        //  Events\r\n        this.event(\"OnUploadFinished\", df.cCallModeWait);\r\n    }\r\n\r\n    /*\r\n    Initializes an array of File objects, it seeds the internal data structure, triggers an update of \r\n    display and if needed it starts the upload.\r\n    \r\n    @param  aFiles  FileList array of File objects.\r\n    */\r\n    initFiles(aFiles) {\r\n        var i;\r\n\r\n        if (this._bUploading) {\r\n            return;\r\n        }\r\n\r\n        this._aFiles = [];\r\n\r\n        //  Seed internal data structure\r\n        for (i = 0; i < aFiles.length && (this.pbMultiFile || this._aFiles.length < 1); i++) {\r\n            if (this.validate(aFiles[i])) {\r\n                this._aFiles.push({\r\n                    bFinished: false,\r\n                    sResourceId: null,\r\n                    oFile: aFiles[i]\r\n                });\r\n            }\r\n        }\r\n\r\n        if (this._aFiles.length > 0) {\r\n            this.displaySelectedFileDetails();\r\n\r\n            //  Start processing if needed\r\n            if (this.pbAutoStart) {\r\n                this.startUpload();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Validates the file name against psAccept if psAccept is set. It checks the extension or the mime \r\n    type manually.\r\n    \r\n    @param  oFile   HTML5 file object.\r\n    @return True if the file is valid according to psAccept.\r\n    */\r\n    validate(oFile) {\r\n        var aAllowed, i, sAccept, aMime, aFileMime, bExt = false;\r\n        if (this.psAccept) {\r\n            aAllowed = this.psAccept.toLowerCase().split(\",\");\r\n\r\n            for (i = 0; i < aAllowed.length; i++) {\r\n                sAccept = aAllowed[i].trim();\r\n\r\n                if (sAccept.charAt(0) === \".\") { // This is an extension\r\n                    if (oFile.name.substr(oFile.name.lastIndexOf(\".\"), sAccept.length).toLowerCase() === sAccept) {\r\n                        return true;\r\n                    }\r\n\r\n                    bExt = true;\r\n                } else {\r\n                    if (oFile.type) {\r\n                        aMime = sAccept.split(\"/\");\r\n                        aFileMime = oFile.type.split(\"/\");\r\n\r\n                        if (aMime.length > 1 && aFileMime.length > 1 && (aMime[0] === aFileMime[0] || aMime[0] === \"*\") && (aMime[1] === aFileMime[1] || aMime[1] === \"*\")) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            //  Make sure that we accept the file if only a mime type filter is set while no mime type is available\r\n            if (!oFile.type && !bExt) {\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /*\r\n    Starts the upload of the selected files.\r\n    \r\n    @client-action\r\n    */\r\n    startUpload() {\r\n        var oOpts = {\r\n            oWO: this,\r\n            aFiles: this._aFiles,\r\n            finished(bSuccess, aFiles) {\r\n                //  Clear file upload control to make sure it will trigger the onchange the next time\r\n                if (this._eInput) {\r\n                    this._eInput.value = \"\";\r\n                }\r\n            },\r\n\r\n            displayStartWorking: this.displayStartWorking,\r\n            displayProgress: this.displayProgress,\r\n            displayFinishWorking: this.displayFinishWorking,\r\n            displayFinished: this.displayFinished\r\n        };\r\n\r\n        if (this.pbShowDialog) {\r\n            df.uploadFilesProgressDialog(oOpts);\r\n        } else {\r\n            df.uploadFiles(oOpts);\r\n        }\r\n    }\r\n\r\n    // Calls server side upload logic,\r\n    // This is the default implementation, which can be modified to tailor specific classes needs\r\n    // The server side function should always return an array containing the fileIndex and upload key (aka: asResults = [index][fileIndex, key])\r\n    doStartUpload(fCallBack, aRows) {\r\n        //  Send call to initialize upload\r\n        this.serverAction(\"DoStartUpload\", [], df.sys.vt.serialize(aRows), fCallBack);\r\n    }\r\n\r\n    /* \r\n    Replaced by upload logic inside closure!\r\n    \r\n    @client-action\r\n    */\r\n    processUpload() {\r\n\r\n    }\r\n\r\n    displaySelectedFileDetails() {\r\n\r\n    }\r\n\r\n    displayStartWorking() {\r\n\r\n    }\r\n\r\n    displayProgress(iFile, iFiles, iFileLoaded, iFileTotal, iTotalLoaded, iTotal) {\r\n\r\n    }\r\n\r\n    displayFinishWorking() {\r\n\r\n    }\r\n\r\n    displayFinished(bSuccess) {\r\n\r\n    }\r\n\r\n    set_psAccept(sVal) {\r\n        if (this._eInput) {\r\n            this._eInput.accept = sVal;\r\n        }\r\n    }\r\n\r\n    set_pbCapture(bVal) {\r\n        if (this._eInput) {\r\n            this._eInput.capture = bVal;\r\n        }\r\n    }\r\n};\r\n\r\n// Create base class for WebBaseFileUpload with WebFileUpload Mixin\r\nclass WebFileUploadBase extends WebFileUpload_Mixin(WebBaseControl) {} \r\n\r\nexport class WebBaseFileUpload extends WebFileUploadBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbMultiFile\", false);\r\n        this.prop(df.tBool, \"pbAutoStart\", true);\r\n        this.prop(df.tBool, \"pbAllowCancel\", true);\r\n        this.prop(df.tBool, \"pbNotifyIndividualFile\", false);\r\n        // this.prop(df.tBool, \"pbShowDialog\", true);\r\n        // this.prop(df.tBool, \"pbCapture\", false);\r\n        this.prop(df.tString, \"psDropZoneObjName\", \"\");\r\n\r\n        // this.prop(df.tString, \"psAccept\", \"\");\r\n        this._oDragArea = null;\r\n        this._eDragArea = null;\r\n\r\n        // this.event(\"OnUploadFinished\", df.cCallModeWait);\r\n    }\r\n\r\n    /*\r\n    Generates hidden file upload element that is used for file selection.\r\n    \r\n    @param  aHtml   HTML string builder array.\r\n    */\r\n    fileHtml(aHtml) {\r\n        aHtml.push('<div style=\"display: none\">');\r\n        aHtml.push('<input type=\"file\" name=\"', this._sName,\r\n            '\" id=\"', this._sControlId, '\"',\r\n            (this.pbMultiFile ? ' multiple' : ''),\r\n            ' accept=\"', this.psAccept, '\"',\r\n            (this.pbCapture ? ' capture' : ''),\r\n            '>');\r\n        aHtml.push('</div>');\r\n\r\n    }\r\n\r\n    /*\r\n    After the HTML is inserted into the DOM we get references and attach event listenrs.\r\n    */\r\n    afterRender() {\r\n        this._eInput = df.dom.query(this._eElem, 'input[type=\"file\"]');\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"change\", this._eInput, this.onFileChange, this);\r\n    }\r\n\r\n    /*\r\n    Shows the file selection dialog by calling click on the input type=file. It first checks if the \r\n    browser supports HTML5 file upload.\r\n    */\r\n    selectFiles() {\r\n        if (!(window.File && window.FileList && window.FileReader)) {\r\n            throw new df.Error(999, \"HTML5 Upload is not supported by this browser.\", this);\r\n        }\r\n\r\n        this._eInput.click();\r\n    }\r\n\r\n    /*\r\n    When the control is shown we register ourselves as drop handler.\r\n    */\r\n    afterShow() {\r\n        super.afterShow();\r\n\r\n        df.dragdrop.addHandler(this);\r\n    }\r\n\r\n    /*\r\n    When the control is hidden we unregister ourselves as drop handler.\r\n    */\r\n    afterHide() {\r\n        super.afterHide();\r\n\r\n        df.dragdrop.remHandler(this);\r\n    }\r\n\r\n    /*\r\n    Called by the drag 'n drop system to get details on the drop area.\r\n    */\r\n    getDropDetails() {\r\n        var oDropObj, eDropElem, oWebApp = this.getWebApp();\r\n\r\n        if (this.isEnabled()) {\r\n            oDropObj = oWebApp.findObj(this.psDropZoneObjName);\r\n\r\n            if (oDropObj instanceof WebBaseUIObject) {\r\n                if (oDropObj === oWebApp) {\r\n                    eDropElem = document.body;\r\n                } else {\r\n                    eDropElem = oDropObj._eElem;\r\n                }\r\n\r\n                if (eDropElem) {\r\n                    return {\r\n                        sDropContent: this.getWebApp().getTrans(\"file_drop\"),\r\n                        sDropClass: \"\",\r\n                        oRect : eDropElem.getBoundingClientRect(),\r\n                        eZoneParent : (eDropElem.closest(\"dialog\") || document.body)\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    Called by the drag 'n drop system to handle a drop.\r\n    */\r\n    handleDrop(oEvent) {\r\n        var aFiles;\r\n\r\n        aFiles = (oEvent.e.dataTransfer && oEvent.e.dataTransfer.files) || null;\r\n        if (aFiles && aFiles.length > 0) {\r\n            oEvent.stop();\r\n            this.initFiles(aFiles);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the onchange event of the input type=file element and initializes selected files.\r\n    */\r\n    onFileChange(oEvent) {\r\n        var sFileName;\r\n\r\n        //  Check if selected and get file from control\r\n        if (this._eInput.files.length > 0) {\r\n            this.initFiles(this._eInput.files);\r\n        }\r\n\r\n        oEvent.stop();\r\n    }\r\n};\r\n","import { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuItem\r\nExtends:\r\n    df.WebBaseUIObject\r\n\r\nThis class represents a static menu item. These menu item doesnt have any rendering logic which is \r\nin the menu classes. Through a system with a menu hub, menu listeners and menu providers the menu \r\nclasses know which items it needs to render.\r\n    \r\nRevision:\r\n    2011/10/04  (HW, DAW) \r\n        Initial version.\r\n    2015/01/19  (HW, DAW)\r\n        Re factored into new menu model where the DOM element doesn't know anything about its own \r\n        rendering. The menu class now perform the rendering and passes menu items around as data \r\n        elements.\r\n*/\r\n\r\n/*\r\nThis class represents a menu item inside a menu or a toolbar. It belongs to the server-side \r\ncWebMenuItem class and implements its functionality on the client. It has support for icons a \r\ncaption and sub menus. The submenu's are shown when hovering the element and hidden after a timeout \r\n(or a click). The CSS (class: WebMenuItem & WebMenuBar & WebToolBar) heavily determines the looks of \r\nthe control.\r\n\r\n@code\r\n<li class=\"WebUIObj WebMenuItem\">\r\n    <div title=\"Order Entry View\">\r\n        <span class=\"WebItm_Icon\" style=\"background-image: url(&quot;Images/Order.png&quot;);\">&nbsp;</span>\r\n        <a href=\"javascript: void(0);\" target=\"_self\">Order Entry View</a>\r\n    </div>\r\n</li>\r\n@code\r\n*/\r\n\r\nexport class WebMenuItem extends WebBaseUIObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tString, \"psTextColor\", \"\");\r\n        this.prop(df.tBool, \"pbBeginGroup\", false);\r\n        this.prop(df.tString, \"psGroupCaption\", \"\");\r\n        this.prop(df.tString, \"psImage\", \"\");\r\n        this.prop(df.tString, \"psToolTip\", \"\");\r\n        this.prop(df.tInt, \"peActionDisplay\", df.adBoth);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait);\r\n        this.prop(df.tString, \"psLoadViewOnClick\", \"\");\r\n\r\n        // @privates\r\n        this._bShown = true;\r\n        this._oProv = null;\r\n    }\r\n\r\n    /* \r\n    Called by a menu engine when this menu item is clicked. It triggers the OnClick event and if needed \r\n    performs a load view (psLoadViewOnClick).\r\n    */\r\n    itemClick(tItem, fReturn, oEnv) {\r\n        return this.fire('OnClick', [], function (oEvent) {\r\n            //  Determine if a view needs to be loaded\r\n            if (!oEvent.bCanceled) {\r\n                if (this.psLoadViewOnClick) {\r\n                    this.getWebApp().showView(this.psLoadViewOnClick);\r\n                }\r\n            }\r\n\r\n            fReturn.call(oEnv, (oEvent.bClient || oEvent.bServer || this.psLoadViewOnClick));\r\n        });\r\n    }\r\n\r\n    /*\r\n    This setter method updates the DOM with the new caption.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psCaption(sVal) {\r\n        this.psCaption = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psToolTip(sVal) {\r\n        this.psToolTip = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  bVal   The new value.\r\n    @private\r\n    */\r\n    set_pbBeginGroup(bVal) {\r\n        this.pbBeginGroup = bVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psImage(sVal) {\r\n        this.psImage = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psHtmlId(sVal) {\r\n        this.psHtmlId = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psCSSClass(sVal) {\r\n        this.psCSSClass = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psTextColor(sVal) {\r\n        this.psTextColor = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /*\r\n    Setter method that notifies the menu provider of a this change.\r\n    \r\n    @param  sVal   The new value.\r\n    @private\r\n    */\r\n    set_psBackgroundColor(sVal) {\r\n        this.psBackgroundColor = sVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /* \r\n    Setter method that notifies the menu provider of this change.\r\n    \r\n    @param  eVal    The new value.\r\n    @private\r\n    */\r\n    set_peActionDisplay(eVal) {\r\n        this.peActionDisplay = eVal;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    /* \r\n    Setter method that notifies the menu provider of a this change. Optimized for being set to the same \r\n    value.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbVisible(bVal) {\r\n        if (this.pbVisible !== bVal) {\r\n            this.pbVisible = bVal;\r\n\r\n            this.notifyChange();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter method that notifies the menu provider of a this change. Optimized for being set to the same \r\n    value.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbRender(bVal) {\r\n        if (this.pbRender !== bVal) {\r\n            this.pbRender = bVal;\r\n\r\n            //  Trigger after hide / show\r\n            if (this.pbRender) {\r\n                this.afterShow();\r\n            } else {\r\n                this.afterHide();\r\n            }\r\n\r\n            this.notifyChange();\r\n        }\r\n    }\r\n\r\n    show() {\r\n        //  Used by the previewer to show items when selecting them\r\n    }\r\n\r\n    hide() {\r\n        //  Used by the previewer to hide items when deselecting them\r\n    }\r\n\r\n\r\n    /* \r\n    Overrides applyEnabled and notifies the change in the enabled state to the menu system so it can \r\n    update itself.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    applyEnabled(bVal) {\r\n        this.notifyChange();\r\n    }\r\n\r\n    /* \r\n    Triggers the menu provider (the wrapping class) of a change to the menu item. The provider is then \r\n    responsible for updating the UI by triggering the menu renderer.\r\n    */\r\n    notifyChange() {\r\n        this.getProv().notifyChange();\r\n    }\r\n\r\n    /* \r\n    Determines the tooltip element (which can be used by error balloons and floating panels) by lookup \r\n    up the rendering menu asking it. \r\n    \r\n    @return DOM element for this menu item (null if not found / available).\r\n    */\r\n    getTooltipElem() {\r\n        const oProv = this.getProv();\r\n\r\n        //  Determine the provider (or renderer)\r\n        if (oProv) {\r\n            if (oProv.psGroupName) {\r\n                const oHub = oProv.getHub();\r\n                const aL = oHub.getListeners(oProv.psGroupName);\r\n\r\n                //  If our provider isn't the renderer we guess that it is the first rendered object\r\n                for (let i = 0; i < aL.length; i++) {\r\n                    if (aL[i]._bShown) {\r\n                        return aL[i].getItemElemByHandler(this);\r\n                    }\r\n                }\r\n            } else {\r\n                //  If there is no group name our provider is the renderer\r\n                return oProv.getItemElemByHandler(this);\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getProv() {\r\n        let oWO;\r\n\r\n        if (!this._oProv) {\r\n            oWO = this;\r\n\r\n            while (oWO && !oWO._bIsMenuProv) {\r\n                oWO = oWO._oParent;\r\n            }\r\n\r\n            if (oWO && oWO._bIsMenuProv) {\r\n                this._oProv = oWO;\r\n            } else {\r\n                throw new df.Error(999, \"Menu item '{{0}}' should be wrapped by a menu object.\", this, [this._sName]);\r\n            }\r\n        }\r\n\r\n        return this._oProv;\r\n    }\r\n\r\n    /**\r\n     * @returns CSS class to be used for this menu item.\r\n     */\r\n    cssClass() {\r\n        return this.psCSSClass;\r\n    }\r\n\r\n    /**\r\n     * @returns True if this menu item should be visible.\r\n     */\r\n    visible() {\r\n        return this.pbRender && this.pbVisible\r\n    }\r\n\r\n    /**\r\n     * Subclasses that do custom rendering override this.\r\n     * \r\n     * @returns False to indicate that this menu item has no custom rendering logic.\r\n     * @warning Only WebMenuList (and WebContextMenu) currently support custom rendered items!\r\n     */\r\n    customRender() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Subclasses that do custom rendering implement this.\r\n     * \r\n     * @param {Array} aHtml Stringbuilder HTML array.\r\n     */\r\n    itemHtml(aHtml) {\r\n\r\n    }\r\n\r\n    /**\r\n     * Subclasses that do custom rendering can implement this.\r\n     * \r\n     * @param {DOM Element} eElem The rendered element.\r\n     */\r\n    itemRendered(eElem) {\r\n\r\n    }\r\n}","import { WebMenuItem } from './WebMenuItem.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuItemCheckbox\r\nExtends:\r\n    df.WebMenuItem\r\n\r\nThis class represents a static menu item. These menu item doesnt have any rendering logic which is \r\nin the menu classes. Through a system with a menu hub, menu listeners and menu providers the menu \r\nclasses know which items it needs to render. This item contains a pbChecked property and through proxy is rendered.\r\n    \r\nRevision:\r\n    2021/10/13  (BN, DAW)\r\n        Initial Version.\r\n*/\r\n\r\nexport class WebMenuItemCheckbox extends WebMenuItem {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tBool, \"pbChecked\", false);\r\n        this.addSync(\"pbChecked\");\r\n    }\r\n\r\n    /* \r\n    Called by a menu engine when this menu item is clicked. It triggers the OnClick event and if needed \r\n    performs a load view (psLoadViewOnClick).\r\n    */\r\n    itemClick(tItem, fReturn, oEnv) {\r\n        if (tItem.hRef) {\r\n            tItem.hRef.set_pbChecked(!tItem.hRef.isChecked());\r\n        }\r\n        return super.itemClick(tItem, fReturn, oEnv);\r\n    }\r\n\r\n    /*\r\n    This function returns whether the object is checked.\r\n    Do mind that this does not keep in mind the fact,\r\n    That if the object does not have the property it always indicates false.\r\n    */\r\n    isChecked() {\r\n        return this.pbChecked === true;\r\n    }\r\n\r\n    //  - - - Setters - - - \r\n\r\n    /*\r\n    This setter method updates the DOM with the new checked state for a cWebMenuCheckbox.\r\n    \r\n    @param  bVal   The new value.\r\n    @private\r\n    */\r\n    set_pbChecked(bVal) {\r\n        this.pbChecked = bVal;\r\n        this.notifyChange();\r\n    }\r\n\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebMenuItem } from './WebMenuItem.js';\r\nimport { WebMenuItemCheckbox } from './WebMenuItemCheckbox.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebBaseMenu\r\nExtends:\r\n    df.WebBaseControl\r\nMixins:\r\n    df.WebMenuProvider_mixin\r\n\r\nThis is the core of the menu system which consists of menu providers and menu listeners. A central\r\nsingleton object called the GroupHub is responsible for the communication of data between the\r\nproviders and the listeners. These work in groups based on unique names (psGroupName). A menu\r\nprovider is responsible for maintaining menu elements which can be sub web objects of that provider\r\nor dynamically provided. It communicates changes through the GroupHub to the menu listeners that\r\nonly know the menu as an abstract object tree. The listeners are responsible for rendering the menu.\r\n\r\nMost menu classes are both listener and provider and if no groupname is set they will work\r\nstandalone. The df.WebMenuProvider_mixin is the core of this logic and actually implements both the\r\nlistener and the provider interface where subclasses control if they are listeners or providers\r\nusing properties. A group can have multiple listeners and multiple providers. The WebMenuGroup is a\r\nspecial class that is only a menu provider allowing a menu to be defined in a different place than\r\nit is rendered. For example inside a view. If a group is placed inside a view it will deactivate\r\nitself if the view is not displayed changing the menu at runtime. Providers also send updates\r\nthrough the hub if changes are made to the menu structure.\r\n\r\nRevisions:\r\n    2015/01/15, HW (DAW)\r\n        Initial version.\r\n*/\r\n/* global df */\r\ndf.tWebMenuItem = {\r\n    sId: df.tString,\r\n\r\n    sCaption: df.tString,\r\n    sTooltip: df.tString,\r\n    sGroupCaption: df.tString,\r\n\r\n\r\n    bEnabled: df.tBool,\r\n    sCSSClass: df.tString,\r\n    sHtmlId: df.tString,\r\n\r\n    bBeginGroup: df.tBool,\r\n    sImage: df.tString,\r\n\r\n    eCheckbox: df.tInt,\r\n\r\n    sTextColor: df.tString,\r\n    sBackgroundColor: df.tString,\r\n\r\n    eActionDisplay: df.tString,\r\n\r\n    aChildren: []\r\n};\r\ndf.tWebMenuItem.aChildren.push(df.tWebMenuItem);    //  Make recursive..\r\n\r\nexport const WebMenuProvider_mixin = superclass => class extends superclass {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbAllowHtml\");\r\n        this.prop(df.tString, \"psGroupName\");\r\n\r\n        this.OnUiUpdate = new df.events.JSHandler();\r\n\r\n        this._aMenu = null; //  If we are also a menu renderer (most classes are renderer and provider as well) this holds the received menu\r\n\r\n        this._aDynamicMenu = null;\r\n        this._bIsMenuProv = true;\r\n        this._bIsMenuListener = false;\r\n    }\r\n\r\n    create() {\r\n        super.create();\r\n\r\n        if (this.psGroupName) {\r\n            this.getHub().addProvider(this.psGroupName, this);\r\n\r\n            if (this._bIsMenuListener) {\r\n                this.getHub().addListener(this.psGroupName, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        //  Properly unregister from grouphub as the group can still be used\r\n        if (this.psGroupName) {\r\n            if (this._bIsMenuListener) {\r\n                this.getHub().remListener(this.psGroupName, this);\r\n            }\r\n\r\n            this.getHub().remProvider(this.psGroupName, this);\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    groupCollect(aData) {\r\n        return this.genMenuData(aData);\r\n    }\r\n\r\n    groupUpdate(aData) {\r\n        this._aMenu = aData;\r\n\r\n        this.updatePaths();\r\n\r\n        this.refreshMenu();\r\n    }\r\n\r\n    genMenuData(aData) {\r\n        //  Add dynamic data if available\r\n        if (this._aDynamicMenu) {\r\n            const aMen = this._aDynamicMenu;\r\n            for (let i = 0; i < aMen.length; i++) {\r\n                aMen[i]._oHandler = this;\r\n\r\n                aData.push(aMen[i]);\r\n            }\r\n        }\r\n\r\n        //  Recursively visit children\r\n        function visit(oParent, aItems) {\r\n\r\n            for (let i = 0; i < oParent._aChildren.length; i++) {\r\n                const oItem = oParent._aChildren[i];\r\n\r\n                if (oItem instanceof WebMenuItem && oItem.visible()) {\r\n                    const tItem = {\r\n                        sId: \"\",\r\n\r\n                        hRef: oItem,\r\n\r\n                        sCaption: oItem.psCaption,\r\n                        sTooltip: oItem.psToolTip,\r\n                        sGroupCaption: oItem.psGroupCaption,\r\n\r\n                        bEnabled: oItem.isEnabled(),\r\n                        sCSSClass: oItem.cssClass(),\r\n                        sHtmlId: oItem.psHtmlId,\r\n\r\n                        bBeginGroup: oItem.pbBeginGroup,\r\n                        sImage: oItem.psImage,\r\n\r\n                        eCheckbox: (oItem instanceof WebMenuItemCheckbox ? (oItem.isChecked() ? 1 : -1) : 0),\r\n\r\n                        sTextColor: oItem.psTextColor,\r\n                        sBackgroundColor: oItem.psBackgroundColor,\r\n\r\n                        eActionDisplay: oItem.peActionDisplay,\r\n\r\n                        aChildren: [],\r\n\r\n                        _bCustomRender: oItem.customRender(),\r\n                        _oHandler: oItem\r\n                    };\r\n                    aItems.push(tItem);\r\n\r\n                    visit(oItem, tItem.aChildren);\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        visit(this, aData);\r\n    }\r\n\r\n    set_psGroupName(sVal) {\r\n        if (this.psGroupName) {\r\n            this.getHub().remProvider(this.psGroupName, this);\r\n        }\r\n\r\n        this.getHub().addProvider(this.psGroupName, this);\r\n    }\r\n\r\n    set_pbAllowHtml(bVal) {\r\n        this.pbAllowHtml = bVal;\r\n\r\n        this.refreshMenu();\r\n    }\r\n\r\n    deserializeVT = df.sys.vt.generateDeserializer([df.tWebMenuItem]);\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    refresh() {\r\n        const aMenu = this.deserializeVT(this._tActionData);\r\n\r\n        for (let i = 0; i < aMenu.length; i++) {\r\n            this.initDynamic(aMenu[i]);\r\n        }\r\n\r\n        this._aDynamicMenu = aMenu;\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    itemClick(tItem, fReturn, oEnv) {\r\n        if (tItem.aChildren.length > 0) {\r\n            fReturn.call(oEnv, false);\r\n            return false;\r\n        } else {\r\n            return this.fire('OnItemClick', [tItem.sId, tItem.sCaption], function (oEvent) {\r\n                fReturn.call(oEnv, (oEvent.bClient || oEvent.bServer));\r\n            });\r\n        }\r\n    }\r\n\r\n    updateItem(sId, bOverwriteSubs) {\r\n        const tNew = df.sys.vt.deserialize(this._tActionData, df.tWebMenuItem);\r\n        const tCur = this.getItemById(sId);\r\n\r\n        if (tCur) {\r\n            tCur.sId = tNew.sId;\r\n\r\n            tCur.sCaption = tNew.sCaption;\r\n            tCur.sTooltip = tNew.sToolTip;\r\n            tCur.sGroupCaption = tNew.sGroupCaption;\r\n\r\n            tCur.bEnabled = tNew.bEnabled;\r\n            tCur.sCSSClass = tNew.sCSSClass;\r\n            tCur.sHtmlId = tNew.sHtmlId;\r\n\r\n            tCur.bBeginGroup = tNew.bBeginGroup;\r\n            tCur.sImage = tNew.sImage;\r\n\r\n            tCur.eCheckbox = tNew.eCheckbox;\r\n\r\n            tCur.sTextColor = tNew.sTextColor;\r\n            tCur.sBackgroundColor = tNew.sBackgroundColor;\r\n\r\n            tCur.eActionDisplay = tNew.eActionDisplay;\r\n\r\n            if (df.toBool(bOverwriteSubs)) {\r\n                tCur.aChildren = tNew.aChildren;\r\n                this.initDynamic(tCur);\r\n            }\r\n\r\n            this.notifyChange();\r\n        }\r\n    }\r\n\r\n    insertItem(sParentId) {\r\n        const tNew = df.sys.vt.deserialize(this._tActionData, df.tWebMenuItem);\r\n        const tParent = this.getItemById(sParentId);\r\n\r\n        if (tParent) {\r\n            this.initDynamic(tNew);\r\n            tParent.aChildren.push(tNew);\r\n\r\n            this.notifyChange();\r\n        }\r\n    }\r\n\r\n    removeItem(sId) {\r\n        function find(aMen) {\r\n            for (let i = 0; i < aMen.length; i++) {\r\n                if (aMen[i].sId === sId) {\r\n                    aMen.splice(i, 1);\r\n                    return true;\r\n                }\r\n\r\n                if (find(aMen[i].aChildren)) {\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        if (find(this._aDynamicMenu)) {\r\n            this.notifyChange();\r\n        }\r\n\r\n    }\r\n\r\n    /* \r\n    \r\n    @private\r\n    */\r\n    initDynamic(tItem) {\r\n        tItem._oHandler = this;\r\n\r\n        for (let i = 0; i < tItem.aChildren.length; i++) {\r\n            this.initDynamic(tItem.aChildren[i]);\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    Called by menuitems when they change.\r\n    \r\n    */\r\n    notifyChange() {\r\n        this.getWebApp().waitForCall(this.performUpdate, this);\r\n    }\r\n\r\n    /* \r\n    Augment updateEnabled and make sure that the menu gets refreshed.\r\n    */\r\n    updateEnabled() {\r\n        super.updateEnabled();\r\n\r\n        this.notifyChange();\r\n    }\r\n\r\n    performUpdate() {\r\n        this._aMenu = null;\r\n\r\n        if (this.psGroupName) {\r\n            this.getHub().updateGroup(this.psGroupName);\r\n        } else {\r\n            this.refreshMenu();\r\n        }\r\n\r\n        this.OnUiUpdate.fire(this, { bUiDriven: false });\r\n    }\r\n\r\n    getMenu() {\r\n        if (!this._aMenu) {\r\n            this._aMenu = [];\r\n\r\n            if (!this.psGroupName || !this._bIsMenuListener) {\r\n                this.genMenuData(this._aMenu);\r\n                this.updatePaths();\r\n            }\r\n        }\r\n\r\n        return this._aMenu;\r\n    }\r\n\r\n    getItemByPath(sPath) {\r\n        let tItem = null, aMen = this.getMenu();\r\n\r\n        const aPath = sPath.split(\".\");\r\n\r\n        for (let i = 0; i < aPath.length; i++) {\r\n            if (aMen[aPath[i]]) {\r\n                tItem = aMen[aPath[i]];\r\n                aMen = tItem.aChildren;\r\n            } else {\r\n                tItem = null;\r\n            }\r\n        }\r\n\r\n        return tItem;\r\n    }\r\n\r\n    getItemById(sId) {\r\n        function find(aMen) {\r\n            for (let i = 0; i < aMen.length; i++) {\r\n                if (aMen[i].sId === sId) {\r\n                    return aMen[i];\r\n                }\r\n                const oSub = find(aMen[i].aChildren);\r\n                if (oSub) {\r\n                    return oSub;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        return find(this.getMenu());\r\n    }\r\n\r\n    getItemByHandler(oObj) {\r\n        function find(aMen) {\r\n\r\n            for (let i = 0; i < aMen.length; i++) {\r\n                if (aMen[i]._oHandler === oObj) {\r\n                    return aMen[i];\r\n                }\r\n\r\n                const oRes = find(aMen[i].aChildren);\r\n                if (oRes) {\r\n                    return oRes;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        return find(this.getMenu());\r\n    }\r\n\r\n    getItemElemByPath(sPath) {\r\n        return (this._eControl && df.dom.query(this._eControl, 'li[data-df-path=\"' + sPath + '\"]')) || null;\r\n    }\r\n\r\n    /* \r\n    @return DOM element for a specific handler (menu item) if it can be found or NULL if not.\r\n    */\r\n    getItemElemByHandler(oObj) {\r\n        const tItm = this.getItemByHandler(oObj);\r\n\r\n        if (tItm) {\r\n            return this.getItemElemByPath(tItm._sPath);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    genItemHtml(aHtml, tItem, bSub) {\r\n        let sTooltip;\r\n\r\n        const aClassNames = ['WebMenuItem', tItem.sCSSClass, (tItem.bEnabled ? df.CssEnabled : df.CssDisabled)];\r\n        if (tItem.aChildren.length > 0) {\r\n            aClassNames.push('WebItm_HasSub');\r\n        }\r\n        if (tItem.bBeginGroup) {\r\n            aClassNames.push('WebItm_BgnGroup');\r\n        }\r\n        if (tItem.sImage) {\r\n            aClassNames.push('WebItm_HasIcon');\r\n        }\r\n        if (tItem.eCheckbox < 0 || tItem.eCheckbox > 0) {\r\n            aClassNames.push('WebItm_HasCheckbox');\r\n        }\r\n\r\n        aHtml.push('<li class=\"', df.dom.encodeAttr(aClassNames.join(\" \")), '\" data-df-path=\"', tItem._sPath, '\"');\r\n\r\n        if (tItem.sHtmlId) {\r\n            aHtml.push(' id=\"', df.dom.encodeAttr(tItem.sHtmlId), '\"');\r\n        }\r\n        if (tItem.sBackgroundColor || tItem.sTextColor) {\r\n            aHtml.push(' style=\"');\r\n\r\n            if (tItem.sTextColor) {\r\n                aHtml.push('color: ', df.dom.encodeAttr(tItem.sTextColor), ';');\r\n            }\r\n            if (tItem.sBackgroundColor) {\r\n                aHtml.push('background-color: ', df.dom.encodeAttr(tItem.sBackgroundColor), ';');\r\n            }\r\n            aHtml.push('\"');\r\n        }\r\n\r\n\r\n        aHtml.push('>');\r\n\r\n        if (tItem._bCustomRender) {\r\n            tItem._oHandler.itemHtml(aHtml);\r\n        } else {\r\n\r\n\r\n            //  Replace the first occurence of & (which is used to indicate keyboard shortcuts in windows)\r\n            tItem.sCaption = tItem.sCaption.replace(\"&\", \"\");\r\n\r\n            if (!this.pbShowLabel && tItem._sPath.indexOf(\".\") < 0) {\r\n                sTooltip = tItem.sTooltip || df.dom.encodeHtml(tItem.sCaption);\r\n            } else {\r\n                sTooltip = tItem.sTooltip;\r\n            }\r\n\r\n            aHtml.push('<div title=\"', df.dom.encodeAttr(sTooltip), '\">');\r\n\r\n            //  Add image if needed\r\n            if (tItem.sImage) {\r\n                aHtml.push('<span class=\"WebItm_Icon\" style=\"background-image: url(' + \"'\" + df.dom.encodeAttr(tItem.sImage) + \"'\" + ');\">&nbsp;</span>');\r\n            } else {\r\n                aHtml.push('<span class=\"WebItm_Icon\">&nbsp;</span>');\r\n            }\r\n\r\n            if (tItem.eCheckbox < 0) {\r\n                aHtml.push('<input class=\"WebItm_CheckBox\" type=\"checkbox\"></input>');\r\n            } else if (tItem.eCheckbox > 0) {\r\n                aHtml.push('<input class=\"WebItm_CheckBox\" type=\"checkbox\" checked></input>');\r\n            }\r\n\r\n            //  Generate the caption\r\n            aHtml.push('<a tabindex=\"-1\" href=\"javascript: void(0);\" target=\"_self\">', (this.pbAllowHtml ? tItem.sCaption : df.dom.encodeHtml(tItem.sCaption)), '</a></div>');\r\n\r\n            //  Generate sub elements if needed\r\n            if (bSub && tItem.aChildren.length > 0) {\r\n                aHtml.push('<ul>');\r\n\r\n                for (let i = 0; i < tItem.aChildren.length; i++) {\r\n                    this.genItemHtml(aHtml, tItem.aChildren[i], bSub);\r\n                }\r\n\r\n                aHtml.push('</ul>');\r\n            }\r\n        }\r\n        aHtml.push('</li>');\r\n    }\r\n\r\n    updatePaths() {\r\n\r\n        //  Generate unique ID's for every menu item\r\n        function genID(tItem, sPath) {\r\n\r\n            tItem._sPath = sPath;\r\n\r\n            for (let i = 0; i < tItem.aChildren.length; i++) {\r\n                genID(tItem.aChildren[i], sPath + \".\" + i.toString());\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._aMenu.length; i++) {\r\n            genID(this._aMenu[i], i.toString());\r\n        }\r\n    }\r\n\r\n    refreshMenu() {\r\n        //  Empty stub: Implemented by subclasses\r\n    }\r\n\r\n    expandItem(tItem) {\r\n        //  Empty stub: Implemented by subclasses\r\n    }\r\n\r\n    /* \r\n    Called by the designer to show a menu item. By default calls expandItem but some menu systems \r\n    override it.\r\n    \r\n    @param      tItem   The menu item struct.\r\n    @private\r\n    */\r\n    showItem(tItem) {\r\n        this.expandItem(tItem);\r\n    }\r\n\r\n    getHub() {\r\n        const oWA = this.getWebApp();\r\n\r\n        if (oWA) {\r\n            if (!oWA._oMenuHub) {\r\n                oWA._oMenuHub = new df.GroupHub();\r\n            }\r\n\r\n            return oWA._oMenuHub;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Calles itemRendered on the passed menu items (if they use custom rendering).\r\n     * \r\n     * @param {Array} aItems Menu items to be notified.\r\n     * @param {DOM element} eMnu  DOM element for the menu\r\n     */\r\n    notifyMenuRendered(aItems, eMnu) {\r\n        aItems.forEach(tItem => {\r\n            if (tItem._bCustomRender) {\r\n                tItem._oHandler.itemRendered(this.getItemElemByPath(tItem._sPath));\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\nexport class WebBaseMenu extends WebMenuProvider_mixin(WebBaseControl) {}\r\n\r\n","import { WebBaseForm } from './WebBaseForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebForm\r\nExtends:\r\n    df.WebBaseForm\r\n\r\nThis is the client-side representation of the WebForm class. It generates the HTML for the input \r\nelement and possibly a prompt button.\r\n    \r\nRevision:\r\n    2011/08/01  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n\r\n/*\r\nThis class is the implementation of the client-side part of the WebForm data entry object. It can \r\nrender itself to HTML and implements the published properties from the server. It has special prompt \r\nbutton functionality.\r\n*/\r\nexport class WebForm extends WebBaseForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbPromptButton\", false);\r\n        this.prop(df.tBool, \"pbPassword\", false);\r\n        this.prop(df.tString, \"psPlaceHolder\", \"\");\r\n        this.prop(df.tBool, \"pbAutoTab\", false);\r\n        this.prop(df.tString, \"psInputMode\", \"\");\r\n\r\n        //  Events\r\n        this.event(\"OnPrompt\", df.cCallModeWait);\r\n\r\n        // @privates\r\n        this._eWrap = null;\r\n        this._ePrompt = null;\r\n        this._bAutoTabOnUp = false;\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebForm\";\r\n        this._bJSSizing = false;\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML for input element. The input element has two wrappers for styling it \r\n    and making space for the prompt button. The HTML for the prompt button is available by default and \r\n    is made visible when needed.\r\n    \r\n    @param  aHtml   String builder array to which HTML can be added.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebFrm_Wrapper\"><span class=\"WebFrm_Prompt\"></span><div class=\"WebFrm_PromptSpacer\">',\r\n            '<input type=\"', (this.pbPassword ? 'password' : 'text'), '\"',\r\n            ' name=\"', this._sName, '\"',\r\n            ' value=\"\" id=\"', this._sControlId, '\"');\r\n\r\n        if (this.psInputMode) {\r\n            aHtml.push(' inputmode=\"', this.psInputMode, '\"');\r\n        }\r\n\r\n        aHtml.push((this.peLabelPosition != df.ciLabelFloat ? (' placeholder=\"' + df.dom.encodeAttr(this.psPlaceHolder) + '\"') : ''),\r\n            ' autocomplete=\"', df.dom.encodeAttr(this.psAutoComplete), '\"',\r\n            (!this.isEnabled() ? ' disabled=\"disabled\" tabindex=\"-1\"' : ''),\r\n            '>');\r\n    }\r\n\r\n    /*\r\n    This method generates the closing HTML closing the tags opened by the openHtml. This allows \r\n    subclasses to insert HTML inside the WebFrm_PromptSpacer div.\r\n    \r\n    @param  aHtml   String builder array to which HTML can be added.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div></div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and gets references, attaches event handlers and sets property \r\n    values.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebFrm_Wrapper input\");\r\n        this._ePrompt = df.dom.query(this._eElem, \"div.WebFrm_Wrapper span.WebFrm_Prompt\");\r\n        this._eWrap = df.dom.query(this._eElem, \"div.WebFrm_Wrapper\");\r\n\r\n        super.afterRender();\r\n\r\n        //  Attach event handlers\r\n        df.dom.on(\"click\", this._ePrompt, this.onPromptClick, this);\r\n\r\n        //  Set properties\r\n        this.set_pbPromptButton(this.pbPromptButton);\r\n    }\r\n\r\n    /*\r\n    This setter switches the field between an input type=password and a input type=text field.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbPassword(bVal) {\r\n        if (this._eControl) {\r\n            if (df.sys.isIE && df.sys.iVersion < 9) {   // For IE8 and older we need to clone the DOM element before we can switch it\r\n                const eNew = this._eControl.cloneNode(false);\r\n                eNew.type = (bVal ? 'password' : 'text');\r\n                this._eControl.parentNode.replaceChild(eNew, this._eControl);\r\n                this._eControl = eNew;\r\n            } else {  //  Modern browser support simply setting the type\r\n                this._eControl.type = (bVal ? 'password' : 'text');\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This setter sets the background color of the field. The background color is applied to the wrapper \r\n    div element.\r\n    \r\n    @param  sVal    The bew value.\r\n    @private\r\n    */\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eWrap) {\r\n            this._eWrap.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    This setter hides / shows the prompt button. That is done by removing / setting setting the \r\n    \"WebFrm_HasPrompt\" CSS class on the wrapper div element.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbPromptButton(bVal) {\r\n        if (this._eWrap && this._ePrompt) {\r\n            df.dom.toggleClass(this._eWrap, \"WebFrm_HasPrompt\", bVal);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Sets the placeholder using the HTML5 placeholder attribute (only works on IE10 and higher).\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psPlaceHolder(sVal) {\r\n        if (this._eControl && this.peLabelPosition != df.ciLabelFloat) {\r\n            this._eControl.placeholder = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Sets the inputmode HTML5 attribute.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psInputMode(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.inputMode = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method handles the onclick event of the prompt button DOM element and fires the OnPrompt event.\r\n    \r\n    @param  oEvent  The event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onPromptClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            //  Tell webapp object that we have the focus but do not give ourselve the actual focus (prevent Mobile Keyboard flashing)\r\n            this.objFocus();\r\n\r\n            if (this.firePrompt()) {\r\n                oEvent.stopPropagation();\r\n            } else {\r\n                //  If the prompt button doesn't do anything we still need to give ourself the real focus\r\n                this.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    We override this method because the form has an extra wrapper of which the Box Difference needs to \r\n    be taken into account.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eWrap);\r\n        return iResult;\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    This method augments the onKey event handler to add support for the prompt key. \r\n    \r\n    @param  oEvent  Event object.\r\n    */\r\n    onKey(oEvent) {\r\n        super.onKey(oEvent);\r\n\r\n        if (oEvent.matchKey(df.settings.formKeys.prompt)) {\r\n            if (this.firePrompt()) {      // F4:  lookup\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Fires the OnPrompt event.\r\n    \r\n    @return True if handled.\r\n    @private\r\n    */\r\n    firePrompt() {\r\n        if (this.pbPromptButton) {\r\n            return this.fire(\"OnPrompt\");\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the focus function to add text selection.\r\n    \r\n    @param  bOptSelect   If true the text will be selected.\r\n    */\r\n    focus(bOptSelect) {\r\n        if (this._bFocusAble && this.isEnabled() && this._eControl && this._eControl.focus) {\r\n            try { // FIX: Catch errors that occur in Internet Explorer 8\r\n                this._eControl.focus();\r\n\r\n                //  Select the text when bOptSelect is true\r\n                if (bOptSelect) {\r\n                    this._eControl.select();\r\n                }\r\n            } catch (oErr) {\r\n\r\n            }\r\n\r\n            this.objFocus();\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Augments the onFocus event with functionality that remembers the caret position determined by the \r\n    browser and sets it again if it has changed during the event (which might happen on masked fields).\r\n    \r\n    @param  oEvent  The event object.\r\n    @private\r\n    */\r\n    onFocus(oEvent) {\r\n        let iCarPos;\r\n\r\n        //  Determine initial values\r\n        iCarPos = df.dom.getCaretPosition(this._eControl);\r\n        const iRight = this._eControl.value.length - iCarPos;\r\n\r\n        const iSelection = df.dom.getSelectionLength(this._eControl);\r\n        const bSelectAll = iSelection >= this._eControl.value.length;\r\n\r\n        //  Perform onFocus\r\n        super.onFocus(oEvent);\r\n\r\n        //  Determine new situation\r\n        const iNewCarPos = df.dom.getCaretPosition(this._eControl);\r\n\r\n        if (iCarPos !== iNewCarPos) {\r\n            //  For numeric fields we count from the right\r\n            if (this.peDataType === df.ciTypeBCD) {\r\n                iCarPos = this._eControl.value.length - iRight;\r\n            }\r\n\r\n            // Update if changed\r\n            df.dom.setCaretPosition(this._eControl, iCarPos);\r\n\r\n        }\r\n\r\n        //  Reselect if all text was selected\r\n        if (bSelectAll) {\r\n            this._eControl.select();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Performs the autotab (focusNext) if the following conditions are met:\r\n    - Value length reached maximum field length determined by maxLength()\r\n    - There is no activate text selection\r\n    - The cursor is at the end of the field\r\n    \r\n    @return True if the autotab is performed.\r\n    @private\r\n    */\r\n    autoTab() {\r\n        const iMax = this.maxLength();\r\n        if (this._eControl.value.length == iMax) {\r\n            var oSel = df.dom.getSelection(this._eControl);\r\n            if (oSel.length == 0 && oSel.start == iMax) {\r\n                this.focusNext(true);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Handles the keypress event if pbAutoTab is true. Keypress should only trigger if the value changes \r\n    by the key event, but the value didn't update yet, so it sets _bAutoTabOnUp to true so that KeyUp \r\n    knows it should autotab.\r\n    \r\n    @param  oEv     Event object.\r\n    @private\r\n    */\r\n    onKeyPressAutoTab(oEv) {\r\n        this._bAutoTabOnUp = !this.autoTab();\r\n    }\r\n\r\n    /*\r\n    Handles the keyup event if pbAutoTab is true. If keypress ahs occurred and the value has reached \r\n    maxlength we perform the autotab (focusNext).\r\n    \r\n    @param  oEv     Event object.\r\n    @private\r\n    */\r\n    onKeyUpAutoTab(oEv) {\r\n        if (this._bAutoTabOnUp) {\r\n            this.autoTab();\r\n            this._bAutoTabOnUp = false;\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    Determines the maximum lenght of a form value based on peDataType, regional settings and optionaly psMask.\r\n    Used by pbAutoTab logic.\r\n    \r\n    @return Number of characters that can be entered.\r\n    */\r\n    maxLength() {\r\n        if (this.peDataType === df.ciTypeBCD) {   //  Plain number\r\n            return this.piMaxLength + (this.piPrecision ? this.decSep().length : 0);\r\n        } else if (this.peDataType === df.ciTypeDate) {   //  Plain date\r\n            return df.sys.data.dateToString(new Date(2020, 10, 10, 10, 10, 10, 10), this.dateFormat(), this.dateSep(), this.timeSep()).length;\r\n        } else if (this.peDataType === df.ciTypeDateTime) {   //  Plain date time\r\n            return df.sys.data.dateToString(new Date(2020, 10, 10, 10, 10, 10, 10), this.dateTimeFormat(), this.dateSep(), this.timeSep()).length;\r\n        } else if (this.peDataType === df.ciTypeTime) {   //  Plain time\r\n            return df.sys.data.dateToString(new Date(2020, 10, 10, 10, 10, 10, 10), this.timeFormat(), this.dateSep(), this.timeSep()).length;\r\n        } else {\r\n            return (this.psMask ? this.psMask.length : this.piMaxLength);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment initMask to attach autotab key listeners (in the right order).\r\n    \r\n    @private\r\n    */\r\n    initMask() {\r\n        if (this._eControl) {\r\n            df.dom.off(\"keypress\", this._eControl, this.onKeyPressAutoTab, this);\r\n            df.dom.off(\"keyup\", this._eControl, this.onKeyUpAutoTab, this);\r\n        }\r\n\r\n        super.initMask();\r\n\r\n        if (this._eControl && this.pbAutoTab) {\r\n            df.dom.on(\"keypress\", this._eControl, this.onKeyPressAutoTab, this);\r\n            df.dom.on(\"keyup\", this._eControl, this.onKeyUpAutoTab, this);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter for pbAutoTab. It triggers the initMask which will add / remove key handlers.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbAutoTab(bVal) {\r\n        if (this._eControl) {\r\n            this.pbAutoTab = bVal;\r\n            this.initMask();\r\n        }\r\n    }\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { df } from '../df.js';\r\n/* \r\nClass:\r\n    df.WebFloatingPanel\r\nExtends:\r\n    df.WebBaseContainer\r\n    \r\nA copy of the WebFloatingPanel that is extended with several features including a pePosition \r\nproperty allowing it to be positioned in multiple ways.\r\n\r\nThe WebFloatingPanel is a private class of the framework being used internally. This extended \r\nversion is a step towards making it a public class in future revisions.\r\n\r\nRevision:\r\n    2016/05/24 (HW, DAE)\r\n */\r\n\r\n//  Values for pePosition\r\ndf.fpFloatByControl = 1;\r\ndf.fpFloatLeftSqueezeWebApp = 2;\r\ndf.fpFloatLeftPushWebApp = 3;\r\ndf.fpFloatFixed = 4;\r\ndf.fpFloatAbsolute = 5;\r\n\r\nexport class WebFloatingPanel extends WebBaseContainer {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tInt, \"piWidth\", 0);\r\n        this.prop(df.tInt, \"piHeight\", 0);\r\n\r\n        this.prop(df.tInt, \"piTop\", -1);\r\n        this.prop(df.tInt, \"piLeft\", -1);\r\n        this.prop(df.tInt, \"piBottom\", -1);\r\n        this.prop(df.tInt, \"piRight\", -1);\r\n\r\n        this.prop(df.tInt, \"piContentWidth\", 0);\r\n\r\n        this.prop(df.tString, \"psFloatByControl\", \"\");\r\n        this.prop(df.tBool, \"pbHideOnBlur\", false);\r\n        this.prop(df.tBool, \"pbHideOnEscape\", false);\r\n        this.prop(df.tBool, \"pbFocusOnShow\", false);\r\n\r\n        this.prop(df.tInt, \"pePosition\", df.fpFloatByControl);\r\n        this.prop(df.tBool, \"pbShrinkIfNoSpace\", false);\r\n        this.prop(df.tBool, \"pbNaturalWidth\", false);\r\n\r\n        this.event(\"OnHide\");\r\n\r\n        this._eMask = null;\r\n\r\n        this.pbScroll = false;\r\n        this.pbVisible = false;\r\n        this._bViewVisible = false;\r\n        this._bWrapDiv = false;\r\n        this._bVisible = false; //  Keeps track of actually being visible (outside of close animation)\r\n\r\n        this._bFloating = true;\r\n        this._sControlClass = \"WebFlPnl\";\r\n    }\r\n\r\n    /* \r\n    Pre rendering initialization.\r\n    \r\n    @private\r\n    */\r\n    create() {\r\n        //  Check if we are in a view, if so we listen to its OnShow and OnHide events, else we just start it\r\n        const oView = this.getView();\r\n        if (oView) {\r\n            oView.OnAfterShow.on(this.showView, this);\r\n            oView.OnAfterHide.on(this.hideView, this);\r\n            this._bViewVisible = oView._bShown;\r\n        } else {\r\n            this._bViewVisible = true;\r\n        }\r\n\r\n        super.create();\r\n    }\r\n\r\n    /*\r\n    DF20.1 We forgot to remove the afterShow and afterHide event listener.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        const oView = this.getView();\r\n        if (oView) {\r\n            oView.OnAfterShow.off(this.showView, this);\r\n            oView.OnAfterHide.off(this.hideView, this);\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    /* \r\n    Augment the rendering and insert the element at root level. Don't return the element since the \r\n    parent shouldn't insert it.\r\n    \r\n    @private\r\n    */\r\n    render() {\r\n        const eElem = super.render();\r\n\r\n        const eParent = this.topLayer() || document.body;\r\n        eParent.appendChild(eElem);\r\n\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    Augment genClass to add extra classes depending on configuration.\r\n    \r\n    @return String with CSS classnames for outermost div (space separated).\r\n    @private\r\n    */\r\n    genClass() {\r\n        const aClasses = [super.genClass()];\r\n\r\n        if (this.pePosition === df.fpFloatByControl) {\r\n            aClasses.push('WebFP_ArrowTop');\r\n            aClasses.push('WebFP_FloatBy');\r\n        }\r\n        if (this.pePosition === df.fpFloatLeftSqueezeWebApp || this.pePosition === df.fpFloatLeftPushWebApp) {\r\n            aClasses.push(\"WebFP_FloatLeft\");\r\n        }\r\n\r\n        if (!this.pbVisible) {\r\n            aClasses.push(\"WebFP_Hidden\");\r\n        } else {\r\n            aClasses.push(\"WebFP_Visible\");\r\n        }\r\n\r\n        if (this.piContentWidth > 0) {\r\n            aClasses.push(\"WebFP_FixedContentWidth\");\r\n        }\r\n\r\n        return aClasses.join(\" \");\r\n    }\r\n\r\n    /* \r\n    Generate opening HTML.\r\n    \r\n    @param  aHtml   Stringbuilder array.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        aHtml.push('<div class=\"', this.genClass(), '\" style=\"display: none\"');\r\n        if (this.psHtmlId) {\r\n            aHtml.push(' id=\"', this.psHtmlId, '\"');\r\n        }\r\n\r\n        //  Insert the object name so the HTML element can be traced back to the right object\r\n        aHtml.push(' data-dfobj=\"', this.getLongName(), '\"');\r\n\r\n        aHtml.push(' tabindex=\"0\" style=\" ', (this.pbRender ? '' : 'display: none;'), '\"'); //'visibility: hidden;\"');\r\n        aHtml.push('>');\r\n        aHtml.push('<div tabindex=\"', (this.pbHideOnBlur ? '0' : '-1'), '\" class=\"WebFP_FocusCatcher\"></div>');\r\n        aHtml.push('<div class=\"WebContainer\">');\r\n\r\n        super.openHtml(aHtml);\r\n\r\n    }\r\n\r\n    /* \r\n    Generate closing HTML.\r\n    \r\n    @param  aHtml   Stringbuilder array.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        super.closeHtml(aHtml);\r\n        aHtml.push('</div>');\r\n        aHtml.push('<div tabindex=\"', (this.pbHideOnBlur ? '0' : '-1'), '\" class=\"WebFP_FocusCatcher\"></div>');\r\n        aHtml.push('<div class=\"WebFP_Arrow\"></div>');\r\n        aHtml.push('</div>');\r\n\r\n\r\n    }\r\n\r\n    /* \r\n    Post rendering initialization. Get references, add dom listeners and show the panel if needed.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eArrow = df.dom.query(this._eElem, \"div.WebFP_Arrow\");\r\n        this._aFocusCatchers = df.dom.query(this._eElem, \"div.WebFP_FocusCatcher\", true);\r\n\r\n        super.afterRender();\r\n\r\n        df.events.addDomCaptureListener(\"focus\", this._eElem, this.onCaptureFocus, this);\r\n        df.events.addDomCaptureListener(\"blur\", this._eElem, this.onCaptureBlur, this);\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n        df.dom.on(\"focus\", this._aFocusCatchers, this.onCatchFocus, this);\r\n\r\n        if (this.piContentWidth > 0) {\r\n            this._eSizer.style.width = this.piContentWidth + 'px';\r\n        }\r\n\r\n        if (this.pbVisible && this._bViewVisible) {\r\n            this.show();\r\n        } else {\r\n            this.positionPnl();\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /* \r\n    Shows the floating panel by changing pbVisible to true.\r\n    */\r\n    show() {\r\n\r\n        this.pbVisible = true;\r\n\r\n        this.addSync(\"pbVisible\");\r\n\r\n        if (this._bViewVisible) {\r\n            this.doShow();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Shows the panel by manipulating the DOM and making sure it gets positioned properly.\r\n    \r\n    @private\r\n    */\r\n    doShow() {\r\n        const that = this;\r\n\r\n        this._bVisible = true;\r\n        this._eElem.style.display = \"\";\r\n\r\n        //  Make sure we are the last child in the container..\r\n        if (this._eElem.parentNode.lastChild !== this._eElem) {\r\n            this._eElem.parentNode.appendChild(this._eElem);\r\n        }\r\n\r\n\r\n        //  Generate a mask to intercept clicks outside to hide the menu (mobile only)\r\n        if (this.pbHideOnBlur && df.sys.isMobile || this.pePosition === df.fpFloatLeftPushWebApp) {\r\n            if (!this._eMask) {\r\n                this._eMask = df.dom.create('<div class=\"WebMenu_Mask\">&nbsp;</div>');\r\n\r\n                this._eElem.parentNode.insertBefore(this._eMask, this._eElem);\r\n                df.dom.on(\"click\", this._eMask, this.onMaskTouch, this);\r\n            }\r\n        }\r\n\r\n        //  Add blur listener for hide on blur to the floatbycontrol\r\n        if (this.pePosition === df.fpFloatByControl) {\r\n            const oObj = this.getWebApp().findObj(this.psFloatByControl);\r\n            if (oObj && oObj._eElem) {\r\n                this._eBlurBuddy = oObj._eElem;\r\n                df.events.addDomCaptureListener(\"blur\", oObj._eElem, this.onCaptureBlur, this);\r\n            }\r\n        }\r\n\r\n        //this._eElem.style.visibility = \"\";\r\n\r\n        this.positionPnl();\r\n\r\n        this.afterShow();\r\n\r\n        if (this._tHideBlurTimeout) {\r\n            // df.debug(\"Bur timeout cleared because of show\");\r\n            clearTimeout(this._tHideBlurTimeout);\r\n            this._tHideBlurTimeout = null;\r\n        }\r\n\r\n\r\n        df.dom.removeClass(that._eElem, \"WebFP_Hidden\");\r\n        df.dom.addClass(that._eElem, \"WebFP_Visible\");\r\n\r\n        setTimeout(function () {\r\n            if (that._eElem) {\r\n                that.positionPnl();\r\n                if (that.pbFocusOnShow) {\r\n                    if (!that.focus()) {\r\n                        that._eElem.focus();\r\n                    }\r\n                }\r\n            }\r\n        }, 20);\r\n\r\n        if (this.pePosition === df.fpFloatByControl) {\r\n            this._tPositionInterval = setInterval(function () {\r\n                that.positionPnl();\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n\r\n    getFloatByRefElem() {\r\n        let eRef = null;\r\n\r\n        const oObj = this.getWebApp().findObj(this.psFloatByControl);\r\n\r\n        if (oObj) {\r\n            eRef = oObj._eElem;\r\n            if (oObj.getTooltipElem) {\r\n                eRef = oObj.getTooltipElem() || eRef;\r\n            }\r\n        }\r\n\r\n        return eRef;\r\n    }\r\n\r\n\r\n    /* \r\n    Main positioning logic of the floating panel. Called on resize and on events like showing and \r\n    hiding.\r\n    */\r\n    positionPnl() {\r\n        let oRect, iTop = 0, iLeft = 0, iRight = -1, iArrow = 0, iHeight, iActualHeight, bTop = true;\r\n\r\n        if (this._bVisible && this._eElem) {\r\n            const oWebApp = this.getWebApp();\r\n\r\n            let iWidth = this.piWidth;\r\n            iHeight = this.piHeight;\r\n\r\n            const iScreenWidth = df.dom.windowWidth();\r\n            const iScreenHeight = df.dom.windowHeight();\r\n\r\n            //  Determine height to work with\r\n            iActualHeight = this._eElem.offsetHeight;\r\n            if (iHeight > iActualHeight) {\r\n                iActualHeight = iHeight;\r\n\r\n            }\r\n\r\n            const iActualWidth = this._eElem.offsetWidth;\r\n\r\n            if (this.pePosition === df.fpFloatByControl) {\r\n                if (this.psFloatByControl) {  //  Position relative to a control (usually below the control)\r\n                    const eRef = this.getFloatByRefElem();\r\n\r\n                    if (eRef) {\r\n                        const oRect = df.sys.gui.getBoundRect(eRef);\r\n\r\n                        if (iWidth <= 0 && !this.pbNaturalWidth) {\r\n                            iWidth = oRect.width;\r\n                        }\r\n\r\n                        iTop = oRect.bottom;\r\n                        // df.debug(\"oRect.left:\" + oRect.left + \" oRect.width:\" + oRect.width + \" this.piWidth:\" + this.piWidth);\r\n                        iLeft = oRect.left + (oRect.width / 2) - ((this.pbNaturalWidth ? iActualWidth : iWidth) / 2);\r\n\r\n                        if (iLeft < 5) {\r\n                            iLeft = 5;\r\n                        }\r\n\r\n                        //  Position Arrow\r\n                        iArrow = oRect.left + oRect.width / 2 - iLeft;\r\n\r\n                        if (!oRect.top && !oRect.left && !oRect.width && !oRect.height) {\r\n                            return;\r\n                        }\r\n                    } else {\r\n                        iTop = this.piTop;\r\n                        iLeft = this.piLeft;\r\n                    }\r\n\r\n\r\n                }\r\n\r\n\r\n                if (iWidth > (iScreenWidth - 20)) {\r\n                    iWidth = iScreenWidth - 20;\r\n                }\r\n\r\n                if (iLeft + iWidth > iScreenWidth) {\r\n                    iLeft = -1;\r\n                    iRight = 10;\r\n\r\n                    //  Position Arrow\r\n                    iArrow = iWidth - ((iScreenWidth - oRect.right) + oRect.width / 2 - iRight);\r\n                }\r\n\r\n                if (iTop + iActualHeight > iScreenHeight) {\r\n                    if (!this.pbShrinkIfNoSpace) {\r\n                        if (oRect) {\r\n                            iTop = Math.max(0, oRect.top - iActualHeight);\r\n                            bTop = false;\r\n                        }\r\n                    }\r\n\r\n                    if (iTop + iHeight > iScreenHeight) {\r\n                        if (iHeight > 0) {\r\n                            iHeight = iScreenHeight - iTop - 30;\r\n                            //(iScreenHeight - iTop > 0 ? iScreenHeight - iTop : 0);\r\n                        } else {\r\n                            iTop = (iScreenHeight - iHeight > 0 ? iScreenHeight - iHeight : 0);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this._eElem.style.top = iTop + \"px\";\r\n\r\n                this._eElem.style.left = (iLeft >= 0 ? iLeft + \"px\" : \"\");\r\n                this._eElem.style.right = (iRight >= 0 ? iRight + \"px\" : \"\");\r\n\r\n                this._eArrow.style.left = iArrow + \"px\";\r\n\r\n                this.setOuterWidth(iWidth);\r\n                if (iHeight > 0) {\r\n                    this._eContainer.style.height = iHeight + \"px\";\r\n                    this._eElem.style.maxHeight = \"\";\r\n                } else {\r\n                    iHeight = iScreenHeight - iTop - 30;// - this.getHeightDiff(true, false, false, false);\r\n                    this._eContainer.style.height = \"\";\r\n                    this._eElem.style.maxHeight = iHeight + \"px\";\r\n                }\r\n\r\n                df.dom.toggleClass(this._eElem, \"WebFP_ArrowTop\", bTop);\r\n                df.dom.toggleClass(this._eElem, \"WebFP_ArrowBottom\", !bTop);\r\n            }\r\n\r\n            if (this.pePosition === df.fpFloatLeftSqueezeWebApp || this.pePosition === df.fpFloatLeftPushWebApp) {\r\n                this._eElem.style.top = (df.Designer ? \"17px\" : \"0px\");\r\n                this._eElem.style.left = \"0px\";\r\n                this._eElem.style.bottom = \"0px\";\r\n                this._eElem.style.position = \"fixed\";\r\n                this._eContainer.style.height = \"100%\";\r\n\r\n                this.setOuterWidth(this.pbVisible && this.pbRender ? this.piWidth : 0);\r\n                if (oWebApp && oWebApp._eElem) {\r\n                    if (this.pePosition === df.fpFloatLeftSqueezeWebApp) {\r\n                        oWebApp._eElem.style.marginLeft = (this.pbVisible && this.pbRender ? this.piWidth : 0) + \"px\";\r\n                    } else {\r\n                        oWebApp._eElem.parentNode.style.overflow = \"hidden\"; // This could cause trouble (works for trucks!)\r\n                        oWebApp._eElem.style.transform = \"translateX(\" + (this.pbVisible && this.pbRender ? this.piWidth : 0) + \"px)\";\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (this.pePosition === df.fpFloatFixed) {\r\n                this._eElem.style.top = (this.piTop >= 0 ? this.piTop + \"px\" : \"\");\r\n                this._eElem.style.left = (this.piLeft >= 0 ? this.piLeft + \"px\" : \"\");\r\n                this._eElem.style.bottom = (this.piBottom >= 0 ? this.piBottom + \"px\" : \"\");\r\n                this._eElem.style.right = (this.piRight >= 0 ? this.piRight + \"px\" : \"\");\r\n\r\n                if (iWidth >= 0) {\r\n                    if (this.pbShrinkIfNoSpace && ((iWidth + Math.max(this.piLeft, 0) + Math.max(this.piRight, 0)) > iScreenWidth)) {\r\n                        iWidth = iScreenWidth - Math.max(this.piLeft, 0) - Math.max(this.piRight, 0);\r\n                    }\r\n\r\n                    this.setOuterWidth(iWidth);\r\n                }\r\n\r\n                if (iHeight >= 0 || (this.piBottom >= 0 && this.piTop >= 0)) {\r\n                    this._eContainer.style.height = \"100%\";\r\n                }\r\n\r\n                if (iHeight >= 0) {\r\n                    if (this.pbShrinkIfNoSpace && ((iHeight + Math.max(this.piTop, 0) + Math.max(this.piBottom, 0)) > iScreenHeight)) {\r\n                        iHeight = iScreenHeight - Math.max(this.piTop, 0) - Math.max(this.piBottom, 0);\r\n                    }\r\n\r\n                    this._eElem.style.height = iHeight + \"px\";\r\n                    this._eElem.style.maxHeight = \"\";\r\n                }\r\n            }\r\n        } else {\r\n            //  If not visible we reset all sizing properties so the first resize on show goes in clean\r\n            if (this._eElem) {\r\n                this._eElem.style.top = \"0px\";\r\n                this._eElem.style.left = \"0px\";\r\n                this._eElem.style.bottom = \"\";\r\n                this._eElem.style.right = \"\";\r\n                this._eElem.style.height = \"\";\r\n                this._eElem.style.maxHeight = \"\";\r\n            }\r\n        }\r\n\r\n        //  Call standard resize procedures\r\n        this.resizeHorizontal();\r\n        super.resizeVertical(); //  Directly call super to prevent recursive loop\r\n\r\n    }\r\n\r\n    /* \r\n    Augment setInnerHeight to make sure the container element size is leading.\r\n    \r\n    @param  iHeight The height to apply.\r\n    @private\r\n    */\r\n    setInnerHeight(iHeight) {\r\n        //  ToDo: This is probably not the best way of doing this as the case where a scrollbar would actually be needed might be ruined by this\r\n        if (iHeight > df.dom.clientHeight(this._eContainer)) {\r\n            iHeight = df.dom.clientHeight(this._eContainer);\r\n        }\r\n\r\n        super.setInnerHeight(iHeight);\r\n\r\n    }\r\n\r\n    /* \r\n    Augment setter of piHeight and reposition panel.\r\n    \r\n    @param  iVal    New value.\r\n    */\r\n    set_piHeight(iVal) {\r\n        super.set_piHeight(iVal);\r\n\r\n        if (this._eElem) {\r\n            this.piHeight = iVal;\r\n\r\n            this.positionPnl();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates the width of the floating panel.\r\n    \r\n    @param  iVal    New value.\r\n    */\r\n    set_piWidth(iVal) {\r\n        const oWebApp = this.getWebApp();\r\n\r\n        if (this._eElem) {\r\n            this.setOuterWidth(iVal);\r\n\r\n            if (this.pePosition === df.fpFloatLeftSqueezeWebApp) {\r\n                if (this.pbVisible && this.pbRender && oWebApp && oWebApp._eElem) {\r\n                    oWebApp._eElem.style.marginLeft = iVal + \"px\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides / shows the panel responding to pbVisible.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbVisible(bVal) {\r\n        if (this._eElem && this.pbVisible !== bVal) {\r\n            if (bVal) {\r\n                this.show();\r\n            } else {\r\n                this.hide(false, \"manual\");\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides / shows the panel if the combination of pbRender and pbVisible are true.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbRender(bVal) {\r\n        if (this._eElem && this.pbRender !== bVal) {\r\n            super.set_pbRender(bVal);\r\n\r\n            this.pbRender = bVal;\r\n\r\n            if (bVal && this.pbVisible) {\r\n                this.show();\r\n            } else {\r\n                this.hide(false, \"manual\");\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    Updates the way the floating panel is positioned.\r\n    \r\n    @param  iVal    New positioning mode.\r\n    */\r\n    set_pePosition(iVal) {\r\n        \r\n        if (this._eElem && this.pePosition !== iVal) {\r\n\r\n            const oWebApp = this.getWebApp();\r\n\r\n            if (oWebApp && oWebApp._eElem) {\r\n                if (iVal !== df.fpFloatLeftSqueezeWebApp && this.pePosition === df.fpFloatLeftSqueezeWebApp) {\r\n                    oWebApp._eElem.style.marginLeft = \"\";\r\n                }\r\n\r\n                if (iVal !== df.fpFloatLeftPushWebApp && this.pePosition === df.fpFloatLeftPushWebApp) {\r\n                    oWebApp._eElem.parentNode.style.overflow = \"\"; // This could cause trouble (works for trucks!)\r\n                    oWebApp._eElem.style.transform = \"\";\r\n\r\n                    if (this._eMask) {\r\n                        df.dom.off(\"click\", this._eMask, this.onMaskTouch, this);\r\n                        this._eMask.parentNode.removeChild(this._eMask);\r\n                        this._eMask = null;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.pePosition = iVal;\r\n\r\n            this.positionPnl();\r\n        }\r\n    }\r\n\r\n    set_piContentWidth(iVal) {\r\n        if (this._eContainer) {\r\n            this._eSizer.style.width = iVal + \"px\";\r\n            df.dom.toggleClass(this._eElem, \"WebFP_FixedContentWidth\", iVal > 0);\r\n        }\r\n    }\r\n\r\n    set_pbHideOnBlur(bVal) {\r\n        if (this._aFocusCatchers) {\r\n            this._aFocusCatchers.forEach(function (eEl) {\r\n                df.dom.setTabIndex(eEl, (bVal ? 0 : -1));\r\n            });\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides the panel by setting pbVisible to false.\r\n    \r\n    @param  bNoPos  If true the panel is not repositioned before hiding.\r\n    */\r\n    hide(bNoPos, sReason) {\r\n        this.pbVisible = false;\r\n\r\n        this.addSync(\"pbVisible\");\r\n\r\n        this.doHide(bNoPos, sReason || \"manual\");\r\n    }\r\n\r\n    /* \r\n    Hides the panel by manipulating the DOM.\r\n    \r\n    @param  bNoPos  If true the panel is not repositioned before hiding.\r\n    @private\r\n    */\r\n    doHide(bNoPos, sReason) {\r\n        const that = this, oWebApp = this.getWebApp();\r\n\r\n        if (this._tPositionInterval) {\r\n            clearInterval(this._tPositionInterval);\r\n            this._tPositionInterval = null;\r\n        }\r\n\r\n\r\n        df.dom.addClass(that._eElem, \"WebFP_Hidden\");\r\n        df.dom.removeClass(that._eElem, \"WebFP_Visible\");\r\n\r\n        if (!bNoPos) {\r\n            this.positionPnl();\r\n        }\r\n\r\n        this.afterHide();\r\n\r\n        //  Remove mobile mask that might have been created\r\n        if (this._eMask) {\r\n            df.dom.off(\"click\", this._eMask, this.onMaskTouch, this);\r\n            this._eMask.parentNode.removeChild(this._eMask);\r\n            this._eMask = null;\r\n        }\r\n\r\n        //  Detach blur listener from floatby control\r\n        if (this._eBlurBuddy) {\r\n            df.events.removeDomCaptureListener(\"blur\", this._eBlurBuddy, this.onCaptureBlur, this);\r\n        }\r\n\r\n        if (this.pePosition === df.fpFloatLeftSqueezeWebApp) {\r\n            if (oWebApp && oWebApp._eElem) {\r\n                oWebApp._eElem.style.marginLeft = \"0px\";\r\n            }\r\n        }\r\n\r\n        this.fire(\"OnHide\", [sReason]);\r\n\r\n        setTimeout(function () {\r\n            if (!that.pbVisible && that._eElem) {\r\n                that._eElem.style.display = \"none\";\r\n                that._bVisible = false;\r\n            }\r\n\r\n        }, 1500);\r\n\r\n    }\r\n\r\n\r\n    /* \r\n    Handles the OnShow event of the view and makes sure the floating panel is displayed if it should.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    showView(oEvent) {\r\n        this._bViewVisible = true;\r\n\r\n        if (this.pbVisible && this._eElem) {\r\n            this.doShow();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the OnHide event of the view and makes sure the panel is hidden.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n     */\r\n    hideView(oEvent) {\r\n        this._bViewVisible = false;\r\n\r\n        if (this.pbVisible) {\r\n            this.doHide(true, \"auto_view\");\r\n        }\r\n    }\r\n\r\n    /* \r\n    Captures the focus event so we know the focus is inside the floating panel.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onCaptureFocus(oEvent) {\r\n        if (this._tHideBlurTimeout) {\r\n            clearTimeout(this._tHideBlurTimeout);\r\n            this._tHideBlurTimeout = null;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Captures the blur event so we know the focus is changing and unless we get a focus event soon we \r\n    know we lost the focus and hide if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onCaptureBlur(oEvent) {\r\n        const that = this;\r\n\r\n        if (this._tHideBlurTimeout) {\r\n            clearTimeout(this._tHideBlurTimeout);\r\n        }\r\n\r\n        this._tHideBlurTimeout = setTimeout(function () {\r\n            if (that.pbHideOnBlur) {\r\n                that.hide(true, \"auto_blur\");\r\n            }\r\n            that._tHideBlurTimeout = null;\r\n\r\n        }, 150);\r\n    }\r\n\r\n\r\n    /* \r\n    Handles the click on the mask behind the floating panel and hides the panel.\r\n    \r\n    @param  oEvent  See df.events.DOMEvent.\r\n    @private\r\n    */\r\n    onMaskTouch(oEvent) {\r\n        if (this.pbHideOnBlur) {\r\n            this.hide(false, \"auto_blur\");\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment the vertical resize and reposition the panel.\r\n    \r\n    @private\r\n    */\r\n    resizeVertical() {\r\n        this.positionPnl();\r\n        super.resizeVertical();\r\n    }\r\n\r\n    /* \r\n    Implement resize and reposition the panel.\r\n    \r\n    @private\r\n    */\r\n    resize() {\r\n        if (this._eElem) {\r\n            this.positionPnl();\r\n        }\r\n    }\r\n\r\n    onKey(oEv) {\r\n        if (oEv.matchKey(df.settings.calendarKeys.close) && this._bVisible) {\r\n            this.hide(true, \"auto_escape\");\r\n            oEv.stop();\r\n        }\r\n    }\r\n\r\n    onCatchFocus(oEv) {\r\n        if (this.pbHideOnBlur) {\r\n            this.hide(false, \"auto_tabout\");\r\n        }\r\n    }\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebDatePicker\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis is the client-side representation of the cWebDatePicker class. It renders a datepicker control \r\ndirectly into the form. This datepicker will behave like a data entry object and display its value \r\nby highlighting the date it in the datepicker. The datepicker is rendered by the df.DatePicker \r\nclass which is instantiated as sub object (_oPicker).\r\n\r\nRevision:\r\n    2012/04/02  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebDatePicker extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbShowWeekNr\", true);\r\n        this.prop(df.tBool, \"pbShowToday\", true);\r\n        this.prop(df.tInt, \"piStartWeekAt\", 1);\r\n\r\n        this.event(\"OnDateClick\", df.cCallModeWait);\r\n\r\n\r\n        //  Client-side only event triggering at real time while the value changes\r\n        this.OnRealtimeChange = new df.events.JSHandler();\r\n        //  Triggered on enter\r\n        this.OnEnter = new df.events.JSHandler();\r\n\r\n        //  @privates\r\n        this._eBuddy = null;\r\n        this._bBuddyActive = true;\r\n        this._eElem = null;\r\n        this._eFocus = null;\r\n        this._eBody = null;\r\n        this._eDispMonth = null;\r\n        this._eDispYear = null;\r\n\r\n        this._dSelected = new Date();\r\n        this._iWeekSelected = df.sys.data.dateToWeek(this._dSelected);\r\n        this._iDisplayYear = this._dSelected.getFullYear();\r\n        this._iDisplayMonth = this._dSelected.getMonth();\r\n        this._iLastDisplayYear = this._iDisplayYear;\r\n        this._iLastDisplayMonth = this._iDisplayMonth;\r\n\r\n        //  Translations\r\n        this._aMonthNames = df.lang.monthsLong;\r\n        this._aMonthNamesShort = df.lang.monthsShort;\r\n        this._aDaysShort = df.lang.daysShort;\r\n        this._aDaysLong = df.lang.daysLong;\r\n\r\n        this._sControlClass = \"WebDatePicker\";\r\n\r\n        this.peDataType = df.ciTypeDate;\r\n    }\r\n\r\n    // - - - Control API - - -\r\n\r\n    create() {\r\n        const oWA = this.getWebApp();\r\n        if (!this.psMask) {\r\n            if (oWA) {\r\n                this.psMask = oWA.psDateFormat;\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method forwards the open html call to the date picker object. It inserts html for the anchor \r\n    element that will keep the focus.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n\r\n\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebDatePicker_FocusHolder\" ', (!this.isEnabled() ? 'tabindex=\"-1\"' : 'tabindex=\"0\"'), '>');\r\n\r\n        aHtml.push(\r\n            '<div class=\"WebDP\">',\r\n            '<div class=\"WebDP_Wrp\">',\r\n            '<div class=\"WebDP_Head\">',\r\n            '<div class=\"WebDP_BtnPrev\"><span></span></div>',\r\n            '<div class=\"WebDP_BtnNext\"><span></span></div>',\r\n            '<div class=\"WebDP_BtnYear\"><span></span><div class=\"WebDP_YearMnu\"></div></div>',\r\n            '<div class=\"WebDP_BtnMonth\"><span></span><div class=\"WebDP_MonthMnu\"></div></div>',\r\n            '<div style=\"clear: both;\"></div>',\r\n            '</div>',\r\n            '<div class=\"WebDP_Body\">'\r\n        );\r\n    }\r\n\r\n    /*\r\n    This method forwards the closing html call to the date picker object.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push(\r\n            '</div>'\r\n        );\r\n        aHtml.push(\r\n            '<div class=\"WebDP_Footer\"', (!this.pbShowToday ? ' style=\"display: none\"' : ''), '>',\r\n            '<div class=\"WebDP_BtnToday\">', this.getWebApp().getTrans(\"todayIs\"), ' <span></span></div>',\r\n            '</div>'\r\n        );\r\n\r\n        aHtml.push(\r\n            '</div>',\r\n            '</div>'\r\n        );\r\n\r\n        super.closeHtml(aHtml);\r\n\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    /*\r\n    This method forwards the after rendering call to the date picker object. It gets references to DOM\r\n    elements and attach event handlers.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get reference to wrapper and focus elements\r\n        this._eFocus = df.dom.query(this._eElem, \"div.WebDatePicker_FocusHolder\");\r\n        this._eBody = df.dom.query(this._eElem, \"div.WebDP_Body\");\r\n        this._eFooter = df.dom.query(this._eElem, \"div.WebDP_Footer\");\r\n        this._eDispMonth = df.dom.query(this._eElem, \"div.WebDP_BtnMonth > span\");\r\n        this._eDispYear = df.dom.query(this._eElem, \"div.WebDP_BtnYear > span\");\r\n        this._eDispToday = df.dom.query(this._eElem, \"div.WebDP_BtnToday > span\");\r\n\r\n\r\n        super.afterRender();\r\n\r\n\r\n        //  Add DOM listeners\r\n        df.dom.on(\"click\", this._eElem, this.onWrapClick, this);\r\n        df.dom.on(\"click\", this._eBody, this.onBodyClick, this);\r\n        df.dom.on(\"click\", df.dom.query(this._eElem, \"div.WebDP_BtnNext\"), this.onNextClick, this);\r\n        df.dom.on(\"click\", df.dom.query(this._eElem, \"div.WebDP_BtnPrev\"), this.onPrevClick, this);\r\n        df.dom.on(\"click\", df.dom.query(this._eElem, \"div.WebDP_BtnMonth\"), this.onMonthClick, this);\r\n        df.dom.on(\"click\", df.dom.query(this._eElem, \"div.WebDP_BtnYear\"), this.onYearClick, this);\r\n        df.dom.on(\"click\", df.dom.query(this._eElem, \"div.WebDP_BtnToday\"), this.onTodayClick, this);\r\n\r\n\r\n        if (this._eBuddy) {\r\n            this._eFocus = this._eBuddy;\r\n        }\r\n        df.events.addDomKeyListener(this._eFocus, this.onKey, this);\r\n        df.dom.on(\"focus\", this._eFocus, this.onFocus, this);\r\n        df.dom.on(\"blur\", this._eFocus, this.onBlur, this);\r\n\r\n        this.update();\r\n    }\r\n\r\n    // - - - Server API - - - \r\n    set_pbShowWeekNr(bVal) {\r\n        this.pbShowWeekNr = bVal;\r\n\r\n        this.displayCalendar();\r\n    }\r\n\r\n    set_pbShowToday(bVal) {\r\n        if (this._eFooter) {\r\n            this._eFooter.style.display = (bVal ? \"\" : \"none\");\r\n        }\r\n    }\r\n\r\n    set_piStartWeekAt(iVal) {\r\n        this.piStartWeekAt = iVal;\r\n\r\n        this.update();\r\n    }\r\n    // - - - Implementation - - -\r\n\r\n    /*\r\n    This method updates the display according to the current settings. It calls displayCalendar to \r\n    re-render the calendar and it updates the year, month and today date in the header and footer.\r\n    \r\n    @private\r\n    */\r\n    update() {\r\n        if (this._eElem) {\r\n            //  Update displayed month & year\r\n            df.dom.setText(this._eDispMonth, this._aMonthNames[this._iDisplayMonth]);\r\n            df.dom.setText(this._eDispYear, this._iDisplayYear);\r\n            df.dom.setText(this._eDispToday, df.sys.data.applyDateMask((new Date()), this.psMask, this.getWebApp().psDateSeparator));\r\n\r\n            this.displayCalendar();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method renders the actual calendar. It will generate the HTML of the calendar table using the \r\n    JavaScript Date object to determine the dates. If the month has changed it will add the new table to \r\n    the DOM and set the CSS classes so that the change can be animated using CSS3 transitions. If the \r\n    newly generated month is the same as the previous month it simply replaces the content of the body \r\n    element to display the newly generated month.\r\n    \r\n    @private\r\n    */\r\n    displayCalendar() {\r\n        let iDayPointer, sCSS, iRows;\r\n        const aHtml = [];\r\n\r\n        if (!this._eBody) {\r\n            return;\r\n        }\r\n\r\n        aHtml.push('<div><table>');\r\n\r\n        //  Generate dates\r\n        const iYear = this._iDisplayYear;\r\n        const iMonth = this._iDisplayMonth;\r\n\r\n        const dToday = new Date();\r\n        const dDate = new Date(iYear, iMonth, 1, 1, 1, 1);\r\n        const dEnd = new Date(iYear, (iMonth + 1), 1, 1, 1, 1);\r\n\r\n        //  Header\r\n        aHtml.push('<tr class=\"WebDP_BodyHead\">');\r\n        if (this.pbShowWeekNr) {\r\n            aHtml.push('<th class=\"WebDP_WeekNr\">', this.getWebApp().getTrans(\"wk\"), '</th>');\r\n        }\r\n        for (let iDay = 0; iDay < 7; iDay++) {\r\n            sCSS = \"\";\r\n\r\n            iDayPointer = (iDay + this.piStartWeekAt > 6 ? iDay + this.piStartWeekAt - 7 : iDay + this.piStartWeekAt);\r\n            if (iDayPointer === 0 || iDayPointer === 6) {\r\n                sCSS = \"WebDP_Weekend\";\r\n            }\r\n\r\n            aHtml.push('<th class=\"', sCSS, '\">', this.getDay(iDay, true), '</th>');\r\n        }\r\n        aHtml.push('</tr>');\r\n\r\n        //  Calculate start date\r\n        iDayPointer = dDate.getDay() - this.piStartWeekAt;\r\n        if (iDayPointer < 0) {\r\n            iDayPointer = 7 + iDayPointer;\r\n        }\r\n        dDate.setDate(dDate.getDate() - iDayPointer);\r\n        iDayPointer = 0;\r\n        iRows = 0;\r\n\r\n\r\n        //  Loop through the days\r\n        aHtml.push('<tr>');\r\n\r\n        while (dDate < dEnd || (iDayPointer < 7 && iDayPointer !== 0) || iRows < 6) {\r\n\r\n\r\n            //  Add weeknr & correct daypointer if needed\r\n            if (iDayPointer === 0 || iDayPointer > 6) {\r\n                if (iRows > 0) {\r\n                    aHtml.push('</tr><tr>');\r\n                }\r\n\r\n                iRows++;\r\n                if (this.pbShowWeekNr) {\r\n                    aHtml.push('<td class=\"WebDP_WeekNr\">', df.sys.data.dateToWeek(dDate), '</td>');\r\n                }\r\n                iDayPointer = 0;\r\n            }\r\n\r\n            //  Determine styles\r\n            sCSS = \"WebDP_Day\";\r\n            if (dDate.getMonth() !== iMonth) {\r\n                sCSS += (sCSS !== \"\" ? \" \" : \"\") + \"WebDP_Overflow\";\r\n            }\r\n            if (dDate.getDay() === 0 || dDate.getDay() === 6) {\r\n                sCSS += (sCSS !== \"\" ? \" \" : \"\") + \"WebDP_Weekend\";\r\n            }\r\n            if (dDate.getDate() === this._dSelected.getDate() && dDate.getMonth() === this._dSelected.getMonth() && dDate.getFullYear() === this._dSelected.getFullYear()) {\r\n                sCSS += (sCSS !== \"\" ? \" \" : \"\") + \"WebDP_Selected\" + (this.bHasFocus ? \" focussed\" : \"\");\r\n            }\r\n            if (dDate.getDate() === dToday.getDate() && dDate.getMonth() === dToday.getMonth() && dDate.getFullYear() === dToday.getFullYear()) {\r\n                sCSS += (sCSS !== \"\" ? \" \" : \"\") + \"WebDP_Today\";\r\n            }\r\n\r\n            //  Generate day cell\r\n            aHtml.push('<td class=\"', sCSS, '\" data-date=\"', dDate.getDate(), '\" data-month=\"', dDate.getMonth(), '\" data-year=\"', dDate.getFullYear(), '\">', dDate.getDate(), '</td>');\r\n\r\n            //  Move to the next day\r\n            dDate.setDate(dDate.getDate() + 1);\r\n            iDayPointer++;\r\n        }\r\n\r\n        aHtml.push('</table></div>');\r\n\r\n        //  Only use animation when moving to different month\r\n        if (this._iLastDisplayYear === this._iDisplayYear && this._iLastDisplayMonth === this._iDisplayMonth) {\r\n            this._eBody.innerHTML = aHtml.join('');\r\n        } else {\r\n\r\n            //  Clean old month\r\n            let eOld = df.dom.query(this._eBody, \".WebDP_Old\");\r\n            if (eOld) {\r\n                this._eBody.removeChild(eOld);\r\n            }\r\n\r\n            //  Create new month\r\n            const eNew = df.dom.create(aHtml.join(''));\r\n            eOld = this._eBody.firstChild;\r\n\r\n            if (eOld) {\r\n                //  Fix dimensions for animation\r\n                eOld.firstChild.style.width = eOld.firstChild.clientWidth + \"px\";\r\n                eOld.firstChild.style.height = eOld.firstChild.clientHeight + \"px\";\r\n\r\n                //  Set animation initial class\r\n                df.dom.addClass(eOld, \"WebDP_Old\");\r\n            }\r\n            //  Add new month\r\n            this._eBody.appendChild(eNew);\r\n            //  Set animation target class\r\n            if (eOld) {\r\n                df.dom.addClass(eOld, ((this._iLastDisplayYear < this._iDisplayYear || (this._iLastDisplayYear === this._iDisplayYear && this._iLastDisplayMonth < this._iDisplayMonth)) ? \"WebDP_HideNext\" : \"WebDP_HidePrev\"));\r\n            }\r\n        }\r\n\r\n        this._iLastDisplayYear = this._iDisplayYear;\r\n        this._iLastDisplayMonth = this._iDisplayMonth;\r\n    }\r\n\r\n    /*\r\n    Change the currently selected date. The calendar will be refreshed with this new date.\r\n    \r\n    @param  dSelected           Date object representing the new selected date.\r\n    @param  bOptNoAni           (optional) If true no animation will shown.\r\n    @param  bOptNoDisplayNow    (optional) If true it will not go to the displayed month but stay on the \r\n                                currently displayed date.\r\n    \r\n    */\r\n    setSelectedDate(dSelected, bOptNoAni, bOptNoDisplayNow) {\r\n        //  There is always a date selected!\r\n        if (!dSelected) {\r\n            dSelected = new Date();\r\n            this.fireRTChange();\r\n        }\r\n\r\n        //  Remember selected date\r\n        this._dSelected = dSelected;\r\n        this._iWeekSelected = df.sys.data.dateToWeek(this._dSelected);\r\n\r\n        if (!bOptNoDisplayNow) {\r\n            this._iDisplayYear = this._dSelected.getFullYear();\r\n            this._iDisplayMonth = this._dSelected.getMonth();\r\n\r\n            if (bOptNoAni) {\r\n                //  Als set the last displayed so we don't get the animation\r\n                this._iLastDisplayYear = this._iDisplayYear;\r\n                this._iLastDisplayMonth = this._iDisplayMonth;\r\n            }\r\n        }\r\n\r\n        this.update();\r\n    }\r\n\r\n    /*\r\n    @return The currently selected date (as Date object).\r\n    */\r\n    getSelectedDate() {\r\n        return new Date(this._dSelected.valueOf());\r\n    }\r\n\r\n    /*\r\n    Translates a weekday number into the textual description. It takes the piStartWeekAt into account. \r\n    Can return the long description and the short description.\r\n    \r\n    @param  iDay    Day of the week.\r\n    @param  bShort  If true the short translation is returned.\r\n    @return The name of the day ('Mon' or 'Monday').\r\n    @private\r\n    */\r\n    getDay(iDay, bShort) {\r\n        iDay += this.piStartWeekAt;\r\n        if (iDay > 6) {\r\n            iDay = iDay - 7;\r\n        }\r\n\r\n        return (bShort ? this._aDaysShort[iDay] : this._aDaysLong[iDay]);\r\n    }\r\n\r\n    /*\r\n    This method handles the onClick event of the year pull down button. It will generate the month menu \r\n    and has internal event handlers for hiding the menu and selecting the month. \r\n    \r\n    @param  oEvent  The event object.\r\n    @private\r\n    */\r\n    onMonthClick(oEvent) {\r\n        let tMenuTimeout, hide;\r\n        const aHtml = [], that = this;\r\n\r\n        const eMenu = df.dom.query(this._eElem, \"div.WebDP_MonthMnu\");\r\n\r\n        //  Handles the onclick which selects the month\r\n        function onClick(oEvent) {\r\n            var eLI = oEvent.getTarget();\r\n\r\n            if (eLI.getAttribute('data-month')) {\r\n                this._iDisplayMonth = parseInt(eLI.getAttribute('data-month'), 10);\r\n\r\n                hide();\r\n                this.update();\r\n                this.focus();\r\n\r\n                oEvent.stop();\r\n            }\r\n        }\r\n\r\n        //  Clears the hide timeout when hovering the menu\r\n        function onOver(oEvent) {\r\n            clearTimeout(tMenuTimeout);\r\n        }\r\n\r\n        //  Sets the hide timeout when leaving the menu\r\n        function onOut(oEvent) {\r\n            clearTimeout(tMenuTimeout);\r\n            tMenuTimeout = setTimeout(hide, 1200);\r\n        }\r\n\r\n        //  Hides the menu \r\n        hide = function hide() {\r\n            //  Clear event listeners\r\n            df.dom.off(\"click\", eMenu, onClick, this);\r\n            df.dom.off(\"mouseover\", eMenu, onOver, this);\r\n            df.dom.off(\"mouseout\", eMenu, onOut, this);\r\n\r\n            eMenu.style.display = \"none\";\r\n\r\n            clearTimeout(tMenuTimeout);\r\n            that._fMonthHide = null;\r\n        };\r\n\r\n        if (this._fMonthHide) {\r\n            this._fMonthHide();\r\n        } else {\r\n            if (this.isEnabled()) {\r\n                this._fMonthHide = hide;\r\n\r\n                //  Attach event listeners\r\n                df.dom.on(\"click\", eMenu, onClick, this);\r\n                df.dom.on(\"mouseover\", eMenu, onOver, this);\r\n                df.dom.on(\"mouseout\", eMenu, onOut, this);\r\n\r\n                //  Generate menu\r\n                aHtml.push('<ul>');\r\n                for (let i = 0; i < 12; i++) {\r\n                    const sCSS = (i === this._iDisplayMonth ? \"WebDP_Current\" : \"\");\r\n\r\n                    aHtml.push('<li data-month=\"', i, '\" class=\"', sCSS, '\">', this._aMonthNames[i], '</li>');\r\n                }\r\n                aHtml.push('</ul');\r\n\r\n                //  Display menu\r\n                eMenu.innerHTML = aHtml.join('');\r\n                eMenu.style.display = \"inline\";\r\n\r\n                tMenuTimeout = setTimeout(hide, 2400);\r\n\r\n                this.focus();\r\n                oEvent.stop();\r\n            }\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    /*\r\n    This method handles the onClick event of the year pull down button. It will generate the year menu \r\n    and has internal event handlers for hiding the menu and scrolling it up and down. \r\n    \r\n    @param  oEvent  The event object.\r\n    @private\r\n    */\r\n    onYearClick(oEvent) {\r\n        let eUp, eDown, tMenuTimeout, tScrollTimeout, sCSS, hide;\r\n        const aHtml = [], that = this;\r\n\r\n        const eMenu = df.dom.query(this._eElem, \"div.WebDP_YearMnu\");\r\n\r\n        //  Handles the onclick which selects the month\r\n        function onClick(oEvent) {\r\n            var eLI = oEvent.getTarget();\r\n\r\n            if (eLI.getAttribute('data-year')) {\r\n                this._iDisplayYear = parseInt(eLI.getAttribute('data-year'), 10);\r\n\r\n                hide();\r\n                this.update();\r\n                this.focus();\r\n            }\r\n            oEvent.stop();\r\n        }\r\n\r\n        //  Clears the hide timeout when hovering the menu\r\n        function onOver(oEvent) {\r\n            clearTimeout(tMenuTimeout);\r\n        }\r\n\r\n        //  Sets the hide timeout when leaving the menu\r\n        function onOut(oEvent) {\r\n            tMenuTimeout = setTimeout(hide, 1200);\r\n        }\r\n\r\n        //  Scrolls the menu one year up\r\n        function scrollUp() {\r\n            let iYear;\r\n\r\n            //  Determine new year\r\n            iYear = eUp.nextSibling.getAttribute(\"data-year\");\r\n            iYear--;\r\n\r\n            //  Remove old element\r\n            eDown.parentNode.removeChild(eDown.previousSibling);\r\n\r\n            //  Create and insert new element\r\n            const eNew = document.createElement(\"li\");\r\n            df.dom.setText(eNew, iYear);\r\n            eNew.setAttribute(\"data-year\", iYear);\r\n            eUp.parentNode.insertBefore(eNew, eUp.nextSibling);\r\n\r\n        }\r\n\r\n        //  Scrolls the menu one year down\r\n        function scrollDown() {\r\n            let iYear;\r\n\r\n            //  Determine new year\r\n            iYear = eDown.previousSibling.getAttribute(\"data-year\");\r\n            iYear++;\r\n\r\n            //  Remove old element\r\n            eUp.parentNode.removeChild(eUp.nextSibling);\r\n\r\n            //  Create and insert new element\r\n            const eNew = document.createElement(\"li\");\r\n            df.dom.setText(eNew, iYear);\r\n            eNew.setAttribute(\"data-year\", iYear);\r\n            eDown.parentNode.insertBefore(eNew, eDown);\r\n        }\r\n\r\n        //  Initiates the menu scrolling if the button up or down is clicked\r\n        function onScroll(oEvent) {\r\n            let fFunc;\r\n\r\n            //  Determine which button is clicked\r\n            const eScroll = oEvent.getTarget();\r\n            fFunc = (eScroll === eUp ? scrollUp : scrollDown);\r\n\r\n            //  Function that executes the scrolling after a timeout\r\n            function doScroll() {\r\n                fFunc();\r\n\r\n                tScrollTimeout = setTimeout(doScroll, 35);\r\n            }\r\n\r\n            //  Perform one scroll step\r\n            fFunc();\r\n\r\n            //  Set timout\r\n            tScrollTimeout = setTimeout(doScroll, 300);\r\n\r\n            //  Display button as being held down\r\n            df.dom.addClass(eScroll, (eScroll === eUp ? \"WebDP_UpDown\" : \"WebDP_DownDown\"));\r\n\r\n            oEvent.stop();\r\n        }\r\n\r\n        //  Stops the scrolling (cancel timeout and remove CSS classes)\r\n        function onScrollStop(oEvent) {\r\n            clearTimeout(tScrollTimeout);\r\n\r\n            df.dom.removeClass(eUp, \"WebDP_UpDown\");\r\n            df.dom.removeClass(eDown, \"WebDP_DownDown\");\r\n\r\n            oEvent.stop();\r\n        }\r\n\r\n        //  Hides the menu \r\n        hide = function hide() {\r\n            eMenu.style.display = \"none\";\r\n\r\n            //  Clear event listeners\r\n            df.dom.off(\"click\", eMenu, onClick, this);\r\n            df.dom.off(\"mouseover\", eMenu, onOver, this);\r\n            df.dom.off(\"mouseout\", eMenu, onOut, this);\r\n            df.dom.off(\"mousedown\", eUp, onScroll, this);\r\n            df.dom.off(\"mouseout\", eUp, onScrollStop, this);\r\n            df.dom.off(\"mouseup\", eUp, onScrollStop, this);\r\n            df.dom.off(\"mousedown\", eDown, onScroll, this);\r\n            df.dom.off(\"mouseout\", eDown, onScrollStop, this);\r\n            df.dom.off(\"mouseup\", eDown, onScrollStop, this);\r\n\r\n            clearTimeout(tMenuTimeout);\r\n            that._fYearHide = null;\r\n        };\r\n\r\n        if (this._fYearHide) {\r\n            this._fYearHide();\r\n        } else {\r\n            if (this.isEnabled()) {\r\n                this._fYearHide = hide;\r\n\r\n                //  Generate menu\r\n                aHtml.push('<ul>');\r\n                aHtml.push('<li class=\"WebDP_Up\"></li>');\r\n\r\n                for (let i = this._iDisplayYear - 4; i < this._iDisplayYear + 4; i++) {\r\n                    sCSS = (i === this._iDisplayYear ? \"WebDP_Current\" : \"\");\r\n\r\n                    aHtml.push('<li data-year=\"', i, '\" class=\"', sCSS, '\">', i, '</li>');\r\n                }\r\n                aHtml.push('<li class=\"WebDP_Down\"></li>');\r\n                aHtml.push('</ul');\r\n\r\n\r\n                //  Display menu\r\n                eMenu.innerHTML = aHtml.join('');\r\n                eMenu.style.display = \"inline\";\r\n\r\n                //  Get references to buttons\r\n                eUp = df.dom.query(eMenu, 'li.WebDP_Up');\r\n                eDown = df.dom.query(eMenu, 'li.WebDP_Down');\r\n\r\n                //  Attach event listeners\r\n                df.dom.on(\"click\", eMenu, onClick, this);\r\n                df.dom.on(\"mouseover\", eMenu, onOver, this);\r\n                df.dom.on(\"mouseout\", eMenu, onOut, this);\r\n                df.dom.on(\"mousedown\", eUp, onScroll, this);\r\n                df.dom.on(\"mouseout\", eUp, onScrollStop, this);\r\n                df.dom.on(\"mouseup\", eUp, onScrollStop, this);\r\n                df.dom.on(\"mousedown\", eDown, onScroll, this);\r\n                df.dom.on(\"mouseout\", eDown, onScrollStop, this);\r\n                df.dom.on(\"mouseup\", eDown, onScrollStop, this);\r\n\r\n                tMenuTimeout = setTimeout(hide, 2400);\r\n\r\n\r\n                this.focus();\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the onclick event of the next button. It moves to the next month.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onNextClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this._iDisplayMonth++;\r\n            if (this._iDisplayMonth >= 12) {\r\n                this._iDisplayYear++;\r\n                this._iDisplayMonth = 0;\r\n            }\r\n\r\n            this.update();\r\n            this.focus();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the onclick event of the next button. It moves to the next month.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onPrevClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this._iDisplayMonth--;\r\n            if (this._iDisplayMonth < 0) {\r\n                this._iDisplayYear--;\r\n                this._iDisplayMonth = 11;\r\n            }\r\n\r\n            this.update();\r\n            this.focus();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the click event of one of the displayed days in the calendar. It \r\n    selects the day, repaints the calendar and fires the onChange and onEnter \r\n    events.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onBodyClick(oEvent) {\r\n        const eCell = oEvent.getTarget();\r\n\r\n        if (this.isEnabled()) {\r\n            if (eCell.getAttribute(\"data-date\")) {\r\n                const dDate = new Date(parseInt(eCell.getAttribute(\"data-year\"), 10), parseInt(eCell.getAttribute(\"data-month\"), 10), parseInt(eCell.getAttribute(\"data-date\"), 10), 1, 1, 1);\r\n\r\n                this.focus();\r\n                this.setSelectedDate(dDate, false, false);\r\n                this.fireRTChange();\r\n                this.fireEnter();\r\n                this.fireDateClick();\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles click events on elements that do not handle the click. It makes sure that the proper focus \r\n    handling is performed so that the date picker won't hide.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onWrapClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.focus();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the click event of the \"today\" date. It selects the current date.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onTodayClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this._dSelected = new Date();\r\n            this._iDisplayYear = this._dSelected.getFullYear();\r\n            this._iDisplayMonth = this._dSelected.getMonth();\r\n\r\n            this.focus();\r\n            this.update();\r\n            this.fireRTChange();\r\n            this.fireEnter();\r\n            this.fireDateClick();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the keypress event of focus holder element. If the pressed key matches \r\n    one of the keys that are set it performs the action.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const dDate = new Date(this._dSelected.getTime());\r\n\r\n        if (!this._bBuddyActive) {\r\n            return;\r\n        }\r\n\r\n        //  Generate key object to compare\r\n        if (this.isEnabled()) {\r\n            if (oEvent.matchKey(df.settings.calendarKeys.dayUp)) { // Up (decrement with 7 days)\r\n                dDate.setDate(dDate.getDate() - 7);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.dayDown)) { //  Down (increment with 7 days)\r\n                dDate.setDate(dDate.getDate() + 7);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.dayLeft)) { // Left (decrement with one day)\r\n                dDate.setDate(dDate.getDate() - 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.dayRight)) { // Right (increment with one day)\r\n                dDate.setDate(dDate.getDate() + 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.monthUp)) { //  Month up\r\n                dDate.setMonth(dDate.getMonth() + 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.monthDown)) { //    Month down\r\n                dDate.setMonth(dDate.getMonth() - 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.yearUp)) { //   Year up\r\n                dDate.setFullYear(dDate.getFullYear() + 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.yearDown)) { // Year down\r\n                dDate.setFullYear(dDate.getFullYear() - 1);\r\n                this.setSelectedDate(dDate);\r\n                this.fireRTChange();\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.calendarKeys.enter)) { //    Enter\r\n                this.fireDateClick();\r\n\r\n                if (!this.fireEnter()) {   //  WebDateForm will cancel onEnter to stop submit\r\n                    oEvent.stop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Fires the onChange event.\r\n    \r\n    @private\r\n    */\r\n    fireRTChange() {\r\n        //this.onChange.fire(this, { dValue : this.getSelectedDate() });\r\n        this.OnRealtimeChange.fire(this, { dValue: this.getSelectedDate() });\r\n    }\r\n\r\n    /*\r\n    Fires the onEnter event.\r\n    \r\n    @private\r\n    */\r\n    fireEnter() {\r\n        return this.OnEnter.fire(this, { dValue: this.getSelectedDate() });\r\n    }\r\n\r\n    /* \r\n    Fires the onDateClick event.\r\n    \r\n    @private\r\n    */\r\n    fireDateClick() {\r\n        this.fire(\"OnDateClick\", [this.get('psValue')]);\r\n    }\r\n\r\n    /*\r\n    Override the refreshDisplay method to update the date picker with the new value. Note that \r\n    peDataType should be set the 'date' type.\r\n    \r\n    @param  tVal    Type specific value (should be a date).\r\n    @private\r\n    */\r\n    refreshDisplay(tVal) {\r\n        if (this.peDataType === df.ciTypeDate || this.peDataType === df.ciTypeDateTime) {\r\n            this.setSelectedDate(tVal, true, false);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the updateTypeVal method which reads the value from the display and sets it to the type \r\n    specific property (this._tValue). Note that peDataType should be set the 'date' type.\r\n    \r\n    @private\r\n    */\r\n    updateTypeVal() {\r\n        if (this.peDataType === df.ciTypeDate || this.peDataType === df.ciTypeDateTime) {\r\n            this._tValue = this.getSelectedDate();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments applyEnabled to disable the focus by setting the tab index.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eFocus) {\r\n            df.dom.setTabIndex(this._eFocus, (bVal ? 0 : -1));\r\n        }\r\n    }\r\n    // - - - - - - - Focus - - - - - - -\r\n\r\n    /*\r\n    We override the focus method and make it give the focus to the hidden focus holder element.\r\n    \r\n    @return True if the List can take the focus.\r\n    */\r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eFocus) {\r\n            this._eFocus.focus();\r\n            this._bLozingFocus = false;\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Override the onFocus method and manually display the calendar as focused. The onBlur will remove the \r\n    focus after a timeout (since the onBlur also fires when performing an action within the control). So \r\n    we have set _bLozingFocus to false to make sure that this doesn't happen when the timer fires.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onFocus(oEvent) {\r\n        if (!this._bBuddyActive) {\r\n            return;\r\n        }\r\n\r\n        if (this._bFocusAble && this.isEnabled() && this._eFocus) {\r\n            this.objFocus();\r\n\r\n            if (this._eElem) {\r\n                df.dom.addClass(this._eElem, \"WebCon_Focus\");\r\n            }\r\n\r\n            this._bHasFocus = true;\r\n            this._bLozingFocus = false;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the onBlur method and manually display the calendar as blurred. We do this after a short \r\n    timeout because the onBlur also fires when performing an action within the calendar. So onFocus can \r\n    cancel the blur action when being fired within this timeout.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n\r\n        if (!this._bBuddyActive) {\r\n            return;\r\n        }\r\n\r\n        this._bLozingFocus = true;\r\n\r\n        this.fireChange();\r\n\r\n        setTimeout(function () {\r\n            if (that._bLozingFocus) {\r\n                //  Do not forward send as it potentially causes the value to be reset by refreshDisplay which makes the calendar go back to its displayed date\r\n                that.updateTypeVal();\r\n\r\n                that.fireAutoFind();\r\n\r\n                if (that._eElem) {\r\n                    df.dom.removeClass(that._eElem, \"WebCon_Focus\");\r\n                }\r\n\r\n                that._bLozingFocus = false;\r\n            }\r\n        }, 100);\r\n    }\r\n}","import { WebForm } from './WebForm.js';\r\nimport { WebModalDialog } from './WebModalDialog.js';\r\nimport { WebFloatingPanel } from './WebFloatingPanel.js';\r\nimport { WebDatePicker } from './WebDatePicker.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebDateForm\r\nExtends:\r\n    df.WebForm\r\n\r\nThis class is the client-side representation of the cWebDateForm and renders a form with a date \r\npicker button as the prompt button. It uses the df.DatePicker class to render the actual date \r\npicker.\r\n    \r\nRevision:\r\n    2012/03/16  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n// - - - Control API - - -\r\n/*\r\nAugment the afterRender method that is called when the DOM elements are created. We use it to \r\ninstantiate the DatePicker object and to let that render itself (hidden). We also inject the focus \r\nholder Anchor element.\r\n\r\n@private\r\n*/\r\nexport class WebDateForm extends WebForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbShowWeekNr\", true);\r\n        this.prop(df.tBool, \"pbShowToday\", true);\r\n        this.prop(df.tInt, \"piStartWeekAt\", 1);\r\n        this.prop(df.tBool, \"pbAutoShow\", false);\r\n        this.prop(df.tBool, \"pbModal\", false);\r\n\r\n        this.prop(df.tBool, \"pbHtml5NativeOnMobile\", true);\r\n\r\n        //  Configure super classes\r\n        this.pbPromptButton = true;\r\n\r\n        // @privates\r\n        this._ePickerWrp = null;\r\n        this._eFocus = null;\r\n        this._bPickerVisible = false;\r\n        this._bSkipAutoShow = false;\r\n        this._bShowWait = false;\r\n        this._iWidth = 0;\r\n        this._iHeight = 0;\r\n        this._tOnChange = null;\r\n\r\n        this._sControlClass = \"WebForm WebDateForm\";\r\n\r\n        this._eParentRef = null;\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        //  Create hidden focus element (used while the picker is shown)\r\n        //this._eFocus = df.dom.create('<div class=\"WebDateForm_FocusHolder\" tabindex=\"-1\" style=\"display: none; position: absolute; width: 1px; height: 1px;\"></div>');\r\n        // this._eWrap.appendChild(this._eFocus);\r\n\r\n        //df.dom.on(\"focus\", this._eFocus, this.onPickFocus, this);\r\n        //df.dom.on(\"blur\", this._eFocus, this.onPickBlur, this);\r\n\r\n        //  On mobile devices we create a hidden date field to trick the browser into using the native date picker\r\n        if (this.pbHtml5NativeOnMobile && df.sys.isMobile && df.sys.supportHtml5Input(\"date\")) {\r\n            this._ePrompt.innerHTML = '<div class=\"WebDF_HiddenDate\"><input type=\"date\"></div>';\r\n\r\n            this._eHtml5HiddenDate = df.dom.query(this._ePrompt, \"input\");\r\n\r\n            df.dom.on(\"change\", this._eHtml5HiddenDate, this.html5OnChange, this);\r\n            df.dom.on(\"input\", this._eHtml5HiddenDate, this.html5OnChange, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment destroy to destroy the date picker as well.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        if (this._oFloatingPanel) {\r\n            this._oFloatingPanel.destroy();\r\n            this._oFloatingPanel = null;\r\n            this._oPicker = null;\r\n        }\r\n        super.destroy();\r\n    }\r\n\r\n    // - - - Server API - - -\r\n    set_pbShowWeekNr(bVal) {\r\n        if (this._oPicker) {\r\n            this._oPicker.set(\"pbShowWeekNr\", bVal);\r\n        }\r\n    }\r\n\r\n    set_pbShowToday(bVal) {\r\n        if (this._oPicker) {\r\n            this._oPicker.set(\"pbShowToday\", bVal);\r\n        }\r\n    }\r\n\r\n    set_piStartWeekAt(iVal) {\r\n        if (this._oPicker) {\r\n            this._oPicker.set(\"piStartWeekAt\", iVal);\r\n        }\r\n    }\r\n\r\n    // - - - Implementation - - -\r\n\r\n    /*\r\n    Augment setControlValue to also update the hidden date field when it is used.\r\n    \r\n    @param  sVal    New value.\r\n    */\r\n    setControlValue(sVal) {\r\n        super.setControlValue(sVal);\r\n\r\n        //  Also update the hidden date field as updating it when opening it is too late for IOS\r\n        if (this._eHtml5HiddenDate) {\r\n            this._eHtml5HiddenDate.value = (this._tValue && df.sys.data.dateToString(this._tValue, \"yyyy/mm/dd\", \"-\")) || \"\";\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the onchange and oninput events from the hidden <input type=date form and updates the form \r\n    its value with this new date.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    html5OnChange(oEvent) {\r\n        const that = this;\r\n\r\n        this._tValue = df.sys.data.stringToDate(this._eHtml5HiddenDate.value, \"yyyy-mm-dd\", \"-\");\r\n\r\n        //  Update the displayed value\r\n        this.refreshDisplay(this._tValue);\r\n\r\n        if (this._tOnChange) {\r\n            clearTimeout(this._tOnChange);\r\n        }\r\n        this._tOnChange = setTimeout(function () {\r\n            that.fireChange();\r\n            that._tOnChange = null;\r\n        }, 150);\r\n    }\r\n\r\n    /*\r\n    Initializes the picker components (floating panel and date picker).\r\n    */\r\n    initPicker() {\r\n        let oPicker, oPnl;\r\n\r\n        if (this.pbModal) {\r\n            oPnl = this._oFloatingPanel = this.createModalDialog();\r\n        } else {\r\n            oPnl = this._oFloatingPanel = this.createPanel();\r\n        }\r\n\r\n        this.configurePanel(oPnl);\r\n        oPnl.create();\r\n\r\n        this._oPicker = oPicker = this.createDatePicker();\r\n\r\n        this.configureDatePicker(oPicker);\r\n        oPicker.create();\r\n\r\n        oPnl.addChild(oPicker);\r\n    }\r\n\r\n    /*\r\n    @returns New panel instance used to display the date picker in.\r\n    */\r\n    createPanel() {\r\n        return new WebFloatingPanel(null, this);\r\n    }\r\n\r\n    createModalDialog() {\r\n        return new WebModalDialog(null, this);\r\n    }\r\n\r\n    /*\r\n    Sets the properties of the floating panel and attach the event handlers.\r\n    \r\n    @param oPnl The new panel to configure.\r\n    */\r\n    configurePanel(oPnl) {\r\n        oPnl.psFloatByControl = this.getLongName();\r\n        oPnl.piColumnCount = 1;\r\n        oPnl.pbHideOnBlur = true;\r\n        oPnl.pbFocusOnShow = true;\r\n        oPnl.pbHideOnEscape = true;\r\n        oPnl.pbNaturalWidth = true;\r\n        oPnl.psCSSClass = \"NoWhitespace Shadow WebDateForm_FlPnl\";\r\n        oPnl.OnHide.addListener(this.onPanelClose, this);\r\n    }\r\n\r\n    /*\r\n    @returns New instance of the WebDatePicker.\r\n    */\r\n    createDatePicker() {\r\n        return new WebDatePicker(null, this);\r\n    }\r\n\r\n    /*\r\n    Sets the properties on the date picker and attaches event handlers.\r\n    \r\n    @param oPicker  The datepicker to configure.\r\n    */\r\n    configureDatePicker(oPicker) {\r\n        //  Standard config\r\n        oPicker.pbShowLabel = false;\r\n        oPicker.psValue = this.getServerVal();\r\n        oPicker.piColumnSpan = 0;\r\n        oPicker.pbShowWeekNr = this.pbShowWeekNr;\r\n        oPicker.pbShowToday = this.pbShowToday;\r\n        oPicker.piStartWeekAt = this.piStartWeekAt;\r\n        oPicker.psMask = this.getWebApp().psDateFormat;\r\n\r\n        oPicker.psCSSClass = \"WebDatePicker_Form NoWhitespace\";\r\n        oPicker.OnRealtimeChange.addListener(this.onPickerChange, this);\r\n        oPicker.OnEnter.addListener(this.onPickerEnter, this);\r\n    }\r\n\r\n    renderPicker() {\r\n        const oPnl = this._oFloatingPanel;\r\n\r\n        const ePnl = oPnl.render();\r\n        if (ePnl) {\r\n            this._eElem.parentNode.insertBefore(ePnl, this._eElem);\r\n        }\r\n        oPnl.afterRender();\r\n        oPnl.resizeHorizontal();\r\n        oPnl.resizeVertical();\r\n\r\n    }\r\n\r\n\r\n    showPicker() {\r\n        if (!this._oFloatingPanel) {\r\n            this.initPicker();\r\n        }\r\n        if (!this._oFloatingPanel._eElem) {\r\n            this.renderPicker();\r\n        }\r\n        this._oPicker._bBuddyActive = true;\r\n        this._oPicker.set(\"psValue\", this.getServerVal());\r\n        this._oFloatingPanel.show();\r\n\r\n        //Float the modal dialog next to the WebDateForm\r\n        if (this.pbModal) {\r\n            this._oFloatingPanel.floatByControl();\r\n        }\r\n\r\n        this._bPickerVisible = true;\r\n    }\r\n\r\n\r\n    /*\r\n    This method hides the date picker by removing the 'WebDF_WrapVisible' class so that a CSS3 \r\n    transformation can be used.\r\n    */\r\n    hideDatePicker(bOptNoFocus) {\r\n        this._bPickerVisible = false;\r\n        if (this._oFloatingPanel) {\r\n            this._oPicker._bBuddyActive = false;\r\n            this._oFloatingPanel.hide();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method overrides the firePrompt method and makes it display the calendar. We don't fire the \r\n    OnPrompt event at all anymore.\r\n    \r\n    @private\r\n    */\r\n    firePrompt() {\r\n        if (this.isEnabled() && !this.pbReadOnly) {\r\n            //  If an hiden HTML5 date field is used we don't need to show the date picker but we need to update that field with the right value\r\n            if (this._eHtml5HiddenDate) {\r\n                this.updateTypeVal();\r\n\r\n                if (this._tValue) {\r\n                    this._eHtml5HiddenDate.value = df.sys.data.dateToString(this._tValue, \"yyyy/mm/dd\", \"-\");\r\n                } else {\r\n                    this._eHtml5HiddenDate.value = \"\";\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            this.showPicker();\r\n            //this.focus();\r\n\r\n            return true;\r\n        }\r\n    }\r\n\r\n\r\n    onPickerChange(oEvent) {\r\n        this._tValue = oEvent.dValue;\r\n        this.refreshDisplay(oEvent.dValue);\r\n    }\r\n\r\n    onPickerEnter(oEvent) {\r\n        if (this.peDataType === df.ciTypeDate || this.peDataType === df.ciTypeDateTime) {\r\n            this._tValue = oEvent.dValue;\r\n            this.refreshDisplay(this._tValue);\r\n        }\r\n\r\n        this.hideDatePicker();\r\n        this.focus();\r\n        this.fireChange();\r\n    }\r\n\r\n\r\n    onPanelClose(oEvent) {\r\n        const sReason = oEvent.aParams[0];\r\n\r\n        this.fireChange();\r\n\r\n        if (sReason !== \"auto_blur\") {\r\n            this._bSkipAutoShow = true;\r\n            this.focus();\r\n        }\r\n    }\r\n\r\n    // - - - - - - - Focus - - - - - - -\r\n\r\n\r\n    /*\r\n    This method augments the onFocus event of the display field and handles two different scenarios. If \r\n    the date picker is visible then this means that the user manually passed the focus to the input \r\n    field. In that case we hide the date picker. If the date picker is not visible then we might need to \r\n    show the date picker if pbAutoShow is true. The _bSkipAutoShow property can be set to true to \r\n    prevent recursive loops. \r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    */\r\n    onFocus(oEvent) {\r\n        super.onFocus(oEvent);\r\n\r\n        if (this.pbAutoShow && this.isEnabled() && !this.pbReadOnly && !this._bSkipAutoShow) {\r\n            this.showPicker();\r\n        }\r\n\r\n        this._bSkipAutoShow = false;\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebBaseContainer_mixin } from './WebBaseContainer.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebDynamicObjectContainer\r\nMixin:\r\n    df.WebBaseContainer_mixin\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class is the client-side representation of the WebDynamicObjectContainer. This class\r\ncontains the logic required to support dynamic object creation in DataFlex.\r\n*/\r\n\r\ndf.tQueuedSyncProp = {\r\n    sO: df.tString,\r\n    sP: df.tString,\r\n    bA: df.tBool,\r\n    sV: df.tString,\r\n    tVT: {}\r\n}\r\n\r\ndf.tSyncPropsWrapper = {\r\n    bReset: df.tBool,\r\n    aSyncProps: [{\r\n        sO: df.tString,\r\n        aP: [{\r\n            sN: df.tString,\r\n            sV: df.tString\r\n        }]\r\n    }]\r\n\r\n};\r\n\r\ndf.tAdvSyncPropsWrapper = {\r\n    bReset: df.tBool,\r\n    aAdvSyncProps: [{\r\n        sO: df.tString,\r\n        sP: df.tString,\r\n        tV: {}\r\n    }]\r\n\r\n};\r\n\r\n//  Use the WebBaseContainer_mixin and inherit from WebBaseControl\r\nclass WebDynamicObjectContainerBase extends WebBaseContainer_mixin(WebBaseControl) { }\r\n\r\nexport class WebDynamicObjectContainer extends WebDynamicObjectContainerBase {\r\n    constructor(sName, oParent) {\r\n        //  Forward Send\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tAdv, \"ptSyncPropsWrapper\", null);\r\n        this.prop(df.tAdv, \"ptAdvSyncPropsWrapper\", null);\r\n\r\n        this.addSync(\"ptSyncPropsWrapper\");\r\n        this.addSync(\"ptAdvSyncPropsWrapper\");\r\n\r\n        // Private variables\r\n        this._aSyncPropQueue = []; // Contains both regular and advanced syncprops\r\n        this._bReset = false; // True if a reset of the container is incoming during this call\r\n        this._aSyncPropCache = [];\r\n        this._aAdvSyncPropCache = [];\r\n\r\n        // Configure super classes\r\n        this._sBaseClass = \"WebControl\";\r\n        this._sControlClass = \"WebDynCon\";\r\n    }\r\n\r\n    /* \r\n    Hook for getting references to the elements during the rendering process before child elements are \r\n    created.\r\n    \r\n    @private\r\n    */\r\n    getRef() {\r\n        super.getRef();\r\n\r\n        //  Do this before afterRender to prevent issues with nested groups..\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebCon_Inner > div\");\r\n    }\r\n\r\n\r\n    /*\r\n    The getMinHeight function is called by the column layout resize system implemented in \r\n    WebBaseContainer. It determines the minimal height that the control needs to render itself. The \r\n    WebGroup uses the getRequiredHeight function to determine the required height. The  getHeightDiff \r\n    function is used to calculate the height taken by a border / padding on the group itself.\r\n    \r\n    @return The minimal height needed in pixels.\r\n    */\r\n    getMinHeight() {\r\n        let iHeight = 0;\r\n\r\n        //  Give child containers a chance to resize\r\n        this.resize();\r\n\r\n        //  Determine natural height\r\n        if (this.pbScroll) {\r\n            if (this.pbFillHeight) {\r\n                iHeight = this.piMinHeight;\r\n            } else {\r\n                iHeight = Math.max(this.piHeight, this.piMinHeight);\r\n            }\r\n        } else {\r\n            //  Determine natural height\r\n            iHeight = this.getRequiredHeight();\r\n        }\r\n\r\n        //  Add control height difference\r\n        if (this._eControl) {\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControl);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eInner);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControlWrp);\r\n        }\r\n\r\n        //  Respect piMinHeight\r\n        if (iHeight < this.piMinHeight) {\r\n            iHeight = this.piMinHeight;\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /* \r\n    Override the setHeight and set the height on the container div which will properly stretch the \r\n    control and will make the container sizing logic function properly.\r\n    \r\n    @param  iHeight     The full height of the control (outermost element).\r\n    @private\r\n    */\r\n    setHeight(iHeight, bSense) {\r\n        if (this._eControl) {\r\n            //  If a negative value is given we should size 'naturally'\r\n            if (iHeight > 0) {\r\n                iHeight -= this.getVertHeightDiff();\r\n\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height\r\n                this._eContainer.style.height = iHeight + \"px\";\r\n            } else {\r\n                this._eContainer.style.height = \"\";\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /* \r\n    Called by the WebBaseContainer openHtml to insert HTML between the control and the container HTML. \r\n    We insert the WebContainer div.\r\n    \r\n    @param  aHtml   String array used as string builder.\r\n    @private\r\n    */\r\n    wrpOpenHtml(aHtml) {\r\n        aHtml.push('<div class=\"WebContainer\">');\r\n    }\r\n\r\n\r\n    /* \r\n    Called by the WebBaseContainer openHtml to insert HTML between the control and the container HTML. \r\n    \r\n    @param  aHtml   String array used as string builder.\r\n    @private\r\n    */\r\n    wrpCloseHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n\r\n    /* \r\n    Published method that allows the server to send a list\r\n    of queued synchronized properties to the client so that\r\n    these can be applied after the objects are created.\r\n    */\r\n    loadQueuedSyncProps() {\r\n        const aQueuedSyncProps = this._tActionData;\r\n        let tQueuedSyncProp, sVal;\r\n\r\n        for (let i = 0; i < aQueuedSyncProps.length; i++) {\r\n            tQueuedSyncProp = aQueuedSyncProps[i];\r\n\r\n            // ToDo: This code could never have worked, we should test the support for non scalar sync props on dynamic objects (DF-4273)\r\n            // if (tQueuedSyncProp.bA) {\r\n            //     tQueuedSyncProp.tV = this.deserializeVT(sVal.c[4]);\r\n            // }\r\n\r\n            this._aSyncPropQueue.push(tQueuedSyncProp);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Published method that allows the server to send an new\r\n    structure of dynamic objects to the client to be rendered.\r\n    */\r\n    loadDynamicObjects() {\r\n        const aObjects = this._tActionData;\r\n\r\n        for (let i = 0; i < aObjects.length; i++) {\r\n            const tDef = aObjects[i];\r\n            const oObj = this.initDynamicObject(tDef, this, false);\r\n\r\n            // Set owner to WebDynamicObjectContainer\r\n            oObj._oOwner = this;\r\n        }\r\n\r\n        if (this._eElem) {\r\n            this.renderChildren();\r\n            this.afterRender();\r\n            this.position();\r\n\r\n            this.getWebApp().resize();\r\n        }\r\n\r\n        this.emptyPropCache();\r\n    }\r\n\r\n    /* \r\n    Published method that allows the server to insert an object\r\n    into the client's data structure.\r\n    */\r\n    insertDynamicObject(sParent, sInsertAfter) {\r\n        const tDef = this._tActionData;\r\n\r\n        const oParent = this.getWebApp().findObj(sParent) || this;\r\n        const oInsertAfter = oParent[sInsertAfter] || null;\r\n        const oObj = this.initDynamicObject(tDef, oParent, true);\r\n\r\n        if (this._eElem) {\r\n            // Insert the object in its parent's children structure\r\n            const iIndex = oInsertAfter !== null ? oParent._aChildren.indexOf(oInsertAfter) + 1 : 0;\r\n            oParent.insertChild(oObj, iIndex);\r\n\r\n            // Render the child object\r\n            oParent.renderChild(oObj);\r\n\r\n            this.getWebApp().resize();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Published method that allows the server to insert an object\r\n    into the client's data structure at a specific index.\r\n    */\r\n    insertDynamicObjectAtIndex(sParent, iIndex) {\r\n        const tDef = this._tActionData;\r\n\r\n        const oParent = this.getWebApp().findObj(sParent) || this;\r\n        const oObj = this.initDynamicObject(tDef, oParent, true);\r\n\r\n        if (this._eElem) {\r\n            // Insert the object in its parent's children structure \r\n            // at the specified index\r\n            oParent.insertChild(oObj, iIndex);\r\n\r\n            // Render the child object\r\n            oParent.renderChild(oObj);\r\n\r\n            this.getWebApp().resize();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Published method that allows the server to insert an object\r\n    into the client's data structure. This function specifically\r\n    inserts the object at the beginning of its parent's list of children.\r\n    */\r\n    prependDynamicObject(sParent) {\r\n        const tDef = this._tActionData;\r\n\r\n        const oParent = this.getWebApp().findObj(sParent) || this;\r\n        const oObj = this.initDynamicObject(tDef, oParent, true);\r\n\r\n        if (this._eElem) {\r\n            // Insert the object in its parent's children structure\r\n            oParent.insertChild(oObj, 0);\r\n\r\n            // Render the child object\r\n            oParent.renderChild(oObj);\r\n\r\n            this.getWebApp().resize();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Published method that allows the server to insert an object\r\n    into the client's data structure. This function specifically\r\n    inserts the object at the end of its parent's list of children.\r\n    */\r\n    appendDynamicObject(sParent) {\r\n        const tDef = this._tActionData;\r\n        const oParent = this.getWebApp().findObj(sParent) || this;\r\n        const oObj = this.initDynamicObject(tDef, oParent, true);\r\n\r\n        if (this._eElem) {\r\n            // Insert the object in its parent's children structure\r\n            const iIndex = oParent._aUIObjects.length;\r\n            oParent.insertChild(oObj, iIndex);\r\n\r\n            // Render the child object\r\n            oParent.renderChild(oObj);\r\n\r\n            this.getWebApp().resize();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Published method that moves the given dynamic object\r\n    behind the second passed dynamic object.\r\n    */\r\n    moveDynamicObject(sDynamicObjectId, sInsertAfter) {\r\n        const webApp = this.getWebApp();\r\n\r\n        const oObj = webApp.findObj(sDynamicObjectId);\r\n        const oInsertAfter = webApp.findObj(sInsertAfter);\r\n        const oNewParent = oInsertAfter._oParent;\r\n        const oOldParent = oObj._oParent;\r\n\r\n        // Store object's DOM element\r\n        const eObj = oObj._eElem;\r\n\r\n        // Update object's parent\r\n        oObj._oParent = oNewParent;\r\n\r\n        // Move object\r\n        oOldParent.removeChild(oObj);\r\n\r\n        const iIndex = oInsertAfter !== null ? oNewParent._aChildren.indexOf(oInsertAfter) + 1 : 0;\r\n        oNewParent.insertChild(oObj, iIndex, oInsertAfter);\r\n        oNewParent.renderChild(oObj, eObj);\r\n\r\n        // Resize the webapp. \r\n        // For some reason, the web app requires x amount of resizes, where\r\n        // x = depth(oObj) - 1. The depth of an object is defined by how\r\n        // far into the object structure it is located, starting from the view.\r\n        const iResizeCount = oObj.getObjectLevel();\r\n        for (let i = 0; i < iResizeCount; i++) {\r\n            webApp.resize();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Published method that moves the given dynamic object\r\n    behind the second passed dynamic object.\r\n    */\r\n    moveDynamicObjectToIndex(sDynamicObjectId, sParentId, iIndex) {\r\n        const webApp = this.getWebApp();\r\n\r\n        const oObj = webApp.findObj(sDynamicObjectId);\r\n        const oNewParent = webApp.findObj(sParentId);\r\n        const oOldParent = oObj._oParent;\r\n\r\n        // Store object's DOM element\r\n        const eObj = oObj._eElem;\r\n\r\n        // Update object's parent\r\n        oObj._oParent = oNewParent;\r\n\r\n        // Move object\r\n        oOldParent.removeChild(oObj);\r\n\r\n        oNewParent.insertChild(oObj, iIndex);\r\n        oNewParent.renderChild(oObj, eObj);\r\n\r\n        // Resize the webapp. \r\n        // For some reason, the web app requires x amount of resizes, where\r\n        // x = depth(oObj) - 1. The depth of an object is defined by how\r\n        // far into the object structure it is located, starting from the view.\r\n        let iResizeCount = oObj.getObjectLevel();\r\n        for (let i = 0; i < iResizeCount; i++) {\r\n            webApp.resize();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Published method that destroys the given dynamic object \r\n    and removes it from the container.\r\n    */\r\n    destroyDynamicObject(sDynamicObjectId) {\r\n        const oObj = this.getWebApp().findObj(sDynamicObjectId);\r\n\r\n        const oParent = oObj._oParent;\r\n        oParent.removeChild(oObj);\r\n        oParent.unrenderChild(oObj);\r\n\r\n        // Destroy the actual object\r\n        oObj.destroy();\r\n\r\n        // Resize the webapp. \r\n        // For some reason, the web app requires x amount of resizes, where\r\n        // x = depth(oObj) - 1. The depth of an object is defined by how\r\n        // far into the object structure it is located, starting from the view.\r\n        const iResizeCount = oParent.getObjectLevel();\r\n        for (let i = 0; i < iResizeCount; i++) {\r\n            this.getWebApp().resize();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Initializes a dynamic web object.\r\n    */\r\n    initDynamicObject(tDef, oParent, bInsert) {\r\n        let sP, oObj;\r\n        const webApp = this.getWebApp();\r\n\r\n        //  Check for name conflict\r\n        if (!oParent[tDef.sName]) {\r\n\r\n            //  Find constructor\r\n            const FConstructor = webApp.getConstructor(tDef.sType, tDef);\r\n            if (typeof (FConstructor) === \"function\") {\r\n\r\n                //  Create new instance\r\n                oParent[tDef.sName] = oObj = new FConstructor(tDef.sName, oParent);\r\n            } else {\r\n                throw new df.Error(999, \"Could not find class '{{0}}'\", this, [tDef.sType]);\r\n            }\r\n        } else {\r\n            throw new df.Error(999, \"Naming conflict with child object '{{0}}'\", this, [tDef.sName]);\r\n        }\r\n\r\n        oObj._bIsDynamic = true;\r\n        \r\n        //  Set the published property values\r\n        for (let i = 0; i < tDef.aProps.length; i++) {\r\n            sP = tDef.aProps[i].sN;\r\n\r\n            //  Check naming convention\r\n            if (sP.charAt(0) !== \"_\") {\r\n                //  Check if not conficting with child object or function\r\n                if (!oObj[sP] || (typeof (oObj[sP]) !== \"object\" && typeof (oObj[sP]) !== \"function\")) {\r\n                    oObj._set(sP, tDef.aProps[i].sV, false, false);\r\n                } else {\r\n                    throw new df.Error(999, \"Naming conflict with property '{{0}}' of object '{{1}}'\", this, [sP, tDef.sName]);\r\n                }\r\n            } else {\r\n                throw new df.Error(999, \"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'\", this, [tDef.aProps[i].sV, tDef.sName]);\r\n            }\r\n        }\r\n\r\n        //  Set the advanced typed published property values\r\n        if (tDef.aAdvP) {\r\n            for (let i = 0; i < tDef.aAdvP.length; i++) {\r\n                sP = tDef.aAdvP[i].sN;\r\n\r\n                //  Check naming convention\r\n                if (sP.charAt(0) !== \"_\") {\r\n                    if (!oObj[sP] || (typeof (oObj[sP]) !== \"object\" && typeof (oObj[sP]) !== \"function\")) {\r\n                        //  Make sure to mark it as advanced (this is used to determine this when sending a call\r\n                        if (!oObj._oTypes[sP]) {\r\n                            oObj._oTypes[sP] = df.tAdv;\r\n                        }\r\n\r\n                        //  Actually set the property value\r\n                        oObj._set(sP, tDef.aAdvP[i].tV, false, false);\r\n                    } else {\r\n                        throw new df.Error(999, \"Naming conflict with property '{{0}}' of object '{{1}}'\", this, [sP, tDef.sName]);\r\n                    }\r\n                } else {\r\n                    throw new df.Error(999, \"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'\", this, [tDef.aAdvP[i].sV, tDef.sName]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Apply queued WebSet operations\r\n        this.applyQueuedSyncProps(oObj);\r\n\r\n        // Set owner to WebDynamicObjectContainer\r\n        oObj._oOwner = this;\r\n\r\n        if (!bInsert) {\r\n            webApp.newWebObject(oObj, oParent);\r\n        }\r\n\r\n        //  Create children\r\n        for (let i = 0; i < tDef.aObjs.length; i++) {\r\n            this.initDynamicObject.call(this, tDef.aObjs[i], oObj, false);\r\n        }\r\n\r\n        //  Call create\r\n        oObj.create(tDef);\r\n\r\n        return oObj;\r\n    }\r\n\r\n    /*\r\n    Resets the container, including all saved properties.\r\n    */\r\n    resetContainer() {\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            this._aChildren[i].destroy();\r\n        }\r\n\r\n        this._aChildren = [];\r\n        this._aFloats = [];\r\n        this._aUIObjects = [];\r\n        this._aPanels = [];\r\n\r\n        // Reset variables\r\n        this._aSyncPropQueue = [];\r\n        this._bReset = false;\r\n\r\n        this.getWebApp().resize();\r\n    }\r\n\r\n    /*\r\n    Finds and applies all queued SyncProps for the given dynamic object.\r\n    */\r\n    applyQueuedSyncProps(oObj) {\r\n        let vPropValue;\r\n\r\n        const aQueue = this._aSyncPropQueue.filter(function (e) { return e.sO === oObj.getLongName(); })\r\n        this._aSyncPropQueue = this._aSyncPropQueue.filter(function (e) { return e.sO !== oObj._sName; });\r\n\r\n\r\n        // Apply queued synchronized property changes\r\n        for (let i = 0; i < aQueue.length; i++) {\r\n            const tQueuedSyncProp = aQueue[i];\r\n\r\n            if (tQueuedSyncProp.bA) {\r\n                vPropValue = tQueuedSyncProp.tVT;\r\n            } else {\r\n                vPropValue = tQueuedSyncProp.sV;\r\n            }\r\n            oObj._set(tQueuedSyncProp.sP, vPropValue, true, true);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Checks for all cached property operations whether they are still valid applies/discards\r\n    appropriately.\r\n    */\r\n    emptyPropCache() {\r\n        this.handleSyncProps(this._aSyncPropCache);\r\n        this.handleAdvSyncProps(this._aAdvSyncPropCache);\r\n\r\n        this._aSyncPropCache = [];\r\n        this._aAdvSyncPropCache = [];\r\n    }\r\n\r\n    /*\r\n    This method gathers the synchronized properties for this Web Object.\r\n\r\n    @param  aObjs   Reference to the array of synchronized property objects to which the properties are added.\r\n    @param  aAdvProps   Reference to the array in which the advanced sync props are gathered.\r\n    @private\r\n    */\r\n    getSynced(aObjs, aAdvProps) {\r\n        const aProps = [], sObj = this.getLongName();\r\n\r\n        //  Gather synchronized properties\r\n        for (const sProp in this._oSynced) {\r\n            if (this._oSynced.hasOwnProperty(sProp)) {\r\n                let val = this.get(sProp);\r\n\r\n                if (this._oTypes[sProp]) {\r\n                    val = this.toServerType(val, this._oTypes[sProp]);\r\n                }\r\n                if (val === undefined) {\r\n                    val = null;\r\n                }\r\n\r\n                //  Switch between advanced and local synchronized properties\r\n                if (this._oTypes[sProp] === df.tAdv) {\r\n                    aAdvProps.push({\r\n                        sO: sObj,\r\n                        sP: sProp,\r\n                        tV: val\r\n                    });\r\n                } else {\r\n                    aProps.push({\r\n                        sN: sProp,\r\n                        sV: val\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        //  If synced props where found we add it to the list with wrappers\r\n        if (aProps.length > 0) {\r\n            aObjs.push({\r\n                sO: sObj,\r\n                aP: aProps\r\n            });\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates web properties based on the set of web property values provided. It expects the web property \r\n    values to be provided in the format they are received from the server.\r\n\r\n    @param  aProps  Array of web property values.\r\n    @private\r\n    */\r\n    handleSyncProps(aProps) {\r\n        const webApp = this.getWebApp();\r\n\r\n        //  Loop through objects with synced props\r\n        for (let i = 0; i < aProps.length; i++) {\r\n            const tObj = aProps[i];\r\n\r\n            //  Find WebObject\r\n            const oWO = webApp.findObj(tObj.sO);\r\n            if (oWO) {\r\n                //  Loop through props and set them\r\n                for (let x = 0; x < tObj.aP.length; x++) {\r\n                    oWO._set(tObj.aP[x].sN, tObj.aP[x].sV, true, true);\r\n                }\r\n\r\n            } else {\r\n                // I'm not yet sure what we should do here...\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates advanced web properties based on the set of web property values provided. It expects the web \r\n    property values to be provided in the format they are received from the server.\r\n\r\n    @param  aProps  Array of web property values.\r\n    @private\r\n    */\r\n    handleAdvSyncProps(aAdvSyncP) {\r\n        const webApp = this.getWebApp();\r\n\r\n        //  Store advanced sync props\r\n        for (let i = 0; i < aAdvSyncP.length; i++) {\r\n            const tP = aAdvSyncP[i];\r\n            //  Find WebObject\r\n            const oWO = webApp.findObj(tP.sO);\r\n\r\n            if (oWO) {\r\n                //  Loop through props and set them\r\n                oWO._set(tP.sP, tP.tV, true, true);\r\n            } else {\r\n                // I'm not yet sure what we should do here...\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter method for the server variable 'ptSyncPropsWrapper'.\r\n    Receives data regarding synchronized properties from the server\r\n    and sets the values on the client accordingly.\r\n    */\r\n    set_ptSyncPropsWrapper(sVal) {\r\n        const tSyncPropsWrapper = df.sys.vt.deserialize(sVal, df.tSyncPropsWrapper);\r\n\r\n        // Only handle syncprops if there is no incoming reset of the container. If there is, we cache this\r\n        // operation for now and execute it when the reset is done.\r\n        if (!tSyncPropsWrapper.bReset) {\r\n            this.handleSyncProps(tSyncPropsWrapper.aSyncProps);\r\n        } else {\r\n            this._bReset = true;\r\n            this._aSyncPropCache = this._aSyncPropCache.concat(tSyncPropsWrapper.aSyncProps);\r\n        }\r\n\r\n    }\r\n\r\n    /* \r\n    Getter method for the server variable 'ptSyncPropsWrapper'.\r\n    Collects the values of all registered synchronized properties\r\n    and sends them to the server.\r\n    */\r\n    get_ptSyncPropsWrapper() {\r\n        const aPropList = [], aAdvPropList = [];\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            this._aChildren[i].getSynced(aPropList, aAdvPropList);\r\n        }\r\n\r\n        // Sort the properties array for each object\r\n        for (let iObj = 0; iObj < aPropList.length; iObj++) {\r\n            aPropList[iObj].aP.sort(function (a, b) {\r\n                return (a.sN > b.sN) ? 1 : ((b.sN > a.sN) ? -1 : 0);\r\n            })\r\n        }\r\n\r\n        const tSyncPropsWrapper = {\r\n            bReset: this._bReset,\r\n            aSyncProps: aPropList\r\n        }\r\n\r\n        return df.sys.vt.serialize(tSyncPropsWrapper, df.tSyncPropsWrapper);\r\n    }\r\n\r\n    /* \r\n    Setter method for the server variable 'ptAdvSyncPropsWrapper'.\r\n    Receives data regarding advanced synchronized properties from \r\n    the server and sets the values on the client accordingly.\r\n    */\r\n    set_ptAdvSyncPropsWrapper(sVal) {\r\n        const tAdvSyncPropsWrapper = df.sys.vt.deserialize(sVal, df.tAdvSyncPropsWrapper);\r\n\r\n        // The framework expects an unparsed ValueTree, so copy it over from the unparsed parameter\r\n        for (var i = 0; i < sVal.c[1].c.length; i++) {\r\n            tAdvSyncPropsWrapper.aAdvSyncProps[i].tV = sVal.c[1].c[i].c[2];\r\n        }\r\n\r\n        // Only handle advanced syncprops if there is no incoming reset of the container. If there is, we cache this\r\n        // operation for now and execute it when the reset is done.\r\n        if (!tAdvSyncPropsWrapper.bReset) {\r\n            this.handleAdvSyncProps(tAdvSyncPropsWrapper.aAdvSyncProps);\r\n        } else {\r\n            this._bReset = true;\r\n            this._aAdvSyncPropCache = this._aAdvSyncPropCache.concat(tAdvSyncPropsWrapper.aAdvSyncProps);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Getter method for the server variable 'ptAdvSyncPropsWrapper'.\r\n    Collects the values of all registered advanced \r\n    synchronized properties and sends them to the server.\r\n    */\r\n    get_ptAdvSyncPropsWrapper() {\r\n        const aPropList = [], aAdvPropList = [];\r\n\r\n        for (var i = 0; i < this._aChildren.length; i++) {\r\n            this._aChildren[i].getSynced(aPropList, aAdvPropList);\r\n        }\r\n\r\n        // Sort the properties array for each object\r\n        for (var iObj = 0; iObj < aAdvPropList.length; iObj++) {\r\n            aAdvPropList[iObj].aP.sort(function (a, b) {\r\n                return (a.sN > b.sN) ? 1 : ((b.sN > a.sN) ? -1 : 0);\r\n            })\r\n        }\r\n\r\n        const tAdvSyncPropsWrapper = {\r\n            bReset: this._bReset,\r\n            aAdvSyncProps: aAdvPropList\r\n        }\r\n\r\n        return df.sys.vt.serialize(tAdvSyncPropsWrapper, df.tAdvSyncPropsWrapper);\r\n    }\r\n\r\n    /*\r\n    Override to add the $ instead of the . between object names.\r\n    */\r\n    getLongNamePrnt(oOptObj){\r\n        if (oOptObj?._bIsDynamic) {\r\n            return this.getLongName() + \"$\";\r\n        } else {\r\n            super.getLongNamePrnt(oOptObj);\r\n        }\r\n    }\r\n\r\n    onFocus(oEV) {\r\n        //  Intercept onfocus as a container cannot take the focus\r\n    }\r\n\r\n    onBlur(oEV) {\r\n        //  Intercept onfocus as a container cannot take the focus\r\n    }\r\n\r\n    /*\r\n    Serializes an array of advanced syncprops\r\n    */\r\n    serializeAdvSyncProps(tStruct) {\r\n        function composeAdvSyncProp(oObj) {\r\n            return {\r\n                v: \"\",\r\n                c: [{\r\n                    v: oObj.sO.toString(),\r\n                    c: []\r\n                }, {\r\n                    v: oObj.sP.toString(),\r\n                    c: []\r\n                }, this.serializeVT(oObj.tV)]\r\n            };\r\n        }\r\n\r\n        function composeAdvSyncPropsArray(aArray) {\r\n            const tVT = {\r\n                v: \"\",\r\n                c: []\r\n            }\r\n            for (let i = 0; i < aArray.length; i++) {\r\n                tVT.c.push(composeAdvSyncProp(aArray[i]));\r\n            }\r\n            return tVT;\r\n        }\r\n\r\n        function composeAdvSyncPropsObject(oObj) {\r\n            return {\r\n                v: \"\",\r\n                c: [{\r\n                    v: oObj.sO.toString(),\r\n                    c: []\r\n                }, composeAdvSyncPropsArray(oObj.aP)]\r\n            };\r\n        }\r\n\r\n        function composeAdvSyncPropsObjectArray(aArray) {\r\n            const tVT = {\r\n                v: \"\",\r\n                c: []\r\n            };\r\n            for (let i = 0; i < aArray.length; i++) {\r\n                tVT.c.push(composeAdvSyncPropsObject(aArray[i]));\r\n            }\r\n            return tVT;\r\n        }\r\n        try {\r\n            return composeAdvSyncPropsObjectArray(tStruct);\r\n        } catch (oErr) {\r\n            throw new df.Error(999, \"Unable to serialize AdvSyncProps array, invalid data format!\\n\\r\\n\\rMSG: {{0}}\", this, [oErr.message]);\r\n        }\r\n    }\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebCheckbox\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis is the client-side representation of the cWebCheckbox class. It displays a checkbox using the \r\n<input type=\"checkbox\" element.\r\n    \r\nRevision:\r\n    2012/01/09  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebCheckbox extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psChecked\", \"1\");\r\n        this.prop(df.tString, \"psUnchecked\", \"0\");\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n\r\n        this.pbServerOnChange = false;\r\n        this.psClientOnChange = \"\";\r\n\r\n        // @privates\r\n        this._eCaption = null;\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebCheckbox\";\r\n    }\r\n\r\n    /*\r\n    Augments openHtml and adds the checkbox element.\r\n    \r\n    @param  aHtml   Array string builder to add HTML to.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<input type=\"checkbox\" id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\" tabindex=\"-1\"' : ''), '><span class=\"WebCB_Fake\"></span><label class=\"WebCheckbox_Caption\" for=\"', this._sControlId, '\"></label>');\r\n        if (this._oParent?._bIsContainer && this._oParent?.isFlowLayout()) {\r\n            aHtml.push('<div style=\"clear: both\"></div>');\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments afterRender to get a reference to the DOM element.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"input\");\r\n        this._eCaption = df.dom.query(this._eElem, \"label.WebCheckbox_Caption\");\r\n        this._eFakeBox = df.dom.query(this._eElem, \".WebCB_Fake\");\r\n\r\n        this.set_psCaption(this.psCaption);\r\n\r\n        //  Call super\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onClick, this);\r\n        df.dom.on(\"click\", this._eFakeBox, this.onFakeClick, this);\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebBaseDEO logic when the value needs to be read from the user \r\n    interface. The checkbox overrides the default behavior and returns psChecked or psUnchecked \r\n    depending on the state of the checkbox element.\r\n    \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        if (this._eControl) {\r\n            if (this._eControl.checked) {\r\n                return this.psChecked;\r\n            }\r\n            return this.psUnchecked;\r\n        }\r\n\r\n        return this.psValue;\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebBaseDEO logic when the user interface needs to be updated with a new \r\n    value. When sVal is equal to psChecked we display the checkbox as checked.\r\n    \r\n    @param  sVal    The new value to display.\r\n    */\r\n    setControlValue(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.checked = (sVal === this.psChecked);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment the setter for psValue and store the new current vale for the OnChange check. We execute \r\n    get_psValue here because the checkbox can change the value when it is set.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psValue(sVal) {\r\n        super.set_psValue(sVal);\r\n\r\n        //  FIX: Initial value issue\r\n        this._sPrevChangeVal = this.get_psValue();\r\n    }\r\n\r\n    /*\r\n    Update the DOM with the new caption. If the caption really changed we trigger a resize using sizeChanged.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eCaption) {\r\n            df.dom.setText(this._eCaption, sVal);\r\n\r\n            if (this.psCaption !== sVal) {\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Overrides setter for psTextColor so the color is set on the caption.\r\n    \r\n    @param  sVal    The new value.\r\n    @private\r\n    */\r\n    set_psTextColor(sVal) {\r\n        if (this._eCaption) {\r\n            this._eCaption.style.color = sVal || '';\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the psTooltip with fakebox element support.\r\n    \r\n    @param  sVal    The new tooltip.\r\n    @private\r\n    */\r\n    set_psToolTip(sVal) {\r\n        super.set_psToolTip(sVal);\r\n        if (this._eFakeBox) {\r\n            this._eFakeBox.title = sVal;\r\n        }\r\n        if (this._eCaption) {\r\n            this._eCaption.title = sVal;\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    This function inverts the value if the control is enabled. Is called by the grid.\r\n    */\r\n    tick() {\r\n        if (this._eControl && this.isEnabled()) {\r\n            this._eControl.checked = !this._eControl.checked;\r\n\r\n            this.fireChange();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Event handler for the click event that triggers the check for the onchange event.\r\n    \r\n    @param  oEvent  Event details object.\r\n    @private\r\n    */\r\n    onClick(oEvent) {\r\n        this.fireChange();\r\n    }\r\n\r\n    /* \r\n    Handles the click on the fake click element. Ticks the checkbox, gives it the focus and fires the \r\n    OnChange.\r\n    \r\n    @param  oEvent  Event details object.\r\n    @private\r\n    */\r\n    onFakeClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.tick();\r\n            this.focus();\r\n\r\n            this.fireChange();\r\n        }\r\n    }\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebCombo\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis is the client-side representation of the WebCombo class. It displays a combo form data entry \r\nobject. The CSS (class: WebCombo) defines the looks. The combo form is wrapped in an extra wrapper \r\ndiv that allows a custom border to be added.\r\n    \r\nRevision:\r\n    2011/10/06  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\ndf.tWebComboItem = {\r\n    sValue: df.tString,\r\n    sDescription: df.tString\r\n};\r\n\r\n\r\n/*\r\nUse this class to display a combo form on a view. \r\n*/\r\nexport class WebCombo extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"peSortItems\", df.csUnsorted);\r\n\r\n        // @privates\r\n        this._bFilled = false;\r\n        this._sControlClass = \"WebCombo\";\r\n        this._aValues = null;\r\n\r\n        this._bDeferedSet = false; //  Set to true if the value is set to an item unavailable in the list indicating that OnFill should try to select the orrigional psValue. This fixes the issue where WebSet psValue overtakes a Refill.\r\n    }\r\n\r\n    /*\r\n    This method generates the html for the combo and the wrapper div.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebFrm_Wrapper\"><select name=\"', this._sName, '\" id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\" tabindex=\"-1\"' : ''), '></select></div>');\r\n    }\r\n\r\n    /*\r\n    This method gathers references to the HTML elements.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebFrm_Wrapper > select\");\r\n        this._eWrap = df.dom.query(this._eElem, \"div.WebFrm_Wrapper\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onClick, this);\r\n\r\n        this.updateList(this.psValue);\r\n    }\r\n\r\n    /* \r\n    Generates a deserializer function that deserializes a value tree in an array of combo items with \r\n    optimal performance.\r\n    \r\n    @param  tVT     Value tree with data.\r\n    @return Array of combo item objects.\r\n    */\r\n    deserializeVT = df.sys.vt.generateDeserializer([df.tWebComboItem]);\r\n\r\n    /*\r\n    This method fills the list of items with the items received as action data. It has to decode the \r\n    action data from the array of rows with values into value & description objects. Then it will update \r\n    the rendered list with this new data.\r\n    \r\n    @client-action\r\n    */\r\n    fill() {\r\n        const tVT = this._tActionData;\r\n\r\n        //  Update the values list\r\n        this._aValues = this.deserializeVT(tVT);\r\n\r\n        this.sortList();\r\n        this.updateList(this._sPrevChangeVal);  //  We use _sPrevChangeVal because it is updated by OnChange and set_psValue, so it always has the right value\r\n    }\r\n\r\n    /* \r\n    Sorts the list of combo items based on the peSortItems property which determines if the sorting is \r\n    performed on the value or on the description. If sorting on the value the peDataType is used to \r\n    determine the right comparison mode.\r\n    \r\n    @private\r\n    */\r\n    sortList() {\r\n\r\n        if (this.peSortItems === df.csValue) {\r\n            //  Sort on value, use the proper comparison function based on the data type\r\n            const fCompare = df.sys.data.compareFunction(this.peDataType);\r\n            this._aValues.sort(function (a, b) {\r\n                return fCompare(a.sValue, b.sValue);\r\n            });\r\n        } else if (this.peSortItems === df.csDescription) {\r\n            //  Sort on the description\r\n            this._aValues.sort(function (a, b) {\r\n                return df.sys.data.compareText(a.sDescription, b.sDescription);\r\n            });\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method refills the list according to the this._aValues array of items.\r\n    \r\n    @private\r\n    */\r\n    updateList(sValue) {\r\n        const aValues = this._aValues;\r\n\r\n        if (this._eControl && aValues) {\r\n            //df.debug(this._sName + \" updateList with \" + aValues.length + \" items!\");\r\n\r\n\r\n            //  Clear the list\r\n            while (this._eControl.options.length > 0) {\r\n                this._eControl.remove(0);\r\n            }\r\n\r\n            //  Fill the list\r\n            for (let i = 0; i < aValues.length; i++) {\r\n                const eOpt = new Option(aValues[i].sDescription, aValues[i].sValue);\r\n                this._eControl.options[this._eControl.options.length] = eOpt; //.add(eOpt);\r\n\r\n                //  Set as selected if needed\r\n                if (aValues[i].sValue === sValue) {\r\n                    eOpt.selected = true;\r\n                }\r\n            }\r\n\r\n            //  Remember that we filled\r\n            this._bFilled = true;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method overrides the getter of the psValue property and makes sure that the control value is \r\n    not used when the combo doesn't have its items yet.\r\n    \r\n    @private\r\n    */\r\n    getControlValue() {\r\n        if (this._eControl && this._bFilled) {\r\n            return this._eControl.value;\r\n        }\r\n\r\n        return this.psValue;\r\n    }\r\n\r\n    /* \r\n    Overrides the setControlValue of WebBaseDEO and updates the _bDeferedSet indicator if we could not \r\n    set the value (it was not in the list) indicating that a refill should update to the psValue.\r\n    \r\n    @param  sVal    New value to display.\r\n    @private\r\n    */\r\n    setControlValue(sVal) {\r\n        if (this._eControl && this._bFilled) {\r\n            this._eControl.value = sVal;\r\n\r\n            this._bDeferedSet = this._eControl.value !== sVal;\r\n        } else {\r\n            this._bDeferedSet = true;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment the fireChange to set the _bDeferedSet indicator back to false as the value is now change \r\n    by the user.\r\n    \r\n    @private\r\n    */\r\n    fireChange() {\r\n        this._bDeferedSet = false;\r\n\r\n        super.fireChange();\r\n    }\r\n\r\n    /*\r\n    Override the default pbCapslock functionallity which sets the CSS text transform. We don't want that \r\n    for the combo.\r\n    */\r\n    set_pbCapslock(bVal) {\r\n\r\n    }\r\n\r\n    /*\r\n    This setter sets the background color of the field. The background color is applied to the wrapper \r\n    div element.\r\n    \r\n    @param  sVal    The bew value.\r\n    @private\r\n    */\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eWrap) {\r\n            this._eWrap.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    /*\r\n    Event handler for the click event that triggers the check for the onchange event.\r\n    \r\n    @param  oEvent  Event details object.\r\n    @private\r\n    */\r\n    onClick(oEvent) {\r\n        this.fireChange();\r\n    }\r\n\r\n    /*\r\n    Augments the event handler for the keypress event and triggers the check for the onchange event.\r\n    \r\n    @param  oEvent  Event details object.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const that = this;\r\n\r\n        super.onKey(oEvent);\r\n\r\n        //  TODO: Find a cleaner way to trigger onChange..\r\n        setTimeout(function () {\r\n            that.fireChange();\r\n        }, 10);\r\n    }\r\n}","import { WebForm } from './WebForm.js';\r\n/*\r\nClass:\r\n    df.WebBaseSelectionForm\r\nExtends:\r\n    df.WebForm\r\n\r\nThis is the base class for the: cWebSelectionForm and the cWebTagsForm.\r\n\r\nRevision:\r\n    2020/09/25  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebBaseSelectionForm extends WebForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbCaseSensitive\", false);\r\n        this.prop(df.tBool, \"pbFullText\", false);\r\n        this.prop(df.tInt, \"piPageSize\", 15);\r\n        this.prop(df.tInt, \"piStartAtChar\", 2);\r\n        this.prop(df.tInt, \"piPopupWidth\", 0);\r\n        this.prop(df.tString, \"psShowMoreText\", \"Show more...\");\r\n        this.prop(df.tString, \"psCreateNewItemText\", \"Create new item\");\r\n        this.prop(df.tBool, \"pbSourceIsValidationTable\", false);\r\n        this.prop(df.tInt, \"piMinimumItemLength\", 2);\r\n        this.prop(df.tBool, \"pbAllowCreate\", false);\r\n        this.prop(df.tInt, \"piTypeTimeout\", 20);\r\n\r\n        this.prop(df.tBool, \"pbAllData\", false);\r\n        this.prop(df.tBool, \"pbSuggestions\", false);\r\n        this.prop(df.tBool, \"pbPaged\", false);\r\n\r\n        this._eSuggestions = null;\r\n        this._bForceDisplay = false;\r\n        this._tRepos = null;\r\n        this._aSuggestRows = [];\r\n        this._aShownSuggestions = [];\r\n        this._oSelectedSuggestion = null;\r\n        this._iMaxCells = 1;\r\n        this._bFirstFetch = true;\r\n        this._TotalOfControlRows = 0;\r\n        this._ShowNextHandle = false;\r\n\r\n        this._iPage = 0;\r\n        this._iAdditionalItems = 0;\r\n        this._oPrevItem = null;\r\n    }\r\n\r\n    afterRender() {\r\n        // Create elem.\r\n        this._eSuggestions = df.dom.create('<div class=\"WebBaseSelectionForm WebSuggestions' +\r\n            ((this.psCSSClass.length > 0) ? \" \" + this.psCSSClass : '') + ' WebSug_Hidden\"><div class=\"WebSug_Content\"></div></div>');\r\n        this._eSugContent = df.dom.query(this._eSuggestions, \"div.WebSug_Content\");\r\n        this._eSugSuggestions = df.dom.create('<div class=\"WebSug_Suggestions\"></div>');\r\n        this._eSugControls = df.dom.create('<div class=\"WebSug_Controls\"></div>');\r\n\r\n        this._eSugContent.appendChild(this._eSugSuggestions);\r\n        this._eSugContent.appendChild(this._eSugControls);\r\n\r\n        this._eInputBox = df.dom.query(this._eElem, \".WebFrm_PromptSpacer\");\r\n        this._eControl = df.dom.query(this._eInputBox, \"input\");\r\n\r\n        super.afterRender();\r\n\r\n        // Insert.\r\n        df.dom.addClass(this._eElem, \"WebSelectionForm\");\r\n\r\n        const eTopLayer = this.topLayer() || document.body;\r\n        eTopLayer.appendChild(this._eSuggestions);\r\n\r\n        // Setup event handlers.\r\n        df.dom.on(\"keyup\", this._eControl, this.onSuggestKey, this);\r\n        df.dom.on(\"click\", this._eSuggestions, this.onSuggestClick, this);\r\n        df.dom.on(\"click\", this._eInputBox, this.inputBoxOnClick, this);\r\n        df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n\r\n        this.set_pbReadOnly(this.pbReadOnly);\r\n        this.set_pbEnabled(this.isEnabled());\r\n    }\r\n\r\n    /*\r\n    Get the value from the inputfield.\r\n    */\r\n    getSearchValue() {\r\n        if (this.pbReadOnly) return \"\";\r\n        return (this.pbCapslock ? this.getServerVal().toUpperCase() : this.getServerVal());\r\n    }\r\n\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl && !(this.pbReadOnly && bVal)) {\r\n            this._eControl.contentEditable = bVal;\r\n        }\r\n    }\r\n\r\n    set_pbReadOnly(bVal) {\r\n        this.pbReadOnly = bVal;\r\n        if (this._eControl && !(!this.pbReadOnly && !this.isEnabled())) {\r\n            this._eControl.contentEditable = !this.pbReadOnly;\r\n        }\r\n        this.set_pbPromptButton(this.pbPromptButton && !bVal);\r\n    }\r\n\r\n    /*\r\n    Due to CSS styling the whole form isn't stretched in contrast to the tags.\r\n    This function is called if clicked whithin the whitespace of the inputbox, and the focus will still go to the inputfield.\r\n\r\n    @private\r\n    */\r\n    inputBoxOnClick(oEvent) {\r\n        if (window.getSelection().type != \"Range\" && this.isEnabled()) {\r\n            this._eControl.focus();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Selects the item by sending a call to the server with the selected suggestion details.\r\n    */\r\n    suggestSelect() {\r\n        const sValue = this.getSearchValue().trim();\r\n        if (this._oSelectedSuggestion && this._oSelectedSuggestion.control) {\r\n            switch (this._oSelectedSuggestion.sRowId) {\r\n                case \"more\":\r\n                    this.handleMoreButton();\r\n                    this.suggestMove(-1);\r\n                    return;\r\n                case \"create\":\r\n                    if (this.isEnabled() && this.pbAllowCreate && sValue.length >= this.piMinimumItemLength) {\r\n                        this.serverAction(\"CreateNewByValue\", [sValue], null, null);\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        else if (this.isEnabled() && this.pbAllowCreate == 1 && sValue.length >= this.piMinimumItemLength) {\r\n            this.serverAction(\"CreateNewByValue\", [sValue], null, null);\r\n        }\r\n        this._eControl.value = \"\";\r\n        this.suggestHide();\r\n    }\r\n\r\n    handleMoreButton() {\r\n        if (this._bLastItemOnServer) return;\r\n        if (!this._bMoreRequested) {\r\n            this._bMoreRequested = true;\r\n            if (this.pbPaged) this._iPage++;\r\n            this.suggestLoad();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the click event of the suggestionlist.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onSuggestClick(oEvent) {\r\n        let oElem = oEvent.getTarget();\r\n\r\n        while (oElem.tagName !== \"TR\" && oElem.parentNode && oElem !== this._eSugContent) {\r\n            oElem = oElem.parentNode;\r\n        }\r\n        if (oElem.hasAttribute(\"data-dfrowid\")) {\r\n            let oRow = this._aShownSuggestions[parseInt(oElem.getAttribute(\"data-dfrowid\"))];\r\n            if (oRow) {\r\n                this.suggestHightlight(oRow);\r\n                this.suggestSelect();\r\n                this.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method updates the suggestion list according to the current field value. It will initiate the \r\n    loading of values from the server, refinement on the client and will hide the list if needed.\r\n    */\r\n    suggestUpdate() {\r\n        this.updateTypeVal();\r\n        const sVal = this.getSearchValue().trim();\r\n\r\n        if (sVal !== this._sSuggestPrevVal || this._bForceDisplay) {\r\n            this._sSuggestPrevVal = sVal;\r\n            if (sVal.length >= this.piStartAtChar || this._bForceDisplay) {\r\n                if (this._bSuggestVisible) {\r\n                    if (this._sSuggestBaseVal) {\r\n                        if (sVal.substr(0, this._sSuggestBaseVal.length) == this._sSuggestBaseVal) {\r\n                            this.suggestRefine(sVal);\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n                this.suggestDisplay();\r\n                this.suggestLoad();\r\n            }\r\n            else if (this._bSuggestVisible) {\r\n                this.suggestHide();\r\n            }\r\n        }\r\n    }\r\n\r\n    clientFilter(aList, callbackOnLoop) {\r\n        const aFiltered = [];\r\n        const sCurVal = this.getSearchValue();\r\n        const oRegEx = new RegExp(df.sys.data.escapeRegExp(sCurVal), (this.pbCaseSensitive || this.pbCapslock ? '' : 'i'));\r\n\r\n        for (let i = 0; i < aList.length; i++) {\r\n            if (aList[i].control) {\r\n                aFiltered.push(aList[i]);\r\n                continue;\r\n            }\r\n            for (let x = 0; x < aList[i].aValues.length; x++) {\r\n                if (this.pbFullText) {\r\n                    if (oRegEx.test(aList[i].aValues[x])) {\r\n                        aFiltered.push(aList[i]);\r\n                        if (callbackOnLoop) callbackOnLoop(aList[i]);\r\n                        break;\r\n                    }\r\n                } else {\r\n                    if (this.pbCaseSensitive || this.pbCapslock) {\r\n                        if (aList[i].aValues[x].indexOf(sCurVal) == 0) {\r\n                            aFiltered.push(aList[i]);\r\n                            if (callbackOnLoop) callbackOnLoop(aList[i]);\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        if (aList[i].aValues[x].toLowerCase().indexOf(sCurVal.toLowerCase()) == 0) {\r\n                            aFiltered.push(aList[i]);\r\n                            if (callbackOnLoop) callbackOnLoop(aList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.extraFilterOnHandle ? this.extraFilterOnHandle(aFiltered) : aFiltered;\r\n    }\r\n\r\n    /*\r\n    This method is called by the server when new suggestions are loaded. This is usually triggered by \r\n    the FindSuggestions server call. It will process the suggestions and update the display. The \r\n    suggestions are sent as action data (in the value tree format).\r\n    \r\n    @param  sVal    The search value.\r\n    @client-action\r\n    */\r\n    suggestHandle(sVal, bLast) {\r\n        const that = this;\r\n        this._bFirstFetch = false;\r\n        this._bMoreRequested = false;\r\n\r\n        this._bLastItemOnServer = bLast == 1;\r\n\r\n        let sCurVal, bRefine;\r\n        // Load and deserialize suggestions from the action data.\r\n        const aList = this._tActionData;\r\n\r\n        // Get the current control value.\r\n        this.updateTypeVal();\r\n        if (this._eControl) sCurVal = this.getSearchValue();\r\n\r\n        // Check if the value didn't change during the call.\r\n        if (sCurVal !== sVal) {\r\n            if (sCurVal.substr(0, sVal) == sVal)\r\n                bRefine = true;\r\n            else return;\r\n        }\r\n\r\n        this._iMaxCells = 0;\r\n        for (let i = 0; i < aList.length; i++) {\r\n            if (aList[i].aValues.length > this._iMaxCells) this._iMaxCells++;\r\n        }\r\n\r\n        // Update suggestion administration.\r\n        this._sSuggestBaseVal = sVal;\r\n        if (this._iPage > 0 && this.pbPaged) {\r\n            this._aSuggestRows = this._aSuggestRows.concat(aList);\r\n        }\r\n        else {\r\n            this._aSuggestRows = aList;\r\n        }\r\n\r\n        this._oPrevItem = this._aSuggestRows[this._aSuggestRows.length - 1];\r\n\r\n        // Select the first if not found.\r\n        var bFound;\r\n        let aSelectables = this.clientFilter(this._aSuggestRows, function (tRow) {\r\n            bFound = (bFound || (that._oSelectedSuggestion && tRow.aValues[0] == that._oSelectedSuggestion.aValues[0]));\r\n        });\r\n\r\n        if (!bFound)\r\n            this._oSelectedSuggestion = (this._aShownSuggestions.length > 0 ? this._aShownSuggestions[0] : null);\r\n\r\n        this._TotalOfControlRows = this.AddControlSuggestions(aSelectables);\r\n\r\n        let iIndex = -1;\r\n        if (this._oSelectedSuggestion) iIndex = this.findIndexByValue(this._oSelectedSuggestion.aValues[0], aSelectables);\r\n        if (iIndex < 0) {\r\n            this._oSelectedSuggestion = (aSelectables.length > 0 ? aSelectables[0] : null);\r\n        } else {\r\n            this._oSelectedSuggestion = aSelectables[iIndex];\r\n        }\r\n\r\n        // Update the display.\r\n        if (bRefine)\r\n            this.suggestRefine(sCurVal);\r\n        else\r\n            this.suggestRender(sVal);\r\n\r\n        if (this._ShowNextHandle) {\r\n            this._ShowNextHandle = false;\r\n            this.showSuggestions();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Intermediate event during handling of incoming lists.\r\n    Currently adding control rows.\r\n    */\r\n    AddControlSuggestions(aList) {\r\n        const iAdded = aList.length;\r\n        const sValue = this.getSearchValue().trim();\r\n        if (!this._bLastItemOnServer && this.pbPaged && aList.length > 0 && !this.pbAllData) aList.push({ control: true, sRowId: \"more\", aValues: [\"(\" + this.psShowMoreText + \")\"], sCssClassName: \"Sugg_ControlSuggestion\" });\r\n        let bShow = true;\r\n        if (this._aShownSuggestions) bShow = !(this._aShownSuggestions.length > 0 && this._aShownSuggestions[0].aValues[0] == sValue);\r\n        if (bShow && this.pbAllowCreate && sValue.length > 0) aList.push({ control: true, sRowId: \"create\", aValues: [\"(\" + this.psCreateNewItemText + (sValue.length > 0 ? \" \\\"\" + df.dom.encodeAttr(df.dom.encodeHtml(sValue)) + \"\\\"\" : \"\") + \")\"], sCssClassName: \"Sugg_ControlSuggestion\" });\r\n\r\n        return aList.length - iAdded;\r\n    }\r\n\r\n    /* \r\n    Updates the displayed suggestion list.\r\n    \r\n    @param  sSearch     The current search value.\r\n    */\r\n    suggestRender(sSearch) {\r\n        if (!this._eSuggestions) return;\r\n\r\n        let sLowerSearch, iLen, oRegEx;\r\n        //  Prepare highlight searches\r\n        if (this.pbFullText) {\r\n            oRegEx = new RegExp(df.sys.data.escapeRegExp(sSearch), (this.pbCaseSensitive || this.pbCapslock ? 'g' : 'gi'));\r\n        } else {\r\n            sLowerSearch = sSearch.toLowerCase();\r\n            iLen = sSearch.length;\r\n        }\r\n\r\n        const that = this;\r\n        function renderSuggestion(iIndex, oSuggestion, aHtml) {\r\n            function makeBold(sMatch) {\r\n                return '<b>' + sMatch + '</b>';\r\n            }\r\n\r\n            let x = 0;\r\n            aHtml.push('<tr data-dfrowid=\"',\r\n                iIndex,\r\n                '\" class=\"WebSug_Suggestion ',\r\n                oSuggestion.sCssClassName,\r\n                (that._oSelectedSuggestion && oSuggestion.aValues[0] == that._oSelectedSuggestion.aValues[0] ? ' WebSug_Selected' : ''),\r\n                '\">');\r\n\r\n            for (x = 0; x < oSuggestion.aValues.length; x++) {\r\n                const sVal = df.dom.encodeHtml(oSuggestion.aValues[x]);\r\n\r\n                aHtml.push('<td>');\r\n\r\n                // Check whether its a custom row of the control.\r\n                if (oSuggestion.control) {\r\n                    aHtml.push(sVal);\r\n                } else {\r\n                    // Do highlighting\r\n                    if (!that.pbSourceIsValidationTable || x == 0) {\r\n                        if (that.pbFullText) {\r\n                            // Perform a find and replace to highlight keyword(s)\r\n                            aHtml.push(sVal.replace(oRegEx, makeBold));\r\n                        } else {\r\n                            if (sVal.length > 0 && sVal.substr(0, iLen).toLowerCase() == sLowerSearch) {\r\n                                aHtml.push('<b>', sVal.substr(0, iLen), '</b>', sVal.substr(iLen));\r\n                            } else {\r\n                                aHtml.push(sVal);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        aHtml.push(sVal);\r\n                    }\r\n                }\r\n\r\n                aHtml.push('</td>');\r\n            }\r\n            while (x++ < that._iMaxCells) {\r\n                aHtml.push('<td></td>');\r\n            }\r\n\r\n            aHtml.push('</tr>');\r\n        }\r\n\r\n        // Used for the caching of control rows.\r\n        const aControls = [];\r\n        this._aShownSuggestions = this.clientFilter(this._aSuggestRows);\r\n        // Add the control suggestion \r\n        this._TotalOfControlRows = this.AddControlSuggestions(this._aShownSuggestions);\r\n\r\n        //  Generate result table\r\n        const aSuggestionsTable = [];\r\n        aSuggestionsTable.push('<table>');\r\n        const iMaxLength = (this.pbSuggestions ? ((this._aShownSuggestions.length < this.piPageSize) ? this._aShownSuggestions.length : this.piPageSize) : this._aShownSuggestions.length);\r\n\r\n        for (let i = 0; i < iMaxLength; i++) {\r\n            // Check if it is a control row and skip\r\n            if (this._aShownSuggestions[i].control) {\r\n                aControls.push({ iIndex: i, oObj: this._aShownSuggestions[i] });\r\n                continue;\r\n            }\r\n\r\n            renderSuggestion(i, this._aShownSuggestions[i], aSuggestionsTable);\r\n        }\r\n        aSuggestionsTable.push('</table>');\r\n\r\n        // Add the controls to a seperate table.\r\n        const aControlsTable = [];\r\n        aControlsTable.push('<table>')\r\n        for (let i = 0; i < this._TotalOfControlRows; i++) {\r\n            renderSuggestion(aControls[i].iIndex, aControls[i].oObj, aControlsTable);\r\n        }\r\n        aControlsTable.push('</table>');\r\n\r\n        this._eSugSuggestions.innerHTML = aSuggestionsTable.join(\"\");\r\n        this._eSugControls.innerHTML = aControlsTable.join(\"\");\r\n        this.suggestPosition();\r\n    }\r\n\r\n    /* \r\n    This method performs the client-side filtering / refinement using the search value. It will go over \r\n    the available suggestions and remove the items that do not apply the filter. If we were starting \r\n    with the maximum amount of suggestions it will trigger suggestLoad to reload from the server as \r\n    there might be more matches.\r\n    \r\n    @param  sSearch     The search string.\r\n    */\r\n    suggestRefine(sFilter) {\r\n        const that = this;\r\n        let bFound = false;\r\n        this._aShownSuggestions = this.clientFilter(this._aSuggestRows, function (tRow) {\r\n            bFound = (bFound || (that._oSelectedSuggestion && tRow.aValues[0] == that._oSelectedSuggestion.aValues[0]));\r\n        });\r\n        if (!bFound)\r\n            this._oSelectedSuggestion = (this._aShownSuggestions.length > 0 ? this._aShownSuggestions[0] : null);\r\n\r\n        this.suggestRender(sFilter);\r\n        if (this._bSuggestVisible) this.suggestDisplay();\r\n        this.afterSuggestRefine();\r\n    }\r\n\r\n    afterSuggestRefine(sFilter) {\r\n        if (this._aShownSuggestions.length - this._TotalOfControlRows < this.piPageSize && !this._bLastItemOnServer && this.pbPaged) {\r\n            this.handleMoreButton();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Moves the selection suggestion up or down.\r\n    \r\n    @param  iDir    Direction (-1 goes one up and 1 goes one down).\r\n    @private\r\n    */\r\n    suggestMove(iDir) {\r\n        const aList = this._aShownSuggestions = this.clientFilter(this._aSuggestRows);\r\n\r\n        this._TotalOfControlRows = this.AddControlSuggestions(aList);\r\n\r\n        if (this._oSelectedSuggestion) {\r\n            const i = this.findIndexByValue(this._oSelectedSuggestion.aValues[0], aList) + iDir;\r\n            if (i >= aList.length) i = 0;\r\n            else if (i < 0) i = aList.length - 1;\r\n\r\n            this.suggestHightlight(aList[i]);\r\n        }\r\n        else\r\n            this.suggestHightlight(aList.length > 0 ? aList[0] : null);\r\n    }\r\n\r\n    /*\r\n    Highlights the specified suggestion in the list by applying the WebSug_Selected CSS Classname to its \r\n    tr DOM element.\r\n    \r\n    @param  oSelectedSuggestion, Suggestion to be selected.\r\n    @private\r\n    */\r\n    suggestHightlight(oSelectedSuggestion) {\r\n        let bFound;\r\n\r\n        this._oSelectedSuggestion = oSelectedSuggestion;\r\n\r\n        this._aShownSuggestions = this.clientFilter(this._aSuggestRows);\r\n        this._TotalOfControlRows = this.AddControlSuggestions(this._aShownSuggestions);\r\n        for (let i = 0; i < this._aShownSuggestions.length; i++) {\r\n            bFound = (this._oSelectedSuggestion && this._aShownSuggestions[i].aValues[0] == this._oSelectedSuggestion.aValues[0]);\r\n            if (bFound) break;\r\n        }\r\n        if (!bFound)\r\n            this._oSelectedSuggestion = (this._aShownSuggestions.length > 0 ? this._aShownSuggestions[0] : null);\r\n\r\n        this.updateTypeVal();\r\n        this.suggestRender(this.getSearchValue());\r\n        const eElem = df.dom.query(this._eSugSuggestions, \"tr.WebSug_Selected\");\r\n        if (eElem) {\r\n            const iTop = df.sys.gui.getAbsoluteOffset(eElem).top;\r\n            const iBottom = iTop + eElem.offsetHeight;\r\n\r\n            if (iTop - this._eSugSuggestions.scrollTop < 0) {\r\n                this._eSugSuggestions.scrollTop = iTop;\r\n            } else if (iBottom > this._eSugSuggestions.clientHeight + this._eSugSuggestions.scrollTop) {\r\n                this._eSugSuggestions.scrollTop = iBottom - this._eSugSuggestions.clientHeight;\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Finds the RowId in the suggestion list.\r\n    \r\n    @param sValue\r\n    @retval Either of type tRow or null.\r\n    @private\r\n    */\r\n    findSuggestionByValue(sValue) {\r\n        const iIndex = this.findIndexByValue(sValue, this._aSuggestRows);\r\n        return ((iIndex != -1) ? this._aSuggestRows[iIndex] : null);\r\n    }\r\n\r\n    /*\r\n    Finds the index of the row in the passed list.\r\n    \r\n    @param sValue\r\n    @param The list to search in.\r\n    @retval Either the correct index or -1 if not found.\r\n    @private\r\n    */\r\n    findIndexByValue(sValue, aList) {\r\n        for (let i = 0; i < aList.length; i++)\r\n            if (aList[i].aValues[0] == sValue)\r\n                return i;\r\n        return -1;\r\n    }\r\n\r\n    /* \r\n    Handles the keyup event and performs the force display if needed.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent);\r\n    @private\r\n    */\r\n    onSuggestKey(oEvent) {\r\n        const oKeys = df.settings.suggestionKeys, iKey = oEvent.getKeyCode();\r\n\r\n        if (!this.isEnabled() || this.pbReadOnly) {\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n\r\n        if (oEvent.matchKey(oKeys.forceDisplay)) {\r\n            this._bForceDisplay = true;\r\n            if (!this._bSuggestVisible) {\r\n                this.suggestDisplay();\r\n            }\r\n            oEvent.stop();\r\n        }\r\n\r\n        if (this._bSuggestVisible || this.getSearchValue().length > 0) {\r\n            this.suggestUpdate();\r\n        } else {\r\n            if (!oEvent.isSpecialKey() && (iKey < 112 || iKey > 127)) { //  Explicitly filter out function keys (to prevent responding to finds)\r\n                this.suggestUpdate();\r\n            }\r\n        }\r\n        this._bForceDisplay = false;\r\n    }\r\n\r\n    /* \r\n    This method displays the loading symbol and sets a small timeout that will perform the loading call. \r\n    This timeout gives the user a chance to continue typing.\r\n    \r\n    @private\r\n    */\r\n    suggestLoad(overrideDoLoad) {\r\n        const that = this;\r\n\r\n        // For overriding the load in pbAllData-Mode.\r\n        if (overrideDoLoad) {\r\n            this._overrideDoLoad = overrideDoLoad;\r\n            this.invalidateCache();\r\n        }\r\n\r\n        df.dom.addClass(this._eSuggestions, \"WebSug_Loading\");\r\n\r\n        if (this._eElem)\r\n            df.dom.addClass(this._eElem, \"WebSug_Loading\");\r\n\r\n        if (!this._tSuggestUpdate) {\r\n            this._tSuggestUpdate = setTimeout(function () {\r\n                that._tSuggestUpdate = null;\r\n\r\n                that.updateTypeVal();\r\n                that.suggestDoLoad(that.getSearchValue());\r\n                if (that._bSuggestVisible) that.suggestDisplay();\r\n            }, this.piTypeTimeout);\r\n        }\r\n    }\r\n\r\n    /* \r\n    This method sends the server call that will load new suggestions. This method sends the server call \r\n    that will load new suggestions. If a call is already being performed it will wait until that call is \r\n    finished before sending a new call.\r\n    \r\n    @param  sVal    The search value.\r\n    @private\r\n    */\r\n    suggestDoLoad(sVal) {\r\n        // pbAllData needs to load all rows so with no filter.\r\n        if (this.pbAllData) {\r\n            sVal = \"\";\r\n        }\r\n\r\n        if (!this.pbAllData || this._aSuggestRows.length === 0 || this._overrideDoLoad) {\r\n            this._overrideDoLoad = false; // Unset override either way; if we need to check it costs extra.\r\n            if (!this._bSuggestLoading && this.isEnabled()) {\r\n                this._bSuggestLoading = true;\r\n\r\n                // Instantiate the finding of suggestions with the input value from the inputbox.\r\n                this.serverAction(\"FindSuggestions\", [sVal, this._iPage, this._iAdditionalItems], this._oPrevItem, function () {\r\n                    this._bSuggestLoading = false;\r\n\r\n                    // If the value changed, re-search for the suggestions.\r\n                    // Otherwise remove the loading CSS.\r\n                    if (this._sSuggestNextLoad) {\r\n                        this.suggestDoLoad(this._sSuggestNextLoad);\r\n                        this._sSuggestNextLoad = null;\r\n                    } else {\r\n                        if (this._eSuggestions)\r\n                            df.dom.removeClass(this._eSuggestions, \"WebSug_Loading\");\r\n\r\n                        if (this._eElem)\r\n                            df.dom.removeClass(this._eElem, \"WebSug_Loading\");\r\n\r\n                        if (this._bSuggestVisible) this.suggestDisplay();\r\n                    }\r\n\r\n                }, this);\r\n            }\r\n            else\r\n                this._sSuggestNextLoad = sVal;\r\n        }\r\n        else\r\n            this.suggestHightlight(this._oSelectedSuggestion);\r\n    }\r\n\r\n    /* \r\n    This method displays the suggestion box by setting the proper CSS Classnames.\r\n    */\r\n    suggestDisplay() {\r\n        // Avoid display if content is 0.\r\n        const hSuggestionsBody = df.dom.query(this._eSugSuggestions, \"tbody\");\r\n        const hControlsBody = df.dom.query(this._eSugControls, \"tbody\");\r\n        if (hSuggestionsBody) {\r\n            if (hSuggestionsBody.childNodes.length == 0 && hControlsBody.childNodes.length == 0) {\r\n                this.suggestHide();\r\n                return;\r\n            }\r\n        }\r\n        else if (!this._bFirstFetch) {\r\n            // It might be that there are controls thus check for that first, if there are continue.\r\n            // For example the Create.\r\n            let bReturn = true;\r\n            if (hControlsBody) {\r\n                if (hControlsBody.childNodes.length > 0) bReturn = false;\r\n            }\r\n            if (bReturn) {\r\n                this.suggestHide();\r\n                this._ShowNextHandle = true;\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (this.isEnabled()) {\r\n            df.dom.addClass(this._eSuggestions, \"WebSug_Visible\");\r\n            df.dom.removeClass(this._eSuggestions, \"WebSug_Hidden\");\r\n\r\n            let iHeight = 0;\r\n            if (hSuggestionsBody) {\r\n\r\n                let iMax = (hSuggestionsBody.childNodes.length > this.piPageSize ? this.piPageSize : hSuggestionsBody.childNodes.length);\r\n                if (iMax > 0) {\r\n                    let oBounds = df.sys.gui.getBoundRect(hSuggestionsBody.childNodes[0]);\r\n                    iHeight = oBounds.height * iMax;\r\n                } else {\r\n                    // It might be that there are controls thus check for that first, if there are continue.\r\n                    // For example the Create.\r\n                    let bReturn = true;\r\n                    if (hControlsBody) {\r\n                        if (hControlsBody.childNodes.length > 0) bReturn = false;\r\n                    }\r\n                    if (bReturn) {\r\n                        this.suggestHide();\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this._eSugSuggestions.style.height = iHeight + \"px\";\r\n\r\n            this.suggestPosition();\r\n            this.suggestHightlight(this._oSelectedSuggestion);\r\n\r\n            this._bSuggestVisible = true;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method calculates the position of the suggestions. It positions the suggestions absolute below \r\n    the wrapper element of the form. If there is no space below the form it will try to position it \r\n    above.\r\n    \r\n    @private\r\n    */\r\n    suggestPosition() {\r\n        const eSugg = this._eSuggestions;\r\n        const eTarget = this._eWrap; //  The element to position next\r\n\r\n        if (eSugg && eTarget) {\r\n            if (df.sys.gui.isOnScreen(eTarget)) {\r\n                eSugg.style.display = \"\";\r\n\r\n                //  Determine position of target (the form)\r\n                const oRect = df.sys.gui.getBoundRect(eTarget);\r\n\r\n                //  Calculate top position\r\n                const iOffsetTop = oRect.bottom; // oRect.top + oRect.height;\r\n\r\n                //  Calculate left position\r\n                const iOffsetLeft = oRect.left;\r\n\r\n                if (oRect.left + (this.piPopupWidth > 0 ? this.piPopupWidth : oRect.width) > window.innerWidth) {\r\n                    iOffsetLeft = window.innerWidth - (this.piPopupWidth > 0 ? this.piPopupWidth : oRect.width);\r\n                }\r\n\r\n                //  Set position\r\n                eSugg.style.top = iOffsetTop + \"px\";\r\n                eSugg.style.left = iOffsetLeft + \"px\";\r\n\r\n                eSugg.style.width = (this.piPopupWidth > 0 ? this.piPopupWidth : oRect.width) + \"px\";\r\n\r\n                if (oRect.bottom + this._eSugSuggestions.clientHeight > window.innerHeight)\r\n                    eSugg.style.top = (oRect.top - this._eSuggestions.clientHeight) + \"px\";\r\n            }\r\n            else\r\n                eSugg.style.display = \"none\";\r\n        }\r\n    }\r\n\r\n    /* \r\n    This method hides the suggestion list. It clears all timers and the suggestion administration. \r\n    Hiding is done by changing the CSS Classnames.\r\n    */\r\n    suggestHide() {\r\n        if (this._eSuggestions) {\r\n            df.dom.addClass(this._eSuggestions, \"WebSug_Hidden\");\r\n            df.dom.removeClass(this._eSuggestions, \"WebSug_Visible\");\r\n\r\n            if (this._tSuggestDisplay) {\r\n                clearTimeout(this._tSuggestDisplay);\r\n                this._tSuggestDisplay = null;\r\n            }\r\n            if (this._tSuggestUpdate) {\r\n                clearTimeout(this._tSuggestUpdate);\r\n                this._tSuggestUpdate = null;\r\n            }\r\n\r\n            this._oSelectedSuggestion = null;\r\n        }\r\n\r\n        this.updateTypeVal();\r\n        this._sSuggestPrevVal = this.getSearchValue();\r\n        this._bSuggestVisible = false;\r\n        this._bForceDisplay = false;\r\n    }\r\n\r\n    invalidateCache() {\r\n        if (!this.pbAllData) {\r\n            this._iPage = 0;\r\n            this._bLastItemOnServer = false;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Enforces the display and loading of suggestions. Designed to be used from the server or as event \r\n    handler on psClientOnPrompt.\r\n    \r\n    @client-action\r\n    */\r\n    showSuggestions() {\r\n        this._bForceDisplay = true;\r\n        this.suggestDisplay();\r\n        this.suggestUpdate();\r\n        this.focus();\r\n    }\r\n\r\n\r\n    /* \r\n    Augments the key handler and implements the key operations.\r\n    \r\n    NOTE: The WebColumnSuggestion has its own onKey handler!\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const oKeys = df.settings.suggestionKeys;\r\n\r\n        if (!this.isEnabled() || this.pbReadOnly) {\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n\r\n        if (!oEvent.bCanceled) super.onKey(oEvent);\r\n        if (!oEvent.bCanceled) {\r\n            if (oEvent.matchKey(oKeys.escape) && this._bSuggestVisible) {\r\n                this.suggestHide();\r\n            } else if (oEvent.matchKey(oKeys.select)) {\r\n                this.suggestSelect();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(oKeys.moveUp)) {\r\n                if (!this._bSuggestVisible) this.showSuggestions();\r\n                this.suggestMove(-1);\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(oKeys.moveDown)) {\r\n                if (!this._bSuggestVisible) this.showSuggestions();\r\n                this.suggestMove(1);\r\n                oEvent.stop();\r\n            } else {\r\n                this.invalidateCache();\r\n\r\n                // Fixes a bug in which a first character might come up with no suggestions.\r\n                // We need to invalidate the cache afterwards and thus re-lookup suggestions for an empty value.\r\n                if ((oEvent.matchKey(oKeys.backSpace) || oEvent.matchKey(oKeys.delete)) && this.getSearchValue().length <= 1) {\r\n                    this.suggestLoad();\r\n                }\r\n            }\r\n\r\n            //  Make sure force display doesn't change value\r\n            if (oEvent.matchKey(oKeys.forceDisplay)) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Listener of the window resize and scroll events. Triggers a reposition action and repeats that after \r\n    a small timeout.\r\n    \r\n    @param  oEvent  DOM Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onWindowResize(oEvent) {\r\n        const that = this;\r\n\r\n        if (!this._tRepos) {\r\n            setTimeout(function () {\r\n                if (that._bSuggestVisible) that.suggestPosition();\r\n                that._tRepos = null;\r\n            }, 40);\r\n        }\r\n\r\n        if (this._bSuggestVisible) this.suggestPosition();\r\n    }\r\n\r\n    /* \r\n    Augment the blur event and hide the suggestion list.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent);\r\n    @private\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n\r\n        super.onBlur(oEvent);\r\n\r\n        if (this._tSugBlurTimeout) {\r\n            clearTimeout(this._tSugBlurTimeout);\r\n            this._tSugBlurTimeout = null;\r\n        }\r\n\r\n        this._tSugBlurTimeout = setTimeout(function () {\r\n            if (!that._bHasFocus) {\r\n                that.suggestHide();\r\n            }\r\n\r\n            if (that.afterBlur) that.afterBlur();\r\n        }, 500);\r\n    }\r\n\r\n    onPromptClick(oEvent) {\r\n        if (this.isEnabled() && !this.pbReadOnly) {\r\n            //  Tell webapp object that we have the focus but do not give ourselve the actual focus (prevent Mobile Keyboard flashing)\r\n            this.objFocus();\r\n\r\n            // Former suggestionsform behaviour don't behave like a combo.\r\n            if (this.firePrompt()) {\r\n                oEvent.stopPropagation();\r\n            } else {\r\n                //  If the prompt button doesn't do anything we still need to give ourself the real focus\r\n                this.focus();\r\n\r\n                if (!this._bSuggestVisible)\r\n                    this.showSuggestions();\r\n                else\r\n                    this.suggestHide();\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { WebForm } from './WebForm.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebSuggestionForm\r\nExtends:\r\n    df.WebForm\r\n\r\nImplementation of the web suggestion form that is capable of showing a list of suggestions while \r\ntyping. These suggestions can come from a variety of sources which is mainly determined on the \r\nserver.\r\n\r\nRevision:\r\n    2013/10/12  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebSuggestionForm extends WebForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psPopupCSSClass\", \"\");\r\n\r\n        this.prop(df.tInt, \"peSuggestionMode\", df.smFind);\r\n        this.prop(df.tBool, \"pbCaseSensitive\", false);\r\n        this.prop(df.tBool, \"pbAllowForce\", true);\r\n        this.prop(df.tBool, \"pbFullText\", false);\r\n        this.prop(df.tBool, \"pbHighlight\", true);\r\n        this.prop(df.tBool, \"pbShowResults\", true);\r\n        this.prop(df.tInt, \"piMaxResults\", 15);\r\n        this.prop(df.tInt, \"piStartAtChar\", 2);\r\n        this.prop(df.tInt, \"piSuggestionWidth\", 0);\r\n\r\n        this.prop(df.tBool, \"pbClientRefinement\", true);\r\n\r\n        this.prop(df.tInt, \"piPopupTimeout\", 50);\r\n        this.prop(df.tInt, \"piTypeTimeout\", 20);\r\n\r\n        this.event(\"OnHideSuggestions\", df.cCallModeDefault);\r\n\r\n        this._eSuggestions = null;\r\n        this._bForceDisplay = false;\r\n        this._tRepos = null;\r\n        this._aScrollListeners = null;\r\n\r\n        this._sSelectedId = null;\r\n    }\r\n\r\n    /* \r\n    Augment openHtml to insert hidden suggestion list div elements.\r\n    \r\n    @param  aHtml   String builder array.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        //aHtml.push('<div class=\"WebSuggestions WebSug_Hidden\"><div class=\"WebSug_Content\"></div><div>'); \r\n    }\r\n\r\n    /* \r\n    Augment afterRender to initialize suggestionlist (find elements, attach listeners).\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //this._eSuggestions = df.dom.query(this._eElem, \"div.WebSuggestions\");\r\n        //this._eSugContent = df.dom.query(this._eElem, \"div.WebSug_Content\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"keyup\", this._eControl, this.onSuggestKey, this);\r\n\r\n    }\r\n\r\n    initDOM() {\r\n        //  Create elem\r\n        this._eSuggestions = df.dom.create('<div class=\"WebSuggestions WebSug_Hidden ' + this.psPopupCSSClass + '\"><div class=\"WebSug_Content\"></div><div>');\r\n        this._eSugContent = df.dom.query(this._eSuggestions, \"div.WebSug_Content\");\r\n\r\n        //  Insert\r\n        const eViewPort = this.topLayer() || document.body;\r\n        eViewPort.appendChild(this._eSuggestions);\r\n\r\n        df.dom.on(\"click\", this._eSuggestions, this.onSuggestClick, this);\r\n    }\r\n\r\n    /*\r\n    This method updates the suggestion list according to the current field value. It will initiate the \r\n    loading of values from the server, refinement on the client and will hide the list if needed.\r\n    */\r\n    suggestUpdate() {\r\n        const that = this;\r\n\r\n        this.updateTypeVal();\r\n        const sVal = this.getServerVal();\r\n\r\n        if (sVal !== this._sSuggestPrevVal || this._bForceDisplay) {\r\n            this._sSuggestPrevVal = sVal;\r\n\r\n            if (sVal.length >= this.piStartAtChar || this._bForceDisplay) {\r\n                if (this._bSuggestVisible) {\r\n                    if (this.pbClientRefinement && this._sSuggestBaseVal) {\r\n                        if (sVal.substr(0, this._sSuggestBaseVal.length) === this._sSuggestBaseVal) {\r\n                            this.suggestRefine(sVal);\r\n                            return;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (!this._tSuggestDisplay) {\r\n                        this._tSuggestDisplay = setTimeout(function () {\r\n                            that._tSuggestDisplay = null;\r\n                            that.suggestDisplay();\r\n                        }, this.piPopupTimeout);\r\n                    }\r\n                }\r\n\r\n\r\n                this.suggestLoad();\r\n            } else if (this._bSuggestVisible) {\r\n                this.suggestHide();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    This method displays the loading symbol and sets a small timeout that will perform the loading call. \r\n    This timeout gives the user a chance to continue typing.\r\n    \r\n    @private\r\n    */\r\n    suggestLoad() {\r\n        const that = this;\r\n\r\n        if (this.pbShowResults) {\r\n            if (!this._eSuggestions) {\r\n                this.initDOM();\r\n            }\r\n\r\n            df.dom.addClass(this._eSuggestions, \"WebSug_Loading\");\r\n        }\r\n        if (this._eElem) {\r\n            df.dom.addClass(this._eElem, \"WebSug_Loading\");\r\n        }\r\n\r\n        if (!this._tSuggestUpdate) {\r\n            this._tSuggestUpdate = setTimeout(function () {\r\n                that._tSuggestUpdate = null;\r\n\r\n                that.updateTypeVal();\r\n                that.suggestDoLoad(that.getServerVal());\r\n            }, this.piTypeTimeout);\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    This method sends the server call that will load new suggestions. This method sends the server call \r\n    that will load new suggestions. If a call is already being performed it will wait until that call is \r\n    finished before sending a new call.\r\n    \r\n    @param  sVal    The search value.\r\n    @private\r\n    */\r\n    suggestDoLoad(sVal) {\r\n        if (!this._bSuggestLoading) {\r\n            this._bSuggestLoading = true;\r\n\r\n            this.serverAction(\"FindSuggestions\", [sVal], null, function () {\r\n                this._bSuggestLoading = false;\r\n\r\n                if (this._sSuggestNextLoad) {\r\n                    this.suggestDoLoad(this._sSuggestNextLoad);\r\n                    this._sSuggestNextLoad = null;\r\n                } else {\r\n                    if (this._eSuggestions) {\r\n                        df.dom.removeClass(this._eSuggestions, \"WebSug_Loading\");\r\n                    }\r\n                    if (this._eElem) {\r\n                        df.dom.removeClass(this._eElem, \"WebSug_Loading\");\r\n                    }\r\n                }\r\n\r\n            }, this);\r\n        } else {\r\n            this._sSuggestNextLoad = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called by the server when new suggestions are loaded. This is usually triggered by \r\n    the FindSuggestions server call. It will process the suggestions and update the display. The \r\n    suggestions are sent as action data (in the value tree format).\r\n    \r\n    @param  sVal    The search value.\r\n    @client-action\r\n    */\r\n    suggestHandle(sVal) {\r\n        let bFound = false, bRefine;\r\n\r\n        //  Load and deserialize suggestions from the action data\r\n        const aList = this._tActionData;\r\n\r\n        //  Get the current control value\r\n        this.updateTypeVal();\r\n        const sCurVal = this.getServerVal();\r\n\r\n        //  Check if the value didn't change during the call\r\n        if (sCurVal !== sVal) {\r\n            if (this.pbClientRefinement && sCurVal.substr(0, sVal) === sVal) {\r\n                bRefine = true;\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n\r\n        //  Update suggestion administration\r\n        this._sSuggestBaseVal = sVal;\r\n        this._aSuggestBase = this._aSuggestRows = aList;\r\n\r\n        //  Refind the selected value value\r\n        for (let i = 0; i < aList.length; i++) {\r\n            if (aList[i].sRowId === this._sSelectedId) {\r\n                bFound = true;\r\n            }\r\n        }\r\n        //  Select the first if not found\r\n        if (!bFound) {\r\n            this._sSelectedId = (aList.length > 0 ? aList[0].sRowId : null);\r\n        }\r\n\r\n        //  Update the display\r\n        if (bRefine) {\r\n            this.suggestRefine(sCurVal);\r\n        } else {\r\n            this.suggestRender(sVal);\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    This method displays the suggestion box by setting the proper CSS Classnames.\r\n    */\r\n    suggestDisplay() {\r\n        if (this.isEnabled()) {\r\n            if (this.pbShowResults) {\r\n                if (!this._eSuggestions) {\r\n                    this.initDOM();\r\n                }\r\n\r\n                if (!this._aSuggestRows) {\r\n                    this._eSugContent.innerHTML = \"\";\r\n                }\r\n\r\n                this.suggestPosition();\r\n\r\n                df.dom.addClass(this._eSuggestions, \"WebSug_Visible\");\r\n                df.dom.removeClass(this._eSuggestions, \"WebSug_Hidden\");\r\n\r\n                this.suggestPosition();\r\n\r\n                df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n                this._aScrollListeners = df.sys.gui.addScrollListeners(this._eWrap, this.onWindowResize, this);\r\n            }\r\n            this._bSuggestVisible = true;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method calculates the position of the suggestions. It positions the suggestions absolute below \r\n    the wrapper element of the form. If there is no space below the form it will try to position it \r\n    above.\r\n    \r\n    @private\r\n    */\r\n    suggestPosition() {\r\n\r\n        const eSugg = this._eSuggestions;\r\n        const eTarget = this._eWrap; //  The element to position next\r\n\r\n        if (eSugg && eTarget) {\r\n            if (df.sys.gui.isOnScreen(eTarget)) {\r\n                eSugg.style.display = \"\";\r\n\r\n                //  Determine position of target (the form)\r\n                const oRect = df.sys.gui.getBoundRect(eTarget);\r\n\r\n                //  Calculate top position\r\n                const iOffsetTop = oRect.bottom; // oRect.top + oRect.height;\r\n\r\n                //  Calculate left position\r\n                let iOffsetLeft = oRect.left;\r\n\r\n                if (oRect.left + (this.piSuggestionWidth > 0 ? this.piSuggestionWidth : oRect.width) > window.innerWidth) {\r\n                    iOffsetLeft = window.innerWidth - (this.piSuggestionWidth > 0 ? this.piSuggestionWidth : oRect.width);\r\n                }\r\n\r\n                //  Set position\r\n                eSugg.style.top = iOffsetTop + \"px\";\r\n                eSugg.style.left = iOffsetLeft + \"px\";\r\n                eSugg.style.width = (this.piSuggestionWidth > 0 ? this.piSuggestionWidth : oRect.width) + \"px\";\r\n\r\n                if (oRect.bottom + this._eSugContent.clientHeight > window.innerHeight) {\r\n                    this._eSuggestions.style.bottom = \"0px\";\r\n                } else {\r\n                    this._eSuggestions.style.bottom = \"\";\r\n                }\r\n            } else {\r\n                eSugg.style.display = \"none\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    This method hides the suggestion list. It clears all timers and the suggestion administration. \r\n    Hiding is done by changing the CSS Classnames.\r\n    */\r\n    suggestHide() {\r\n        if (this._eSuggestions) {\r\n            df.dom.addClass(this._eSuggestions, \"WebSug_Hidden\");\r\n            df.dom.removeClass(this._eSuggestions, \"WebSug_Visible\");\r\n\r\n            if (this._tSuggestDisplay) {\r\n                clearTimeout(this._tSuggestDisplay);\r\n                this._tSuggestDisplay = null;\r\n            }\r\n            if (this._tSuggestUpdate) {\r\n                clearTimeout(this._tSuggestUpdate);\r\n                this._tSuggestUpdate = null;\r\n            }\r\n\r\n            this.updateTypeVal();\r\n            this._sSuggestPrevVal = this.getServerVal();\r\n\r\n            df.dom.off(\"resize\", window, this.onWindowResize, this);\r\n            if (this._aScrollListeners) {\r\n                df.sys.gui.removeScrollListeners(this._aScrollListeners, this);\r\n            }\r\n\r\n            this._aSuggestRows = null;\r\n            this._sSelectedId = null;\r\n        }\r\n        this.fire(\"OnHideSuggestions\", []);\r\n\r\n        this._bSuggestVisible = false;\r\n        this._bForceDisplay = false;\r\n\r\n    }\r\n\r\n\r\n    /* \r\n    Updates the displayed suggestion list.\r\n    \r\n    @param  sSearch     The current search value.\r\n    */\r\n    suggestRender(sSearch) {\r\n        let sLowerSearch, iLen, oRegEx;\r\n        const aHtml = []\r\n        const aList = this._aSuggestRows\r\n\r\n        function makeBold(sMatch) {\r\n            return '<b>' + sMatch + '</b>';\r\n        }\r\n\r\n        if (this._eSuggestions) {\r\n            //  Prepare highlight searches\r\n            if (this.pbHighlight) {\r\n                if (this.pbFullText) {\r\n                    oRegEx = new RegExp(df.sys.data.escapeRegExp(sSearch), (this.pbCaseSensitive ? 'g' : 'gi'));\r\n                } else {\r\n                    sLowerSearch = sSearch.toLowerCase();\r\n                    iLen = sSearch.length;\r\n                }\r\n            }\r\n\r\n\r\n            //  Generate result table\r\n            aHtml.push('<table>');\r\n\r\n            for (let i = 0; i < aList.length; i++) {\r\n                aHtml.push('<tr data-suggestnr=\"', i, '\" class=\"WebSug_Suggestion ', (aList[i].sRowId === this._sSelectedId ? 'WebSug_Selected' : ''), '\">');\r\n\r\n                for (let x = 0; x < aList[i].aValues.length; x++) {\r\n                    const sVal = aList[i].aValues[x];\r\n\r\n                    aHtml.push('<td>');\r\n\r\n                    //  Do highlighting\r\n                    if (this.pbHighlight && (this.peSuggestionMode !== df.smValidationTable || x === 0)) {\r\n                        if (this.pbFullText) {\r\n                            //  Perform a find and replace to highlight keyword(s)\r\n                            aHtml.push(sVal.replace(oRegEx, makeBold));\r\n                        } else {\r\n                            if (sVal.substr(0, iLen).toLowerCase() === sLowerSearch) {\r\n                                aHtml.push('<b>', sVal.substr(0, iLen), '</b>', sVal.substr(iLen));\r\n                            } else {\r\n                                aHtml.push(sVal);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        aHtml.push(sVal);\r\n                    }\r\n\r\n                    aHtml.push('</td>');\r\n                }\r\n\r\n                aHtml.push('</tr>');\r\n            }\r\n\r\n            aHtml.push('</table>');\r\n\r\n            this._eSugContent.innerHTML = aHtml.join(\"\");\r\n            this.suggestPosition();\r\n        }\r\n    }\r\n    /* \r\n    This method performs the client-side filtering / refinement using the search value. It will go over \r\n    the available suggestions and remove the items that do not apply the filter. If we were starting \r\n    with the maximum amount of suggestions it will trigger suggestLoad to reload from the server as \r\n    there might be more matches.\r\n    \r\n    @param  sSearch     The search string.\r\n    */\r\n    suggestRefine(sSearch) {\r\n        let bServer = true, bFound = false;\r\n        const aList = [];\r\n        const aBase = this._aSuggestBase\r\n\r\n        if (this.pbFullText) {\r\n            const oRegEx = new RegExp(df.sys.data.escapeRegExp(sSearch), (this.pbCaseSensitive ? '' : 'i'));\r\n\r\n            for (let i = 0; i < aBase.length; i++) {\r\n                for (let x = 0; x < (this.peSuggestionMode !== df.smValidationTable ? aBase[i].aValues.length : 1); x++) {\r\n                    if (oRegEx.test(aBase[i].aValues[x])) {\r\n                        aList.push(aBase[i]);\r\n\r\n                        bFound = (bFound || aBase[i].sRowId === this._sSelectedId);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._aSuggestRows = aList;\r\n\r\n            this.suggestRender(sSearch);\r\n            if (aBase.length >= this.piMaxResults && aList.length < this.piMaxResults) {\r\n                this.suggestLoad();\r\n            }\r\n\r\n        } else {\r\n            const sLowVal = sSearch.toLowerCase();\r\n            const iLen = sSearch.length;\r\n\r\n            for (let i = 0; i < aBase.length; i++) {\r\n                if ((!this.pbCaseSensitive && aBase[i].aValues[0].substr(0, iLen).toLowerCase() === sLowVal) ||\r\n                    (this.pbCaseSensitive && aBase[i].aValues[0].substr(0, iLen) === sSearch)) {\r\n\r\n                    aList.push(aBase[i]);\r\n\r\n                    bFound = (bFound || aBase[i].sRowId === this._sSelectedId);\r\n                } else if (aList.length > 0) {\r\n                    bServer = (this.peDataType === df.ciTypeBCD);\r\n                }\r\n            }\r\n\r\n            this._aSuggestRows = aList;\r\n\r\n            //  Determine selected id\r\n            if (!bFound) {\r\n                this._sSelectedId = (aList.length > 0 ? aList[0].sRowId : null);\r\n            }\r\n\r\n            this.suggestRender(sSearch);\r\n            if (aBase.length >= this.piMaxResults && bServer && sSearch !== this._sSuggestBaseVal) {\r\n                this.suggestLoad();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Selects the item by sending a call to the server with the selected suggestion details.\r\n    */\r\n    suggestSelect() {\r\n        let tRow = null;\r\n        const aList = this._aSuggestRows;\r\n\r\n        if (this._sSelectedId) {\r\n            for (let i = 0; i < aList.length; i++) {\r\n                if (aList[i].sRowId === this._sSelectedId) {\r\n                    tRow = aList[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (tRow) {\r\n                this.updateTypeVal();\r\n\r\n                this.serverAction(\"SelectSuggestion\", [this.getServerVal()], [tRow], function (oEvent) {\r\n                    this.suggestHide();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Moves the selection suggestion up or down.\r\n    \r\n    @param  iDir    Direction (-1 goes one up and 1 goes one down).\r\n    @private\r\n    */\r\n    suggestMove(iDir) {\r\n        let i\r\n        const aList = this._aSuggestRows;\r\n\r\n        if (this._sSelectedId) {\r\n            for (i = 0; i < aList.length; i++) {\r\n                if (aList[i].sRowId === this._sSelectedId) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            i = i + iDir;\r\n\r\n            i = (i >= 0 ? (i < aList.length ? i : aList.length - 1) : 0);\r\n\r\n            this.suggestHightlight(aList[i].sRowId);\r\n        } else {\r\n            this.suggestHightlight(aList.length > 0 ? aList[0].sRowId : null);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Highlights the specified suggestion in the list by applying the WebSug_Selected CSS Classname to its \r\n    tr DOM element.\r\n    \r\n    @param  sId     ID of suggestion.\r\n    @private\r\n    */\r\n    suggestHightlight(sId) {\r\n        this._sSelectedId = sId;\r\n\r\n        this.updateTypeVal();\r\n        this.suggestRender(this.getServerVal());\r\n\r\n        const eElem = df.dom.query(this._eSugContent, \"tr.WebSug_Selected\");\r\n\r\n        if (eElem) {\r\n            const iTop = df.sys.gui.getAbsoluteOffset(eElem).top;\r\n            const iBottom = iTop + eElem.offsetHeight;\r\n\r\n            if (iTop - this._eSuggestions.scrollTop < 0) {\r\n                this._eSuggestions.scrollTop = iTop;\r\n            } else if (iBottom > this._eSuggestions.clientHeight + this._eSuggestions.scrollTop) {\r\n                this._eSuggestions.scrollTop = iBottom - this._eSuggestions.clientHeight;\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /* \r\n    Handles the click event of the suggestionlist.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onSuggestClick(oEvent) {\r\n        let eElem = oEvent.getTarget();\r\n\r\n        while (eElem.tagName !== \"TR\" && eElem.parentNode && eElem !== this._eSugContent) {\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        if (eElem.hasAttribute(\"data-suggestnr\")) {\r\n            const iRow = parseInt(eElem.getAttribute(\"data-suggestnr\"), 10);\r\n\r\n            if (this._aSuggestRows[iRow]) {\r\n                this.suggestHightlight(this._aSuggestRows[iRow].sRowId);\r\n                this.suggestSelect();\r\n                this.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Enforces the display and loading of suggestions. Designed to be used from the server or as event \r\n    handler on psClientOnPrompt.\r\n    \r\n    @client-action\r\n    */\r\n    showSuggestions() {\r\n        this._bForceDisplay = true;\r\n\r\n        if (!this._bSuggestVisible) {\r\n            this.suggestDisplay();\r\n        }\r\n        this.suggestUpdate();\r\n        this.focus();\r\n    }\r\n\r\n\r\n    /* \r\n    Augments the key handler and implements the key operations.\r\n    \r\n    NOTE: The WebColumnSuggestion has its own onKey handler!\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const oKeys = df.settings.suggestionKeys;\r\n\r\n        super.onKey(oEvent);\r\n\r\n        if (!oEvent.bCanceled) {\r\n            if (this._bSuggestVisible && this.pbShowResults) {\r\n                if (oEvent.matchKey(oKeys.escape)) {\r\n                    this.suggestHide();\r\n                    // oEvent.stop();\r\n                } else if (oEvent.matchKey(oKeys.select)) {\r\n                    this.suggestSelect();\r\n                    oEvent.stop();\r\n                } else if (oEvent.matchKey(oKeys.moveUp)) {\r\n                    this.suggestMove(-1);\r\n                    oEvent.stop();\r\n                } else if (oEvent.matchKey(oKeys.moveDown)) {\r\n                    this.suggestMove(1);\r\n                    oEvent.stop();\r\n                }\r\n            }\r\n\r\n            //  Make sure force display doesn't change value\r\n            if (oEvent.matchKey(oKeys.forceDisplay) && this.pbAllowForce) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the keyup event and performs the force display if needed. \r\n    \r\n    TODO: Not sure why we do this in keyup but there must be a good reason!\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent);\r\n    @private\r\n    */\r\n    onSuggestKey(oEvent) {\r\n        const oKeys = df.settings.suggestionKeys, iKey = oEvent.getKeyCode();\r\n        // df.WebSuggestionForm.base.onKey.call(this, oEvent);\r\n\r\n        if (oEvent.matchKey(oKeys.forceDisplay) && this.pbAllowForce) {\r\n            this._bForceDisplay = true;\r\n            if (!this._bSuggestVisible) {\r\n                this.suggestDisplay();\r\n            }\r\n            oEvent.stop();\r\n        }\r\n\r\n        if (this._bSuggestVisible) {\r\n            this.suggestUpdate();\r\n        } else {\r\n            if (!oEvent.isSpecialKey() && (iKey < 112 || iKey > 127)) { //  Explicitly filter out function keys (to prevent responding to finds)\r\n                this.suggestUpdate();\r\n            }\r\n        }\r\n        this._bForceDisplay = false;\r\n    }\r\n\r\n    /* \r\n    Listener of the window resize and scroll events. Triggers a reposition action and repeats that after \r\n    a small timeout.\r\n    \r\n    @param  oEvent  DOM Event object (see: df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onWindowResize(oEvent) {\r\n        const that = this;\r\n\r\n        if (!this._tRepos) {\r\n            setTimeout(function () {\r\n                that.suggestPosition();\r\n                that._tRepos = null;\r\n            }, 40);\r\n        }\r\n\r\n        this.suggestPosition();\r\n    }\r\n\r\n    /* \r\n    Augment the blur event and hide the suggestion list.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent);\r\n    @private\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n\r\n        super.onBlur(oEvent);\r\n\r\n        if (this._tSugBlurTimeout) {\r\n            clearTimeout(this._tSugBlurTimeout);\r\n            this._tSugBlurTimeout = null;\r\n        }\r\n\r\n        this._tSugBlurTimeout = setTimeout(function () {\r\n            if (!that._bHasFocus) {\r\n                that.suggestHide();\r\n            }\r\n        }, 500);\r\n    }\r\n\r\n    /*\r\n    Setter that updates the CSS class on the DOM element if it was rendered.\r\n    */\r\n    set_psPopupCSSClass(sVal) {\r\n        if (this._eSuggestions) {\r\n            this._eSuggestions.className = \"WebSuggestions \" + (this._bSuggestVisible ? \"WebSug_Visible\" : \"WebSug_Hidden\") + sVal;\r\n        }\r\n    }\r\n}","import { WebBaseSelectionForm } from './WebBaseSelectionForm.js';\r\nimport { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebTagsForm\r\nExtends:\r\n    df.WebBaseSelectionForm\r\n\r\nThe WebTagsForm is an extension on the selection form. Able to select multiple items. Compositions can be made.\r\n\r\nRevision:\r\n    2020/09/25  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebTagsForm extends WebBaseSelectionForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piTagTruncateAt\", 60);\r\n        this.prop(df.tBool, \"pbTagOnSpace\", false);\r\n        this.prop(df.tBool, \"pbAllowTagSelection\", true);\r\n        this.prop(df.tString, \"psSeparator\", \",\");\r\n\r\n        this.event(\"OnTagClick\", df.cCallModeDefault, \"privateOnTagClick\");\r\n        this.event(\"OnAddTag\", df.cCallModeDefault, \"privateOnAddTag\");\r\n        this.event(\"OnRemoveTag\", df.cCallModeDefault, \"privateOnRemoveTag\");\r\n\r\n        this._aSelectedSuggestions = [];\r\n        this._sSelectedTag = null;\r\n        this._oSelectedTag = null;\r\n        this._aTagCssClass = {};\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        WebBaseControl.prototype.openHtml.call(this, aHtml);\r\n\r\n        aHtml.push('<div class=\"WebFrm_Wrapper\"><div class=\"WebFrm_PromptSpacer\">',\r\n            '<span class=\"WebDynFrm WebTgf_Placeholder\">',\r\n            (this.peLabelPosition != df.ciLabelFloat ? df.dom.encodeAttr(df.dom.encodeHtml(this.psPlaceHolder)) : ''),\r\n            '</span>',\r\n            '<span class=\"WebDynFrm WebTgfInput\" name=\"',\r\n            this._sName,\r\n            '\" id=\"',\r\n            this._sControlId,\r\n            '\" role=\"textbox\" tabindex=\"0\"',\r\n            ' contenteditable=\"true\"></span>');\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div><span class=\"WebFrm_Prompt\"></span></div>');\r\n\r\n        WebBaseControl.prototype.closeHtml.call(this, aHtml);\r\n    }\r\n\r\n    setPlaceHolderVisibility(bVisible) {\r\n        this.setVisibility(this._ePlaceHolder, bVisible);\r\n    }\r\n\r\n    setInputVisibility(bVisible) {\r\n        this.setVisibility(this._eControl, bVisible);\r\n    }\r\n\r\n    setVisibility(hElem, bVisible) {\r\n        hElem.style.display = (!bVisible ? \"none\" : \"\");\r\n    }\r\n\r\n    getVisibility(hElem) {\r\n        return hElem.style.display != \"none\";\r\n    }\r\n\r\n    focusInputField() {\r\n        if (this.pbReadOnly || !this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        if (this._aSelectedSuggestions.length === 0 || this.getVisibility(this._ePlaceHolder)) {\r\n            this.setPlaceHolderVisibility(false);\r\n        }\r\n\r\n\r\n        // IE Fix: reset the focus to the input field.\r\n        const that = this;\r\n        if (!this._tFocus) {\r\n            this._tFocus = setTimeout(function () {\r\n                if (!that._tFocus) return;\r\n                that._eControl.focus();\r\n                that._tFocus = null;\r\n            }, 1);\r\n        }\r\n    }\r\n\r\n    blurInputField() {\r\n        this._tFocus = null;\r\n        if ((this._eControl.value.length === 0 && this._aSelectedSuggestions.length === 0) ||\r\n            this.getVisibility(this._ePlaceHolder)) {\r\n            this.setPlaceHolderVisibility(true);\r\n        }\r\n    }\r\n\r\n    afterRender() {\r\n        // Create elem.\r\n        this._eSuggestions = df.dom.create('<div class=\"WebBaseSelectionForm WebSuggestions' +\r\n            ((this.psCSSClass.length > 0) ? \" \" + this.psCSSClass : '') + ' WebSug_Hidden\"><div class=\"WebSug_Content\"></div></div>');\r\n        this._eSugContent = df.dom.query(this._eSuggestions, \"div.WebSug_Content\");\r\n        this._eSugSuggestions = df.dom.create('<div class=\"WebSug_Suggestions\"></div>');\r\n        this._eSugControls = df.dom.create('<div class=\"WebSug_Controls\"></div>');\r\n\r\n        this._eSugContent.appendChild(this._eSugSuggestions);\r\n        this._eSugContent.appendChild(this._eSugControls);\r\n\r\n        this._eInputBox = df.dom.query(this._eElem, \".WebFrm_PromptSpacer\");\r\n        this._ePlaceHolder = df.dom.query(this._eElem, \".WebTgf_Placeholder\");\r\n\r\n        /* \r\n        For the WebTagsform we use a dynamic input field.\r\n        To make this growing we use a span, we need to add a couple of properties to make it function as such.\r\n        Using these function we pass for the BaseDEO api's.\r\n        */\r\n        const that = this;\r\n        this._eControl = this._eControl = df.dom.query(this._eInputBox, \".WebTgfInput\");\r\n        Object.defineProperty(this._eControl, \"value\", {\r\n            get() { return that._eControl.innerText; },\r\n            set(val) { that._eControl.innerText = val; }\r\n        });\r\n        Object.defineProperty(this._eControl, \"keypress\", {\r\n            get() { return that._eControl.keydown; },\r\n            set(val) { that._eControl.keydown = val; }\r\n        });\r\n        this._eControl.select = function () { that._eControl.focus(); };\r\n\r\n        df.dom.on(\"focusin\", this._eInputBox, this.focusInputField, this);\r\n        df.dom.on(\"click\", this._eInputBox, this.focusInputField, this);\r\n        df.dom.on(\"blur\", this._eControl, this.blurInputField, this);\r\n        this.blurInputField();\r\n\r\n        this._ePrompt = df.dom.query(this._eElem, \"div.WebFrm_Wrapper span.WebFrm_Prompt\");\r\n        this._eWrap = df.dom.query(this._eElem, \"div.WebFrm_Wrapper\");\r\n\r\n        WebBaseControl.prototype.afterRender.call(this);\r\n\r\n        //  Attach event handlers\r\n        df.dom.on(\"click\", this._ePrompt, this.onPromptClick, this);\r\n\r\n        //  Set properties\r\n        this.set_pbPromptButton(this.pbPromptButton);\r\n\r\n        // Insert.\r\n        df.dom.addClass(this._eElem, \"WebSelectionForm\");\r\n        const eTopLayer = this.topLayer() || document.body;\r\n        eTopLayer.appendChild(this._eSuggestions);\r\n        // Setup event handlers.\r\n        df.dom.on(\"keyup\", this._eControl, this.onSuggestKey, this);\r\n        df.dom.on(\"click\", this._eSuggestions, this.onSuggestClick, this);\r\n        df.dom.on(\"click\", this._eInputBox, this.inputBoxOnClick, this);\r\n        df.dom.on(\"resize\", window, this.onWindowResize, this);\r\n\r\n        df.dom.addClass(this._eElem, \"WebTagsForm\");\r\n\r\n        // If the values are pre-set implement them now.\r\n        if (this.aSelectionCache) this.setCachedTags();\r\n\r\n        df.dom.on(\"click\", this._eInputBox, this.removeTagSelection, this);\r\n\r\n        this.set_pbReadOnly(this.pbReadOnly);\r\n        this.set_pbEnabled(this.isEnabled());\r\n\r\n        this.validateAsSeparator(this.psSeparator);\r\n\r\n        this.dragDropInit();\r\n    }\r\n\r\n    set_pbEnabled(bVal) {\r\n        let bChanged = bVal !== this.isEnabled();\r\n        super.set_pbEnabled(bVal);\r\n        if (bChanged) this.setControlValue(this.getControlValue());\r\n    }\r\n\r\n    validateAsSeparator(sVal) {\r\n        if (sVal.length !== 1) {\r\n            throw new df.Error(871, \"Invalid psSeparator; requires length of just one character.\");\r\n        }\r\n        return true;\r\n    }\r\n\r\n    set_psSeparator(sVal) {\r\n        if (sVal !== this.psSeparator && this.validateAsSeparator(sVal)) {\r\n            this.psSeparator = sVal;\r\n        }\r\n    }\r\n\r\n    set_pbReadOnly(bVal) {\r\n        let bChanged = bVal !== this.pbReadOnly;\r\n        super.set_pbReadOnly(bVal);\r\n        if (bChanged) this.setControlValue(this.getControlValue());\r\n    }\r\n\r\n    removeTagSelection() {\r\n        if (this._sSelectedTag && this._oSelectedTag) {\r\n            df.dom.removeClass(this._oSelectedTag, \"WebTgf_Focus\");\r\n        }\r\n        this._sSelectedTag = null;\r\n        this._oSelectedTag = null;\r\n    }\r\n\r\n    setTagSelection(tRow) {\r\n        this.removeTagSelection();\r\n        this._sSelectedTag = tRow;\r\n        this._oSelectedTag = df.dom.query(this._eInputBox, \".WebTgf_Tag[data-dfrowid='\" + this._sSelectedTag.aValues[0].replaceAll(\"'\", \"\\\\'\") + \"']\");\r\n        df.dom.addClass(this._oSelectedTag, \"WebTgf_Focus\");\r\n    }\r\n\r\n    /*\r\n    Get the value from the inputfield.\r\n    */\r\n    getSearchValue() {\r\n        let sValue = this._eControl.value;\r\n        return (this.pbCapslock ? sValue.toUpperCase() : sValue);\r\n    }\r\n\r\n    /*\r\n    Called by the baseDEO, it serializes the selected tag datasets.\r\n\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        let aData = [];\r\n        let sEscapedSeperator = \"\\\\\" + this.psSeparator;\r\n\r\n        for (let i = 0; i < this._aSelectedSuggestions.length; i++) {\r\n            if (!this._aSelectedSuggestions[i].control) {\r\n                aData.push(this._aSelectedSuggestions[i].aValues[0].replaceAll(this.psSeparator, sEscapedSeperator));\r\n            }\r\n        }\r\n        return aData.join(this.psSeparator);\r\n    }\r\n\r\n    parseSelectionValues(sList) {\r\n        let aList = [];\r\n\r\n        /*\r\n        iIndex = The found end index of a string; which is an operator thus +1.\r\n        iLastIndex = The last found iIndex.\r\n        iBegin = The last begin of a string; commonly iIndex+1.\r\n        */\r\n        let iIndex = -1, iLastIndex = -1, iBegin = 0;\r\n        while ((iIndex = sList.indexOf(this.psSeparator, iLastIndex + 1)) >= 0) {\r\n            let bEven = true;\r\n            let j = iIndex;\r\n            // Check if the operator is escaped.\r\n            while (--j >= 0 && sList.charAt(j) === '\\\\') {\r\n                bEven = !bEven;\r\n            }\r\n\r\n            // If its even it means its not escaped.\r\n            if (bEven) {\r\n                let sValue = sList.substr(iBegin, iIndex - iBegin);\r\n                sValue = sValue.replaceAll(\"\\\\\" + this.psSeparator, this.psSeparator).trim();\r\n                if (sValue.length > 0) {\r\n                    aList.push(sValue);\r\n                    iBegin = iIndex + 1;\r\n                }\r\n            }\r\n\r\n            iLastIndex = iIndex;\r\n        }\r\n\r\n        // Do the last one too.\r\n        let sValue = sList.substr(iBegin, sList.length - iBegin);\r\n        sValue = sValue.replaceAll(\"\\\\\" + this.psSeparator, this.psSeparator).trim();\r\n        if (sValue.length > 0) aList.push(sValue);\r\n\r\n        return aList;\r\n    }\r\n\r\n    /*\r\n    Called by the baseDEO, it de-serializes the selected tag datasets and adds them one-by-one.\r\n\r\n    @private\r\n    */\r\n    setControlValue(sVal) {\r\n        this.aSelectionCache = this.parseSelectionValues(sVal);\r\n\r\n        if (this._eInputBox) this.setCachedTags();\r\n    }\r\n\r\n    suggestHandle(sVal, bLast) {\r\n        super.suggestHandle(sVal, bLast);\r\n        if (this._aSuggestRows.length - this._aSelectedSuggestions.length < this.piPageSize && !this._bLastItemOnServer && this.pbPaged) {\r\n            this.handleMoreButton();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Intermediate event during handling of incoming lists.\r\n    Currently adding control rows.\r\n    */\r\n    AddControlSuggestions(aList) {\r\n        let iAdded = aList.length;\r\n        let sValue = this.getSearchValue().trim();\r\n        if (!this._bLastItemOnServer && this.pbPaged && aList.length > 0 && !this.pbAllData) aList.push({ control: true, sRowId: \"more\", aValues: [\"(\" + this.psShowMoreText + \")\"], sCssClassName: \"Sugg_ControlSuggestion\" });\r\n        let bShow = true;\r\n        if (this._aShownSuggestions) bShow = !(this._aShownSuggestions.length > 0 && this._aShownSuggestions[0].aValues[0] == sValue);\r\n\r\n        if (bShow) bShow = this.getSelectedSuggestionId(sValue) < 0;\r\n\r\n        if (bShow && this.pbAllowCreate && sValue.length > 0) aList.push({ control: true, sRowId: \"create\", aValues: [\"(\" + this.psCreateNewItemText + (sValue.length > 0 ? \" '\" + sValue + \"'\" : \"\") + \")\"], sCssClassName: \"Sugg_ControlSuggestion\" });\r\n\r\n        return aList.length - iAdded;\r\n    }\r\n\r\n    afterSuggestRefine(sFilter) {\r\n        if (this._aShownSuggestions.length - this._TotalOfControlRows - this._aSelectedSuggestions.length < this.piPageSize && !this._bLastItemOnServer && this.pbPaged) {\r\n            this.handleMoreButton();\r\n        }\r\n    }\r\n\r\n    // If a dd already a value in it the setControlValue is called before the render was completed.\r\n    // Caching is thus required.\r\n    setCachedTags() {\r\n        this.clearTags();\r\n        for (let i = 0; i < this.aSelectionCache.length; i++) {\r\n            this.addTag({\r\n                sRowId: i.toString(),\r\n                aValues: [this.aSelectionCache[i]],\r\n                sCssClassName: \"\"\r\n            });\r\n        }\r\n        this.setPlaceHolderVisibility(this._eControl.value.length === 0 && this.aSelectionCache.length == 0);\r\n        this.updateTypeVal();\r\n    }\r\n\r\n    /*\r\n    This is a function to truncate the text in a tag. Based on spaces as well as the value itself.\r\n    */\r\n    truncate(sValue, iMaximumLength, bUseBoundary) {\r\n        if (sValue.length <= iMaximumLength) return sValue;\r\n        if (iMaximumLength == 0) return sValue;\r\n        let subString = sValue.substr(0, iMaximumLength);\r\n        return ((bUseBoundary && subString.lastIndexOf(\" \") != -1)\r\n            ? subString.substr(0, subString.lastIndexOf(\" \"))\r\n            : subString) + \"&hellip;\";\r\n    }\r\n\r\n    /*\r\n    Is called by the server, this puts a css classname on the value using a hashet.\r\n    Afterwards a rerender is called thus causing the class to be applied.\r\n    */\r\n    setTagCssClass(sTag, sCssClass) {\r\n        this._aTagCssClass[sTag] = \" \" + sCssClass.trim();\r\n        this.updateTypeVal();\r\n        this.refreshDisplay(this._tValue);\r\n    }\r\n\r\n    /*\r\n    Selects the item by sending a call to the server with the selected suggestion details.\r\n    */\r\n    suggestSelect() {\r\n        if (this._oSelectedSuggestion && !this._oSelectedSuggestion.control) {\r\n            let tRow = this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);\r\n            if (tRow) {\r\n                this.addTag(tRow);\r\n                this.fireEx({\r\n                    sEvent: \"OnAddTag\",\r\n                    tActionData: tRow,\r\n                    oEnv: this\r\n                });\r\n                this.updateTypeVal();\r\n                this.focusInputField();\r\n                this._eControl.value = \"\";\r\n                this.suggestHide();\r\n                return;\r\n            }\r\n        }\r\n        super.suggestSelect();\r\n        this.focusInputField();\r\n    }\r\n\r\n    extraFilterOnHandle(aList) {\r\n        // Filter out all selected values.\r\n        this._aSelectedSuggestions.forEach(function (tRow) {\r\n            for (let i = 0; i < aList.length; i++)\r\n                if ((aList[i].aValues[0] == tRow.aValues[0]))\r\n                    aList.splice(i--, 1);\r\n        });\r\n        return aList;\r\n    }\r\n\r\n    /*\r\n    Used to add a selectiontag to the view.\r\n    \r\n    @private\r\n    */\r\n    addTag(tRow) {\r\n        // Push the tRow onto the selection stack.\r\n        this._aSelectedSuggestions.push(tRow);\r\n        // A SetControlValue clears the focus, re-enable it\r\n        let bHasFocus = false;\r\n        if (this._sSelectedTag && this.isEnabled())\r\n            if (this._sSelectedTag.aValues[0] == tRow.aValues[0])\r\n                bHasFocus = true;\r\n\r\n        // Create the element.\r\n        var tag_elem = df.dom.create(\r\n            '<div class=\"WebTgf_Tag' + ((bHasFocus) ? \" WebTgf_Focus\" : \"\") + (this._aTagCssClass[tRow.aValues[0]] ? this._aTagCssClass[tRow.aValues[0]] : \"\") + '\" data-dfrowid=\"' + df.dom.encodeAttr(tRow.aValues[0]) + '\"' + (this.pbDragDropEnabled && this.isSupportedDragAction(df.dragActions.WebTagsForm.ciDragTag) ? ' draggable=\"true\"' : '') + '> \\\r\n                <span class=\"WebTgf_Text\">' + df.dom.encodeHtml(this.truncate(tRow.aValues[0], this.piTagTruncateAt, false)) + '</span>' +\r\n            (this.isEnabled() && !this.pbReadOnly ? '<span class=\"WebTgf_CloseTag\">x</span> ' : '') +\r\n            '</div>'\r\n        );\r\n\r\n        // Insert the element into the DOM.\r\n        let oTag = this._eInputBox.insertBefore(tag_elem, this._eControl);\r\n\r\n        if (bHasFocus) this._oSelectedTag = tag_elem;\r\n\r\n        df.dom.on(\"mousedown\", oTag, function (oEvent) {\r\n            if (window.getSelection().type == \"Range\") return;\r\n            // Find valid targets either the tag itself or the close button.\r\n            let target = oEvent.getTarget();\r\n            while (!target.classList.contains(\"WebTgf_Tag\") && !target.classList.contains(\"WebTgf_CloseTag\"))\r\n                target = target.parentNode;\r\n\r\n            if (!this.isEnabled()) return;\r\n\r\n            // If the close button was clicked.\r\n            if (target.classList.contains(\"WebTgf_CloseTag\") && !this.pbReadOnly) {\r\n                target = target.parentNode;\r\n\r\n                this.removeTag(target.getAttribute(\"data-dfrowid\"));\r\n                this.blurInputField();\r\n\r\n                // Deselect the if a selection was made using the keyboard since the numbers won't correspond.\r\n                this.removeTagSelection();\r\n            } else if (target.classList.contains(\"WebTgf_Tag\")) {\r\n                let iIndex = this.getSelectedSuggestionId(target.getAttribute(\"data-dfrowid\"));\r\n                if (iIndex < 0)\r\n                    throw new df.Error(999, \"Could not refind the clicked tag.\");\r\n\r\n                // remove previous selection.\r\n                this.removeTagSelection();\r\n\r\n                if (this.pbAllowTagSelection) {\r\n                    this.setTagSelection(this._aSelectedSuggestions[iIndex]);\r\n                    this.focus();\r\n                }\r\n\r\n                this.fireEx({\r\n                    sEvent: \"OnTagClick\",\r\n                    tActionData: this._aSelectedSuggestions[iIndex],\r\n                    oEnv: this\r\n                });\r\n            }\r\n        }, this);\r\n\r\n        // For suggestionmode additional items are needed +1\r\n        if (this.pbSuggestions) this._iAdditionalItems++;\r\n\r\n        this.sizeChanged();\r\n    }\r\n\r\n    /*\r\n    Clears the webtags\r\n    */\r\n    clearTags() {\r\n        const that = this;\r\n        this._aSelectedSuggestions = [];\r\n        if (this._eInputBox) {\r\n            this._eInputBox.querySelectorAll(\".WebTgf_Tag\").forEach(function (oTag) {\r\n                that._eInputBox.removeChild(oTag);\r\n            });\r\n        }\r\n        // For suggestionmode additional items back to 0;\r\n        this._iAdditionalItems = 0;\r\n    }\r\n\r\n    /*\r\n    Given the sValue it will remove the tag from the selected list.\r\n    @private\r\n    */\r\n    removeTag(sValue) {\r\n        let oRow = df.dom.query(this._eInputBox, \".WebTgf_Tag[data-dfrowid='\" + sValue.replaceAll(\"'\", \"\\\\'\") + \"']\");\r\n        if (oRow) {\r\n            let iIndex = this.getSelectedSuggestionId(sValue);\r\n            let tRow = this._aSelectedSuggestions[iIndex];\r\n\r\n            this._aSelectedSuggestions.splice(iIndex, 1);\r\n            oRow.parentNode.removeChild(oRow);\r\n            this.updateTypeVal();\r\n            this.fireEx({\r\n                sEvent: \"OnRemoveTag\",\r\n                tActionData: tRow,\r\n                oEnv: this\r\n            });\r\n\r\n            this.sizeChanged();\r\n        }\r\n        if (this._bSuggestVisible) this.suggestHide();\r\n\r\n        if (this.pbSuggestions) this._iAdditionalItems--;\r\n        this.suggestLoad();\r\n    }\r\n\r\n    /*\r\n    Find a suggestion by sValue in the selected suggestions.\r\n    returns index.\r\n    @private\r\n    */\r\n    getSelectedSuggestionId(sValue) {\r\n        for (let i = 0; i < this._aSelectedSuggestions.length; i++) {\r\n            if (this._aSelectedSuggestions[i].aValues[0] == sValue) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    /* \r\n    Augments the key handler and implements the key operations.\r\n     \r\n    NOTE: The WebColumnSuggestion has its own onKey handler!\r\n     \r\n    additions over base: Backspace/delete, left/right arrow keys for navigation through tags.\r\n     \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        function setCaretPosition(el, pos) {\r\n            const range = document.createRange();\r\n            const sel = window.getSelection();\r\n            if (el.childNodes.length == 0) return;\r\n            range.setStart(el.childNodes[0], pos);\r\n            range.collapse(true);\r\n            sel.removeAllRanges();\r\n            sel.addRange(range);\r\n        }\r\n\r\n        function getCaretPosition(editableDiv) {\r\n            let caretPos = 0,\r\n                range;\r\n            if (window.getSelection) {\r\n                const sel = window.getSelection();\r\n                if (sel.rangeCount) {\r\n                    range = sel.getRangeAt(0);\r\n                    if (range.commonAncestorContainer.parentNode == editableDiv) {\r\n                        caretPos = range.endOffset;\r\n                    }\r\n                }\r\n            } else if (document.selection && document.selection.createRange) {\r\n                range = document.selection.createRange();\r\n                if (range.parentElement() == editableDiv) {\r\n                    var tempEl = document.createElement(\"span\");\r\n                    editableDiv.insertBefore(tempEl, editableDiv.firstChild);\r\n                    var tempRange = range.duplicate();\r\n                    tempRange.moveToElementText(tempEl);\r\n                    tempRange.setEndPoint(\"EndToEnd\", range);\r\n                    caretPos = tempRange.text.length;\r\n                }\r\n            }\r\n            return caretPos;\r\n        }\r\n\r\n        // Check if the key is not an auto-html-entity.\r\n        if (oEvent.e.ctrlKey) {\r\n            switch (oEvent.e.keyCode) {\r\n                case 66: //ctrl+B or ctrl+b\r\n                case 98:\r\n                case 73: //ctrl+I or ctrl+i\r\n                case 105:\r\n                case 85: //ctrl+U or ctrl+u\r\n                case 117:\r\n                    oEvent.stop();\r\n                    return false;\r\n            }\r\n        }\r\n\r\n        // Check if it is not a html beginning entity.\r\n        if ([\r\n            '<',\r\n            '>',\r\n            \"'\",\r\n            '/'\r\n        ].indexOf(oEvent.e.key) > -1) {\r\n            oEvent.stop();\r\n            this._eControl.value += oEvent.e.key;\r\n            setCaretPosition(this._eControl, this._eControl.value.length);\r\n            return;\r\n        }\r\n\r\n        const oKeys = df.settings.suggestionKeys;\r\n\r\n        if (this.isEnabled() && !this.pbReadOnly)\r\n            switch (oEvent.e.key) {\r\n                case \"Enter\":\r\n                    if (!this._bSuggestVisible) {\r\n                        oEvent.stop();\r\n                        return;\r\n                    }\r\n                    if (oEvent.e.shiftKey) this._oSelectedSuggestion = null;\r\n                    this.suggestSelect();\r\n                    oEvent.stop();\r\n                    break;\r\n                case \" \":\r\n                case \"Spacebar\":\r\n                    if (!this.pbTagOnSpace || oEvent.e.ctrlKey)\r\n                        break;\r\n                    this.suggestSelect();\r\n                    oEvent.stop();\r\n                    break;\r\n            }\r\n\r\n        super.onKey(oEvent);\r\n\r\n        if (!oEvent.bCanceled || this.pbReadOnly) {\r\n            // Handle focus using keys, oEvent.stop() is called in base.\r\n            if ((oEvent.e.key == \"ArrowLeft\" || oEvent.e.key == \"Left\") && this.pbAllowTagSelection) {\r\n                if (this._aSelectedSuggestions.length <= 0) return;\r\n                if (this._sSelectedTag) {\r\n                    let i = this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);\r\n                    this.removeTagSelection();\r\n                    if (i > 0) i--;\r\n                    else {\r\n                        this.removeTagSelection();\r\n                        this._eControl.focus();\r\n                        setCaretPosition(this._eControl, this.getSearchValue().length);\r\n                        oEvent.stop();\r\n                        return;\r\n                    }\r\n                    this.setTagSelection(this._aSelectedSuggestions[i]);\r\n                    oEvent.stop();\r\n                }\r\n                else if (getCaretPosition(this._eControl) == 0) {\r\n                    this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length - 1]);\r\n                    oEvent.stop();\r\n                }\r\n            }\r\n            else if ((oEvent.e.key == \"ArrowRight\" || oEvent.e.key == \"Right\") && this.pbAllowTagSelection) {\r\n                if (this._aSelectedSuggestions.length <= 0) return;\r\n                if (this._sSelectedTag) {\r\n                    let i = this.getSelectedSuggestionId(this._sSelectedTag.aValues[0]);\r\n                    this.removeTagSelection();\r\n                    if (i >= this._aSelectedSuggestions.length - 1) {\r\n                        this.removeTagSelection();\r\n                        this._eControl.focus();\r\n                        setCaretPosition(this._eControl, 0);\r\n                        oEvent.stop();\r\n                        return;\r\n                    }\r\n                    else i++;\r\n                    this.setTagSelection(this._aSelectedSuggestions[i]);\r\n                    oEvent.stop();\r\n                }\r\n                else if (getCaretPosition(this._eControl) == this.getSearchValue().length) {\r\n                    this.setTagSelection(this._aSelectedSuggestions[0]);\r\n                    oEvent.stop();\r\n                }\r\n            } else if (this.isEnabled() && !this.pbReadOnly && (oEvent.e.key == \"Backspace\" || oEvent.e.key == \"Delete\") && (this.getSearchValue().length == 0 || this._sSelectedTag) && this.pbAllowTagSelection) {\r\n                if (this._sSelectedTag) {\r\n                    this.removeTag(this._sSelectedTag.aValues[0]);\r\n                    this.removeTagSelection();\r\n                } else if (this._aSelectedSuggestions.length > 0) {\r\n                    this.setTagSelection(this._aSelectedSuggestions[this._aSelectedSuggestions.length - 1]);\r\n                }\r\n\r\n                oEvent.stop();\r\n            }\r\n            else { // unkown key (Typing)\r\n                this.removeTagSelection();\r\n            }\r\n\r\n            //  Make sure force display doesn't change value\r\n            if (oEvent.matchKey(oKeys.forceDisplay)) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    createTag() {\r\n        let tRow = this._tActionData;\r\n        if (tRow.aValues[0] == -1) {\r\n            tRow.aValues[0] = this._aSelectedSuggestions.length.toString();\r\n        }\r\n        if (this.getSelectedSuggestionId(tRow.aValues[0]) != -1) throw new df.Error(871, \"Id already in use.\");\r\n        this.addTag(tRow);\r\n        this.fireEx({\r\n            sEvent: \"OnAddTag\",\r\n            tActionData: tRow,\r\n            oEnv: this\r\n        });\r\n        this.updateTypeVal();\r\n        this.suggestDoLoad(this.getSearchValue());\r\n        this.suggestHide();\r\n    }\r\n\r\n    afterBlur() {\r\n        if (this._sSelectedTag) {\r\n            const that = this;\r\n            if (!this._tUnselectTag) {\r\n                this._tUnselectTag = setTimeout(function () {\r\n                    that._tUnselectTag = null;\r\n\r\n                    if (!that._bHasFocus) {\r\n                        df.dom.removeClass(that._oSelectedTag, \"WebTgf_Focus\");\r\n                        that._sSelectedTag = null;\r\n                        that._oSelectedTag = null;\r\n                    }\r\n                }, 500);\r\n            }\r\n        }\r\n    }\r\n\r\n    // WebUIContext\r\n\r\n    determineSelectorForWebUIContext(eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextTagsFormTag:\r\n                return \".WebTgf_Tag[data-dfrowid]\";\r\n        }\r\n        return null;\r\n    }\r\n\r\n    retrieveValueFromWebUIContext(eElem, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextTagsFormTag: {\r\n                if (!eElem.hasAttribute('data-dfrowid'))\r\n                    break;\r\n                return eElem.getAttribute('data-dfrowid')\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // === Drag & Drop ===\r\n\r\n    getDragData(oEv, eDraggedElem) {\r\n        try {\r\n            let sTagText = eDraggedElem.getAttribute(\"data-dfrowid\");\r\n            return [{ data: sTagText }, df.dragActions.WebTagsForm.ciDragTag]\r\n        } catch (err) {\r\n            // This can happen if the drag action is not supported, we don't want a nasty error if so.\r\n            console.error(\"Attempt to perform unsupported drag action\");\r\n            return [null, null];\r\n        }\r\n    }\r\n\r\n    getDropData(oDropZone, oPosition) {\r\n        if (oDropZone && oDropZone._eDropElem) {\r\n            const eTextElem = (df.dom.query(oDropZone._eDropElem, '.WebTgf_Text'));\r\n            let sTagText = '';\r\n            if (eTextElem) {\r\n                sTagText = eTextElem.innerText;\r\n            }\r\n\r\n            const dropData = {\r\n                data: sTagText,\r\n                action: df.dropActions.WebTagsForm.ciDropOnInput\r\n            }\r\n\r\n            return dropData;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    initDraggableElements() {\r\n        // Done whenever a tag is added (draggble=\"true\" attribute in addTag html)\r\n    }\r\n\r\n    initDropZones() {\r\n        this._aDropZones = [];\r\n\r\n        super.initDropZones();\r\n\r\n        if (this.isSupportedDropAction(df.dropActions.WebTagsForm.ciDropOnInput)) {\r\n            // Mark input as drop zone\r\n            const eZone = (df.dom.query(this._eElem, '.WebFrm_Wrapper'));\r\n            this.addDropZone(eZone);\r\n        }\r\n    }\r\n\r\n    determineDropCandidate(oEv, aHelpers) {\r\n        // DropOnControl and other drop actions cannot exist within the same control simultaneously\r\n        // It makes sense to check for this first to get it out of the way as it is the simplest check\r\n        if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebControl.ciDropOnControl))) {\r\n            return [this._eElem, df.dropActions.WebControl.ciDropOnControl];\r\n        }\r\n\r\n        // Check for DropOnInput\r\n        if (!aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebTagsForm.ciDropOnInput))) {\r\n            return [null, null];\r\n        }\r\n\r\n        const eElem = document.elementFromPoint(oEv.e.clientX, oEv.e.clientY);\r\n        let eTag = eElem?.closest('.WebTgf_Tag');\r\n\r\n        if (!eTag) {\r\n            const aElems = df.dom.query(this._eElem, '.WebTgf_Tag', true);\r\n            eTag = aElems.length > 0 && aElems[(aElems.length - 1)] || null;\r\n        }\r\n\r\n        if (eTag) {\r\n            if (eTag.hasAttribute('data-dfdropplaceholder')) {\r\n                if (eTag.previousElementSibling?.hasAttribute(\"data-dfrowid\")) {\r\n                    eTag = eTag.previousElementSibling;\r\n                } else if (eTag.nextElementSibling?.hasAttribute(\"data-dfrowid\")) {\r\n                    eTag = eTag.nextElementSibling;\r\n                }\r\n            }\r\n            if (eTag) {\r\n                return [eTag, df.dropActions.WebTagsForm.ciDropOnInput];\r\n            }\r\n        }\r\n        return [null, null];\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        const oRect = df.sys.gui.getBoundRect(eElem);\r\n        // We want to check if we are more to the left or to the right of the hovered tag\r\n        const iMid = (oRect.right - (oRect.width / 2));\r\n        if (oEv.e.clientX >= iMid) {\r\n            return df.dropPositions.ciDropAfter;\r\n        } else {\r\n            return df.dropPositions.ciDropBefore;\r\n        }\r\n    }\r\n\r\n    interactWithDropElem(dropZone, eElem) {\r\n        if (dropZone._eDropAction == df.dropActions.WebControl.ciDropOnControl) {\r\n            dropZone.highlightElement();\r\n        } else {\r\n            let eTempElem = document.createElement('div');\r\n            eTempElem.innerHTML = '<span class=\"WebTgf_Text\">DROP</span><span class=\"WebTgf_CloseTag\">x</span> '; // ToDo: Translate?\r\n            df.dom.addClass(eTempElem, 'WebTgf_Tag WebTgf_DropPlaceHolder');\r\n            eTempElem.setAttribute('data-dfrowid', 'empty_placeholder');\r\n            dropZone.insertElement(eTempElem, eElem);\r\n        }\r\n    }\r\n\r\n    doEmptyInteraction(dropZone) {\r\n        if (this.isSupportedDropAction(df.dropActions.WebTagsForm.ciDropOnInput)) {\r\n            let eTempElem = document.createElement('div');\r\n            eTempElem.innerHTML = '<span class=\"WebTgf_Text\">DROP</span><span class=\"WebTgf_CloseTag\">x</span> '; // ToDo: Translate?\r\n            df.dom.addClass(eTempElem, 'WebTgf_Tag WebTgf_DropPlaceHolder');\r\n            const eTargetElem = (df.dom.query(this._eElem, '.WebFrm_PromptSpacer'));\r\n            dropZone.insertElement(eTempElem, eTargetElem);\r\n\r\n            return df.dropActions.WebTagsForm.ciDropOnInput;\r\n        } else if (this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)) {\r\n            dropZone.highlightElement();\r\n            return df.dropActions.WebControl.ciDropOnControl;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    hasData() {\r\n        return (this.get('psValue') != '');\r\n    }\r\n}","import { df } from '../df.js';\r\n/*\r\nClass:\r\n    WebListModel\r\n\r\nThe model for the WebList its mini MVC system. It stores the data and and triggers onDataUpdate when \r\nneeded to notify the view of changes. It contains logic for sorting the data.\r\n\r\nStruct tWebCell\r\n    String sValue\r\n    String sTooltip\r\n    String sCssClassName\r\n    String[] aOptions\r\nEnd_Struct\r\n\r\nStruct tWebRow\r\n    String sRowId\r\n    String sCssClassName\r\n    tWebCell[] aCells\r\n    Integer iGroupHeaderIndex\r\nEnd_Struct\r\n\r\nStruct tWebGroupConfig\r\n    Integer iColumnId\r\n    String sLabel\r\n    Boolean bReverse\r\nEnd_Struct\r\n\r\nStruct tWebGroupHeader\r\n    Integer iGroupIndex\r\n    Integer iParentHeaderIndex\r\n    String sItem\r\n    Integer iItems\r\n    String sTotal    \r\nEnd_Struct\r\n\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListModel{\r\n\r\nstatic displayTypes = {\r\n    row : 1,\r\n    header : 2,\r\n    custom : 3\r\n}\r\n\r\nconstructor(oList){\r\n    this.oL = oList;\r\n    this.bPaged = false;\r\n    \r\n    this.sCurrentRowId = oList.psCurrentRowId;\r\n    this.iCurrentRow = -1;\r\n\r\n    this.aDisplay = [];         // Lineair list of display items, which are either rows or group headers. This is what the WebListView iterates to display. \r\n    \r\n    this.aData = [];            // The actual list data (rows)\r\n    this.aGroupHeaders = [];    // The grouping headers\r\n    this.aGroups = [];          // The defined groups (which columns are being grouped)\r\n\r\n    this.bIsGrouped = false;    // Indicates if the data is currently being grouped\r\n\r\n    \r\n    this.onDataUpdate = new df.events.JSHandler();\r\n    this.onBeforeDataUpdate = new df.events.JSHandler();\r\n    \r\n    this.onBeforeRowChange = new df.events.JSHandler();\r\n    this.onRowChange = new df.events.JSHandler();\r\n    this.onAfterRowChange = new df.events.JSHandler();\r\n    \r\n    oList._onSettingChange.on(this.onSettingChange, this);\r\n}\r\n\r\n/**\r\n * Fills the aDisplay list by looping over the data and the groups.\r\n */\r\nprepDisplay(){\r\n    const aHiddenGroups = [];\r\n\r\n    const groupHead = (iHeaderIndex, iRowIndex) => {\r\n        const tHeader = this.aGroupHeaders[iHeaderIndex];\r\n\r\n        if(tHeader.iParentHeaderIndex >= 0){\r\n            groupHead(tHeader.iParentHeaderIndex, iRowIndex);\r\n        }\r\n        \r\n        if(aHiddenGroups.length > 0){\r\n            if(aHiddenGroups[aHiddenGroups.length - 1] < tHeader.iGroupIndex) return;\r\n            aHiddenGroups.pop();\r\n        }\r\n        if(tHeader.bCollapsed){\r\n            aHiddenGroups.push(tHeader.iGroupIndex);\r\n        }\r\n\r\n        tHeader._iItemIndex = this.aDisplay.push({\r\n            eType : WebListModel.displayTypes.header,\r\n            iIndex : iHeaderIndex\r\n        }) - 1;\r\n\r\n    };\r\n\r\n    this.aDisplay = [];\r\n    this.aGroupHeaders.forEach(tHeader => tHeader._iItemIndex = null);\r\n\r\n    this.aData.forEach((tRow, iIndex) => {\r\n        tRow._iItemIndex = null;\r\n\r\n        if(tRow.iGroupHeaderIndex >= 0 && this.bIsGrouped) groupHead(tRow.iGroupHeaderIndex, iIndex);\r\n\r\n        if(aHiddenGroups.length == 0){\r\n            tRow._iItemIndex = this.aDisplay.push({\r\n                eType : WebListModel.displayTypes.row,\r\n                iIndex : iIndex\r\n            }) - 1;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * This is called when new data is received from the server.\r\n * \r\n * @param {tWebListData} listData   New list data.\r\n */\r\nhandleData(listData){\r\n    if(listData && (!Array.isArray(listData.aRows) || !Array.isArray(listData.aGroupHeaders) || !Array.isArray(listData.aGroups))){\r\n        throw new df.Error(999, \"Invalid data structure for weblist data.\", this);\r\n    }\r\n    \r\n    \r\n    this.onBeforeDataUpdate.fire(this);\r\n    \r\n    if(listData){   //  handleData is also called when the grouping or sorting changes in which case listData is null\r\n        this.aData =  listData.aRows;\r\n        if(this.oL.peGrouping == df.grpCustom){\r\n            this.aGroupHeaders = listData.aGroupHeaders;\r\n            this.aGroups = listData.aGroups;\r\n            this.bIsGrouped = (this.aGroups.length > 0); // This makes sure no client-side sorting is done\r\n        }\r\n    }\r\n    \r\n    if(this.bIsGrouped){\r\n        //  Apply grouping\r\n        this.groupData();\r\n    }else{\r\n        //    Sort data (if needed)\r\n        this.sortData();\r\n    }\r\n\r\n    this.prepDisplay();\r\n    \r\n    //    Refind current row\r\n    this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n    \r\n    //    Always select row if there is a row\r\n    if(this.iCurrentRow < 0 && this.aData.length > 0){\r\n        this.iCurrentRow = 0;\r\n        this.sCurrentRowId = this.aData[0].sRowId;\r\n    }\r\n    \r\n    this.onDataUpdate.fire(this, { sType : \"full\" });\r\n}\r\n\r\n/**\r\n * Determines if the passed row is the first row in the set.\r\n * \r\n * @param {Object} tRow \r\n * @returns True if this is the first row.\r\n */\r\nisFirst(tRow){\r\n    return (this.aData[0] == tRow);\r\n}\r\n\r\n/**\r\n * Determines if the passed row is the last row in the set.\r\n * \r\n * @param {Object} tRow \r\n * @returns True if this is the last row.\r\n */\r\nisLast(tRow){\r\n    return (this.aData[this.aData.length - 1] == tRow);\r\n}\r\n \r\n/**\r\n * Forwards grouping request to the grouping controller where the actual grouping algorithm is implemented.\r\n */\r\ngroupData(){\r\n    this.oL._oGrouping?.groupData();\r\n}\r\n\r\n/**\r\n * Sorts the data if piSortColumn is set on the WebList.\r\n * \r\n * @returns True if sorting was applied.\r\n */\r\nsortData(){\r\n    const oL = this.oL;\r\n    \r\n    //   Find comparison functions\r\n    if(oL.piSortColumn >= 0 && oL._aColumns[oL.piSortColumn]){\r\n        let aSortCols = [], aCmpFuncs = [];\r\n\r\n        if(oL.piSortColumn >= 0 && aSortCols.indexOf(oL.piSortColumn) == -1){\r\n            aSortCols.push(oL.piSortColumn);\r\n            aCmpFuncs.push(df.sys.data.compareFunction(oL._aColumns[oL.piSortColumn].peDataType, oL.pbReverseOrdering));\r\n        }\r\n        oL._aColumns.forEach((col, index )=> {\r\n            if(aSortCols.indexOf(index) == -1){\r\n                aSortCols.push(index);\r\n                aCmpFuncs.push(df.sys.data.compareFunction(col.peDataType, oL.pbReverseOrdering))\r\n            }\r\n        });\r\n\r\n        this.customSortData(aSortCols, aCmpFuncs);\r\n        \r\n        return true;\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\n/**\r\n * Implementation of client-side data sorting used by sortData and by the WebListGroupingController.\r\n * \r\n * @param {Array} aCols     List of columns to sort on (in order of priority).\r\n * @param {Array} aCmpFuncs Sort function to use for each column (must match aCols).\r\n */\r\ncustomSortData(aCols, aCmpFuncs){\r\n    this.aData.sort((row1, row2) =>{\r\n        for(let i = 0; i < aCols.length; i++){\r\n            const iCol = aCols[i];\r\n            const iRes = aCmpFuncs[i](row1.aCells[iCol].sValue, row2.aCells[iCol].sValue);\r\n            if (iRes != 0) return iRes;\r\n        }\r\n        return 0;\r\n    });\r\n}\r\n\r\nrowIndexByRowId(sRowId){\r\n    return this.aData.findIndex(tRow => tRow.sRowId == sRowId);\r\n}\r\n\r\nrowIdByRowIndex(iRowIndex){\r\n    return (this.aData[iRowIndex] ? this.aData[iRowIndex].sRowId : null);\r\n}\r\n\r\nrowByRowIndex (iRowIndex) {\r\n    return this.aData[iRowIndex];\r\n}\r\n\r\nrowByRowId (sRowId){\r\n    return this.aData.find(tRow => tRow.sRowId == sRowId) || null;\r\n}\r\n\r\nrowIndexToItemIndex (iRow){\r\n    if(this.aData[iRow] && this.aData[iRow]._iItemIndex != null) return  this.aData[iRow]._iItemIndex;\r\n\r\n    return -1;\r\n}\r\n\r\nsetCurrentRowId(sRowId){\r\n    if(this.sCurrentRowId !== sRowId){\r\n        const oOptions = {\r\n            sPrevRowId : this.sCurrentRowId,\r\n            iPrevRowIndex : this.iCurrentRow,\r\n            sGotoRowId : sRowId,\r\n            iGotoRowIndex : this.rowIndexByRowId(sRowId)\r\n        };\r\n\r\n        this.sCurrentRowId = oOptions.sGotoRowId;\r\n        this.iCurrentRow = oOptions.iGotoRowIndex;\r\n\r\n        this.onRowChange.fire(this, oOptions);\r\n    }\r\n}\r\n\r\nupdateRow(sRowId, tRow, bMergeRow){\r\n    const iRow = this.rowIndexByRowId(sRowId);\r\n    if(iRow >= 0){\r\n        this.onBeforeDataUpdate.fire(this);\r\n        \r\n        if(bMergeRow){  \r\n            //  Merge the new row data into the old row, always update rowid and cell values, other details are only updated if they are provided.\r\n            //  For non data aware grids this will be the default provided by the server.\r\n            const origRow = this.aData[iRow];\r\n            origRow.sRowId = tRow.sRowId;\r\n            if(tRow.sCssClassName) tRow.sCssClassName;\r\n            tRow.aCells.forEach((newCell, iCell) => {\r\n                const origCell = this.aData[iRow].aCells[iCell];\r\n                origCell.sValue = newCell.sValue;\r\n                if(newCell.sTooltip) origCell.sTooltip = newCell.sTooltip;\r\n                if(newCell.sCssClassName) origCell.sCssClassName = newCell.sCssClassName;\r\n                if(newCell.aOptions.length) origCell.aOptions = newCell.aOptions;\r\n            })    \r\n        }else{\r\n            this.aData[iRow] = tRow;\r\n        }\r\n        \r\n        //  If we are changing the current row we should also update sCurrentRowId, appendNewRow will handle the case where this shouldn't happen (tab from new row into another new row)\r\n        //    Note that sometimes (cell save example) the sCurrentRowId already contains the new rowid.\r\n        if(this.sCurrentRowId === sRowId || this.sCurrentRowId === tRow.sRowId){\r\n            this.sCurrentRowId = tRow.sRowId;\r\n            this.iCurrentRow = iRow;\r\n        }\r\n        \r\n        //this.sortData();    // This would cause issues, if the ordering changes we need a full refresh\r\n        \r\n        this.onDataUpdate.fire(this, { sType : \"row\",  sUpdateRowId : sRowId, sNewRowId : tRow.sRowId });\r\n    }\r\n}\r\n\r\n\r\nremoveRow(sRowId){\r\n    const iRow = this.rowIndexByRowId(sRowId);\r\n    if(iRow >= 0){\r\n        if(this.iCurrentRow > iRow){\r\n            this.iCurrentRow--;\r\n        }\r\n        \r\n        this.aData.splice(iRow, 1);\r\n        this.prepDisplay();\r\n\r\n        this.onDataUpdate.fire(this, {\r\n            sType :\"remrow\",\r\n            sRowId : sRowId,\r\n            iRowIndex : iRow\r\n        });\r\n    }\r\n}\r\n\r\nappendRow(tRow){\r\n    //  Insert at the end\r\n    this.aData.push(tRow);\r\n    \r\n    if(this.sortData()){\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n    }\r\n    this.prepDisplay();\r\n    this.onDataUpdate.fire(this, {\r\n        sType :\"newrow\",\r\n        sRowId : tRow.sRowId\r\n    });\r\n}\r\n\r\ninsertBefore(sBeforeRowId, tRow){\r\n    let iBefore = this.rowIndexByRowId(sBeforeRowId);\r\n    \r\n    if(iBefore < 0){\r\n        iBefore = this.aData.length;\r\n    }\r\n    if(iBefore <= this.iCurrentRow){\r\n        this.iCurrentRow++;\r\n    }\r\n     \r\n    this.aData.splice(iBefore, 0, tRow);\r\n     \r\n    if(this.sortData()){\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n    }\r\n    this.prepDisplay();\r\n    this.onDataUpdate.fire(this, {\r\n        sType :\"newrow\",\r\n        sRowId : tRow.sRowId\r\n    });  \r\n}\r\n\r\ninsertAfter(sAfterRowId, tRow){\r\n    const iAfter = this.rowIndexByRowId(sAfterRowId);\r\n\r\n    \r\n    if(iAfter < 0 || iAfter + 1== this.aData.length){\r\n        this.appendRow(tRow);\r\n    }else{\r\n        this.insertBefore(this.aData[iAfter + 1].sRowId, tRow);\r\n    }\r\n}\r\n\r\nupdateCell(oCol, sVal){\r\n    if(this.iCurrentRow >= 0){\r\n        this.onBeforeDataUpdate.fire(this);\r\n        \r\n        this.aData[this.iCurrentRow].aCells[oCol._iColIndex].sValue = sVal;\r\n        //this.sortData();    // This would cause issues, if the ordering changes we need a full refresh\r\n        \r\n        this.onDataUpdate.fire(this, { \r\n            sType : \"cell\", \r\n            sUpdateRowId : this.sCurrentRowId, \r\n            oCol : oCol\r\n        });\r\n    }\r\n}\r\n\r\nupdateCellByRowId(sRowId, oCol, sVal){\r\n    const iRowIndex = this.rowIndexByRowId(sRowId);\r\n\r\n    if (iRowIndex >= 0){\r\n        this.onBeforeDataUpdate.fire(this);\r\n        \r\n        this.aData[iRowIndex].aCells[oCol._iColIndex].sValue = sVal;\r\n        \r\n        this.onDataUpdate.fire(this, { \r\n            sType : \"cell\", \r\n            sUpdateRowId : sRowId, \r\n            oCol : oCol\r\n        });\r\n    }\r\n}\r\n\r\nupdateSorting(){\r\n    const oL = this.oL;\r\n    \r\n    if(!this.bPaged && oL.piSortColumn >= 0){\r\n        this.handleData(null, \"page\", \"\", true, true);\r\n    }\r\n}\r\n\r\nupdateGrouping(){\r\n    var oL = this.oL;\r\n    \r\n    if(!this.bPaged && oL.peGrouping != df.grpDisabled){\r\n        this.handleData(null, \"page\", \"\", true, true);\r\n    }\r\n}\r\n\r\nonSettingChange(oEv){\r\n    if(oEv.sType === \"prop\"){\r\n        switch(oEv.sProp){\r\n            case \"piSortColumn\":\r\n            case \"pbReverseOrdering\":\r\n                this.updateSorting();\r\n                break;\r\n        }\r\n    }else if(oEv.sType === \"sorting\"){\r\n        this.updateSorting();\r\n    }else if(oEv.sType === \"grouping\"){\r\n        this.updateGrouping();\r\n    }\r\n}\r\n\r\n}","import { WebListModel } from './WebListModel.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    WebListView\r\n\r\nThe simple non scrolling body view for the WebList its mini MVC model. It simply renders all rows \r\nwithout a scollbar.\r\n    \r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListView {\r\n\r\n    constructor(oList, oModel, oController) {\r\n        this.oL = oList;\r\n        this.oM = oModel;\r\n        this.oC = oController;\r\n        this.oR = oList._oRowRenderer;\r\n\r\n        this.bPreventSubmit = false;    //  If true the double click will not triger the onsubmit. This is used by OnTableClick to explicitly prevent the OnSubmit if OnRowClick is fired.\r\n        this.bCancelClick = false;      //  If true clicks are ignored\r\n\r\n        this.bScroll = false;\r\n\r\n        this.onRowsRendered = new df.events.JSHandler();\r\n\r\n        oModel.onDataUpdate.on(this.onDataUpdate, this);\r\n        oModel.onRowChange.on(this.onRowChange, this);\r\n        oList._onSettingChange.on(this.onSettingChange, this);\r\n        oController.onCellClick.on(this.onCellClick, this);\r\n        oController.onAfterCellClick.on(this.onAfterCellClick, this);\r\n    }\r\n\r\n    genHtml(aHtml) {\r\n\r\n        aHtml.push('<div class=\"WebList_BodyWrp\">');\r\n        aHtml.push('<div class=\"WebList_Body', (this.oL.pbShowSelected ? ' WebList_ShowSelected' : ''), '\">');\r\n\r\n        this.tableHtml(aHtml);\r\n\r\n        aHtml.push('</div></div>');\r\n\r\n    }\r\n\r\n    afterRender(eList) {\r\n        this.eRowContainer = this.eBody = df.dom.query(eList, \"div.WebList_Body\");\r\n        this.eBodyWrp = df.dom.query(eList, \"div.WebList_BodyWrp\");\r\n\r\n        df.dom.addClass(this.oL._eControl, (this.bScroll ? 'WebList_Scrolling' : 'WebList_NoScrolling'));\r\n\r\n        df.events.addDomListener(\"click\", this.eBody, this.onTableClick, this);\r\n        df.events.addDomListener(\"dblclick\", this.eBody, this.onTableDblClick, this);\r\n\r\n        //  Notify other modules of the rendering of rows (genHtml generates rows right away)\r\n        this.onRowsRendered.fire(this);\r\n    }\r\n\r\n    /**\r\n     * Generates HTML for the group header (by appending it to the aHtml array.)\r\n     * \r\n     * @param {Integer} iGroupHeaderIndex Index of the group header.\r\n     * @param {Array} aHtml String builder array.\r\n     * @param {Integer} iItemIndex Index in the aDisplay array of the model.\r\n     */\r\n    groupHeaderHtml(aHtml, iGroupHeaderIndex, iItemIndex) {\r\n        const oM = this.oM;\r\n\r\n        if (iGroupHeaderIndex >= 0 && oM.aGroupHeaders[iGroupHeaderIndex]) {\r\n            const tHead = oM.aGroupHeaders[iGroupHeaderIndex];\r\n            const tGroup = oM.aGroups[tHead.iGroupIndex];\r\n\r\n            //  Generate previous header first\r\n            aHtml.push(`<div class=\"WebList_GroupHeader Web_Level${tHead.iGroupIndex} ${iItemIndex == 0? \"Web_First\" : \"\"}\" data-dfgrphead=\"${iGroupHeaderIndex}\" data-dfitem=\"${iItemIndex}\">`);\r\n            if (tGroup.sLabel) {\r\n                aHtml.push(`<span class=WebList_GroupHeader_Name>${tGroup.sLabel}</span>`);\r\n            }\r\n            if (tHead.sItem) {\r\n                aHtml.push(`<span class=\"WebList_GroupHeader_Item\">${tHead.sItem}</span> `);\r\n            }\r\n            if (tHead.sTotal) {\r\n                aHtml.push(`<span class=\"WebList_GroupHeader_Total\">${tHead.sTotal}</span> `);\r\n            } else if (tHead.iItems > 0) {\r\n                aHtml.push(`<span class=\"WebList_GroupHeader_Items\">${tHead.iItems}</span> `);\r\n            }\r\n\r\n            if(this.oL.pbGroupsCollapsible){\r\n                if(tHead.bCollapsed){\r\n                    aHtml.push(`<span class=\"WebList_GroupHeader_ToggleBtn\"><i class=\"WebList_GroupHeader_IconExpand\"></i></span>`);\r\n                }else{\r\n                    aHtml.push(`<span class=\"WebList_GroupHeader_ToggleBtn\"><i class=\"WebList_GroupHeader_IconCollapse\"></i></span>`);\r\n                }\r\n            }\r\n\r\n            aHtml.push('</div>');\r\n\r\n\r\n        }\r\n    }\r\n\r\n    itemHtml(aHtml, iIndex){\r\n        const oM = this.oM, tItem = oM.aDisplay[iIndex];\r\n\r\n        if(!tItem) return;\r\n\r\n        switch(tItem.eType){\r\n            case WebListModel.displayTypes.row:\r\n                {\r\n                    const tRow = oM.aData[tItem.iIndex];\r\n                    this.oR.rowHtml(tRow, aHtml, (iIndex % 2==0), oM.aGroups.length, oM.isFirst(tRow), oM.isLast(tRow), iIndex);\r\n                }\r\n                break;\r\n            case WebListModel.displayTypes.header:\r\n                this.groupHeaderHtml(aHtml, tItem.iIndex, iIndex);\r\n                break;\r\n        }\r\n    }\r\n\r\n    tableHtml(aHtml) {\r\n        this.oM.aDisplay.forEach((tItem, iIndex) => {\r\n            this.itemHtml(aHtml, iIndex);\r\n        });\r\n    }\r\n\r\n    refreshDisplay() {\r\n        const aHtml = [];\r\n\r\n        if (this.eRowContainer) {\r\n            this.tableHtml(aHtml);\r\n\r\n            this.eRowContainer.innerHTML = aHtml.join(\"\");\r\n\r\n            //  Notify other modules\r\n            this.onRowsRendered.fire(this);\r\n\r\n            //  Trigger a resize on surrounding controls\r\n            this.oL.sizeChanged(false);\r\n        }\r\n    }\r\n\r\n    refreshRow(sRowId, sNewRowId) {\r\n        let oM = this.oM;\r\n        const aHtml = [];\r\n\r\n        //  Lookup row details\r\n        const iRow = oM.rowIndexByRowId(sNewRowId);\r\n        const eRow = this.row(sRowId);\r\n        if (iRow >= 0 && eRow) {\r\n            const iIndex = eRow.dataset.dfitem;\r\n\r\n            //  Create new row\r\n            this.itemHtml(aHtml, iIndex);\r\n            \r\n            const eNewRow = df.dom.create(aHtml);\r\n            eRow.parentNode.replaceChild(eNewRow, eRow);\r\n        }\r\n    }\r\n\r\n    refreshCell(sRowId, oCol) {\r\n        const oM = this.oM;\r\n\r\n        const eCell = this.cell(sRowId, oCol._iCol);\r\n        const iRow = oM.rowIndexByRowId(sRowId);\r\n        if (eCell && iRow >= 0) {\r\n            eCell.innerHTML = this.oR.cellHtml(oCol, this.oM.aData[iRow], this.oM.aData[iRow].aCells[oCol._iColIndex]);\r\n        }\r\n    }\r\n\r\n    onDataUpdate(oEv) {\r\n\r\n\r\n        if (oEv.sType === \"row\") {\r\n            this.refreshRow(oEv.sUpdateRowId, oEv.sNewRowId);\r\n        } if (oEv.sType === \"cell\") {\r\n            this.refreshCell(oEv.sUpdateRowId, oEv.oCol);\r\n        } else {\r\n            this.refreshDisplay();\r\n        }\r\n    }\r\n\r\n    onRowChange(oEv) {\r\n\r\n        if (this.eBody) {\r\n            //  First check if group is collapsed, expanding the group will redraw so then we don't have to update the DOM\r\n            if(!this.oL._oGrouping.makeCurrentRowVisible()){\r\n                if (oEv.sPrevRowId) {\r\n                    const ePrevRow = this.row(oEv.sPrevRowId);\r\n                    if (ePrevRow) {\r\n                        df.dom.removeClass(ePrevRow, \"WebList_Selected\");\r\n                    }\r\n                }\r\n                \r\n                const eRow = this.row(oEv.sGotoRowId);\r\n                if (eRow) {\r\n                    df.dom.addClass(eRow, \"WebList_Selected\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onSettingChange(oEv) {\r\n        const oL = this.oL;\r\n\r\n        if (oEv.sType === \"redraw\") {\r\n            this.refreshDisplay();\r\n        } else if (oEv.sType === \"prop\") {\r\n            switch (oEv.sProp) {\r\n                case \"pbShowSelected\":\r\n                    if (this.eBody) {\r\n                        df.dom.toggleClass(this.eBody, \"WebList_ShowSelected\", oL.pbShowSelected);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Searches the specified element inside this.eRowContainer but makes sure it is not part of a \r\n     * nested list (inside an expand panel for example).\r\n     * \r\n     * @param {String} sSelector CSS Query Selector\r\n     * @returns The first element matching the selector that is not wrapped by another WebList_Body element.\r\n     */\r\n    containerElem(sSelector){\r\n        const aElems = this.eRowContainer?.querySelectorAll(sSelector);\r\n\r\n        if(aElems){\r\n            for(const eElem of aElems){\r\n                if(eElem.closest('div.WebList_Body') == this.eRowContainer){\r\n                    return eElem;\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /* \r\n    Returns the DOM element for a specific row (based on the rowid). Null if not found (might not be rendered).\r\n    */\r\n    row(sRowId) {\r\n        return this.containerElem('table.WebList_Row[data-dfrowid=\"' + sRowId + '\"]');\r\n    }\r\n\r\n    /*\r\n    Returns the DOM element for the specified group header index. Null if not found.\r\n    */\r\n    groupHeader(iGroupHeaderIndex) {\r\n        return this.containerElem('div.WebList_GroupHeader[data-dfgrphead=\"' + iGroupHeaderIndex + '\"]');\r\n    }\r\n    \r\n    /*\r\n    Returns the DOM element for the current row.\r\n    */\r\n    currentRowElem() {\r\n        return this.row(this.oM.sCurrentRowId);\r\n    }\r\n\r\n    item(iItemIndex){\r\n        return this.containerElem('[data-dfitem=\"' + iItemIndex + '\"]');\r\n    }\r\n\r\n    /*\r\n    Determines the rowid and column index by looking at the DOM structure. Used from event handler functions.\r\n    \r\n    @param  eElem   DOM element inside a cell / row.\r\n    @return Object with details.\r\n    */\r\n    determineCell(eElem) {\r\n        var oRes = {\r\n            iCol: -1,\r\n            sRowId: null,\r\n            iHeaderIndex: -1,\r\n            eSwipeBtn: null,\r\n            bHeaderToggle: false\r\n        };\r\n\r\n        \r\n        while (eElem && eElem.parentNode && eElem !== this.eRowContainer && !oRes.sRowId) {\r\n            if (eElem.tagName === \"TD\" && eElem.hasAttribute(\"data-dfcol\")) {\r\n                oRes.iCol = parseInt(eElem.getAttribute(\"data-dfcol\"), 10);\r\n            } else if (eElem.tagName === \"TD\" && eElem.hasAttribute(\"data-dfswbtn\")) {\r\n                //  This is a bit of a shortcut but we talk to to the touch handler in person\r\n                oRes.eSwipeBtn = eElem;\r\n            } else if (eElem.tagName === \"TABLE\" && eElem.hasAttribute(\"data-dfisrow\")) {\r\n                oRes.sRowId = eElem.getAttribute(\"data-dfrowid\");\r\n            } else if(eElem.matches(\"div.WebList_GroupHeader[data-dfgrphead]\")){\r\n                oRes.iHeaderIndex = parseInt(eElem.dataset.dfgrphead, 10);\r\n            } else if(eElem.matches(\"span.WebList_GroupHeader_ToggleBtn\")){\r\n                oRes.bHeaderToggle = true;\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n\r\n        return oRes;\r\n    }\r\n\r\n\r\n    /* \r\n    This function handles the click event on the list table. It determines which row and which column is \r\n    clicked. It will trigger the cellClick on the column object and change row if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onTableClick(oEv) {\r\n        const that = this;\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled() || this.bCancelClick) {\r\n            return;\r\n        }\r\n\r\n        //  Determine which cell is clicked\r\n        const oCDtl = this.determineCell(oEv.getTarget());\r\n\r\n        //  Perform operations\r\n        if (oCDtl.eSwipeBtn) {\r\n            //  This is a bit of a shortcut as we have special swipe button logic here\r\n            this.oL._oTouchHandler.swipeBtnClick(oEv, oCDtl.eSwipeBtn);\r\n        } else if (oCDtl.sRowId !== null) {\r\n            //  The default cell click\r\n            if (this.oC.cellClick(oEv, oCDtl.sRowId, oCDtl.iCol)) {\r\n                this._bPreventSubmit = true;\r\n                setTimeout(function () {\r\n                    that.bPreventSubmit = false;\r\n                }, 250);\r\n                oEv.stop();\r\n            }\r\n        } else if(oCDtl.iHeaderIndex >= 0 && oCDtl.bHeaderToggle){\r\n            this.oL._oGrouping.toggleGroupHeader(oCDtl.iHeaderIndex);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the double click event on the list table. It will notify the controller of this event and \r\n    directly fires the submit if needed.\r\n    \r\n    @param  oEv     DOM Event object.\r\n    */\r\n    onTableDblClick(oEv) {\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        const oCDtl = this.determineCell(oEv.getTarget());\r\n\r\n        if (oCDtl.sRowId !== null) {\r\n            //  The default cell click\r\n            if (this.oC.cellDblClick(oEv, oCDtl.sRowId, oCDtl.iCol)) {\r\n                oEv.stop();\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Fire submit\r\n        if (!this.bPreventSubmit) {\r\n            this.oL.fireSubmit();\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    Handles the cellclick event from the controller to visualize the click.\r\n    */\r\n    onCellClick(oEv) {\r\n        const that = this;\r\n\r\n        this.bHitDone = false;\r\n        this.eHitElem = this.row(oEv.sRowId);\r\n        df.dom.addClass(this.eHitElem, df.CssHit);\r\n        this.tHitTimer = setTimeout(function () {\r\n            if (that.bHitDone) {\r\n                df.dom.removeClass(that.eHitElem, df.CssHit);\r\n            }\r\n            that.tHitTimer = null;\r\n        }, df.hitTimeout);\r\n    }\r\n\r\n\r\n    onAfterCellClick(oEv) {\r\n        if (!this.tHitTimer) {\r\n            df.dom.removeClass(this.eHitElem, df.CssHit);\r\n        }\r\n        this.bHitDone = true;\r\n    }\r\n\r\n    /*\r\n    Empty stub used by subclasses. A non scrollable view ignores heights that are set but grows according to its content.\r\n    \r\n    @param  iHeight     Height in pixels.\r\n    */\r\n    setHeight(iHeight) {\r\n\r\n    }\r\n\r\n    /* \r\n    Finds the cell element for the specified row and column.\r\n    \r\n    @param  sRowId    RowId for which we want the cell element.\r\n    @param  iCol    Column number for the cell.\r\n    @return DOM element (TD) for the column (null if not found / available).\r\n    */\r\n    cell(sRowId, iCol) {\r\n        return (this.eRowContainer && df.dom.query(this.eRowContainer, \"table[data-dfrowid='\" + sRowId + \"'] td[data-dfcol='\" + iCol + \"']\")) || null;\r\n    }\r\n\r\n    /* \r\n    Returns the cell for provided column in the current row.\r\n    \r\n    @param  oCol    Column object.\r\n    @return DOM element for the current cell (null if not available).\r\n    */\r\n    colCell(oCol) {\r\n        return this.cell(this.oM.sCurrentRowId, oCol._iCol);\r\n    }\r\n\r\n    colCellByIndex(iCol) {\r\n        return this.cell(this.oM.sCurrentRowId, iCol);\r\n    }\r\n\r\n    /* \r\n    Used by the WebListHeaderView to align headers with scrollbar.\r\n    */\r\n    scrollbarWidth() {\r\n        return 0;\r\n    }\r\n\r\n    /* \r\n    Used by WebListController to determine page size for page up and page down.\r\n    */\r\n    getViewSize() {\r\n        return 10;\r\n    }\r\n\r\n    fullwidth() {\r\n        return (this.eBody && this.eBody.clientWidth) || 0;\r\n    }\r\n\r\n    /*\r\n    Empty stub used by subclasses.\r\n    */\r\n    setExtraRowHeight(sRowId, iExtra) {\r\n\r\n    }\r\n\r\n    /*\r\n    Empty stub used by subclasses.\r\n    */\r\n    getExtraRowHeight(sRowId) {\r\n        return 0;\r\n    }\r\n\r\n    /*\r\n    Empty stub used by subclasses.\r\n    */\r\n    scrollToRow(sRowID) {\r\n\r\n    }\r\n\r\n}\r\n","import { WebListModel } from './WebListModel.js';\r\nimport { WebListView } from './WebListView.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    WebListScrollingView\r\nExtends:\r\n    WebListView\r\n\r\nExtends the main view class of the WebList its mini MVC model with scrolling logic. It uses a \r\nvirtual scrolling system where only the visible rows and a few above / below are rendered. This \r\nkeeps the number of DOM elements low and the performance up. It also supports paged data loading \r\n(WebListPagedModel) to support 'endless scrolling' where data is only partially loaded and chuncks \r\nof data are requested when needed.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n    2018/02/22  (HW, DAW)\r\n        It now keeps track of independent row heights and calculates accordingly.\r\n*/\r\n \r\nexport class WebListScrollingView extends WebListView{\r\n\r\nheightCache = {\r\n\r\n}\r\n\r\nconstructor(oList, oModel, oController){\r\n    super(oList, oModel, oController);\r\n    \r\n    this.bScroll = true;\r\n\r\n    this.bZebraTop = false;    //  Indicates wether the next row inserted on top should be a 'Odd' colored row\r\n    this.bZebraBottom = false; //  Indicates wether the next row inserted at the bottom should be a 'Odd' colored row\r\n    \r\n    this.iTableOffset = 0;     //  The scrollOfset of the table (number of pixels between the first rendered row and the first visisble row)\r\n    this.iScrollOffsetPx = 0;  //  The number of (virtual) pixels from the top of the list to the displayed part\r\n    this.iRowDispOffset = 0;   //  The first row that is currently rendered\r\n    this.iViewOffset = 0;      //  The number of rows rendered above the first visible row\r\n    this.iRowsDispOffset = 0;  //  The total offset from the top of the cache to the first rendered row\r\n    this.iRowDispLast = 0;     //  The last displayed row\r\n    \r\n    this.iPrefViewOffset = 8;      //  The preferred view offset (amount of rows rendered that are not visible)\r\n    this.iMaxViewOffsetDiff = this.iPrefViewOffset / 2;      //  The preferred view offset (amount of rows rendered that are not visible)\r\n    \r\n    this.iLastScrollbarSet = 0;    //  The last scrollTop set to the scrollbar so we know if we need to redraw on this event\r\n    this.bScrollbarDirty = false;  //  Sometimes when not rendered yet the scrollbar doesn't update properly, this property indicates that it is still off and needs to be corrected\r\n    \r\n    \r\n    this.iAvgRowHeight = 0;     // Average row height used when a row is not rendered yet\r\n    this.iTableHeight = 0;     //  The height of the table in pixels\r\n    \r\n    this.bNoRender = false;    //  Tempolary disables the rendering while initializing or updating the cache\r\n    \r\n    this.iAutoScroll = 0;      //  Used by the kinetic scrolling system to indicate that we are still \"scrolling\"\r\n    \r\n    this.oInitialFullEvent = null;\r\n    this.bFirstFill = true;\r\n\r\n    this.aItemHeightProcess = [];\r\n    \r\n    this.onHorizontalScroll = new df.events.JSHandler();\r\n    this.onVerticalScroll = new df.events.JSHandler();\r\n\r\n    this.bDelUpdDim = false;        //  If true a dimension update is scheduled\r\n    this.bDelUpdDimForced = false;  //  If true the scheduled dimension updated is a forced update\r\n\r\n    oList._onResize.on(this.onResize, this);\r\n\r\n    this._oDimUpdConf = null;   //  Config for pending dimension update\r\n}\r\n\r\ngenHtml(aHtml){\r\n    aHtml.push('<div class=\"WebList_BodyWrp\">');\r\n    \r\n    \r\n    aHtml.push('<div class=\"WebList_Body', (this.oL.pbShowSelected ? ' WebList_ShowSelected' : ''), '\">');\r\n    \r\n    aHtml.push('<div class=\"WebList_TableWrp', (this.oL.pbAutoColumnSizing ? \" WebList_AutoSize\" : \" WebList_HorizScroll\"), '\">');\r\n    aHtml.push('<div class=\"WebList_Table\">');\r\n    \r\n    /* this.tableHtml(aHtml); */\r\n    \r\n    aHtml.push('</div></div></div>');\r\n    aHtml.push('<div class=\"WebList_Scroll\" tabindex=\"-1\"><div class=\"WebList_Stretcher\" style=\"width: 1px;\"></div></div>');\r\n    aHtml.push('</div>');\r\n}\r\n\r\nafterRender(eList){\r\n    this.eTableWrp = df.dom.query(eList, \"div.WebList_TableWrp\");\r\n    this.eTable = df.dom.query(eList, \"div.WebList_Table\");\r\n    this.eScrollbar = df.dom.query(eList, \"div.WebList_Scroll\");\r\n    this.eScrollStretch = df.dom.query(eList, \"div.WebList_Scroll > div.WebList_Stretcher\");\r\n    \r\n    super.afterRender(eList);\r\n    \r\n    \r\n    df.events.addDomMouseWheelListener(this.eBody, this.onMouseWheelScroll, this);\r\n    df.dom.on(\"scroll\", this.eScrollbar, this.onScrollbarScroll, this);\r\n    df.dom.on(\"scroll\", this.eTableWrp, this.onHorizbarScroll, this);\r\n    df.events.addDomCaptureListener(\"load\", this.eTableWrp, this.onContentLoaded, this);\r\n}\r\n\r\nafterFirstFill(){\r\n    df.dom.animFrame(function(){\r\n        //  Scroll to the sort column\r\n        if(this.oL.piSortColumn > 0){\r\n            this.scrollToCol(this.oL.piSortColumn);\r\n        }\r\n    }, this);\r\n}\r\n\r\nonDataUpdate(oEv){\r\n    let iOffsetTop;\r\n\r\n    this.iMaxPX = null;\r\n    if(oEv.sType === \"full\"){\r\n        if(!this.eBody){\r\n            this.oInitialFullEvent = oEv;\r\n            return;\r\n        }\r\n                \r\n        //  Clear row height (grouping does a refresh without creating new rows)\r\n        this.clearHeightCache();\r\n\r\n        this.updateScrollbarSize();\r\n        \r\n        this.bNoRender = true;\r\n        const eRow = this.row(this.oM.sCurrentRowId);\r\n        if(eRow){\r\n            iOffsetTop = eRow.offsetTop - this.iTableOffset;\r\n        }else{\r\n            this.centerCurrentRow();\r\n        }\r\n\r\n    \r\n        this.bNoRender = false;\r\n        this.updatePosition(true);\r\n        \r\n        this.dimensionUpdate({\r\n            bUpdateRows : false,\r\n            bUpdateScrollbar : true,\r\n            bForceRedraw : false,\r\n            fFinished : () => {\r\n                if (eRow){\r\n                    this.smartRepositionCurrentRow(iOffsetTop);\r\n                }else{\r\n                    this.centerCurrentRow();\r\n                }\r\n\r\n            }\r\n        });\r\n        //  If there is no table height this is probably the initial rendering of the list so we do call centerCurrentRow in the next animation frame when hopefully iTableHeight is figured out.\r\n        if(this.iTableHeight <= 0){\r\n            df.dom.animFrame(function(){\r\n                if(this.iTableHeight > 0){\r\n                    this.centerCurrentRow();\r\n                }\r\n            }, this);\r\n        }\r\n\r\n        //  First time trigger afterFirstFill\r\n        if(this.bFirstFill){\r\n            this.bFirstFill = false;\r\n            this.afterFirstFill();\r\n        }\r\n    }\r\n    if(oEv.sType === \"next\"){\r\n       this.updateScrollbarSize();\r\n    }\r\n    if(oEv.sType === \"prev\"){\r\n        //  Update display props\r\n        this.iScrollOffsetPx += oEv.iOffsetChange * (this.iAvgRowHeight || 20);\r\n        this.iRowDispOffset += oEv.iOffsetChange;\r\n        this.iRowsDispOffset += oEv.iOffsetChange;\r\n        this.iRowDispLast += oEv.iOffsetChange;\r\n        \r\n        //  Update display\r\n        this.bNoRender = true;\r\n        this.updateScrollbarSize();\r\n        this.eScrollbar.scrollTop = this.eScrollbar.scrollTop  + oEv.iOffsetChange * (this.iAvgRowHeight || 20);\r\n        this.bNoRender = false;\r\n        this.updatePosition();\r\n    }\r\n    if(oEv.sType === \"row\"){\r\n        this.refreshRow(oEv.sUpdateRowId, oEv.sNewRowId);\r\n    }\r\n    if(oEv.sType === \"cell\"){\r\n        this.refreshCell(oEv.sUpdateRowId, oEv.oCol);\r\n    }\r\n    if(oEv.sType === \"newrow\"){\r\n        this.bNoRender = true;\r\n        this.updateScrollbarSize();\r\n        this.scrollToCurrentRow();\r\n        this.bNoRender = false;\r\n\r\n        this.updatePosition(true);\r\n    }\r\n    if(oEv.sType === \"remrow\"){\r\n        this.bNoRender = true;\r\n        this.updateScrollbarSize();\r\n        this.scrollToCurrentRow();\r\n        this.bNoRender = false;\r\n\r\n        this.updatePosition(true);\r\n    }\r\n    if(oEv.sType === \"display\"){\r\n        // Refresh caused by display table change where we want to keep the exact current position\r\n        const iRowDispOffset = this.iRowDispOffset;\r\n        const iTableOffset = this.iTableOffset;\r\n\r\n        this.updatePosition(true);\r\n        \r\n        this.dimensionUpdate({\r\n            bUpdateRows : false,\r\n            bUpdateScrollbar : true,\r\n            bForceRedraw : false,\r\n            fFinished : () => {\r\n                const iOffset = this.combinedRowHeightPx(0, iRowDispOffset) + iTableOffset;\r\n\r\n                this.scrollTo(iOffset, false, false, false);\r\n                if(oEv.iDisplayItem){\r\n                    this.scrollToDisplayItem(oEv.iDisplayItem);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nonRowChange(oEv){\r\n    if(this.eBody){\r\n        super.onRowChange(oEv);\r\n\r\n        //  If a dimension update is pending we wait for it, else we center directly\r\n        if(this._oDimUpdConf){\r\n            this.dimensionUpdate({\r\n                fFinished : () => {\r\n                    this.scrollToCurrentRow();\r\n                }\r\n            });\r\n        }else{\r\n            this.scrollToCurrentRow();\r\n        }\r\n    }\r\n}\r\n\r\n\r\nonSettingChange(oEv){\r\n    if(oEv.sType === \"redraw\"){\r\n        this.updatePosition(true);\r\n    }else if(oEv.sType === \"prop\" && oEv.sProp === \"pbAutoColumnSizing\"){\r\n        df.dom.toggleClass(this.eTableWrp, \"WebList_AutoSize\", this.oL.pbAutoColumnSizing);\r\n        df.dom.toggleClass(this.eTableWrp, \"WebList_HorizScroll\", !this.oL.pbAutoColumnSizing);\r\n    }else{\r\n        super.onSettingChange(oEv);\r\n    }\r\n}\r\n\r\n// - - - - - - - Display & scroll - - - - - - -\r\n\r\n/* \r\nScrolls the specified amount of pixels up or down.\r\n*/\r\nscroll(iDelta, bSnap, bFromScrollbar){\r\n    let iOffset;\r\n    \r\n    //  Determine new offset\r\n    iOffset = this.iScrollOffsetPx;\r\n    iOffset += iDelta;\r\n\r\n    //  We do not check the boundaries because ScrollTo will do that..\r\n    \r\n    //  Perform actual scrolling \r\n    this.scrollTo(iOffset, bSnap, bFromScrollbar);\r\n}\r\n\r\n/* \r\nScrolls to the specified offset. It optionally snaps to the closest row. \r\n*/\r\nscrollTo(iOffset, bSnap, bFromScrollbar, bNoBoundaries){\r\n    if(iOffset !== this.iScrollOffsetPx){\r\n        this.iScrollOffsetPx = iOffset;\r\n        \r\n        //  We do not check boundaries or do snapping as updatePosition does that now\r\n        this.updatePosition(false, bSnap, !!bNoBoundaries);\r\n    \r\n        //  Update scrollbar \r\n        if(!bFromScrollbar){\r\n            this.updateScrollbarPos(this.iScrollOffsetPx);\r\n        }\r\n\r\n        this.onVerticalScroll.fire(this, {\r\n            iScrollOffsetPx : this.iScrollOffsetPx\r\n        });\r\n\r\n        this.updateCache();\r\n    }\r\n}\r\n\r\n/* \r\nUpdates the display. It calculates which rows should be rendered, updates or refreshes the view, \r\nand updates the scrollOffset.\r\n\r\n@param  bForceRedraw    Enforces a full redraw of the view.\r\n@param  bSnap           Snaps to a specific row.\r\n*/\r\nupdatePosition(bForceRedraw, bSnap, bNoBoundaries){\r\n    const oM = this.oM;\r\n    let  iViewOffsetPx, iScrollOffsetPx, iRowViewLast = null, iRowDispLast, iRowDispOffset, iRowScrollOffset = null, \r\n        iEmptyRows = 0, iTotalPx = 0, iViewEndOffsetPx, iRowPx, iMaxPX, iInitScrollOffsetPx, iViewRowOffsetPx;\r\n\r\n    if(!this.eBody || this.bNoRender){\r\n        return;\r\n    }\r\n    const iTableHeight = this.tableHeight();\r\n\r\n    bSnap = !!bSnap;\r\n    bNoBoundaries = !!bNoBoundaries;\r\n    bForceRedraw = !!bForceRedraw;\r\n\r\n    iMaxPX = this.getMaxPX();\r\n    iInitScrollOffsetPx = iScrollOffsetPx = (bNoBoundaries ? this.iScrollOffsetPx : Math.min(this.iScrollOffsetPx, iMaxPX));\r\n    iViewEndOffsetPx = Math.max(iScrollOffsetPx, 0) + iTableHeight; \r\n    \r\n    //var sLog = \"updatePosition(\" + iScrollOffsetPx + \")\";\r\n\r\n    //  Loop over rows to determine the first & last rendered rows based on the height\r\n    for(let i = 0; i < oM.aDisplay.length; i++){\r\n        iRowPx = this.rowHeightPx(i);\r\n\r\n        //  Snapping logic\r\n        if(bSnap && iRowScrollOffset === null && iTotalPx + iRowPx > iScrollOffsetPx && iRowPx < (this.iAvgRowHeight * 1.5)){\r\n            if((iScrollOffsetPx - iTotalPx) < (iRowPx / 2)){\r\n                iScrollOffsetPx = iTotalPx;\r\n            }else{\r\n                iScrollOffsetPx = iTotalPx + iRowPx;\r\n            }\r\n        }\r\n\r\n        iTotalPx += iRowPx;\r\n        \r\n        //  Find the first displayed row\r\n        if(iRowScrollOffset === null && iTotalPx >= iScrollOffsetPx){\r\n            if(bNoBoundaries){\r\n                this.iScrollOffsetPx = iScrollOffsetPx;\r\n            }else{\r\n                this.iScrollOffsetPx = iScrollOffsetPx = Math.max(0, Math.min(iScrollOffsetPx, iMaxPX));\r\n            }\r\n            iViewEndOffsetPx = Math.max(iScrollOffsetPx, 0) + iTableHeight;\r\n\r\n            iRowScrollOffset = i;\r\n            iViewRowOffsetPx = iTotalPx - iRowPx;\r\n        }\r\n\r\n        //  Find the last displayed row\r\n        if(iTotalPx >= iViewEndOffsetPx){\r\n            iRowViewLast = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    //  Snap adjustment for the last row\r\n    if(iMaxPX - iInitScrollOffsetPx < this.iAvgRowHeight * 0.5){\r\n        iScrollOffsetPx = iMaxPX;\r\n    }\r\n\r\n    //  If we did not find a start offset\r\n    if(iRowScrollOffset === null){\r\n        if(bNoBoundaries){\r\n            this.iScrollOffsetPx = iScrollOffsetPx;\r\n        }else{\r\n            this.iScrollOffsetPx = iScrollOffsetPx = Math.max(0, Math.min(iScrollOffsetPx, iMaxPX));\r\n        }\r\n        iViewEndOffsetPx = Math.max(iScrollOffsetPx, 0) + this.iTableHeight;\r\n\r\n        iRowScrollOffset = 0;\r\n        iViewRowOffsetPx = 0;\r\n    }\r\n\r\n    //  If we did not find an end offset\r\n    if(iRowViewLast === null){\r\n        iRowViewLast = Math.max(0, oM.aDisplay.length - 1);\r\n    }\r\n    \r\n    //  See if we need empty rows at the end..\r\n    if(iTotalPx < this.iTableHeight){\r\n        iEmptyRows = (this.iTableHeight - iTotalPx) / (this.iAvgRowHeight || 20) + this.iPrefViewOffset;\r\n    }\r\n    \r\n    //  Calculate the target row offset\r\n    iRowDispOffset = Math.max(iRowScrollOffset - this.iPrefViewOffset, 0);\r\n    iRowDispLast = Math.min(iRowViewLast + this.iPrefViewOffset, oM.aDisplay.length - 1);\r\n\r\n    \r\n    //  Choose between full redraw and adjustment. Adjustment is possible if the rows are already in the rendered area. \r\n    if(bForceRedraw || (iRowScrollOffset < this.iRowDispOffset) || (iRowViewLast > this.iRowDispLast) ||  this.iCalcEmptyRows !== iEmptyRows){\r\n        // sLog += \" --refresh list! \" + iRowDispOffset + \" --> \" + iRowDispLast + \" --- \" + iEmptyRows;\r\n        this.iCalcEmptyRows = iEmptyRows;\r\n        this.iRowDispLast = iRowDispLast;\r\n        this.iRowDispOffset = iRowDispOffset;\r\n        \r\n        this.refreshDisplay();\r\n    }else{\r\n        // sLog += \" --adjust list! \" + iRowDispOffset + \" --> \" + iRowDispLast;\r\n\r\n        this.adjustDisplay(iRowDispOffset, iRowDispLast);\r\n    }\r\n    \r\n    //  Calculate and update view scroll offset\r\n    iViewOffsetPx = iScrollOffsetPx - (iViewRowOffsetPx - this.combinedRowHeightPx(this.iRowDispOffset, iRowScrollOffset));\r\n    this.updateScrollOffset(iViewOffsetPx);\r\n}\r\n\r\n/*\r\nRefreshes the dispay completely by regenerating the table html.\r\n*/\r\nrefreshDisplay(){\r\n    const aHtml = [];\r\n    \r\n    //  Warn for excessive rendering\r\n    const iRows = this.iRowDispLast - this.iRowDispOffset;\r\n    if(iRows > 100){\r\n        console.warn(`Painting issue, painting ${iRows} rows`);\r\n    }\r\n    \r\n    this.tableHtml(aHtml);\r\n    \r\n    if(df.sys.isIE){\r\n        while(this.eTable.lastChild){\r\n            this.eTable.removeChild(this.eTable.lastChild);\r\n        }\r\n    }\r\n\r\n    this.eTable.innerHTML = aHtml.join('');\r\n    \r\n    //  Notify other modules\r\n    this.onRowsRendered.fire(this);\r\n\r\n    this.dimensionUpdate({\r\n        bUpdateRows : true,\r\n        bUpdateScrollbar : true,\r\n        bForceRedraw : false\r\n    });\r\n}\r\n\r\n/* \r\nAugments rowHtml and queues the generated row for height calculation once it is has been rendered.\r\n\r\n*/\r\nitemHtml(aHtml, iIndex){\r\n    super.itemHtml(aHtml, iIndex);\r\n    \r\n    this.aItemHeightProcess.push(iIndex);\r\n}\r\n\r\n/* \r\nOverrides the tableHtml function as it now only renders the rows in the current view. It depends on\r\nthis.iRowDispOffset, this.iCalcRowDispLast and this.iCalcEmptyRows to be properly set by \r\nupdatePosition.\r\n*/\r\ntableHtml(aHtml){\r\n    const oM = this.oM;\r\n    \r\n    //  Loop rows\r\n    for(let i = this.iRowDispOffset; i <= this.iRowDispLast && i < oM.aDisplay.length; i++){\r\n        this.itemHtml(aHtml, i);\r\n    }\r\n\r\n    //  Generate \"empty\" rows\r\n    for(let i = 0; i < this.iCalcEmptyRows; i++){\r\n        this.oR.rowHtml(null, aHtml, ((i + this.iRowDispLast + 1) % 2==0), oM.aGroups.length, false, false);\r\n    }\r\n}\r\n\r\n/* \r\nAdjusts the display by adding / removing rows on top or the bottom. This is done to improve scroll\r\nperformance (instead of full refresh).\r\n\r\n@param  iRowDispOffset  The first row to be rendered.\r\n@param  iRowDispLast    The last row to be rendered.\r\n*/\r\nadjustDisplay(iRowDispOffset, iRowDispLast){\r\n    const iAllowedDiff = this.iMaxViewOffsetDiff;\r\n    let bAdd = false;\r\n    \r\n    if(this.iRowDispOffset > iRowDispOffset){\r\n        //  Add rows on top\r\n        if(this.iRowDispOffset > (iRowDispOffset + iAllowedDiff)){\r\n            while(this.iRowDispOffset > iRowDispOffset){\r\n                this.iRowDispOffset--;\r\n                this.insertRow(this.iRowDispOffset, true);\r\n                \r\n                bAdd = true;\r\n            }\r\n        }\r\n        \r\n        //  Remove rows on the bottom\r\n        if(this.iRowDispLast > (iRowDispLast + iAllowedDiff)){\r\n            while(this.iRowDispLast > iRowDispLast){\r\n                this.removeBottomRow();\r\n            }\r\n        }\r\n    }else{\r\n                \r\n        //  Add rows on the bottom\r\n        if(this.iRowDispLast < (iRowDispLast - iAllowedDiff)){\r\n            while(this.iRowDispLast < iRowDispLast){\r\n                this.iRowDispLast++;\r\n                this.insertRow(this.iRowDispLast, false);\r\n\r\n                bAdd = true;                \r\n            }\r\n        }\r\n        \r\n        // Remove rows on top\r\n        if(this.iRowDispOffset < (iRowDispOffset - iAllowedDiff)){\r\n            while(this.iRowDispOffset < iRowDispOffset){\r\n                this.removeTopRow();\r\n            }\r\n        }\r\n    }\r\n\r\n    if(bAdd){\r\n        //  Notify other modules\r\n        this.onRowsRendered.fire(this);\r\n    }\r\n}\r\n\r\n/*\r\nThis method removes a single row from the display table. It makes sure the _iRowDispOffset and \r\n_iViewOffset are properly updated. It is called by the adjustDisplay method.\r\n\r\n@private\r\n*/\r\nremoveTopRow(){\r\n    if(!this.eTable.firstChild) return;\r\n\r\n    \r\n    //  Remove things that are not rows on top first\r\n    while(!this.eTable.firstChild.hasAttribute(\"data-dfitem\")){\r\n        this.eTable.removeChild(this.eTable.firstChild);\r\n    }\r\n    \r\n    if(!this.eTable.firstChild) return;\r\n    this.eTable.removeChild(this.eTable.firstChild);\r\n\r\n    this.iRowDispOffset++;\r\n    this.bZebraTop = !this.bZebraTop; \r\n}\r\n\r\n/*\r\nThis method removes a single row from the top of the display table. It is called by the \r\nadjustDisplay method.\r\n\r\n@private\r\n*/\r\nremoveBottomRow(){\r\n    if(!this.eTable.lastChild) return;\r\n\r\n    //  Remove things that are not rows on top first\r\n    while(!this.eTable.firstChild.hasAttribute(\"data-dfitem\")){\r\n        this.eTable.removeChild(this.eTable.lastChild);\r\n    }\r\n    \r\n    if(!this.eTable.lastChild) return;\r\n    this.eTable.removeChild(this.eTable.lastChild);\r\n\r\n    this.iRowDispLast--;\r\n    this.bZebraBottom = !this.bZebraBottom;\r\n}\r\n\r\n/* \r\nThere are more rows rendered than there are visible. We hide the first extra top rows visible using\r\nCSS translateY.\r\n\r\n@param  \r\n*/\r\nupdateScrollOffset(iOffset){\r\n    if(this.eTable){\r\n        this.iTableOffset = iOffset;\r\n\r\n        df.dom.translateY(this.eTable, -iOffset, true);\r\n        \r\n        if(this.eTableWrp.scrollTop > 0){\r\n            this.eTableWrp.scrollTop = 0;  //  Reset this as it somehow gets scrolled :S\r\n        }\r\n    }\r\n}\r\n\r\n/* \r\nThis function inserts a single row into the list using DOM object creation. This is slower as using \r\ninnerHTML but is faster as refreshing the entire table (which needs to be done using innerHTML).\r\n\r\n@param  iItemIndex  Index of the inserted display item.\r\n@param  bTop    True if the row needs to be inserted at the top, false for the bottom.\r\n@private\r\n*/\r\ninsertRow(iItemIndex, bTop){\r\n    const aHtml = [];\r\n\r\n    //  Generate row element\r\n    this.itemHtml(aHtml, iItemIndex);\r\n    const eElem = df.dom.create(aHtml);\r\n    if(bTop){\r\n        this.eTable.prepend(eElem);\r\n    }else{\r\n        this.eTable.appendChild(eElem);\r\n    }\r\n}\r\n\r\n/**\r\n * Clears the height information cached.\r\n */\r\nclearHeightCache(){\r\n    //  Clear cached row heights as these might change\r\n    this.oM.aDisplay.forEach(tItem => { \r\n        tItem._iRowHeight = null; \r\n    });\r\n    \r\n    this.heightCache = {};\r\n}\r\n\r\n/**\r\n * Determines the height of an element by looking at the BoundingClientRect which also includes fractions.\r\n * \r\n * @param {DOM Element} eElem \r\n * @returns Height of the element.\r\n */\r\nrealHeight(eElem){\r\n    return eElem?.getBoundingClientRect().height || 0;\r\n}\r\n\r\n/**\r\n * Determines the vertical margin but assumes collapsing and repetition of the element. \r\n * \r\n * @param {DOM element} eElem \r\n * @returns Vertical margin in pixels assuming they are collapsed.\r\n */\r\nrealMargin(eElem){\r\n    const oStyle = df.sys.gui.getCurrentStyle( eElem);\r\n    const iMarginTop = parseFloat(oStyle.marginTop) || 0;\r\n    const iMarginBottom = parseFloat(oStyle.marginBottom) || 0;\r\n\r\n    return Math.max(iMarginTop, iMarginBottom);\r\n}\r\n\r\n/**\r\n * Updates the row height of the specified row in the administration (_iRowHeight). It takes header elements into account.\r\n * \r\n * @param {String} iItemIndex \r\n * @returns \r\n */\r\nupdateItemHeight(iItemIndex){\r\n    const oM = this.oM;\r\n    \r\n    const eElem = this.item(iItemIndex); \r\n    if(!eElem)\r\n        return false;\r\n\r\n    // Row body height\r\n    let iHeight = this.realHeight(eElem);\r\n\r\n    // Row margins\r\n    const sRowClass = eElem.className;\r\n    if(!this.heightCache.hasOwnProperty(sRowClass)) this.heightCache[sRowClass] = this.realMargin(eElem);\r\n    iHeight += this.heightCache[sRowClass];\r\n    \r\n    const bChange = oM.aDisplay[iItemIndex]._iRowHeight !== iHeight;\r\n    oM.aDisplay[iItemIndex]._iRowHeight = iHeight;\r\n    return bChange;\r\n}\r\n\r\n/*\r\nCalculates the average row height and stores it in iAvgRowHeight.\r\n*/\r\nupdateAvgRowHeight(){\r\n    let iSum = 0, iCount = 0;\r\n\r\n    this.oM.aDisplay.forEach(function(tItem){\r\n        if(tItem._iRowHeight){\r\n            iCount++;\r\n            iSum += tItem._iRowHeight;\r\n        }\r\n    });\r\n\r\n    if(iCount){\r\n        this.iAvgRowHeight = iSum / iCount;\r\n    }\r\n    this.iMaxPX = 0;\r\n}\r\n\r\n/*\r\nUpdates the row heights for all rendered rows. If \r\n*/\r\nupdateRenderedRowHeights(){\r\n    let bChange = false;\r\n\r\n    for(let iItem = this.iRowDispOffset; iItem < this.oM.aDisplay.length && iItem <= this.iRowDispLast; iItem++){\r\n        bChange |= this.updateItemHeight(iItem);\r\n    }\r\n\r\n    this.aItemHeightProcess = [];\r\n    \r\n    \r\n    if(bChange){\r\n        this.updateAvgRowHeight();\r\n        this.iMaxPX = null;\r\n    }\r\n\r\n    return bChange;\r\n}\r\n\r\n/*\r\nProcesses row height calculations that need to be perfomed.\r\n\r\n@return True if row heights have been recalculated.\r\n*/\r\nprocessRowHeights(){\r\n    let iItemIndex, bChange = false;\r\n\r\n    while(iItemIndex = this.aItemHeightProcess.pop()){\r\n        bChange = true;\r\n        this.updateItemHeight(iItemIndex);\r\n    }\r\n    \r\n    if(bChange){\r\n        this.iMaxPX = null;\r\n        this.updateAvgRowHeight();\r\n    }\r\n\r\n    return bChange;\r\n}\r\n\r\n/*\r\nDetermines the row height for a specific row by looking at the cached value (or it takes the average).\r\n\r\n@param  iRow    The row index.\r\n@return Row height in pixels.\r\n*/\r\nrowHeightPx(iRow){\r\n    let iHeightPx;\r\n    const tItem = this.oM.aDisplay[iRow];\r\n\r\n    if(tItem._iRowHeight){\r\n        iHeightPx = tItem._iRowHeight;\r\n    }else{\r\n        iHeightPx = this.iAvgRowHeight || 20;\r\n    }\r\n\r\n    if(tItem.eType == WebListModel.displayTypes.row){\r\n        iHeightPx += this.oM.aData[tItem.iIndex]._iRowHeightExtra || 0;\r\n    }\r\n\r\n    return iHeightPx;\r\n}\r\n\r\n/*\r\nCalculates the height of multiple rows.\r\n\r\n@param  iStart  Start row index.\r\n@param  iTo     End row index.\r\n@return    Total height in pixels.\r\n*/\r\ncombinedRowHeightPx(iStart, iTo){\r\n    const oM = this.oM;\r\n    let iHeightPx = 0;\r\n\r\n    for(let i = iStart; i < oM.aDisplay.length && i < iTo; i++){\r\n        iHeightPx += this.rowHeightPx(i);\r\n    }\r\n\r\n    return iHeightPx;\r\n}\r\n\r\n/* \r\nSnaps the specific offset to the closest row position and returns the snapped offset. Used by touch handler.\r\n\r\n@param  iOffsetPx   Offset in pixels.\r\n@return Snapped offset (closest row).\r\n*/\r\nsnapToRow(iOffsetPx){\r\n    let iTotalPx = 0;\r\n    const oM = this.oM;\r\n\r\n    for(let i = 0; i < oM.aDisplay.length; i++){\r\n        const iRowPx = this.rowHeightPx(i);\r\n\r\n        //  Snapping logic\r\n        if(iTotalPx + iRowPx > iOffsetPx){\r\n            if((iOffsetPx - iTotalPx) < (iRowPx / 2)){\r\n                return iTotalPx;\r\n            }else{\r\n                return iTotalPx + iRowPx;\r\n            }\r\n        }\r\n\r\n        iTotalPx += iRowPx;\r\n    }\r\n\r\n    return iTotalPx;\r\n}\r\n\r\n\r\n/* \r\nDetermines the maximum scrolling offset in pixels. It looks the height of the list and the height \r\nper row. It takes extra margin space into account for rows with an margin.\r\n*/\r\ngetMaxPX(){\r\n    if(this.iMaxPX){\r\n        return this.iMaxPX;\r\n    }\r\n    return (this.iMaxPX = Math.max(this.combinedRowHeightPx(0, this.oM.aDisplay.length) - this.iTableHeight, 0));\r\n}\r\n\r\n/*\r\nUpdates the size of the stretch element defining the size of the scrollbar thingy based on the \r\ncurrent cache.\r\n*/\r\nupdateScrollbarSize(){\r\n    const iHeight = this.combinedRowHeightPx(0, this.oM.aDisplay.length);\r\n    \r\n    if(this.eScrollStretch && this.eScrollStretch.clientHeight !== iHeight){\r\n        this.eScrollStretch.style.height = iHeight + \"px\";\r\n    }\r\n}\r\n\r\n/* \r\nUpdates the position displayed by the scrollbar.\r\n\r\n@param  iOffset     Offset in pixels from the top of the cache to the first displayed row.\r\n*/\r\nupdateScrollbarPos(iOffset){\r\n    let bDirty;\r\n    const that = this;\r\n    \r\n    if(this.eScrollbar){\r\n        this.eScrollbar.scrollTop = this.iLastScrollbarSet = iOffset;\r\n        this.bScrollbarDirty = bDirty = Math.abs(this.eScrollbar.scrollTop - this.iLastScrollbarSet) > 5;\r\n        \r\n        if(bDirty){\r\n            setTimeout(function(){\r\n                if(that.bScrollbarDirty && that.eScrollbar.scrollTop !== that.iLastScrollbarSet){\r\n                    that.eScrollbar.scrollTop = that.iLastScrollbarSet;\r\n                }\r\n                \r\n                that.bScrollbarDirty = false;\r\n            }, 300);\r\n        }  \r\n    }\r\n}\r\n\r\n/* \r\nHandles the scroll event of the scrollbar and will update the scroll position.\r\n\r\n@param  oEv     Event object.\r\n*/\r\nonScrollbarScroll(oEv){\r\n    const iOffset = this.eScrollbar.scrollTop;\r\n    \r\n    //  Ignore rounding changes up to 2 pixels and dirty scorllbar events\r\n    if(Math.abs(iOffset - this.iLastScrollbarSet) > 2 && !this.bScrollbarDirty){\r\n\r\n        this.iAutoScroll = 0;\r\n        this.iLastScrollbarSet = iOffset;\r\n        this.scrollTo(iOffset, true, true);\r\n    }\r\n}\r\n\r\n/* \r\nHandles the mousewheel event and scrolls the list accordingly. It relies on the scroll function it\r\nsnapping logic.\r\n\r\n@param  oEv     Event object.\r\n*/\r\nonMouseWheelScroll(oEv){\r\n    const iDelta = oEv.getMouseWheelDelta();\r\n    \r\n    this.iAutoScroll = 0;\r\n    \r\n    if(iDelta > 0){\r\n        //  Scroll up\r\n        this.scroll(-((this.iAvgRowHeight || 20) * 2), true);\r\n        \r\n    }else if(iDelta < 0){\r\n        //  Scroll down\r\n        this.scroll((this.iAvgRowHeight || 20) * 2, true);\r\n    }\r\n    \r\n    oEv.stop();\r\n}\r\n\r\n/* \r\nTriggers a cache update based on the current display boundaries by calling the controller object \r\npassing the currently displayed rows. The controller wil load extra rows if nessecary. \r\n*/\r\nupdateCache(){\r\n    this.oC.triggerCacheUpdate(this.iRowDispOffset, this.iRowDispLast);\r\n}\r\n\r\n/* \r\nCenters the currently selected row on the screen.\r\n*/\r\ncenterCurrentRow(){\r\n    const oM = this.oM;\r\n    \r\n    const iItemIndex = oM.rowIndexToItemIndex(oM.iCurrentRow);\r\n    const iTableHeight = this.tableHeight();\r\n    if(iItemIndex >= 0 && iTableHeight > 0){\r\n        let iOffsetPx = this.combinedRowHeightPx(0, iItemIndex);\r\n\r\n        iOffsetPx = iOffsetPx - (iTableHeight / 2) + (this.rowHeightPx(iItemIndex) / 2);\r\n\r\n        this.scrollTo(iOffsetPx, true, false);\r\n    }\r\n}\r\n\r\n/*\r\nRepositions the selected row based on the passed top offset that was stored before a refresh. This \r\ntop offset is the number of pixels to the first rendered row.\r\n\r\n@param  iOffsetTop  Offset to the first rendeeed row we try to restore.\r\n*/\r\nsmartRepositionCurrentRow(iOffsetTop){\r\n    const oM = this.oM;\r\n\r\n    const iItemIndex = oM.rowIndexToItemIndex(oM.iCurrentRow);\r\n    if(iItemIndex >= 0){\r\n        this.smartRepositionDisplayItem(iItemIndex, iOffsetTop);\r\n    }\r\n}\r\n\r\n/**\r\n * Repositions the display item based on passed top offset. \r\n * \r\n * @param {Integer} iItemIndex Index in the aDisplay array.\r\n * @param {Integer} iOffsetTop Offset in pixels to the first rendered row that we try to restore.\r\n */\r\nsmartRepositionDisplayItem(iItemIndex, iOffsetTop){\r\n    let iOffsetPx = this.combinedRowHeightPx(0, iItemIndex);\r\n    iOffsetPx -= iOffsetTop;\r\n\r\n    if(iOffsetPx > 0 && iOffsetPx < this.getMaxPX()){\r\n        this.scrollTo(iOffsetPx, true, false);\r\n    }\r\n\r\n    this.scrollToDisplayItem(iItemIndex); \r\n}\r\n\r\n/* \r\nScrolls to the currently selected row. Note that if the row is already on the screen it does nothing \r\nso it doesn't always refresh the display.\r\n*/\r\nscrollToCurrentRow(){\r\n    this.scrollToRow(this.oM.sCurrentRowId);\r\n}\r\n\r\n/* \r\nScrolls to the specified row. Note that if the row is already on the screen it does nothing \r\nso it doesn't always refresh the display.\r\n*/\r\nscrollToRow(sRowID){\r\n    const oM = this.oM;\r\n    \r\n    let iRow = oM.rowIndexByRowId(sRowID);\r\n    let iItemIndex = oM.rowIndexToItemIndex(iRow);\r\n    if(iItemIndex >= 0){\r\n        this.scrollToDisplayItem(iItemIndex);\r\n    }\r\n}\r\n    \r\n/**\r\n * Scrolls the specified item into the view.\r\n * \r\n * @param {Integer} iItemIndex Index in the aDisplay array.\r\n */\r\nscrollToDisplayItem(iItemIndex){\r\n    let iOffsetPx = this.combinedRowHeightPx(0, iItemIndex);\r\n    let iRowPx = this.rowHeightPx(iItemIndex);\r\n\r\n    if(iOffsetPx < this.iScrollOffsetPx){\r\n        this.scrollTo(iOffsetPx, true, false);\r\n    }else if(iOffsetPx + iRowPx > this.iScrollOffsetPx + this.iTableHeight){\r\n        iOffsetPx = iOffsetPx + iRowPx - this.iTableHeight; \r\n\r\n        this.scrollTo(iOffsetPx, false, false);\r\n    }\r\n}\r\n\r\nscrollToCol(iCol){\r\n    const oL = this.oL;\r\n    let eCell;\r\n\r\n    if(!oL.pbAutoColumnSizing){ \r\n        //  Get a cell element for this col (first try the current row, if not available try the first one available)\r\n        eCell = this.colCellByIndex(iCol); \r\n        if(!eCell){\r\n            eCell = (this.eBody && df.dom.query(this.eBody, \"td[data-dfcol='\" + iCol + \"']\")) || null;\r\n        }\r\n\r\n        if(eCell){\r\n            if(eCell.offsetLeft < this.eTableWrp.scrollLeft){\r\n                oL._oBody.scrollToHoriz(eCell.offsetLeft);\r\n            }else if(eCell.offsetLeft + eCell.offsetWidth > (this.eTableWrp.clientWidth + this.eTableWrp.scrollLeft)){\r\n                oL._oBody.scrollToHoriz(Math.min(eCell.offsetLeft, (eCell.offsetLeft + eCell.offsetWidth - this.eTableWrp.clientWidth)));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nscrollToHoriz(iScrollX){\r\n    this.eTableWrp.scrollLeft = iScrollX;\r\n}\r\n\r\n/* \r\nGets called during the resize process to set the height of the list. It updates the height of the \r\nbody and scrollbar element.\r\n\r\n@param  iHeight     Height to be set in pixels.\r\n*/\r\nsetHeight(iHeight){\r\n    iHeight -= df.sys.gui.getVertBoxDiff(this.eBody);\r\n    iHeight -= df.sys.gui.getVertBoxDiff(this.eBodyWrp);\r\n    \r\n    iHeight = Math.max(iHeight, 0);\r\n    \r\n    //  Set the height on the grid body\r\n    this.eBody.style.height = iHeight + \"px\";\r\n    this.eScrollbar.style.height = (df.dom.clientHeight(this.eTableWrp) || iHeight || 0) + \"px\";\r\n}\r\n\r\n/* \r\nDetermines the dimensions (table height) and detects a change in those. Also triggers a \r\nprocessRowHeights to be sure.\r\n\r\n@return True if dimensions did change.\r\n*/\r\ndetermineDimensions(){\r\n    let bChanged = false;\r\n    \r\n    if(this.eBody){\r\n        this.iPrevTableHeight = this.iTableHeight;\r\n        this.iTableHeight = this.eTableWrp.clientHeight || this.iTableHeight;\r\n        \r\n        bChanged = bChanged || this.iPrevTableHeight !== this.iTableHeight || this.iTableWidth !== this.eTableWrp.clientWidth;\r\n        \r\n        this.iTableWidth = this.eTableWrp.clientWidth;\r\n    }\r\n    \r\n    return bChanged;\r\n}\r\n\r\ntableHeight(){\r\n    return this.eTableWrp?.clientHeight || this.iTableHeight || 0;     \r\n}\r\n\r\n/*\r\nGives the browser a chance to recalculate the layout and do a repaint. Executes the provided \r\nfunction afterwards. Uses requestIdleCallback if availabe since that seems to give the best outcome, \r\nelse it uses animationframe or timeout.\r\n\r\n@param fFunc    Function to execute on repaint.\r\n*/\r\nwaitForRepaint(fFunc){\r\n    if(window.requestIdleCallback){\r\n        window.requestIdleCallback(fFunc, { timeout : 40 });\r\n    }else if(window.requestAnimationFrame){\r\n        window.requestAnimationFrame(fFunc);\r\n    }else{\r\n        window.setTimeout(fFunc, 40);\r\n    }\r\n}\r\n\r\n/*\r\nLooks at the dimensions and updates the UI if nessecary. Steps will only be performed \r\nif the previous steps detected changes or the config object explicitly turned on a step.\r\n\r\n1. Check if the WebList dimension changes.\r\n2. Update all the row heights.\r\n3. Update the scrollbar size.\r\n4. Update the position (causes a redraw of rows if nessecary).\r\n5. Update scrollbar width on header\r\n\r\n{\r\n    bUpdateRows : true,\r\n    bUpdateScrollbar : true,\r\n    bForceRedraw : true,\r\n    fFinished : null\r\n}\r\n*/\r\ndimensionUpdate(oConfig){\r\n    oConfig = oConfig  || {};\r\n\r\n    //  Save config\r\n    if(this._oDimUpdConf){\r\n        this._oDimUpdConf.bUpdateRows ||= oConfig.bUpdateRows;\r\n        this._oDimUpdConf.bUpdateScrollbar ||= oConfig.bUpdateScrollbar;\r\n        this._oDimUpdConf.bUpdateRows ||= oConfig.bUpdateRows;\r\n        if(oConfig.fFinished){\r\n            this._oDimUpdConf.aFinished.push(oConfig.fFinished);\r\n        }\r\n    }else{\r\n        oConfig.aFinished = (oConfig.fFinished ? [ oConfig.fFinished ] : []);\r\n        this._oDimUpdConf = oConfig;\r\n    }\r\n\r\n    this.waitForRepaint(() => {\r\n        const oConfig = this._oDimUpdConf;\r\n        if(!oConfig) return;\r\n        this._oDimUpdConf = null;\r\n\r\n        // 1. Check if the WebList dimension changes.\r\n        let bChanged = this.determineDimensions();\r\n    \r\n        // 2. Update all the row heights.\r\n        if (bChanged || oConfig.bUpdateRows){\r\n            bChanged |= this.updateRenderedRowHeights();\r\n        }else{\r\n            bChanged |= this.processRowHeights();\r\n        }\r\n\r\n        // 3. Update the scrollbar size.\r\n        if(bChanged  || oConfig.bUpdateScrollbar){\r\n            this.updateScrollbarSize();\r\n        }\r\n\r\n        // 4. Update the position (causes a redraw of rows if nessecary).\r\n        if(bChanged  || oConfig.bForceRedraw){\r\n            this.updatePosition(oConfig.bForceRedraw);\r\n        }\r\n\r\n        // 5. Update scrollbar width on header\r\n        if (this.eTableWrp)\r\n            this.eTableWrp.style.paddingRight = this.scrollbarWidth() + \"px\";\r\n\r\n        oConfig.aFinished.forEach((fFunc) => fFunc());\r\n    });\r\n}\r\n\r\n\r\n/* \r\nHandles the onResize event and makes sure the dimensions are read from the DOM. If they change we \r\ntrigger a redraw.\r\n\r\n@param  oEv Event object.\r\n*/\r\nonResize(oEv){\r\n    if(this.oInitialFullEvent){\r\n        //  Render for the first time\r\n        this.dimensionUpdate({\r\n            bUpdateRows : true,\r\n            bUpdateScrollbar : true,\r\n            bForceRedraw : true,\r\n            fFinished : () =>{\r\n                if(this.oInitialFullEvent){\r\n                    this.onDataUpdate(this.oInitialFullEvent);\r\n                    this.oInitialFullEvent = null;\r\n                }\r\n            }\r\n        });\r\n    }else{\r\n        this.dimensionUpdate({\r\n            bUpdateRows : false,\r\n            bUpdateScrollbar : false,\r\n            bForceRedraw : false\r\n        });\r\n    }\r\n}\r\n\r\n/*\r\nCaptures the load event and makes sure that the size of the row containing the target element gets \r\nredetermined. This should solve issues with images inside lists that load slower. Unfortunately it\r\ncan also cause unnessecary resize operations, but only when a cWebImageColumn is used.\r\n\r\n@param  oEv Event object.\r\n*/\r\nonContentLoaded(oEv){\r\n    let eElem = oEv.getTarget();\r\n\r\n    while(eElem && eElem !== this.eTableWrp){\r\n        if(eElem.hasAttribute(\"data-dfrowid\")){\r\n            const sRowId = eElem.getAttribute(\"data-dfrowid\");\r\n            if(this.aItemHeightProcess.indexOf(sRowId) <= 0){\r\n                this.aItemHeightProcess.push(sRowId);\r\n                this.dimensionUpdate({\r\n                    bUpdateRows : false,\r\n                    bUpdateScrollbar : false,\r\n                    bForceRedraw : false\r\n                });\r\n            }\r\n            \r\n            return;\r\n        }\r\n        eElem = eElem.parentNode;\r\n    }\r\n}\r\n\r\n/* \r\nUsed by the header view to determine the scrollbar width.\r\n*/\r\nscrollbarWidth(){\r\n    return this.eScrollbar && this.eScrollbar.offsetWidth || 0; \r\n}\r\n\r\n/* \r\nUsed by WebListController to determine page size for page up and page down.\r\n*/\r\ngetViewSize(){\r\n    const iTableHeight = this.tableHeight();\r\n    if(iTableHeight && this.iAvgRowHeight){\r\n        return iTableHeight / this.iAvgRowHeight;\r\n    }\r\n    return 10;\r\n}\r\n\r\n/* \r\nSets an extra (temporary) row height for a specific row, this is added to the existing row height. \r\nThe cWebListExpandPanel uses this when expanding a row.\r\n\r\n@param  sRowId  RowId of row to set extra height on.\r\n@param  iExtra  The extra height to add to the administration.\r\n*/\r\nsetExtraRowHeight(sRowId, iExtra){\r\n    const oM = this.oM;\r\n\r\n    const iRow = oM.rowIndexByRowId(sRowId);\r\n    if(iRow >= 0){\r\n        oM.aData[iRow]._iRowHeightExtra = iExtra;\r\n        this.iMaxPX = null;\r\n        this.updateScrollbarSize();\r\n    }\r\n}\r\n\r\n/* \r\nDetermines the extra height that is set for a specific row. \r\n\r\n@param  sRowId  RowId of the row to get the extra height of.\r\n@return Extra height in pixels.\r\n*/\r\ngetExtraRowHeight(sRowId){\r\n    const oM = this.oM\r\n\r\n    const iRow = oM.rowIndexByRowId(sRowId);\r\n    if(iRow >= 0){\r\n        return oM.aData[iRow]._iRowHeightExtra || 0;\r\n    }\r\n}\r\n\r\n/* \r\nHandles the scroll event of the WebList_TableWrp and triggers the onHorizontalScroll event allowing\r\nthe header to update its scroll position.\r\n\r\n@param  oEv     Event object.\r\n*/\r\nonHorizbarScroll(oEv){\r\n    this.onHorizontalScroll.fire(this, {\r\n        nScrollX : this.eTableWrp.scrollLeft\r\n    });\r\n}\r\n\r\n\r\n\r\n}\r\n\r\nexport default WebListScrollingView;","import { WebListModel } from './WebListModel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    WebListPagedModel\r\nExtends:\r\n    WebListModel\r\n\r\nExtends the model of the WebList its mini MVC system with logic for paged data loading.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n\r\nexport class WebListPagedModel extends WebListModel{\r\n\r\nconstructor(oList){\r\n    super(oList);\r\n    \r\n    this.bFirst = false;\r\n    this.bLast = false;\r\n    this.bPaged = true;\r\n    \r\n    this.iPrefCacheOffset = 25;    //  The preferred amount of rows in the cache above and below the rendered rows\r\n\r\n}\r\n\r\nhandleData(listData, sType, sStartRowId, bFirst, bLast){\r\n    const oOptions = { sType : \"\", iOffsetChange : 0, sUpdateRowId : \"\" };\r\n\r\n    if(listData && (!Array.isArray(listData.aRows) || !Array.isArray(listData.aGroupHeaders) || !Array.isArray(listData.aGroups))){\r\n        throw new df.Error(999, \"Invalid data structure for weblist data.\");\r\n    }\r\n        \r\n    this.onBeforeDataUpdate.fire(this);\r\n    \r\n    \r\n    \r\n    if(sType === \"page\"){\r\n        //  Update cache\r\n        this.aData = listData.aRows;\r\n        this.bLast = bLast;\r\n        this.bFirst = bFirst;\r\n        \r\n        //    Refind current row\r\n        this.prepDisplay();\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n        \r\n        //    Always select row if there is a row\r\n        if(this.iCurrentRow < 0 && bLast && bFirst){\r\n            if(this.aData.length > 0){\r\n                this.iCurrentRow = 0;\r\n                this.sCurrentRowId = this.aData[0].sRowId;\r\n            }\r\n        }\r\n        \r\n        oOptions.sType = \"full\";\r\n    }\r\n    \r\n    \r\n    if(sType === \"first\"){\r\n        //  Update cache\r\n        this.aData = listData.aRows;\r\n        this.bLast = bLast;\r\n        this.bFirst = bFirst;\r\n                            \r\n        //    Refind current row\r\n        this.prepDisplay();\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n        \r\n        oOptions.sType = \"full\";\r\n    }\r\n    \r\n    if(sType === \"last\"){\r\n        //  Update cache\r\n        listData.aRows.reverse();\r\n        this.aData = listData.aRows;\r\n        this.bLast = bLast;\r\n        this.bFirst = bFirst;\r\n        \r\n        //  Update display\r\n        this.prepDisplay();\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n        \r\n        oOptions.sType = \"full\";\r\n\r\n    }\r\n    \r\n    if(sType === \"next\"){\r\n        //  Update cache\r\n        this.aData = this.aData.concat(listData.aRows);\r\n        this.bLast = bLast;\r\n        \r\n        oOptions.sType = \"next\";\r\n\r\n        this.prepDisplay();\r\n    }\r\n    \r\n    if(sType === \"prev\"){\r\n        //  Update cache\r\n        listData.aRows.reverse();\r\n        this.aData = listData.aRows.concat(this.aData);\r\n        this.bFirst = bFirst;\r\n        \r\n        oOptions.iOffsetChange = listData.aRows.length;\r\n        oOptions.sType = \"prev\";\r\n        \r\n        this.prepDisplay();\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n    }\r\n    \r\n    this.onDataUpdate.fire(this, oOptions);\r\n}\r\n\r\n/**\r\n * Determines if the passed row is the first row in the set.\r\n * \r\n * @param {Object} tRow \r\n * @returns True if this is the first row.\r\n */\r\n isFirst(tRow){\r\n    return (this.bFirst && this.aData[0] == tRow);\r\n}\r\n\r\n/**\r\n * Determines if the passed row is the last row in the set.\r\n * \r\n * @param {Object} tRow \r\n * @returns True if this is the last row.\r\n */\r\nisLast(tRow){\r\n    return (this.bLast && this.aData[this.aData.length - 1] == tRow);\r\n}\r\n\r\n\r\nupdateSorting(){\r\n    //  With paged lists the sorting is always done on the server\r\n}\r\n\r\n\r\nsortData(){\r\n    //    Sorting data always happens on the server when paging data\r\n}\r\n\r\n}\r\n\r\n","import { WebModalDialog } from './WebModalDialog.js';\r\nimport { WebButton } from './WebButton.js';\r\nimport { WebForm } from './WebForm.js';\r\nimport { WebPanel } from './WebPanel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    WebListController\r\n\r\nThe controller class for the WebList its mini MVC model. Handles actions from the view and the \r\nserver and executes operations like rowchange, refresh and sorting.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListController{\r\n\r\n\r\nconstructor(oList, oModel){\r\n    this.oL = oList;\r\n    this.oM = oModel;\r\n    \r\n    this.iRowChangeCount = 0;\r\n    \r\n    this.onCellClick = new df.events.JSHandler();\r\n    this.onCellDblClick = new df.events.JSHandler();\r\n    this.onAfterCellClick = new df.events.JSHandler();\r\n\r\n    oList._onKeyDown.addListener(this.keyDown, this);\r\n}\r\n\r\n/* \r\nHandles the click on a cell inside the list. Triggers click events on the column object and changes \r\nthe current row.\r\n\r\n@param  oEv             DOM Event object.\r\n@param  sRowId          RowId of the clicked row.\r\n@param  iCol            Column that is clicked.    \r\n@param  bNoRowChange    Whether to not change the row.\r\n*/\r\ncellClick(oEv, sRowId, iCol, bNoRowChange){\r\n    const oL = this.oL, oM = this.oM;\r\n    let iColIndex, sColVal = \"\";\r\n    \r\n    oL._bHasFocus = true;\r\n    const iRow = oM.rowIndexByRowId(sRowId);\r\n            \r\n    if(iRow >= 0){\r\n        \r\n        if(iCol >= 0){\r\n            iColIndex = oL._aColumns[iCol]._iColIndex;\r\n            sColVal = oM.aData[iRow].aCells[iColIndex].sValue;\r\n        }\r\n        \r\n        //  Notify column of (before)click\r\n        if(iCol >= 0){\r\n            if(oL._aColumns[iCol].cellClickBefore(oEv, sRowId, sColVal)){\r\n                return false;\r\n            }\r\n        }\r\n        \r\n        //  Perform the rowchange\r\n        if (!bNoRowChange)\r\n            this.selectRow(\"row\", iRow);\r\n        \r\n        //  Notify column of (after)click\r\n        if(iCol >= 0){\r\n            if(oL._aColumns[iCol].cellClickAfter(oEv, sRowId, sColVal)){\r\n                oL.focus();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        //  Inform other modules of the cell click\r\n        if(this.fireRowClick(sRowId, iCol)){\r\n            return true;\r\n        }\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\nfireRowClick(sRowId, iCol){\r\n   \r\n    //  Inform other modules of the cell click\r\n    this.onCellClick.fire(this, { \r\n        sRowId : sRowId, \r\n        iCol : iCol\r\n    });\r\n\r\n    //  Fire the actual OnRowClick event\r\n    const bHandled = this.oL.fire(\"OnRowClick\", [ sRowId, iCol !== null ? iCol : -1 ], function(oEv){\r\n        //  Inform other modules of the cell click finish\r\n        this.onAfterCellClick.fire(this, { \r\n            sRowId : sRowId, \r\n            iCol : iCol\r\n        });\r\n    }, this);\r\n\r\n    return bHandled;\r\n}\r\n\r\n\r\n/*\r\nHandles the double click on a cell and informs modules of this event.\r\n\r\n@param  oEv     DOM Event object.\r\n@param  sRowId  RowId of the clicked row.\r\n@param  iCol    Column that is clicked.  \r\n*/\r\ncellDblClick(oEv, sRowId, iCol){\r\n    //  Inform other modules of the cell double click\r\n    return !this.onCellDblClick.fire(this, { \r\n        sRowId : sRowId, \r\n        iCol : iCol\r\n    });\r\n}\r\n\r\n\r\n/* \r\nHandles the click on a column header. Triggers the OnHeaderClick event and changes the sorting if \r\nneeded.\r\n\r\n@param  oEv     DOM event object.\r\n@param  iCol    Column index.\r\n*/\r\nheadClick(oEv, iCol){\r\n    const oL = this.oL, oCol = oL._aColumns[iCol];\r\n    let bRes = false;\r\n    \r\n    if(oCol){\r\n        if(oCol.fire(\"OnHeaderClick\")){\r\n            bRes = true;\r\n        }else{\r\n            if(oL.pbColumnSortable){\r\n                if(oCol.pbSortable){\r\n                    //  Update the sortcolumn property\r\n                    if(oL.piSortColumn === iCol){\r\n                        this.changeSorting(iCol, !oL.pbReverseOrdering);\r\n                    }else{\r\n                        this.changeSorting(iCol, false);\r\n                    }\r\n                    bRes = true;\r\n                }\r\n            }\r\n        }    \r\n    }\r\n    \r\n    oL.focus();\r\n    return bRes;\r\n}\r\n\r\n/* \r\nHandles the double click on a column header. Does nothing (augmented by the designer).\r\n\r\n@param  oEv     DOM Event object.\r\n@param  iCol    Column index.\r\n*/\r\nheadDblClick(oEv, iCol){\r\n    return false;\r\n}\r\n\r\n\r\n/*\r\nThis method changes the sorting order to the supplied column and direction. It will update \r\npiSortColumn and pbReverseOrdering properties and send ChangeSorting to the server. The header is \r\nalso updated.\r\n\r\n@param  iCol        Column number to sort on.\r\n@param  bReverse    If true the order will be reversed.\r\n*/\r\nchangeSorting(iCol, bReverse){\r\n    const oL = this.oL, iPrevCol = oL.piSortColumn, bPrevReverse = oL.pbReverseOrdering;\r\n    \r\n    oL.addSync('piSortColumn');\r\n    oL.addSync('pbReverseOrdering');\r\n    \r\n    oL.piSortColumn = iCol;\r\n    oL.pbReverseOrdering = bReverse;\r\n    \r\n    oL._onSettingChange.fire(this, {\r\n        sType : \"sorting\"\r\n    });\r\n    \r\n    //  Notify the server for paged data loading\r\n    if(this.oM.bPaged){\r\n        oL.serverAction(\"ChangeSorting\", [ iCol, bReverse, iPrevCol, bPrevReverse ]);\r\n    }\r\n}\r\n\r\n\r\n/*\r\nHandles the keypress event and will initiate the auto search if needed. The keypress is used because \r\nwe need the character code and are not interested in special keys anyway. \r\n\r\n@param  oEv  The event object.\r\n@private\r\n*/\r\nkeyPress(oEv){\r\n    const oL = this.oL;\r\n    \r\n     //  Check enabled state\r\n    if(!oL.isEnabled()){\r\n        return;\r\n    }\r\n    \r\n    //  Auto search\r\n    if(oL.pbAutoSearch && oL.piSortColumn >= 0 && !this.bNoSearch && oL.hasFocus()){\r\n        const iChar = oEv.getCharCode();\r\n        \r\n        //  Check if we where really typing a character (33 is the first sensible character in the ASCII table that should popup the search)\r\n        if(iChar > 32 && !oEv.isSpecialKey()){ // && (iKey === 0 || (iKey > 48 && iKey < 123)) \r\n\r\n            let sChar = String.fromCharCode(oEv.getCharCode());\r\n            \r\n            //  Filter character based on data type (this is done pretty raw)\r\n            if(oL._aColumns[oL.piSortColumn].peDataType === df.ciTypeBCD){\r\n                if((\"0123456789,.-\").indexOf(sChar) < 0){\r\n                    sChar = \"\";\r\n                }\r\n            }else if(oL._aColumns[oL.piSortColumn].peDataType === df.ciTypeDate){\r\n                if((\"0123456789-\").indexOf(sChar) < 0){\r\n                    sChar = \"\";\r\n                }\r\n            }\r\n            \r\n            //  Display search dialog\r\n            this.showSearch(sChar);\r\n            \r\n            oEv.stop();\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\n/*\r\nThis function performs an incremental search on the column that the list is currently sorted on. In \r\ncase of a static list (pbDataAware is false or peDbGridType is not gtAutomatic) it will perform the \r\nsearch completely on the client and select the row. The search on the client is performed as a \r\nbinary search for optimal performance. If piSortColumn is not set nothing will be done.\r\n\r\n@param sSearch   The search string.\r\n\r\n\r\n@client-action\r\n*/\r\nsearch(sSearch){\r\n    const oM = this.oM, oL = this.oL, aData = oM.aData;\r\n    let fComp, iLow = 0, iHigh = aData.length - 1, iMid, iRes, iRow = null;\r\n    \r\n    const bRev = oL.pbReverseOrdering;\r\n    const iCol = oL._aColumns[oL.piSortColumn]._iColIndex;\r\n    \r\n    if(iCol < 0){\r\n        return;\r\n    }\r\n    \r\n    if(!this.oM.bPaged){\r\n        //  Determine comparison function\r\n        if(oL._aColumns[iCol].peDataType === df.ciTypeText){\r\n            //  For text we do a case insensitive comparison of the first characters\r\n            fComp = function(sVal1, sVal2){\r\n                sVal1 = sVal1.substr(0, sVal2.length).toLowerCase();\r\n               \r\n                return sVal1.localeCompare(sVal2);\r\n            };\r\n            \r\n            sSearch = sSearch.toLowerCase();\r\n        }else{\r\n            fComp = df.sys.data.compareFunction(oL._aColumns[iCol].peDataType);\r\n        }\r\n        \r\n        //  Debugging\r\n        // var fPrevComp = fComp, iCount = 0;\r\n        // fComp = function(sVal1, sVal2){\r\n            // var iRes = fPrevComp(sVal1, sVal2);\r\n            \r\n            // df.debug(\"Comparing: sVal1='\" + sVal1 + \"', sVal2='\" + sVal2 + \"', iRes=\" + iRes + \", iLow=\" + iLow + \", iMid=\" + iMid + \", iHigh=\" + iHigh); \r\n            \r\n            // iCount++;\r\n            \r\n            // return iRes;\r\n        // };\r\n        \r\n        //  Do a binary search\r\n        while(iLow < iHigh){\r\n            iMid = Math.floor((iLow + iHigh) / 2);\r\n            iRes = fComp(aData[iMid].aCells[iCol].sValue, sSearch);\r\n            iRes = (bRev ? -iRes : iRes);\r\n            \r\n            if(iRes < 0){\r\n                iLow = iMid + 1;\r\n            }else if(iRes > 0){\r\n                iHigh = iMid - 1;\r\n            }else{\r\n                iRow = iMid;\r\n                break;\r\n            }\r\n        }\r\n        \r\n        if(iRes === 0){\r\n            //  We want the first full hit\r\n            if(iRow > 0){\r\n                iRes = fComp(aData[iRow - 1].aCells[iCol].sValue, sSearch);\r\n                iRes = (bRev ? -iRes : iRes);\r\n                \r\n                while(iRes === 0 && iRow > 0){\r\n                    iRow--;\r\n                    if(iRow > 0){\r\n                        iRes = fComp(aData[iRow - 1].aCells[iCol].sValue, sSearch);\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            //  If we didn't find a full hit and iMid is outside range we assume that the range is right\r\n            if(iMid < iLow){\r\n                iRow = iLow;\r\n            }else if(iMid > iLow){\r\n                iRow = iHigh;\r\n            }else{\r\n                iRow = iMid;\r\n            }\r\n        }\r\n    \r\n        //  Move to the row\r\n        this.moveToRow(iRow);\r\n    }else{\r\n        //  For automatic data aware grids we send the search action to the server\r\n        oL.serverAction(\"OnSearch\", [ sSearch ]);\r\n    }\r\n}\r\n\r\n/*\r\nThis function displays the search dialog for doing an incremental search on the list. It creates a \r\ndialog that has an input form and data settings are based on the current sort column.\r\n\r\n@param sOptSearch   The search string.\r\n\r\n@client-action\r\n*/\r\nshowSearch(sOptSearch){\r\n    const oL = this.oL, iWindowWidth = df.dom.windowWidth(), iCol = oL.piSortColumn;\r\n    \r\n    if(iCol < 0){\r\n        return;\r\n    }\r\n    \r\n    //  Create dialog with panel\r\n    const oDialog = new WebModalDialog(null, oL);\r\n    oDialog.psCaption = oL.getWebApp().getTrans(\"search\") + \": \" + oL._aColumns[iCol].psCaption;\r\n    oDialog.pbShowClose = true;\r\n    oDialog.pbDDHotKeys = false;\r\n    oDialog.pbResizable = false;\r\n    oDialog.piMinWidth = (iWindowWidth > 390 ? 370 : iWindowWidth - 20);\r\n    oDialog.psCSSClass = \"WebMsgBox\";\r\n    \r\n    //  Create input form\r\n    const oContentPnl = new WebPanel(null, oDialog);\r\n    oContentPnl.peRegion = df.ciRegionCenter;\r\n\r\n    oDialog.addChild(oContentPnl);\r\n\r\n    const oForm = new WebForm(null, oDialog);\r\n    oForm.psLabel = \"\";\r\n    oForm.pbShowLabel = false;\r\n    oForm.psValue     = sOptSearch || \"\";\r\n    oForm.peDataType  = oL._aColumns[iCol].peDataType;\r\n    oForm.psMask      = oL._aColumns[iCol].psMask;\r\n    oForm.piPrecision = oL._aColumns[iCol].piPrecision;\r\n    oForm.piMaxLength = oL._aColumns[iCol].piMaxLength;\r\n    oForm.pbCapslock  = oL._aColumns[iCol].pbCapslock;\r\n    oForm.peAlign     = df.ciAlignLeft;\r\n\r\n    oContentPnl.addChild(oForm);\r\n    \r\n    // Create close button\r\n    const oButtonPnl = new WebPanel(null, oDialog);\r\n    oButtonPnl.peRegion = df.ciRegionBottom;\r\n    oButtonPnl.piColumnCount = 3;\r\n    oButtonPnl.psCSSClass = \"WebMsgBoxOneBtn\";\r\n\r\n    oDialog.addChild(oButtonPnl);\r\n    \r\n    const oOKBtn = new WebButton(null, oDialog);\r\n    oOKBtn.psCaption = oL.getWebApp().getTrans(\"ok\");\r\n    oOKBtn.piColumnIndex = 1;\r\n    oOKBtn.pbShowLabel = false;\r\n    oOKBtn.OnClick.addListener(function(oEv){\r\n        oDialog.fire('OnSubmit');\r\n    }, this);\r\n\r\n    oButtonPnl.addChild(oOKBtn);\r\n    \r\n    const oCancelBtn = new WebButton(null, oDialog);\r\n    oCancelBtn.psCaption = oL.getWebApp().getTrans(\"cancel\");\r\n    oCancelBtn.piColumnIndex = 2;\r\n    oCancelBtn.pbShowLabel = false;\r\n    oCancelBtn.OnClick.addListener(function(oEv){\r\n        oDialog.hide();\r\n    }, this);\r\n\r\n    oButtonPnl.addChild(oCancelBtn);\r\n    \r\n    //  Add submit listener\r\n    oDialog.OnSubmit.addListener(function(oEv){\r\n        const sVal = oForm.get(\"psValue\");\r\n        oDialog.hide();\r\n               \r\n        oL.objFocus();\r\n        \r\n        this.search(sVal);\r\n        \r\n        if(oL._eFocus){\r\n            oL._eFocus.focus();\r\n        }\r\n    }, this);\r\n    \r\n    oDialog.show();\r\n    \r\n    //  For date types we explicitly give the focus and set the form value because else it will complete the date before the field when the focus\r\n    if(oForm.peDataType === df.ciTypeDate || oForm.peDataType === df.ciTypeDateTime || oForm.peDataType === df.ciTypeTime){\r\n        oForm.focus();\r\n        if(sOptSearch){\r\n            oForm.setControlValue(sOptSearch);\r\n        }\r\n    }\r\n    if(!df.sys.isMobile){\r\n        df.dom.setCaretPosition(oForm._eControl, oForm._eControl.value.length);\r\n    }\r\n}\r\n\r\n/*\r\nThis method handles the keypress event and initiates the actions bound to it. The \r\ndf.settings.listKeys define the exact key code's / combinations for the different actions.\r\n\r\n@param  oEv  The event object.\r\n@return False if we did handle the event and performed an action, true if we didn't do anything.\r\n*/\r\nkeyDown(oJSEvent){\r\n    const oL = this.oL, that = this;\r\n    const oEv = oJSEvent.oDOMEvent;\r\n    \r\n    if(!oL._bHasFocus && !oL._eKeyBuddy){\r\n        return;\r\n    }\r\n    \r\n    if(oEv.matchKey(df.settings.listKeys.scrollUp)){ \r\n        this.moveUpRow();\r\n    }else if(oEv.matchKey(df.settings.listKeys.scrollDown)){ \r\n        this.moveDownRow();\r\n    }else if(oEv.matchKey(df.settings.listKeys.scrollPageUp)){ \r\n        this.movePageUp();\r\n    }else if(oEv.matchKey(df.settings.listKeys.scrollPageDown)){ \r\n        this.movePageDown();\r\n    }else if(oEv.matchKey(df.settings.listKeys.scrollTop)){ \r\n        this.moveToFirstRow();\r\n    }else if(oEv.matchKey(df.settings.listKeys.scrollBottom)){ \r\n        this.moveToLastRow();\r\n    }else if(oEv.matchKey(df.settings.listKeys.leftSwipeBtns) && oL._oTouchHandler && oL._oTouchHandler.showSwipeLeft()){\r\n    }else if(oEv.matchKey(df.settings.listKeys.rightSwipeBtns) && oL._oTouchHandler && oL._oTouchHandler.showSwipeRight()){\r\n     \r\n    }else if(oEv.matchKey(df.settings.formKeys.submit)){ \r\n        //  The OnRowClick event is also fired on enter and overrides the OnSubmit if it is handled.\r\n        if(this.oM.sCurrentRowId){\r\n            //  Inform other modules of the cell click\r\n            if(this.fireRowClick(this.oM.sCurrentRowId, null)){\r\n                oEv.stop();\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }else{\r\n        return true;\r\n    }\r\n    \r\n    //  Temporary block search on key press (stopping onKeyDown doesn't cancel onKeyPress in firefox)\r\n    this.bNoSearch = true;\r\n    setTimeout(function(){\r\n        that.bNoSearch = false;\r\n    }, 50);\r\n    \r\n    oEv.stop();\r\n    return false;\r\n}\r\n\r\nhandleData(listData, sType, sStartRowId, bFirst, bLast){\r\n    this.oM.handleData(listData, sType, sStartRowId, bFirst, bLast);\r\n    \r\n    if(!this.pbDataAware){\r\n        this.updateColumnsFromCache(sType === \"page\");\r\n    }\r\n}\r\n\r\nsetCurrentRowId(sRowId){\r\n    this.oM.setCurrentRowId(sRowId);\r\n}\r\n\r\nupdateRow(sRowId, tRow, bMergeRow){\r\n    this.oM.updateRow(sRowId, tRow, bMergeRow);\r\n}\r\n\r\nupdateCell(oCol, sVal){\r\n    this.oM.updateCell(oCol, sVal);\r\n}\r\n\r\nremoveRow(sRowId){\r\n    const oM = this.oM\r\n    let bRowChange = false, iPrevRow;\r\n    \r\n    if(oM.sCurrentRowId === sRowId){\r\n        bRowChange = true;\r\n        iPrevRow = oM.iCurrentRow;\r\n        \r\n        oM.sCurrentRowId = \"\";\r\n        oM.iCurrentRow = -1;\r\n    }\r\n    \r\n    oM.removeRow(sRowId);\r\n    \r\n    if(bRowChange){\r\n        if(iPrevRow < oM.aData.length){\r\n            this.selectRow(\"row\", iPrevRow);\r\n        }else if(iPrevRow > 0){\r\n            this.selectRow(\"row\", iPrevRow - 1);\r\n        }else{\r\n            this.appendNewRow();\r\n        }\r\n    }\r\n}\r\n\r\nappendRow(tRow){\r\n    this.oM.appendRow(tRow);\r\n}\r\n\r\ninsertBefore(sBeforeRowId, tRow){\r\n    this.oM.insertBefore(sBeforeRowId, tRow);\r\n}\r\n\r\ninsertAfter(sAfterRowId, tRow){\r\n    this.oM.insertAfter(sAfterRowId, tRow);\r\n}\r\n\r\n/*\r\n@param  sGotoRow    String describing the row that will be selected (\"new\", \"first\", \"last\", \"row\").\r\n@param  iRow        When sGotoRow indicates \"row\" then this is the cache row number to select.\r\n*/\r\nselectRow(sGotoRow, iRow, fOptHandler, tOptSelectRowData){\r\n    const oL = this.oL, oM = this.oM, sPrevRowId = oM.sCurrentRowId;\r\n    let bContinue = true, sTargetRowId = \"\", tSelectRowData = tOptSelectRowData || null;\r\n    \r\n    \r\n    \r\n    //  Make sure there are no outstanding ChangeCurrentRow calls\r\n    oL.cancelServerAction(\"ChangeCurrentRow\");\r\n    \r\n    //  Determine if row change is needed & translate specific row nr into rowid\r\n    if(sGotoRow === \"row\"){\r\n        sTargetRowId = oM.rowIdByRowIndex(iRow);\r\n        bContinue = (sTargetRowId !== null && sTargetRowId !== sPrevRowId);\r\n        \r\n        //  For non data-aware grids / lists we send a copy of the row we are going to as action data to the server\r\n        if(!oL.pbDataAware){\r\n            tSelectRowData = oM.aData[iRow];\r\n        }\r\n    }\r\n    \r\n    const oOptions = {\r\n        sPrevRowId : oM.sCurrentRowId,\r\n        iPrevRowIndex : oM.iCurrentRow,\r\n        sGotoRow : sTargetRowId,\r\n        iGotoRowIndex : iRow\r\n    };\r\n    \r\n    //  Update counter and remember number in local variable\r\n    this.iRowChangeCount++;\r\n    const iRowChange = this.iRowChangeCount;\r\n    \r\n    function handleRowChange(bResult){\r\n        //  Check if row change is overtaken by another row change\r\n        var bOverridden = (iRowChange !== this.iRowChangeCount);\r\n        \r\n        oOptions.bSuccess = df.toBool(bResult);\r\n        oM.onAfterRowChange.fire(oM, oOptions);\r\n        \r\n        if(oL.pbOfflineEditing || df.toBool(bResult)){\r\n            //  We do this so that handlers that scroll the screen are executed before we add the class\r\n            if(fOptHandler){\r\n                fOptHandler.call(this, true, bOverridden);\r\n            }\r\n        }else{\r\n            fOptHandler.call(this, false, bOverridden);\r\n        }\r\n    }\r\n    \r\n    if(bContinue){\r\n        oM.onBeforeRowChange.fire(oM, oOptions);\r\n        \r\n        if(!oL.pbOfflineEditing){\r\n            //  Set handler function so it can be called as client-action\r\n            this.handleRowChange = handleRowChange;\r\n            oL.serverAction(\"ChangeCurrentRow\", [ sGotoRow, sTargetRowId ], (tSelectRowData && oL.serializeRows([ tSelectRowData ])) || null);\r\n        }else{\r\n            //  When working offline we manually load the row into the columns and set it as current\r\n            if(sGotoRow === \"row\"){\r\n                this.setCurrentRowId(sTargetRowId);\r\n                \r\n                this.updateColumnsFromCache(true);\r\n            }\r\n                        \r\n            handleRowChange.call(this);\r\n        }\r\n    }else{\r\n        if(fOptHandler){\r\n            fOptHandler.call(this, false);\r\n        }\r\n    }\r\n}\r\n\r\n/* \r\nThis function is called from the server after a rowchange initiated by the client. It is replaced at \r\nruntime with a function inside a closure holding the context needed to handle the rowchange.\r\n\r\n@param  bResult     True if the rowchange is succesfull. \r\n*/\r\nhandleRowChange(bResult){\r\n    //  Empty placeholder\r\n}\r\n\r\n/*\r\nThis method updates the column DEO objects with the data in the cache for the current row. It does \r\nnothing if pbNonDataAware is false. It will reset the changed-states if bResetChange is true.\r\n\r\n@param  bResetChange    If true the changed-state is reset.\r\n@private\r\n*/\r\nupdateColumnsFromCache(bResetChange){\r\n    const oL = this.oL, oM = this.oM;\r\n    \r\n    //  Update the column value's\r\n    if(!oL.pbDataAware){\r\n        const iRow = oM.rowIndexByRowId(oM.sCurrentRowId);\r\n        \r\n        if(iRow >= 0){\r\n            for(let iCol = 0; iCol < oL._aColumns.length; iCol++){\r\n                oL._aColumns[iCol].set('psValue', oM.aData[iRow].aCells[oL._aColumns[iCol]._iColIndex].sValue);\r\n                if(bResetChange){\r\n                    oL._aColumns[iCol].set('pbChanged', false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\ntriggerCacheUpdate(iTopRow, iLastRow){\r\n    const oM = this.oM;\r\n    \r\n    if(oM.bPaged){\r\n        if(!oM.bLast){\r\n            if(oM.aData.length - iLastRow < oM.iPrefCacheOffset){\r\n                this.loadCachePage(\"next\");\r\n            }\r\n        }\r\n        if(!oM.bFirst){\r\n            // df.debug(\"iTopRow: \" + iTopRow + \" < oM.iPrefCacheOffset: \" + oM.iPrefCacheOffset);\r\n            if(iTopRow < oM.iPrefCacheOffset ){\r\n                this.loadCachePage(\"prev\");\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nloadCachePage(sType, fOptHandler, oOptEnv){\r\n    const oL = this.oL, oM = this.oM;\r\n    let sStartRowId = \"\";\r\n    \r\n    if(this.bLoading){\r\n        return;\r\n    }\r\n    this.bLoading = true;\r\n    \r\n     // Determine start rowid\r\n    if(sType === \"next\"){\r\n        if(oM.aData.length){\r\n            sStartRowId = oM.aData[oM.aData.length - 1].sRowId;\r\n        }\r\n    }else if(sType === \"prev\"){\r\n        if(oM.aData.length){\r\n            sStartRowId = oM.aData[0].sRowId;\r\n        }\r\n    }else{\r\n        this._bNoRender = true;\r\n    }\r\n    \r\n    // Create action\r\n    oL.serverAction(\"LoadDataPage\", [ sType, sStartRowId ], null, function(oEv){\r\n        this.bLoading = false;\r\n        \r\n        if(!oEv.bError){\r\n            if(fOptHandler){\r\n                fOptHandler.call(oOptEnv || this);\r\n            }\r\n        }\r\n    }, this);\r\n}\r\n\r\n/*\r\n@client-action\r\n*/\r\nprocessDataSet(eOperation){\r\n    const oM = this.oM, oL = this.oL;\r\n\r\n    oL.serverAction(\"HandleProcessDataSet\", [ eOperation, oM.iCurrentRow ], oL.serializeRows(oM.aData));\r\n}\r\n\r\n/*\r\nScrolls to the first record and selects it. It is called by the keyboard handler or from the server. \r\nIn case of a static grid it will directly call the selectRow function to select the first row, for a \r\nnon-static grid (pbDataAware is true or peDbGridType is not gtAutomatic) it will always refresh the \r\ncache by loading the first page of records. Note that when pbOfflineEditing is true we need to load \r\nthe first cache page before changing rows.\r\n\r\n@client-action\r\n*/\r\nmoveToFirstRow(){\r\n    const oM = this.oM, oL = this.oL;\r\n    \r\n    const fSelect = function(){\r\n        if(oM.aData.length > 0){\r\n            this.selectRow(\"row\", 0);\r\n        }else{\r\n            this.appendNewRow();\r\n        }        \r\n    };\r\n    \r\n    if(!oM.bPaged){\r\n        fSelect.call(this);\r\n    }else{\r\n        if(oL.pbOfflineEditing || (oM.iCurrentRow === 0 && oM.sCurrentRowId === \"\")){\r\n            this.loadCachePage(\"first\", function(){\r\n                fSelect.call(this);\r\n            });\r\n        }else{\r\n            this.selectRow(\"first\", -1);\r\n        }\r\n    }\r\n}\r\n\r\n/*\r\nScrolls to the last record and selects it. It is called by the keyboard handler or from the server. \r\nIn case of a static grid it will directly call the selectRow function to select the last row, for a \r\nnon-static grid (pbDataAware is true or peDbGridType is not gtAutomatic) it will always refresh the \r\ncache by loading the last page of records. Note that when pbOfflineEditing is true we need to load \r\nthe last cache page before changing rows.\r\n\r\n@client-action\r\n*/\r\nmoveToLastRow(){\r\n    const oM = this.oM, oL = this.oL;\r\n    \r\n    const fSelect = function(){\r\n        if(oM.aData.length > 0){\r\n            this.selectRow(\"row\", oM.aData.length - 1);\r\n        }else{\r\n            this.appendNewRow();\r\n        }   \r\n    };\r\n    \r\n    if(!oM.bPaged){\r\n        fSelect.call(this);\r\n    }else{\r\n        if(oL.pbOfflineEditing || (oM.iCurrentRow === 0 && oM.sCurrentRowId === \"\")){\r\n            this.loadCachePage(\"last\", function(){\r\n                fSelect.call(this);\r\n            });\r\n        }else{\r\n            this.selectRow(\"last\", -1);\r\n        }\r\n    }\r\n}\r\n\r\n/*\r\nThis method selects the next row available in the cache and returns true if successful. It is called \r\nby the key handler or the server.\r\n\r\n@return True if a next row is available.\r\n@client-action\r\n*/\r\nmoveDownRow(){\r\n    const oM = this.oM;\r\n    \r\n    if(oM.iCurrentRow >= 0 && oM.iCurrentRow < oM.aData.length - 1){\r\n        this.selectRow(\"row\", (oM.iCurrentRow + 1));\r\n        \r\n        return true;\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\n/*\r\nThis method selects the previous row available in the cache and returns true if successful. It is \r\ncalled by the key handler or the server.\r\n\r\n@return True if a previous row is available.\r\n@client-action\r\n*/\r\nmoveUpRow(){\r\n    const oM = this.oM;\r\n\r\n    if(oM.iCurrentRow > 0){\r\n        this.selectRow(\"row\", (oM.iCurrentRow - 1));\r\n    }\r\n}\r\n\r\n/*\r\nThis method performs a page down which means that it select the record one page down in the cache \r\nand scrolls to it. A page in this context means the amount of rows that fit inside the grid view. It \r\nis called by the key handler or the server.\r\n\r\n@client-action\r\n*/\r\nmovePageDown(){\r\n    const oM = this.oM;\r\n    \r\n    let iRow = Math.round(oM.iCurrentRow + this.oL._oBody.getViewSize() - 1);\r\n    if(iRow >= oM.aData.length){\r\n        iRow = oM.aData.length - 1;\r\n    }\r\n    \r\n    this.selectRow(\"row\", iRow);\r\n}\r\n\r\n/*\r\nThis method performs a page up which means that it select the record one page up in the cache and \r\nscrolls to it. A page in this context means the amount of rows that fit inside the grid view. It is \r\ncalled by the key handler or the server.\r\n\r\n@client-action\r\n*/\r\nmovePageUp(){\r\n    const oM = this.oM;\r\n    \r\n    let iRow = Math.round(oM.iCurrentRow - this.oL._oBody.getViewSize() + 1);\r\n    if(iRow < 0){\r\n        iRow = 0;\r\n    }\r\n    \r\n    this.selectRow(\"row\", iRow);\r\n}\r\n\r\n/*\r\nThis method moves to a specific row based on its row index.\r\n\r\n@client-action\r\n*/\r\nmoveToRow(iRowIndex){\r\n    //  Since this method can be called from the server the parameter might still be a string\r\n    iRowIndex = parseInt(iRowIndex, 10);\r\n\r\n    if(iRowIndex >= 0 && iRowIndex < this.oM.aData.length){\r\n        this.selectRow(\"row\", iRowIndex);\r\n    }\r\n}\r\n\r\n/*\r\nThis method moves to a specific row based on its unique row ID.\r\n\r\n@client-action\r\n*/\r\nmoveToRowByID(sRowId){\r\n    const iRowIndex = this.oM.rowIndexByRowId(sRowId);\r\n    \r\n    if(iRowIndex >= 0){\r\n        this.moveToRow(iRowIndex);\r\n    }\r\n}\r\n\r\nappendNewRow(){\r\n    \r\n}\r\n\r\n}","import { WebListPagedModel } from '../WebListPagedModel.js';\r\nimport { WebListGroupSelector } from './WebListGroupSelector.js';\r\n\r\nconst C_LocalStorageName = \"groupConfig\";\r\n\r\n/*\r\nClass: \r\n    WebListGroupController\r\n\r\nControls the grouping logic of the WebList. \r\n\r\nRevision:\r\n    2023/02/23  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListGroupController{\r\n    constructor(oList, oModel, oController){\r\n        this.oL = oList;\r\n        this.oM = oModel;\r\n        this.oC = oController;\r\n\r\n        oList._onKeyDown.addListener(this.onKeyDown, this);\r\n        oList._onSettingChange.addListener(this.onSettingsChange, this);\r\n        this.loadGroupConfig();\r\n    }\r\n\r\n    /**\r\n     * Attaches to a grouping selector control by listening to its onGroupsChanged event.\r\n     * \r\n     * @param {WebListGroupSelector} oSel   Selector object.\r\n     */\r\n    registerMenuGroupingSelector(oSel){\r\n        oSel.onGroupsChanged.on(this.onGroupsChanged, this);\r\n    }\r\n\r\n    /**\r\n     * Configures and enables automatic grouping based on the supplied configuration.\r\n     * \r\n     * @param {Array} aGroups Group configuration.\r\n     */\r\n    applyGrouping(aGroups){\r\n        const oL = this.oL, oM = this.oM;\r\n\r\n        //  Validate settings\r\n        if(oL.peGrouping != df.grpAutomatic){\r\n            throw new df.Error(999, \"Set peGrouping to groupAutomatic to use applyGrouping.\");\r\n        }\r\n        if(oM instanceof WebListPagedModel){\r\n            throw new df.Error(999, \"Automatic grouping not supported with paged data loading. Set peDbGridType to gtAllData or gtManual to allow automatic grouping.\");\r\n        }\r\n\r\n        //  Validate data\r\n        if(!Array.isArray(aGroups)){\r\n            throw new df.Error(999, \"Received invalid grouping data, expected aray.\");\r\n        }\r\n        aGroups.forEach(tGroup =>{ \r\n            if(!oL._aColumns[tGroup.iColumnId]){\r\n                throw new df.Error(999, \"Received invalid grouping data, invalid column id.\");\r\n            }\r\n        });\r\n        \r\n        //  Update data        \r\n        oM.aGroups = aGroups;\r\n        oM.aGroupHeaders = [];\r\n        oM.bIsGrouped = (aGroups.length > 0);\r\n\r\n        //  Notify list of changes\r\n        oL._onSettingChange.fire(this, {\r\n            sType : \"grouping\"\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Applies the supplied groups if we did not load grouping from storage.\r\n     * \r\n     * @param {Boolean} bOverrideDefault \r\n     * @param {Array} aGroups \r\n     */\r\n    applyGroupConfig(bOverrideDefault, aGroups){\r\n        if(bOverrideDefault || !this.oL.pbStoreGroupConfig || localStorage.getItem(this.oL.getStorageName(C_LocalStorageName) == null)){\r\n            this.applyGrouping(aGroups);\r\n            this.storeGroupConfig();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clears and disabled automatic grouping.\r\n     */\r\n    clearGrouping(){\r\n        const oL = this.oL, oM = this.oM;\r\n\r\n        oM.aGroups = [];\r\n        oM.aGroupHeaders = [];\r\n        oM.bIsGrouped = false;\r\n\r\n        //  Notify model of changes\r\n        oL._onSettingChange.fire(this, {\r\n            sType : \"grouping\"\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Writes the current config to the local storage.\r\n     */\r\n    storeGroupConfig(){\r\n        const oL = this.oL;\r\n\r\n        if(oL.pbStoreGroupConfig){\r\n            localStorage.setItem(this.oL.getStorageName(C_LocalStorageName), JSON.stringify(this.oM.aGroups));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loads the group config from local storage (if pbStoreGroupConfig is enabled).\r\n     */\r\n    loadGroupConfig(){\r\n        const oL = this.oL;\r\n\r\n        if(oL.pbStoreGroupConfig){\r\n            const sData = localStorage.getItem(this.oL.getStorageName(C_LocalStorageName));\r\n            if(sData){\r\n                try{\r\n                    const aGroups = JSON.parse(sData);\r\n                    if(Array.isArray(aGroups)){\r\n                        this.applyGrouping(aGroups);\r\n                    }\r\n                }catch(ex){\r\n                    // Ignore\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fires the (server) event notifying of a change in the group config.\r\n     */\r\n    triggerOnGroupsChanged(){\r\n        this.oL.fireEx({\r\n            sEvent : \"OnGroupConfigChanged\",\r\n            tActionData : this.oM.aGroups,\r\n            sAltServerName : \"privateOnGroupConfigChanged\",\r\n        })\r\n    }\r\n\r\n    /**\r\n     * The actual automatic grouping logic. It first sorts the data and then loops over the set to determine the group headers.\r\n     */\r\n    groupData(){\r\n        const oL = this.oL, oM = this.oM, aGroups = oM.aGroups;\r\n        \r\n        if(oL.peGrouping == df.grpAutomatic){\r\n            let aSortCols = [], aCmpFuncs = [];\r\n\r\n            //   Find comparison functions\r\n            aGroups.forEach(tGroup => {\r\n                aSortCols.push(tGroup.iColumnId);\r\n                aCmpFuncs.push(df.sys.data.compareFunction(oL._aColumns[tGroup.iColumnId].peDataType, tGroup.bReverse));\r\n            });\r\n            if(oL.piSortColumn >= 0 && aSortCols.indexOf(oL.piSortColumn) == -1){\r\n                aSortCols.push(oL.piSortColumn);\r\n                aCmpFuncs.push(df.sys.data.compareFunction(oL._aColumns[oL.piSortColumn].peDataType, oL.pbReverseOrdering));\r\n            }\r\n            oL._aColumns.forEach((oCol, iIndex )=> {\r\n                if(aSortCols.indexOf(iIndex) == -1){\r\n                    aSortCols.push(iIndex);\r\n                    aCmpFuncs.push(df.sys.data.compareFunction(oCol.peDataType, oL.pbReverseOrdering))\r\n                }\r\n            });\r\n            \r\n            //  Sort the data\r\n            oM.aGroupHeaders = [];\r\n            oM.customSortData(aSortCols, aCmpFuncs);\r\n            \r\n            //  Loop over data to generate group headers\r\n            let aGrpHeadIndex = [];\r\n            oM.aData.reduce((tPrevRow, tRow, iIndex) => {\r\n                let bSwitch = (tPrevRow == null);\r\n                \r\n                tRow.iGroupHeaderIndex = -1;\r\n                \r\n                for(let iGrp = 0; iGrp < aGroups.length; iGrp++){\r\n                    if(!bSwitch){\r\n                        bSwitch = (aCmpFuncs[iGrp](tRow.aCells[aSortCols[iGrp]].sValue, tPrevRow.aCells[aSortCols[iGrp]].sValue) != 0);\r\n                    }\r\n                    if(bSwitch){\r\n                        aGrpHeadIndex[iGrp] = oM.aGroupHeaders.length;\r\n                        oM.aGroupHeaders.push({\r\n                            iGroupIndex: iGrp,\r\n                            iParentHeaderIndex: tRow.iGroupHeaderIndex,\r\n                            sItem : tRow.aCells[aSortCols[iGrp]].sValue,\r\n                            iItems : 1,\r\n                            sTotal : \"\", \r\n                            bCollapsed : oL.pbGroupsCollapsible && oL.pbGroupsCollapseByDefault,\r\n                            _iLogicalParentGroup : (iGrp > 0 ? aGrpHeadIndex[iGrp - 1] : -1)\r\n                        });\r\n                        tRow.iGroupHeaderIndex = aGrpHeadIndex[iGrp];\r\n                    }else{\r\n                        oM.aGroupHeaders[aGrpHeadIndex[iGrp]].iItems++;\r\n                    }\r\n                }\r\n\r\n                tRow._iLogicalGroup = aGrpHeadIndex[aGroups.length - 1];\r\n\r\n                return tRow;\r\n            }, null);\r\n        }else if(oL.peGrouping == df.grpCustom){\r\n            let aGrpHeadIndex = [];\r\n            \r\n            //  Pass through the data to validat and set logical groups\r\n            oM.aData.forEach((tRow) => {\r\n                let iHeaderIndex = tRow.iGroupHeaderIndex;\r\n\r\n                while(iHeaderIndex >= 0){\r\n                    const tHead = oM.aGroupHeaders[iHeaderIndex];\r\n                    if(!tHead) throw new df.Error(999, `Invalid weblist data, invalid group header reference for row ${tRow.sRowId}`, oL);\r\n                    if(tHead.iParentHeaderIndex == iHeaderIndex) throw new df.Error(999, `Invalid weblist data, recursive group header index ${iHeaderIndex} `, oL);\r\n                    if(!aGroups[tHead.iGroupIndex]) throw new df.Error(999, `Invalid weblist data, group ${tHead.iGroupIndex} referenced by group header ${iHeaderIndex} does not exist.`, oL)\r\n\r\n                    aGrpHeadIndex[tHead.iGroupIndex] = iHeaderIndex;\r\n                    tHead._iLogicalParentGroup = (tHead.iGroupIndex > 0 ? aGrpHeadIndex[tHead.iGroupIndex - 1] : -1);\r\n                    iHeaderIndex = tHead.iParentHeaderIndex;\r\n                }\r\n                \r\n                tRow._iLogicalGroup = aGrpHeadIndex[aGroups.length - 1];\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates the groups based on the config received.\r\n     * \r\n     * @param {df.JSEvent} oEv Event object containing the new group config.\r\n     */\r\n    onGroupsChanged(oEv){\r\n        this.applyGrouping(oEv.aGroups);\r\n        this.storeGroupConfig();\r\n        this.triggerOnGroupsChanged();\r\n    }\r\n\r\n    /**\r\n     * Toggles collapse state of the specified group header. \r\n     * \r\n     * @param {Integer} iHeaderIndex Index of the group header that needs to be collapsed / expanded.\r\n     */\r\n    toggleGroupHeader(iHeaderIndex){\r\n        const oM = this.oM;\r\n        const tHeader = oM.aGroupHeaders[iHeaderIndex];\r\n        if(!tHeader) return;\r\n\r\n        tHeader.bCollapsed = !tHeader.bCollapsed;\r\n        oM.prepDisplay();\r\n\r\n        oM.onDataUpdate.fire(this, {\r\n            sType : \"display\",\r\n        }); \r\n    }\r\n\r\n    /**\r\n     * Collapses all the groups.\r\n     * \r\n     * Triggered by ctrl - -.\r\n     */\r\n    collapseAll(){\r\n        const oM = this.oM;\r\n\r\n        if(oM.bIsGrouped){\r\n            oM.aGroupHeaders.forEach(tHeader => tHeader.bCollapsed = true);\r\n            oM.prepDisplay();\r\n            \r\n            oM.onDataUpdate.fire(this, {\r\n                sType : \"display\",\r\n            });\r\n        }\r\n    } \r\n\r\n    /**\r\n     * Expands all the groups.\r\n     * \r\n     * Triggered by ctrl - +.\r\n     */\r\n    expandAll(){\r\n        const oM = this.oM;\r\n\r\n        if(oM.bIsGrouped){            \r\n            oM.aGroupHeaders.forEach(tHeader => tHeader.bCollapsed = false);\r\n            oM.prepDisplay();\r\n            \r\n            oM.onDataUpdate.fire(this, {\r\n                sType : \"display\",\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Collapses the group that contains the current row. Closes a level higer if the direct parent is already collapsed.\r\n     * \r\n     * Triggered by the - key.\r\n     * \r\n     * @returns True if a group was collapsed.\r\n     */\r\n    collapseCurrent(){\r\n        const oM = this.oM;\r\n\r\n        if(oM.iCurrentRow && oM.aData[oM.iCurrentRow]){\r\n            let iGroupHeaderIndex = oM.aData[oM.iCurrentRow]._iLogicalGroup;\r\n\r\n            while(iGroupHeaderIndex >= 0){\r\n                const tHeader = oM.aGroupHeaders[iGroupHeaderIndex];\r\n                if(!tHeader.bCollapsed){\r\n                    tHeader.bCollapsed = true;\r\n\r\n                    oM.prepDisplay();\r\n\r\n                    oM.onDataUpdate.fire(this, {\r\n                        sType : \"display\",\r\n                        iDisplayItem : tHeader._iItemIndex\r\n                    });\r\n                    return true;\r\n                }\r\n\r\n                iGroupHeaderIndex = tHeader._iLogicalParentGroup;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Expands the group surrounding the currently selected row. It will expand the highest level that is collapsed.\r\n     * \r\n     * Triggered by the + key.\r\n     * \r\n     * @returns True if a group was expanded.\r\n     */\r\n    expandCurrent(){\r\n        const oM = this.oM;\r\n\r\n        if(oM.iCurrentRow && oM.aData[oM.iCurrentRow]){\r\n            let iGroupHeaderIndex = oM.aData[oM.iCurrentRow]._iLogicalGroup;\r\n\r\n            while(iGroupHeaderIndex >= 0){\r\n                const tHeader = oM.aGroupHeaders[iGroupHeaderIndex];\r\n                if(tHeader.bCollapsed && (tHeader._iLogicalParentGroup < 0 || !oM.aGroupHeaders[tHeader._iLogicalParentGroup].bCollapsed)){\r\n                    tHeader.bCollapsed = false;\r\n\r\n                    oM.prepDisplay();\r\n\r\n                    oM.onDataUpdate.fire(this, {\r\n                        sType : \"display\",\r\n                    });\r\n                    return true;\r\n                }\r\n\r\n                iGroupHeaderIndex = tHeader._iLogicalParentGroup;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Makes sure the current row is visible by expanding the groups that contain the current row (all levels).\r\n     * \r\n     * @returns True if a group was expanded (and a redraw has been triggered).\r\n     */\r\n    makeCurrentRowVisible(){\r\n        const oM = this.oM;\r\n        let bChanged = false;\r\n\r\n        if(oM.iCurrentRow >= 0 && oM.aData[oM.iCurrentRow]){\r\n            let iGroupHeaderIndex = oM.aData[oM.iCurrentRow]._iLogicalGroup;\r\n\r\n            while(iGroupHeaderIndex >= 0){\r\n                const tHeader = oM.aGroupHeaders[iGroupHeaderIndex];\r\n                if(tHeader.bCollapsed){\r\n                    tHeader.bCollapsed = false;\r\n                    bChanged = true;\r\n                }\r\n\r\n                iGroupHeaderIndex = tHeader._iLogicalParentGroup;\r\n            }\r\n        }\r\n\r\n        if(bChanged){\r\n            oM.prepDisplay();\r\n\r\n            oM.onDataUpdate.fire(this, {\r\n                sType : \"display\",\r\n            });\r\n        }\r\n        return bChanged;\r\n    }\r\n\r\n    /**\r\n     * Handles the keydown event on the weblist and implements the grouping operations (expand, collapse, expand all, collapse all).\r\n     * \r\n     * @param {df.events.JSEvent} oJSEvent Event object.\r\n     * @returns False if the event is handled.\r\n     */\r\n    onKeyDown(oJSEvent){\r\n        const oEv = oJSEvent.oDOMEvent;\r\n\r\n        if(oEv.matchKey(df.settings.listKeys.collapseAllGrp)){\r\n            this.collapseAll();\r\n            oEv.stop();\r\n            return false;\r\n        }else if(oEv.matchKey(df.settings.listKeys.expandAllGrp)){\r\n            this.expandAll();\r\n            oEv.stop();\r\n            return false;\r\n        }else if(oEv.matchKey(df.settings.listKeys.collapseGrp)){\r\n            this.collapseCurrent();\r\n            oEv.stop();\r\n            return false;\r\n        }else if(oEv.matchKey(df.settings.listKeys.expandGrp)){\r\n            this.expandCurrent();\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when a property changes on the weblist. Makes sure the grouping properties are handled. \r\n     * @param {df.events.JSEvent} oEv   Event object.\r\n     * @returns False if the event is handled.\r\n     */\r\n    onSettingsChange(oEv){\r\n        const oM = this.oM;\r\n\r\n        if(oM.bIsGrouped && (oEv.sProp == \"pbGroupsCollapsible\" || oEv.sProp == \"pbGroupsCollapseByDefault\")){\r\n            this.groupData();\r\n\r\n            oM.prepDisplay();\r\n\r\n            oM.onDataUpdate.fire(this, {\r\n                sType : \"display\",\r\n            });\r\n            return false;\r\n        }\r\n    }\r\n}","/*\r\nClass:\r\n    df.WebListRowModel\r\n\r\nModels the row within the WebList its mini MVC model. It keeps track of the multi line row and \r\ncolumn widths. It contains the code for rendering a single row.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\n/* global df */\r\nexport class WebListRowModel {\r\n    constructor(oList, oModel) {\r\n        this.oL = oList;\r\n        this.oM = oModel;\r\n\r\n        this.iColMin = 20; //    Determines the minimum percentage available\r\n\r\n        this.iRound = (df.sys.isIE && df.sys.iVersion <= 8 ? 1 : 100); //    This determines the decimals used (1 is none, 100 is 2) when rounding column widths (IE8 has issues with decimals on table cells)\r\n\r\n        this.sTableWidth = \"100%\";\r\n\r\n        oList._onSettingChange.on(this.onSettingChange, this);\r\n    }\r\n\r\n    init() {\r\n        this.prepareLayout();\r\n    }\r\n\r\n    onSettingChange(oEv) {\r\n        if (oEv.sType === \"prepare-redraw\") {\r\n            this.prepareLayout();\r\n        }\r\n    }\r\n\r\n    /* \r\n    This function generates the HTML for a single row and appends it to the string builder array that is \r\n    passed.\r\n    \r\n    @param  tRow    Row data.\r\n    @param  aHtml   String builder to which html is appended.\r\n    @param  bZebra  True for an odd row.\r\n    @param  bFirst  True if this is the first list item\r\n    @param  bLast   True if this is the last list item\r\n    @private\r\n    */\r\n    rowHtml(tRow, aHtml, bZebra, iLevel, bFirst, bLast, iItemIndex) {\r\n        const oL = this.oL;\r\n\r\n        //  Assertion\r\n        if (tRow && tRow.aCells.length < (oL._aColumns.length + oL._aSwipeBtns.length)) {\r\n            throw new df.Error(999, \"List data is not containing enough columns ({{0}} / {{1}}).\", oL, [tRow.aCells.length, (oL._aColumns.length + oL._aSwipeBtns.length)]);\r\n        }\r\n\r\n        aHtml.push('<table data-dfisrow=\"true\" data-dfitem=\"', iItemIndex, '\" data-dfrowid=\"', (tRow ? tRow.sRowId : \"empty\"), (this.oL.pbDragDropEnabled && (this.oL.isSupportedDragAction(df.dragActions.WebList.ciDragRow) || this.oL.isSupportedDragAction(df.dragActions.WebMultiSelectList.ciDragRowSelection)) ? '\" draggable=\"true\"' : '\" '), '\" class=\"', this.rowClass(tRow, bZebra, iLevel, bFirst, bLast), '\" style=\"width:', this.sTableWidth, '\">');\r\n\r\n        this.resizeRowHtml(aHtml);\r\n\r\n        //  Loop cells\r\n        for (let i = 0; i < this.oL._aColumnMapper.length; i++) {\r\n            // Safety net for pbRender and pbHidden.\r\n            if (!this.oL._aColumnMapper[i].pbRender || this.oL._aColumnMapper[i].pbHidden) continue;\r\n\r\n            const oCol = this.oL._aColumnMapper[i];\r\n\r\n            if (oCol.pbNewLine) {\r\n                aHtml.push('</tr><tr>');\r\n            }\r\n\r\n            const sTooltip = (tRow && (tRow.aCells[oCol._iColIndex].sTooltip || (oCol.pbValueAsTooltip && oCol.tooltipValue(tRow.aCells[oCol._iColIndex])))) || \"\";\r\n\r\n            let sClassSpecifier = tRow && tRow.fCellClass ?\r\n                tRow.fCellClass(oCol, (tRow && tRow.aCells[oCol._iColIndex]) || null) :\r\n                this.cellClass(oCol, (tRow && tRow.aCells[oCol._iColIndex]) || null);\r\n\r\n            aHtml.push('<td data-dfcol=\"', oCol._iCol, '\" class=\"', sClassSpecifier, '\" title=\"', df.dom.encodeAttr(sTooltip), '\"');\r\n\r\n            if (oCol.piListRowSpan > 1) {\r\n                aHtml.push(' rowspan=\"', oCol.piListRowSpan, '\"');\r\n            }\r\n            if (oCol.piListColSpan > 1) {\r\n                aHtml.push(' colspan=\"', oCol.piListColSpan, '\"');\r\n            }\r\n            if (!oCol.pbVisible) {\r\n                aHtml.push(df.cHideColumnCSS);\r\n            }\r\n\r\n            aHtml.push('>', (tRow ? this.cellHtml(oCol, tRow, tRow.aCells[oCol._iColIndex]) : '&nbsp;'), '</td>');\r\n        }\r\n\r\n        aHtml.push('</tr></table>');\r\n    }\r\n\r\n    /* \r\n    This function determines the CSS classnames applied to a cell within the list. This is done based on \r\n    several column properties including the data type.\r\n    \r\n    @param  oCol    The column object.\r\n    @param  tCell    Row data.\r\n    @private\r\n    */\r\n    cellClass(oCol, tCell) {\r\n        const aClasses = [];\r\n\r\n        aClasses.push(oCol._sCellClass);\r\n\r\n        aClasses.push(oCol.isEnabled() ? df.CssEnabled : df.CssDisabled);\r\n\r\n        if (oCol.pbEditable && this.oL._sControlClass === \"WebGrid\") {\r\n            aClasses.push(\"WebEditable\");\r\n        }\r\n\r\n        aClasses.push(oCol.peAlign === df.ciAlignLeft ? \"WebList_AlignLeft\" : (oCol.peAlign === df.ciAlignCenter ? \"WebList_AlignCenter\" : (oCol.peAlign === df.ciAlignRight ? \"WebList_AlignRight\" : \"\")));\r\n\r\n        if (oCol.peDataType === df.ciTypeBCD) {\r\n            aClasses.push(\"dfData_BCD\");\r\n        } else if (oCol.peDataType === df.ciTypeDate) {\r\n            aClasses.push(\"dfData_Date\");\r\n        } else {\r\n            aClasses.push(\"dfData_Text\");\r\n        }\r\n\r\n        if (oCol.psCSSClass) {\r\n            aClasses.push(oCol.psCSSClass);\r\n        }\r\n\r\n        if (tCell && tCell.sCssClassName) {\r\n            aClasses.push(tCell.sCssClassName);\r\n        }\r\n\r\n        return aClasses.join(\" \");\r\n    }\r\n\r\n    /* \r\n    This function determines the classnames that are set on a list row. If an additional data member is \r\n    available in the row data that is used as CSS classname as well.\r\n    \r\n    @param  tRow    Row data.\r\n    @param  bZebra  True if this is an odd row, false for an even row.\r\n    @private\r\n    */\r\n    rowClass(tRow, bZebra, iLevel, bFirst, bLast) {\r\n        const aClasses = [\"WebList_Row\"];\r\n\r\n        if ((tRow && tRow.sRowId) === this.oM.sCurrentRowId) {\r\n            aClasses.push(\"WebList_Selected\");\r\n        }\r\n\r\n        aClasses.push((bZebra ? ' WebList_RowOdd' : ' WebList_RowEven'));\r\n\r\n        if (!tRow) {\r\n            aClasses.push(\"WebList_RowEmpty\");\r\n        }\r\n\r\n        if (tRow && tRow.sCssClassName) {\r\n            aClasses.push(tRow.sCssClassName);\r\n        }\r\n\r\n        aClasses.push(`Web_Level${iLevel}`);\r\n\r\n        if (bFirst) {\r\n            aClasses.push(\"Web_First\");\r\n        }\r\n        if (bLast) {\r\n            aClasses.push(\"Web_Last\");\r\n        }\r\n\r\n        return aClasses.join(\" \");\r\n    }\r\n\r\n    cellHtml(oCol, tRow, tCell) {\r\n        \r\n        tCell = tCell || { sValue: \"\", sTooltip: \"\", sCssClassName: \"\", aOptions: [] };\r\n\r\n        //  We need to tempolary set the focus to false because we always want the masked value\r\n        const bFocus = oCol._bHasFocus;\r\n        oCol._bHasFocus = false;\r\n\r\n        const sHtml = tRow && tRow.fCellHtml ?\r\n            tRow.fCellHtml.call(oCol, tRow.sRowId, tCell) :\r\n            oCol.cellHtml(tRow.sRowId, tCell);\r\n\r\n        //  Restore the focus\r\n        oCol._bHasFocus = bFocus;\r\n\r\n        return sHtml;\r\n    }\r\n\r\n    resizeRowHtml(aHtml) {\r\n        const aCols = this.aColWidths, bAllFixed = !this.oL.pbAutoColumnSizing;\r\n\r\n        aHtml.push('<colgroup>');\r\n\r\n\r\n        for (let i = 0; i < aCols.length; i++) {\r\n            if (bAllFixed || aCols[i].bFixed) {\r\n                aHtml.push('<col data-dfcol=\"', aCols[i].oCol._iCol, '\" style=\"width: ', aCols[i].iPixels, 'px\"></col>');\r\n            } else {\r\n                aHtml.push('<col data-dfcol=\"', aCols[i].oCol._iCol, '\" style=\"width: ', aCols[i].iPercent, '%\"></col>');\r\n            }\r\n        }\r\n\r\n\r\n        aHtml.push('</colgroup>');\r\n    }\r\n\r\n    /* \r\n    This method prepares the layout before rendering. Its main task is to calculate the column widths \r\n    which can be fairly complicated with the support for multiline rows and fixed widths. It is a three \r\n    step process where first the row layout is calculated in memory and then the column widths are \r\n    determined and they are finally converted into percentages or pixels and stored.\r\n    \r\n    @private\r\n    */\r\n    prepareLayout() {\r\n        let iCols = 0, iRow = 0, iCell = 0, aColWidths = [], iTotalPx = 0, iFixed = 0, iRatio = 0, oCol;\r\n        const aTable = []\r\n\r\n\r\n        //  Determine table layout\r\n        for (let i = 0; i < this.oL._aColumnMapper.length; i++) {\r\n            // Safety net for pbRender and pbHidden.\r\n            if (!this.oL._aColumnMapper[i].pbRender || this.oL._aColumnMapper[i].pbHidden) continue;\r\n\r\n            oCol = this.oL._aColumnMapper[i];\r\n\r\n            //  We do not support a colspan or rowspan of 0 so we correct that first\r\n            oCol.piListColSpan = Math.max(oCol.piListColSpan, 1);\r\n            oCol.piListRowSpan = Math.max(oCol.piListRowSpan, 1);\r\n\r\n            if (oCol.pbNewLine && aTable.length > 0) {\r\n                if (aTable[iRow].length > iCols) {\r\n                    iCols = aTable[iRow].length;\r\n                }\r\n                iRow++;\r\n                iCell = 0;\r\n            }\r\n\r\n            //  Jump over cols already in use\r\n            while (aTable[iRow] && aTable[iRow][iCell]) {\r\n                iCell++;\r\n            }\r\n\r\n            //  Mark cells\r\n            for (let x = 0; x < oCol.piListRowSpan; x++) {\r\n                if (!aTable[iRow + x]) {\r\n                    aTable[iRow + x] = [];\r\n                }\r\n\r\n                // Jump over cells here\r\n                for (let y = 0; y < oCol.piListColSpan; y++) {\r\n                    aTable[iRow + x][iCell + y] = oCol;\r\n                }\r\n            }\r\n\r\n            iCell += oCol.piListColSpan;\r\n\r\n        }\r\n\r\n        //  Check if the last row is the longest\r\n        if (aTable[iRow] && aTable[iRow].length > iCols) {\r\n            iCols = aTable[iRow].length;\r\n        }\r\n\r\n        //  Determine width for each column\r\n        for (let iCol = 0; iCol < iCols; iCol++) {\r\n            aColWidths[iCol] = { bDef: false, bGues: false, bFixed: false, iWidth: 0, oCol: null };\r\n\r\n            for (iRow = 0; iRow < aTable.length; iRow++) {\r\n                oCol = aTable[iRow][iCol];\r\n                if (oCol) {\r\n                    if (oCol.piListColSpan === 1) {\r\n                        aColWidths[iCol].bDef = true;\r\n                        aColWidths[iCol].bFixed = oCol.pbFixedWidth;\r\n                        aColWidths[iCol].iWidth = oCol.piWidth;\r\n                        aColWidths[iCol].oCol = oCol;\r\n\r\n                        break;\r\n                    } else if (!aColWidths[iCol].bGues) {\r\n                        aColWidths[iCol].bGues = true;\r\n                        aColWidths[iCol].bFixed = oCol.pbFixedWidth;\r\n                        aColWidths[iCol].iWidth = oCol.piWidth / oCol.piListColSpan;\r\n                        aColWidths[iCol].oCol = oCol;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (aColWidths[iCol].bFixed) {\r\n                iFixed += aColWidths[iCol].iWidth;\r\n            } else {\r\n                iRatio += aColWidths[iCol].iWidth;\r\n            }\r\n        }\r\n\r\n\r\n        //  Store / convert column widths\r\n        for (let iCol = 0; iCol < aColWidths.length; iCol++) {\r\n            iTotalPx += aColWidths[iCol].iWidth;\r\n            aColWidths[iCol].iPixels = aColWidths[iCol].iWidth;\r\n            if (!aColWidths[iCol].bFixed) {\r\n                // Pixel width or percentage?\r\n                aColWidths[iCol].iPercent = Math.floor((aColWidths[iCol].iWidth * (100 / iRatio)) * this.iRound) / this.iRound;\r\n            }\r\n        }\r\n\r\n        this.aColWidths = aColWidths;\r\n\r\n        if (this.oL.pbAutoColumnSizing) {\r\n            this.sTableWidth = \"100%\";\r\n        } else {\r\n            this.sTableWidth = iTotalPx + \"px\";\r\n        }\r\n\r\n\r\n    }\r\n\r\n    recalcColumnSizes(iVCol, iDiff, bOverrideResizable) {\r\n        let iTotal = 0, iColls = 0, iLast;\r\n\r\n\r\n        if (this.oL.pbAutoColumnSizing) {\r\n            //  Determine percentage to pixel ratio\r\n            const iRatio = this.calcPixelRatio();\r\n\r\n            //  Determine total space behind column\r\n            for (let i = iVCol + 1; i < this.aColWidths.length; i++) {\r\n                if (this.aColWidths[i].bFixed) {\r\n                    iTotal += this.aColWidths[i].iPixels;\r\n                } else {\r\n                    iTotal += (this.aColWidths[i].iPercent * iRatio);\r\n                }\r\n\r\n                if (this.aColWidths[i].oCol.pbResizable || bOverrideResizable) {\r\n                    iColls++;\r\n                }\r\n            }\r\n\r\n            if (this.aColWidths[iVCol].bFixed) {\r\n                this.aColWidths[iVCol].iPixels = this.aColWidths[iVCol].iPixels + iDiff;\r\n            } else {\r\n                this.aColWidths[iVCol].iPercent = ((this.aColWidths[iVCol].iPercent * iRatio) + iDiff) / iRatio;\r\n            }\r\n\r\n\r\n            while (Math.round(iDiff || 0) !== 0 && iDiff !== iLast) {\r\n                const iColDiff = iDiff / iColls;\r\n                iLast = iDiff;\r\n\r\n                for (let i = iVCol + 1; i < this.aColWidths.length; i++) {\r\n                    if (this.aColWidths[i].oCol.pbResizable || bOverrideResizable) {\r\n                        const iPixels = (this.aColWidths[i].bFixed ? this.aColWidths[i].iPixels : this.aColWidths[i].iPercent * iRatio);\r\n                        let iChanged = iPixels - iColDiff;\r\n                        if (iChanged < this.iColMin) {\r\n                            iChanged = this.iColMin;\r\n                        }\r\n\r\n                        if (this.aColWidths[i].bFixed) {\r\n                            this.aColWidths[i].iPixels = iChanged;\r\n                        } else {\r\n                            this.aColWidths[i].iPercent = iChanged / iRatio;\r\n                        }\r\n\r\n                        iDiff -= (iPixels - iChanged);\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < this.aColWidths.length; i++) {\r\n                if (this.aColWidths[i].bFixed) {\r\n                    this.aColWidths[i].oCol.piWidth = this.aColWidths[i].iPixels;\r\n                } else {\r\n                    this.aColWidths[i].oCol.piWidth = this.aColWidths[i].iPercent * 10;\r\n                }\r\n                this.aColWidths[i].oCol.addSync(\"piWidth\");\r\n            }\r\n        } else {\r\n            this.aColWidths[iVCol].oCol.piWidth = this.aColWidths[iVCol].iPixels = (this.aColWidths[iVCol].iPixels + iDiff);\r\n            this.aColWidths[iVCol].oCol.addSync(\"piWidth\");\r\n        }\r\n\r\n\r\n        //this.prepareLayout();\r\n        this.oL.redraw();\r\n    }\r\n\r\n\r\n    calcPixelRatio() {\r\n        let iFullWidth = this.oL._oBody.fullwidth();\r\n\r\n        for (let i = 0; i < this.aColWidths.length; i++) {\r\n            if (this.aColWidths[i].bFixed) {\r\n                iFullWidth -= this.aColWidths[i].iPixels;\r\n            }\r\n        }\r\n\r\n        //  Calculate & return ratio\r\n        return iFullWidth / 100;\r\n    }\r\n\r\n    findVColNr(oCol) {\r\n        const oL = this.oL;\r\n        let iVCol = 0;\r\n\r\n        for (let i = 0; i < oL._aColumnMapper.length; i++) {\r\n            const oCur = oL._aColumnMapper[i];\r\n\r\n            if (oCur.pbRender && !oCur.pbHidden) {\r\n                if (oCur.pbNewLine) {\r\n                    iVCol = 0;\r\n                }\r\n                if (oCur === oCol) {\r\n                    return iVCol;\r\n                }\r\n                iVCol += oCur.piListColSpan;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n}","import { WebBaseMenu } from './WebBaseMenu.js';\r\nimport { WebMenuItemCheckbox } from './WebMenuItemCheckbox.js';\r\nimport { df } from '../df.js';\r\n\r\n/* \r\nClass:\r\n    df.WebMenuList\r\nExtends:\r\n    df.WebBaseMenu\r\n    \r\nThis menu class represents a mobile style menu inspired on IOS style menus. It behaves as a multi \r\nlevel list with submenus sliding in from the right. It can be positioned like a control and is used \r\nby the WebMenuButton class to display its menu. Most menu logic is (being a menu provider / \r\nlistener) is inherited from df.WebBaseMenu.\r\n\r\nRevisions:\r\n    2014/09/05  Initial version (HW, DAW).\r\n    2015/01/19  Refactored into new model with menu providers and listeners. Removed the menu \r\n                crawler and changed base class from WebBaseControl to WebBaseMenu. This makes the \r\n                WebMenuList compatible with the other refactored menu classes allowing menu groups\r\n                to be used. (HW, DAW)\r\n*/\r\nexport class WebMenuList extends WebBaseMenu {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tString, \"psRootCaption\", \"\");\r\n        this.prop(df.tBool, \"pbShowCaption\", true);\r\n        this.prop(df.tBool, \"pbShowBackItem\", true);\r\n        this.prop(df.tBool, \"pbShowIcons\", false);\r\n\r\n        // @privates\r\n        this._sCurrentMenu = \"\";\r\n        this._eCurrentMenu = null;\r\n        this._oMenuBtn = null;\r\n\r\n        //  Configure base classes\r\n        this._bIsMenuListener = true;\r\n\r\n        this.pbShowLabel = false;\r\n        this._bRenderChildren = false;\r\n        this._sControlClass = \"WebMenuList\";\r\n    }\r\n\r\n    /* \r\n    Generates the static wrapping HTML and includes the initial root level menu.\r\n    \r\n    @param  aHtml   Array used as string builder.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebMenuWrp\" tabindex=\"0\">',\r\n            '<div class=\"WebML_Title\"', (this.pbShowCaption ? '' : ' style=\"display: none\"'), '>',\r\n            '<span class=\"WebML_Caption\">', this.psRootCaption, '</span>',\r\n            '</div>',\r\n            '<div class=\"WebML_Panel', (this.pbShowIcons ? ' WebML_ShowIcons' : ''), '\">',\r\n            '<div class=\"WebML_Mnu WebML_Root WebML_Current\" data-dfmenu-path=\"\">');\r\n\r\n        const aMenu = this.getMenu();\r\n\r\n        this.genMenuHtml(aHtml, aMenu, false);\r\n\r\n\r\n        aHtml.push('</div>',\r\n            '</div>');\r\n\r\n    }\r\n\r\n    /* \r\n    Closes the wrapping HTML elements.\r\n    \r\n    @param  aHtml   Array used as string builder.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n\r\n    }\r\n\r\n    /* \r\n    Called after the HTML is inserted into the DOM during the initial render process. We make sure here \r\n    that we get references to the important elements and attach event listeners.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        let ePnl;\r\n\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebMenuWrp\");\r\n        this._eMenuPanel = ePnl = df.dom.query(this._eElem, \"div.WebML_Panel\");\r\n        this._eMenuTitle = df.dom.query(this._eElem, \"div.WebML_Title\");\r\n        this._eMenuCaption = df.dom.query(this._eElem, \"span.WebML_Caption\");\r\n        const eMnu = this._eCurrentMenu = df.dom.query(ePnl, \"div.WebML_Mnu\");\r\n\r\n        //  Forward send\r\n        super.afterRender();\r\n\r\n        //  Add event handlers\r\n        df.dom.on(\"click\", ePnl, this.onMenuClick, this);\r\n\r\n        //  Perform initial sizing if sizing based on its content\r\n        if (this.piHeight <= 0 && !this.pbFillHeight) {\r\n            df.dom.animFrame(function () {\r\n                if (eMnu.firstChild) {\r\n                    ePnl.style.height = this.getMenuHeight(this._eCurrentMenu) + \"px\";\r\n\r\n                    this.sizeChanged();\r\n                }\r\n            }, this);\r\n        }\r\n\r\n        this.notifyMenuRendered(this.getMenu());\r\n    }\r\n\r\n    /* \r\n    Generates the HTML for a single level of the menu.\r\n    \r\n    @param  aHtml   (byref) String builder array.\r\n    @param  aMenu   Array with the menu items.\r\n    @param  bSub    If true a back button will be generated.\r\n    */\r\n    genMenuHtml(aHtml, aMenu, bSub) {\r\n\r\n        aHtml.push('<ul>');\r\n\r\n\r\n        //  Generate back button\r\n        if (bSub && this.pbShowBackItem) {\r\n            aHtml.push('<li class=\"WebML_Item WebML_Back\" data-df-path=\"go-back\"><a href=\"javascript:void(0);\" target=\"_self\">', this.getWebApp().getTrans(\"back\"), '</a></li>');\r\n        }\r\n\r\n        //  Loop over items\r\n        for (let i = 0; i < aMenu.length; i++) {\r\n            const tItem = aMenu[i];\r\n\r\n            //  Determine classnames\r\n            const aClasses = [\"WebML_Item\", tItem.sCSSClass, (tItem.bEnabled ? df.CssEnabled : df.CssDisabled)];\r\n            if (tItem.aChildren.length > 0) {\r\n                aClasses.push(\"WebML_HasSub\");\r\n            }\r\n\r\n            //  Generate group divider\r\n            if (tItem.bBeginGroup) {\r\n                aHtml.push('<li class=\"WebML_Divider\">', (tItem.sGroupCaption || \"\"), '</li>');\r\n            }\r\n\r\n            //  Generate item elements\r\n            this.genItemHtml(aHtml, tItem, false);\r\n            //aHtml.push('<li data-df-path=\"', tItem._sPath, '\" class=\"', aClasses.join(\" \"), '\"><a href=\"#\">', tItem.sCaption , '</a></li>');\r\n        }\r\n\r\n        aHtml.push('</ul>');\r\n    }\r\n\r\n    /* \r\n    Handles click events on the menu. It determines which element is clicked and performs the right \r\n    action (drill-down / go back) and triggers the click action on the item handler.\r\n    \r\n    @param  oEvent  DOM Event (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onMenuClick(oEvent) {\r\n        let tItem, eElem = oEvent.getTarget(), eMnu \r\n        const that = this;\r\n\r\n        //  Determine the clicked element by bubbling up the DOM structure\r\n        while (!tItem && eElem && eElem !== this._eElem) {\r\n            if (eElem.hasAttribute(\"data-df-path\")) {\r\n                const sID = eElem.getAttribute(\"data-df-path\");\r\n\r\n                if (sID === \"go-back\") {\r\n                    //  If go back button is clicked we go one level up\r\n                    this.levelUp();\r\n                    oEvent.stop();\r\n                    return;\r\n                }\r\n                tItem = this.getItemByPath(sID);\r\n            } else {\r\n                eElem = eElem.parentNode;\r\n            }\r\n        }\r\n\r\n        if (tItem) {\r\n            if (tItem.bEnabled) {\r\n                if (tItem.aChildren.length > 0) {\r\n                    //  Perform drilldown\r\n\r\n                    //  Get reference to the menu DOM element\r\n                    eMnu = df.dom.query(this._eMenuPanel, 'div.WebML_Mnu[data-dfmenu-path=\"' + tItem._sPath + '\"]');\r\n                    if (!eMnu) {\r\n                        //  Generate a new menu element if it wasn't created yet\r\n                        const aHtml = [];\r\n                        aHtml.push('<div class=\"WebML_Mnu WebML_HiddenSub\" data-dfmenu-path=\"', tItem._sPath, '\">');\r\n                        this.genMenuHtml(aHtml, tItem.aChildren, true);\r\n                        aHtml.push('</div>');\r\n                        eMnu = df.dom.create(aHtml.join(\"\"));\r\n\r\n                        this._eMenuPanel.appendChild(eMnu);\r\n\r\n                        this.notifyMenuRendered(tItem.aChildren, eMnu);\r\n                    }\r\n\r\n                    const ePrnt = this._eCurrentMenu;\r\n\r\n                    //  Update caption\r\n                    df.dom.setText(this._eMenuCaption, tItem.sCaption);\r\n\r\n                    //  Change CSS classes after a timeout (animation doesn't work properly on newly generated elements)\r\n\r\n                    setTimeout(function fTimeout() {\r\n                        if (ePrnt) {\r\n                            df.dom.addClass(ePrnt, \"WebML_HiddenParent\");\r\n                            df.dom.removeClass(ePrnt, \"WebML_Current\");\r\n                        }\r\n                        df.dom.addClass(eMnu, \"WebML_Current\");\r\n                        df.dom.removeClass(eMnu, \"WebML_HiddenSub\");\r\n\r\n                        that.OnUiUpdate.fire(this, { bUiDriven: true });\r\n                        that.updateMenuSize();\r\n                    }, 20);\r\n\r\n                    //  Update administration\r\n                    this._sCurrentMenu = tItem._sPath;\r\n                    this._eCurrentMenu = eMnu;\r\n\r\n                }\r\n\r\n                //  Trigger click event on the item its handler\r\n                tItem._oHandler.itemClick(tItem, function (bExec) {\r\n                    if (bExec && this._oMenuBtn && !(tItem.hRef instanceof WebMenuItemCheckbox) && !tItem.aChildren.length) {\r\n                        this._oMenuBtn.hideMenu();\r\n                    }\r\n                }, this);\r\n\r\n            }\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Expands a specific item.\r\n    \r\n    @param  tItem   Menun item.       \r\n    */\r\n    expandItem(tItem) {\r\n        if (tItem.aChildren.length > 0) {\r\n            this._sCurrentMenu = tItem._sPath;\r\n        } else {\r\n            this._sCurrentMenu = \"\";\r\n        }\r\n        this.refreshMenu();\r\n\r\n        this.OnUiUpdate.fire(this, { bUiDriven: true });\r\n    }\r\n\r\n    /* \r\n    Makes sure a specific item is visible by expanding its parent or showing the root. This is used by \r\n    the designer.\r\n    \r\n    @param  tItem   Menu item.\r\n    */\r\n    showItem(tItem) {\r\n        const tParent = this.getItemByPath(tItem._sPath.substr(0, tItem._sPath.lastIndexOf(\".\")));\r\n\r\n        if (tParent) {\r\n            this.expandItem(tParent);\r\n        } else {\r\n            this._sCurrentMenu = \"\";\r\n            this.refreshMenu();\r\n        }\r\n    }\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    collapseAll() {\r\n        this._sCurrentMenu = \"\";\r\n        this.refreshMenu();\r\n\r\n        this.OnUiUpdate.fire(this, { bUiDriven: true });\r\n    }\r\n\r\n    /* \r\n    Navigates one level up in the menu structure. It makes sure that the menu slides in from the level.\r\n    \r\n    @client-action\r\n    */\r\n    levelUp() {\r\n        var eMnu, tItem = null, aMenu;\r\n        const that = this;\r\n\r\n        if (this._sCurrentMenu) {\r\n            //  Determine where to go based on the current menu id (if the current menu item is not found we go back to the root)\r\n            if (this._sCurrentMenu.indexOf(\".\") > 0) {\r\n                this._sCurrentMenu = this._sCurrentMenu.substr(0, this._sCurrentMenu.lastIndexOf(\".\"));\r\n                tItem = this.getItemByPath(this._sCurrentMenu);\r\n            }\r\n            if (tItem) {\r\n                aMenu = tItem.aChildren;\r\n            } else {\r\n                this._sCurrentMenu = \"\";\r\n                aMenu = this.getMenu();\r\n            }\r\n\r\n            //  Get reference to the menu its DOM element\r\n            eMnu = df.dom.query(this._eMenuPanel, 'div.WebML_Mnu[data-dfmenu-path=\"' + this._sCurrentMenu + '\"]');\r\n            if (!eMnu) {\r\n                //  Generate menu elements if unavailable\r\n                const aHtml = [];\r\n                aHtml.push('<div class=\"WebML_Mnu WebML_HiddenParent', (aMenu === this.getMenu() ? ' WebML_Root' : ''), '\" data-dfmenu-path=\"', this._sCurrentMenu, '\">');\r\n                this.genMenuHtml(aHtml, aMenu, !!this._sCurrentMenu);\r\n                aHtml.push('</div>');\r\n                eMnu = df.dom.create(aHtml.join(\"\"));\r\n\r\n                this._eMenuPanel.appendChild(eMnu);\r\n\r\n                this.notifyMenuRendered(aMenu, eMnu);\r\n            }\r\n\r\n            const eSub = this._eCurrentMenu;\r\n\r\n            //  Update caption\r\n            if (tItem) {\r\n                df.dom.setText(this._eMenuCaption, tItem.sCaption);\r\n            } else {\r\n                df.dom.setText(this._eMenuCaption, this.psRootCaption);\r\n            }\r\n\r\n            //  Update CSS classes after timeout (timeout is needed for smooth animation)\r\n            setTimeout(function fTimeout() {\r\n                if (eSub) {\r\n                    df.dom.addClass(eSub, \"WebML_HiddenSub\");\r\n                    df.dom.removeClass(eSub, \"WebML_Current\");\r\n                }\r\n                df.dom.addClass(eMnu, \"WebML_Current\");\r\n                df.dom.removeClass(eMnu, \"WebML_HiddenParent\");\r\n                that.OnUiUpdate.fire(this, { bUiDriven: true });\r\n                that.updateMenuSize();\r\n            }, 20);\r\n\r\n            this._eCurrentMenu = eMnu;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    Is called by the WebBaseMenu class when the menu needs to update itself (something changed regarding \r\n    the menu its content).\r\n    */\r\n    refreshMenu() {\r\n        let tItem, aMenu, eMnu;\r\n        const aHtml = [];\r\n\r\n        if (this._eMenuPanel) {\r\n            //  Determine if our current menu still exists (go back to root if not)\r\n            if (this._sCurrentMenu) {\r\n                tItem = this.getItemByPath(this._sCurrentMenu);\r\n            }\r\n\r\n            if (tItem) {\r\n                aMenu = tItem.aChildren;\r\n            } else {\r\n                this._sCurrentMenu = \"\";\r\n                aMenu = this.getMenu();\r\n            }\r\n\r\n            //  Generate menu elements (we throw away all old menu elements by setting innerHTML)\r\n            aHtml.push('<div class=\"WebML_Mnu WebML_Current', (aMenu === this.getMenu() ? ' WebML_Root' : ''), '\" data-dfmenu-path=\"', this._sCurrentMenu, '\">');\r\n            this.genMenuHtml(aHtml, aMenu, !!this._sCurrentMenu);\r\n            aHtml.push('</div>');\r\n            this._eMenuPanel.innerHTML = aHtml.join(\"\");\r\n            eMnu = this._eMenuPanel.firstChild;\r\n\r\n            this.notifyMenuRendered(aMenu, eMnu);\r\n\r\n            //  Update caption\r\n            if (tItem) {\r\n                df.dom.setText(this._eMenuCaption, tItem.sCaption);\r\n            } else {\r\n                df.dom.setText(this._eMenuCaption, this.psRootCaption);\r\n            }\r\n\r\n            this._eCurrentMenu = eMnu;\r\n            this.updateMenuSize();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called when the menu is changing / has changed and updates the size of the control if needed.\r\n    \r\n    @private\r\n    */\r\n    updateMenuSize(bNoSizeChanged) {\r\n\r\n        if (!this.pbFillHeight && this.piHeight <= 0 && this._eCurrentMenu) {\r\n            const iHeight = this.getMenuHeight(this._eCurrentMenu);\r\n\r\n            this._eMenuPanel.style.height = iHeight + \"px\";\r\n            if (!bNoSizeChanged) {\r\n                this.sizeChanged();\r\n            }\r\n\r\n            df.dom.animFrame(function () {\r\n                var iNewHeight;\r\n                if (this._eCurrentMenu) {\r\n                    iNewHeight = this.getMenuHeight(this._eCurrentMenu);\r\n\r\n                    if (iNewHeight !== iHeight) {\r\n                        this._eMenuPanel.style.height = iNewHeight + \"px\";\r\n\r\n                        this.sizeChanged();\r\n                    }\r\n                }\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Implements the setHeight (part of the WebBaseControl API) and updates the height if needed.\r\n    \r\n    @param  iHeight     The height that the outermost div should get.\r\n    @private\r\n    */\r\n    setHeight(iHeight) {\r\n        if (this._eMenuPanel) {\r\n\r\n            df.dom.toggleClass(this._eMenuPanel, \"WebML_NoScollRoot\", (iHeight <= 0));\r\n\r\n            if (iHeight <= 0 && this._eCurrentMenu) {\r\n                this._eMenuPanel.style.height = this.getMenuHeight(this._eCurrentMenu) + \"px\";\r\n            } else {\r\n\r\n                //  The list has a hard-coded minimum of 80px\r\n                if (iHeight <= 80) {\r\n                    iHeight = 80;\r\n                }\r\n\r\n                iHeight -= this.getVertHeightDiff();\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height on the grid body\r\n                this._eMenuPanel.style.height = iHeight + \"px\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    We override this method because the form has an extra wrapper of which the Box Difference needs to \r\n    be taken into account.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n        iResult += this._eMenuTitle?.offsetHeight;\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eMenuPanel);\r\n        return iResult;\r\n    }\r\n\r\n\r\n    /* \r\n    Determines the height of a specific menu element.\r\n    \r\n    @param  eElem   DOM element for a menu.\r\n    */\r\n    getMenuHeight(eElem) {\r\n        let iHeight = eElem.firstChild.offsetHeight;\r\n\r\n        iHeight += df.sys.gui.getVertBoxDiff(eElem);\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /* \r\n    Always update the menu height on resize as it might also mean that we where hidden before.\r\n    */\r\n    resize() {\r\n        this.updateMenuSize(true);\r\n\r\n        super.resize();\r\n    }\r\n\r\n    /* \r\n    Shows / hides the icons by adding / removing the ShowIcons CSS class based on the new value.\r\n    \r\n    @param  bVal    New value.\r\n    @private\r\n    */\r\n    set_pbShowIcons(bVal) {\r\n        if (this._eMenuPanel) {\r\n            df.dom.toggleClass(this._eMenuPanel, \"WebML_ShowIcons\", bVal);\r\n        }\r\n    }\r\n\r\n    set_psRootCaption(sVal) {\r\n        this.psRootCaption = sVal;\r\n        this.refreshMenu();\r\n    }\r\n\r\n    set_pbShowBackItem(bVal) {\r\n        this.pbShowBackItem = bVal;\r\n        this.refreshMenu();\r\n    }\r\n\r\n    set_pbShowCaption(bVal) {\r\n        if (this._eMenuTitle) {\r\n            this._eMenuTitle.style.display = (bVal ? \"\" : \"none\");\r\n        }\r\n    }\r\n}","import { WebFloatingPanel } from './WebFloatingPanel.js';\r\nimport { WebMenuList } from './WebMenuList.js';\r\nimport { WebMenuItem } from './WebMenuItem.js';\r\nimport { WebMenuItemCheckbox } from './WebMenuItemCheckbox.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebContextMenu\r\nExtends:\r\n    df.WebFloatingPanel\r\n\r\nThis class represents a context menu that comes in place of the default context menu.\r\nIt can be filled like any cWebMenuList/CommandBar and uses a floating panel underneath.\r\n    \r\nRevision:\r\n    2021/10/13  (BN, DAW)\r\n        Initial Version.\r\n*/\r\n\r\nexport class WebContextMenu extends WebFloatingPanel {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piMaxHeight\", 500);\r\n\r\n        this.prop(df.tString, \"psControlName\", \"\");\r\n        this.prop(df.tString, \"psContextCSSSelector\", \"\");\r\n\r\n        this.prop(df.tInt, \"peContext\", df.WebUIContext.WebUIContextCustom);\r\n        this.prop(df.tString, \"psContextValue\", \"\");\r\n        this.prop(df.tBool, \"pbChildScopes\", false);\r\n        this.prop(df.tString, \"psContextScopeName\", \"\");\r\n\r\n        // WebBaseMenu_Mixin.\r\n        this.prop(df.tBool, \"pbAllowHtml\");\r\n        this.prop(df.tString, \"psGroupName\");\r\n        this.prop(df.tBool, \"pbShowIcons\", false);\r\n\r\n        this.event(\"OnContextMenuOpen\", df.cCallModeDefault, \"privateOnContextMenuOpen\");\r\n        this.event(\"OnItemClick\");\r\n\r\n        // private FloatingPanel corrections.\r\n        this.pePosition = df.fpFloatFixed;\r\n        this.piWidth = 200;\r\n        this.piHeight = -1;\r\n        this.piColumnCount = 1;\r\n        this.pbHideOnEscape = true;\r\n\r\n        // make sure we are seen as a MenuProvider (though a proxy).\r\n        this._bIsMenuProv = true;\r\n\r\n        this._oRootControl = null; // Reference to the scope we are attached to.\r\n        this._bRendered = false; // A check to see whether we are actually rendered or not.\r\n        this._oMenu = null; // Is the handle to the generated cWebMenuList.\r\n        this._oChildrenCache = []; // Nessesary cache for the proxying of webchildren.\r\n    }\r\n\r\n    set_psControlName(sControlName, bForceInit) {\r\n        if (this.psControlName !== sControlName || bForceInit) {\r\n            this.unbind();\r\n\r\n            this.psControlName = sControlName;\r\n\r\n            if (this.psControlName === \"window\") {\r\n                this._oRootControl = { _eElem: document.documentElement };\r\n            } else if (this.psControlName.length > 0) {\r\n                this._oRootControl = this.getWebApp().findObj(this.psControlName);\r\n            } else {\r\n                this._oRootControl = this.getWebApp();\r\n            }\r\n\r\n            if (!this._oRootControl)\r\n                throw new df.Error(999, \"WebContextMenu could not find the Scope/Control.\");\r\n\r\n            this.bind();\r\n        }\r\n    }\r\n\r\n    set_peContext(eContext) {\r\n        if (this.peContext !== eContext) {\r\n            this.unbind();\r\n\r\n            this.peContext = eContext;\r\n\r\n            this.bind();\r\n        }\r\n    }\r\n\r\n    set_psContextCSSSelector(sContextCSSSelector) {\r\n        // Only update if the peContext is set to custom.\r\n        if (this.psContextCSSSelector !== sContextCSSSelector &&\r\n            this.peContext === df.WebUIContext.WebUIContextCustom) {\r\n            this.unbind();\r\n\r\n            this.psContextCSSSelector = sContextCSSSelector;\r\n\r\n            this.bind();\r\n        }\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////\r\n    // cWebBaseMenu_Mixin Proxies //////////////////////////////////\r\n    ////////////////////////////////////////////////////////////////\r\n\r\n    set_pbShowIcons(bVal) {\r\n        this._oMenu?.set_pbShowIcons(this.pbShowIcons = bVal);\r\n    }\r\n\r\n    set_psGroupName(sVal) {\r\n        this._oMenu?.set_psGroupName(this.psGroupName = sVal);\r\n    }\r\n\r\n    set_pbAllowHtml(bVal) {\r\n        this._oMenu?.set_pbAllowHtml(this.pbAllowHtml = bVal);\r\n    }\r\n\r\n    refresh() {\r\n        if (this._oMenu) {\r\n            this._oMenu._tActionData = this._tActionData;\r\n            this._oMenu.refresh();\r\n            this._oMenu._tActionData = null;\r\n        }\r\n    }\r\n\r\n    updateItem(sId, bOverwriteSubs) {\r\n        if (this._oMenu) {\r\n            this._oMenu._tActionData = this._tActionData;\r\n            this._oMenu.updateItem(sId, bOverwriteSubs);\r\n            this._oMenu._tActionData = null;\r\n        }\r\n    }\r\n\r\n    insertItem(sParentId) {\r\n        if (this._oMenu) {\r\n            this._oMenu._tActionData = this._tActionData;\r\n            this._oMenu.insertItem(sParentId);\r\n            this._oMenu._tActionData = null;\r\n        }\r\n    }\r\n\r\n    removeItem(sId) {\r\n        this._oMenu?.removeItem(sId);\r\n    }\r\n\r\n    notifyChange() {\r\n        this._oMenu?.notifyChange();\r\n    }\r\n\r\n    // Clears the menu cache and rerenders it.\r\n    refreshMenu() {\r\n        if (this._oMenu) {\r\n            this._oMenu._aMenu = null;\r\n            this._oMenu.refreshMenu();\r\n        }\r\n    }\r\n\r\n    collapseAll() {\r\n        this._oMenu?.collapseAll();\r\n    }\r\n\r\n    // Interface by the cWebMenuList that makes the floating panel hide after a click inside.\r\n    hideMenu() {\r\n        df.events.removeDomCaptureListener(\"click\", document, this.onClickGeneral, this);\r\n        df.events.removeDomCaptureListener(\"contextmenu\", document, this.hideMenu, this);\r\n        this.hide();\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////////\r\n\r\n    create() {\r\n        // Set the psControlName to the default value.\r\n        this.set_psControlName(this.psControlName, true);\r\n\r\n        // Let's create our weblist.\r\n        this._oMenu = new WebMenuList(\"MenuList\", this);\r\n        this._oMenu.objFocus = function () { // Please don't touch me!!!\r\n            return;\r\n        };\r\n        this._oMenu._oMenuBtn = this;\r\n        this._oMenu.pbShowCaption = false;\r\n        this._oMenu.pbShowBackItem = true;\r\n        this._oMenu.pbShowIcons = this.pbShowIcons;\r\n\r\n        const that = this;\r\n        this._oMenu.getMenuHeight = function (eElem) {\r\n            let iHeight = eElem.firstChild.offsetHeight;\r\n\r\n            iHeight += df.sys.gui.getVertBoxDiff(eElem);\r\n\r\n            return iHeight <= that.piMaxHeight ? iHeight : that.piMaxHeight;\r\n        };\r\n\r\n        // The behaviour of a menu click should be slightly altered.\r\n        // After a click has been performed we should change the menu again to the root instead of keeping the current sublist.\r\n\r\n        // Cache the original base function.\r\n        this._fMenuBaseClick = this._oMenu.onMenuClick;\r\n        this._oMenu.onMenuClick = function (oEvent) {\r\n            that._fMenuBaseClick.apply(this, arguments);\r\n\r\n            let tItem, eElem = oEvent.getTarget();\r\n\r\n            if (!eElem) return;\r\n\r\n            // Determine the clicked element by bubbling up the DOM structure\r\n            while (!tItem && eElem && eElem !== this._eElem && eElem.hasAttribute) {\r\n                if (eElem.hasAttribute(\"data-df-path\")) {\r\n                    tItem = this.getItemByPath(eElem.getAttribute(\"data-df-path\"));\r\n                    if (tItem && tItem.bEnabled && tItem.aChildren.length === 0) {\r\n                        if (!(tItem.hRef instanceof WebMenuItemCheckbox)) {\r\n                            this._oMenuBtn.hideMenu();\r\n                        }\r\n\r\n                        that.fire(\"OnItemClick\", [tItem.sId, tItem.sCaption]);\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                eElem = eElem.parentNode;\r\n            }\r\n        };\r\n\r\n        this._oMenu._hContextMenu = this;\r\n\r\n        this._oMenu.create();\r\n\r\n        // Unload cache.\r\n        while (this._oChildrenCache.length) {\r\n            this._oMenu.addChild(this._oChildrenCache[0]);\r\n            this._oChildrenCache.splice(0, 1);\r\n        }\r\n\r\n        super.addChild(this._oMenu);\r\n        super.create();\r\n    }\r\n\r\n    privateStopEvent(oEv) {\r\n        oEv.stop();\r\n    }\r\n\r\n    destroy() {\r\n        if (this._bRendered) {\r\n            df.dom.off(\"contextmenu\", this._eElem, this.privateStopEvent, this);\r\n        }\r\n        this.unbind();\r\n        super.destroy();\r\n    }\r\n\r\n    // Let's add the context menu class.\r\n    genClass() {\r\n        const aClasses = [\"WebContextMenu\", super.genClass()];\r\n        return aClasses.join(\" \");\r\n    }\r\n\r\n    afterRender() {\r\n        this._bRendered = true;\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"contextmenu\", this._eElem, this.privateStopEvent, this);\r\n\r\n        // Create a context menu for the desired object and create a null-handler for a right click on self.\r\n        this.bind();\r\n    }\r\n\r\n    afterRenderChildren() {\r\n        // Normally a child does not get an afterRender in a MenuList.\r\n        // Some MenuItems like the WebMenuColumn* do need a ping on whether they might something.\r\n        // We check a _bProviderRequestAfterRender to send an afterRender.\r\n        super.afterRenderChildren();\r\n\r\n        if (this._oMenu && this._oMenu._aChildren) {\r\n            for (let i = 0; i < this._oMenu._aChildren.length; i++) {\r\n                const oChild = this._oMenu._aChildren[i];\r\n\r\n                //  Check if we can actually render the object\r\n                if (oChild._bProviderRequestAfterRender) {\r\n                    oChild.afterRender();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Checks whether the Scope is accessable on the DOM.\r\n    isRootControlReady() {\r\n        return this._oRootControl && this._oRootControl._eElem;\r\n    }\r\n\r\n    // Fires after the scope has been rendered.\r\n    afterRenderRootControl() {\r\n        this.rebind();\r\n    }\r\n\r\n    bind() {\r\n        // We won't bind if the scope element is not available yet.\r\n        if (!this.isRootControlReady()) {\r\n            this._hRootControlAfterRender = this._oRootControl?.OnAfterRender;\r\n            this._hRootControlAfterRender?.on(this.afterRenderRootControl, this);\r\n            return;\r\n        }\r\n\r\n        // Safety net for the root element and whether it is rendered.\r\n        // We need to do this since a set on the context properties causes a rebind(). This might happen before render.\r\n        if (!this._oRootControl || !this._oRootControl._eElem) {\r\n            if (!this._hRootControlAfterRender)\r\n                throw new df.Error(999, \"WebContextMenu could not find an element for the RootControl.\");\r\n            return;\r\n        }\r\n\r\n        // The weblist modifies for example the contents of the menu.\r\n        // As such we cannot allow childScopes.\r\n        if (this.pbChildScopes && !df.WebUIContext.isChildScopeCompatible(this.peContext)) {\r\n            throw new df.Error(999, \"WebContextMenu cannot use pbChildScopes with this peContext.\");\r\n        }\r\n\r\n        // If the peContext is not custom we try to determine the css selector.\r\n        this.useCSSSelectorOfObject(this._oRootControl, this.pbChildScopes);\r\n\r\n        if (this._oRootControl.bindHandlerForWebUIContext && this.pbChildScopes) {\r\n            if (!this._oRootControl.bindHandlerForWebUIContext(this, this.peContext)) {\r\n                throw new df.Error(999, \"WebContextMenu's assinged control does not allow binding with the current peContext.\");\r\n            }\r\n        }\r\n\r\n        // Attach\r\n        df.dom.on(\"contextmenu\", this._oRootControl._eElem, this.onContextMenuOpen, this);\r\n    }\r\n\r\n    useCSSSelectorOfObject(oObj, noError) {\r\n        // Skip if custom.\r\n        if (this.peContext === df.WebUIContext.WebUIContextCustom) {\r\n            return true;\r\n        }\r\n\r\n        if (!oObj.determineSelectorForWebUIContext) {\r\n            if (noError) return false;\r\n            throw new df.Error(999, \"WebContextMenu could not contact the assigned control since it does not support the required interface.\");\r\n        }\r\n\r\n        let sCSSSelector = oObj.determineSelectorForWebUIContext(this.peContext);\r\n        if (sCSSSelector === null || sCSSSelector === undefined) {\r\n            if (noError) return false;\r\n            throw new df.Error(999, \"WebContextMenu's assinged control does not support the desired peContext.\");\r\n        }\r\n\r\n        this.psContextCSSSelector = sCSSSelector;\r\n        this.addSync(\"psContextCSSSelector\");\r\n        return true;\r\n    }\r\n\r\n    unbind() {\r\n        // If we are still looking for an afterRender on the scope, we have not attached yet.\r\n        if (this._hRootControlAfterRender) {\r\n            this._hRootControlAfterRender.off(this.afterRenderRootControl, this);\r\n            this._hRootControlAfterRender = null;\r\n        }\r\n\r\n        // Safety net for the root element and whether it is rendered.\r\n        // We need to do this since a set on the context properties causes a rebind(). This might happen before render.\r\n        if (!this._oRootControl || !this._oRootControl._eElem) {\r\n            if (this._bRendered)\r\n                throw new df.Error(999, \"WebContextMenu could not find a element for the RootControl.\");\r\n            return;\r\n        }\r\n\r\n        if (this._oRootControl.unbindHandlerForWebUIContext && this.pbChildScopes) {\r\n            if (!this._oRootControl.unbindHandlerForWebUIContext(this, this.peContext)) {\r\n                console.warn(\"WebContextMenu's assinged control does not allow unbinding with the current peContext.\");\r\n            }\r\n        }\r\n\r\n        // Detach if they have a event handler.\r\n        df.dom.off(\"contextmenu\", this._oRootControl._eElem, this.onContextMenuOpen, this);\r\n        df.events.removeDomCaptureListener(\"click\", document, this.onClickGeneral, this);\r\n        df.events.removeDomCaptureListener(\"contextmenu\", document, this.hideMenu, this);\r\n\r\n        this.hideMenu();\r\n    }\r\n\r\n    rebind() {\r\n        this.unbind();\r\n        this.bind();\r\n    }\r\n\r\n    // Proxy the addChild (cWebObject) to a new list. These are later added to the generated cWebMenuList.\r\n    addChild(oChild) {\r\n        if (!(oChild instanceof WebMenuItem)) throw new df.Error(999, \"WebMenuContext only supports menu items/checkboxes (\" + oChild.getLongName() + \").\");\r\n\r\n        if (this._oMenu) {\r\n            this._oMenu.addChild(oChild);\r\n        } else {\r\n            this._oChildrenCache.push(oChild);\r\n        }\r\n    }\r\n\r\n    getVisibleChildCount() {\r\n        let iCount = 0;\r\n        if (this._oMenu && this._oMenu._aChildren) {\r\n            for (let i = 0; i < this._oMenu._aChildren.length; i++) {\r\n                if (this._oMenu._aChildren[i].pbRender && this._oMenu._aChildren[i].pbVisible) {\r\n                    iCount++;\r\n                }\r\n            }\r\n        }\r\n        for (let i = 0; i < this._oChildrenCache.length; i++) {\r\n            if (this._oMenu._aChildren[i].pbRender && this._oMenu._aChildren[i].pbVisible) {\r\n                iCount++;\r\n            }\r\n        }\r\n        if (this._oMenu?._aDynamicMenu) {\r\n            iCount += this._oMenu._aDynamicMenu.length;\r\n        }\r\n        return iCount;\r\n    }\r\n\r\n    /* \r\n    Handles the OnShow event of the view and makes sure the floating panel is displayed if it should.\r\n    If we are not yet rendered it means we are attached to a control that is not a base of the WebContainer_mixin.\r\n    Thus we render ourselves.\r\n\r\n    We also rebind since views are cached and we are unbound in the OnHide.\r\n\r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    showView(oEvent) {\r\n        super.showView(oEvent);\r\n\r\n        this.rebind();\r\n    }\r\n\r\n    /* \r\n    Handles the OnHide event of the view and makes sure the panel is hidden.\r\n    If we hide our view we need to unbind since we have lost focus and don't want to trigger anything elsewhere.\r\n\r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    hideView(oEvent) {\r\n        super.hideView(oEvent);\r\n\r\n        this.unbind();\r\n    }\r\n\r\n    show() {\r\n        if (this.isEnabled()) {\r\n            this.pbVisible = true;\r\n\r\n            if (this._bViewVisible) {\r\n                this.doShow();\r\n            }\r\n        }\r\n    }\r\n\r\n    isVisible() {\r\n        return this.pbVisible === true;\r\n    }\r\n\r\n    // When the menu is opened a click in general should make the menu hide.\r\n    // Whether it is a button or something else entirely.\r\n    onClickGeneral(oEv) {\r\n        if (this._eElem.contains(oEv.getTarget())) {\r\n            return;\r\n        }\r\n        df.events.removeDomCaptureListener(\"click\", document, this.onClickGeneral, this);\r\n        df.events.removeDomCaptureListener(\"contextmenu\", document, this.hideMenu, this);\r\n        this.hideMenu();\r\n    }\r\n\r\n    // If the menu is enabled we open.\r\n    // We attach a general click event and open at the clicked location.\r\n    onContextMenuOpen(oEvent) {\r\n        if (!this._bRendered) {\r\n            this.render();\r\n            this.afterRender();\r\n        }\r\n\r\n        // Grab the element from the click.\r\n        let eElem = document.elementFromPoint(oEvent.e.clientX, oEvent.e.clientY);\r\n\r\n        let oTargetContext = this._oRootControl;\r\n\r\n        // We first find the forwarded scope if available.\r\n        if (this.pbChildScopes) {\r\n            let eTargetControl = eElem;\r\n\r\n            // From there go up to find the first control (in which case it came from that control).\r\n            while (!eTargetControl.hasAttribute(\"data-dfobj\") && eTargetControl != this._oRootControl._eElem) {\r\n                if (!eTargetControl.parentNode || !eTargetControl.parentNode.hasAttribute) {\r\n                    throw new df.Error(999, \"WebContextMenu could not find a TargetScope control element.\");\r\n                }\r\n                eTargetControl = eTargetControl.parentNode;\r\n            }\r\n\r\n            oTargetContext = this.getWebApp()?.findObj(eTargetControl.getAttribute(\"data-dfobj\"));\r\n            if (!oTargetContext) {\r\n                throw new df.Error(999, \"WebContextMenu could not find a TargetScope control.\");\r\n            }\r\n\r\n            // Check whether we have an aware control.\r\n            // If not we bail.\r\n            if (!this.useCSSSelectorOfObject(oTargetContext, true)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If we trigger for all elements then that's fine too.\r\n        let bFound = this.psContextCSSSelector.length === 0;\r\n\r\n        // As long as we are in the root context and the object is not found we keep looking for the \r\n        // Context Query.\r\n        while (eElem && eElem.matches &&\r\n            eElem !== this._oRootControl._eElem &&\r\n            !bFound) {\r\n\r\n            bFound = eElem.matches(this.psContextCSSSelector);\r\n\r\n            if (bFound) break;\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        this.psContextScopeName = oTargetContext.getLongName();\r\n        this.addSync(\"psContextScopeName\");\r\n\r\n        let bValid = oTargetContext.verifyElementForWebUIContext ?\r\n            oTargetContext.verifyElementForWebUIContext(eElem, this.peContext) :\r\n            true;\r\n\r\n        if (this.isEnabled() && bFound && bValid && this.getVisibleChildCount()) {\r\n            oEvent.stop();\r\n\r\n            this.psContextValue = \"\";\r\n\r\n            // First we get the desired data; since it might change with layoutChanges.\r\n            if (oTargetContext.retrieveValueFromWebUIContext && this.peContext > df.WebUIContext.WebUIContextCustom) {\r\n                let vValue = oTargetContext.retrieveValueFromWebUIContext(eElem, this.peContext);\r\n\r\n                // Something is corrupted if the value is null or undefined.\r\n                // Might be cause of DOM corruption or someone with a custom control.\r\n                if (vValue === null || vValue === undefined)\r\n                    throw new df.Error(999, \"WebContextMenu's assinged control does not support the desired peContext or we passed the wrong element.\");\r\n\r\n                // If the returned value is an object with strinify it to json.\r\n                // Otherwise call the toString\r\n                if (vValue.toString) {\r\n                    this.psContextValue = vValue.toString();\r\n                } else if (vValue instanceof Object) {\r\n                    this.psContextValue = JSON.stringify(vValue);\r\n                } else {\r\n                    throw new df.Error(999, \"WebContextMenu could not convert the determined Value returned by the assigned control.\");\r\n                }\r\n            }\r\n            this.addSync(\"psContextValue\");\r\n\r\n            df.events.addDomCaptureListener(\"click\", document, this.onClickGeneral, this);\r\n            df.events.addDomCaptureListener(\"contextmenu\", document, this.hideMenu, this);\r\n\r\n            this.fire(\"OnContextMenuOpen\", [], function (oServerEvent) {\r\n                if (oServerEvent.sReturnValue === \"1\") return;\r\n\r\n                // Reset the menu path and regenerate it.\r\n                this._oMenu._sCurrentMenu = \"\";\r\n                this.refreshMenu();\r\n\r\n                // Set intial X & Y\r\n                this.piLeft = oEvent.e.clientX;\r\n                this.piTop = oEvent.e.clientY;\r\n                this.show(); // Show it before we can calculate the height.\r\n\r\n                // Get the rectangle\r\n                const oRect = df.sys.gui.getBoundRect(this._oMenu._eCurrentMenu);\r\n\r\n                if (oRect.right > window.innerWidth && // Check whether it fits on the left side of the cursor as to mimic windows.\r\n                    window.innerWidth - oRect.left <= oRect.width) {\r\n                    this.piLeft = oRect.left - oRect.width;\r\n                } else if (oRect.right > window.innerWidth) { // Just put it were it should be available.\r\n                    this.piLeft = window.innerWidth - oRect.width;\r\n                }\r\n\r\n                if (oRect.bottom > window.innerHeight && // Check whether it fits on top of the cursor as to mimic windows.\r\n                    window.innerHeight - oRect.top >= oRect.height) {\r\n                    this.piTop = oRect.top - oRect.height;\r\n                } else if (oRect.bottom > window.innerHeight) { // Just put it were it should be available.\r\n                    this.piTop = window.innerHeight - oRect.height;\r\n                }\r\n\r\n                this.positionPnl();\r\n            });\r\n        }\r\n    }\r\n\r\n    doHide(bNoPos, sReason) {\r\n        const oWebApp = this.getWebApp();\r\n\r\n        if (this._tPositionInterval) {\r\n            clearInterval(this._tPositionInterval);\r\n            this._tPositionInterval = null;\r\n        }\r\n\r\n\r\n        df.dom.addClass(this._eElem, \"WebFP_Hidden\");\r\n        df.dom.removeClass(this._eElem, \"WebFP_Visible\");\r\n\r\n        if (!bNoPos) {\r\n            this.positionPnl();\r\n        }\r\n\r\n        this.afterHide();\r\n\r\n        //  Remove mobile mask that might have been created\r\n        if (this._eMask) {\r\n            df.dom.off(\"click\", this._eMask, this.onMaskTouch, this);\r\n            this._eMask.parentNode.removeChild(this._eMask);\r\n            this._eMask = null;\r\n        }\r\n\r\n        //  Detach blur listener from floatby control\r\n        if (this._eBlurBuddy) {\r\n            df.events.removeDomCaptureListener(\"blur\", this._eBlurBuddy, this.onCaptureBlur, this);\r\n        }\r\n\r\n        if (this.pePosition === df.fpFloatLeftSqueezeWebApp) {\r\n            if (oWebApp && oWebApp._eElem) {\r\n                oWebApp._eElem.style.marginLeft = \"0px\";\r\n            }\r\n        }\r\n\r\n        this.fire(\"OnHide\", [sReason]);\r\n\r\n        if (!this.pbVisible && this._eElem) {\r\n            this._eElem.style.display = \"none\";\r\n            this._bVisible = false;\r\n        }\r\n    }\r\n\r\n    enable(bOptState) {\r\n        this.pbEnabled = bOptState !== null ? bOptState : true;\r\n    }\r\n\r\n    disable() {\r\n        this.pbEnabled = false;\r\n    }\r\n\r\n    // Creates a new WebMenuItem with the provided caption and adds it to the menu.\r\n    createMenuItem(sCaption) {\r\n        const oItem = new WebMenuItem(null, this);\r\n        oItem.psCaption = sCaption;\r\n        oItem.create();\r\n        return oItem;\r\n    }\r\n\r\n    // Creates a new WebMenuItem with Checkbox and the provided caption and adds it to the menu.\r\n    createCheckedMenuItem(sCaption, bChecked, bOptEnabled) {\r\n        const oItem = new WebMenuItemCheckbox(null, this);\r\n        oItem.psCaption = sCaption;\r\n        oItem.pbChecked = bChecked;\r\n        if (arguments.length > 2) {\r\n            oItem.pbEnabled = bOptEnabled;\r\n        }\r\n        oItem.create();\r\n        return oItem;\r\n    }\r\n}","import { WebMenuItem } from './WebMenuItem.js';\r\nimport { WebContextMenu } from './WebContextMenu.js';\r\nimport { WebList } from './WebList.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuColumnBase\r\nExtends:\r\n    df.WebMenuItem\r\n\r\nThis class represents a base for menuitems to do with the weblist header contextmenu.\r\nIt provides interfaces for retrieving the cWebList Object etc.\r\n\r\nRevision:\r\n    2023/01/31  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMenuColumnBase extends WebMenuItem {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        // This is needed so that the WebContextMenu will send us an afterRender event.\r\n        this._bProviderRequestAfterRender = true;\r\n    }\r\n\r\n    getList() {\r\n        if (this._oList) {\r\n            return this._oList;\r\n        }\r\n\r\n        if (!this.getProv()) {\r\n            throw new df.Error(999, \"cWebMenuColumnBase could not find it's parent WebContextMenu.\", this);\r\n        }\r\n        if (!(this._oProv instanceof WebContextMenu)) {\r\n            throw new df.Error(999, \"cWebMenuColumnBase's provider should be a WebContextMenu.\", this);\r\n        }\r\n        let oList = this._oProv._oRootControl;\r\n        if (!(oList instanceof WebList)) {\r\n            throw new df.Error(999, \"Control-Referece/Parent of cWebMenuColumnBase should be a WebList/WebGrid.\", this);\r\n        }\r\n        return this._oList = oList;\r\n    }\r\n};","import { WebMenuColumnBase } from './WebMenuColumnBase.js';\r\nimport { WebMenuItemCheckbox } from './WebMenuItemCheckbox.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuColumnList\r\nExtends:\r\n    df.WebMenuColumnBase\r\n\r\nThis menu item can only be used when in a Context menu and attached to a cWebList.\r\nIt retrieves the columns and renders them to be hidden and/or shown.\r\n    \r\nRevision:\r\n    2023/01/31  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMenuColumnList extends WebMenuColumnBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this._iAddedColums = 0;\r\n    }\r\n\r\n    /* \r\n    Initializes the modules that make the WebList component.\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        let oL = this.getList();\r\n        if (!oL) {\r\n            throw new df.Error(999, \"WebMenuColumnList could not find it's WebList.\", this);\r\n        }\r\n\r\n        this.refreshColumnList();\r\n        oL._oHeader?.registerMenuColumnList(this);\r\n    }\r\n\r\n    refreshColumnList() {\r\n        if (this._iAddedColums) {\r\n            while (this._iAddedColums) {\r\n                this._aChildren[0].destroy();\r\n                this._aChildren.splice(0, 1);\r\n                this._iAddedColums--;\r\n            }\r\n        }\r\n\r\n        const oL = this.getList();\r\n        if (!oL) {\r\n            throw new df.Error(999, \"WebMenuColumnList could not find it's WebList.\", this);\r\n        }\r\n        let iColumnCount = oL._aColumns.length;\r\n        for (let i = 0; i < iColumnCount; i++) {\r\n            if (!oL._aColumns[i].pbRender || oL._aColumns[i].psCaption.length === 0) continue;\r\n\r\n            let oItem = new WebMenuItemCheckbox(null, this);\r\n            oItem.psCaption = oL._aColumns[i].psCaption;\r\n            oItem.pbChecked = oL._aColumns[i].pbHidden == false;\r\n            oItem.pbEnabled = oL._aColumns[i].pbHideable;\r\n            oItem._oColumnRef = oL._aColumns[i];\r\n            oItem.create();\r\n\r\n            oItem.OnClick.on(function (oEv) {\r\n                if (!this._oColumnRef.pbHideable) {\r\n                    oEv.stop();\r\n                    return;\r\n                }\r\n\r\n                let aFilteredVisible = oL._aColumns.filter(function (oCol) {\r\n                    return oCol.pbRender && !oCol.pbHidden && oCol.psCaption.length !== 0;\r\n                });\r\n\r\n                if (aFilteredVisible.length <= 1) {\r\n                    // We want atleast one visible column. Undo hide.\r\n                    this.set_pbChecked(true);\r\n                    this._oColumnRef.set_pbHidden(false);\r\n                } else {\r\n                    // Set the checked state and hidden state tot the opposite.\r\n                    this.set_pbChecked(!this._oColumnRef.pbHidden);\r\n                    this._oColumnRef.set_pbHidden(!this._oColumnRef.pbHidden);\r\n                }\r\n\r\n                oL.triggerLayoutChange(this._oColumnRef);\r\n\r\n                oEv.stop();\r\n            }, oItem);\r\n\r\n            // Add it to the WebObjects\r\n            this._aChildren.splice(this._iAddedColums++, 0, oItem);\r\n        }\r\n\r\n        this.getProv().refreshMenu();\r\n    }\r\n\r\n    addChild(oChild) {\r\n        super.addChild(oChild);\r\n        this.getProv().refreshMenu();\r\n    }\r\n}\r\ndf.WebMenuColumnList = WebMenuColumnList;","import { WebMenuColumnBase  } from './WebMenuColumnBase.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuColumnRestorer\r\nExtends:\r\n    df.WebMenuColumnBase\r\n\r\nThis class provides basic behaviour for restoring a columnlayout on click.\r\nIt is only supposed to be used in context with a cWeblist.\r\n    \r\nRevision:\r\n    2023/01/31  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMenuColumnRestorer extends WebMenuColumnBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n    }\r\n\r\n    /* \r\n    Initializes the modules that make the WebList component.\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        let oL = this.getList();\r\n        if (!oL) {\r\n            throw new df.Error(999, \"WebMenuColumnRestorer could not find it's WebList.\", this);\r\n        }\r\n        oL._oHeader?.registerMenuColumnRestorer(this);\r\n    }\r\n\r\n    itemClick(tItem, fReturn, oEnv) {\r\n        let oL = this.getList();\r\n        if (!oL) {\r\n            throw new df.Error(999, \"WebMenuColumnList could not find it's WebList.\", this);\r\n        }\r\n        oL.triggerRestoreColumnLayout(this);\r\n        return super.itemClick(tItem, fReturn, oEnv);\r\n    }\r\n\r\n    addChild() {\r\n        throw new df.Error(999, \"a cWebMenuColumnRestorer is not supposed to have children.\", this);\r\n    }\r\n};","import { WebListScrollingView } from './WebListScrollingView.js'\r\nimport { WebMenuColumnList } from './WebMenuColumnList.js'\r\nimport { WebMenuColumnRestorer } from './WebMenuColumnRestorer.js'\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebListHeaderView\r\n\r\nOne of the view classes in the list its mini MVC model. It is responsible for rendering the header \r\nand triggers click events on the controller. The WebList and WebListRowModel provide details needed \r\nto display the header.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListHeaderView {\r\n    constructor(oList, oModel, oController) {\r\n        this.oL = oList;\r\n        this.oC = oController;\r\n        this.oR = oList._oRowRenderer;\r\n\r\n        this._oHeaderMenu = null;\r\n        this._oHeaderMenuColumnList = null;\r\n        this._oHeaderMenuColumnRestorer = null;\r\n        this._bHeaderMenuPreviousState = true;\r\n\r\n        this._oColumnNewLineCache = [];\r\n\r\n        oList._onResize.on(this.onResize, this);\r\n        oList._onSettingChange.on(this.onSettingChange, this);\r\n        oList._onModulesCreated.on(this.onModulesCreated, this);\r\n    }\r\n\r\n    onModulesCreated(oEv) {\r\n        const oV = this.oL._oBody;\r\n\r\n        if (oV instanceof WebListScrollingView) {\r\n            oV.onHorizontalScroll.on(this.onHorizontalScroll, this);\r\n        }\r\n    }\r\n\r\n    genHtml(aHtml) {\r\n        const oL = this.oL;\r\n        aHtml.push('<div class=\"WebList_Head\"', (oL.pbShowHeader ? '' : ' style=\"display:none\"'), '>');\r\n        aHtml.push('<div class=\"WebList_HeadWrp', (oL.pbColumnsResizable ? ' WebList_ColResizable' : ''), (oL.pbAutoColumnSizing ? \" WebList_AutoSize\" : \" WebList_HorizScroll\"), '\">');\r\n        this.headerHtml(aHtml);\r\n        aHtml.push('</div>');\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    afterRender(eList) {\r\n        this.eHead = df.dom.query(eList, \"div.WebList_Head\");\r\n        this.eHeadWrp = df.dom.query(eList, \"div.WebList_HeadWrp\");\r\n\r\n        df.dom.on(\"click\", this.eHead, this.onHeadClick, this);\r\n        df.dom.on(\"mousedown\", this.eHead, this.onHeadMouseDown, this);\r\n        df.dom.on(\"dblclick\", this.eHead, this.onHeadDblClick, this);\r\n\r\n        // Refresh column list.\r\n        this.refreshColumnList();\r\n        // Set the ordering state.\r\n        this.setColumnReordering(this.oL.pbAllowColumnReordering); // Will also (re)render the Header Menu.\r\n    }\r\n\r\n    registerHeaderMenu(oMenu) {\r\n        if (this._oHeaderMenu) {\r\n            throw new df.Error(999, \"A WebContextMenu with the context 'ListHead' is already registered, only one is allowed.\", this);\r\n        }\r\n        this._oHeaderMenu = oMenu;\r\n    }\r\n\r\n    unregisterHeaderMenu(oMenu) {\r\n        if (!this._oHeaderMenu || this._oHeaderMenu !== oMenu) {\r\n            console.warn(\"A WebContextMenu with the context 'ListHead' is already registered, only one is allowed.\", this);\r\n        }\r\n        this._oHeaderMenu = null;\r\n    }\r\n\r\n    registerMenuColumnList(oMenuColumnList) {\r\n        if (this._oHeaderMenuColumnList) {\r\n            throw new df.Error(999, \"A WebMenuColumnList is already registered, only one is allowed.\", this);\r\n        }\r\n        if (!(oMenuColumnList instanceof WebMenuColumnList)) {\r\n            throw new df.Error(999, \"registerMenuColumnList() should only be called with a WebMenuColumnList.\", this);\r\n        }\r\n        this._oHeaderMenuColumnList = oMenuColumnList;\r\n        this._oHeaderMenuColumnList.pbRender = this.oL.pbAllowColumnReordering;\r\n    }\r\n\r\n    registerMenuColumnRestorer(oMenuColumnRestorer) {\r\n        if (this._oHeaderMenuColumnRestorer) {\r\n            throw new df.Error(999, \"A WebMenuColumnRestorer is already registered, only one is allowed.\", this);\r\n        }\r\n        if (!(oMenuColumnRestorer instanceof WebMenuColumnRestorer)) {\r\n            throw new df.Error(999, \"registerMenuColumnRestorer() should only be called with a WebMenuColumnRestorer.\", this);\r\n        }\r\n        this._oHeaderMenuColumnRestorer = oMenuColumnRestorer;\r\n        this._oHeaderMenuColumnRestorer.pbRender = this.oL.pbAllowColumnReordering;\r\n    }\r\n\r\n    refreshColumnList() {\r\n        this._oHeaderMenuColumnList?.refreshColumnList();\r\n    }\r\n\r\n    setColumnHiding(bVal) {\r\n        if (this._oHeaderMenuColumnList)\r\n            this._oHeaderMenuColumnList.pbRender = bVal;\r\n        this.refreshColumnList();\r\n    }\r\n\r\n    setColumnReordering(bVal) {\r\n        if (this._oHeaderMenuColumnRestorer)\r\n            this._oHeaderMenuColumnRestorer.pbRender = bVal;\r\n\r\n        if (bVal &&\r\n            !df.sys.isMobile) {\r\n            df.dom.on(\"dragstart\", this.eHead, this.onHeadMouseDownWithDraggingProxy, this);\r\n        } else {\r\n            df.dom.off(\"dragstart\", this.eHead, this.onHeadMouseDownWithDraggingProxy, this);\r\n        }\r\n\r\n        this._oHeaderMenu?.refreshMenu();\r\n    }\r\n\r\n    onHeadMouseDownWithDraggingProxy(oEv) {\r\n        this.onHeadMouseDown(oEv, true);\r\n    }\r\n\r\n    headerHtml(aHtml) {\r\n        const oL = this.oL, oR = this.oR;\r\n        let sCssClass, oLast = null;\r\n\r\n        aHtml.push('<table style=\"width:', oR.sTableWidth, '\">');\r\n        oR.resizeRowHtml(aHtml);\r\n        aHtml.push('<tr>');\r\n\r\n        //  Determine last\r\n        oLast = this.oL._aColumnMapper[this.oL._aColumnMapper.length - 1];\r\n\r\n        for (let i = 0; i < this.oL._aColumnMapper.length; i++) {\r\n            // Safety net for pbRender and pbHidden\r\n            if (!this.oL._aColumnMapper[i].pbRender || this.oL._aColumnMapper[i].pbHidden) continue;\r\n\r\n            const oCol = this.oL._aColumnMapper[i];\r\n\r\n            if (oCol.pbNewLine) {\r\n                aHtml.push('</tr><tr>');\r\n            }\r\n\r\n            //  Determine column CSS class\r\n            sCssClass = \"WebList_ColHead\";\r\n            if (oCol._iCol === oL.piSortColumn) {\r\n                sCssClass += (!oL.pbReverseOrdering ? \" WebList_SortedReverse\" : \" WebList_Sorted\");\r\n            }\r\n            if (oL.pbColumnSortable && oCol.pbSortable) {\r\n                sCssClass += \" WebList_Sortable\";\r\n            }\r\n            if (oCol.headerCSS()) {\r\n                sCssClass += \" \" + oCol.headerCSS();\r\n            }\r\n            sCssClass += \" \" + this.oR.cellClass(oCol, null);\r\n\r\n\r\n            aHtml.push('<th ', this.oL.pbAllowColumnReordering ? 'draggable=\"true\"' : '', ' class=\"', sCssClass, '\" data-dfcol=\"', oCol._iCol, '\"');\r\n            if (oCol.piListRowSpan > 1) {\r\n                aHtml.push(' rowspan=\"', oCol.piListRowSpan, '\"');\r\n            }\r\n            if (oCol.piListColSpan > 1) {\r\n                aHtml.push(' colspan=\"', oCol.piListColSpan, '\"');\r\n            }\r\n            if (oCol.psToolTip) {\r\n                aHtml.push(' title=\"', df.dom.encodeHtml(oCol.psToolTip), '\"');\r\n            }\r\n            if (!oCol.pbVisible) {\r\n                aHtml.push(df.cHideColumnCSS);\r\n            }\r\n\r\n            aHtml.push('><div>');\r\n            aHtml.push('<div class=\"WebList_ColCap\">', oCol.headerHtml(), '</div>');\r\n            if (oCol.pbResizable && (!oL.pbAutoColumnSizing || oCol !== oLast)) {\r\n                aHtml.push('<div class=\"WebList_ColSep\" data-dfcol=\"', oCol._iCol, '\"></div>');\r\n            }\r\n\r\n            aHtml.push('</div></th>');\r\n\r\n        }\r\n        aHtml.push('</tr></table>');\r\n\r\n    }\r\n\r\n    updateHeader() {\r\n        const aHtml = [];\r\n        const iPrevHeight = this.offsetHeight();\r\n\r\n        if (this.oL.pbAllowColumnHiding) this.refreshColumnList();\r\n\r\n        if (this.eHeadWrp) {\r\n            this.headerHtml(aHtml);\r\n            this.eHeadWrp.innerHTML = aHtml.join(\"\");\r\n        }\r\n\r\n        //  Check if this update changed the size\r\n        if (iPrevHeight != this.offsetHeight()) {\r\n            this.oL.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Queried by WebList to determine height used in height calculation of the body.\r\n    */\r\n    offsetHeight() {\r\n        if (this.eHead) {\r\n            return this.eHead.offsetHeight;\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Handles the onclick event on the list header. It will determine which column is clicked and if \r\n    pbColumnSortable is true and pbSortable of the column is true it will update the sorting by calling \r\n    the changeSorting method.\r\n    \r\n    @param  oEv  The event object (df.events.DOMEvent).\r\n    @return\r\n    */\r\n    onHeadClick(oEv) {\r\n        let eElem = oEv.getTarget();\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n\r\n        //  Find the column header div\r\n        while (eElem.parentNode && eElem !== this._eHead) {\r\n            if (eElem.tagName === \"TH\" && eElem.hasAttribute(\"data-dfcol\")) {\r\n                //  Determine the column\r\n                const iCol = parseInt(eElem.getAttribute(\"data-dfcol\"), 10);\r\n\r\n                if (this.oC.headClick(oEv, iCol)) {\r\n                    oEv.stop();\r\n                }\r\n                return;\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    Handles the double click event on the list header. It will determine which column is clicked and if \r\n    pbColumnSortable is true and pbSortable of the column is true it will update the sorting by calling \r\n    the changeSorting method.\r\n    \r\n    @param  oEv  The event object (df.events.DOMEvent).\r\n    @return\r\n    */\r\n    onHeadDblClick(oEv) {\r\n        let eElem = oEv.getTarget()\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n\r\n        //  Find the column header div\r\n        while (eElem.parentNode && eElem !== this._eHead) {\r\n            if (eElem.tagName === \"TH\" && eElem.hasAttribute(\"data-dfcol\")) {\r\n                //  Determine the column\r\n                const iCol = parseInt(eElem.getAttribute(\"data-dfcol\"), 10);\r\n\r\n                if (this.oC.headDblClick(oEv, iCol)) {\r\n                    oEv.stop();\r\n                }\r\n                return;\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n    }\r\n\r\n    onHeadMouseDown(oEv, bDragging) {\r\n        let eTarget = oEv.getTarget();\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled()) {\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n\r\n        // Ignore a right-moouse click.\r\n        if (oEv.e.button !== 0) return;\r\n\r\n        if (this._oHeaderMenu && this._oHeaderMenu.isVisible()) {\r\n            this._oHeaderMenu.hideMenu();\r\n            return;\r\n        }\r\n\r\n        //    Check if it is the resize div\r\n        if (eTarget.className === 'WebList_ColSep' && this.oL.pbColumnsResizable) {\r\n            if (this._oHeaderMenu) {\r\n                // Set the previous enabled state to a chaching variable for the context menu.\r\n                this._bHeaderMenuPreviousState = this._oHeaderMenu.isEnabled();\r\n                // Either way we disable the context menu for now, and enable it after the dragging stopped.\r\n                this._oHeaderMenu.disable();\r\n            }\r\n\r\n            this.resizeColumn(oEv, parseInt(eTarget.getAttribute('data-dfcol'), 10));\r\n\r\n            oEv.stop();\r\n            return false;\r\n        } else if ((eTarget.classList.contains('WebList_ColHead') || eTarget.className === 'WebList_ColCap') &&\r\n            this.oL.pbAllowColumnReordering &&\r\n            bDragging) {\r\n\r\n            if (this._oHeaderMenu) {\r\n                // Set the previous enabled state to a chaching variable for the context menu.\r\n                this._bHeaderMenuPreviousState = this._oHeaderMenu.isEnabled();\r\n                // Either way we disable the context menu for now, and enable it after the dragging stopped.\r\n                this._oHeaderMenu.disable();\r\n            }\r\n\r\n            while (!eTarget.classList.contains('WebList_ColHead')) {\r\n                eTarget = eTarget.parentNode;\r\n            }\r\n\r\n            const iColumn = parseInt(eTarget.getAttribute('data-dfcol'), 10);\r\n            const that = this;\r\n\r\n            // Create a cache for all pbNewLines to restore later.\r\n            this._oColumnNewLineCache = [];\r\n            for (let i = 0; i < this.oL._aColumnMapper.length; i++) {\r\n                if (this.oL._aColumnMapper[i].pbNewLine) {\r\n                    this._oColumnNewLineCache.push(i);\r\n                    this.oL._aColumnMapper[i].pbNewLine = false;\r\n                }\r\n            }\r\n\r\n            // Only in the case of newlines do we need to redraw.\r\n            if (this._oColumnNewLineCache.length > 0) this.oL.redraw();\r\n\r\n            // We have to wait for the render to finish in a rather nasty way.\r\n            // Nothing to do about that as we don't have an event to await a render finish.\r\n            // DOMNodeInsert was used before but was too instable as we don't know when it's done.\r\n            //\r\n            // setTimeout apparently worked historically by providing a 0. \r\n            // It would create a new queue event to process at the end of the browser event queue.\r\n            // It would then come after the render had finished however this does not seem to work anymore.\r\n            // Possilibly due to the new worker system in most browsers... so we just set a timeout of 100ms.\r\n            setTimeout(function () {\r\n                const eColumnHead = df.dom.query(that.eHead, '.WebList_ColHead[data-dfcol=\"' + iColumn + '\"');\r\n                that.moveColumn(eColumnHead, oEv, iColumn);\r\n            }, this._oColumnNewLineCache.length > 0 ? 75 : 0);\r\n\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    moveColumn(eColumnHeader, oEv, iOriginalDbIndex) {\r\n        const eColumnGhost = this.oL._eElem.cloneNode(true);  // We clone the whole list to keep styling.\r\n\r\n        const aLayoutToMapperIndex = [];\r\n        for (let i = 0; i < this.oL._aColumnMapper.length; i++) {\r\n            if (this.oL._aColumnMapper[i].pbRender && !this.oL._aColumnMapper[i].pbHidden) {\r\n                aLayoutToMapperIndex.push(i);\r\n            }\r\n        }\r\n\r\n        // Then we need the actual element index since the data-dfcol/iOriginalDbIndex is used on the data side.\r\n        const iOriginalIndexInLayout = Array.prototype.indexOf.call(eColumnHeader.parentNode.children, eColumnHeader);\r\n        const iOriginalIndexInMapper = aLayoutToMapperIndex[iOriginalIndexInLayout];\r\n\r\n        // Pre-allocate a new index to the same index.\r\n        let iNewIndexInMapper = iOriginalIndexInMapper;\r\n\r\n        // // We remove all possible text from the column header.\r\n        for (let i = 0; i < eColumnHeader.childNodes.length; i++) {\r\n            eColumnHeader.removeChild(eColumnHeader.childNodes[i]);\r\n        }\r\n        eColumnHeader.classList.add(\"WebList_Moving\");\r\n\r\n        // Then we lookup all cells that correspond to our column.\r\n        const aColumnHeadedRows = df.dom.query(this.oL._oBody.eBody, 'td[data-dfcol=\"' + iOriginalDbIndex + '\"', true);\r\n        // We remove the text to create a sort of animation and apply styling.\r\n        for (let i = 0; i < aColumnHeadedRows.length; i++) {\r\n            aColumnHeadedRows[i].innerHTML = \"\";\r\n            aColumnHeadedRows[i].classList.add(\"WebList_Moving\");\r\n        }\r\n\r\n        // We want to attach the ghost as specific as possible thus we need to calculate the correction,\r\n        // from the top-left corner of the orignal column-head or ghost to the cursor.\r\n        // We apply this later every time.\r\n        const oColumnHead_Rect = eColumnHeader.getBoundingClientRect();\r\n        const iColumnGhost_MouseCorrection_X = oColumnHead_Rect.width / 2;\r\n        const iColumnGhost_MouseCorrection_Y = oColumnHead_Rect.height / 2;\r\n\r\n        // Now we are going to prune the ghost. We remove everything not having to do with our column.\r\n        // This way we can keep the styling whilst moving only our column in the ghost.\r\n        const aGhostColumnCells = df.dom.query(eColumnGhost, \"[data-dfcol]\", true);\r\n        for (let i = 0; i < aGhostColumnCells.length; i++) {\r\n            if (aGhostColumnCells[i].getAttribute(\"data-dfcol\") != iOriginalDbIndex) { // If it isn't our column.\r\n                aGhostColumnCells[i].parentNode.removeChild(aGhostColumnCells[i]);                 // Remove it.\r\n            } else {\r\n                // If it is our column; maximize the size since we correct this later.\r\n                aGhostColumnCells[i].style.width = \"100%\";\r\n            }\r\n        }\r\n\r\n        // If it contains a scrollbar remove it since it won't be used and isn't calculated into the width.\r\n        const eVerticalScrollBar = df.dom.query(eColumnGhost, \".WebList_Scroll\");\r\n        if (eVerticalScrollBar) eVerticalScrollBar.parentNode.removeChild(eVerticalScrollBar);\r\n\r\n        let aHorizontalScrollBars = df.dom.query(eColumnGhost, \".WebList_HorizScroll\", true);\r\n        for (let i = 0; i < aHorizontalScrollBars.length; i++) {\r\n            df.dom.removeClass(aHorizontalScrollBars[i], \"WebList_HorizScroll\");\r\n        }\r\n\r\n        // If the list has a label; remove it.\r\n        if (this.oL.pbShowLabel) {\r\n            const eGhostListLabel = df.dom.query(eColumnGhost, \"div > label\", false);\r\n            if (eGhostListLabel) eGhostListLabel.parentNode.removeChild(eGhostListLabel);\r\n        }\r\n\r\n        // Set all positional data on the ghost.\r\n        eColumnGhost.style.position = \"fixed\";\r\n        eColumnGhost.style.left = (oEv.e.clientX - iColumnGhost_MouseCorrection_X) + \"px\";\r\n        eColumnGhost.style.top = (oEv.e.clientY - iColumnGhost_MouseCorrection_Y) + \"px\";\r\n        eColumnGhost.style.width = oColumnHead_Rect.width + \"px\";\r\n        // Very important is that we set the pointer-events to none.\r\n        // This is required as we don't want to catch a ElementFromPoint request on the ghost.\r\n        // Only IE11+ though....\r\n        eColumnGhost.style[\"pointer-events\"] = \"none\";\r\n        (this.oL.topLayer() || document.body).appendChild(eColumnGhost);\r\n\r\n        // Save the overflow and set it to hidden so we don't get any scrollbars.\r\n        var sBodyOverflowCache = document.body.style.overflow;\r\n        document.body.style.overflow = \"hidden\";\r\n\r\n        const aColumnElements = df.dom.query(this.oL._eElem, '[data-dfcol=\"' + iOriginalDbIndex + '\"', true);\r\n        function updateColumnShadowPosition(iNewIndexOfColumn) {\r\n            // Now we are going to move the column header from one place to another. \r\n            function moveElementToIndex(eElem, iIndex) {\r\n                const eParent = eElem.parentNode;\r\n                eParent.removeChild(eElem);\r\n\r\n                if (iIndex >= eParent.childNodes.length) {\r\n                    eParent.appendChild(eElem);\r\n                } else {\r\n                    eParent.insertBefore(eElem, eParent.childNodes[iIndex]);\r\n                }\r\n            }\r\n\r\n            moveElementToIndex(eColumnHeader, iNewIndexOfColumn);\r\n            for (let i = 0; i < aColumnElements.length; i++) {\r\n                moveElementToIndex(aColumnElements[i], iNewIndexOfColumn);\r\n            }\r\n        }\r\n\r\n        let dtLastHorizontalScroll = Date.now();\r\n        const eHorizontalSrollbar = this.oL._oBody.eTableWrp;\r\n        const iHorizontalScrollDeltaPx = 20;\r\n\r\n        function onMove(oEv) {\r\n            // Recorrect the ghost to the cursor and columnhead.\r\n            eColumnGhost.style.left = (oEv.e.clientX - iColumnGhost_MouseCorrection_X) + \"px\";\r\n            eColumnGhost.style.top = (oEv.e.clientY - iColumnGhost_MouseCorrection_Y) + \"px\";\r\n\r\n            if (this.oL._oBody.eTableWrp) {\r\n                let oScrollBarRect = eHorizontalSrollbar.getBoundingClientRect();\r\n                if (Date.now() - dtLastHorizontalScroll > 100) {\r\n                    if (oEv.e.clientX < oScrollBarRect.left + iHorizontalScrollDeltaPx + iHorizontalScrollDeltaPx) {\r\n                        eHorizontalSrollbar.scrollLeft -= iHorizontalScrollDeltaPx;\r\n                        dtLastHorizontalScroll = Date.now();\r\n                    } else if (oEv.e.clientX > oScrollBarRect.right - iHorizontalScrollDeltaPx - iHorizontalScrollDeltaPx) {\r\n                        eHorizontalSrollbar.scrollLeft += iHorizontalScrollDeltaPx;\r\n                        dtLastHorizontalScroll = Date.now();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // We grab the hovered over element and keep going till we find column data.\r\n            let eTarget = oEv.getTarget();\r\n            while (eTarget.hasAttribute && !eTarget.hasAttribute('data-dfcol') && eTarget != this.oL._eElem) {\r\n                eTarget = eTarget.parentNode;\r\n            }\r\n\r\n            let eWebObject = eTarget;\r\n            if (eTarget.hasAttribute && eTarget.hasAttribute('data-dfcol')) {\r\n                while (eWebObject.hasAttribute && !eWebObject.hasAttribute('data-dfobj') && eTarget != this.oL._eElem) {\r\n                    eWebObject = eWebObject.parentNode;\r\n                }\r\n            }\r\n\r\n            // If no column data could be found it means we are outside of our object.\r\n            // Or if we didn't find our own element.\r\n            if (!eTarget.hasAttribute || !eTarget.hasAttribute('data-dfcol') || eWebObject !== this.oL._eElem) {\r\n                // Set it to the original state.\r\n                updateColumnShadowPosition(iOriginalIndexInLayout);\r\n                return;\r\n            }\r\n\r\n            if (eTarget.classList.contains(\"WebList_Moving\")) return;\r\n\r\n            const oRect = eTarget.getBoundingClientRect();\r\n            const iLeftBarrier = oRect.left + ((oRect.right - oRect.left) / 3);\r\n            const iRightBarrier = oRect.right - ((oRect.right - oRect.left) / 3);\r\n\r\n            // Don't do anything if we are not touching a barrier to avoid unnessesary flickering...\r\n            if (oEv.e.x > iLeftBarrier && oEv.e.x < iRightBarrier) return;\r\n\r\n            // Get the new column nr for reference.\r\n            let iNewIndexInLayout = Array.prototype.indexOf.call(eTarget.parentNode.children, eTarget);\r\n\r\n            // We are gonna check whether we are positioned more to the right of the element.\r\n            // If so, we would want to insert it to the right of it.\r\n            if (oEv.e.x <= iLeftBarrier) {\r\n                if (iNewIndexInLayout > iOriginalIndexInLayout &&\r\n                    iNewIndexInLayout > 0) {\r\n                    iNewIndexInLayout--;\r\n                }\r\n            }\r\n            else if (oEv.e.x > iRightBarrier) { // More to the right of the element.\r\n                if (iNewIndexInLayout < iOriginalIndexInLayout &&\r\n                    iNewIndexInLayout < eTarget.parentNode.children.length - 1) {\r\n                    iNewIndexInLayout++;\r\n                }\r\n            }\r\n\r\n            // Update the mapper index.\r\n            iNewIndexInMapper = aLayoutToMapperIndex[iNewIndexInLayout];\r\n\r\n            // Now we need to move the column definitions and cells to that location moving the rest of the elements to the right.\r\n            updateColumnShadowPosition(iNewIndexInLayout);\r\n        }\r\n\r\n        //  Handles the events that should stop the drag and \r\n        function onStopMove(oEv) {\r\n            // Re-enable the context menu.\r\n            if (this._oHeaderMenu) this._oHeaderMenu.enable(this._bHeaderMenuPreviousState);\r\n\r\n            // If we mouseup a non-left moouse button ignore that one.\r\n            if (oEv.e.button !== 0) return;\r\n\r\n            // Restore the overflow cache.\r\n            document.body.style.overflow = sBodyOverflowCache;\r\n\r\n            //  Remove event handlers\r\n            df.dom.off(\"mouseup\", window, onStopMove, this);\r\n            df.dom.off(\"mousemove\", window, onMove, this);\r\n\r\n            // Remove the ghost from the view.\r\n            eColumnGhost.parentNode.removeChild(eColumnGhost);\r\n\r\n            // Restore newlines.\r\n            for (let i = 0; i < this._oColumnNewLineCache.length; i++) {\r\n                this.oL._aColumnMapper[this._oColumnNewLineCache[i]].pbNewLine = true;\r\n            }\r\n\r\n            // We grab the hovered over element and keep going till we find column data.\r\n            let eTarget = oEv.getTarget();\r\n            while (eTarget.hasAttribute && !eTarget.hasAttribute('data-dfcol') && eTarget != this.oL._eElem) {\r\n                eTarget = eTarget.parentNode;\r\n            }\r\n\r\n            let eWebObject = eTarget;\r\n            if (eTarget.hasAttribute && eTarget.hasAttribute('data-dfcol')) {\r\n                while (eWebObject.hasAttribute && !eWebObject.hasAttribute('data-dfobj') && eTarget != this.oL._eElem) {\r\n                    eWebObject = eWebObject.parentNode;\r\n                }\r\n            }\r\n\r\n            // If no column data could be found it means we are outside of our object.\r\n            // Or if we didn't find our own element.\r\n            if (!eTarget.hasAttribute ||\r\n                !eTarget.hasAttribute('data-dfcol') ||\r\n                eWebObject !== this.oL._eElem) {\r\n                this.oL.redraw();\r\n                return;\r\n            }\r\n\r\n            // Let's move the columns inside of the column mapper.\r\n            const oOrgCol = this.oL._aColumnMapper[iOriginalIndexInMapper];\r\n            this.oL._aColumnMapper.splice(iOriginalIndexInMapper, 1);\r\n            this.oL._aColumnMapper.splice(iNewIndexInMapper, 0, oOrgCol);\r\n\r\n            // Remap the other positions after the first index either the original or new one.\r\n            let iIndex = iNewIndexInMapper < iOriginalIndexInMapper ? iNewIndexInMapper : iOriginalIndexInMapper;\r\n            for (; iIndex < this.oL._aColumnMapper.length; iIndex++) {\r\n                this.oL._aColumnMapper[iIndex].piPosition = iIndex;\r\n            }\r\n\r\n            // Redraw all of it.\r\n            this.oL.redraw();\r\n            this.oL.triggerLayoutChange(this.oL._aChildren[iOriginalDbIndex]);\r\n        }\r\n\r\n        //  Attach event handlers\r\n        df.dom.on(\"mouseup\", window, onStopMove, this);\r\n        df.dom.on(\"mousemove\", window, onMove, this);\r\n    }\r\n\r\n    resizeColumn(oEv, iCol) {\r\n        const oL = this.oL, oR = this.oR;\r\n        let iPX = 0, iDiff = 0, iMin, iMax = 0;\r\n\r\n        //  First create our drag mask\r\n        const eMask = df.gui.dragMask(oL.topLayer() || document.body);\r\n        eMask.style.cursor = \"e-resize\";\r\n\r\n        //  Determine percentage to pixel ratio\r\n        const iRatio = oR.calcPixelRatio(); //this.findColNr(oR.aColWidths[iCol].oCol));\r\n\r\n        let eColumn = oEv.getTarget().parentNode;\r\n        while (eColumn.hasAttribute && !eColumn.hasAttribute('data-dfcol') && eColumn != this.oL._eElem) {\r\n            eColumn = eColumn.parentNode;\r\n        }\r\n\r\n        const iVCol = Array.prototype.indexOf.call(eColumn.parentNode.children, eColumn);\r\n\r\n        //  Get fixed position of slider\r\n        const oRect = oEv.getTarget().getBoundingClientRect();\r\n\r\n        //  Determine current position and maximum\r\n        if (oL.pbAutoColumnSizing) {\r\n            for (let i = iVCol + 1; i < oR.aColWidths.length; i++) {\r\n                if (oR.aColWidths[i].oCol.pbResizable) {   //  Do not increase maximum with columns that are not resizable so they never get smaller\r\n                    if (oR.aColWidths[i].bFixed) {\r\n                        iPX = oR.aColWidths[i].iPixels;\r\n                    } else {\r\n                        iPX = (oR.aColWidths[i].iPercent * iRatio);\r\n                    }\r\n                    //    Determine minimum\r\n                    iMax += iPX - oR.iColMin;\r\n                }\r\n            }\r\n        } else {\r\n            iMax = screen.width - oRect.left;\r\n        }\r\n        const iStartX = oEv.getMouseX();\r\n\r\n        //    Determine minimum\r\n        if (oR.aColWidths[iVCol].bFixed || !oL.pbAutoColumnSizing) {\r\n            iMin = -oR.aColWidths[iVCol].iPixels + oR.iColMin;\r\n        } else {\r\n            iMin = -(oR.aColWidths[iVCol].iPercent * iRatio) + oR.iColMin;\r\n        }\r\n\r\n        //    Create ghost separator\r\n\r\n        const iLeft = oRect.left;\r\n        const eGhost = df.dom.create('<div class=\"WebList_ColResizer\"></div>');\r\n        this.eHead.appendChild(eGhost);\r\n        eGhost.style.left = iLeft + \"px\";\r\n        eGhost.style.top = oRect.top + \"px\";\r\n        eGhost.style.height = oL._eElem.clientHeight + \"px\"; //(this._eHead.clientHeight + this._eBody.clientHeight) + \"px\";\r\n\r\n        //  Resizer function that handles the mousemove and calculates the pixel difference and moves the ghost separator\r\n        function onResize(oEv) {\r\n            const iNewX = oEv.getMouseX();\r\n\r\n            //  Calculate new difference\r\n            iDiff = iNewX - iStartX;\r\n\r\n            //  Check against min and max\r\n            if (iDiff < iMin) {\r\n                iDiff = iMin;\r\n            }\r\n            if (iDiff > iMax) {\r\n                iDiff = iMax;\r\n            }\r\n\r\n            // df.debug(\"iDiff (\" + iDiff + \") = iNewX(\" + iNewX + \" - iStartX(\" + iStartX + \");\");\r\n            //  Apply to ghost\r\n            const iNewLeft = iLeft + iDiff;\r\n            eGhost.style.left = iNewLeft + \"px\";\r\n        }\r\n\r\n        //  Handles the events that should stop the drag and \r\n        function onStopResize(oEv) {\r\n            if (this._oHeaderMenu) this._oHeaderMenu.enable(this._bHeaderMenuPreviousState);\r\n\r\n            if (oEv.e.button !== 0) return;\r\n\r\n            //  Remove event handlers\r\n            df.dom.off(\"mouseup\", eMask, onStopResize, this);\r\n            df.dom.off(\"mouseup\", window, onStopResize, this);\r\n            //df.dom.off(\"mouseout\", eMask, onStopResize, this);\r\n            df.dom.off(\"mousemove\", eMask, onResize, this);\r\n\r\n            //  Remove ghost & mask\r\n            eGhost.parentNode.removeChild(eGhost);\r\n            eMask.parentNode.removeChild(eMask);\r\n\r\n            //  Update column sizes\r\n            this.oR.recalcColumnSizes(iVCol, iDiff, false);\r\n            this.oL.triggerLayoutChange(this.oL._aChildren[iCol]);\r\n        }\r\n\r\n        //  Attach event handlers\r\n        df.dom.on(\"mouseup\", eMask, onStopResize, this);\r\n        df.dom.on(\"mouseup\", window, onStopResize, this);\r\n        //df.dom.on(\"mouseout\", eMask, onStopDrag, this);\r\n        df.dom.on(\"mousemove\", eMask, onResize, this);\r\n    }\r\n\r\n    colCell(oCol) {\r\n        return this.colCellByIndex(oCol._iCol);\r\n    }\r\n\r\n    colCellByIndex(iCol) {\r\n        return df.dom.query(this.eHeadWrp, \"th.WebList_ColHead[data-dfcol='\" + iCol + \"']\");\r\n    }\r\n\r\n    onSettingChange(oEv) {\r\n        const oL = this.oL;\r\n\r\n        if (oEv.sType === \"redraw\") {\r\n            this.updateHeader();\r\n        } else if (oEv.sType === \"sorting\") {\r\n            this.updateHeader();\r\n        } else if (oEv.sType === \"prop\") {\r\n            switch (oEv.sProp) {\r\n                case \"piSortColumn\":\r\n                case \"pbReverseOrdering\":\r\n                    this.updateHeader();\r\n                    break;\r\n                case \"pbShowHeader\":\r\n                    if (this.eHead) {\r\n                        this.eHead.style.display = (oL.pbShowHeader ? \"\" : \"none\");\r\n                        oL.sizeChanged();\r\n                    }\r\n                    break;\r\n                case \"pbColumnsResizable\":\r\n                    if (this.eHead) {\r\n                        df.dom.toggleClass(this.eHeadWrp, \"WebList_ColResizable\", oL.pbColumnsResizable);\r\n                    }\r\n                    break;\r\n                case \"pbAutoColumnSizing\":\r\n                    df.dom.toggleClass(this.eHeadWrp, \"WebList_AutoSize\", this.oL.pbAutoColumnSizing);\r\n                    df.dom.toggleClass(this.eHeadWrp, \"WebList_HorizScroll\", !this.oL.pbAutoColumnSizing);\r\n            }\r\n        }\r\n    }\r\n\r\n    onResize(oEv) {\r\n\r\n        if (this.eHead && this.oL._oBody) {\r\n            this.eHead.style.paddingRight = this.oL._oBody.scrollbarWidth() + \"px\";\r\n        }\r\n    }\r\n\r\n    onHorizontalScroll(oEv) {\r\n        if (this.eHeadWrp) {\r\n            this.eHeadWrp.scrollLeft = oEv.nScrollX;\r\n        }\r\n    }\r\n}","import { WebListScrollingView } from './WebListScrollingView.js'\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebListFooterView\r\n\r\nOne of the view classes in the list its mini MVC model. It is responsible for rendering the footer \r\nand triggers click events on the controller. The WebList and WebListRowModel provide details needed \r\nto display the Footer.\r\n\r\nRevision:\r\n    2021/09/08  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListFooterView {\r\n    constructor(oList, oModel, oController) {\r\n        this.oL = oList;\r\n        this.oC = oController;\r\n        this.oR = oList._oRowRenderer;\r\n        this.oM = oModel;\r\n\r\n        oList._onResize.on(this.onResize, this);\r\n        oList._onSettingChange.on(this.onSettingChange, this);\r\n        oList._onModulesCreated.on(this.onModulesCreated, this);\r\n    }\r\n\r\n    onModulesCreated(oEv) {\r\n        const oV = this.oL._oBody;\r\n\r\n        if (oV instanceof WebListScrollingView) {\r\n            oV.onHorizontalScroll.on(this.onHorizontalScroll, this);\r\n        }\r\n    }\r\n\r\n    genHtml(aHtml) {\r\n        const oL = this.oL;\r\n        aHtml.push('<div class=\"WebList_Footer WebList_Body\"', (oL.pbShowFooter ? '' : ' style=\"display:none\"'), '>');\r\n        aHtml.push('<div class=\"WebList_FooterWrp WebList_BodyWrp', (oL.pbColumnsResizable ? ' WebList_ColResizable' : ''), (oL.pbAutoColumnSizing ? \" WebList_AutoSize\" : \" WebList_HorizScroll\"), '\">');\r\n        this.footerHtml(aHtml);\r\n        aHtml.push('</div>');\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    afterRender(eList) {\r\n        this.eFooter = df.dom.query(eList, \"div.WebList_Footer\");\r\n        this.eFooterWrp = df.dom.query(eList, \"div.WebList_FooterWrp\");\r\n    }\r\n\r\n    footerHtml(aHtml) {\r\n        const oFooterRow = {\r\n            aCells: [],\r\n            sCssClassName: \"\",\r\n            sRowId: \"_WebList_Footer\",\r\n            iGroupHeaderIndex: -1,\r\n            fCellClass(oCol, tCell) {\r\n                const aClasses = [];\r\n\r\n                aClasses.push(oCol._sCellClass);\r\n\r\n                aClasses.push(df.CssDisabled);\r\n\r\n                aClasses.push(oCol.peFooterAlign === df.ciAlignLeft ? \"WebList_AlignLeft\" : (oCol.peFooterAlign === df.ciAlignCenter ? \"WebList_AlignCenter\" : (oCol.peFooterAlign === df.ciAlignRight ? \"WebList_AlignRight\" : \"\")));\r\n\r\n                if (oCol.peFooterDataType === df.ciTypeBCD) {\r\n                    aClasses.push(\"dfData_BCD\");\r\n                } else if (oCol.peFooterDataType === df.ciTypeDate) {\r\n                    aClasses.push(\"dfData_Date\");\r\n                } else {\r\n                    aClasses.push(\"dfData_Text\");\r\n                }\r\n\r\n                if (oCol.psCSSClass) {\r\n                    aClasses.push(oCol.psCSSClass);\r\n                }\r\n\r\n                if (tCell && tCell.sCssClassName) {\r\n                    aClasses.push(tCell.sCssClassName);\r\n                }\r\n\r\n                return aClasses.join(\" \");\r\n            },\r\n            fCellHtml(sRowId, tCell) {\r\n                let sVal = tCell.sValue;\r\n\r\n                if (sVal.length === 0) return '&nbsp;';\r\n\r\n                sVal = df.sys.data.serverToType(sVal, this.peFooterDataType);\r\n                sVal = df.sys.data.typeToDisplay(sVal, this.peFooterDataType, this.getWebApp(),\r\n                    this._bHasFocus, this.psFooterMask, this.piFooterPrecision);\r\n\r\n                if (!this.pbAllowHtml) {\r\n                    sVal = df.dom.encodeHtml(sVal);\r\n                }\r\n\r\n                return (sVal !== '' ? sVal : '&nbsp;');\r\n            }\r\n        };\r\n\r\n        // We have to merge the swipe buttons with the value columns.\r\n        let aMergedColumns = this.oL._aColumns.concat(this.oL._aSwipeBtns);\r\n\r\n        aMergedColumns.sort(function (a, b) {\r\n            const x = a._iColIndex, y = b._iColIndex;\r\n            return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n        });\r\n\r\n        for (let i = 0; i < aMergedColumns.length; i++) {\r\n            oFooterRow.aCells.push({\r\n                sValue: aMergedColumns[i].psFooterValue || \"\",\r\n                sTooltip: \"\",\r\n                sCssClassName: \"\",\r\n                aOptions: []\r\n            });\r\n        }\r\n\r\n        this.oR.rowHtml(oFooterRow, aHtml, true);\r\n    }\r\n\r\n    updateFooter() {\r\n        const aHtml = [];\r\n\r\n        if (this.eFooterWrp) {\r\n            this.footerHtml(aHtml);\r\n            this.eFooterWrp.innerHTML = aHtml.join(\"\");\r\n        }\r\n    }\r\n\r\n    /* \r\n    Queried by WebList to determine height used in height calculation of the body.\r\n    */\r\n    offsetHeight() {\r\n        if (this.eFooter) {\r\n            return this.eFooter.offsetHeight;\r\n        }\r\n    }\r\n\r\n    onSettingChange(oEv) {\r\n        const oL = this.oL;\r\n\r\n        if (oEv.sType === \"redraw\") {\r\n            this.updateFooter();\r\n        } else if (oEv.sType === \"sorting\") {\r\n            this.updateFooter();\r\n        } else if (oEv.sType === \"prop\") {\r\n            switch (oEv.sProp) {\r\n                case \"piSortColumn\":\r\n                case \"pbReverseOrdering\":\r\n                    this.updateFooter();\r\n                    break;\r\n                case \"pbShowFooter\":\r\n                    if (this.eFooter) {\r\n                        this.eFooter.style.display = (oL.pbShowFooter ? \"\" : \"none\");\r\n                        oL.sizeChanged();\r\n                    }\r\n                    break;\r\n                case \"pbColumnsResizable\":\r\n                    if (this.eFooter) {\r\n                        df.dom.toggleClass(this.eFooterWrp, \"WebList_ColResizable\", oL.pbColumnsResizable);\r\n                    }\r\n                    break;\r\n                case \"pbAutoColumnSizing\":\r\n                    df.dom.toggleClass(this.eFooterWrp, \"WebList_AutoSize\", this.oL.pbAutoColumnSizing);\r\n                    df.dom.toggleClass(this.eFooterWrp, \"WebList_HorizScroll\", !this.oL.pbAutoColumnSizing);\r\n            }\r\n        }\r\n    }\r\n\r\n    onResize(oEv) {\r\n\r\n        if (this.eFooter && this.oL._oBody) {\r\n            this.eFooter.style.paddingRight = this.oL._oBody.scrollbarWidth() + \"px\";\r\n        }\r\n    }\r\n\r\n    onHorizontalScroll(oEv) {\r\n        if (this.eFooterWrp) {\r\n            this.eFooterWrp.scrollLeft = oEv.nScrollX;\r\n        }\r\n    }\r\n};","import { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebListTouchHandler\r\n\r\nThe touch logic of the WebList which is placed in a separate module. It implements touch scrolling \r\n(kinetic with bounce) if a WebListScrollingView is used. It also contains the logic for the swipe \r\nbuttons. It does hook into the view classes pretty tightly.\r\n    \r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\nexport class WebListTouchHandler {\r\n    constructor(oList, oView, oModel, oController) {\r\n        this.oL = oList;\r\n        this.oV = oView;\r\n        this.oM = oModel;\r\n        this.oC = oController;\r\n\r\n\r\n        this.iAutoScrollIncr = 1;\r\n\r\n        this.iSwipeStartOffset = 0;\r\n        this.iSwipeOffset = 0;\r\n\r\n        this.eSwipeRow = null;\r\n        this.eSwipeRowStart = null;\r\n        this.eSwipeLeftBtns = null;\r\n        this.eSwipeRightBtns = null;\r\n    }\r\n\r\n    afterRender(eList) {\r\n        const oV = this.oV;\r\n\r\n        if (window.PointerEvent) {    //  Microsofts new standard adopted by W3C for touch / mouse & pen events as of IE11\r\n            df.dom.on(\"pointerdown\", oV.eBody, this.onPointerDown, this);\r\n        } else {\r\n            df.dom.on(\"touchstart\", oV.eBody, this.onTouchStart, this);\r\n        }\r\n\r\n        //  Attach a non passive touchmove listener to prevent move from causing a bounce at body level on IOS 10 Safari\r\n        if (oV.bScroll && oV.eBodyWrp.addEventListener && this.oL.pbAutoColumnSizing) {\r\n            oV.eBodyWrp.addEventListener(\"touchmove\", function (e) {\r\n                e.preventDefault();\r\n            }, { passive: false });\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    This event handler handles the touch event on mobile devices. It will scroll list if the touch is a \r\n    vertical sliding touch.\r\n    \r\n    @param  oEv     Event object (df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onTouchStart(oEv) {\r\n        //  Only respond to single finger swipes\r\n        if (oEv.e.targetTouches.length === 1) {\r\n            this.touchScroll(false, oEv);\r\n        }\r\n    }\r\n\r\n    onPointerDown(oEv) {\r\n        if (oEv.e.pointerType === \"pen\" || oEv.e.pointerType === \"touch\") {\r\n            this.touchScroll(true, oEv);\r\n        }\r\n    }\r\n\r\n    touchScroll(bPointer, oEv) {\r\n        const that = this, oV = this.oV, iTimeConstant = 325, bScrollable = !!oV.bScroll;\r\n        let iY, iPrevY, iVelocity = 0, iAmplitude = 0, iTimestamp = Date.now(), iFrame,\r\n            tTracker, iTarget, iMaxPX, iBounce, iBounceTime = 0, iStartOffset, iAuto,\r\n            iX, iPrevX, bSwipe = false, bSwipeFixed = false;\r\n\r\n        //  Stop running scroll animations\r\n        oV.iAutoScroll = iAuto = this.iAutoScrollIncr++;\r\n        // console.log(iAuto + \":touchStart  oV.iScrollOffsetPx:\" + oV.iScrollOffsetPx);\r\n\r\n\r\n        //  Initialize variables\r\n        const bSwipable = this.swipeStart(oEv.getTarget());\r\n\r\n        const iStartX = iPrevX = iX = (bPointer ? oEv.e.clientX : oEv.e.targetTouches[0].pageX);\r\n        const iStartY = iFrame = iPrevY = iY = (bPointer ? oEv.e.clientY : oEv.e.targetTouches[0].pageY);\r\n\r\n        if (bScrollable) {\r\n            iStartOffset = oV.iScrollOffsetPx;\r\n            iMaxPX = oV.getMaxPX();\r\n            iBounce = oV.iTableHeight * 0.1;\r\n        }\r\n\r\n        //  Handles the move event and recalculates the scrollbar position accordingly\r\n        function touchMove(oEv) {\r\n            var iOffset, iDiff;\r\n\r\n            //  Determine new touch position\r\n            iY = (bPointer ? oEv.e.clientY : oEv.e.targetTouches[0].pageY);\r\n            iX = (bPointer ? oEv.e.clientX : oEv.e.targetTouches[0].pageX);\r\n\r\n\r\n\r\n            //  Switch between horizontal swipe and scroll\r\n            if ((bSwipeFixed && bSwipe) || (!bSwipeFixed && Math.abs(iStartX - iX) > Math.abs(iStartY - iY))) {\r\n                bSwipe = true;\r\n\r\n                // console.log(iAuto + \":swipeRow iDiffX: \" + (iStartX - iX));\r\n                this.swipeRow(oEv.getTarget(), iStartX - iX);\r\n            } else {\r\n                if (bSwipe) {\r\n                    //  Cancel swipe\r\n                    this.swipeRowCancel();\r\n                }\r\n\r\n                if (bScrollable) {\r\n                    //  Calculate new offset\r\n                    iOffset = oV.iScrollOffsetPx + (iPrevY - iY);\r\n\r\n                    //  Use elastic logic outside boundaries\r\n                    if (iOffset < 0) {\r\n                        iDiff = iStartOffset + (iStartY - iY);\r\n                        iOffset = iDiff * 0.3;\r\n                    } else if (iOffset > iMaxPX) {\r\n                        iDiff = iStartOffset + (iStartY - iY) - iMaxPX;\r\n                        iOffset = iMaxPX + iDiff * 0.3;\r\n                    }\r\n\r\n                    //  Perform scroll\r\n                    oV.scrollTo(iOffset, false, false, true);\r\n                    //console.log(iAuto + \":scrollRow x:\" + iX + \"  y:\" + iY + \"  startx:\" + iStartX + \" starty:\" + iStartY + \" iOffset:\" + iOffset);\r\n\r\n                    oEv.stop();\r\n                }\r\n            }\r\n\r\n            //  Update administration\r\n            iPrevY = iY;\r\n            iPrevX = iX;\r\n\r\n            if (bSwipable || bScrollable) {\r\n                oEv.e.preventDefault();\r\n            }\r\n        }\r\n\r\n        //\r\n        //  Performs the kinetic scrolling animiation. Adjusts animation for bounce when outside of boundaries.\r\n        //\r\n        function autoScroll() {\r\n            let iElapsed, iDelta;\r\n\r\n            if (oV.iAutoScroll === iAuto && iAmplitude) {\r\n                iElapsed = Date.now() - iTimestamp;\r\n\r\n                //  Detect when outside boundaries\r\n                if (oV.iScrollOffsetPx < 0 || oV.iScrollOffsetPx > iMaxPX) {\r\n                    //  For the first time we need to calculate bounce values (target & time)\r\n                    if (!iBounceTime) {\r\n                        //  Determine how far we where with the autoscroll animation\r\n                        const iDone = Math.abs((-iAmplitude * Math.exp(-iElapsed / iTimeConstant)) / iAmplitude);\r\n\r\n                        //  Calculate bouncetime & amplitude based on current amplitude and done value\r\n                        iBounceTime = iDone * 100;\r\n                        iAmplitude = (Math.max(-iAmplitude / 2000, 1) * (oV.iScrollOffsetPx > iMaxPX ? iBounce : -iBounce)) * iDone;\r\n                        iTarget = oV.iScrollOffsetPx + iAmplitude;\r\n\r\n                        //  Reset counters\r\n                        iTimestamp = Date.now();\r\n                        iElapsed = Date.now() - iTimestamp;\r\n                    }\r\n\r\n                    iDelta = -iAmplitude * Math.exp(-iElapsed / iBounceTime);\r\n                } else {\r\n                    iDelta = -iAmplitude * Math.exp(-iElapsed / iTimeConstant);\r\n                }\r\n                const iOffset = iTarget + iDelta;\r\n\r\n                //  Perform actuall scroll\r\n                if (iDelta > 0.5 || iDelta < -0.5) {\r\n                    // console.log(iAuto + \":autoScroll(iDelta : \" + iDelta + \", iOffset : \" + iOffset + \", iAmplitude:\"+ iAmplitude + \")\");\r\n                    oV.scrollTo(iOffset, false, false, true);\r\n                    df.dom.animFrame(autoScroll, this);\r\n                } else {\r\n                    //  If there isn't enough speed anymore we end the animation\r\n                    // console.log(iAuto + \":autoScroll last(iDelta : \" + iDelta + \", iOffset : \" + iOffset + \", iAmplitude:\"+ iAmplitude + \")\");\r\n                    oV.scrollTo(iTarget, false, false, true);\r\n\r\n                    //  Perform animation back to limit when outside of boundaries\r\n                    if (iTarget < 0) {\r\n                        aniScroll.call(that, -oV.iScrollOffsetPx, ((iOffset / -iBounce) * 80));\r\n                    } else if (iTarget > iMaxPX) {\r\n                        aniScroll.call(that, iMaxPX - oV.iScrollOffsetPx, (((iOffset - iMaxPX) / iBounce) * 80));\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //\r\n        //  Handles the touch end and initiates scroll animations if needed.\r\n        //\r\n        function touchEnd(oEv) {\r\n            // console.log(iAuto + ':touchEnd');\r\n\r\n            if (bPointer) {\r\n                df.dom.off(\"pointerup\", document, touchEnd, this);\r\n                df.dom.off(\"pointercancel\", document, touchEnd, this);\r\n                df.dom.off(\"pointermove\", document, touchMove, this);\r\n            } else {\r\n                df.dom.off(\"touchend\", document, touchEnd, this);\r\n                df.dom.off(\"touchcancel\", document, touchEnd, this);\r\n                df.dom.off(\"touchmove\", document, touchMove, this);\r\n            }\r\n\r\n            clearInterval(tTracker);\r\n            if (bSwipe) {\r\n                this.swipeRowEnd();\r\n            }\r\n\r\n            if (bScrollable) {\r\n                //  Animate going back when outside of boundaries\r\n                if (oV.iScrollOffsetPx < 0) {\r\n                    aniScroll.call(this, -oV.iScrollOffsetPx, ((oV.iScrollOffsetPx / -iBounce) * 80));\r\n                } else if (oV.iScrollOffsetPx > iMaxPX) {\r\n                    aniScroll.call(this, iMaxPX - oV.iScrollOffsetPx, (((oV.iScrollOffsetPx - iMaxPX) / iBounce) * 80));\r\n                } else if (!bSwipe) {\r\n                    //  Determine if there is enough energy to do a kinetic scroll\r\n                    if (iVelocity > 10 || iVelocity < -10) {\r\n                        //  Calculate amplitude and target\r\n                        iAmplitude = 1.9 * iVelocity;\r\n                        iTarget = Math.round(oV.iScrollOffsetPx + iAmplitude);\r\n\r\n                        //  Round target on a full row (only if inside the boundaries, else it will round to the limit which we do not want here)\r\n                        if (iTarget > 0 && iTarget < iMaxPX) {\r\n                            iTarget = oV.snapToRow(iTarget);\r\n                        }\r\n\r\n                        iTimestamp = Date.now();\r\n                        //console.log(iAuto + \":touchEnd autoscroll  iTarget:\" + iTarget + \" iAmplitude: \" + iAmplitude + \" oV.iScrollOFsetPx:\" + oV.iScrollOffsetPx);\r\n                        df.dom.animFrame(autoScroll, this);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (Math.abs(iPrevY - iStartY) > 15 || Math.abs(iPrevX - iStartX) > 15) {\r\n                //  Explicitly block click using bCancelClick if scrolling from a pointer as stopping the event won't stop the click event (Windows)\r\n                if (bPointer) {\r\n                    oV.bCancelClick = true;\r\n                    setTimeout(function () {\r\n                        oV.bCancelClick = false;\r\n                    }, 200);\r\n                }\r\n            }\r\n        }\r\n\r\n        function aniScroll(iDelta, iLengthMS) {\r\n            const oV = this.oV; \r\n            let iFrom, tStart, tEnd;\r\n\r\n            // t: current time, b: begInnIng value, c: change In value, d: duration\r\n            function easeInOutSine(t, b, c, d) {\r\n                return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\r\n            }\r\n\r\n            // console.log(iAuto + \":aniScroll(iDelta : \" + iDelta + \", iLengthMS : \" + iLengthMS + \")\");\r\n\r\n            function animate() {\r\n                var tCur, iStep;\r\n\r\n                if (oV.iAutoScroll === iAuto) {\r\n                    tCur = Math.min(Date.now(), tEnd);\r\n\r\n                    iStep = easeInOutSine(tCur - tStart, iFrom, iDelta, tEnd - tStart);\r\n\r\n                    // console.log(iAuto + \":animate(iStep : \" + iStep + \" iFrom: \" + iFrom + \" iDelta: \" + iDelta );\r\n\r\n                    oV.scrollTo(iStep, false, false, true);\r\n\r\n                    if (tCur < tEnd && (iStep > 0.5 || iStep < 0.5)) {\r\n                        df.dom.animFrame(animate, this);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            if (iDelta !== 0) {\r\n                iFrom = oV.iScrollOffsetPx;\r\n\r\n                tStart = Date.now();\r\n                tEnd = tStart + iLengthMS;\r\n\r\n\r\n                animate();\r\n            }\r\n        };\r\n\r\n        //\r\n        //  The tracker is executed on an interval and calculates the velocity based on the changed touch position.\r\n        //\r\n        function track() {\r\n\r\n            //  Update administration\r\n            const iNow = Date.now();\r\n            const iElapsed = iNow - iTimestamp;\r\n            iTimestamp = iNow;\r\n            const iDelta = iFrame - iY;\r\n            iFrame = iY;\r\n\r\n            //  Update velocity\r\n            const v = 500 * iDelta / (1 + iElapsed);\r\n            iVelocity = 0.8 * v + 0.2 * iVelocity;  //  Use the previous velocity to smoothen excesses\r\n\r\n            // console.log(iAuto + \":track    iFrame:\" + iFrame + \" iDelta:\" + iDelta + \" iElapsed:\" + iElapsed + \" iVelocity:\" + iVelocity);\r\n        }\r\n\r\n        if (bPointer) {\r\n            df.dom.on(\"pointerup\", document, touchEnd, this);\r\n            df.dom.on(\"pointercancel\", document, touchEnd, this);\r\n            df.dom.on(\"pointermove\", document, touchMove, this);\r\n\r\n        } else {\r\n            df.dom.on(\"touchend\", document, touchEnd, this);\r\n            df.dom.on(\"touchcancel\", document, touchEnd, this);\r\n            df.dom.on(\"touchmove\", document, touchMove, this);\r\n\r\n        }\r\n        tTracker = setInterval(track, 50);\r\n\r\n        setTimeout(function () {\r\n            bSwipeFixed = true;\r\n        }, 300);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    /* \r\n    Simulates a full swipe left. This is used by the keyboard input initiated by WebListController.\r\n    */\r\n    showSwipeLeft() {\r\n        const eElem = this.oV.currentRowElem();\r\n        let iOffset;\r\n\r\n        if (eElem) {\r\n            if (this.swipeStart(eElem)) {\r\n                if (this.eSwipeRow && !this.eSwipeRowStart && this.iSwipeOffset < 0) {\r\n                    this.swipeRowClose(this.eSwipeRow);\r\n                    return true;\r\n                }\r\n\r\n                if (this.eSwipeRowStart) {\r\n                    if (this.eSwipeRow && this.eSwipeRow !== this.eSwipeRowStart) {\r\n                        this.swipeRowClose(this.eSwipeRow);\r\n                    }\r\n                    this.eSwipeRow = this.eSwipeRowStart;\r\n                    this.eSwipeRowStart = null;\r\n                }\r\n\r\n                if (!this.eSwipeLeftBtns && !this.eSwipeRightBtns) {\r\n                    this.initSwipeRow();\r\n                }\r\n\r\n                if (this.eSwipeLeftBtns) {\r\n                    if (this.iSwipeStartOffset < 0) {\r\n                        iOffset = 0;\r\n                    } else {\r\n                        iOffset = this.eSwipeLeftBtns.offsetWidth;\r\n                    }\r\n                    this.swipeAniOffset(this.eSwipeRow, iOffset);\r\n\r\n                    return true;\r\n                }\r\n\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    Simulates a full swipe right. This is used by the keyboard input initiated by WebListController.\r\n    */\r\n    showSwipeRight() {\r\n        const eElem = this.oV.currentRowElem();\r\n        let iOffset;\r\n\r\n        if (eElem) {\r\n            if (this.swipeStart(eElem)) {\r\n                if (this.eSwipeRow && !this.eSwipeRowStart && this.iSwipeOffset > 0) {\r\n                    this.swipeRowClose(this.eSwipeRow);\r\n                    return true;\r\n                }\r\n\r\n                if (this.eSwipeRowStart) {\r\n                    if (this.eSwipeRow && this.eSwipeRow !== this.eSwipeRowStart) {\r\n                        this.swipeRowClose(this.eSwipeRow);\r\n                    }\r\n                    this.eSwipeRow = this.eSwipeRowStart;\r\n                    this.eSwipeRowStart = null;\r\n                }\r\n\r\n                if (!this.eSwipeLeftBtns && !this.eSwipeRightBtns) {\r\n                    this.initSwipeRow();\r\n                }\r\n\r\n                if (this.eSwipeRightBtns) {\r\n                    if (this.iSwipeStartOffset > 0) {\r\n                        iOffset = 0;\r\n                    } else {\r\n                        iOffset = -this.eSwipeRightBtns.offsetWidth;\r\n                    }\r\n                    this.swipeAniOffset(this.eSwipeRow, iOffset);\r\n\r\n                    return true;\r\n                }\r\n\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    Called when the user starts swiping (ontouchstart) to initialize the button swiping. It determines \r\n    if there are swipe buttons (enabling the detection for horizontal swiping.\r\n    \r\n    @param  eElem   DOM element on which swiping started.\r\n    @return     True if there are active swipe buttons for this row.\r\n    */\r\n    swipeStart(eElem) {\r\n        const oL = this.oL, oV = this.oV, oM = this.oM;\r\n        let bFound = false;\r\n\r\n        //  Determine swipe row\r\n        while (eElem && eElem !== oV.eBody) {\r\n            //  Check if we found the tr element and if it is part of the table\r\n            if (eElem.tagName === \"TABLE\" && eElem.hasAttribute(\"data-dfisrow\")) {\r\n                bFound = true;\r\n                break;\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        if (bFound) {\r\n            this.iSwipeStartOffset = 0;\r\n            if (this.eSwipeRow) {\r\n                if (this.eSwipeRow === eElem) { // We are swiping the already opened row\r\n                    this.iSwipeStartOffset = this.iSwipeOffset;\r\n                    return true;\r\n                }\r\n            }\r\n\r\n\r\n\r\n            const iRow = oM.rowIndexByRowId(eElem.getAttribute(\"data-dfrowid\"));\r\n            const tRow = oM.aData[iRow];\r\n\r\n            for (let iBtn = 0; iBtn < oL._aSwipeBtns.length; iBtn++) {\r\n                const oBtn = oL._aSwipeBtns[iBtn];\r\n                const tCell = tRow.aCells[oBtn._iColIndex];\r\n\r\n                if (oBtn.isVisible(tCell)) {\r\n                    this.eSwipeRowStart = eElem;\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            this.eSwipeRowStart = null;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    initSwipeRow() {\r\n        let eLeft, eRight, aHtml, bRight = false, bLeft = false;\r\n        const eRow = this.eSwipeRow, oM = this.oM, oL = this.oL;\r\n\r\n        if (eRow) {\r\n            //  Initialize swipe data\r\n            const iRow = oM.rowIndexByRowId(eRow.getAttribute(\"data-dfrowid\"));\r\n            const tRow = oM.aData[iRow];\r\n\r\n            const aLeftHtml = ['<table data-dfrowid=\"', (tRow ? tRow.sRowId : \"empty\"), '\" class=\"WebList_SwipeBtns WebList_SwipeBtnsLeft\"><tr>'];\r\n            const aRightHtml = ['<table data-dfrowid=\"', (tRow ? tRow.sRowId : \"empty\"), '\" class=\"WebList_SwipeBtns WebList_SwipeBtnsRight\"><tr>'];\r\n\r\n            //  Loop buttons and generate html\r\n            for (let iBtn = 0; iBtn < oL._aSwipeBtns.length; iBtn++) {\r\n                const oBtn = oL._aSwipeBtns[iBtn];\r\n                const tCell = tRow.aCells[oBtn._iColIndex];\r\n\r\n                if (oBtn.isVisible(tCell)) {\r\n                    if (oBtn.pbPositionLeft) {\r\n                        aHtml = aLeftHtml;\r\n                        bLeft = true;\r\n                    } else {\r\n                        aHtml = aRightHtml;\r\n                        bRight = true;\r\n                    }\r\n                    aHtml.push('<td data-dfswbtn=\"', iBtn, '\" class=\"WebList_SwipeBtn ', oBtn.psCSSClass, ' ', tCell.sCssClassName, '\" style=\"');\r\n\r\n                    if (oBtn.piWidth > 0) {\r\n                        aHtml.push('width: ', oBtn.piWidth, 'px; ');\r\n                    }\r\n                    aHtml.push('height: ', eRow.offsetHeight, 'px\">', oBtn.btnHtml(tCell), '</td>');\r\n                }\r\n            }\r\n\r\n            aLeftHtml.push('</tr></table>');\r\n            aRightHtml.push('</tr></table>');\r\n\r\n            //  Generate elements\r\n            if (bLeft) {\r\n                this.eSwipeLeftBtns = eLeft = df.dom.create(aLeftHtml.join(''));\r\n                eRow.parentNode.insertBefore(eLeft, eRow);\r\n            }\r\n            if (bRight) {\r\n                this.eSwipeRightBtns = eRight = df.dom.create(aRightHtml.join(''));\r\n                eRow.parentNode.insertBefore(eRight, eRow);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called during the horizontal swipe operation to update the offset (ontouchemove). If the buttons are \r\n    not rendered it will do that and it will update the horizontal position of the swipe row.\r\n    \r\n    @param  iDiffX  The number of horizontal pixels moved relative to the swipe starting point.\r\n    */\r\n    swipeRow(eElem, iDiffX) {\r\n        let iOffset, iMin = 0, iMax = 0;\r\n\r\n        // df.debug(\"swipeRow: \"  + iDiffX);\r\n\r\n        //  If this is the first actual swipe operation on a touched row, so now we close an already opened row and make the start row the swipe\r\n        if (this.eSwipeRowStart) {\r\n            if (this.eSwipeRow) {\r\n                this.swipeRowClose(this.eSwipeRow);\r\n            }\r\n            this.eSwipeRow = this.eSwipeRowStart;\r\n            this.eSwipeRowStart = null;\r\n        }\r\n\r\n        if (this.eSwipeRow) {\r\n            if (!this.eSwipeLeftBtns && !this.eSwipeRightBtns) {\r\n                this.initSwipeRow();\r\n            }\r\n\r\n            if (this.eSwipeLeftBtns) {\r\n                iMax = this.eSwipeLeftBtns.offsetWidth;\r\n            }\r\n            if (this.eSwipeRightBtns) {\r\n                iMin -= this.eSwipeRightBtns.offsetWidth;\r\n            }\r\n\r\n            this.iSwipeOffset = iOffset = Math.max(Math.min(this.iSwipeStartOffset - iDiffX, iMax), iMin);\r\n            df.dom.translateX(this.eSwipeRow, iOffset, false);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called when the swipe operation is cancelled (the swipe action turned out to be vertical instead of \r\n    horizontal).\r\n    */\r\n    swipeRowCancel() {\r\n        if (this.eSwipeRow) {\r\n            this.swipeRowClose(this.eSwipeRow);\r\n            this.eSwipeRow = null;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Closes a swipe row (removes buttons scrolls back to 0).\r\n    \r\n    @param  eRow    Swipe row to close (we do assume the left and right buttons are in the properties).\r\n     */\r\n    swipeRowClose(eRow) {\r\n        const eLeft = this.eSwipeLeftBtns;\r\n        const eRight = this.eSwipeRightBtns;\r\n\r\n        this.swipeAniOffset(eRow, 0, function finish() {\r\n            if (eLeft) {\r\n                if (eLeft.parentNode) {\r\n                    eLeft.parentNode.removeChild(eLeft);\r\n                }\r\n            }\r\n            if (eRight) {\r\n                if (eRight.parentNode) {\r\n                    eRight.parentNode.removeChild(eRight);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.eSwipeLeftBtns = null;\r\n        this.eSwipeRightBtns = null;\r\n    }\r\n\r\n    /* \r\n    Called when the touch operation is finished (OnTouchEnd) and makes sure we always end up with fully \r\n    opened or fully closed buttons depending on the swipe direction and position.\r\n    */\r\n    swipeRowEnd() {\r\n        let iOffset = this.iSwipeOffset;\r\n\r\n        if (this.eSwipeRow) {\r\n            if (this.iSwipeOffset > this.iSwipeStartOffset) {\r\n                if (this.iSwipeOffset > 0) {\r\n                    iOffset = this.eSwipeLeftBtns.offsetWidth;\r\n                } else {\r\n                    iOffset = 0;\r\n                }\r\n            } else {\r\n                if (this.iSwipeOffset < 0) {\r\n                    iOffset = 0 - this.eSwipeRightBtns.offsetWidth;\r\n                } else {\r\n                    iOffset = 0;\r\n                }\r\n            }\r\n\r\n            if (iOffset === 0) {\r\n                this.swipeRowClose(this.eSwipeRow);\r\n                this.eSwipeRow = null;\r\n            } else {\r\n                this.swipeAniOffset(this.eSwipeRow, iOffset);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Animates the horizontal movement while closing or opening of a swipe row using a CSS transition.\r\n    \r\n    @param  eRow    The row to animate.\r\n    @param  iOffset The offset to animate towards.\r\n    @param  fFinish Function called after animation.\r\n    */\r\n    swipeAniOffset(eRow, iOffset, fFinish) {\r\n        df.dom.transition(eRow, \"all 200ms\", fFinish, this);\r\n        df.dom.translateX(eRow, iOffset);\r\n\r\n        this.iSwipeOffset = iOffset;\r\n    }\r\n\r\n    /* \r\n    Called by the onTableClick handler when a swipe button is clicked. Determines the row, sets the \r\n    Active class, selects the row and triggers the click on the button object.\r\n    \r\n    @param  oEv  DOM Event for the click.\r\n    @param  eElem   The target element (td data-dfswbtn).\r\n     */\r\n    swipeBtnClick(oEv, eElem) {\r\n        const oL = this.oL, oM = this.oM, eRow = this.eSwipeRow; \r\n        let eBtn = eElem, sRowId = null;\r\n\r\n        while (eElem && eElem !== this.oV.eBody) {\r\n            //  Check if we found the tr element and if it is part of the table\r\n            if (eElem.tagName === \"TABLE\" && eElem.hasAttribute(\"data-dfrowid\")) {\r\n                sRowId = eElem.getAttribute(\"data-dfrowid\");\r\n                break;\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        if (sRowId) {\r\n            const iRow = oM.rowIndexByRowId(sRowId);\r\n\r\n            if (iRow >= 0) {\r\n                //  Perform the rowchange\r\n                this.oC.selectRow(\"row\", iRow);\r\n\r\n                //  Notify column of (after)click\r\n                df.dom.addClass(eBtn, \"WebCon_Active\");\r\n                oL._aSwipeBtns[eBtn.getAttribute(\"data-dfswbtn\")].btnClick(oEv, oM.aData[iRow].sRowId, function (oEv) {\r\n                    df.dom.removeClass(eBtn, \"WebCon_Active\");\r\n                    this.swipeRowClose(eRow);\r\n                    oL.focus();\r\n                }, this);\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n","import { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebListPlaceHolderView\r\n\r\nView within the WebList its mini MVC model that shows the placeholder if there is no data shown. It \r\nlistens to the onDataUpdate of the model and onSettingChange of the WebList to determine if it \r\nshould show.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\nexport class WebListPlaceHolderView {\r\n    constructor(oList, oModel) {\r\n        this.oL = oList;\r\n        this.oM = oModel;\r\n\r\n        this.eElem = null;\r\n\r\n        oModel.onDataUpdate.on(this.onDataUpdate, this);\r\n        oList._onSettingChange.on(this.onSettingChange, this);\r\n    }\r\n\r\n    genHtml(aHtml) {\r\n        const oL = this.oL;\r\n\r\n        aHtml.push('<div class=\"WebList_PlaceHolder\"', (oL.psPlaceHolder && this.oM.aData.length === 0 ? '' : ' style=\"display: none\"'), '>', df.dom.encodeHtml(oL.psPlaceHolder), '</div>');\r\n    }\r\n\r\n    afterRender(eList) {\r\n        this.eElem = df.dom.query(eList, \"div.WebList_PlaceHolder\");\r\n    }\r\n\r\n\r\n    onDataUpdate(oEv) {\r\n        if (this.oL.psPlaceHolder && this.eElem) {\r\n            this.eElem.style.display = (this.oM.aData.length === 0 ? '' : 'none');\r\n        }\r\n    }\r\n\r\n    onSettingChange(oEv) {\r\n        const oL = this.oL;\r\n\r\n        if (this.eElem && oEv.sType === \"prop\" && oEv.sProp === \"psPlaceHolder\") {\r\n            if (!oL.psPlaceHolder) {\r\n                this.eElem.style.display = \"none\";\r\n            } else {\r\n                df.dom.setText(this.eElem, oL.psPlaceHolder);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n};","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebListView } from './WebListView.js';\r\nimport { WebListScrollingView } from './WebListScrollingView.js';\r\nimport { WebListPagedModel } from './WebListPagedModel.js';\r\nimport { WebListController } from './WebListController.js';\r\nimport { WebListGroupController } from './weblist/WebListGroupController.js';\r\nimport { WebListRowModel } from './WebListRowModel.js';\r\nimport { WebListHeaderView } from './WebListHeaderView.js';\r\nimport { WebListFooterView } from './WebListFooterView.js';\r\nimport { WebListTouchHandler } from './WebListTouchHandler.js';\r\nimport { WebListPlaceHolderView } from './WebListPlaceHolderView.js';\r\nimport { WebListModel } from './WebListModel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebList\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the cWebList control which shows a multi column list of \r\ndata. The nested cWebColumn objects represent the grid columns. The cWebCheckboxColumn and \r\ncWebComboColumn classes will represent different types of columns. The cWebList is readonly and only \r\nallows the users to select a row. The cWebList can be data bound and then it will automatically find \r\nrecords.\r\n\r\nThe control is implemented using a MVC strategy where there are several views, a model and a \r\ncontroller. The following classes are part of this system:\r\ndf.WebList\r\n    - Handles communication with the server.\r\n    - Model for the server settings (properties, columns).\r\ndf.WebListModel\r\n    - Model for the list data (all data is loaded at once).\r\ndf.WebListPagedModel\r\n    - Model for paged list data (loads data in chunks from the server).\r\ndf.WebListView\r\n    - Main view showing the list of data that does not support scrolling.\r\ndf.WebListScrollingView\r\n    - Extends the list view with the scrolling logic.\r\ndf.WebListHeaderView\r\n    - View displaying the header above the list.\r\ndf.WebListController\r\n    - Executes row changes.\r\n    - Executes loading of data pages.\r\ndf.WebListRowModel\r\n    - Maintains the model of a row (multi line rows, row widths) and is capable of rendering a \r\n      single row (used by the View classes).\r\ndf.WebListTouchHandler\r\n    - Implementation of touch scrolling for the WebListScrollingView and swipe buttons.\r\n\r\nCommunication between the classes mainly occurs events (onSettingChange, onDataChange, onRowChange) \r\nthrown by the WebList and the WebListModel. The WebList class (as the API with the server) \r\ncommunicates directly with the controller and the views do communicate with the controller. The \r\ncontroller on its turn manipulates the model which updates the views.\r\n\r\ndf.tWebRow = { \r\n    sRowId : df.tString, \r\n    sCssClassName : df.tString, \r\n    aCells : [ { \r\n        sValue : df.tString,  \r\n        sTooltip : df.tString,\r\n        sCssClassName : df.tString,\r\n        aOptions : [ df.tString ]\r\n    } ] \r\n};\r\n    \r\nRevision:\r\n    2011/12/02  (HW, DAW) \r\n        Initial version.\r\n    2017/02/14  (HW, DAW)\r\n        Refactored into mini MVC model.\r\n*/\r\ndf.cHideColumnCSS = ' style=\"visibility:hidden\"';   //  Used to hide columns with pbVisible (overridden by the designer)\r\n\r\nexport class WebList extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psCurrentRowId\", \"\");\r\n        this.prop(df.tInt, \"piCurrentRowIndex\", -1);\r\n        this.prop(df.tInt, \"piRowCount\", 0);\r\n\r\n        this.prop(df.tBool, \"pbShowHeader\", true);\r\n        this.prop(df.tBool, \"pbShowFooter\", false);\r\n        this.prop(df.tBool, \"pbShowSelected\", true);\r\n\r\n        this.prop(df.tBool, \"pbDataAware\", true);\r\n        this.prop(df.tInt, \"peDbGridType\", df.gtAutomatic);\r\n        this.prop(df.tInt, \"peGrouping\", df.grpDisabled);\r\n        this.prop(df.tBool, \"pbOfflineEditing\", false);\r\n\r\n        this.prop(df.tBool, \"pbAutoSearch\", true);\r\n        this.prop(df.tBool, \"pbColumnSortable\", true);\r\n        this.prop(df.tBool, \"pbReverseOrdering\", true);\r\n        this.prop(df.tInt, \"piSortColumn\", 0);\r\n\r\n        this.prop(df.tInt, \"piMinHeight\", 0);\r\n        this.prop(df.tInt, \"piHeight\", 0);\r\n        this.prop(df.tBool, \"pbColumnsResizable\", true);\r\n        this.prop(df.tBool, \"pbAutoColumnSizing\", true);\r\n\r\n        this.prop(df.tBool, \"pbAllowColumnReordering\", true);\r\n        this.prop(df.tBool, \"pbAllowColumnHiding\", true);\r\n\r\n        this.prop(df.tBool, \"pbStoreColumnLayout\", true);\r\n        this.prop(df.tBool, \"pbStoreGroupConfig\", true);\r\n\r\n        this.prop(df.tString, \"psPlaceHolder\", \"\");\r\n\r\n        this.prop(df.tString, \"psKeyBuddy\", \"\");\r\n\r\n        this.prop(df.tBool, \"pbScroll\", true);\r\n\r\n        this.prop(df.tBool, \"pbGroupsCollapsible\", true);\r\n        this.prop(df.tBool, \"pbGroupsCollapseByDefault\", true);\r\n\r\n        this.event(\"OnRowClick\", df.cCallModeWait);\r\n\r\n        //  Child objects\r\n        this._aColumns = [];\r\n        this._aSwipeBtns = [];\r\n\r\n        //  Modules\r\n        this._oRowRenderer = null;\r\n        this._oModel = null;\r\n        this._oHeader = null;\r\n        this._oBody = null;\r\n        this._oFooter = null;\r\n        this._oTouchHandler = null;\r\n        this._oGrouping = null;\r\n\r\n        //  Privates\r\n        this._iColCount = 0;\r\n        this._tRedraw = null;\r\n        this._bLozingFocus = false;\r\n        this._bScrollQueued = false;\r\n\r\n        this._onSettingChange = new df.events.JSHandler();\r\n        this._onResize = new df.events.JSHandler();\r\n        this._onModulesCreated = new df.events.JSHandler();\r\n        this._onKeyDown = new df.events.JSHandler();\r\n\r\n        this.addSync(\"piCurrentRowIndex\");\r\n        this.addSync(\"psCurrentRowId\");\r\n        this.addSync(\"piRowCount\");\r\n\r\n        //  Actions we need to wait for due to integrety\r\n        this.setActionMode(\"HandleProcessDataSet\", df.cCallModeWait);\r\n        this.setActionMode(\"ChangeCurrentRow\", df.cCallModeWait);\r\n\r\n        this.event(\"OnColumnLayoutChanged\", df.cCallModeDefault);\r\n        this.event(\"OnGroupConfigChanged\", df.cCallModeDefault);\r\n\r\n        this._sControlClass = \"WebList\";\r\n    }\r\n\r\n    /*\r\n    Augmenting the addChild method to filter out columns and the swipe buttons.\r\n    \r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        if (oChild._bIsColumn) {\r\n            oChild._iColIndex = this._iColCount++;\r\n            oChild._iCol = this._aColumns.length;\r\n            this._aColumns.push(oChild);\r\n        }\r\n        if (oChild._bIsSwipeButton) {\r\n            oChild._iColIndex = this._iColCount++;\r\n            this._aSwipeBtns.push(oChild);\r\n        }\r\n\r\n        super.addChild(oChild);\r\n    }\r\n\r\n    /* \r\n    Initializes the modules that make the WebList component.\r\n    */\r\n    create() {\r\n        this.recordColumnMapperDefaults(); // Save the initial defaults for later.\r\n        this.loadLayout(true, false);      // Load any client stored settings but do not draw.\r\n        this.rebuildColumnMapper(false);   // Build the initial mapper but without redraw, that comes later...\r\n\r\n        this._oModel = this.createModel();\r\n        this._oController = this.createController();\r\n\r\n        this._oRowRenderer = this.createRowModel();\r\n\r\n        this._oHeader = this.createHeaderView();\r\n        this._oBody = this.createView();\r\n        this._oFooter = this.createFooterView();\r\n\r\n        this._oTouchHandler = this.createTouchHandler();\r\n\r\n        this._oPlaceHolder = this.createPlaceHolder();\r\n\r\n        this._oGrouping = this.createGrouping();\r\n\r\n        this._oRowRenderer.init();\r\n\r\n        this._onModulesCreated.fire(this);\r\n    }\r\n\r\n    /**\r\n     * Initializes the grouping controller.\r\n     * \r\n     * @returns WebListGroupController instance.\r\n     * @private\r\n     */\r\n    createGrouping() {\r\n        return new WebListGroupController(this, this._oModel, this._oController);\r\n    }\r\n\r\n    /**\r\n     * Called from DataFlex to configure automatic grouping. Grouping config is passed as action data.\r\n     * \r\n     * @param {String} bOverrideDefault True if this should override the grouping loaded from the store.\r\n     * @clientaction\r\n     */\r\n    applyGroupConfig(bOverrideDefault) {\r\n        this._oGrouping?.applyGroupConfig(df.toBool(bOverrideDefault), this._tActionData);\r\n    }\r\n\r\n    /**\r\n     * Called from DataFlex to clear automatic grouping.\r\n     * \r\n     * @clientaction\r\n     */\r\n    clearGroupConfig() {\r\n        this._oGrouping?.clearGrouping();\r\n    }\r\n\r\n    /*\r\n    This function returns the main storage name.\r\n    \r\n    Since a lot DataFlex applications run behind ISS as a directory instead of a subdomain,\r\n    We will take up the host {domain + port} and the pathname {/WebOrder_199} into the name as prefix.\r\n    \r\n    @param sPostFix can be provided as an additional storage specifier and appends to the storage name with @ + value.\r\n    @returns The final storage name of the current WebObject.\r\n    */\r\n    getStorageName(sPostFix) {\r\n        if (sPostFix && sPostFix.length > 0) {\r\n            return window.location.host +\r\n                \".\" + window.location.pathname +\r\n                \".\" + this.getLongName() +\r\n                \"@\" + sPostFix;\r\n        }\r\n\r\n        return window.location.host +\r\n            \".\" + window.location.pathname +\r\n            \".\" + this.getLongName();\r\n    }\r\n\r\n    /*\r\n    This function serializes all columns into its layout equivalents.\r\n    \r\n    It loops through all columns and creates an array of tWebColumnLayout's.\r\n    \r\n    @returns Array of tWebColumnLayout's.\r\n    */\r\n    serializeLayout() {\r\n        const aLayout = [];\r\n\r\n        for (let i = 0; i < this._aColumns.length; i++) {\r\n            let oColLayout = {};\r\n            oColLayout.sObjName = this._aColumns[i].getLongName();\r\n\r\n            oColLayout.bFixed = this._aColumns[i].pbFixedWidth;\r\n            oColLayout.iWidth = this._aColumns[i].piWidth;\r\n\r\n            oColLayout.iPosition = this._aColumns[i].piPosition;\r\n            oColLayout.bHidden = this._aColumns[i].pbHidden;\r\n\r\n            aLayout.push(oColLayout);\r\n        }\r\n\r\n        return aLayout;\r\n    }\r\n\r\n    /*\r\n    loadLayout returns either null or the a stored tWebColumnLayout array that are cached on the client.\r\n    \r\n    !!!This function is ignored if dfdebug=true is specified.!!!\r\n    \r\n    @param bLoadIntoMapper also restores them into the mapper as it sees fit.\r\n    @param bRedraw orders it to visualize the loaded layout afterwards, only works with bLoadIntoMapper on true.\r\n    @returns The stored layout.\r\n    */\r\n    loadLayout(bLoadIntoMapper, bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        let aLayout = null;\r\n        if (this.pbStoreColumnLayout && !df.pbDebugging) {\r\n            const sLayout = localStorage.getItem(this.getStorageName(\"layout\"));\r\n            if (sLayout) {\r\n                try {\r\n                    aLayout = JSON.parse(sLayout);\r\n\r\n                    if (aLayout.length !== this._aColumns.length)\r\n                        return null;\r\n\r\n                    for (let i = 0; i < aLayout.length; i++) {\r\n                        if (aLayout[i].sObjName !== this._aColumns[i].getLongName())\r\n                            return null;\r\n                    }\r\n                } catch (ex) {\r\n                    if (sLayout) { // Remove invalid cache.\r\n                        localStorage.removeItem(this.getStorageName(\"layout\"));\r\n                    }\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            if (aLayout && bLoadIntoMapper) {\r\n                this.restoreColumnMapper(bRedraw, aLayout);\r\n            }\r\n        }\r\n\r\n        return aLayout;\r\n    }\r\n\r\n    /*\r\n    saveLayout stores the provided layout in the client's storage.\r\n    \r\n    !!!This function is ignored if dfdebug=true is specified.!!!\r\n    \r\n    @param aLayout the layout to store (tWebColumnLayout[]).\r\n    */\r\n    saveLayout(aLayout) {\r\n        if (this.pbStoreColumnLayout && !df.pbDebugging) {\r\n            try {\r\n                localStorage.setItem(this.getStorageName(\"layout\"), JSON.stringify(aLayout));\r\n            } catch (ex) {\r\n                // Ignore\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    triggerLayoutChange is thrown when a change is made to the layout.\r\n    \r\n    It saved the layout if the settings allow it and will throw a ColumnLayoutChanged event.\r\n    */\r\n    triggerLayoutChange(hSender) {\r\n        const aLayout = this.serializeLayout();\r\n\r\n        this.saveLayout(aLayout);\r\n\r\n        this.fireEx({\r\n            sEvent: \"OnColumnLayoutChanged\",\r\n            tActionData: aLayout,\r\n            sAltServerName: \"privateOnColumnLayoutChanged\"\r\n        });\r\n    }\r\n\r\n    /*\r\n    This function records the essential defaults for the position, pbRender, pbHidden for the resetting of the layout.\r\n    */\r\n    recordColumnMapperDefaults() {\r\n        this._defaultLayout = this.serializeLayout();\r\n    }\r\n\r\n    /*\r\n    This function restores all defaults of all columns.\r\n    It already updates the mapper for us.\r\n    */\r\n    restoreColumnMapperDefaults() {\r\n        this.restoreColumnMapper(true, this._defaultLayout);\r\n    }\r\n\r\n    /*\r\n    This sets the mapper to the provided layout.\r\n    \r\n    It will set all column settings and redraw if desired.\r\n    If the call is from the server it will use the actionData.\r\n    \r\n    @param bRedraw indicates whether to redraw.\r\n    @param aLayout the layout to restore.\r\n    @actionData optional should the call come from the server, parameter has priority.\r\n    */\r\n    restoreColumnMapper(bRedraw, aLayout) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        // If called from the server, apply the action data.\r\n        if (Array.isArray(this._tActionData) && !Array.isArray(aLayout)) aLayout = this._tActionData;\r\n        if (!Array.isArray(aLayout)) return;\r\n\r\n        // Create a lookup set so that it is O(N) + O(1) instead of O(N^2)\r\n        const lookupSet = [];\r\n        for (let i = 0; i < this._aColumns.length; i++) {\r\n            lookupSet[this._aColumns[i].getLongName()] = this._aColumns[i];\r\n        }\r\n\r\n        try {\r\n            // Set all settings on the looked up ref.\r\n            for (let i = 0; i < aLayout.length; i++) {\r\n                const oColumnRef = lookupSet[aLayout[i].sObjName];\r\n                if (oColumnRef) {\r\n                    oColumnRef.pbFixedWidth = aLayout[i].bFixed;\r\n                    oColumnRef.piWidth = aLayout[i].iWidth;\r\n                    oColumnRef.piPosition = aLayout[i].iPosition;\r\n                    oColumnRef.pbHidden = aLayout[i].bHidden;\r\n                }\r\n            }\r\n\r\n            // Save the layout.\r\n            aLayout = this.serializeLayout();\r\n            this.saveLayout(aLayout);\r\n            // Rebuild but do not redraw.\r\n            this.rebuildColumnMapper(false);\r\n\r\n            if (bRedraw) this.redraw();\r\n        } catch (ex) {\r\n            // If the server messes up or anything with the property names.\r\n            // Ignore it, though this will most likely never happen.\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function recreates the column mapper and should redraw afterwards to take effect.\r\n    It also reorders the piPositions of all columns.\r\n    */\r\n    rebuildColumnMapper(bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        this._aColumnMapper = [];   // Initially contains positioned but unsorted columns.\r\n        const aIndifferent = [];      // Contains all non-positioned columns (piPosition -1).\r\n\r\n        for (let i = 0; i < this._aColumns.length; i++) {\r\n            // Add them to an array based on their position.\r\n            if (this._aColumns[i].piPosition !== -1) {\r\n                this._aColumnMapper.push(this._aColumns[i]);\r\n            } else {\r\n                aIndifferent.push(this._aColumns[i])\r\n            }\r\n        }\r\n\r\n        // Then we are going to sort the positioned array using the built in algorithm.\r\n        this._aColumnMapper.sort(function (a, b) {\r\n            const x = a.piPosition, y = b.piPosition;\r\n            return ((x < y) ? -1 : ((x > y) ? 1 : 0));\r\n        });\r\n\r\n        // Then we fill in the blanks as we have possilibly have some indifferent columns.\r\n        let iIndex = 0;\r\n        if (this._aColumnMapper.length > 0) {\r\n            do {\r\n                if (this._aColumnMapper[iIndex].piPosition !== iIndex) {\r\n                    if (aIndifferent.length > 0) {\r\n                        this._aColumnMapper.splice(iIndex, 0, aIndifferent[0]);\r\n                        aIndifferent.splice(0, 1);\r\n                    }\r\n                    this._aColumnMapper[iIndex].piPosition = iIndex;\r\n                }\r\n\r\n            } while (++iIndex < this._aColumnMapper.length)\r\n        }\r\n\r\n        this._aColumnMapper = this._aColumnMapper.concat(aIndifferent); // Should we have any left? add those as well.\r\n        if (aIndifferent.length > 0) {\r\n            do {\r\n                this._aColumnMapper[iIndex].piPosition = iIndex;\r\n            } while (++iIndex < this._aColumnMapper.length)\r\n        }\r\n\r\n        if (bRedraw) this.redraw();\r\n    }\r\n\r\n    triggerRebuildHeaderMenu() {\r\n        return this._oHeader.refreshColumnList();\r\n    }\r\n\r\n    triggerRestoreColumnLayout(hSender) {\r\n        this.restoreColumnMapperDefaults(true); // Restore and redraw.\r\n        this.triggerLayoutChange(hSender);\r\n    }\r\n\r\n    /* \r\n    Creates the view (body) module. Can be augmented for customization.\r\n    */\r\n    createView() {\r\n        if (this.pbScroll) {\r\n            return new WebListScrollingView(this, this._oModel, this._oController);\r\n        } else {\r\n            return new WebListView(this, this._oModel, this._oController);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Creates the controller module. Can be augmented for customization.\r\n    */\r\n    createController() {\r\n        return new WebListController(this, this._oModel);\r\n    }\r\n\r\n    /* \r\n    Creates the model module. Can be augmented for customization.\r\n    */\r\n    createModel() {\r\n        if (this.peDbGridType === df.gtAllData || this.peDbGridType === df.gtManual || !this.pbDataAware || !this.pbScroll) {\r\n            return new WebListModel(this);\r\n        } else {\r\n            return new WebListPagedModel(this);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Creates the row model module. Can be augmented for customization.\r\n    */\r\n    createRowModel() {\r\n        return new WebListRowModel(this, this._oModel);\r\n    }\r\n\r\n    /*\r\n    Creates the header view module. Can be augmented for customization.\r\n    */\r\n    createHeaderView() {\r\n        return new WebListHeaderView(this, this._oModel, this._oController);\r\n    }\r\n\r\n    /*\r\n    Creates the footer view module. Can be augmented for customization.\r\n    */\r\n    createFooterView() {\r\n        return new WebListFooterView(this, this._oModel, this._oController);\r\n    }\r\n\r\n    /*\r\n    Creates the place holder view module. Can be augmented for customization.\r\n    */\r\n    createPlaceHolder() {\r\n        return new WebListPlaceHolderView(this, this._oModel);\r\n    }\r\n\r\n    /*\r\n    Creates the touch handler module. Can be augmented for customization.\r\n    */\r\n    createTouchHandler() {\r\n        return new WebListTouchHandler(this, this._oBody, this._oModel, this._oController);\r\n    }\r\n\r\n    focusHtml(aHtml){\r\n        aHtml.push('<div class=\"WebList_Focus\" tabindex=\"', (this.isEnabled() ? '0' : '-1'), '\">');\r\n    }\r\n\r\n    openHtml(aHtml, bSkip) {\r\n        super.openHtml(aHtml);\r\n\r\n    \r\n        this.focusHtml(aHtml);\r\n        this._oHeader?.genHtml(aHtml);\r\n        this._oBody?.genHtml(aHtml);\r\n        this._oFooter?.genHtml(aHtml);\r\n        this._oPlaceHolder?.genHtml(aHtml);\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n\r\n        this._eControl = this._eFocus = df.dom.query(this._eElem, 'div.WebList_Focus');\r\n\r\n        \r\n        this._oHeader?.afterRender(this._eElem);\r\n        \r\n        this._oBody?.afterRender(this._eElem);\r\n\r\n        \r\n        this._oFooter?.afterRender(this._eElem);\r\n\r\n        this._oPlaceHolder?.afterRender(this._eElem);\r\n        this._oTouchHandler?.afterRender(this._eElem);\r\n\r\n        super.afterRender();\r\n\r\n        this.updateEnabled();\r\n        \r\n        if(this._eFocus){\r\n            df.dom.on(\"keydown\", this._eFocus, this.onKeyDown, this);\r\n            df.dom.on(\"keypress\", this._eFocus, this.onKeyPress, this);\r\n            df.dom.on(\"click\", this._eElem, this.onListClick, this);\r\n        }\r\n\r\n        //  We set _bRenderChildren to true so that events like afterShow properly reach columns components (needed for previewer as well)\r\n        this._bRenderChildren = true;\r\n\r\n        //  Attach key handler to key buddy control when set\r\n        if (this.psKeyBuddy) {\r\n            const oObj = this.getWebApp().findObj(this.psKeyBuddy);\r\n            if (oObj) {\r\n                if (oObj instanceof WebBaseControl) {\r\n                    this._eKeyBuddy = oObj._eControl;\r\n                }\r\n                if (!this._eKeyBuddy) {\r\n                    this._eKeyBuddy = oObj._eElem;\r\n                }\r\n\r\n                df.events.addDomListener(\"keydown\", this._eKeyBuddy, this.onKeyDown, this);\r\n            }\r\n        }\r\n\r\n        this.dragDropInit();\r\n    }\r\n\r\n    afterRenderChildren() {\r\n\r\n    }\r\n\r\n    /* \r\n    Called by the WebBaseControl sizing logic when the height of the control changes and during i\r\n    nitialization.\r\n    \r\n    @param  iHeight     The height in pixels (0 if it should size naturally).\r\n    @param  bSense      If false the size is expected to not be the final size.\r\n    */\r\n    setHeight(iHeight, bSense) {\r\n        if (this._eControl) {\r\n            //  If a negative value is given we should size 'naturally'\r\n            if (iHeight > 0) {\r\n                iHeight -= this.getVertHeightDiff();\r\n\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height\r\n                this._oBody.setHeight(iHeight);\r\n            } else {\r\n                this._oBody.setHeight(0);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment the add the header height diff.\r\n    \r\n    @return Height difference in pixels.\r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n\r\n        if (this._oHeader) {\r\n            iResult += this._oHeader.offsetHeight();\r\n        }\r\n\r\n        if (this._oFooter) {\r\n            iResult += this._oFooter.offsetHeight();\r\n        }\r\n\r\n        return iResult;\r\n    }\r\n\r\n    resize() {\r\n        this._onResize.fire(this);\r\n\r\n        super.resize();\r\n    }\r\n\r\n    /*\r\n    Handles the keypress event and will initiate the auto search if needed. The keypress is used because \r\n    we need the character code and are not interested in special keys anyway. \r\n    \r\n    @param  oEv  The event object.\r\n    @private\r\n    */\r\n    onKeyPress(oEv) {\r\n        //  Check enabled state\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        return this._oController.keyPress(oEv);\r\n    }\r\n\r\n    /*\r\n    This method handles the keypress event and initiates the actions bound to it. The \r\n    df.settings.listKeys define the exact key code's / combinations for the different actions.\r\n    \r\n    @param  oEv  The event object.\r\n    @return False if we did handle the event and performed an action, true if we didn't do anything.\r\n    */\r\n    onKeyDown(oEv) {\r\n        //  Check enabled state\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        return this._onKeyDown.fire(this, { oDOMEvent: oEv }); //this._oController.keyDown(oEv);    \r\n    }\r\n\r\n    /* \r\n    Augments applyEnabled to set the tabindex attribute of the control element.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        if (this._eFocus) {\r\n            df.dom.setTabIndex(this._eFocus, (bVal ? 0 : -1));\r\n        }\r\n\r\n        super.applyEnabled(bVal);\r\n    }\r\n\r\n    //  - - - - Server API - - - -\r\n\r\n    /*\r\n    \r\n    @client-action\r\n    */\r\n    gridRefresh(bFirst, bLast) {\r\n        const webListData = this._tActionData;\r\n\r\n        //  Cancel row change and row click because we are going to refresh the data set and the row might not exist any more\r\n        this.cancelServerAction(\"ChangeCurrentRow\");\r\n        this.cancelServerAction(\"OnRowClick\");  //  Also cancel onclick as this causes problems because of the assumption that the ChangeCurrentRow has been executed\r\n\r\n        this._oController.handleData(webListData, \"page\", \"\", df.toBool(bFirst), df.toBool(bLast));\r\n    }\r\n\r\n    /*\r\n    This function handles a new page of data and adds it to the cache. Depending on the sType parameter \r\n    it will add or replace the cache. After this it will refresh the display.\r\n    \r\n    @client-action\r\n    */\r\n    handleDataPage(sType, sStartRowId, bFirst, bLast) {\r\n        const webListData = this._tActionData;\r\n\r\n        this._oController.handleData(webListData, sType, sStartRowId, df.toBool(bFirst), df.toBool(bLast));\r\n    }\r\n\r\n    /* \r\n    Called during the row change process.\r\n    \r\n    @param  bVal    True if row change was successful.\r\n    @client-action\r\n    */\r\n    handleRowChange(bVal) {\r\n        this._oController.handleRowChange(bVal);\r\n    }\r\n\r\n    /*\r\n    This method is called by the server to update a single row in the cache or on the display; it is \r\n    usually called after a save. If sRowID is empty then it means that a new row is saved which is added \r\n    to the cache at the last location where a new row was displayed.\r\n    \r\n    @param  sRowID  The original rowid of the row to be updated; empty string if it's a new row.\r\n    \r\n    \r\n    @client-action\r\n    */\r\n    updateRow(sRowId, bMergeRow) {\r\n        const aRows = this.deserializeRows(this._tActionData);\r\n\r\n        if (aRows.length > 0) {\r\n            this._oController.updateRow(sRowId, aRows[0], df.toBool(bMergeRow));\r\n        }\r\n    }\r\n\r\n    /* \r\n    Appends the received row (action data) to the list. Should only be used on non data aware lists.\r\n    \r\n    @client-action\r\n    */\r\n    dataSetAppendRow() {\r\n        const aRows = this.deserializeRows(this._tActionData);\r\n\r\n        if (aRows.length > 0) {\r\n            this._oController.appendRow(aRows[0]);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Inserts the received row (action data) to the list. Should only be used on non data aware lists.\r\n    \r\n    @param  sBeforeRowID    RowID of the row indicating the position where the row should be inserted \r\n                            into the list.\r\n    @client-action\r\n    */\r\n    dataSetInsertRowBefore(sBeforeRowID) {\r\n        const aRows = this.deserializeRows(this._tActionData);\r\n\r\n        if (aRows.length > 0) {\r\n            this._oController.insertBefore(sBeforeRowID, aRows[0]);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Inserts the received row (action data) to the list. Should only be used on non data aware lists.\r\n    \r\n    @param  sAfterRowID    RowID of the row indicating the position where the row should be inserted \r\n                            into the list.\r\n    @client-action\r\n    */\r\n    dataSetInsertRowAfter(sAfterRowID) {\r\n        const aRows = this.deserializeRows(this._tActionData);\r\n\r\n        if (aRows.length > 0) {\r\n            this._oController.insertAfter(sAfterRowID, aRows[0]);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Removes a row from the list. Should only be used on non data aware lists.\r\n    \r\n    @param  sRowID  RowID indicating which row to remove.\r\n    @client-action\r\n    */\r\n    dataSetRemoveRow(sRowId) {\r\n        this._oController.removeRow(sRowId);\r\n    }\r\n\r\n    /* \r\n    Updates a row in the list based on the row passed in the action data.\r\n    \r\n    @param  sRowID  RowID indicating which row needs to be updated.\r\n    @client-action\r\n    */\r\n    dataSetUpdateRow(sRowID) {\r\n        const aRows = this.deserializeRows(this._tActionData);\r\n\r\n        if (aRows.length > 0) {\r\n            this._oController.updateRow(aRows[0].sRowId, aRows[0]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    This method is called by the server to update the cache when a row is deleted. It removes the row \r\n    from the cache and updates the display.\r\n    \r\n    @param  sRowID   The unique ID of the row that is deleted.\r\n    \r\n    @client-action\r\n    */\r\n    removeRow(sRowId) {\r\n        this._oController.removeRow(sRowId);\r\n    }\r\n\r\n    /*\r\n    Augment the processDataSet function so that it copies data from the DEOs to the cache before \r\n    sending the data to the server.\r\n    \r\n    @client-action\r\n    */\r\n    processDataSet(eOperation) {\r\n        this._oController.processDataSet(eOperation);\r\n    }\r\n\r\n    /*\r\n    Scrolls to the first record and selects it. It is called by the keyboard handler or from the server. \r\n    In case of a static grid it will directly call the selectRow function to select the first row, for a \r\n    non-static grid (pbDataAware is true or peDbGridType is not gtAutomatic) it will always refresh the \r\n    cache by loading the first page of records. Note that when pbOfflineEditing is true we need to load \r\n    the first cache page before changing rows.\r\n    \r\n    @client-action\r\n    */\r\n    moveToFirstRow() {\r\n        this._oController.moveToFirstRow();\r\n    }\r\n\r\n    /*\r\n    Scrolls to the last record and selects it. It is called by the keyboard handler or from the server. \r\n    In case of a static grid it will directly call the selectRow function to select the last row, for a \r\n    non-static grid (pbDataAware is true or peDbGridType is not gtAutomatic) it will always refresh the \r\n    cache by loading the last page of records. Note that when pbOfflineEditing is true we need to load \r\n    the last cache page before changing rows.\r\n    \r\n    @client-action\r\n    */\r\n    moveToLastRow() {\r\n        this._oController.moveToLastRow();\r\n    }\r\n\r\n    /*\r\n    This method selects the next row available in the cache and returns true if successful. It is called \r\n    by the key handler or the server.\r\n    \r\n    @return True if a next row is available.\r\n    @client-action\r\n    */\r\n    moveDownRow() {\r\n        this._oController.moveDownRow();\r\n    }\r\n\r\n    /*\r\n    This method selects the previous row available in the cache and returns true if successful. It is \r\n    called by the key handler or the server.\r\n    \r\n    @return True if a previous row is available.\r\n    @client-action\r\n    */\r\n    moveUpRow() {\r\n        this._oController.moveUpRow();\r\n    }\r\n\r\n    /*\r\n    This method performs a page down which means that it select the record one page down in the cache \r\n    and scrolls to it. A page in this context means the amount of rows that fit inside the grid view. It \r\n    is called by the key handler or the server.\r\n    \r\n    @client-action\r\n    */\r\n    movePageDown() {\r\n        this._oController.movePageDown();\r\n    }\r\n\r\n    /*\r\n    This method performs a page up which means that it select the record one page up in the cache and \r\n    scrolls to it. A page in this context means the amount of rows that fit inside the grid view. It is \r\n    called by the key handler or the server.\r\n    \r\n    @client-action\r\n    */\r\n    movePageUp() {\r\n        this._oController.movePageUp();\r\n    }\r\n\r\n    /*\r\n    This method moves to a specific row based on its row index.\r\n    \r\n    @client-action\r\n    */\r\n    moveToRow(iRowIndex) {\r\n        this._oController.moveToRow(iRowIndex);\r\n    }\r\n\r\n    /*\r\n    This method moves to a specific row based on its unique row ID.\r\n    \r\n    @client-action\r\n    */\r\n    moveToRowByID(sRowId) {\r\n        this._oController.moveToRowByID(sRowId);\r\n    }\r\n\r\n    /* \r\n    This method scrolls horizontally to make sure a column is visible.\r\n    \r\n    @param  iCol    Column index.\r\n    @client-action\r\n    */\r\n    scrollToCol(iCol) {\r\n        if (this.pbScroll && this._oBody) {\r\n            this._oBody.scrollToCol(iCol);\r\n        }\r\n    }\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    search(sSearch) {\r\n        this._oController.search(sSearch);\r\n    }\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    showSearch(sSearch) {\r\n        this._oController.showSearch(sSearch);\r\n    }\r\n\r\n    expandAllGroups() {\r\n        this._oGrouping?.expandAll();\r\n    }\r\n\r\n    collapseAllGroups() {\r\n        this._oGrouping?.collapseAll();\r\n    }\r\n\r\n    set_psCurrentRowId(sVal) {\r\n        if (this._oController) {\r\n            this._oController.setCurrentRowId(sVal);\r\n        }\r\n    }\r\n\r\n    set_pbAllowColumnReordering(bVal) {\r\n        if (this.pbAllowColumnReordering !== bVal) {\r\n            this._oHeader.setColumnReordering(this.pbAllowColumnReordering = bVal);\r\n        }\r\n    }\r\n\r\n    set_pbAllowColumnHiding(bVal) {\r\n        if (this.pbAllowColumnHiding !== bVal) {\r\n            this._oHeader.setColumnHiding(this.pbAllowColumnHiding = bVal);\r\n        }\r\n    }\r\n\r\n    get_psCurrentRowId() {\r\n        return this.currentRowId();\r\n    }\r\n    get_piRowCount() {\r\n        return (this._oModel && this._oModel.aData.length) || 0;\r\n    }\r\n    get_piCurrentRowIndex() {\r\n        return (this._oModel && this._oModel.iCurrentRow);\r\n    }\r\n\r\n    set_piSortColumn(iVal) {\r\n        this.propertyUpdate(\"piSortColumn\", iVal);\r\n    }\r\n    set_pbReverseOrdering(bVal) {\r\n        this.propertyUpdate(\"pbReverseOrdering\", bVal);\r\n    }\r\n    set_psPlaceHolder(bVal) {\r\n        this.propertyUpdate(\"psPlaceHolder\", bVal);\r\n    }\r\n    set_pbShowHeader(bVal) {\r\n        this.propertyUpdate(\"pbShowHeader\", bVal);\r\n    }\r\n    set_pbShowFooter(bVal) {\r\n        this.propertyUpdate(\"pbShowFooter\", bVal);\r\n    }\r\n    set_pbShowSelected(bVal) {\r\n        this.propertyUpdate(\"pbShowSelected\", bVal);\r\n    }\r\n    set_pbColumnsResizable(bVal) {\r\n        this.propertyUpdate(\"pbColumnsResizable\", bVal);\r\n    }\r\n    set_pbAutoColumnSizing(bVal) {\r\n        this.propertyUpdate(\"pbAutoColumnSizing\", bVal);\r\n        this.redraw();\r\n    }\r\n    set_pbGroupsCollapsible(bVal) {\r\n        this.propertyUpdate(\"pbGroupsCollapsible\", bVal);\r\n    }\r\n    set_pbGroupsCollapseByDefault(bVal) {\r\n        this.propertyUpdate(\"pbGroupsCollapseByDefault\", bVal);\r\n    }\r\n\r\n    // - - - - Supportive - - - -\r\n\r\n    /* \r\n    Handles the update of a property by triggering onSettingChange so the modules can respond to the \r\n    change. It first stores the new values.\r\n    \r\n    @param  sProp   Name of the property.\r\n    @param  val     The new value.\r\n    */\r\n    propertyUpdate(sProp, val) {\r\n\r\n        if (this[sProp] !== val) {\r\n            const prev = this[sProp];\r\n            this[sProp] = val;\r\n            this._onSettingChange.fire(this, {\r\n                sType: \"prop\",\r\n                sProp: sProp,\r\n                newval: val,\r\n                prevval: prev\r\n            });\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called by the column object when its psValue is being updated.\r\n    \r\n    \r\n    @param  oCol    The column object.\r\n    @param  sVal    The new value.\r\n    */\r\n    updateCurrentCell(oCol, sVal) {\r\n        this._oController.updateCell(oCol, sVal);\r\n    }\r\n\r\n    /* \r\n    Function that is called mainly by columns if their properties have changed. Forces a full redraw of \r\n    the grid after a short timeout. This timeout is added so that call handlers (like HandleChangeRow) \r\n    are not disturbed.\r\n    */\r\n    redraw() {\r\n        const that = this;\r\n\r\n        if (this._tRedraw) {\r\n            clearTimeout(this._tRedraw);\r\n        }\r\n\r\n        this._tRedraw = setTimeout(function () {\r\n            that._onSettingChange.fire(that, {\r\n                sType: \"prepare-redraw\"\r\n            });\r\n            that._onSettingChange.fire(that, {\r\n                sType: \"redraw\"\r\n            });\r\n\r\n            that._tRedraw = null;\r\n        }, 10);\r\n    }\r\n\r\n    /*\r\n    On destroy we clear any timeouts to prevent errors.\r\n    */\r\n    destroy(){\r\n        super.destroy();\r\n\r\n        if(this._tRedraw){\r\n            clearTimeout(this._tRedraw);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Inserts a single object (and its children) into the child structure of this object, \r\n    at a specific index.\r\n    */\r\n    insertChild(oChild, iIndex) {\r\n        if (oChild._bIsColumn) {\r\n            oChild._iColIndex = this._iColCount++;\r\n            oChild._iCol = this._aColumns.length;\r\n            this._aColumns.splice(iIndex, 0, oChild);\r\n        }\r\n        if (oChild._bIsSwipeButton) {\r\n            oChild._iColIndex = this._iColCount++;\r\n            this._aSwipeBtns.splice(iIndex, 0, oChild);\r\n        }\r\n\r\n        super.insertChild(oChild, iIndex);\r\n    }\r\n\r\n    /*\r\n    Renders a specific child object. \r\n    eOptChild is an optional parameter that contains an existing DOM object for this web object.\r\n    */\r\n    renderChild(oChild, eOptChild) {\r\n        this.redraw();\r\n        super.renderChild(oChild, eOptChild);\r\n    }\r\n\r\n    /*\r\n    Removes a child object from the parent's list of children.\r\n    */\r\n    removeChild(oChild) {\r\n        const iIndex = this._aChildren.indexOf(oChild);\r\n\r\n        if (oChild._bIsColumn) {\r\n            oChild._iColIndex = this._iColCount--;\r\n            oChild._iCol = this._aColumns.length;\r\n            this._aColumns.splice(iIndex, 1);\r\n        }\r\n        if (oChild._bIsSwipeButton) {\r\n            oChild._iColIndex = this._iColCount--;\r\n            this._aSwipeBtns.splice(iIndex, 1);\r\n        }\r\n\r\n        super.removeChild(oChild);\r\n    }\r\n\r\n    /* \r\n    Unrenders a child object.\r\n    */\r\n    unrenderChild(oChild) {\r\n        this.redraw();\r\n        super.unrenderChild(oChild);\r\n    }\r\n\r\n    /* \r\n    Finds the cell element that belongs to this column for the current row.\r\n    \r\n    @param  oCol    Column object (df.WebColumn).\r\n    @return DOM element (TD) for the column (null if not found / available).\r\n    */\r\n    getColCell(oCol) {\r\n        return this._oBody.colCell(oCol);\r\n    }\r\n\r\n    /* \r\n    Finds the header cell for the specified column.\r\n    \r\n    @param  oCol    Column object (df.WebColumn).\r\n    @return DOM element (TH) for the column header (null if not found / available).\r\n    */\r\n    getColHead(oCol) {\r\n        return this._oHeader.colCell(oCol);\r\n    }\r\n\r\n\r\n    /* \r\n    Finds the cell element for the specified row and column.\r\n    \r\n    @param  iRow    Row number for which we want the cell element.\r\n    @param  iCol    Column number for the cell.\r\n    @return DOM element (TD) for the column (null if not found / available).\r\n    */\r\n    getCell(iRow, iCol) {\r\n        const sRowId = this._oModel.rowIdByRowIndex(iRow);\r\n\r\n        return this._oBody.cell(sRowId, iCol);\r\n    }\r\n\r\n    currentRowId() {\r\n        return (this._oModel && this._oModel.sCurrentRowId) || \"\";\r\n    }\r\n\r\n    // - - - - - - - Focus - - - - - - -\r\n    /*\r\n    We override the focus method and make it give the focus to the hidden focus holder element.\r\n    \r\n    @return True if the List can take the focus.\r\n    */\r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eFocus) {\r\n            this._eFocus.focus();\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    onListClick(oEv) {\r\n        this.focus();\r\n    }\r\n\r\n    onFocus(oEvent) {\r\n        if (!this._bHasFocus) {\r\n            super.onFocus(oEvent);\r\n        }\r\n\r\n        this._bLozingFocus = false;\r\n    }\r\n\r\n    /*\r\n    When a blur event is catched we don't know if it is a focus change within the list / grid (change \r\n    between columns) or really a change to somewhere else. So we use setTimeout to wait for a focus \r\n    event before we forward the onBlur to WebBaseControl.\r\n    \r\n    @param  oEvent  df.DomEvent\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n        const superFunction = super.onBlur\r\n\r\n        this._bLozingFocus = true;\r\n\r\n        setTimeout(function () {\r\n            if (that._bLozingFocus) {\r\n                superFunction.call(that, oEvent);\r\n\r\n                that._bLozingFocus = false;\r\n            }\r\n        }, 20);\r\n    }\r\n\r\n    /*\r\n    Checks if the list has the focus. When the list is within the blur timeout (lozing focus) it will \r\n    figure out if another control outside the list has registered itself as focussed object.\r\n    */\r\n    hasFocus() {\r\n        if (this._bHasFocus) {\r\n            if (this._bLozingFocus) {\r\n                //  Check if an object outside of the list has registered itself as the focussed object\r\n                let oFocusObj = this.getWebApp()._oCurrentObj;\r\n                while (oFocusObj != this && oFocusObj._oParent) {\r\n                    oFocusObj = oFocusObj._oParent;\r\n                }\r\n                return oFocusObj == this;\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // WebUIContext\r\n\r\n    bindHandlerForWebUIContext(oObj, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListHead:\r\n                this._oHeader?.registerHeaderMenu(oObj);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    unbindHandlerForWebUIContext(oObj, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListHead:\r\n                this._oHeader?.unregisterHeaderMenu(oObj);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    determineSelectorForWebUIContext(eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListHead:\r\n                return \".WebList_ColHead\";\r\n            case df.WebUIContext.WebUIContextListRow:\r\n                return \"table[data-dfrowid]\";\r\n            case df.WebUIContext.WebUIContextListFull:\r\n                return \"\";\r\n        }\r\n        return null;\r\n    }\r\n\r\n    retrieveValueFromWebUIContext(eElem, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListHead: {\r\n                let eCaption = df.dom.query(eElem, '.WebList_ColCap');\r\n                if (!eCaption)\r\n                    return \"\";\r\n                return eCaption.innerHTML;\r\n            }\r\n            case df.WebUIContext.WebUIContextListRow: {\r\n                if (!eElem.hasAttribute('data-dfrowid'))\r\n                    break;\r\n                return eElem.getAttribute('data-dfrowid')\r\n            }\r\n            case df.WebUIContext.WebUIContextListFull: {\r\n                let eIter = eElem;\r\n                while (eIter && eIter.hasAttribute &&\r\n                    !eIter.hasAttribute(\"data-dfrowid\") &&\r\n                    eIter != this._eElem) {\r\n                    eIter = eIter.parentNode;\r\n                }\r\n                if (!(eIter?.hasAttribute('data-dfrowid')))\r\n                    return \"\";\r\n                return eIter.getAttribute('data-dfrowid')\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // Dragdrop\r\n\r\n    getDragData(oEv, eDraggedElem) {\r\n        try {\r\n            const itemId = eDraggedElem.closest(\"table\")?.getAttribute(\"data-dfrowid\") || -1;\r\n            let item;\r\n\r\n            if (itemId && itemId != \"empty\" && itemId != -1 && (itemId != '' || itemId >= 0)) {\r\n                // Destructure object to create a clone, then remove any privates - prevents circular json eror\r\n                item = { ...this._oModel.aData[(this._oModel.rowIndexByRowId(itemId))] };\r\n\r\n                Object.keys(item).forEach(function (key) {\r\n                    key.indexOf(\"_\") == 0 && delete item[key];\r\n                });\r\n\r\n                return [{ data: item }, df.dragActions.WebList.ciDragRow]\r\n            }\r\n\r\n            return [null, null];\r\n        } catch (err) {\r\n            // This can happen if the drag action is not supported, we don't want a nasty error if so.\r\n            console.error(\"Attempt to perform unsupported drag action\");\r\n            return [null, null];\r\n        }\r\n    }\r\n\r\n    getDropData(oDropZone, oPosition) {\r\n        const itemId = (oDropZone._eDropElem && oDropZone._eDropElem.getAttribute(\"data-dfrowid\")) || -1;\r\n        let item;\r\n\r\n        if (itemId && itemId != -1 && (itemId != '' || itemId >= 0)) {\r\n            // Destructure object to create a clone, then remove any privates - prevents circular json eror\r\n            item = { ...this._oModel.aData[(this._oModel.rowIndexByRowId(itemId))] }\r\n\r\n            Object.keys(item).forEach(function (key) {\r\n                key.indexOf(\"_\") == 0 && delete item[key];\r\n            });\r\n        }\r\n\r\n        const dropData = {\r\n            data: item,\r\n            action: df.dropActions.WebList.ciDropOnRow\r\n        }\r\n\r\n        return dropData;\r\n    }\r\n\r\n    initDropZones() {\r\n        this._aDropZones = [];\r\n\r\n        super.initDropZones();\r\n\r\n        if (this.isSupportedDropAction(df.dropActions.WebList.ciDropOnRow)) {\r\n            const eZone = (df.dom.query(this._eElem, '.WebList_BodyWrp'));\r\n            this.addDropZone(eZone);\r\n        }\r\n    }\r\n\r\n    determineDropCandidate(oEv, aHelpers) {\r\n        // DropOnControl and other drop actions cannot exist within the same control simultaneously\r\n        // It makes sense to check for this first to get it out of the way as it is the simplest check\r\n        if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebControl.ciDropOnControl))) {\r\n            return [this._eElem, df.dropActions.WebControl.ciDropOnControl];\r\n        }\r\n\r\n        // Check for DropOnRow, no need to continue if it doesn't exist\r\n        if (!aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebList.ciDropOnRow))) {\r\n            return [null, null];\r\n        }\r\n\r\n        const eElem = document.elementFromPoint(oEv.e.clientX, oEv.e.clientY);\r\n        let eRow = eElem?.closest('[data-dfrowid]');\r\n\r\n        if (eRow) {\r\n            const sRowId = eRow.getAttribute('data-dfrowid');\r\n\r\n            if (sRowId == 'empty_placeholder') {\r\n                return [eRow.previousElementSibling || eRow.nextElementSibling || eRow, df.dropActions.WebList.ciDropOnRow];\r\n            } else if (sRowId == 'empty') {\r\n                while (eRow) {\r\n                    const sRowId = eRow.getAttribute('data-dfrowid');\r\n                    if (sRowId != 'empty' && sRowId != 'empty_placeholder') {\r\n                        return [eRow, df.dropActions.WebList.ciDropOnRow];\r\n                    }\r\n                    eRow = eRow.previousElementSibling;\r\n                }\r\n            } else {\r\n                return [eRow, df.dropActions.WebList.ciDropOnRow];\r\n            }\r\n        }\r\n\r\n        return [null, null];\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        const oRect = df.sys.gui.getBoundRect(eElem);\r\n        // We want to check if we are more to the top or to the bottom of the hovered row\r\n        const iMid = (oRect.bottom - (oRect.height / 2));\r\n        if (oEv.e.clientY >= iMid) {\r\n            return df.dropPositions.ciDropAfter;\r\n        } else {\r\n            return df.dropPositions.ciDropBefore;\r\n        }\r\n    }\r\n\r\n    onControlDragOver(oEv, oDropZone, eDropElem) {\r\n        if (!this._bScrollQueued) {\r\n            let dY = 10;\r\n            let dT = 100;\r\n            const oRect = df.sys.gui.getBoundRect(oDropZone._eZone);\r\n\r\n            // Drag scroll down\r\n            const iBottomSection = oRect.bottom - 50;\r\n            if (oEv.e.clientY <= oRect.bottom && (oEv.e.clientY > iBottomSection)) {\r\n                const iDiffFromBottom = oRect.bottom - oEv.e.y;\r\n                if (iDiffFromBottom < (iBottomSection * 0.5)) {\r\n                    // accelerate scroll when closer to bottom\r\n                    dT = 20;\r\n                }\r\n                this._bScrollQueued = true;\r\n                setTimeout(() => {\r\n                    this.dragScroll(dY)\r\n                }, dT);\r\n            }\r\n            // Drag scroll up\r\n            const iTopSection = oRect.top + 50;\r\n            if (oEv.e.clientY >= oRect.top && (oEv.e.clientY < iTopSection)) {\r\n                dY = -dY\r\n                const iDiffFromTop = oEv.e.y - oRect.top;\r\n                if (iDiffFromTop < (iTopSection * 0.5)) {\r\n                    // accelerate scroll when closer to top\r\n                    dT = 20;\r\n                }\r\n                this._bScrollQueued = true;\r\n                setTimeout(() => {\r\n                    this.dragScroll(dY)\r\n                }, dT);\r\n            }\r\n        }\r\n    }\r\n\r\n    dragScroll(dY) {\r\n        this._oBody?.scroll(dY, false);\r\n        this._bScrollQueued = false;\r\n    }\r\n\r\n    interactWithDropElem(dropZone, eElem) {\r\n        if (dropZone._eDropAction == df.dropActions.WebControl.ciDropOnControl) {\r\n            // console.log('droponcontrol');\r\n            dropZone.highlightElement();\r\n        } else {\r\n            // console.log('droplistrow');\r\n            const eTempElem = document.createElement('table');\r\n            df.dom.addClass(eTempElem, 'WebList_Row WebList_DropPlaceHolder');\r\n            eTempElem.setAttribute('data-dfrowid', 'empty_placeholder');\r\n\r\n            const iHeight = this.getPlaceholderRowHeight();\r\n\r\n            if (iHeight && iHeight > 0) {\r\n                eTempElem.style.height = (String(iHeight)) + \"px\"\r\n            }\r\n\r\n            dropZone.insertElement(eTempElem, eElem);\r\n        }\r\n    }\r\n\r\n    doEmptyInteraction(dropZone) {\r\n        if (this.isSupportedDropAction(df.dropActions.WebList.ciDropOnRow)) {\r\n            const eTempElem = document.createElement('table');\r\n            df.dom.addClass(eTempElem, 'WebList_Row WebList_DropPlaceHolder');\r\n\r\n            const iHeight = this.getPlaceholderRowHeight();\r\n\r\n            if (iHeight && iHeight > 0) {\r\n                eTempElem.style.height = (String(iHeight)) + \"px\"\r\n            }\r\n\r\n            const eTargetElem = (df.dom.query(this._eElem, '.WebList_Body table'));\r\n            dropZone.insertElement(eTempElem, eTargetElem, df.dropPositions.ciDropBefore);\r\n            return df.dropActions.WebList.ciDropOnRow;\r\n        } else if (this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)) {\r\n            dropZone.highlightElement();\r\n            return df.dropActions.WebControl.ciDropOnControl;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    hasData() {\r\n        return (this._oModel.aData && this._oModel.aData.length > 0);\r\n    }\r\n\r\n    getPlaceholderRowHeight() {\r\n        const iAvgHeight = this._oBody.iAvgRowHeight;\r\n        const iFirstRowHeight = df.dom.clientHeight(df.dom.query(this._eElem, '.WebList_Body table'));\r\n        const iHeight = (iAvgHeight > 0 ? iAvgHeight : iFirstRowHeight) || 0;\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /*\r\n    These are left for now, even through we don't serialize to valuetrees any more. This leaves us with\r\n    a spot where we could implement potential renames.\r\n    */\r\n    deserializeRows(aRows) { return aRows; }\r\n    serializeRows(aRows) { return aRows; }\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { WebList } from './WebList.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebListExpandPanel\r\n\r\nThe expand panel renders an expandable panel inside a list that expands below a row. It can expand \r\nautomatically or manually and can contain any type of control.\r\n\r\nRevision:\r\n    2018/01/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\ndf.wleManual = 0;                       // Manual                                  \r\ndf.wleOpenOnRowChange = 1;              // Always open on current row              \r\ndf.wleOpenOnRowClick = 2;               // Toggle on row click                     \r\ndf.wleOpenOnRowClickCloseOnChange = 3;   // Toggle on row click, close on row change\r\ndf.wleOpenOnRowDoubleClick = 4;\r\ndf.wleOpenOnRowDoubleClickCloseOnChange = 5;\r\n\r\nexport class WebListExpandPanel extends WebBaseContainer {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tInt, \"peMode\", df.wleOpenOnRowClickCloseOnChange);\r\n        this.prop(df.tBool, \"pbShowLoading\", false);\r\n        this.prop(df.tString, \"psExpandedRow\", \"\");\r\n        this.prop(df.tBool, \"pbFocusOnShow\", true);\r\n\r\n        this.event(\"OnExpand\", df.cCallModeDefault);\r\n        this.event(\"OnCollapse\", df.cCallModeDefault);\r\n\r\n        this._sExpandedRow = null;\r\n        this._bExpanding = false;\r\n        this.OnAfterExpand = new df.events.JSHandler();\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebListExpPnl\";\r\n        this._bWrapDiv = true;\r\n\r\n\r\n        this.addSync(\"psExpandedRow\");\r\n\r\n        //  Register on WebList\r\n        if (oPrnt instanceof WebList) {\r\n            this._oL = oPrnt;\r\n\r\n            this._oL._onModulesCreated.addListener(this.onModulesCreated, this);\r\n        } else {\r\n            throw new df.Error(999, \"WebListExpandPanel object '{{0}}' should be placed inside a WebList object.\", this, [this.getLongName()]);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Event triggered by the weblist after the modules (model, view, controller) are created so we can \r\n    attach our listeners.\r\n    \r\n    @param  oEv     Event object.\r\n    */\r\n    onModulesCreated(oEv) {\r\n        //  Register to receive render events\r\n        this._oL._oBody.onRowsRendered.addListener(this.onRowsRendered, this);\r\n\r\n        //  Register to receive click events\r\n        this._oL._oController.onCellClick.addListener(this.onCellClick, this);\r\n        this._oL._oController.onCellDblClick.addListener(this.onCellDblClick, this);\r\n\r\n        //  Register to receive row change events\r\n        this._oL._oModel.onRowChange.addListener(this.onRowChange, this);\r\n    }\r\n\r\n    /* \r\n    Event triggered by the list controller object when a cell is clicked. \r\n    \r\n    @param  oEv     Event object.\r\n    */\r\n    onCellClick(oEv) {\r\n        if (this.peMode == df.wleOpenOnRowClick || this.peMode == df.wleOpenOnRowClickCloseOnChange) {\r\n            if (this._sExpandedRow == oEv.sRowId) {\r\n                this.collapse();\r\n            } else {\r\n                this.expand(oEv.sRowId);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Event triggered by the list controller object when a cell is double clicked. \r\n    \r\n    @param  oEv     Event object.\r\n    */\r\n    onCellDblClick(oEv) {\r\n        if (this.peMode == df.wleOpenOnRowDoubleClick || this.peMode == df.wleOpenOnRowDoubleClickCloseOnChange) {\r\n            if (this._sExpandedRow == oEv.sRowId) {\r\n                this.collapse();\r\n            } else {\r\n                this.expand(oEv.sRowId);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles to the onRowChange event fired by the weblist and depending on peMode it will expand the \r\n    panel (or not).\r\n    \r\n    Depends on event properties:\r\n        sPrevRowId\r\n        sGotoRowId\r\n    */\r\n    onRowChange(oEv) {\r\n        if (this.peMode == df.wleOpenOnRowChange) {\r\n            if (this._sExpandedRow !== oEv.sGotoRowId) {\r\n                this.expand(oEv.sGotoRowId);\r\n            }\r\n        } else if (this.peMode == df.wleOpenOnRowClickCloseOnChange || this.peMode == df.wleOpenOnRowDoubleClickCloseOnChange) {\r\n            if (this._sExpandedRow !== oEv.sGotoRowId) {\r\n                this.collapse();\r\n            }\r\n        }\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"focusin\", this._eElem, this.onFocus, this);\r\n        df.dom.on(\"click\", this._eElem, this.onClick, this);\r\n\r\n        /* Stop propagation of several events */\r\n        df.dom.on(\"keydown keypress\", this._eElem, function (oEv) {\r\n            oEv.stopPropagation();\r\n        }, this);\r\n    }\r\n\r\n    onFocus(oEv) {\r\n        oEv.stop();\r\n    }\r\n\r\n    onClick(oEv) {\r\n        oEv.stop();\r\n    }\r\n\r\n    /* \r\n    Collapses the panel. The animation is done using a transition\r\n     cloning the DOM elements (with event handlers and JS \r\n    refs) because the actual elements might immediately be used by the next expand operation. \r\n    \r\n    @client-action\r\n    */\r\n    collapse() {\r\n        const oV = this._oL._oBody;\r\n        let eGhost;\r\n\r\n        //  Handler for when the animation is finished (cleanup)\r\n        function colTransEnd(oEv) {\r\n            if (eGhost.parentNode) {\r\n                eGhost.parentNode.removeChild(eGhost);\r\n            }\r\n\r\n            df.dom.off(\"transitionend\", eGhost, colTransEnd, this);\r\n        }\r\n\r\n        if (this._sExpandedRow) {\r\n            this.fire(\"OnCollapse\");\r\n\r\n            //  If the panel is visible we make a copy (ghost) that we animate using maxHeight\r\n            if (this._eElem.parentNode) {\r\n                eGhost = this._eElem.cloneNode(true);\r\n\r\n                //  Change the names of all input elements to prevent them disturbing the orriginals (radio selected values getting lost)\r\n                df.dom.query(eGhost, \"input\", true).forEach(function (eEl) {\r\n                    eEl.name = eEl.name + \"_1\";\r\n                });\r\n\r\n                eGhost.style.height = this._eElem.scrollHeight + \"px\";\r\n                this._eElem.parentNode.insertBefore(eGhost, this._eElem);\r\n                this._eElem.parentNode.removeChild(this._eElem);\r\n\r\n                //  Wait two animation frames to be consistent with expanding which might happen at the same time..\r\n                df.dom.animFrame(function () {\r\n                    df.dom.animFrame(function () {\r\n                        df.dom.on(\"transitionend\", eGhost, colTransEnd, this);\r\n\r\n                        df.dom.addClass(eGhost, \"WebLEP_Hidden\");\r\n                        df.dom.removeClass(eGhost, \"WebLEP_Visible\");\r\n                        eGhost.style.height = \"0px\";\r\n                    }, this);\r\n                }, this);\r\n            }\r\n\r\n            //  Make sure to apply the hidden CSS to the actual panel elem so it is prepared to be reinserted somewhere else\r\n            df.dom.addClass(this._eElem, \"WebLEP_Hidden\");\r\n            df.dom.removeClass(this._eElem, \"WebLEP_Visible\");\r\n            // this._eElem.style.height = \"1px\";\r\n\r\n            oV.setExtraRowHeight(this._sExpandedRow, 0);\r\n\r\n            this._sExpandedRow = null;\r\n\r\n            this.afterHide();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Expands the panel on the specified row. It first collapses it if it was already expanded on a \r\n    different row. Animates using a transition on the height.\r\n    \r\n    @param  sRowId  RowId of the row to expand on.\r\n    @client-action\r\n    */\r\n    expand(sRowId) {\r\n        const oV = this._oL._oBody;\r\n        let ePnl;\r\n\r\n        //  Collapse row if needed\r\n        if (this._sExpandedRow) {\r\n            this.collapse();\r\n        }\r\n\r\n        //  Handler for when the animation is finished\r\n        function expTransEnd(oEv) {\r\n            ePnl.style.height = null;\r\n            this._bExpanding = false;\r\n            df.dom.off(\"transitionend\", ePnl, expTransEnd, this);\r\n            this.afterShow();\r\n        }\r\n\r\n        const eRow = oV.row(sRowId);\r\n\r\n        if (eRow) {\r\n            //  Initialize and insert the panel DOM\r\n            if (!this._eElem) {\r\n                this.render();\r\n                df.dom.addClass(this._eElem, \"WebLEP_Hidden\");\r\n                this._eElem.style.display = \"none\";     //  Display none first to force browser to do better calcs\r\n                df.dom.insertAfter(this._eElem, eRow);\r\n                this.afterRender();\r\n            } else {\r\n                this._eElem.style.display = \"none\";     //  Display none first to force browser to do better calcs\r\n                df.dom.insertAfter(this._eElem, eRow);\r\n            }\r\n            ePnl = this._eElem;\r\n\r\n            if (this.pbShowLoading) {\r\n                df.dom.addClass(ePnl, \"WebCon_Loading\");\r\n            }\r\n            this.fire(\"OnExpand\", [sRowId], function (oEv) {\r\n                df.dom.removeClass(ePnl, \"WebCon_Loading\");\r\n            }, this);\r\n\r\n            //  Size\r\n            this.resizeHorizontal();\r\n            this.resizeVertical();\r\n\r\n            this._sExpandedRow = sRowId;\r\n\r\n            if (this.pbFocusOnShow) {\r\n                this.focus();\r\n            }\r\n\r\n            //  First frame we run with element there without height of 0 (display none) so the browser does a better job of calculating positions\r\n            df.dom.animFrame(function () {\r\n                df.dom.on(\"transitionend\", ePnl, expTransEnd, this);\r\n\r\n                ePnl.style.height = \"0px\";\r\n                ePnl.style.display = \"\";\r\n\r\n                //  In the second frame we do the actual calculation\r\n                df.dom.animFrame(function () {\r\n                    var iHeightTo;\r\n\r\n                    if (this.piHeight > 0) {\r\n                        iHeightTo = this.piHeight + this.getHeightDiff(false, true, false, false);\r\n                    } else {\r\n                        iHeightTo = ePnl.scrollHeight; // Math.max(this._eContent.offsetHeight + this.getHeightDiff(false, true, true, true), this.piMinHeight);\r\n                    }\r\n                    ePnl.style.height = iHeightTo + \"px\";\r\n\r\n                    df.dom.addClass(ePnl, \"WebLEP_Visible\");\r\n                    df.dom.removeClass(ePnl, \"WebLEP_Hidden\");\r\n                    this._bExpanding = true;\r\n\r\n                    oV.setExtraRowHeight(sRowId, iHeightTo);\r\n                    oV.scrollToRow(sRowId);\r\n                }, this);\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Triggered by the list view when rows are rendered. If a row is expanded we check if that element is \r\n    still in the DOM, if not we check if the expanded row is checked so we can insert it.\r\n    \r\n    @param  oEv     Event object.\r\n    */\r\n    onRowsRendered(oEv) {\r\n        if (this._sExpandedRow && this._eElem) {\r\n            if (!this._eElem.parentNode) {\r\n                const oV = this._oL._oBody;\r\n\r\n                const eRow = oV.row(this._sExpandedRow);\r\n\r\n                if (eRow) {\r\n                    df.dom.insertAfter(this._eElem, eRow);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get_psExpandedRow() {\r\n        return this._sExpandedRow || \"\";\r\n    }\r\n\r\n    resize() {\r\n        this.resizeHorizontal();\r\n        this.resizeVertical();\r\n    }\r\n\r\n    setInnerHeight(iHeight) {\r\n\r\n        super.setInnerHeight(iHeight);\r\n\r\n        /* if(iHeight > 0 && this._bExpanding){\r\n            this._eElem.style.maxHeight = iHeight + \"px\";\r\n    \r\n        } */\r\n    }\r\n};","import { WebGrid } from './WebGrid.js';\r\nimport { WebList } from './WebList.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumn_mixin\r\nExtends:\r\n    Object\r\n    \r\nThis class is used as a mixin for all the different column types. It has the basic column \r\nfunctionality and defined the interface to which the List & Grid will be talking. It has basic logic \r\nfor generating the cell content and makes sure the grid redraws when properties are changed. \r\n    \r\nRevision:\r\n    2011/12/01  (HW, DAW) \r\n        Initial version.\r\n    2013/08/15  (HW, DAW)\r\n        Refactored into the new mixin system to reduce overhead as more column types will be added.\r\n*/\r\nexport const WebColumn_mixin = superclass => class extends superclass {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Assertions\r\n        if (!(oParent && oParent instanceof WebList)) {\r\n            throw new df.Error(999, \"WebColumn object '{{0}}' should be placed inside a WebList object. Consider wrapping your column with a list or grid object.\", this, [this.getLongName()]);\r\n        }\r\n\r\n        //  Properties\r\n        this.prop(df.tBool, \"pbGroupable\", true);\r\n        this.prop(df.tBool, \"pbSortable\", false);\r\n        this.prop(df.tBool, \"pbValueAsTooltip\", true);\r\n        this.prop(df.tBool, \"pbAllowHtml\", false);\r\n        this.prop(df.tInt, \"piWidth\", 0);\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n\r\n        this.prop(df.tBool, \"pbNewLine\", false);\r\n        this.prop(df.tInt, \"piListColSpan\", 1);\r\n        this.prop(df.tInt, \"piListRowSpan\", 1);\r\n\r\n        this.prop(df.tBool, \"pbFixedWidth\", false);\r\n        this.prop(df.tBool, \"pbResizable\", true);\r\n\r\n        this.prop(df.tBool, \"pbHidden\", false);\r\n        this.prop(df.tBool, \"pbShowCaption\", true);\r\n        this.prop(df.tInt, \"piPosition\", -1);\r\n        this.prop(df.tBool, \"pbHideable\", true);\r\n\r\n        this.prop(df.tInt, \"peFooterDataType\", df.ciTypeText);\r\n        this.prop(df.tInt, \"peFooterAlign\", -1);\r\n        this.prop(df.tInt, \"piFooterPrecision\", 0);\r\n        this.prop(df.tString, \"psFooterMask\", \"\");\r\n        this.prop(df.tString, \"psFooterValue\", \"\");\r\n\r\n        this.addSync(\"pbHidden\");\r\n        this.addSync(\"piPosition\");\r\n\r\n        this.prop(df.tBool, \"pbEditable\", true);\r\n\r\n        //  Events\r\n        this.event(\"OnHeaderClick\", df.cCallModeDefault);\r\n\r\n        //  @privates\r\n        this._sCellClass = \"WebCol\";\r\n        this._bCellEdit = true;\r\n        this._iColIndex = 0;    //  Index in data row\r\n        this._iCol = 0;     //  Index in _aColumns of list\r\n\r\n        this._bIsColumn = true;\r\n        //  Configure super class\r\n    }\r\n\r\n    /*\r\n    Setting psFooterValue requires the footer to be redrawn.\r\n    */\r\n    set_psFooterValue(sVal) {\r\n        if (this.psFooterValue !== sVal) {\r\n            this.psFooterValue = sVal;\r\n            this._oParent._oFooter.updateFooter();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting psFooterMask requires the footer to be redrawn.\r\n    */\r\n    set_psFooterMask(sVal) {\r\n        if (this.psFooterMask !== sVal) {\r\n            this.psFooterMask = sVal;\r\n            this._oParent._oFooter.updateFooter();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting piFooterPrecision requires the footer to be redrawn.\r\n    */\r\n    set_piFooterPrecision(iVal) {\r\n        if (this.piFooterPrecision !== iVal) {\r\n            this.piFooterPrecision = iVal;\r\n            this._oParent._oFooter.updateFooter();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting peFooterAlign requires the footer to be redrawn.\r\n    */\r\n    set_peFooterAlign(eVal) {\r\n        if (this.peFooterAlign !== eVal) {\r\n            this.peFooterAlign = eVal;\r\n            this._oParent._oFooter.updateFooter();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting peFooterDataType requires the footer to be redrawn.\r\n    */\r\n    set_peFooterDataType(eVal) {\r\n        if (this.peFooterDataType !== eVal) {\r\n            this.peFooterDataType = eVal;\r\n            this._oParent._oFooter.updateFooter();\r\n        }\r\n    }\r\n\r\n    /*\r\n    We augment the set_psValue method and pass on the new value to the grid so that it can update the \r\n    current row its value. The default setter of psValue is also called so when this is the currently \r\n    edited cell the value is also properly reflected.\r\n    \r\n    @param  sVal    The new value in the server format.\r\n    */\r\n    set_psValue(sVal) {\r\n        super.set_psValue(sVal);\r\n\r\n        if (this._oParent instanceof WebGrid) {\r\n            this._oParent.updateCurrentCell(this, sVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbRender means that the list should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of pbRender.\r\n    */\r\n    set_pbRender(bVal, bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n        const bCS = (this.pbRender !== bVal);\r\n\r\n        super.set_pbRender(bVal);\r\n\r\n        if (bCS) {\r\n            this.pbRender = bVal;\r\n\r\n            this._oParent.rebuildColumnMapper(bRedraw);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbShowCaption means that the list should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of pbShowCaption.\r\n    */\r\n    set_pbShowCaption(bVal) {\r\n        if (this.pbShowCaption !== bVal) {\r\n            this.pbShowCaption = bVal;\r\n\r\n            this._oParent._oHeader.updateHeader();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbHidden means that the list should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of pbHidden.\r\n    */\r\n    set_pbHidden(bVal, bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        if (this.pbHidden !== bVal) {\r\n            this.pbHidden = bVal;\r\n\r\n            this._oParent.rebuildColumnMapper(bRedraw);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting piPosition means that the list should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of piPosition.\r\n    */\r\n    set_piPosition(iVal, bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        if (this.piPosition !== iVal) {\r\n            this.piPosition = iVal;\r\n\r\n            this._oParent.rebuildColumnMapper(bRedraw);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbHideable means that the list's menu should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of pbHideable.\r\n    */\r\n    set_pbHideable(bVal) {\r\n        if (this.pbHideable !== bVal) {\r\n            this.pbHideable = bVal;\r\n\r\n            this._oParent.triggerRebuildHeaderMenu();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbEditable requires different class properties and should thus be redrawn.\r\n    \r\n    @param bVal Indicates whether the column is editable.\r\n    */\r\n    set_pbEditable(bVal) {\r\n        if (this.pbEditable !== bVal) {\r\n            this.pbEditable = bVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setting pbAllowHtml means that the list should redraw itself completely. \r\n    \r\n    @param  bVal    The new value of pbAllowHtml.\r\n    */\r\n    set_pbAllowHtml(bVal) {\r\n        if (this.pbAllowHtml !== bVal) {\r\n            this.pbAllowHtml = bVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the changed width so it can redraw itself.\r\n    \r\n    @param  iVal    The new value.\r\n    @private\r\n    */\r\n    set_piWidth(iVal) {\r\n        if (this.piWidth !== iVal) {\r\n            this.piWidth = iVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the change so that it can redraw itself.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbFixedWidth(bVal) {\r\n        if (this.pbFixedWidth !== bVal) {\r\n            this.pbFixedWidth = bVal;\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the change so that it can redraw itself.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbNewLine(bVal) {\r\n        if (this.pbNewLine !== bVal) {\r\n            this.pbNewLine = bVal;\r\n            this._oParent.redraw();\r\n            this._oParent.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter for psCaption that notifies the list of the new caption and makes it redraw the header.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this.psCaption !== sVal) {\r\n            this.psCaption = sVal;\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid when the CSS Classname changes so it can redraw itself.\r\n    \r\n    @param  sVal    The new value.\r\n    @private\r\n    */\r\n    set_psCSSClass(sVal) {\r\n        const bCS = (this.psCSSClass !== sVal);\r\n\r\n        super.set_psCSSClass(sVal);\r\n\r\n        if (bCS) {\r\n            this.psCSSClass = sVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the changed width so it can redraw itself.\r\n    \r\n    @param  iVal    The new value.\r\n    @private\r\n    */\r\n    set_piListColSpan(iVal) {\r\n        if (this.piListColSpan !== iVal) {\r\n            this.piListColSpan = iVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the changed width so it can redraw itself.\r\n    \r\n    @param  iVal    The new value.\r\n    @private\r\n    */\r\n    set_piListRowSpan(iVal) {\r\n        if (this.piListRowSpan !== iVal) {\r\n            this.piListRowSpan = iVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Notifies the list / grid of the change.\r\n    \r\n    @param  bVal    The new value.\r\n    @private\r\n    */\r\n    set_pbVisible(bVal) {\r\n        if (this.set_pbVisible !== bVal) {\r\n            super.set_pbVisible(bVal);\r\n\r\n            this.pbVisible = bVal;\r\n\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the applyEnabled and triggers a redraw of the list as the CSS classes of all cells should \r\n    be updated.\r\n    \r\n    @param  bVal    The new value of pbRender.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    /*\r\n    We augment the onKey event handler and call the onKey handler of the grid first so that the grid \r\n    keys overrule the default form keys (especially ctrl - end & ctrl - home which go to the last & \r\n    first row instead of doing a find). The grids onKey handler returns true if nothing happened and \r\n    false if something happened (this confirms with the default event system).\r\n    \r\n    @param  oEvent  The event object.\r\n    */\r\n    onKey(oEvent) {\r\n        if (this._oParent.onKeyDown(oEvent)) {\r\n            super.onKey(oEvent);\r\n        } else {\r\n            oEvent.e.cancelBubble = true;\r\n        }\r\n    }\r\n\r\n    /*\r\n    @20.1\r\n    This function is called when the header of the column is constructed.\r\n    It could later be augmented for custom headers.\r\n    */\r\n    headerCSS() {\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    @20.1\r\n    This function is called when the header of the column is constructed.\r\n    It could later be augmented for custom headers.\r\n    */\r\n    headerHtml() {\r\n        return (this.psCaption && this.pbShowCaption ? this.psCaption : '&nbsp;');\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        let sVal;\r\n\r\n        const tVal = df.sys.data.serverToType(tCell.sValue, this.peDataType);\r\n        sVal = this.typeToDisplay(tVal);\r\n\r\n        if (!this.pbAllowHtml) {\r\n            sVal = df.dom.encodeHtml(sVal);\r\n        }\r\n\r\n        return (sVal !== '' ? sVal : '&nbsp;');\r\n    }\r\n\r\n    /* \r\n    This method is called by the list to format the tooltip value when pbValueAsTooltip is true and no \r\n    custom tooltip is defined for a cell. It makes sure that the value is shown in the proper format \r\n    (dates) with masks applied if need.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return Properly formatted cell value.\r\n    */\r\n    tooltipValue(tCell) {\r\n        const tVal = df.sys.data.serverToType(tCell.sValue, this.peDataType);\r\n        return this.typeToDisplay(tVal);\r\n    }\r\n\r\n    /* \r\n    Triggered by the List / Grid when a cell of this column is clicked. It doesn't have to be the \r\n    selected cell yet.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if this column handled the click and the list should ignore it (stops the ChangeCurrentRow).\r\n    */\r\n    cellClickBefore(oEvent, sRowId, sVal) {\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    Triggered by the List / Grid when a cell of this column is clicked. This is triggered after the row \r\n    change but there is no guarantee that the row actually changed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if the column handled the click and the list should not trigger OnRowClick any more.\r\n    */\r\n    cellClickAfter(oEvent, sRowId, sVal) {\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    Triggered by the grid when a cell of this column switches to edit mode. This might be because the \r\n    cell is now selected but also because it was scrolled of the screen and is now rendered again.\r\n    */\r\n    cellEdit() {\r\n\r\n    }\r\n\r\n    /* \r\n    Triggered by the grid when a cell switches from edit mode. This might be because a different cell \r\n    will be edited but also because a row is scrolled off the screen. \r\n    */\r\n    cellUnEdit() {\r\n\r\n    }\r\n\r\n    /* \r\n    Determines which element should be used to position a tooltip next to. We usually want to get the \r\n    tooltip at the cell of this column in the selected row.\r\n    \r\n    @return Element to position tooltip next to.\r\n    */\r\n    getTooltipElem() {\r\n        let eElem = this._oParent.getColCell(this);\r\n\r\n        if (!eElem) {\r\n            eElem = this._oParent.getColHead(this);\r\n        }\r\n\r\n        return eElem;\r\n    }\r\n\r\n    /* \r\n    Determine which element should be used to position error messages next to. This is the same as the \r\n    tooltip element.\r\n    \r\n    @return Element to position error next to.\r\n    */\r\n    getErrorElem() {\r\n        return this.getTooltipElem();\r\n    }\r\n\r\n    selectAndFocus() {\r\n        if (this._oParent instanceof WebGrid) {\r\n            this._oParent.selectCol(this._iCol);\r\n        }\r\n\r\n        this.focus();\r\n    }\r\n\r\n\r\n}","import { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { WebForm } from './WebForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumn\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnBase)\r\nExtends:\r\n    df.WebForm\r\n\r\nThis is the client-side representation of the cWebColumn control. The cWebColumn control is \r\nthe default column for the cWebList & cWebGrid controls and should only be used as a nested object \r\nfor those classes. It extends the input form and adds the functionality needed to let it function \r\nwithin the grid or list.\r\n    \r\nRevision:\r\n    2011/12/01  (HW, DAW) \r\n        Initial version.\r\n    2013/08/15  (HW, DAW)\r\n        Rewrote to use df.WebColumn_mixin.\r\n*/\r\n\r\n//  Generate new base class using df.WebColumn_mixin and df.WebForm\r\nexport class WebColumnBase extends WebColumn_mixin(WebForm) {}\r\n\r\n\r\nexport class WebColumn extends WebColumnBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"peWordBreak\", df.wbNone);\r\n\r\n        //  Configure super class\r\n        //this._sCellClass = \"WebCol\";\r\n    }\r\n\r\n    create() {\r\n        this._sCellClass = \"WebCol \" + df.classWordBreak(this.peWordBreak);\r\n    }\r\n\r\n    /* \r\n    Augments the cellHtml function with support for the pbPassword property.\r\n    \r\n    @param  tCell   Struct with cell data.\r\n    @return HTML content of the cell &bull;&bull; for passwords.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        if (this.pbPassword) {\r\n            return tCell.sValue.replace(/./g, \"&bull;\");\r\n        } else {\r\n            return super.cellHtml(sRowId, tCell);\r\n        }\r\n    }\r\n\r\n    tooltipValue(tCell) {\r\n        if (this.pbPassword) {\r\n            return tCell.sValue.replace(/./g, \"&bull;\");\r\n        } else {\r\n            return super.tooltipValue(tCell);\r\n        }\r\n\r\n    }\r\n\r\n    set_peWordBreak(iVal) {\r\n        if (this.peWordBreak !== iVal) {\r\n            this._sCellClass = \"WebCol \" + df.classWordBreak(iVal);\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n}","import { WebListView } from './WebListView.js';\r\nimport { WebListScrollingView } from './WebListScrollingView.js';\r\nimport { WebColumn } from './WebColumn.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nMixin:\r\n    WebGridView_mixin\r\nUsed by:\r\n    WebGridView (WebListView)\r\n    WebGridScrollingView (WebListScrollingView)\r\n\r\nExtends the listview classes with data editing capabilities. It replaces the current cell with the \r\nDOM elements of the DEO base class of the column objects. It does require the one of the \r\nWebGridModel classes to be used.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nconst WebGridView_mixin = superclass =>\r\n    class extends superclass {\r\n\r\ndefine_WebGridView_mixin(oList, oModel, oController){\r\n    \r\n    this.eEditCell = null;\r\n    this.oEditCol = null;\r\n    this.sEditRowId = null;\r\n    \r\n    this.bCellEdit = false;\r\n    this.bStopFocus = false;        //  Prevents the focus function from actually setting focus which is needed during rowchange to prevent 'flickering' as the focus is called during this process\r\n    \r\n    oModel.onColChange.on(this.onColChange, this);\r\n    oModel.onBeforeRowChange.on(this.onBeforeRowChange, this);\r\n    oModel.onAfterRowChange.on(this.onAfterRowChange, this);\r\n}\r\n\r\nafterRender(eList){\r\n    // super.afterRender(eList);\r\n    super.afterRender(eList);\r\n    this.editCell();\r\n}\r\n\r\nrefreshDisplay(){\r\n    if (!this.eBody) { return; }\r\n        \r\n    //  Unedit cell\r\n    this.unEditCell(false);\r\n    \r\n    //  Refresh\r\n    super.refreshDisplay();\r\n    \r\n    //  Edit cell\r\n    this.editCell();\r\n}\r\n\r\n\r\nrefreshRow(sRowId, sNewRowId){\r\n    let bIsRow = (sRowId === this.sEditRowId);\r\n    \r\n    if(this.eBody){\r\n        if(bIsRow){\r\n            this.unEditCell(false);\r\n            bIsRow = true;\r\n        }\r\n        \r\n        super.refreshRow(sRowId, sNewRowId);\r\n        \r\n        if(bIsRow){\r\n            this.editCell();\r\n        }\r\n    }\r\n}\r\n\r\nrefreshCell(sRowId, oCol){\r\n    if(this.oEditCol !== oCol || this.sEditRowId !== sRowId){\r\n        super.refreshCell(sRowId, oCol);\r\n    }\r\n}\r\n\r\n/*\r\nThis method augments the insertRow method and adds support for the editcell of the grid. That means \r\nthat I will insert the edit cell when the inserted row is the current row.\r\n\r\n@param  tRow       The row object from the cache.\r\n@param  bTop       If true the row is inserted at the top of the table.\r\n*/\r\ninsertRow(iItemIndex, bTop){\r\n    super.insertRow(iItemIndex, bTop);\r\n    \r\n    if(this.oM.rowIdByRowIndex(iItemIndex) === this.oM.sCurrentRowId){\r\n        this.editCell();\r\n    }\r\n}\r\n\r\n/*\r\nAugments the removeTopRow method and properly removes the element from the DOM and moves the focus \r\nif the deleted row contains the edit cell.\r\n\r\n@private\r\n*/\r\nremoveTopRow(){\r\n    if(this.eEditCell && this.oM.iCurrentRow === this.iRowDispOffset){\r\n        /* if(this.bCellEdit){\r\n            this.eEditCell.removeChild(this.oEditCol._eElem);\r\n        }\r\n        this.eEditCell = this.oEditCol = this.sEditRowId = null; */\r\n        \r\n        this.unEditCell(false);\r\n        this.oL._eFocus.focus();\r\n    }\r\n    \r\n    super.removeTopRow.call(this);\r\n}\r\n\r\n/*\r\nAugments the removeBottomRow method and properly removes the element from the DOM and moves the \r\nfocus if the deleted row contains the edit cell.\r\n\r\n@private\r\n*/\r\nremoveBottomRow(){\r\n    if(this.eEditCell && this.iRowDispLast === this.oM.iCurrentRow){\r\n/*         if(this.bCellEdit){\r\n            this.eEditCell.removeChild(this.oEditCol._eElem);\r\n        }\r\n        this.eEditCell = this.oEditCol = this.sEditRowId = null; */\r\n        \r\n        this.unEditCell(false);\r\n        this.oL._eFocus.focus();\r\n    }\r\n    \r\n    super.removeBottomRow.call(this);\r\n}\r\n\r\n\r\n/*\r\nThis method replaces the content of a cell with the edit DOM elements. The column object generates \r\nthe DOM elements.\r\n\r\n@param  iCol    The number of the column\r\n@private\r\n*/\r\neditCell(){\r\n    const oL = this.oL, oM = this.oM, iCol = oM.iCurrentColumn, iRow = oM.iCurrentRow;\r\n    let bEdit;\r\n\r\n    //  Check if the row is being displayed\r\n    if((!this.bScroll || iRow >= this.iRowDispOffset && iRow <= this.iRowDispLast) && iCol >= 0){\r\n        const oCol = oL._aColumns[iCol];\r\n        \r\n        if(!oCol || !oCol.pbEditable){\r\n            return;\r\n        }\r\n        \r\n        this.bCellEdit = bEdit = oCol._bCellEdit;\r\n        \r\n        //  Get the edit DOM elements from the column object\r\n        const eElem = oCol._eElem;\r\n        \r\n        oCol._bIgnoreOnChange = true;\r\n        \r\n        //  Replace cell content with edit elements\r\n        const eCell = this.cell(oM.sCurrentRowId, iCol);\r\n        if(eCell){\r\n            if(eCell !== this.eEditCell){  // FIX: Moving to / from the newrow calls this method twice which triggers IE innerHTML / input bug\r\n                if(bEdit){\r\n                    eCell.innerHTML = \"\";\r\n                    eCell.appendChild(eElem);\r\n                }\r\n                df.dom.addClass(eCell, \"WebGrid_EditCell\");\r\n            }\r\n            \r\n            oCol.cellEdit();\r\n            \r\n            if(oL.hasFocus()){\r\n                if(oCol.isEnabled()){\r\n                    if(bEdit){\r\n                        oCol.focus(true);\r\n                        \r\n                        //  FIX: Do again after a small timeout to fix IE issues with masked fields\r\n                        if(df.sys.isIE || (df.sys.isEdge && df.sys.iVersion < 13)){\r\n                            setTimeout(function(){\r\n                                if(df.sys.isEdge){\r\n                                    oCol.focus(true);\r\n                                }else if(oCol instanceof WebColumn){   //  Make sure to select the text\r\n                                    oCol._eControl.select();\r\n                                }\r\n                            }, 10);\r\n                        }\r\n                    }else{\r\n                        const eFocus = df.dom.getFirstFocusChild(eCell);\r\n                        if(eFocus){\r\n                            eFocus.focus();\r\n                        }else{\r\n                            oL._eFocus.focus();\r\n                        }\r\n                    }\r\n                }else{\r\n                    oL._eFocus.focus();\r\n                }\r\n            }\r\n            \r\n            \r\n            this.eEditCell = eCell;\r\n            this.oEditCol = oCol;\r\n            this.sEditRowId = oM.sCurrentRowId;\r\n            \r\n        }\r\n        \r\n        oCol._bIgnoreOnChange = false;\r\n    }\r\n}\r\n\r\n/*\r\nThis method replaces the content of the edit cell with its value.\r\n\r\n@param  bUpdate     If true the cache value is updated.\r\n@private\r\n*/\r\nunEditCell(bUpdate){\r\n    const oR = this.oR, oM = this.oM;\r\n    \r\n    if(this.oEditCol){\r\n        const oCol = this.oEditCol;\r\n        const bEdit = oCol._bCellEdit;\r\n        const iRow = oM.rowIndexByRowId(this.sEditRowId);\r\n        \r\n        if(bUpdate && bEdit && iRow >= 0){\r\n            if(oCol.get('pbChanged')){\r\n                oM.aData[iRow].aCells[oCol._iColIndex].sValue =  oCol.get_psValue();\r\n            }\r\n        }\r\n\r\n        //  Force blur first (needed by WebSuggestionForm on Edge & FireFox)\r\n        if (oCol._eControl && oCol._eControl.blur){\r\n            oCol._eControl.blur();\r\n        }\r\n        \r\n        //  Remove gently from the DOM (IE doesn't like it rough)\r\n        if(bEdit){\r\n            if(oCol._eElem.parentNode){\r\n                oCol._eElem.parentNode.removeChild(oCol._eElem);\r\n            }\r\n        }\r\n        \r\n        if(iRow >= 0){\r\n            this.eEditCell.innerHTML = oR.cellHtml(oCol, oM.aData[iRow], oM.aData[iRow].aCells[oCol._iColIndex]);\r\n        }\r\n        df.dom.removeClass(this.eEditCell, \"WebGrid_EditCell\");\r\n        this.eEditCell = null;\r\n        this.oEditCol = null;\r\n        this.iEditRowId = null;\r\n    }\r\n}\r\n\r\nfocus(){\r\n    const oM = this.oM;\r\n    \r\n    //  Check if the row is being displayed\r\n    if(!this.bStopFocus && (!this.bScroll || oM.iCurrentRow >= this.iRowDispOffset && oM.iCurrentRow <= this.iRowDispLast)){\r\n        if(this.oEditCol){\r\n            if(this.oEditCol._bCellEdit){\r\n                if(this.oEditCol.focus(true)){\r\n                    return true;\r\n                }\r\n            }else{\r\n                const eFocus = df.dom.getFirstFocusChild(this.eEditCell);\r\n                if(eFocus){\r\n                    eFocus.focus();\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\nonColChange(oEv){\r\n    if(!oEv.bRowChange){\r\n        this.unEditCell(true);\r\n        this.editCell();\r\n    }\r\n}\r\n\r\nonRowChange(oEv){\r\n    this.unEditCell(!this.oL.pbDataAware);\r\n    \r\n    super.onRowChange(oEv);\r\n    \r\n    this.editCell();\r\n}\r\n\r\nonBeforeRowChange(oEv){\r\n    this.bStopFocus = true; \r\n}\r\n\r\nonAfterRowChange(oEv){\r\n    this.bStopFocus = false;\r\n\r\n    //  Explicitly set the focus after a row change to make sure the value is selected\r\n    if(this.oL.hasFocus()){\r\n        this.focus();\r\n    }\r\n}\r\n\r\n}\r\n\r\n\r\nexport class WebGridView extends WebGridView_mixin(WebListView) {\r\n    constructor(oList, oModel, oController){\r\n        super(oList, oModel, oController);\r\n        this.define_WebGridView_mixin(oList, oModel, oController);\r\n    }\r\n}\r\n\r\nexport class WebGridScrollingView extends WebGridView_mixin(WebListScrollingView) {\r\n    constructor(oList, oModel, oController){\r\n        super(oList, oModel, oController);\r\n        this.define_WebGridView_mixin(oList, oModel, oController);\r\n    }\r\n}\r\n\r\n\r\n// df.WebGridView = df.mixin(\"df.WebGridView_mixin\", \"df.WebListView\");\r\n// df.WebGridScrollingView = df.mixin(\"df.WebGridView_mixin\", \"df.WebListScrollingView\");\r\n","import { WebListPagedModel } from './WebListPagedModel.js';\r\nimport { WebListModel } from './WebListModel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nMixin:\r\n    df.WebGridModel_mixin\r\nUsed by:\r\n    df.WebGridModel (df.WebListModel)\r\n    df.WebGridPagedModel (df.WebListPagedModel)\r\n\r\nExtends the list model classes with the logic to maintain the current column on top of the current \r\nrow needed by the Grid as it works with a specific edit cell.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nconst WebGridModel_mixin = superclass =>\r\n    class extends superclass {\r\n\r\ndefine_WebGridModel_mixin(oList){\r\n    this.iCurrentColumn = oList.piCurrentColumn;\r\n    \r\n    this.onColChange = new df.events.JSHandler();\r\n}\r\n\r\nappendRow(tRow){\r\n    //  Check if last row is a new row\r\n    if(this.aData.length > 0 && this.aData[this.aData.length - 1].sRowId === \"\"){\r\n        //  Insert before the new row\r\n        this.aData.splice(this.aData.length - 1, 0, tRow);\r\n        this.iCurrentRow++;\r\n    }else{\r\n        //  Insert at the end\r\n        this.aData.push(tRow);\r\n    }\r\n    \r\n    if(this.sortData()){\r\n        this.iCurrentRow = this.rowIndexByRowId(this.sCurrentRowId);\r\n    }\r\n    this.prepDisplay();\r\n    this.onDataUpdate.fire(this, {\r\n        sType :\"newrow\",\r\n        sRowId : tRow.sRowId\r\n    });\r\n}\r\n\r\n}\r\n\r\n// df.WebGridModel = df.mixin(\"df.WebGridModel_mixin\", \"df.WebListModel\");\r\nexport class WebGridModel extends WebGridModel_mixin(WebListModel) {\r\n    constructor(oList){\r\n        super(oList);\r\n        this.define_WebGridModel_mixin(oList);\r\n    }\r\n}\r\n\r\n// df.WebGridPagedModel = df.mixin(\"df.WebGridModel_mixin\", \"df.WebListPagedModel\");\r\nexport class WebGridPagedModel extends WebGridModel_mixin(WebListPagedModel) {\r\n    constructor(oList){\r\n        super(oList);\r\n        this.define_WebGridModel_mixin(oList);\r\n    }\r\n}\r\n\r\n","import { WebListController } from './WebListController.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    WebGridController\r\nExtends:\r\n    WebListController\r\n\r\nExtends the controller class of the WebList with grid functionality. It handles changes of the \r\ncurrent column, inserting and appending new rows and has special logic for syncing the column values \r\nwith the buffer.\r\n\r\nRevision:\r\n    2017/02/10  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebGridController extends WebListController{\r\n\r\nconstructor(oList, oModel){\r\n    super(oList, oModel);\r\n    \r\n    this.iChangeToCol = null;\r\n    this.bNewRow = false;\r\n    this.tNewRow = null;\r\n    \r\n    this.iNewCount = 0;\r\n}\r\n\r\n/* \r\nAugments the selectRow with logic for new rows, column changes and it stores the newly selected row \r\ndata (for clear).\r\n*/\r\nselectRow(sGotoRow, iRow, fOptHandler, tOptSelectRowData){\r\n    const oL = this.oL, oV = this.oL._oBody || {};\r\n    \r\n    if(!oL.pbDataAware){\r\n        this.updateCacheFromColumns();\r\n    }\r\n    \r\n    /*\r\n    DF201 - WebGrid OnChange bug.\r\n    If a column is in edit mode and we use validate to check the columns and save changes if we tab to the next.\r\n    This wasn't done when using the arrow keys.\r\n    */\r\n    if (oV.oEditCol && oV.oEditCol.validate) {\r\n        // Check if the new value !== the original value with empty new rows.\r\n        if (oV.oEditCol.get(\"pbChanged\") && !oV.oEditCol.validate()) {\r\n            return false; // cancel the row move.\r\n        }\r\n    }\r\n\r\n    super.selectRow(sGotoRow, iRow, function(bSuccess, bOverridden){\r\n        var oM = this.oM, iNewRow, iPrevCol;\r\n        \r\n        //  Apply col change if still planned\r\n        if(this.iChangeToCol !== null && this.iChangeToCol !== oM.iCurrentColumn){\r\n            iPrevCol = oM.iCurrentColumn;\r\n            oM.iCurrentColumn = this.iChangeToCol;\r\n            \r\n            oM.onColChange.fire(this, {\r\n                bRowChange : bSuccess,          //  If the row change was not 'succesfull' we are not inside a row change and the views should just update\r\n                iGotoCol : this.iChangeToCol,\r\n                iPrevCol : iPrevCol\r\n            });\r\n        }\r\n        this.iChangeToCol = null;\r\n        \r\n        \r\n        if(bSuccess && oM.aData[iRow]){\r\n            //  Store orrigional values for clearing\r\n            this.tOrigRow = df.sys.json.parse(df.sys.json.stringify(oM.aData[iRow]));\r\n        }\r\n        \r\n        //  Remove new row if it wasn't changed (didn't get a rowid)\r\n        if(bSuccess && this.bNewRow){\r\n            iNewRow = oM.rowIndexByRowId(\"\");\r\n            if(iNewRow >= 0){\r\n                oM.aData.splice(iNewRow, 1);\r\n                oM.prepDisplay();\r\n                //    Refind current row\r\n                oM.iCurrentRow = oM.rowIndexByRowId(oM.sCurrentRowId);\r\n                oM.onDataUpdate.fire(this, {\r\n                    sType :\"remrow\",\r\n                    sRowId : \"\",\r\n                    iRowIndex : iNewRow\r\n                });\r\n            }\r\n            \r\n            this.bNewRow = false;\r\n        }\r\n        \r\n        if(fOptHandler){\r\n            fOptHandler.call(this, bSuccess, bOverridden);\r\n        }\r\n    }, tOptSelectRowData);\r\n}\r\n\r\n/* \r\nAugments processDataSet and makes sure update the data in the buffer with the column values.\r\n*/\r\nprocessDataSet(eOperation){\r\n    this.updateCacheFromColumns();\r\n    \r\n    super.processDataSet( eOperation);\r\n}\r\n\r\n/*\r\nThis method writes back the changes made in the column DEO's to the cache. This is only done when \r\npbNonDataAware is true and the column DEO's have been filled from the cache before.\r\n\r\n@private\r\n*/\r\nupdateCacheFromColumns(){\r\n    const oM = this.oM, oL = this.oL, iRow = oM.iCurrentRow;\r\n    let tUpdateRow = null, bChanged = false;\r\n\r\n    //  Update the column value's\r\n    if(!oL.pbDataAware){\r\n        if(iRow >= 0){\r\n            for(let iCol = 0; iCol < oL._aColumns.length; iCol++){\r\n                const oCol = oL._aColumns[iCol];\r\n                if(oCol.get('pbChanged')){\r\n                    if(!tUpdateRow){\r\n                        tUpdateRow = JSON.parse(JSON.stringify(oM.aData[iRow]));\r\n                    }\r\n                    \r\n                    const sVal = oCol.get('psValue');\r\n                    bChanged = bChanged || tUpdateRow.aCells[oCol._iColIndex].sValue !== sVal;\r\n                    tUpdateRow.aCells[oCol._iColIndex].sValue = sVal;\r\n                }\r\n            }\r\n            \r\n            //  If this is a new row and values have been changed then we generate a 'unique' id\r\n            if(tUpdateRow && (bChanged || tUpdateRow.sRowId === \"\")){\r\n                if(tUpdateRow.sRowId === \"\"){\r\n                    tUpdateRow.sRowId = \"new_\" + (this.iNewCount++);\r\n                }\r\n                oM.updateRow(oM.sCurrentRowId, tUpdateRow);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nupdateRow(sRowId, tRow, bMergeRow){\r\n    if(this.bNewRow && sRowId === \"\" && tRow.sRowId === \"\"){\r\n        tRow.sRowId = \"new_\" + (this.iNewCount++);\r\n    }\r\n    \r\n    super.updateRow( sRowId, tRow, bMergeRow);\r\n}\r\n\r\nupdateCell(oCol, sVal){\r\n    if(this.tNewRow && this.oM.sCurrentRowId === \"\"){\r\n        //  Update the new row waiting to be inserted\r\n        this.tNewRow.aCells[oCol._iColIndex].sValue = sVal;\r\n    }else{\r\n        super.updateCell( oCol, sVal);\r\n    }\r\n    \r\n}\r\n\r\nhandleData(aRows, sType, sStartRowId, bFirst, bLast){\r\n    super.handleData(aRows, sType, sStartRowId, bFirst, bLast);\r\n    \r\n    if(this.oM.aData.length === 0){\r\n        this.appendNewRow();\r\n    }\r\n}\r\n\r\ncreateNewRow(){\r\n    const oL = this.oL;\r\n    \r\n    const tNewRow = {\r\n        sRowId : \"\",\r\n        sCssClassName : \"\",\r\n        aCells : [],\r\n        iGroupHeaderIndex : -1\r\n    };\r\n    \r\n    for(let i = 0; i < oL._aColumns.length; i++){\r\n        tNewRow.aCells[oL._aColumns[i]._iColIndex] = { \r\n            sValue : ( oL._aColumns[i].peDataType === df.ciTypeBCD ? \"0\" : \"\" ),\r\n            sTooltip : \"\",\r\n            sCssClassName : \"\",\r\n            aOptions : []\r\n        };\r\n    }\r\n    \r\n    return tNewRow;\r\n}\r\n\r\n/*\r\nThis method appends a new row at the end of the grid if pbAllowAppendRow is true.\r\n\r\n@return True if append is allowed.\r\n@client-action\r\n*/\r\nappendNewRow(){\r\n    const oL = this.oL, oM = this.oM\r\n    let tNewRow;\r\n    \r\n    if(oL.pbAllowAppendRow){\r\n        this.tNewRow = tNewRow = this.createNewRow();\r\n        \r\n        this.selectRow(\"new\", -1, function(bSuccess, bOverridden){\r\n            if(bSuccess){\r\n                this.bNewRow = true;\r\n                oM.aData.push(tNewRow);\r\n                if(oM.sCurrentRowId !== tNewRow.sRowId){\r\n                    this.setCurrentRowId(tNewRow.sRowId);\r\n                }else{\r\n                    oM.iCurrentRow = oM.rowIndexByRowId(tNewRow.sRowId);\r\n                }\r\n                oM.prepDisplay();\r\n                oM.onDataUpdate.fire(this, {\r\n                    sType : \"newrow\",\r\n                    sRowId : tNewRow.sRowId,\r\n                    iRowIndex : oM.aData.length - 1\r\n                });\r\n                \r\n                if(oL.pbOfflineEditing){\r\n                    this.updateColumnsFromCache(true);\r\n                }\r\n            }\r\n            \r\n            this.tNewRow = null;\r\n        }, (!oL.pbDataAware ? tNewRow : null));\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/*\r\nThis method inserts a new row above the currently selected row. If inserting a new row is not \r\nallowed (pbAllowInsertRow) it will try to append a new row (at the end of the grid).\r\n\r\n@return True if insert or append is allowed.\r\n@client-action\r\n*/\r\ninsertNewRow(){\r\n    const oL = this.oL, oM = this.oM, iRow = oM.iCurrentRow;\r\n    let tNewRow;\r\n    \r\n    if(oL.pbAllowInsertRow){\r\n        this.tNewRow = tNewRow = this.createNewRow();\r\n        \r\n        this.selectRow(\"new\", -1, function(bSuccess, bOverridden){\r\n            if(bSuccess){\r\n                this.bNewRow = true;\r\n                \r\n                oM.aData.splice(iRow, 0, tNewRow);\r\n                \r\n                if(oM.sCurrentRowId !== tNewRow.sRowId){\r\n                    this.setCurrentRowId(tNewRow.sRowId);\r\n                }else{\r\n                    oM.iCurrentRow = oM.rowIndexByRowId(tNewRow.sRowId);\r\n                }\r\n                oM.prepDisplay();\r\n                oM.onDataUpdate.fire(this, {\r\n                    sType : \"newrow\",\r\n                    sRowId : tNewRow.sRowId,\r\n                    iRowIndex : oM.iCurrentRow\r\n                });\r\n                \r\n                if(oL.pbOfflineEditing){\r\n                    this.updateColumnsFromCache(true);\r\n                }\r\n                \r\n                this.tNewRow = null;\r\n            }\r\n        }, (!oL.pbDataAware ? tNewRow : null));\r\n        return true;\r\n    }\r\n    \r\n    return this.appendNewRow();\r\n}\r\n\r\n/* \r\nImitates a clearRow for a non data aware grid where it basically goes back to the orrigional row in \r\nthe buffer. Only works for the currently selected row.\r\n\r\n@param  sRowId  The rowid to clear.\r\n*/\r\nclearRow(sRowId){\r\n    const oM = this.oM, oL = this.oL;\r\n    let oCol;\r\n\r\n    if(sRowId === oM.sCurrentRowId){\r\n        const iRow = oM.iCurrentRow;\r\n            \r\n        if(iRow >= 0){\r\n            for(let iCol = 0; iCol < oL._aColumns.length; iCol++){\r\n                oCol = oL._aColumns[iCol];\r\n                if(oCol.get('pbChanged')){\r\n                    oCol.set('psValue', (this.tOrigRow && this.tOrigRow.aCells[oCol._iColIndex].sValue) || \"\");\r\n                    oCol.set('pbChanged', false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nsetCurrentRowId(sRowId){\r\n    const oM = this.oM;\r\n    \r\n    //  Apply col change if planned\r\n    if(sRowId !== oM.sCurrentRowId && this.iChangeToCol !== null && this.iChangeToCol !== oM.iCurrentColumn){\r\n        const iPrevCol = oM.iCurrentColumn;\r\n        oM.iCurrentColumn = this.iChangeToCol;\r\n        \r\n        oM.onColChange.fire(this, {\r\n            bRowChange : true,\r\n            iGotoCol : this.iChangeToCol,\r\n            iPrevCol : iPrevCol\r\n        });\r\n        \r\n        this.iChangeToCol = null;\r\n    }\r\n    \r\n    super.setCurrentRowId( sRowId);\r\n}\r\n\r\ncellClick(oEv, sRowId, iCol){\r\n    const oM = this.oM, oL = this.oL;\r\n    \r\n    if(iCol >= 0 && iCol !== oM.iCurrentColumn &&\r\n        oL._aColumns[iCol].pbEditable){\r\n        this.iChangeToCol = iCol;\r\n    }\r\n    if(sRowId === \"empty\"){\r\n        this.appendNewRow();\r\n    }\r\n    \r\n    super.cellClick( oEv, sRowId, iCol);\r\n}\r\n\r\n\r\n/*\r\nThis method selects the previous column that is enabled and visible. If the first column is selected \r\nit moves to the previous row.\r\n\r\n@client-action\r\n*/\r\nprevCol(){\r\n    const oM = this.oM, oL = this.oL;\r\n    let iCol, bPrevRow = false;\r\n    \r\n    //  Determine next available column\r\n    iCol = oM.iCurrentColumn;\r\n\r\n    for (let i = 0; i < oL._aColumnMapper.length; i++) {\r\n        if (oL._aColumnMapper[i]._iCol === iCol) {\r\n            iCol = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    do{\r\n        iCol--;\r\n        //  If we get passed the first column we move to the previous row\r\n        if(iCol < 0){\r\n            if(bPrevRow){\r\n                break;\r\n            }\r\n            bPrevRow = true;\r\n            iCol = oL._aColumnMapper.length - 1;\r\n        }\r\n    }while(!oL._aColumnMapper[iCol].isEnabled() || !oL._aColumnMapper[iCol].pbEditable || !oL._aColumnMapper[iCol].pbRender || oL._aColumnMapper[iCol].pbHidden || !oL._aColumnMapper[iCol].pbVisible);\r\n    \r\n    iCol = oL._aColumnMapper[iCol]._iCol;\r\n    \r\n    if(bPrevRow){\r\n        if(oM.iCurrentRow > 0){\r\n            this.iChangeToCol = iCol;\r\n            this.selectRow(\"row\", (oM.iCurrentRow - 1));\r\n            \r\n            return true;\r\n        }\r\n    }else if(iCol !== oM.iCurrentColumn){\r\n        const iPrevCol = oM.iCurrentColumn;\r\n        oM.iCurrentColumn = iCol;\r\n        \r\n        oM.onColChange.fire(this, {\r\n            bRowChange : bPrevRow,\r\n            iGotoCol : iCol,\r\n            iPrevCol : iPrevCol\r\n        });\r\n        \r\n        return true;\r\n    }\r\n\r\n    \r\n    return false;\r\n}\r\n\r\n/*\r\nThis method selects the next column that is enabled and visible. If the last column is selected it \r\nmoves to the next row.\r\n\r\n@client-action\r\n*/\r\nnextCol(){\r\n    const oL = this.oL, oM = this.oM;\r\n    let iCol, bNextRow;\r\n    \r\n    //  Determine next available column\r\n    iCol = oM.iCurrentColumn;\r\n\r\n    for (let i = 0; i < oL._aColumnMapper.length; i++) {\r\n        if (oL._aColumnMapper[i]._iCol === iCol) {\r\n            iCol = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if(!oL._aColumnMapper[iCol].isEnabled() || (oL._aColumnMapper[iCol].validate && oL._aColumnMapper[iCol].validate())){\r\n    \r\n        do{\r\n            iCol++;\r\n            //  If we get passed the first column we move to the next row\r\n            if(iCol >= oL._aColumnMapper.length){\r\n                if(bNextRow){\r\n                    break;\r\n                }\r\n                bNextRow = true;\r\n                iCol = 0;\r\n            }\r\n        }while(!oL._aColumnMapper[iCol].isEnabled() || !oL._aColumnMapper[iCol].pbEditable || !oL._aColumnMapper[iCol].pbRender || oL._aColumnMapper[iCol].pbHidden || !oL._aColumnMapper[iCol].pbVisible);\r\n        \r\n        iCol = oL._aColumnMapper[iCol]._iCol;\r\n\r\n        if(bNextRow){\r\n            this.iChangeToCol = iCol;\r\n            \r\n            if(oM.iCurrentRow < oM.aData.length - 1){\r\n                this.selectRow(\"row\", oM.iCurrentRow + 1);\r\n                \r\n                return true;\r\n            }else{\r\n                return this.appendNewRow();\r\n            }\r\n        }else if(iCol !== oM.iCurrentColumn){\r\n            const iPrevCol = oM.iCurrentColumn;\r\n            oM.iCurrentColumn = iCol;\r\n            \r\n            oM.onColChange.fire(this, {\r\n                bRowChange : false,\r\n                iGotoCol : iCol,\r\n                iPrevCol : iPrevCol\r\n            });\r\n            \r\n            return true;\r\n        }\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\n/*\r\nThis method selects a specific column. \r\n\r\n@param  iCol    The index of the column to select.\r\n@client-action\r\n*/\r\nselectCol(iCol){\r\n    const oM = this.oM, oL = this.oL;\r\n    \r\n    if(iCol >= 0 && iCol < oL._aColumns.length && oL._aColumns[iCol].pbRender){\r\n        const iPrevCol = oM.iCurrentColumn;\r\n        oM.iCurrentColumn = iCol;\r\n        \r\n        oM.onColChange.fire(this, {\r\n            bRowChange : false,\r\n            iGotoCol : iCol,\r\n            iPrevCol : iPrevCol\r\n        });\r\n    }\r\n}\r\n\r\n/*\r\nThis method augments the WebList onKeyDown method with the next & previous column functionality. \r\n\r\n@param  oEv  The event object.\r\n@return False if we did handle the event and performed an action, true if we didn't do anything.\r\n@private\r\n*/\r\nkeyDown(oJSEvent){\r\n    const oEv = oJSEvent.oDOMEvent;\r\n\r\n    if(oEv.matchKey(df.settings.gridKeys.prevCol)){ \r\n        if(this.prevCol()){\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n    }else if(oEv.matchKey(df.settings.gridKeys.nextCol)){ \r\n        if(this.nextCol()){\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n    }else if(oEv.matchKey(df.settings.gridKeys.newRow)){ \r\n        if(this.insertNewRow()){\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n    }else{\r\n        return super.keyDown(oJSEvent);\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\n/*\r\nAugments the moveDownRow function and inserts a new row if no next row was available.\r\n\r\n@client-action\r\n*/\r\nmoveDownRow(){\r\n    if(!super.moveDownRow.call(this)){\r\n        if(!this.oM.bPaged || this.oM.bLast){\r\n            return this.appendNewRow();\r\n        }\r\n        \r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n    \r\n}\r\n\r\n","import { WebGridView, WebGridScrollingView } from './WebGridView.js';\r\nimport { WebGridModel, WebGridPagedModel } from './WebGridModel.js';\r\nimport { WebGridController } from './WebGridController.js';\r\nimport { WebList } from './WebList.js';\t\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebGrid\r\nExtends:\r\n    df.WebList\r\n\r\nThis is the client-side representation of the cWebGrid control. It extends the cWebList control with \r\nedit functionality. Editing means that the selected cell value is replaced with an edit control \r\n(usually an input element). The nested column object is responsible for creating the DOM elements \r\nfor editing, the grid is only responsible for adding it to the DOM and removing it from the DOM. \r\nSaving is usually done automatically by the server when the ChangeCurrentRow event is fired on the \r\nserver.\r\n    \r\nRevision:\r\n    2011/12/15  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebGrid extends WebList {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbAllowInsertRow\", true);\r\n        this.prop(df.tBool, \"pbAllowAppendRow\", true);\r\n        this.prop(df.tInt, \"piCurrentColumn\", 0);\r\n\r\n\r\n        //  Configure super classes\r\n        this.pbAutoSearch = false;\r\n\r\n        this.addSync(\"piCurrentColumn\");\r\n        this._bRenderChildren = true;\r\n        this._sControlClass = \"WebGrid\";\r\n\r\n    }\r\n\r\n    createView() {\r\n        if (this.pbScroll) {\r\n\r\n            return new WebGridScrollingView(this, this._oModel, this._oController);\r\n        } else {\r\n            return new WebGridView(this, this._oModel, this._oController);\r\n        }\r\n    }\r\n\r\n    createController() {\r\n        return new WebGridController(this, this._oModel);\r\n    }\r\n\r\n    createModel() {\r\n        if (this.peDbGridType === df.gtAllData || this.peDbGridType === df.gtManual || !this.pbDataAware || !this.pbScroll) {\r\n            return new WebGridModel(this);\r\n        } else {\r\n            return new WebGridPagedModel(this);\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Implementation of the renderChildren method that makes sure that the grid columns render themselves. \r\n    The DOM elements of the columns are not inserted into the DOM yet. They are used later when a cell \r\n    is edited.\r\n    */\r\n    renderChildren() {\r\n        const oM = this._oModel;\r\n        let oVisCol = null, oSelCol = null;\r\n\r\n        for (let i = 0; i < this._aColumns.length; i++) {\r\n            this._aColumns[i].pbShowLabel = false;\r\n            this._aColumns[i].render();\r\n            this._aColumns[i].afterRender();\r\n\r\n            //  Determine the initial column\r\n            if (oVisCol == null && this._aColumns[i].pbRender) {\r\n                oVisCol = this._aColumns[i];\r\n            }\r\n            if (oSelCol == null && this._aColumns[i].pbRender && this._aColumns[i].isEnabled()) {\r\n                oSelCol = this._aColumns[i];\r\n            }\r\n        }\r\n\r\n        //  Set the initial column (unless the application specified a specific column)\r\n        if (oM.iCurrentColumn < 0) {\r\n            if (oSelCol) {\r\n                oM.iCurrentColumn = oSelCol._iCol;\r\n            } else if (oVisCol) {\r\n                oM.iCurrentColumn = oVisCol._iCol;\r\n            } else {\r\n                oM.iCurrentColumn = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    applyEnabled(bVal) {\r\n        //  Skip WebList and go into WebControl since _eFocus never has tabindex for grid\r\n        super.applyEnabled(bVal);\r\n    }\r\n\r\n    // - - - - Server API - - - - \r\n    /*\r\n    This method selects the previous column that is enabled and visible. If the first column is selected \r\n    it moves to the previous row.\r\n    \r\n    @client-action\r\n    */\r\n    prevCol() {\r\n        this._oController.prevCol();\r\n    }\r\n\r\n    /*\r\n    This method selects the next column that is enabled and visible. If the last column is selected it \r\n    moves to the next row.\r\n    \r\n    @client-action\r\n    */\r\n    nextCol() {\r\n        this._oController.nextCol();\r\n    }\r\n\r\n    /*\r\n    This method selects a specific column. \r\n    \r\n    @param  iCol    The index of the column to select.\r\n    @client-action\r\n    */\r\n    selectCol(iCol) {\r\n        this._oController.selectCol(iCol);\r\n    }\r\n\r\n    /*\r\n    This method inserts a new row above the currently selected row. If inserting a new row is not \r\n    allowed (pbAllowInsertRow) it will try to append a new row (at the end of the grid).\r\n    \r\n    @return True if insert or append is allowed.\r\n    @client-action\r\n    */\r\n    insertNewRow() {\r\n        return this._oController.insertNewRow();\r\n    }\r\n\r\n    /*\r\n    This method appends a new row at the end of the grid if pbAllowAppendRow is true.\r\n    \r\n    @return True if append is allowed.\r\n    @client-action\r\n    */\r\n    appendNewRow() {\r\n        return this._oController.appendNewRow();\r\n    }\r\n\r\n    clearRow(sRowId) {\r\n        return this._oController.clearRow(sRowId);\r\n    }\r\n\r\n    /* \r\n    Getter method for piCurrentColumn.\r\n    */\r\n    get_piCurrentColumn() {\r\n        return this._oModel.iCurrentColumn;\r\n    }\r\n\r\n    set_piCurrentColumn(iVal) {\r\n        this._oController.selectCol(iVal);\r\n    }\r\n\r\n    // - - - - - - - Focus - - - - - - -\r\n\r\n    attachFocusEvents() {\r\n        //  Set the tabIndex of the focus holder negative so that we can tab in and out of the grid\r\n        this._eFocus.tabIndex = -1;\r\n\r\n        super.attachFocusEvents();\r\n    }\r\n\r\n    /*\r\n    We override the focus method and we pass the focus the edit element. If the edit element is not \r\n    rendered we give the focus to the focus holder.\r\n    \r\n    @return True if the List can take the focus.\r\n    */\r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eFocus) {\r\n            //  Try to give the focus to the edit cell if it is visible\r\n            if (!this._oBody.focus()) {\r\n                //  If the column couldn't take the focus we pass it to the focus holder\r\n                this._eFocus.focus();\r\n                this.objFocus();\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n}","import { WebListController } from './WebListController.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMuliSelectListController\r\nExtends:\r\n    df.WebListController\r\n\r\nThis is an extention on the WebList to allow for multi-selection of rows.\r\n    \r\nRevision:\r\n    2022/07/06  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMultiSelectListController extends WebListController{\r\n\r\n    constructor(oList, oModel) {\r\n        super(oList, oModel);\r\n\r\n        this._bAllChecked = false;\r\n        this._iBeginRange = -1;\r\n    }\r\n\r\n\r\n    /*\r\n    This method handles the keypress event and initiates the actions bound to it. The \r\n    df.settings.listKeys define the exact key code's / combinations for the different actions.\r\n    \r\n    @param  oJsEv  The JSevent object, oDOMEvent contains the actual key event.\r\n    @return False if we did handle the event and performed an action, true if we didn't do anything.\r\n    */\r\n    keyDown(oJsEv) {\r\n        const oEv = oJsEv.oDOMEvent;\r\n        let oL = this.oL, oM = this.oM;\r\n\r\n        if (!oL._bHasFocus) {\r\n            return;\r\n        }\r\n\r\n        if (!oL.pbKeyboardSelection) {\r\n            oEv.stop();\r\n            return;\r\n        }\r\n\r\n        if (oEv.matchKey(df.settings.listKeys.select)) {\r\n            this.toggleCurrentRow();\r\n\r\n            oEv.stop();\r\n            return false;\r\n        } else if (oEv.matchKey(df.settings.listKeys.selectAll)) {\r\n            this.toggleSelectAll();\r\n\r\n            oEv.stop();\r\n            return false;\r\n        } else if (oEv.matchKey(df.settings.listKeys.deSelectAll)) {\r\n            this.clearSelection();\r\n\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n\r\n        if (oEv.matchKey(df.settings.listKeys.scrollUp) ||\r\n            oEv.matchKey(df.settings.listKeys.scrollDown) ||\r\n            oEv.matchKey(df.settings.listKeys.scrollPageUp) ||\r\n            oEv.matchKey(df.settings.listKeys.scrollPageDown) ||\r\n            oEv.matchKey(df.settings.listKeys.scrollTop) ||\r\n            oEv.matchKey(df.settings.listKeys.scrollBottom)) {\r\n            // Make row change first\r\n            let bReturn = super.keyDown(oJsEv);\r\n\r\n            if (oL.pbSelectionByRow) {\r\n                this.clearSelection();\r\n                this.setCurrentRow(true);\r\n            }\r\n            this._iBeginRange = -1;\r\n\r\n            return bReturn;\r\n        } else if (oEv.matchKey(df.settings.listKeys.scrollRangeUp)) {\r\n            if (this._iBeginRange === -1)\r\n                this._iBeginRange = oM.iCurrentRow;\r\n\r\n            this.clearSelection();\r\n            this.moveUpRow();\r\n\r\n            for (let i = Math.min(oM.iCurrentRow, this._iBeginRange); i <= Math.max(oM.iCurrentRow, this._iBeginRange); i++) {\r\n                let sSubRowId = oM.rowIdByRowIndex(i);\r\n                if (sSubRowId) {\r\n                    this.setSelection(sSubRowId, true); //!< force selection.\r\n                }\r\n            }\r\n\r\n            oEv.stop();\r\n            return false;\r\n        } else if (oEv.matchKey(df.settings.listKeys.scrollRangeDown)) {\r\n            if (this._iBeginRange === -1)\r\n                this._iBeginRange = oM.iCurrentRow;\r\n\r\n            this.clearSelection();\r\n            this.moveDownRow();\r\n\r\n            for (let i = Math.min(oM.iCurrentRow, this._iBeginRange); i <= Math.max(oM.iCurrentRow, this._iBeginRange); i++) {\r\n                let sSubRowId = oM.rowIdByRowIndex(i);\r\n                if (sSubRowId) {\r\n                    this.setSelection(sSubRowId, true); //!< force selection.\r\n                }\r\n            }\r\n\r\n            oEv.stop();\r\n            return false;\r\n        }\r\n\r\n        return super.keyDown(oJsEv)\r\n    }\r\n\r\n    /* \r\n    Handles the click on a cell inside the list. Triggers click events on the column object and changes \r\n    the current row.\r\n \r\n    @param  oEv     DOM Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  iCol    Column that is clicked.  \r\n    @param  bNoRowChange    Whether to not change the row.  \r\n    */\r\n    cellClick(oEv, sRowId, iCol, bNoRowChange) {\r\n        let oL = this.oL, oM = this.oM;\r\n        let iRow = oM.rowIndexByRowId(sRowId);\r\n        let bNoChangeRow = bNoRowChange ? true : false;\r\n\r\n        if (sRowId !== \"empty\") {\r\n            if (oL.pbKeyboardSelection && oEv.e.ctrlKey) {\r\n                this.toggleSelectionOfRow(sRowId);\r\n            } else if (oL.pbKeyboardSelection && oEv.e.shiftKey) {\r\n                this.clearSelection();\r\n\r\n                let i = this._iBeginRange = this._iBeginRange !== -1 ? this._iBeginRange : oM.iCurrentRow;\r\n                let downWards = iRow >= i;\r\n                let iDiff = downWards ? 1 : -1;\r\n\r\n                this.selectRow(\"row\", iRow);\r\n\r\n                // We go one further as the while loop will stop after the last selected.\r\n                iRow += iDiff;\r\n\r\n                while (i !== iRow) {\r\n                    let sSubRowId = oM.rowIdByRowIndex(i);\r\n                    if (sSubRowId) {\r\n                        this.setSelection(sSubRowId, true); //!< force selection.\r\n                    }\r\n                    i += iDiff;\r\n                }\r\n\r\n                bNoChangeRow = true;\r\n            } else if (oL.pbSelectionByRow) {\r\n                this.clearSelection();\r\n                if (iRow >= 0) {\r\n                    this.setSelection(sRowId, true); //!< force selection.\r\n                }\r\n            } else if (iCol >= 0 && oL._aColumns[iCol]._bIsMultiSelectCapable) {\r\n                this.setSelection(sRowId, !oL.isRowIdSelected(sRowId));\r\n            }\r\n        }\r\n\r\n        let bReturn = super.cellClick(oEv, sRowId, iCol, bNoChangeRow);\r\n\r\n        if (!bNoChangeRow) {\r\n            this._iBeginRange = -1;\r\n        }\r\n\r\n        oEv.stop();\r\n\r\n        return bReturn;\r\n    }\r\n\r\n    /* \r\n    Handles the click on a column header. Triggers the OnHeaderClick event and changes the sorting if \r\n    needed.\r\n    \r\n    @param  oEv     DOM event object.\r\n    @param  iCol    Column index.\r\n    */\r\n    headClick(oEv, iCol) {\r\n        let oL = this.oL, oCol = oL._aColumns[iCol];\r\n\r\n        if (oCol && oCol._bIsMultiSelectCapable) {\r\n            let eTarget = oEv.getTarget();\r\n\r\n            if (eTarget.classList.contains('WebCB_Fake')) {\r\n                this.toggleSelectAll();\r\n\r\n                oEv.stop();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return super.headClick(oEv, iCol);;\r\n    }\r\n\r\n    toggleSelectAll() {\r\n        if (!this._bAllChecked) {\r\n            this.selectAll();\r\n        } else {\r\n            this.clearSelection();\r\n        }\r\n\r\n        this._iBeginRange = -1;\r\n    }\r\n\r\n    setAllSelectedCheckboxState(bAllSelected, bRedraw = true) {\r\n        let oH = this.oL._oHeader;\r\n\r\n        this._bAllChecked = bAllSelected;\r\n\r\n        if (bRedraw) oH.updateHeader();\r\n    }\r\n\r\n    areAllRowsSelected() {\r\n        return this._bAllChecked;\r\n    }\r\n\r\n    toggleCurrentRow() {\r\n        const oM = this.oM;\r\n\r\n        if (oM.sCurrentRowId) {\r\n            if (oM.sCurrentRowId.length > 0) {\r\n                this.toggleSelectionOfRow(oM.sCurrentRowId);\r\n            }\r\n        }\r\n    }\r\n\r\n    setCurrentRow(bSelected) {\r\n        const oM = this.oM;\r\n\r\n        if (oM.sCurrentRowId) {\r\n            if (oM.sCurrentRowId.length > 0) {\r\n                this.setSelection(oM.sCurrentRowId, bSelected);\r\n            }\r\n        }\r\n    }\r\n\r\n    toggleSelectionOfRow(sRowId, optNoThrowEvents) {\r\n        const oL = this.oL, oM = this.oM;\r\n\r\n        let iIndex = oL._paSelectedRowIds.findIndex(_sRowId => _sRowId === sRowId);\r\n        if (iIndex >= 0) {\r\n            oL._paSelectedRowIds.splice(iIndex, 1);\r\n            if (!optNoThrowEvents)\r\n                this.fireSelectionEvent(\"OnDeSelectRow\", oM.rowByRowId(sRowId));\r\n            oL._oBody.refreshRow(sRowId, sRowId);\r\n        } else {\r\n            oL._paSelectedRowIds.push(sRowId);\r\n            if (!optNoThrowEvents)\r\n                this.fireSelectionEvent(\"OnSelectRow\", oM.rowByRowId(sRowId));\r\n            oL._oBody.refreshRow(sRowId, sRowId);\r\n        }\r\n\r\n        this.setAllSelectedCheckboxState(false);\r\n    }\r\n\r\n    isCurrentRowSelected() {\r\n        const oL = this.oL, oM = this.oM;\r\n        if (!oM.sCurrentRowId || oM.sCurrentRowId.length <= 0)\r\n            return false;\r\n\r\n        return oL._paSelectedRowIds.findIndex(_sRowId => _sRowId === oM.sCurrentRowId) >= 0;\r\n    }\r\n\r\n    setSelection(sRowId, bValue, optNoThrowEvents) {\r\n        const oL = this.oL, oM = this.oM;\r\n\r\n        let iIndex = oL._paSelectedRowIds.findIndex(_sRowId => _sRowId === sRowId);\r\n        if (bValue && iIndex == -1) {\r\n            oL._paSelectedRowIds.push(sRowId);\r\n            if (!optNoThrowEvents)\r\n                this.fireSelectionEvent(\"OnSelectRow\", oM.rowByRowId(sRowId));\r\n            oL._oBody.refreshRow(sRowId, sRowId);\r\n        } else if (!bValue && iIndex >= 0) {\r\n            oL._paSelectedRowIds.splice(iIndex, 1);\r\n            if (!optNoThrowEvents)\r\n                this.fireSelectionEvent(\"OnDeSelectRow\", oM.rowByRowId(sRowId));\r\n            oL._oBody.refreshRow(sRowId, sRowId);\r\n        }\r\n\r\n        this.setAllSelectedCheckboxState(false);\r\n    }\r\n\r\n    selectAll() {\r\n        let oL = this.oL, oM = this.oM;\r\n\r\n        oL._paSelectedRowIds = [];\r\n\r\n        for (let i = 0; i < oM.aData.length; i++) {\r\n            oL._paSelectedRowIds.push(oM.aData[i].sRowId)\r\n            oL._oBody.refreshRow(oM.aData[i].sRowId, oM.aData[i].sRowId);\r\n        }\r\n\r\n        this.setAllSelectedCheckboxState(true);\r\n        this.fireSelectionEvent(\"OnSelectAllRows\");\r\n    }\r\n\r\n    clearSelection() {\r\n        let oL = this.oL, aCache = oL._paSelectedRowIds.slice();\r\n\r\n        oL._paSelectedRowIds = [];\r\n\r\n        for (let i = 0; i < aCache.length; i++) {\r\n            oL._oBody.refreshRow(aCache[i], aCache[i]);\r\n        }\r\n\r\n        this.setAllSelectedCheckboxState(false);\r\n        this.fireSelectionEvent(\"OnDeSelectAllRows\");\r\n    }\r\n\r\n    fireSelectionEvent(sEvent, tNullableRow) {\r\n        let oL = this.oL;\r\n\r\n        const eSelectionEvents = {\r\n            C_WEBLIST_MULTI_SELECT_NULL: 0,\r\n            C_WEBLIST_MULTI_SELECT_SINGLE: 1,\r\n            C_WEBLIST_MULTI_DESELECT_SINGLE: 2,\r\n            C_WEBLIST_MULTI_SELECT_ALL: 3,\r\n            C_WEBLIST_MULTI_DESELECT_ALL: 4\r\n        }\r\n\r\n        let eEventType = eSelectionEvents.C_WEBLIST_MULTI_SELECT_NULL;\r\n        switch (sEvent) {\r\n            case \"OnSelectRow\":\r\n                eEventType = eSelectionEvents.C_WEBLIST_MULTI_SELECT_SINGLE;\r\n                if (tNullableRow === undefined || tNullableRow === null) return;\r\n                break;\r\n            case \"OnDeSelectRow\":\r\n                eEventType = eSelectionEvents.C_WEBLIST_MULTI_DESELECT_SINGLE;\r\n                if (tNullableRow === undefined || tNullableRow === null) return;\r\n                break;\r\n            case \"OnSelectAllRows\":\r\n                eEventType = eSelectionEvents.C_WEBLIST_MULTI_SELECT_ALL;\r\n                break;\r\n            case \"OnDeSelectAllRows\":\r\n                eEventType = eSelectionEvents.C_WEBLIST_MULTI_DESELECT_ALL;\r\n                break;\r\n            default:\r\n                throw new df.Error(999, \"Invalid selection Event\");\r\n        }\r\n\r\n        oL.addSync(\"paSelectedRowIds\");\r\n\r\n        oL.fireEx({\r\n            sEvent: sEvent,\r\n            aParams: [eEventType],\r\n            tActionData: tNullableRow,\r\n            sAltServerName: \"privateOnSelectEvent\"\r\n        });\r\n    }\r\n}","import { WebListRowModel  } from './WebListRowModel.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMultiSelectListRowModel\r\nExtends:\r\n    df.WebListRowModel\r\n\r\nThis is an extention on the WebList to allow for multi-selection of rows.\r\n    \r\nRevision:\r\n    2022/07/06  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMultiSelectListRowModel extends WebListRowModel {\r\n    constructor(oList, oModel) {\r\n        super(oList, oModel);\r\n\r\n        this._sCSSSelectedClass = \"WebList_MultiSelected\";\r\n        this._sCSSUnSelectedClass = \"WebList_MultiUnSelected\";\r\n    }\r\n\r\n    /* \r\n    This function determines the classnames that are set on a list row. If an additional data member is \r\n    available in the row data that is used as CSS classname as well.\r\n\r\n    @param  tRow    Row data.\r\n    @param  bZebra  True if this is an odd row, false for an even row.\r\n    @private\r\n    */\r\n    rowClass(tRow, bZebra) {\r\n        if (!tRow) //!< Placeholder rows should not have an Unselected logically.\r\n            return super.rowClass(tRow, bZebra)\r\n\r\n        if (this.oL._paSelectedRowIds.find(sRowId => sRowId === tRow.sRowId)) {\r\n            return super.rowClass(tRow, bZebra) + \" \" + this._sCSSSelectedClass;\r\n        } else {\r\n            return super.rowClass(tRow, bZebra) + \" \" + this._sCSSUnSelectedClass;\r\n        }\r\n    }\r\n}","import { WebList } from './WebList.js';\r\nimport { WebMultiSelectListController } from './WebMultiSelectListController.js';\r\nimport { WebMultiSelectListRowModel } from './WebMultiSelectListRowModel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMuliSelectList\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is an extention on the WebList to allow for multi-selection of rows.\r\n    \r\nRevision:\r\n    2022/07/06  (BN, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebMuliSelectList extends WebList {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this._sControlClass = \"WebMultiSelectList WebList\";\r\n\r\n        this._aMultiSelectColumns = [];\r\n\r\n        this.prop(df.tAdv, \"paSelectedRowIds\", null);\r\n        this.prop(df.tBool, \"pbSelectionByRow\", true);\r\n        this.prop(df.tBool, \"pbKeyboardSelection\", true);\r\n\r\n        this.event(\"OnSelectRow\", df.cCallModeDefault);\r\n        this.event(\"OnDeSelectRow\", df.cCallModeDefault);\r\n        this.event(\"OnSelectAllRows\", df.cCallModeDefault);\r\n        this.event(\"OnDeSelectAllRows\", df.cCallModeDefault);\r\n\r\n        this._paSelectedRowIds = []; //!< Initialize it to a normal JS array instead of a value tree.\r\n    }\r\n\r\n    /*\r\n    Augmenting the addChild method to filter out columns and the swipe buttons.\r\n\r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        if (oChild._bIsColumn && oChild._bIsMultiSelectCapable) {\r\n            this._aMultiSelectColumns.push(oChild);\r\n        }\r\n\r\n        super.addChild(oChild);\r\n    }\r\n\r\n    /* \r\n    Creates the controller module. Can be augmented for customization.\r\n    */\r\n    createController() {\r\n        return new WebMultiSelectListController(this, this._oModel);\r\n    }\r\n\r\n    /*\r\n    Creates the row model module. Can be augmented for customization.\r\n    */\r\n    createRowModel() {\r\n        return new WebMultiSelectListRowModel(this, this._oModel);\r\n    }\r\n\r\n    set_paSelectedRowIds(aSelectedRowIds) {\r\n        aSelectedRowIds = df.sys.vt.deserialize(aSelectedRowIds, [df.tString]);\r\n        if (!Array.isArray(aSelectedRowIds)) {\r\n            aSelectedRowIds = [];\r\n        }\r\n\r\n        // Compare the two arrays.\r\n        if (!aSelectedRowIds || !(aSelectedRowIds.length === this._paSelectedRowIds.length && aSelectedRowIds.every((value, index) => {\r\n            return value === this._paSelectedRowIds[index];\r\n        }))) {\r\n            this._paSelectedRowIds = aSelectedRowIds;\r\n            this._oController.setAllSelectedCheckboxState(false, false);\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    get_paSelectedRowIds() {\r\n        return df.sys.vt.serialize(this._paSelectedRowIds, [df.tString]);\r\n    }\r\n\r\n    isRowIdSelected(sRowId) {\r\n        return this._paSelectedRowIds.find(sSelectedRow => sSelectedRow === sRowId);\r\n    }\r\n\r\n    hasCheckboxColumn() {\r\n        return this._aMultiSelectColumns.length > 0;\r\n    }\r\n\r\n    gridRefresh(bFirst, bLast) {\r\n        this._oController.setAllSelectedCheckboxState(false);\r\n        super.gridRefresh(bFirst, bLast);\r\n    }\r\n\r\n    handleDataPage(sType, sStartRowId, bFirst, bLast) {\r\n        this._oController.setAllSelectedCheckboxState(false);\r\n        super.handleDataPage(sType, sStartRowId, bFirst, bLast);\r\n    }\r\n\r\n    dataSetAppendRow() {\r\n        this._oController.setAllSelectedCheckboxState(false);\r\n        super.dataSetAppendRow();\r\n    }\r\n\r\n    dataSetInsertRowBefore(sBeforeRowID) {\r\n        this._oController.setAllSelectedCheckboxState(false);\r\n        super.dataSetInsertRowBefore(sBeforeRowID);\r\n    }\r\n\r\n    dataSetInsertRowAfter(sAfterRowID) {\r\n        this._oController.setAllSelectedCheckboxState(false);\r\n        super.dataSetInsertRowAfter(sAfterRowID);\r\n    }\r\n\r\n    dataSetRemoveRow(sRowId) {\r\n        this._oController.setSelection(sRowId, false);\r\n        super.dataSetRemoveRow(sRowId);\r\n    }\r\n\r\n    removeRow(sRowId) {\r\n        this._oController.setSelection(sRowId, false);\r\n        super.removeRow(sRowId);\r\n    }\r\n\r\n    determineSelectorForWebUIContext(eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListSelection:\r\n                return \".WebList_MultiSelected\";\r\n            default:\r\n                return super.determineSelectorForWebUIContext(eContext);\r\n        }\r\n    }\r\n\r\n    retrieveValueFromWebUIContext(eElem, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextListSelection:\r\n                return this._paSelectedRowIds.join(',');\r\n            default:\r\n                return super.retrieveValueFromWebUIContext(eElem, eContext);\r\n        }\r\n    }\r\n\r\n    // Dragdrop\r\n    getDragData(oEv, eDraggedElem) {\r\n        try {\r\n            const itemId = eDraggedElem.getAttribute(\"data-dfrowid\") || -1;\r\n            let items;\r\n\r\n            if (itemId && itemId != \"empty\" && itemId != -1 && (itemId != '' || itemId >= 0)) {\r\n\r\n                // Destructure object to create a clone, then remove any privates - prevents circular json eror\r\n                items = [];\r\n                if (this._paSelectedRowIds.includes(itemId)) {\r\n                    this._paSelectedRowIds.forEach(\r\n                        rowId => items.push({ ...this._oModel.aData[(this._oModel.rowIndexByRowId(rowId))] })\r\n                    );\r\n                } else {\r\n                    items.push({ ...this._oModel.aData[(this._oModel.rowIndexByRowId(itemId))] });\r\n                }\r\n\r\n                items.forEach(\r\n                    item => Object.keys(item).forEach(function (key) {\r\n                        key.indexOf(\"_\") == 0 && delete item[key];\r\n                    })\r\n                );\r\n\r\n                return [\r\n                    { data: items },\r\n                    this._paSelectedRowIds.includes(itemId) ?\r\n                        df.dragActions.WebMultiSelectList.ciDragRowSelection :\r\n                        df.dragActions.WebList.ciDragRow\r\n                ]\r\n            }\r\n\r\n            return [null, null];\r\n        } catch (err) {\r\n            // This can happen if the drag action is not supported, we don't want a nasty error if so.\r\n            console.error(\"Attempt to perform unsupported drag action\");\r\n            return [null, null];\r\n        }\r\n    }\r\n\r\n    onDragStart(oEv) {\r\n        // oEv.e.preventDefault();\r\n        // oEv.e.stopPropagation();\r\n\r\n        var [oDragData, eDragAction] = this.getDragData(oEv, oEv.e.target);\r\n\r\n        if (oDragData && eDragAction) {\r\n            oEv.e.stopPropagation();\r\n\r\n            if (!this._eTempCrt && eDragAction === df.dragActions.WebMultiSelectList.ciDragRowSelection) {\r\n                this._eTempCrt = document.createElement(\"div\");\r\n                this._eTempCrt.classList.add(\"WebMultiSelectList\");\r\n                this._eTempCrt.classList.add(\"WebDragDropMultiSelectionGhost\");\r\n\r\n                this._eTempCrt.style.position = \"absolute\";\r\n                this._eTempCrt.style.top = \"0px\";\r\n                this._eTempCrt.style.right = \"0px\";\r\n                this._eTempCrt.style.bottom = \"0px\";\r\n                this._eTempCrt.style.width = \"max-content\";\r\n                this._eTempCrt.style.height = \"20px\";\r\n                this._eTempCrt.style.padding = \"7px\";\r\n                this._eTempCrt.style.backgroundColor = \"white\";\r\n                this._eTempCrt.style.border = \"solid gray 1px\";\r\n                this._eTempCrt.style[\"border-radius\"] = \"5px\";\r\n                this._eTempCrt.style[\"z-index\"] = \"-1\";\r\n\r\n                let text = document.createElement(\"p\");\r\n                text.innerText = this._paSelectedRowIds.length + this.getWebApp().getTrans(\"rows\");\r\n                this._eTempCrt.appendChild(text);\r\n\r\n                document.body.appendChild(this._eTempCrt);\r\n                oEv.e.dataTransfer.setDragImage(this._eTempCrt, 0, 0);\r\n            }\r\n\r\n            // Notify helpers we're starting a drag\r\n            this._aDragDropHelpers.forEach(oHelper => {\r\n                oHelper.onDragStart(oEv, this, oEv.e.target, oDragData, eDragAction);\r\n            });\r\n        }\r\n\r\n        // return false;\r\n    }\r\n\r\n    onDragEnd(oEv) {\r\n        // Notify helpers we've stopped dragging, regardless of where we ended\r\n        this._aDragDropHelpers.forEach(oHelper => {\r\n            oHelper.onDragEnd(oEv);\r\n        });\r\n\r\n        if (this._eTempCrt) {\r\n            document.body.removeChild(this._eTempCrt);\r\n            this._eTempCrt = null;\r\n        }\r\n    }\r\n}","import { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { WebCombo } from './WebCombo.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnCombo\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnComboBase)\r\nExtends:\r\n    df.WebCombo\r\n\r\n\r\n    \r\nRevision:\r\n    2012/01/18  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate new base class using mixin and WebCombo\r\nclass WebColumnComboBase extends WebColumn_mixin(WebCombo) {}\r\n\r\nexport class WebColumnCombo extends WebColumnComboBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebColCombo\";\r\n    }\r\n\r\n    /*\r\n    Triggered after rendering and attached event handles to the DOM.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        let sVal = tCell.sValue;\r\n\r\n        if (this._aValues) {\r\n            for (let i = 0; i < this._aValues.length; i++) {\r\n                if (this._aValues[i].sValue === sVal) {\r\n                    return (!this.pbAllowHtml ? df.dom.encodeHtml(this._aValues[i].sDescription) : this._aValues[i].sDescription);\r\n                }\r\n            }\r\n        }\r\n\r\n        const tVal = df.sys.data.serverToType(sVal, this.peDataType);\r\n        sVal = this.typeToDisplay(tVal);\r\n\r\n        if (!this.pbAllowHtml) {\r\n            sVal = df.dom.encodeHtml(sVal);\r\n        }\r\n\r\n        return (sVal !== '' ? sVal : '&nbsp;');\r\n    }\r\n\r\n    /*\r\n    Augments the key handler and makes sure that in firefox the combo doesn't change when changing rows.\r\n    \r\n    @param  oEvent  The event object.\r\n    @return True.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const that = this;\r\n\r\n        super.onKey(oEvent);\r\n\r\n        //  Fix for FireFox where we temporary disable the control to make sure that the value does not change when changing rows.\r\n        if (df.sys.isMoz) {\r\n            if (oEvent.matchKey(df.settings.listKeys.scrollUp) || oEvent.matchKey(df.settings.listKeys.scrollDown)) {\r\n                this._eControl.disabled = true;\r\n\r\n                setTimeout(function () {\r\n                    that._eControl.disabled = !that.isEnabled();\r\n                }, 20);\r\n            }\r\n        }\r\n    }\r\n}","import { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { WebCheckbox } from './WebCheckbox.js';\r\nimport { WebGrid } from './WebGrid.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnCheckbox\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnCheckboxBase)\r\nExtends:\r\n    df.WebCheckbox\r\n\r\nClass representing the checkbox column that renders a checkbox in each cell instead of the textual \r\nvalue.\r\n    \r\nRevision:\r\n    2012/01/23  (HW, DAW) \r\n        Initial version.\r\n    2013/08/15  (HW, DAW)\r\n        Rewrote to use mixin.\r\n*/\r\n\r\n//  Generate new base class using mixin and WebCheckbox\r\nclass WebColumnCheckboxBase extends WebColumn_mixin(WebCheckbox) {}\r\n\r\nexport class WebColumnCheckbox extends WebColumnCheckboxBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this._sTick = null;\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebColCheckbox\";\r\n        this._sControlClass = \"WebCheckbox WebCheckboxColumn\";\r\n    }\r\n\r\n    /* \r\n    Augments the cellClick to make sure that the checkbox will be ticked when it is selected shortly \r\n    after this event. A timeout is used to reset the switch controlling this.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if this column handled the click and the list should ignore it (stops the ChangeCurrentRow).\r\n    */\r\n    cellClickBefore(oEvent, sRowId, sVal) {\r\n        const eTarget = oEvent.getTarget();\r\n\r\n        super.cellClickBefore(oEvent, sRowId, sVal);\r\n\r\n        //  Make sure that the checkbox gets ticked if we switch to edit mode within a second\r\n        if (!df.dom.isParent(eTarget, this._eElem) && (eTarget.tagName === \"INPUT\" || eTarget.tagName === \"SPAN\")) {\r\n            this._sTick = sRowId;\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augments the cellClickAfter and checks if the checkbox needs to be ticked (if this occurs shortly after \r\n    cellClick). This needs to be done so that clicking checkboxes in rows that are not currently \r\n    selected also works.\r\n    */\r\n    cellClickAfter(oEv, sRowId, sColVal) {\r\n        super.cellClickAfter(oEv, sRowId, sColVal);\r\n\r\n        //  Tick the checkbox if it was just clicked\r\n        if (this._sTick) {\r\n\r\n            //  We wait for the call to finish as this might called from the setter of psCurrentRowId and psValue might still get set afterwards (and we don't want that as it would revert the change)\r\n            this.getWebApp().waitForCall(function () {\r\n                this._bIgnoreOnChange = false;\r\n                if (this._sTick === this._oParent.currentRowId()) {\r\n                    this.tick();\r\n                    this._sTick = null;\r\n                }\r\n                this._bIgnoreOnChange = true;\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        const aHtml = [];\r\n\r\n        aHtml.push('<div class=\"', this.genClass(), '\"><div class=\"WebCon_Inner\"><div><input type=\"checkbox\"');\r\n\r\n        if (tCell.sValue === this.psChecked) {\r\n            aHtml.push(' onclick=\"this.checked = true\" checked=\"checked\"');\r\n        } else {\r\n            aHtml.push(' onclick=\"this.checked = false\"');\r\n        }\r\n\r\n        if (!this.isEnabled()) {\r\n            aHtml.push(' disabled=\"disabled\"');\r\n        }\r\n        if (!(this._oParent instanceof WebGrid)) {\r\n            aHtml.push(' tabindex=\"-1\"');\r\n        }\r\n\r\n        aHtml.push('><span class=\"WebCB_Fake\"></span></div></div></div>');\r\n\r\n        return aHtml.join('');\r\n    }\r\n}","import { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { WebDateForm } from './WebDateForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnDate\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnDateBase)\r\nExtends:\r\n    df.WebForm\r\n\r\nThis is the client-side representation of the cWebColumnDate control.\r\n\r\nRevision:\r\n    2013/12/11  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate new base class using df.WebColumn_mixin and df.WebDateForm\r\nclass WebColumnDateBase extends WebColumn_mixin(WebDateForm) {}\r\n\r\nexport class WebColumnDate extends WebColumnDateBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebCol\";\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n    }\r\n\r\n    onKey(oEvent) {\r\n        //  Only call base (which calls the list) if the picker is not visible to block cursor up / down handler of the list overruling the date picker\r\n        if (!this._bPickerVisible) {\r\n            super.onKey(oEvent);\r\n        } else if (oEvent.matchKey(df.settings.calendarKeys.close) && this._bPickerVisible) {\r\n            this.hideDatePicker();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n}","import { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebColumnButton\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnButtonBase)\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis column type can show one or multiple buttons in a list / grid of which the onclick can be \r\nhandled on the server. The buttons are dynamically determined for each row.\r\n    \r\nRevision:\r\n    2013/07/12  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate base class using WebColumn_mixin inheriting from WebBaseDEO\r\nclass WebColumnButtonBase extends WebColumn_mixin(WebBaseDEO) {}\r\n\r\nexport class WebColumnButton extends WebColumnButtonBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psBtnCssClass\", \"\");\r\n        this.prop(df.tBool, \"pbDynamic\", false);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait); //  Keep this as default because usually there will be a OnRowChange right behind it\r\n\r\n\r\n        this._sControlClass = \"\";\r\n        this._sCellClass = \"WebColBtn\";\r\n        this._bCellEdit = false;\r\n    }\r\n\r\n    /* \r\n    Augments the openHtml to add a div element that acts as the control. We'll add the buttons to this\r\n    div.\r\n    \r\n    @param  aHtml   Array used a string builder to which the HTML is added.\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div>');\r\n    }\r\n\r\n    /* \r\n    Augments the closeHtml to add a div element that acts as the control.\r\n    \r\n    @param  aHtml   Array used a string builder to which the HTML is added.\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    Augment afterRender to get a reference to the div element that will act as control.\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div\");\r\n\r\n        super.afterRender();\r\n    }\r\n\r\n    /* \r\n    Setter method for the psBtnCssClass property. The list is triggered to redraw if the new value is \r\n    actually different. \r\n    \r\n    @param  sVal    New classname.\r\n    */\r\n    set_psBtnCssClass(sVal) {\r\n        const bCS = this.psBtnCssClass !== sVal;\r\n\r\n        this.psBtnCssClass = sVal;\r\n\r\n        if (bCS) {\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n    // - - - - - - - - - DEO Implemnetation - - - - - - - - - \r\n    /*\r\n    This method reads the current value from the user interface. It will be overridden by the different \r\n    type of Data Entry Objects. The default implementation reads the value property of the control DOM \r\n    element.\r\n    \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        return this.psValue;\r\n    }\r\n\r\n\r\n    // - - - - - - - - - WebColumn Stuff - - - - - - - - - - -\r\n\r\n    /* \r\n    Triggered by the List / Grid when a cell of this column is clicked. Checks if a button is clicked \r\n    and if so it will fire the OnClick event.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if this column handled the click and the list should ignore it (stops the ChangeCurrentRow).\r\n    */\r\n    cellClickAfter(oEvent, sRowId, sVal) {\r\n        const eBtn = oEvent.getTarget();\r\n\r\n        if (eBtn.tagName === \"BUTTON\" && eBtn.hasAttribute(\"data-dfbtnid\") && this.isEnabled()) {\r\n            this.fire(\"OnClick\", [eBtn.getAttribute(\"data-dfbtnid\"), sRowId]);\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        let sAttributes = \"\";\r\n        const aHtml = [];\r\n\r\n        if (!this.isEnabled()) {\r\n            sAttributes += ' disabled=\"disabled\"';\r\n        }\r\n\r\n        if (this.pbDynamic) {\r\n            const aButtons = tCell.aOptions;\r\n\r\n            for (let i = 0; i < aButtons.length; i += 3) {\r\n                if (aButtons[i]) {\r\n                    aHtml.push('<button data-dfbtnid=\"', aButtons[i], '\" class=\"', aButtons[i + 1], '\"', sAttributes, '>', aButtons[i + 2], '</button>');\r\n                }\r\n            }\r\n        } else {\r\n            aHtml.push('<button data-dfbtnid=\"DEFAULT\"', sAttributes, ' class=\"', this.psBtnCssClass, '\">', this.psButtonCaption, '</button>');\r\n        }\r\n        return aHtml.join('');\r\n    }\r\n\r\n    /*\r\n    Override the focus method as the focus needs to go to the the first button element.\r\n    \r\n    @return True if the focus is taken.\r\n    */\r\n    focus() {\r\n\r\n        if (this._bFocusAble && this.isEnabled() && this._eControl && this._eControl.focus) {\r\n            const eBtn = df.dom.query(this._eControl, \"button\");\r\n\r\n            if (eBtn) {\r\n                eBtn.focus();\r\n\r\n                this.objFocus();\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n   df.WebColumnImage\r\nMixin:\r\n   df.WebColumn_mixin (df.WebColumnImageBase)\r\nExtends:\r\n   df.WebBaseDEO\r\n\r\nThis column type can show one or multiple images in a list / grid of which the onclick can be \r\nhandled on the server. The images are dynamically determined for each row.\r\n   \r\nRevision:\r\n   2013/07/12  (HW, DAW) \r\n       Initial version.\r\n*/\r\n\r\n// Define base class based on WebColumn_mixin inheriting from WebBaseDEO\r\nclass WebColumnImageBase extends WebColumn_mixin(WebBaseDEO) {}\r\n\r\n\r\n/* \r\nImage column showing one or more images inside a column.\r\n*/\r\nexport class WebColumnImage extends WebColumnImageBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait); //  Keep this as default because usually there will be a OnRowChange right behind it\r\n\r\n        this.prop(df.tBool, \"pbImageByCSS\", false);\r\n        this.prop(df.tBool, \"pbDynamic\", false);\r\n        this.prop(df.tInt, \"pePosition\", df.cwiFit);\r\n\r\n        this.prop(df.tString, \"psImageUrl\", \"\");\r\n        this.prop(df.tString, \"psImageCSSClass\", \"\");\r\n\r\n        this.prop(df.tInt, \"piImageWidth\", 0);\r\n        this.prop(df.tInt, \"piImageHeight\", 0);\r\n\r\n        this._sControlClass = \"\";\r\n        this._sCellClass = \"WebColImg\";\r\n        this._bCellEdit = false;\r\n    }\r\n    /* \r\n    Augments the openHtml to add a div element that acts as the control. We'll add the buttons to this\r\n    div.\r\n    \r\n    @param  aHtml   Array used a string builder to which the HTML is added.\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div>');\r\n    }\r\n\r\n    /* \r\n    Augments the closeHtml to add a div element that acts as the control.\r\n    \r\n    @param  aHtml   Array used a string builder to which the HTML is added.\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    Augment afterRender to get a reference to the div element that will act as control.\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div\");\r\n\r\n        super.afterRender();\r\n    }\r\n\r\n    /* \r\n    Setter for psImageUrl that updates the entire list so the new image will be shown.\r\n    \r\n    @param  sVal    New value.\r\n    */\r\n    set_psImageUrl(sVal) {\r\n        this.psImageUrl = sVal;\r\n\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    // - - - - - - - - - DEO Implementation - - - - - - - - - \r\n    /*\r\n    This method reads the current value from the user interface. It will be overridden by the different \r\n    type of Data Entry Objects. The default implementation reads the value property of the control DOM \r\n    element.\r\n    \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        return this.psValue;\r\n    }\r\n\r\n\r\n    // - - - - - - - - - WebColumn Stuff - - - - - - - - - - -\r\n\r\n    /*\r\n    Implements the cellClick that is sent to the column by the grid / list when a cell is clicked. It \r\n    checks if (and which) image is clicked and fires the OnClick event to the server.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if this column handled the click and the list should ignore it (stops the ChangeCurrentRow).\r\n    */\r\n    cellClickAfter(oEvent, sRowId, sVal) {\r\n        const eImg = oEvent.getTarget();\r\n\r\n        if (this.isEnabled() && eImg.hasAttribute(\"data-dfimg\")) {\r\n            if (this.fire(\"OnClick\", [eImg.getAttribute(\"data-dfimg\"), sRowId])) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  sVal    The value in server format.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        const aHtml = [];\r\n        let sStyle = \"\";\r\n\r\n        if (this.piImageWidth > 0) {\r\n            sStyle += \"width: \" + this.piImageWidth + \"px;\";\r\n        }\r\n        if (this.piImageHeight > 0) {\r\n            sStyle += \"height: \" + this.piImageHeight + \"px;\";\r\n        }\r\n\r\n        //  If a fixed height and width is set the pePosition property determines the positioning of the image\r\n        if (this.piImageHeight > 0 && this.piImageWidth > 0) {\r\n            switch (this.pePosition) {\r\n                case df.cwiActual:\r\n                    break;\r\n                case df.cwiStretch:\r\n                    sStyle += \" background-size:100% 100%;\";\r\n                    break;\r\n                case df.cwiStretchHoriz:\r\n                    sStyle += \" background-size: 100%; background-position: center center;\";\r\n                    break;\r\n                case df.cwiCenter:\r\n                    sStyle += \" background-position: center center;\";\r\n                    break;\r\n                case df.cwiFit:\r\n                    sStyle += \" background-size:contain; background-position: center center;\";\r\n                    break;\r\n                case df.cwiCover:\r\n                    sStyle += \" background-size:cover; background-position: center center;\";\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (this.pbDynamic) {\r\n            const aImages = tCell.aOptions;\r\n\r\n            if (aImages.length) {\r\n                for (let i = 0; i < aImages.length; i += 2) {\r\n                    if (aImages[i]) {\r\n                        const sTooltip = aImages[i + 1] || \"\";\r\n\r\n                        if (this.pbImageByCSS) {\r\n                            aHtml.push('<span style=\"', sStyle, '\" class=\"', aImages[i], '\" data-dfimg=\"', aImages[i], '\" title=\"', sTooltip, '\"></span>');\r\n                        } else {\r\n                            //  If no height and width are set we need to use an img element as we don't know the size, else we use a span and load the image as background image providing better positioning\r\n                            if (this.piImageWidth === 0 || this.piImageHeight === 0) {\r\n                                aHtml.push('<img style=\"', sStyle, '\" src=\"', aImages[i], '\" data-dfimg=\"', aImages[i], '\" title=\"', sTooltip, '\">');\r\n                            } else {\r\n                                aHtml.push('<span style=\"', sStyle, 'background-repeat: no-repeat; background-image: url(\\'', aImages[i], '\\');\" data-dfimg=\"', aImages[i], '\" title=\"', sTooltip, '\"></span>');\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                aHtml.push('<span style=\"', sStyle, '\" class=\"\"></span>');\r\n            }\r\n        } else {\r\n            if (this.pbImageByCSS) {\r\n                aHtml.push('<span style=\"', sStyle, '\" class=\"', this.psImageCSSClass, '\" data-dfimg=\"', this.psImageUrl, '\"></span>');\r\n            } else {\r\n                aHtml.push('<img style=\"', sStyle, '\" src=\"', this.psImageUrl, '\" data-dfimg=\"', this.psImageUrl, '\">');\r\n            }\r\n        }\r\n\r\n        return aHtml.join('');\r\n    }\r\n}","import { WebColumn_mixin  } from './WebColumn_mixin.js';\r\nimport { WebSuggestionForm } from './WebSuggestionForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnSuggestion\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnSuggestionBase)\r\nExtends:\r\n    df.WebForm\r\n\r\nThis is the client-side representation of the cWebColumnSuggestion control.\r\n\r\nRevision:\r\n    2013/12/11  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate new base class using df.WebColumn_mixin and df.WebDateForm\r\nclass WebColumnSuggestionBase extends WebColumn_mixin(WebSuggestionForm) {} //df.mixin(\"df.WebColumn_mixin\", \"df.WebSuggestionForm\");\r\n\r\n\r\nexport class WebColumnSuggestion extends WebColumnSuggestionBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebCol\";\r\n    }\r\n\r\n    /*\r\n    Augments the key handler and implements key up and key down before the weblist gets a chance to \r\n    handle them.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        const oKeys = df.settings.suggestionKeys;\r\n\r\n        if (this._bSuggestVisible) {\r\n            if (oEvent.matchKey(oKeys.moveUp)) {\r\n                this.suggestMove(-1);\r\n                oEvent.stop();\r\n                return;\r\n            }\r\n            if (oEvent.matchKey(oKeys.moveDown)) {\r\n                this.suggestMove(1);\r\n                oEvent.stop();\r\n                return;\r\n            }\r\n        }\r\n\r\n        super.onKey(oEvent);\r\n\r\n    }\r\n\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { WebColumn_mixin } from './WebColumn_mixin.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnLink\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnLinkBase)\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nImplementation of the link column that renders a link instead of the value of which the OnClick can\r\nbe handled on the server.\r\n    \r\nRevision:\r\n    2013/07/12  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate base class that uses the WebColumn_mixin and WebBaseDEO.\r\nclass WebColumnLinkBase extends WebColumn_mixin(WebBaseDEO) {}\r\n\r\n/* \r\nWebColumnLink class that adds an OnClick event fired when a cell is clicked. It also renders like a \r\nlink (blue, underline, cursor hand).\r\n*/\r\nexport class WebColumnLink extends WebColumnLinkBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait); //  Keep this as default because usually there will be a OnRowChange right behind it\r\n\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebColLink\";\r\n        this._sCellClass = \"WebColLink WebWrp_None\";\r\n        this._bCellEdit = false;\r\n    }\r\n\r\n    /* \r\n    Augment openHtml to render the anchor that will be displayed when the cell is selected (so it acts\r\n    as the control).\r\n    \r\n    @param  aHtml   String builder array to add HTML to.\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<a href=\"javascript:void(0);\" target=\"_self\">');\r\n    }\r\n\r\n    /*\r\n    Augment closeHtml to render the anchor.\r\n    \r\n    @param  aHtml   String builder array to add HTML to.\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</a>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /* \r\n    Augment the afterRender function to get a reference to our anchor that acts as the control.\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"a\");\r\n\r\n        super.afterRender();\r\n    }\r\n\r\n    // - - - - - - - - - DEO Implemnetation - - - - - - - - - \r\n    /*\r\n    This method reads the current value from the user interface. It will be overridden by the different \r\n    type of Data Entry Objects. The default implementation reads the value property of the control DOM \r\n    element.\r\n    \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n        return this.psValue;\r\n    }\r\n\r\n    // - - - - - - - - - WebColumn Stuff - - - - - - - - - - -\r\n\r\n    /* \r\n    Override the cellClick to trigger the OnClick if an achor is clicked.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    @param  sVal    Value of the clicked cell.\r\n    \r\n    @param  True if this column handled the click and the list should ignore it (stops the ChangeCurrentRow).\r\n    */\r\n    cellClickAfter(oEvent, sRowId, sVal) {\r\n        if (oEvent.getTarget().tagName === \"A\" && this.isEnabled()) {\r\n            this.fire(\"OnClick\", [sRowId, sVal]);\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Augment the cellHtml to add the anchor element.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n\r\n    cellHtml(sRowId, tCell) {\r\n        return ('<a href=\"javascript:void(0);\" target=\"_self\">' + super.cellHtml(sRowId, tCell) + '</a>');\r\n    }\r\n\r\n\r\n    /*\r\n    We augment the onKey event handler and call the onKey handler of the grid first so that the grid \r\n    keys overrule the default form keys (especially ctrl  end & ctrl  home which go to the last & \r\n    first row instead of doing a find). The grids onKey handler returns true if nothing happened and \r\n    false if something happened (this confirms with the default event system).\r\n    \r\n    @param  oEvent  The event object.\r\n    */\r\n    onKey(oEvent) {\r\n        oEvent.e.cancelBubble = true;\r\n\r\n        if (oEvent.matchKey(df.settings.formKeys.submit)) {\r\n            this.cellClick(oEvent, this._oParent.currentRowId(), this.psValue);\r\n        } else {\r\n            super.onKey(oEvent);\r\n        }\r\n    }\r\n\r\n\r\n}","import { WebColumn_mixin  } from './WebColumn_mixin.js';\r\nimport { WebTagsForm } from './WebTagsForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnTags\r\nMixin:\r\n    df.WebColumn_mixin (df.WebColumnTagsBase)\r\nExtends:\r\n    df.WebTagsForm\r\n    \r\nRevision:\r\n    2022/07/17  (BN, DAW) \r\n        Initial version.\r\n*/\r\n\r\n//  Generate new base class using mixin and WebTagsForm\r\nclass WebColumnTagsBase extends WebColumn_mixin(WebTagsForm) { } //df.mixin(\"df.WebColumn_mixin\", \"df.WebTagsForm\");\r\n\r\nexport class WebColumnTags extends WebColumnTagsBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebTagsColumn WebTagsForm WebColTags\";\r\n\r\n        this.prop(df.tInt, \"peWordBreak\", df.wbWrap);\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        const aHtml = [];\r\n\r\n        const aSelection = this.parseSelectionValues(tCell.sValue);\r\n        for (let i = 0; i < aSelection.length; i++) {\r\n            aHtml.push('<div class=\"WebTgf_Tag\">');\r\n\r\n            aHtml.push('<span class=\"WebTgf_Text ', df.classWordBreak(this.peWordBreak), '\">', df.dom.encodeHtml(this.truncate(aSelection[i], this.piTagTruncateAt, false)), '</span>');\r\n\r\n            aHtml.push('</div>');\r\n        }\r\n\r\n        return aHtml.join('');\r\n    }\r\n\r\n    tooltipValue(tCell) {\r\n        return this.parseSelectionValues(tCell.sValue).join(', ');\r\n    }\r\n\r\n    set_peWordBreak(iVal) {\r\n        if (this.peWordBreak !== iVal) {\r\n            this._oParent.redraw();\r\n        }\r\n    }\r\n\r\n}","import { WebBaseMenu } from './WebBaseMenu.js';\r\nimport { WebMenuItemCheckbox } from './WebMenuItemCheckbox.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebMenuItem\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the WebMenuBar class that wraps the WebMenuItems. It \r\ngenerates the HTML for the ul element that wraps the li elements of the WebMenuItems. The CSS \r\n(class: WebMenuBar) Determines how the menu is shown and how the items will look depending on their \r\nplace in the menu structure.\r\n\r\nThe menu system works with an abstraction level where menu items are represented as data objects \r\n(not Web Objects). There are provider objects that provide a menu tree and there are listener \r\nobjects that display a menu. A grouphub (based on psGroupName) provides communication between these \r\nobjects allowing multiple providers and multiple listeners to work on a single menu group. Mose menu \r\nclasses are both provider and listener where the WebMenuGroup is only a provider.\r\n    \r\n   \r\nRevision:\r\n    2011/10/04  (HW, DAW) \r\n        Initial version.\r\n    2015/01/19  (HW, DAW)\r\n        Full refactoring of the menu system where the menu class is now completely responsible for \r\n        the rendering and menu items are separated. The menu class now only knows menu items as \r\n        abstract data objects provider by a menu provider (can be the menu class itself) through a \r\n        group hub.\r\n*/\r\n\r\n/*\r\nThis class represents a menubar inside a command bar. It belongs to the server-side cWebMenuBar \r\nclass and implements its functionality on the client. The CSS (class: WebMenuBar) defines the looks \r\nof this control and the WebMenuItem's that it wraps.\r\n*/\r\n\r\nexport class WebMenuBar extends WebBaseMenu {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n\r\n        this.prop(df.tBool, \"pbShowOnHover\", false);\r\n        this.prop(df.tBool, \"pbFocusable\", false);\r\n\r\n        // @privates\r\n        this._bShownByHover = false;\r\n        this._sSelectedItem = null;\r\n        this._sExpanded = null;\r\n        this._tHideTimeout = null;\r\n\r\n        //  Configure base classes\r\n        this._bIsMenuListener = true;\r\n\r\n        this._bWrapDiv = true;\r\n        this._bRenderChildren = false;\r\n        this._sControlClass = \"WebMenuBar\";\r\n    }\r\n\r\n    //  - - - Rendering - - -\r\n\r\n    /*\r\n    The WebMenuBar consists of a single ul element that is wrapped by the div generated by its \r\n    base class.\r\n    \r\n    @param  aHtml   String builder array to add the HTML to.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<ul class=\"WebBarRoot\" tabindex=\"0\">');\r\n\r\n        this.genMenuHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    Properly close the opened HTML elements.\r\n    \r\n    @param  aHtml   String builder array to add the HTML to.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</ul>');\r\n        aHtml.push('<div style=\"clear: both\"></div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n        //  We need to get a reference to the ul element\r\n        this._eControl = df.dom.query(this._eElem, \"ul\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onMenuClick, this);\r\n        df.dom.on(\"mouseover\", this._eControl, this.onMouseOver, this);\r\n        df.dom.on(\"mouseout\", this._eControl, this.onMouseOut, this);\r\n        df.dom.on(\"keydown\", this._eControl, this.onKeyDown, this);\r\n\r\n    }\r\n\r\n    // - - - - - - Menu HTML Generation - - - - - -\r\n\r\n    genMenuHtml(aHtml) {\r\n        const aMenu = this.getMenu();\r\n\r\n        for (let i = 0; i < aMenu.length; i++) {\r\n            this.genItemHtml(aHtml, aMenu[i], i.toString(), true);\r\n        }\r\n    }\r\n\r\n\r\n    refreshMenu() {\r\n        const aHtml = [];\r\n\r\n        if (this._eControl) {\r\n            this.genMenuHtml(aHtml);\r\n\r\n            this._eControl.innerHTML = aHtml.join('');\r\n            this.exapndPath(this._sExpanded || \"\", true);\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - Menu Logic - - - - - -\r\n\r\n    onMenuClick(oEvent) {\r\n        let eElem, tItem = null;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        this.notifyReceived();\r\n        this._bShownByHover = false;\r\n\r\n        //  Determine the clicked menu item\r\n        eElem = oEvent.getTarget();\r\n        while (!tItem && eElem && eElem !== this._eElem) {\r\n            if (eElem.hasAttribute(\"data-df-path\")) {\r\n                tItem = this.getItemByPath(eElem.getAttribute(\"data-df-path\"));\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        //  Actual click logic\r\n        if (tItem) {\r\n            this.selectItem(tItem);\r\n\r\n            if (tItem.bEnabled) {\r\n                if (this.isExpanded(tItem)) {\r\n                    this.collapseItem(tItem);\r\n                } else {\r\n                    this.expandItem(tItem);\r\n                }\r\n\r\n                //  The handler object will process the actual click (this is a different object for dynamically created items)\r\n                if (tItem._oHandler.itemClick(tItem, function (bExec) {\r\n                    if (bExec && !(tItem.hRef instanceof WebMenuItemCheckbox)) {\r\n                        this.collapseAll();\r\n                    }\r\n                }, this)) {\r\n                    this.getWebApp().returnFocus();\r\n                }\r\n\r\n            }\r\n\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    onMouseOver(oEvent) {\r\n        let eElem, tItem = null;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        this.notifyReceived();\r\n\r\n        //  Determine the clicked menu item\r\n        eElem = oEvent.getTarget();\r\n        while (!tItem && eElem && eElem !== this._eElem) {\r\n            if (eElem.hasAttribute(\"data-df-path\")) {\r\n                tItem = this.getItemByPath(eElem.getAttribute(\"data-df-path\"));\r\n            }\r\n\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        if (tItem) {\r\n            this.selectItem(tItem);\r\n\r\n            if (this._sExpanded || this.pbShowOnHover) {\r\n                if (!this._sExpanded) {\r\n                    this._bShownByHover = true;\r\n                }\r\n                if (tItem.aChildren.length > 0) {\r\n                    this.expandItem(tItem);\r\n                } else {\r\n                    this.collapseSubItems(tItem);\r\n                }\r\n            }\r\n\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    onMouseOut(oEvent) {\r\n        this.notifyLost(true);\r\n\r\n        oEvent.stop();\r\n    }\r\n\r\n    selectItem(tItem) {\r\n        let eItem;\r\n\r\n        //  Deselect if needed\r\n        if (this._sSelectedItem && this._sSelectedItem !== tItem._sPath && this._sSelectedItem !== tItem._sPath) {\r\n            eItem = this.getItemElemByPath(this._sSelectedItem);\r\n            if (eItem) {\r\n                df.dom.removeClass(eItem, \"WebItm_Selected\");\r\n            }\r\n\r\n            this._sSelectedItem = null;\r\n        }\r\n\r\n        //  Mark new item as selected\r\n        if (tItem.bEnabled) {\r\n            eItem = this.getItemElemByPath(tItem._sPath);\r\n            df.dom.addClass(eItem, \"WebItm_Selected\");\r\n            this._sSelectedItem = tItem._sPath;\r\n        }\r\n    }\r\n\r\n    isExpanded(tItem) {\r\n        if (this._sExpanded && this._sExpanded.substr(0, tItem._sPath.length) === tItem._sPath) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    exapndPath(sPath, bWithoutTransition) {\r\n        let aPath = sPath.split('.');\r\n        let sConstructPath = \"\";\r\n\r\n        if (bWithoutTransition) df.dom.addClass(this._eElem, \"WebNoTransition\");\r\n\r\n        for (let i = 0; i < aPath.length; i++) {\r\n            sConstructPath += (i > 0 ? \".\" + aPath[i] : aPath[i]);\r\n            let tItem = this.getItemByPath(sConstructPath);\r\n            if (tItem) {\r\n                this.expandItem(tItem);\r\n            }\r\n        }\r\n\r\n        if (bWithoutTransition) df.dom.removeClass(this._eElem, \"WebNoTransition\");\r\n    }\r\n\r\n    expandItem(tItem) {\r\n        let eItem, eLast;\r\n\r\n        this.collapseSubItems(tItem);\r\n\r\n        if (tItem.aChildren.length > 0 && tItem.bEnabled) {\r\n            this._sExpanded = tItem._sPath;\r\n            eItem = this.getItemElemByPath(this._sExpanded);\r\n            while (eItem && eItem !== this._eElem) {\r\n                if (eItem.hasAttribute(\"data-df-path\")) {\r\n                    df.dom.addClass(eItem, \"WebItm_Expanded\");\r\n\r\n                    eLast = eItem;\r\n                }\r\n\r\n                eItem = eItem.parentNode;\r\n            }\r\n\r\n\r\n            if (eLast) {\r\n                //  Position sub menu\r\n                const eSub = eLast.lastChild;\r\n                const oRect = eLast.getBoundingClientRect();\r\n\r\n                let iLeft = oRect.left;\r\n                const iViewport = df.sys.gui.getViewportWidth();\r\n\r\n\r\n                if (iLeft + eSub.offsetWidth > iViewport) {\r\n                    iLeft = oRect.right - eSub.offsetWidth;\r\n\r\n                    if (iLeft < 0) {\r\n                        iLeft = 5;\r\n                    }\r\n                }\r\n\r\n                eSub.style.top = oRect.bottom + \"px\";\r\n                eSub.style.left = iLeft + \"px\";\r\n            }\r\n        }\r\n    }\r\n\r\n    collapseSubItems(tItem) {\r\n        let eItem;\r\n        const sTarget = tItem._sPath;\r\n\r\n        if (this._sExpanded && tItem._sPath !== this._sExpanded) {\r\n            eItem = this.getItemElemByPath(this._sExpanded);\r\n\r\n            if (eItem) {\r\n                //  Collapse all items that are not in the path\r\n                while (eItem && eItem !== this._eElem) {\r\n\r\n                    if (eItem.hasAttribute(\"data-df-path\")) {\r\n                        this._sExpanded = eItem.getAttribute(\"data-df-path\");\r\n\r\n                        if (this._sExpanded !== sTarget.substr(0, this._sExpanded.length)) {\r\n                            df.dom.removeClass(eItem, \"WebItm_Expanded\");\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n                    eItem = eItem.parentNode;\r\n                }\r\n\r\n            } else {\r\n                //  Just collapse everything as something has changed\r\n                this.collapseAll();\r\n            }\r\n        }\r\n    }\r\n\r\n    collapseItem(tItem) {\r\n        let sTarget = tItem._sPath;\r\n\r\n        if (sTarget.indexOf(\".\") > 0) {\r\n            sTarget = sTarget.substr(0, sTarget.lastIndexOf(\".\"));\r\n\r\n            this.expandItem(this.getItemByPath(sTarget));\r\n        } else {\r\n            //  Just collapse everything as something has changed\r\n            this.collapseAll();\r\n        }\r\n    }\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    collapseAll() {\r\n        const aItems = df.dom.query(this._eControl, 'li.WebItm_Expanded', true);\r\n\r\n        for (let i = 0; i < aItems.length; i++) {\r\n            df.dom.removeClass(aItems[i], \"WebItm_Expanded\");\r\n        }\r\n\r\n        this._sExpanded = null;\r\n    }\r\n\r\n    notifyLost(bMouseOut) {\r\n        const that = this;\r\n\r\n        if (!bMouseOut || this._bShownByHover) {\r\n            if (this._tHideTimeout) {\r\n                clearTimeout(this._tHideTimeout);\r\n            }\r\n            this._tHideTimeout = setTimeout(function () {\r\n                var eItem;\r\n\r\n                that._tHideTimeout = null;\r\n                that.collapseAll();\r\n\r\n                //  Deselect item\r\n                if (that._sSelectedItem) {\r\n                    eItem = that.getItemElemByPath(that._sSelectedItem);\r\n                    if (eItem) {\r\n                        df.dom.removeClass(eItem, \"WebItm_Selected\");\r\n                    }\r\n\r\n                    that._sSelectedItem = null;\r\n                }\r\n\r\n                if (bMouseOut && that._bShownByHover) {\r\n                    that.getWebApp().returnFocus();\r\n                }\r\n            }, 150);\r\n        }\r\n    }\r\n\r\n    notifyReceived() {\r\n        if (this._tHideTimeout) {\r\n            clearTimeout(this._tHideTimeout);\r\n            this._tHideTimeout = null;\r\n        }\r\n    }\r\n\r\n    moveParent() {\r\n        let sTarget = this._sSelectedItem;\r\n\r\n        if (sTarget) {\r\n            if (sTarget.indexOf(\".\") > 0) {\r\n                sTarget = sTarget.substr(0, sTarget.lastIndexOf(\".\"));\r\n\r\n                const tItem = this.getItemByPath(sTarget);\r\n                if (tItem) {\r\n                    this.collapseItem(tItem);\r\n                    this.selectItem(tItem);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    moveSibling(iDelta) {\r\n        let tItem, bFirst = true;\r\n\r\n        if (this._sSelectedItem) {\r\n            const aPath = this._sSelectedItem.split(\".\");\r\n\r\n\r\n            while (bFirst || (tItem && !tItem.bEnabled)) {\r\n                aPath[aPath.length - 1] = parseInt(aPath[aPath.length - 1], 10) + iDelta;\r\n                const sTarget = aPath.join(\".\");\r\n                tItem = this.getItemByPath(sTarget);\r\n\r\n                bFirst = false;\r\n            }\r\n            if (tItem) {\r\n                this.expandItem(tItem);\r\n                this.selectItem(tItem);\r\n            }\r\n        }\r\n    }\r\n\r\n    moveChild() {\r\n        let sTarget, tItem, bFirst = true;\r\n\r\n        if (this._sSelectedItem) {\r\n            sTarget = this._sSelectedItem + \".0\";\r\n        } else {\r\n            sTarget = \"0\";\r\n        }\r\n\r\n        const aPath = sTarget.split(\".\");\r\n\r\n        //  Move on to the first enabled item\r\n        while (bFirst || (tItem && !tItem.bEnabled)) {\r\n            sTarget = aPath.join(\".\");\r\n            tItem = this.getItemByPath(sTarget);\r\n\r\n            aPath[aPath.length - 1] = parseInt(aPath[aPath.length - 1], 10) + 1;\r\n            bFirst = false;\r\n        }\r\n\r\n        if (tItem) {\r\n            this.expandItem(tItem);\r\n            this.selectItem(tItem);\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /*\r\n    \r\n    @param  oEvent  The event object.\r\n    \r\n    */\r\n    onKeyDown(oEvent) {\r\n        let bRes = false;\r\n        const bRoot = (this._sSelectedItem && this._sSelectedItem.indexOf(\".\") < 0);\r\n\r\n        if (oEvent.matchKey(df.settings.menuKeys.moveUp)) {\r\n            if (!bRoot) {\r\n                this.moveSibling(-1);\r\n            }\r\n            bRes = true;\r\n        } else if (oEvent.matchKey(df.settings.menuKeys.moveDown)) {\r\n            if (bRoot) {\r\n                this.moveChild();\r\n            } else {\r\n                this.moveSibling(1);\r\n            }\r\n            bRes = true;\r\n        } else if (oEvent.matchKey(df.settings.menuKeys.moveLeft)) {\r\n            if (bRoot) {\r\n                this.moveSibling(-1);\r\n            } else {\r\n                this.moveParent();\r\n            }\r\n            bRes = true;\r\n        } else if (oEvent.matchKey(df.settings.menuKeys.moveRight)) {\r\n            if (bRoot) {\r\n                this.moveSibling(1);\r\n            } else {\r\n                this.moveChild();\r\n            }\r\n            bRes = true;\r\n        } else if (oEvent.matchKey(df.settings.formKeys.submit)) {\r\n            if (this._sSelectedItem) {\r\n                const tItem = this.getItemByPath(this._sSelectedItem);\r\n                if (tItem) {\r\n                    bRes = true;\r\n                    tItem._oHandler.itemClick(tItem, function (bExec) {\r\n                        if (bExec) {\r\n                            this.collapseAll();\r\n                            this.getWebApp().returnFocus();\r\n                        }\r\n                    }, this);\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (bRes) {\r\n            oEvent.stop();\r\n            this._bShownByHover = false;\r\n        }\r\n    }\r\n\r\n\r\n    onFocus(oEvent) {\r\n        //df.WebBaseControl.base.onFocus.call(this, oEvent);\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        this.notifyReceived();\r\n\r\n        if (this._eElem) {\r\n            df.dom.addClass(this._eElem, \"WebCon_Focus\");\r\n\r\n            if (!this._sSelectedItem) {\r\n                this.moveChild();\r\n            }\r\n        }\r\n        if (this.pbFocusable) {\r\n            this.objFocus();\r\n        }\r\n\r\n\r\n        this.fire(\"OnFocus\");\r\n\r\n        this._bHasFocus = true;\r\n    }\r\n\r\n    onBlur(oEvent) {\r\n        //df.WebBaseControl.base.onBlur.call(this, oEvent);\r\n\r\n        this.notifyLost(false);\r\n\r\n        if (this._eElem) {\r\n            df.dom.removeClass(this._eElem, \"WebCon_Focus\");\r\n        }\r\n\r\n        this.fire(\"OnBlur\");\r\n\r\n        this._bHasFocus = false;\r\n    }\r\n}","import { WebMenuBar } from './WebMenuBar.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebToolBar\r\nExtends:\r\n    df.WebMenuBar\r\n\r\nThe WebToolBar is a control that renders a toolbar inside a commandbar. Regular menu items can be \r\nused within the toolbar that have an icon and / or a caption.\r\n    \r\nRevision:\r\n    2011/09/27  (HW, DAW) \r\n        Initial version.\r\n    2015/01/20  (HW, DAW)\r\n        Refactored for new style menu system. The rendering logic moved from the WebMenuItem class \r\n        to the menu classes itself. The WebToolBar now extends the WebMenuBar inheriting its \r\n        rendering logic. This also means that the WebToolbar now can be positioned as a control.New \r\n        is support for overflowing into a sub menu.\r\n*/\r\nexport class WebToolBar extends WebMenuBar {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbShowCaption\", false);\r\n        this.prop(df.tInt, \"peAlign\", df.ciAlignLeft);\r\n        this.prop(df.tBool, \"pbShowIcons\", true);\r\n        this.prop(df.tString, \"psSubItemCaption\", \"More..\");\r\n\r\n        // @privates\r\n        this._eControl = null;\r\n\r\n        this._bWrapDiv = true;\r\n        this._sControlClass = \"WebToolBar\";\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n\r\n\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"ul\");\r\n\r\n        super.afterRender();\r\n\r\n        this.set_pbShowCaption(this.pbShowCaption);\r\n        this.set_pbShowIcons(this.pbShowIcons);\r\n        this.set_peAlign(this.peAlign);\r\n    }\r\n\r\n\r\n    refreshMenu() {\r\n        super.refreshMenu();\r\n\r\n        this.adjustWidth();\r\n    }\r\n\r\n    genMenuHtml(aHtml) {\r\n        super.genMenuHtml(aHtml);\r\n\r\n        aHtml.push('<li data-df-item=\"subitems\" class=\"WebMenuItem WebTlb_SubItems WebTlb_NoFit\" style=\"display: none;\"><div><span class=\"WebItm_Icon\">&nbsp;</span><a href=\"javascript: void(0);\" target=\"_self\">', this.psSubItemCaption, '</a></div><ul></ul></li>');\r\n    }\r\n\r\n    onMenuClick(oEvent) {\r\n        let eElem;\r\n\r\n        super.onMenuClick(oEvent);\r\n\r\n        if (!oEvent.bCanceled) {\r\n            eElem = oEvent.getTarget();\r\n            while (eElem && eElem !== this._eElem) {\r\n                if (eElem.hasAttribute(\"data-df-item\")) {\r\n                    //  (HW) FIX FireFox: In case of the action menu menu button the focus goes to the wrong place for FF, force it to go the control element. \r\n                    this._eControl.focus();\r\n\r\n\r\n                    if (this._bSubMenuOpened) {\r\n                        this.collapseAll();\r\n                    } else {\r\n                        this.expandSub();\r\n                    }\r\n\r\n                    oEvent.stop();\r\n                    return;\r\n\r\n                }\r\n\r\n                eElem = eElem.parentNode;\r\n            }\r\n        }\r\n    }\r\n\r\n    expandSub() {\r\n        let iLeft;\r\n\r\n        const eSubBtn = df.dom.query(this._eControl, \"li.WebTlb_NoFit\");\r\n        const eSubMen = eSubBtn.lastChild;\r\n\r\n\r\n        if (eSubMen) {\r\n            //  Display submenu\r\n            df.dom.addClass(eSubBtn, \"WebItm_Expanded\");\r\n            this._bSubMenuOpened = true;\r\n\r\n\r\n            //  Position sub menu\r\n            const oRect = eSubBtn.getBoundingClientRect();\r\n            iLeft = oRect.left;\r\n            const iViewport = df.sys.gui.getViewportWidth();\r\n\r\n\r\n            if (iLeft + eSubMen.offsetWidth > iViewport) {\r\n                iLeft = oRect.right - eSubMen.offsetWidth;\r\n\r\n                if (iLeft < 0) {\r\n                    iLeft = 5;\r\n                }\r\n            }\r\n\r\n\r\n            eSubMen.style.top = oRect.bottom + \"px\";\r\n            eSubMen.style.left = iLeft + \"px\";\r\n\r\n\r\n\r\n        }\r\n    }\r\n\r\n    collapseAll() {\r\n\r\n        if (this._bSubMenuOpened) {\r\n            const eSubBtn = df.dom.query(this._eControl, \"li.WebTlb_NoFit\");\r\n            df.dom.addClass(eSubBtn, \"WebItm_Expanded\");\r\n            this._bSubMenuOpened = false;\r\n        }\r\n\r\n        super.collapseAll();\r\n    }\r\n\r\n    adjustWidth() {\r\n        let i;\r\n\r\n        if (this._eControl) {\r\n            const iSpace = this._eControlWrp.clientWidth;\r\n            const eSubBtn = df.dom.query(this._eControl, \"li.WebTlb_NoFit\");\r\n\r\n            if (this._eControl.scrollWidth > iSpace) {\r\n                const aItems = df.dom.query(this._eElem, \"ul.WebBarRoot > li.WebMenuItem\", true);\r\n\r\n                if (aItems.length > 1) {\r\n                    const eSubMen = df.dom.query(this._eControl, \"li.WebTlb_NoFit > ul\");\r\n\r\n                    eSubBtn.style.display = \"\";\r\n\r\n                    i = aItems.length - 2;\r\n                    while (this._eControl.scrollWidth > iSpace && i >= 0) {\r\n                        const eItem = aItems[i];\r\n                        eSubMen.appendChild(eItem);\r\n                        i--;\r\n\r\n                    }\r\n                }\r\n            } else {\r\n                eSubBtn.style.display = \"none\";\r\n            }\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        const iSpace = this._eControlWrp.clientWidth;\r\n\r\n        if (this._iLastResizeSpace !== iSpace) {\r\n            this._iLastResizeSpace = iSpace;\r\n            this.adjustWidth();\r\n        }\r\n    }\r\n\r\n    genClass() {\r\n        let sClass = super.genClass();\r\n\r\n        sClass += (this._oParent?._bIsCommandBar ? \" WebTlb_Command\" : \" WebTlb_Standalone\");\r\n\r\n        return sClass;\r\n    }\r\n\r\n\r\n\r\n    /*\r\n    This setter method adds or removes the CSS class that shows caption.\r\n    \r\n    @param  bVal   The new value.\r\n    @private\r\n    */\r\n    set_pbShowCaption(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebTlb_HideCaption\", !bVal);\r\n\r\n            this.refreshMenu();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Shows / hides the icons by adding / removing the HideIcons CSS class based on the new value.\r\n    \r\n    @param  bVal    New value.\r\n    @private\r\n    */\r\n    set_pbShowIcons(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebTlb_HideIcons\", !bVal);\r\n            this.refreshMenu();\r\n        }\r\n    }\r\n\r\n    set_peAlign(eVal) {\r\n        if (this._eControlWrp) {\r\n            this._eControlWrp.style.textAlign = ([\"left\", \"center\", \"right\"])[eVal];\r\n        }\r\n    }\r\n};","import { WebMenuProvider_mixin } from './WebBaseMenu.js';\r\nimport { WebObject } from './WebObject.js';\r\n\r\n/* \r\nClass:\r\n    df.WebMenuGroup\r\nExtends:\r\n    df.WebObject\r\nMixins:\r\n    df.WebMenuProvider_mixin\r\n\r\nThis class represents the WebMenuGroup which is a provider class for the menu system. This means \r\nthat it providers menu items to listeners of the menu system that render the menu. The WebMenuGroup \r\nis only a provider so it doesnt render anything and is used to place menus in a separate place as \r\nwhere they are rendered. It has special logic so that if it is placed inside a view it will \r\ndeactivate itself (unregister from the menu hub) if the view is not visible.\r\n\r\nRevisions:\r\n    2015/01/16  HW (DAW)\r\n        Created the initial version.\r\n*/\r\nclass WebBaseMenuGroup extends WebMenuProvider_mixin(WebObject) { } //df.mixin(\"df.WebMenuProvider_mixin\", \"df.WebObject\");\r\n\r\nexport class WebMenuGroup extends WebBaseMenuGroup {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this._bActive = false;\r\n    }\r\n\r\n    /* \r\n    During creation we determine if we are inside a view, if so we register ourself as listeners to \r\n    OnShow and OnHide allowing the group to activate / deactivate itself with the view. Else we forward \r\n    we activate immediately.\r\n    \r\n    @private\r\n    */\r\n    create() {\r\n        //  Check if we are in a view, if so we listen to its OnShow and OnHide events, else we just start it\r\n        const oView = this.getView();\r\n        if (oView) {\r\n            oView.OnShow.addListener(this.showView, this);\r\n            oView.OnHide.addListener(this.hideView, this);\r\n        } else {\r\n            this._bActive = true;\r\n            super.create();\r\n        }\r\n    }\r\n\r\n\r\n    /* \r\n    Handles the OnShow event of the view. We activate ourselves as provider to the menu grouphub to \r\n    update the listeners with our menu items.\r\n    \r\n    @param  oEvent      Event object (df.events.JSEvent).\r\n    */\r\n    showView(oEvent) {\r\n        this._bActive = true;\r\n\r\n        if (this.psGroupName) {\r\n            this.getHub().addProvider(this.psGroupName, this);\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Handles the OnHide event of the view. We deactivate by unregistering as provider for the menu \r\n    grouphub.\r\n    \r\n    @param  oEvent      Event object (df.events.JSEvent).\r\n    */\r\n    hideView(oEvent) {\r\n        this._bActive = false;\r\n\r\n        if (this.psGroupName) {\r\n            this.getHub().remProvider(this.psGroupName, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Intercepts the set of the psGroupName and only forwards if we are active making sure that it doesn't \r\n    register while it shouldn't.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psGroupName(sVal) {\r\n        if (this._bActive) {\r\n            super.set_psGroupName(sVal);\r\n        }\r\n    }\r\n}","/*\r\nClass: \r\n    WebListGroupSelector\r\n\r\nImplements the interface for configuring the WebList grouping by selecting columns.\r\n\r\nRevision:\r\n    2023/02/23  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebListGroupSelector {\r\n    oL = null;\r\n    aColumns = [];\r\n    aGroups = [];\r\n    eDragGroup = null;\r\n\r\n    //  Events implemented by WebListGroupController and WebMenuGroupingSelector\r\n    onSizeChanged = new df.events.JSHandler();\r\n    onGroupsChanged = new df.events.JSHandler();\r\n\r\n    //  DOM Element references\r\n    components = {\r\n        eMain: null,\r\n        eContainer: null,\r\n        eSubGroupBtn: null,\r\n        eFieldsSelected: null,\r\n        eChip: null,\r\n        eSelectDropdown: null, \r\n    };\r\n\r\n    constructor(oWebList) {\r\n        this.oL = oWebList;\r\n\r\n        oWebList._onSettingChange.on(this.onWebListSettingsChange, this);\r\n        \r\n        //  Initialize\r\n        this.createElements();\r\n        this.updateColumns();\r\n    }\r\n\r\n    /**\r\n     * Called when the group selector is displayed. It updates the group config being displayed.\r\n     * \r\n     * @returns DOM element containing the group selection interface.\r\n     */\r\n    render() {\r\n        this.aGroups = this.oL._oModel.aGroups;\r\n        this.renderGroups();\r\n        df.dom.addClass(this.components.eSelectDropdown, \"Web_Hidden\");\r\n        return this.components.eMain;\r\n    }\r\n\r\n    /**\r\n     * Triggered by the WebList whenever the configuration changes. We use it to update the \r\n     * column config we have.\r\n     * \r\n     * @param {df.JSEvent} oEv Event object.\r\n     */\r\n    onWebListSettingsChange(oEv) {\r\n        this.updateColumns();\r\n    }\r\n\r\n    /**\r\n     * Refresh the list of columns available in the weblist.\r\n     */\r\n    updateColumns() {\r\n        this.aColumns = [];\r\n\r\n        this.oL._aColumns.forEach(oCol => {\r\n            if (oCol.pbRender && oCol.pbGroupable) {\r\n                this.aColumns.push({\r\n                    iColumnId: oCol._iCol,\r\n                    // title: oCol.psCaption,\r\n                    // tooltip: oCol.psToolTip,\r\n                    sLabel: df.dom.encodeHtml(oCol.psCaption),\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Generates the main element structure for the selector view and attaches event listeners.\r\n     */\r\n    createElements() {\r\n        const eMain = this.components.eMain = df.dom.create(`<div class=\"WebGrpSel_Container\">\r\n                <div class=\"WebGrpSel_Head\">\r\n                    <div id=\"WebGrpSel_Title\">Group Columns</div>\r\n                    <div class=\"WebGrpSel_Chip\">0</div>\r\n                </div>\r\n                <div class=\"WebGrpSel_Fields\"></div>\r\n                <div class=\"WebGrpSel_Add\">\r\n                    <button type=\"button\" class=\"WebGrpSel_Add_Button\">+ Add group</button>\r\n                    <div class=\"WebGrpSel_DropDown Web_Hidden\"></div>\r\n                </div>\r\n            </div>\r\n        `);\r\n\r\n        this.components.eChip = df.dom.query(eMain, \".WebGrpSel_Chip\");\r\n        this.components.eFieldsSelected = df.dom.query(eMain, \".WebGrpSel_Fields\");\r\n        this.components.eSubGroupBtn = df.dom.query(eMain, \".WebGrpSel_Add_Button\");\r\n        this.components.eSelectDropdown = df.dom.query(eMain, \".WebGrpSel_DropDown\");\r\n\r\n        df.dom.on(\"click\", this.components.eMain, this.onMainClick, this);\r\n\r\n        df.dom.on(\"click\", this.components.eSubGroupBtn, this.onAddButtonClick, this);\r\n        df.dom.on(\"click\", this.components.eSelectDropdown, this.onAddDropDownClick, this);\r\n\r\n        df.dom.on(\"click\", this.components.eFieldsSelected, this.onFieldsClick, this);\r\n        df.dom.on(\"change\", this.components.eFieldsSelected, this.onFieldsChange, this);\r\n\r\n        df.dom.on(\"dragstart\", this.components.eFieldsSelected, this.onFieldsDragStart, this);\r\n        df.dom.on(\"dragenter\", this.components.eFieldsSelected, this.onFieldsDragEnter, this);\r\n        df.dom.on(\"dragleave\", this.components.eFieldsSelected, this.onFieldsDragLeave, this);\r\n        df.dom.on(\"dragover\", this.components.eFieldsSelected, this.onFieldsDragOver, this);\r\n        df.dom.on(\"dragend\", this.components.eFieldsSelected, this.onFieldsDragEnd, this);\r\n        df.dom.on(\"drop\", this.components.eFieldsSelected, this.onFieldsDragDrop, this);\r\n    }\r\n\r\n    /**\r\n     * Stop clicks from bubbling (which causes the context menu to hide).\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onMainClick(oEv) {\r\n        oEv.stop();\r\n    }\r\n\r\n    /**\r\n     * Displays the pulldown for adding new columns.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onAddButtonClick(oEv) {\r\n        const eDropDown = this.components.eSelectDropdown; // = df.dom.create(sHtml);\r\n        const aCols = this.availableColumns();\r\n\r\n        if (eDropDown.classList.contains(\"Web_Hidden\")) {\r\n            //  Generate dropdown content\r\n            let sHtml = ``;\r\n            this.components.eSelectDropdown.innerHTML = aCols.reduce((sHtml, tCol) => {\r\n                return sHtml + `<div class=\"Web_Item\" data-colid=\"${tCol.iColumnId}\">${tCol.sLabel}</div>`;\r\n            }, \"\");\r\n\r\n            //  Position and display dropdown\r\n            const rect = this.components.eSubGroupBtn.getBoundingClientRect();\r\n\r\n            eDropDown.style.top = rect.bottom + \"px\";\r\n            eDropDown.style.left = rect.left + \"px\";\r\n            df.dom.removeClass(eDropDown, \"Web_Hidden\");\r\n        } else {\r\n            df.dom.addClass(eDropDown, \"Web_Hidden\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Converts a column id into an index in the aColumns array.\r\n     * \r\n     * @param {integer} iColId Column id.\r\n     * @returns \r\n     */\r\n    columnIndexById(iColId) {\r\n        return this.aColumns.map(tCol => tCol.iColumnId).indexOf(parseInt(iColId, 10));\r\n    }\r\n\r\n    /**\r\n     * Adds a group to the configuration when a column is clicked in the dropdown.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     * @returns \r\n     */\r\n    onAddDropDownClick(oEv) {\r\n        //  Determine details of clicked column\r\n        const iColId = oEv.getTarget()?.closest(\".Web_Item[data-colid]\")?.dataset.colid || null;\r\n        if (iColId == null) return;\r\n\r\n        const iColIndex = this.columnIndexById(iColId);\r\n        if (iColIndex == -1) return;\r\n\r\n        const oCol = this.aColumns[iColIndex];\r\n\r\n        //  Add the group\r\n        this.aGroups.push({\r\n            iColumnId: oCol.iColumnId,\r\n            sLabel: oCol.sLabel,\r\n            bReverse: false\r\n        });\r\n\r\n        this.renderGroups();\r\n        this.fireGroupsChanged();\r\n\r\n        //  Hide the menu\r\n        df.dom.addClass(this.components.eSelectDropdown, \"Web_Hidden\");\r\n    }\r\n\r\n    /**\r\n     * Determines the list of available columns, which are the columns that are not used as a group already.\r\n     * \r\n     * @returns Array of available columns.\r\n     */\r\n    availableColumns() {\r\n        const aSelColIds = this.aGroups.map(tCol => tCol.iColumnId);\r\n        const aResult = [];\r\n\r\n        this.aColumns.forEach(tCol => {\r\n            if (aSelColIds.indexOf(tCol.iColumnId) == -1) {\r\n                aResult.push(tCol);\r\n            }\r\n        });\r\n\r\n        return aResult;\r\n    }\r\n\r\n    /**\r\n     * Display the list of configured groups by generating the HTML.\r\n     */\r\n    renderGroups() {\r\n        const aCols = this.availableColumns();\r\n\r\n        // Generate groups html\r\n        this.components.eFieldsSelected.innerHTML = this.aGroups.reduce((sHtml, tGrp, iGrpIndex) => {\r\n            sHtml += `<div class=\"WebGrpSel_Group\" data-group=\"${iGrpIndex}\" draggable=\"true\">\r\n                    <div class=\"WebGrpSel_Action\" data-action=\"rearrange\" title=\"Drag to rearrange\"><i class=\"WebGrpSel_IconReaarrange\"></i></div>\r\n                    <select class=\"WebGrpSel_GroupSelect\" title=\"Select group col\">\r\n                    <option value=\"${tGrp.iColumnId}\" selected>${tGrp.sLabel}</option>\r\n            `;\r\n            \r\n            sHtml += aCols.reduce((sHtml, tCol, iColIndex) => {\r\n                return sHtml + `<option value=\"${tCol.iColumnId}\">${tCol.sLabel}</option>`;\r\n            }, \"\");\r\n            \r\n            sHtml += `</select>\r\n                    <div class=\"WebGrpSel_Action\" data-action=\"switchsort\" title=\"Switch sorting direction\"><i class=\"${tGrp.bReverse ? \"WebGrpSel_IconSortAsc\" : \"WebGrpSel_IconSortDesc\"}\"></i></div>\r\n                    <div class=\"WebGrpSel_Action\" data-action=\"remove\" title=\"Remove Group\"><i class=\"WebGrpSel_IconRemove\"></i></div>\r\n                </div>`;\r\n\r\n            return sHtml;\r\n        }, \"\");\r\n\r\n        // Update chip\r\n        df.dom.setText(this.components.eChip, this.aGroups.length);\r\n        df.dom.setText(this.components.eSubGroupBtn, (this.aGroups.length > 0 ? \"+ Add sub group\" : \"+ Add group\"));\r\n\r\n\r\n        this.onSizeChanged.fire(this);\r\n    }\r\n\r\n    /**\r\n     * Handles a click event on the group section. If a button is clicked (like the remove button) it will perform that operation.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsClick(oEv) {\r\n        //  Determine action & group index\r\n        const sAction = oEv.getTarget().closest(\".WebGrpSel_Action\")?.dataset.action || null;\r\n        const iGroup = oEv.getTarget().closest(\".WebGrpSel_Group\")?.dataset.group || null;\r\n        if (sAction == null || iGroup == null || !this.aGroups[iGroup]) return;\r\n\r\n        //  Perform action\r\n        switch(sAction){\r\n            case \"remove\":\r\n                this.aGroups.splice(iGroup, 1);\r\n                this.renderGroups();\r\n                this.fireGroupsChanged();\r\n                break;\r\n            case \"switchsort\":\r\n                this.aGroups[iGroup].bReverse = !this.aGroups[iGroup].bReverse;\r\n                this.renderGroups();\r\n                this.fireGroupsChanged();\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The selected column for a group has changed, so we need to update our administration accordingly.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsChange(oEv) {\r\n        //  Determine the newly selected column ID & group index\r\n        const iColumnId = oEv.getTarget().closest(\".WebGrpSel_GroupSelect\")?.value || null;\r\n        const iGroup = oEv.getTarget().closest(\".WebGrpSel_Group\")?.dataset.group || null;\r\n        if (iColumnId == null || iGroup == null || !this.aGroups[iGroup]) return;\r\n\r\n        const iColIndex = this.columnIndexById(iColumnId);\r\n        if (iColIndex == -1) return;\r\n\r\n        //  Update the group config\r\n        this.aGroups[iGroup].iColumnId = this.aColumns[iColIndex].iColumnId;\r\n        this.aGroups[iGroup].sLabel = this.aColumns[iColIndex].sLabel;\r\n        this.renderGroups();\r\n        this.fireGroupsChanged();\r\n    }\r\n\r\n    /**\r\n     * Start of a group drag.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsDragStart(oEv) {\r\n        const eGroup = oEv.getTarget().closest(\".WebGrpSel_Group\") || null;\r\n        const iGroup = eGroup?.dataset.group || null;\r\n        if (!eGroup || iGroup == null || !this.aGroups[iGroup]) return;\r\n\r\n        oEv.e.dataTransfer.dropEffect = \"move\";\r\n        oEv.e.dataTransfer.effectAllowed = \"move\";\r\n\r\n        this.eDragGroup = eGroup;\r\n\r\n        eGroup.classList.add(\"Web_Drag\");\r\n    }\r\n\r\n    /**\r\n     * Dragging over another group (swap them).\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     * @returns \r\n     */\r\n    onFieldsDragOver(oEv) {\r\n        const eOverGroup = oEv.getTarget().closest(\".WebGrpSel_Group\") || null;\r\n        if (!this.eDragGroup || eOverGroup == null) return;\r\n\r\n        oEv.e.preventDefault();\r\n        oEv.stopPropagation();\r\n        oEv.e.dataTransfer.dropEffect = \"move\";\r\n\r\n        if (df.dom.isBefore(this.eDragGroup, eOverGroup)) {\r\n            this.components.eFieldsSelected.insertBefore(this.eDragGroup, eOverGroup);\r\n        } else {\r\n            this.components.eFieldsSelected.insertBefore(this.eDragGroup, eOverGroup.nextSibling);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Drag finished.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsDragEnd(oEv) {\r\n        if (!this.eDragGroup) return;\r\n\r\n        oEv.e.preventDefault();\r\n        oEv.stopPropagation();\r\n\r\n        this.finishDrag();\r\n    }\r\n\r\n    /**\r\n     * Prevent bubbling of drag event.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsDragEnter(oEv) {\r\n        if (!this.eDragGroup) return;\r\n        oEv.e.preventDefault();\r\n        oEv.stopPropagation();\r\n        const dataTransfer = oEv.e.dataTransfer;\r\n        dataTransfer.dropEffect = \"move\";\r\n    }\r\n\r\n    /**\r\n     * Drag finished.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsDragDrop(oEv) {\r\n        if (!this.eDragGroup) return;\r\n        oEv.e.preventDefault();\r\n        oEv.stopPropagation();\r\n        this.finishDrag();\r\n    }\r\n\r\n    /**\r\n     * Prevent bubbling of drag event.\r\n     * \r\n     * @param {df.DOMEvent} oEv \r\n     */\r\n    onFieldsDragLeave(oEv) {\r\n        if (!this.eDragGroup) return;\r\n        oEv.e.preventDefault();\r\n        oEv.stopPropagation();\r\n    }\r\n\r\n    /**\r\n     * Handle finishing of the drag. While dragging we simply swapped DOM elements, now we need to update our administration accordingly.\r\n     */\r\n    finishDrag() {\r\n        //  Find out where the dragged group ended up\r\n        const iGroupIndex = this.eDragGroup?.dataset.group  || null;\r\n        const iNexGroupIndex = this.eDragGroup?.nextElementSibling?.dataset.group || null;\r\n        this.eDragGroup = null;\r\n        if(iGroupIndex == null || !this.aGroups[iGroupIndex] || (iNexGroupIndex != null && !this.aGroups[iNexGroupIndex])) return;\r\n        \r\n        //  Update administration\r\n        const tGrp = this.aGroups[iGroupIndex];\r\n        this.aGroups.splice(iGroupIndex, 1);\r\n\r\n        if(iNexGroupIndex != null){\r\n            this.aGroups.splice(iNexGroupIndex, 0, tGrp);\r\n        }else{\r\n            this.aGroups.push(tGrp);\r\n        }\r\n\r\n        //  Propagate the change\r\n        this.renderGroups();\r\n        this.fireGroupsChanged();\r\n    }\r\n\r\n    /**\r\n     * Fires the onGroupsChanged event which tells the WebList of this change!\r\n     */\r\n    fireGroupsChanged(){\r\n        this.onGroupsChanged.fire(this, { \r\n            aGroups : this.aGroups \r\n        });\r\n    }\r\n\r\n}","import { WebBaseContainer } from './WebBaseContainer.js';\r\nimport { WebCardContainer } from './WebCardContainer.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebCard\r\nExtends:\r\n    df.WebBaseContainer\r\n\r\nThis class is the client-side representation of the cWebCard and is responsible for rendering the \r\ntab page. It works closely together with the WebTabPanel. The WebCard acts as a container and it \r\ninherits this functionality from the WebBaseContainer class.\r\n    \r\nRevision:\r\n    2011/10/13  (HW, DAW) \r\n        Initial version.\r\n    2012/10/02  (HW, DAW)\r\n        Split into WebCard and WebTabPage.\r\n*/\r\nexport class WebCard extends WebBaseContainer {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n        //  Assertions\r\n        if (!(oParent && oParent instanceof WebCardContainer)) {\r\n            throw new df.Error(999, \"WebCard object '{{0}}' should be placed inside a WebCardContainer object. Consider wrapping your card with a card container.\", this, [this.getLongName()]);\r\n        }\r\n\r\n        //  Web Properties\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tString, \"psBtnCSSClass\", \"\"); // Note that this property is defined on cWebTabPage\r\n\r\n\r\n        //  Events\r\n        this.event(\"OnShow\", df.cCallModeDefault);\r\n        this.event(\"OnHide\", df.cCallModeDefault);\r\n\r\n        //@privates\r\n        this._eBtn = null;\r\n        this._eLbl = null;\r\n        this._bCurrent = false;\r\n        this._bCC = true; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebCard\";\r\n        this._bWrapDiv = true;\r\n    }\r\n\r\n    // - - - - - Rendering - - - - -\r\n\r\n    /*\r\n    This method is called by the WebTabPanel to generate the HTML for the button representing this tab \r\n    page.\r\n    \r\n    @param  aHtml   Array string builder to add the HTML to.\r\n    @private\r\n    */\r\n    tabButtonHtml(aHtml) {\r\n        aHtml.push('<div class=\"WebTab_Btn ', (this.isEnabled() ? df.CssEnabled : df.CssDisabled), ' ', this.psBtnCSSClass, '\" style=\"', (!this.pbRender || !this.pbVisible ? 'display: none;' : ''), '\" ', (!this.isEnabled() ? 'tabindex=\"-1\"' : 'tabindex=\"0\"'), '><span><label>', df.dom.encodeHtml(this.psCaption), '</label></span></div>');\r\n    }\r\n\r\n    /*\r\n    Augments the afterRender method to get references to DOM elements, attach event handlers and call \r\n    setters.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        //  Remove \"display none\" added by parent class if pbRender = false\r\n        this._eElem.style.display = '';\r\n    }\r\n\r\n    /* \r\n    Called by the card container when the tab button is rendered. Adds event handlers.\r\n    \r\n    @param  eBtn    Button DOM element.\r\n    @private\r\n    */\r\n    btnRendered(eBtn) {\r\n        this._eBtn = eBtn;\r\n\r\n        this._eLbl = df.dom.query(this._eBtn, 'span > label'); //   WebTabPanel assings the _eBtn already\r\n        df.dom.on(\"click\", this._eBtn, this.onBtnClick, this);\r\n        df.dom.on(\"click\", this._eLbl, this.onBtnClick, this);\r\n        df.events.addDomKeyListener(this._eBtn, this.onBtnKey, this);\r\n    }\r\n\r\n    attachFocusEvents() {\r\n        //  We are attaching a DOM capture listener so we know when we get the focus\r\n        if (window.addEventListener) {\r\n            df.events.addDomCaptureListener(\"focus\", this._eBtn, this.onBtnFocus, this);\r\n            df.events.addDomCaptureListener(\"blur\", this._eBtn, this.onBtnBlur, this);\r\n        } else {\r\n            df.dom.on(\"focusin\", this._eBtn, this.onBtnFocus, this);\r\n            df.dom.on(\"focusout\", this._eBtn, this.onBtnBlur, this);\r\n        }\r\n    }\r\n\r\n    prepareSize() {\r\n        const iResult = super.prepareSize();\r\n\r\n        this._bStretch = true;\r\n\r\n        return iResult;\r\n    }\r\n\r\n    // - - - - - Internal - - - - -\r\n\r\n    /*\r\n    This event handler handles the click event of the tab button. \r\n    \r\n    @param  \r\n    */\r\n    onBtnClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.show();\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Handles the keypress event of the hidden focus anchor. Compares the event \r\n    details to the oKeyActions and executes the action if a match is found.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onBtnKey(oEvent) {\r\n        if (this.isEnabled()) {\r\n\r\n            if (oEvent.matchKey(df.settings.tabKeys.enter)) {\r\n                this.show();\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    onBtnFocus(oEvent) {\r\n        df.dom.addClass(this._eBtn, \"WebTab_Focus\");\r\n    }\r\n\r\n    onBtnBlur(oEvent) {\r\n        df.dom.removeClass(this._eBtn, \"WebTab_Focus\");\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebTabPanel to hide this tab page. Note that switching a tab always \r\n    causes this method to be called regardless whether it was already hidden.\r\n    \r\n    @param  bFirst  True if this method is called during initialization.\r\n    @private\r\n    */\r\n    _hide(bFirst) {\r\n        if (this._eElem) {\r\n            this._eElem.style.visibility = \"hidden\";\r\n            df.dom.removeClass(this._eBtn, \"WebTab_Current\");\r\n        }\r\n\r\n        if (!bFirst && this._bCurrent) {\r\n            this.fire('OnHide');\r\n        }\r\n\r\n        this._bCurrent = false;\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebTabPanel to show this tab page.\r\n    \r\n    @param  bFirst  True if this method is called during initialization.\r\n    @private\r\n    */\r\n    _show(bFirst) {\r\n        if (!this._eElem) {\r\n            this.renderCard(true);\r\n        } else {\r\n            if (this._eElem.parentNode.firstChild && this._eElem !== this._eElem.parentNode.firstChild) {\r\n                this._eElem.parentNode.insertBefore(this._eElem, this._eElem.parentNode.firstChild);\r\n            }\r\n        }\r\n\r\n        this._eElem.style.visibility = \"inherit\";\r\n        df.dom.addClass(this._eBtn, \"WebTab_Current\");\r\n\r\n\r\n        if (!bFirst && !this._bCurrent) {\r\n            this.fire('OnShow');\r\n        }\r\n        this._bCurrent = true;\r\n    }\r\n\r\n    renderCard(bFirstElem) {\r\n        //  We render the card if it wasn't rendered yet\r\n        const eElem = this.render();\r\n        if (bFirstElem && this._oParent._eControl.firstChild) {\r\n            this._oParent._eControl.insertBefore(eElem, this._oParent._eControl.firstChild);\r\n        } else {\r\n            this._oParent._eControl.appendChild(eElem);\r\n        }\r\n\r\n        this.afterRender();\r\n\r\n        this.resizeHorizontal();\r\n        this.resizeVertical();\r\n\r\n    }\r\n\r\n    /*\r\n    This method shows this tabpage which might cause other tabpages to hide.\r\n    */\r\n    show() {\r\n        if (this.isActive()) {\r\n            this._oParent.showCard(this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augments applyEnabled to update the CSS class and tabIndex of the tab button element.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eBtn) {\r\n            df.dom.toggleClass(this._eBtn, df.CssDisabled, !bVal);\r\n            df.dom.toggleClass(this._eBtn, df.CssEnabled, bVal);\r\n            df.dom.setTabIndex(this._eLbl, (bVal ? 0 : -1));\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment to show the current tab / card.\r\n    */\r\n    makeVisible() {\r\n        this.show();\r\n\r\n        super.makeVisible();\r\n    }\r\n\r\n    // - - - - - Setters - - - - -\r\n\r\n    set_psCaption(sVal) {\r\n        if (this._eLbl) {\r\n            //  Update the card container label\r\n            if (this._oParent._oCurrent === this && this._oParent._eLabel) {\r\n                df.dom.setText(this._oParent._eLabel, sVal);\r\n            }\r\n\r\n            //  Update the tab button label\r\n            df.dom.setText(this._eLbl, sVal);\r\n        }\r\n    }\r\n\r\n    set_pbVisible(bVal) {\r\n        if (this._eBtn) {\r\n            this._eBtn.style.display = (bVal && this.pbRender ? '' : 'none');\r\n\r\n            //  Update property because it will be used by hideCard and showCard\r\n            this.pbVisible = bVal;\r\n\r\n            //  Wait for all processing to be done and then make sure that we end up with a 'valid' situation\r\n            this.getWebApp().waitForCall(function () {\r\n                if (!bVal) {\r\n                    if (this._bCurrent) {\r\n                        this._oParent.hideCard(this);\r\n                    }\r\n                } else {\r\n                    if (!this._oParent._oCurrent) {\r\n                        this._oParent.showCard(this);\r\n                    }\r\n                }\r\n\r\n                this.getWebApp().forceResize();\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    set_pbRender(bVal) {\r\n        if (this._eBtn) {\r\n            this._eBtn.style.display = (bVal && this.pbVisible ? '' : 'none');\r\n\r\n            if (this.pbRender !== bVal) {\r\n                //  Update property because it will be used by hideCard and showCard\r\n                this.pbRender = bVal;\r\n\r\n                //  Wait for all processing to be done and then make sure that we end up with a 'valid' situation\r\n                this.getWebApp().waitForCall(function () {\r\n                    if (!bVal) {\r\n                        if (this._bCurrent) {\r\n                            this._oParent.hideCard(this);\r\n                        }\r\n                    } else {\r\n                        if (!this._oParent._oCurrent) {\r\n                            this._oParent.showCard(this);\r\n                        }\r\n                    }\r\n\r\n                    this.getWebApp().forceResize();\r\n                }, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    set_psTextColor(sVal) {\r\n        if (this._eLbl) {\r\n            this._eLbl.style.color = sVal || '';\r\n        }\r\n\r\n        super.set_psTextColor(sVal);\r\n    }\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eBtn) {\r\n            this._eBtn.style.background = sVal || '';\r\n        }\r\n\r\n        super.set_psBackgroundColor(sVal);\r\n    }\r\n\r\n    set_psBtnCSSClass(sVal) {\r\n        if (this._eBtn && this.psBtnCSSClass !== sVal) {\r\n            df.dom.removeClass(this._eBtn, this.psBtnCSSClass);\r\n            df.dom.addClass(this._eBtn, sVal);\r\n        }\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { WebCard } from './WebCard.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebCardContainer\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class is the client-side representation of the cWebCardContainer and is responsible for rendering \r\nthis tab dialog. It can only contain cWebTabPage objects as children.\r\n    \r\nRevision:\r\n    2011/10/13  (HW, DAW) \r\n        Initial version.\r\n    2012/10/02  (HW, DAW)\r\n        Split into WebCardContainer and WebTabContainer.\r\n*/\r\nexport class WebCardContainer extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web Properties\r\n        this.prop(df.tBool, \"pbShowBorder\", false);\r\n        this.prop(df.tBool, \"pbShowCaption\", false);\r\n        this.prop(df.tBool, \"pbSwipeCards\", false);\r\n\r\n        this.prop(df.tString, \"psCurrentCard\", \"\");\r\n        this.addSync(\"psCurrentCard\");\r\n\r\n        //  Events\r\n        this.event(\"OnCardChange\", df.cCallModeWait);\r\n\r\n        //@privates\r\n        this._iHeightSet = null;\r\n        this._aCards = [];\r\n        this._eHead = null;\r\n        this._oCurrent = null;\r\n        this._bRendered = false;\r\n        this._bCC = true; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n\r\n\r\n        //  Configure super classes\r\n        this._bWrapDiv = true;\r\n        this._bRenderChildren = true;\r\n        this._sControlClass = \"WebCardContainer\";\r\n        this._sCardClass = \"WebCC\";\r\n    }\r\n\r\n    // - - - - Rendering - - - - \r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        this.headHtml(aHtml);\r\n\r\n        //  Generate body HTML\r\n        aHtml.push('<div class=\"', this._sCardClass, '_Body\">');\r\n    }\r\n\r\n    /*\r\n    Generates the head HTML which includes the tabbuttons. Note that this function is overridden in \r\n    WebAccordionContainer which does not have a head element with subclasses.\r\n    \r\n    @param  aHtml   String builder array.\r\n    @private\r\n    */\r\n    headHtml(aHtml) {\r\n        //  Generate header HTML\r\n        aHtml.push('<div class=\"', this._sCardClass, '_Head\">');\r\n\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            this._aCards[i].tabButtonHtml(aHtml);\r\n        }\r\n\r\n        aHtml.push('<div style=\"clear: both\"></div></div>');\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n        aHtml.push('<label class=\"', this._sCardClass, '_Caption\"></label>');\r\n\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n\r\n        this._eBody = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_Body');\r\n        this._eHead = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_Head');\r\n        //this._eLabelSpacer = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_LabelSpacer');\r\n        this._eLabel = df.dom.query(this._eElem, 'label.' + this._sCardClass + \"_Caption\");\r\n\r\n        //  Get references to the button elements\r\n        const aButtons = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_Head > div.WebTab_Btn', true);\r\n\r\n        //  Pass references to the button elements to the corresponding tab pages\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            if (i < aButtons.length) {\r\n                this._aCards[i].btnRendered(aButtons[i]);\r\n            }\r\n        }\r\n\r\n        super.afterRender();\r\n\r\n        if (this.pbSwipeCards) {\r\n            this.set_pbSwipeCards(true);\r\n        }\r\n\r\n        //  Display the current tab\r\n        this.showCard(this._oCurrent, true);\r\n\r\n\r\n        this._bRendered = true;\r\n    }\r\n\r\n    set_pbSwipeCards(bVal) {\r\n        if (this._eBody) {\r\n            if (bVal) {\r\n                if (window.PointerEvent) {    //  Microsofts new standard adopted by W3C for touch / mouse & pen events as of IE11\r\n                    df.dom.on(\"pointerdown\", this._eBody, this.onPointerDown, this);\r\n                } else {\r\n                    df.dom.on(\"touchstart\", this._eBody, this.onTouchStart, this);\r\n                }\r\n            } else {\r\n                if (window.PointerEvent) {    //  Microsofts new standard adopted by W3C for touch / mouse & pen events as of IE11\r\n                    df.dom.off(\"pointerdown\", this._eBody, this.onPointerDown, this);\r\n                } else {\r\n                    df.dom.off(\"touchstart\", this._eBody, this.onTouchStart, this);\r\n                }\r\n            }\r\n            df.dom.toggleClass(this._eBody, \"WebCC_Swipable\", bVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This event handler handles the touch event on mobile devices. It will scroll list if the touch is a \r\n    vertical sliding touch.\r\n    \r\n    @param  oEv     Event object (df.events.DOMEvent)\r\n    @private\r\n    */\r\n    onTouchStart(oEv) {\r\n        //  Only respond to single finger swipes\r\n        if (oEv.e.targetTouches.length === 1) {\r\n            this.touchSwipe(false, oEv);\r\n        }\r\n    }\r\n\r\n    onPointerDown(oEv) {\r\n        if (oEv.e.pointerType === \"pen\" || oEv.e.pointerType === \"touch\") {\r\n            this.touchSwipe(true, oEv);\r\n        }\r\n    }\r\n\r\n    // debugCount : 0,\r\n\r\n    touchSwipe(bPointer, oEv) {\r\n        let iY, iStartY, iWidth, iDiff, oShowCard = null,\r\n            iStartX, iX, bSwipe = false, bSwipeFixed = false, iIndex = -1, oPrev = null, oNext = null, oCurrent = this._oCurrent, eCur = null, eNext = null, ePrev = null;\r\n\r\n        // var iID = this.debugCount++;\r\n        // df.debug(iID + \":touchStart\");\r\n\r\n\r\n\r\n        //  Determine next and previous cards\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            if (this._aCards[i] === oCurrent) {\r\n                iIndex = i;\r\n            }\r\n            if (this._aCards[i].isActive()) {\r\n                if (iIndex < 0) {\r\n                    oPrev = this._aCards[i];\r\n                } else if (!oNext && iIndex !== i) {\r\n                    oNext = this._aCards[i];\r\n                    break;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        if (!this.pbSwipeCards || !oCurrent || (!oNext && !oPrev)) {\r\n            return;\r\n        }\r\n\r\n\r\n        iStartX = iX = (bPointer ? oEv.e.clientX : oEv.e.targetTouches[0].pageX);\r\n        iStartY = iY = (bPointer ? oEv.e.clientY : oEv.e.targetTouches[0].pageY);\r\n\r\n        //  Handles the move event and recalculates the scrollbar position accordingly\r\n        function touchMove(oEv) {\r\n            let iBehindOffset;\r\n\r\n            //  Determine new touch position\r\n            iY = (bPointer ? oEv.e.clientY : oEv.e.targetTouches[0].pageY);\r\n            iX = (bPointer ? oEv.e.clientX : oEv.e.targetTouches[0].pageX);\r\n\r\n\r\n\r\n            //  Switch between horizontal swipe and scroll\r\n            if ((bSwipeFixed && bSwipe) || (!bSwipeFixed && Math.abs(iStartX - iX) > Math.abs(iStartY - iY))) {\r\n                bSwipe = true;\r\n\r\n                iDiff = (iX - iStartX);\r\n\r\n                //  Initialize current card\r\n                if (!eCur) {\r\n                    eCur = oCurrent._eElem;\r\n                    df.dom.addClass(eCur, \"WebC_Swipe\");\r\n\r\n                    iWidth = eCur.offsetWidth;\r\n                }\r\n\r\n                if (iDiff > 0) {\r\n                    //  We are swiping to the right\r\n                    iDiff = Math.min(iWidth, iDiff);\r\n\r\n                    //  Is there a previous card?\r\n                    if (oPrev) {\r\n                        //  Initialize swipe\r\n                        if (!ePrev) {\r\n                            //  Clear next card swipe (might have gone to the left first)\r\n                            if (eNext) {\r\n                                df.dom.translateX(eNext, null, false);\r\n                                df.dom.removeClass(eNext, \"WebC_SwipeBelow\");\r\n\r\n                                eNext = null;\r\n                            }\r\n\r\n                            //  Render if needed\r\n                            if (!oPrev._eElem) {\r\n                                oPrev.renderCard(false);\r\n                            }\r\n                            ePrev = oPrev._eElem;\r\n\r\n                            df.dom.addClass(ePrev, \"WebC_SwipeBelow\");\r\n                        }\r\n\r\n                        //  Calculate position\r\n                        iBehindOffset = -(iWidth * 0.3) + (iDiff * 0.3);\r\n                        // df.debug(iID + \" : behind card : \" + iBehindOffset);\r\n                        df.dom.translateX(ePrev, iBehindOffset, false);\r\n\r\n                        //  Move current card\r\n                        df.dom.translateX(eCur, iDiff, false);\r\n                    } else {\r\n                        //  Do bounce if no previous card\r\n                        iDiff = iDiff * 0.17;\r\n                        df.dom.translateX(eCur, iDiff, false);\r\n\r\n                    }\r\n                } else {\r\n                    //  We are swiping to the left\r\n                    iDiff = Math.max(-iWidth, iDiff);\r\n\r\n                    //  Is there a next card?\r\n                    if (oNext) {\r\n                        //  Initialize if needed\r\n                        if (!eNext) {\r\n                            //  Clear previous card swipe (might have gone to the right first)\r\n                            if (ePrev) {\r\n                                df.dom.translateX(ePrev, null, false);\r\n                                df.dom.removeClass(ePrev, \"WebC_SwipeBelow\");\r\n                                ePrev = null;\r\n                            }\r\n                            //  Render if needed\r\n                            if (!oNext._eElem) {\r\n                                oNext.renderCard(false);\r\n                            }\r\n                            eNext = oNext._eElem;\r\n\r\n                            df.dom.addClass(eNext, \"WebC_SwipeBelow\");\r\n                        }\r\n                        //  Calculate positions\r\n                        iBehindOffset = (iWidth) * 0.3 + (iDiff * 0.3); //eNext.offsetWidth * 0.5 * (iDiff * (100 / eNext.offsetWidth));\r\n                        // df.debug(iID + \" : behind card : \" + iBehindOffset);\r\n                        df.dom.translateX(eNext, iBehindOffset, false);\r\n\r\n                        //  Move current card\r\n                        df.dom.translateX(eCur, iDiff, false);\r\n                    } else {\r\n                        //  Do bounce\r\n                        iDiff = iDiff * 0.17;\r\n                        df.dom.translateX(eCur, iDiff, false);\r\n                    }\r\n                }\r\n\r\n                //  Stop event to prevent parent objects from responding to it\r\n                oEv.stop();\r\n            }\r\n\r\n\r\n        }\r\n\r\n\r\n        function finished() {\r\n            if (oShowCard) {\r\n                this.showCard(oShowCard, false);\r\n            }\r\n            if (ePrev) {\r\n                df.dom.translateX(ePrev, null, false);\r\n                df.dom.removeClass(ePrev, \"WebC_SwipeBelow\");\r\n            }\r\n            if (eNext) {\r\n                df.dom.translateX(eNext, null, false);\r\n                df.dom.removeClass(eNext, \"WebC_SwipeBelow\");\r\n            }\r\n            if (eCur) {\r\n                df.dom.translateX(eCur, null, false);\r\n                df.dom.removeClass(eCur, \"WebC_Swipe WebC_SwipeLeaving\");\r\n            }\r\n        }\r\n\r\n\r\n        //\r\n        //  Handles the touch end and initiates scroll animations if needed.\r\n        //\r\n        function touchEnd(oEv) {\r\n\r\n            if (iDiff > 0) {\r\n                if (oPrev && ePrev) {\r\n\r\n                    //  Check if we swiped far enough\r\n                    if (iDiff > (iWidth * 0.4)) {\r\n                        //  Actually change card\r\n                        oShowCard = oPrev;\r\n\r\n                        if (iDiff < iWidth) {\r\n                            df.dom.transition(ePrev, \"all 200ms\", finished, this);\r\n                            df.dom.translateX(ePrev, 0, false);\r\n\r\n                            df.dom.transition(eCur, \"all 200ms\");\r\n                            df.dom.translateX(eCur, iWidth, false);\r\n                            df.dom.addClass(eCur, \"WebC_SwipeLeaving\");\r\n                        } else {\r\n                            finished.call(this);\r\n                        }\r\n                    } else {\r\n                        if (iDiff < iWidth) {\r\n                            //  Go back\r\n                            df.dom.transition(ePrev, \"all 200ms\", finished, this);\r\n                            df.dom.translateX(ePrev, (iWidth * 0.3), false);\r\n\r\n                            df.dom.transition(eCur, \"all 200ms\");\r\n                            df.dom.translateX(eCur, 0, false);\r\n                        } else {\r\n                            finished.call(this);\r\n                        }\r\n                    }\r\n                } else if (iDiff !== 0 && eCur) {\r\n                    //  Finish bounce\r\n                    df.dom.translateX(eCur, 0, false);\r\n                }\r\n            } else {\r\n                if (oNext && eNext) {\r\n                    //  Check if we swiped far enought\r\n                    if (-iDiff > (iWidth * 0.4)) {\r\n                        //  Change card\r\n                        oShowCard = oNext;\r\n\r\n                        if (-iDiff < iWidth) {\r\n                            df.dom.transition(eNext, \"all 200ms\", finished, this);\r\n                            df.dom.translateX(eNext, 0, false);\r\n\r\n                            df.dom.transition(eCur, \"all 200ms\");\r\n                            df.dom.translateX(eCur, -iWidth, false);\r\n                            df.dom.addClass(eCur, \"WebC_SwipeLeaving\");\r\n                        } else {\r\n                            finished.call(this);\r\n                        }\r\n                    } else {\r\n                        if (-iDiff < iWidth) {\r\n                            //  Go back\r\n                            df.dom.transition(eNext, \"all 200ms\", finished, this);\r\n                            df.dom.translateX(eNext, -(iWidth * 0.3), false);\r\n\r\n                            df.dom.transition(eCur, \"all 200ms\");\r\n                            df.dom.translateX(eCur, 0, false);\r\n                        } else {\r\n                            finished.call(this);\r\n                        }\r\n                    }\r\n                } else if (iDiff !== 0 && eCur) {\r\n                    df.dom.transition(eCur, \"all 100ms\", finished, this);\r\n\r\n                    df.dom.translateX(eCur, 0, false);\r\n                }\r\n            }\r\n\r\n            // df.debug(iID + \":\" + oEv.sName);\r\n            if (bPointer) {\r\n                df.dom.off(\"pointerup\", window, touchEnd, this);\r\n                df.dom.off(\"pointercancel\", window, touchEnd, this);\r\n                df.dom.off(\"pointermove\", window, touchMove, this);\r\n            } else {\r\n                df.dom.off(\"touchend\", window, touchEnd, this);\r\n                df.dom.off(\"touchcancel\", window, touchEnd, this);\r\n                df.dom.off(\"touchmove\", window, touchMove, this);\r\n            }\r\n\r\n        }\r\n\r\n\r\n        if (bPointer) {\r\n            df.dom.on(\"pointerup\", window, touchEnd, this);\r\n            df.dom.on(\"pointercancel\", window, touchEnd, this);\r\n            df.dom.on(\"pointermove\", window, touchMove, this);\r\n        } else {\r\n            df.dom.on(\"touchend\", window, touchEnd, this);\r\n            df.dom.on(\"touchcancel\", window, touchEnd, this);\r\n            df.dom.on(\"touchmove\", window, touchMove, this);\r\n        }\r\n\r\n\r\n        setTimeout(function () {\r\n            bSwipeFixed = true;\r\n        }, 300);\r\n    }\r\n\r\n\r\n    /* \r\n    Override the renderChildren procedure to determine the initial card (we need to know now) and to \r\n    optimize by only rendering the cards that are needed.\r\n    \r\n    @param  eRenderTo   DOM element to render children into (not used by current implementation).\r\n    @private\r\n    */\r\n    renderChildren(eRenderTo) {\r\n        let eChild;\r\n\r\n        //  Determine initial current card\r\n        if (this.psCurrentCard) {\r\n            this._oCurrent = this.getWebApp().findObj(this.psCurrentCard);\r\n        }\r\n\r\n        for (let i = 0; i < this._aCards.length && !this._oCurrent; i++) {\r\n            if (this._aCards[i].isActive()) {\r\n                this._oCurrent = this._aCards[i];\r\n            }\r\n        }\r\n\r\n        //  Get reference to wrapping div\r\n        eRenderTo = this._eControl = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_Body');\r\n\r\n        if (this.hasDynamicHeight()) {    //  If the height is influenced by the card height we need to render all cards on intiialization\r\n            //  Call children and append them to ourselves\r\n            for (let i = 0; i < this._aChildren.length; i++) {\r\n                const oChild = this._aChildren[i];\r\n\r\n                //  Check if we can actually render the object\r\n                if (oChild instanceof WebBaseUIObject) {\r\n                    eChild = oChild.render();\r\n\r\n                    if (eChild) {\r\n                        eRenderTo.appendChild(eChild);\r\n                    }\r\n                }\r\n            }\r\n        } else if (this._oCurrent) {   //  If the height is fixed (pbFillHeight / piHeight is set) then we only have to render the current card\r\n            eChild = this._oCurrent.render();\r\n\r\n            if (eChild) {\r\n                eRenderTo.appendChild(eChild);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    We override this procedure as we do not always render all cards. So we only want to call afterRender \r\n    on the rendered cards.\r\n    \r\n    @private\r\n    */\r\n    afterRenderChildren() {\r\n        if (this.hasDynamicHeight()) {\r\n            super.afterRenderChildren();\r\n        } else if (this._oCurrent) {\r\n            this._oCurrent.afterRender();\r\n        }\r\n\r\n    }\r\n\r\n    /* \r\n    Determines if the card content can influence the height. Is called to see if we need to render all \r\n    cards on initialization or just the current card.\r\n    \r\n    @return True if the container is sized by the card content.\r\n    @private\r\n    */\r\n    hasDynamicHeight() {\r\n        return (!this.pbFillHeight && this.piHeight <= 0);\r\n    }\r\n\r\n    /*\r\n    Augmenting the addChild method to filter out tabs.\r\n    \r\n    @private\r\n    */\r\n    addChild(oChild) {\r\n        if (oChild instanceof WebCard) {\r\n            this._aCards.push(oChild);\r\n        } else if (oChild instanceof WebBaseUIObject) {\r\n            throw new df.Error(999, \"WebCardContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebCard.\", this, [(oChild.getLongName() || 'oWebApp')]);\r\n        }\r\n\r\n\r\n        super.addChild(oChild);\r\n    }\r\n\r\n    /*\r\n    Override the bubbling afterShow message and only send it to the currently shown card.\r\n    */\r\n    afterShow() {\r\n        this._bShown = true;\r\n\r\n        if (this._oCurrent) {\r\n            this._oCurrent.afterShow();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the bubbling afterHide message and only send it to the currently shown card.\r\n    */\r\n    afterHide() {\r\n        this._bShown = false;\r\n\r\n        if (this._oCurrent) {\r\n            this._oCurrent.afterHide();\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - Sizing  - - - - \r\n\r\n    /*\r\n    This method determines the natural height of the card container. It does this by visiting all the \r\n    cards and calling their getRequiredHeight method which returns height required by the \r\n    components inside that card.\r\n    \r\n    @return The natural height needed (based on the highest card).\r\n    */\r\n    getNaturalHeight() {\r\n        let iHeight = 0;\r\n\r\n        //  Determine highest tab page\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            if (this._aCards[i].pbRender && this._aCards[i]._eElem) {\r\n                const iTab = this._aCards[i].getRequiredHeight();\r\n                if (iTab > iHeight) {\r\n                    iHeight = iTab;\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Take the height that we loze\r\n        iHeight += this.getHeightDiff();\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /*\r\n    The sizeHeight method is called by the WebBaseContainer and WebBaseControl to size the control. We \r\n    override the default implementation because the WebCardContainer has special logic when sizing \r\n    'naturally'. Other controls have the natural size determined by their CSS but the we need to \r\n    determine it based on the controls embedded inside the WebCards.\r\n    \r\n    @param  iExtHeight  The height determined by the container (-1 means suite yourself).\r\n    @return The height that is actually applied.\r\n    */\r\n    sizeHeight(iExtHeight) {\r\n        let iHeight = -1;\r\n\r\n        //  Determine which height to use\r\n        if (this.pbFillHeight) {\r\n            iHeight = iExtHeight;\r\n        } else {\r\n            if (this.piHeight > 0) {\r\n                iHeight = this.piHeight;\r\n            } else {\r\n                iHeight = this.getNaturalHeight();\r\n            }\r\n        }\r\n\r\n        //  Respect minimal height\r\n        if (iHeight < this.piMinHeight) {\r\n            iHeight = this.piMinHeight;\r\n        }\r\n\r\n        //  Update the height\r\n        this.setHeight(iHeight);\r\n\r\n        //  Adjust tab content sizes\r\n        this.resizeCards();\r\n\r\n        //  Return the final height\r\n        if (iHeight > 0) {\r\n            return iHeight;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Called by the setHeight method, we override it here to make it call into getHeightDiff.\r\n    \r\n    @param  iHeight     The height in pixels.\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = 0;\r\n\r\n        if (this.peLabelPosition === df.ciLabelTop && this._eLbl) {\r\n            iResult += this._eLbl.offsetHeight;\r\n        }\r\n\r\n        iResult += this.getHeightDiff();\r\n        return iResult;\r\n    }\r\n\r\n    /*\r\n    The resize method is called when the view / application resizes and during initialization. We call \r\n    the resize methods of the WebCards.\r\n    \r\n    @private\r\n    */\r\n    resize() {\r\n\r\n        if (this._eElem && this._bRendered) {\r\n            //  A resize can also mean that the tab page size changed, if pbFillHeight is true sizeHeight will be called by container, if not we force it here!\r\n            if (!this.pbFillHeight) {\r\n                this.sizeHeight(-1);\r\n            } else {\r\n                this.resizeCards();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Resizes the tabs, which is called from sizeHeight and the resize function.\r\n    \r\n    @private\r\n    */\r\n    resizeCards() {\r\n        //  Resize the tabpages\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            if (this._aCards[i]._eElem) {\r\n                this._aCards[i].resizeHorizontal();\r\n                this._aCards[i].resizeVertical();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines the height that is lost. For the tab panel this is the space that the buttons \r\n    take.\r\n    \r\n    @return The amount of pixels that can't be used by the content.\r\n    @private\r\n    */\r\n    getHeightDiff() {\r\n        let iHeight = 0;\r\n\r\n        if (this.pbShowCaption && this._eHead) {\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eHead, 1);  //  Outside difference\r\n        }\r\n\r\n        if (this._eControl) {\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControl);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eInner);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControlWrp);\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    /*\r\n    The getMinHeight function is called by the column layout resize system implemented in \r\n    WebBaseContainer. It determines the minimal height that the control needs to render itself. The \r\n    WebCardContainer uses the getNaturalHeight method to determine the required height and respects the \r\n    piMinHeight property.\r\n    \r\n    @return The minimal height needed in pixels.\r\n    */\r\n    getMinHeight() {\r\n        let iHeight = 0;\r\n\r\n        if(this.pbFillHeight){\r\n            return this.piMinHeight;\r\n        }\r\n        if(this.piHeight > 0){\r\n            return Math.max(this.piHeight, this.piMinHeight);\r\n            }\r\n\r\n        this.resize();\r\n            //  Determine natural height\r\n            iHeight = this.getNaturalHeight();\r\n\r\n            //  Respect piMinHeight\r\n            if (iHeight < this.piMinHeight) {\r\n                iHeight = this.piMinHeight;\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n\r\n    /* \r\n    Makes sure that all cards are rendered. \r\n    \r\n    @private\r\n    */\r\n    renderAllCards() {\r\n\r\n        if (this._eControl) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                if (!this._aCards[i]._eElem) {\r\n                    const eElem = this._aCards[i].render();\r\n                    this._eControl.appendChild(eElem);\r\n                    this._aCards[i].afterRender();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment piHeight setter and make sure that all cards are rendered if it is set to 0.\r\n    \r\n    @param  iVal    New value.\r\n    @private\r\n    */\r\n    set_piHeight(iVal) {\r\n        if (iVal <= 0) {\r\n            this.renderAllCards();\r\n        }\r\n\r\n        super.set_piHeight(iVal);\r\n    }\r\n\r\n    /* \r\n    Augment pbFillHeight setter and make sure that all cards are rendered if it is set to false.\r\n    \r\n    @param  iVal    New value.\r\n    @private\r\n    */\r\n    set_pbFillHeight(bVal) {\r\n        if (!bVal) {\r\n            this.renderAllCards();\r\n        }\r\n\r\n        super.set_pbFillHeight(bVal);\r\n    }\r\n\r\n\r\n    // - - - - Focus  - - - - \r\n\r\n    /*\r\n    We attach the focus events to the header of the tab container because that is the part that takes \r\n    the focus.\r\n    \r\n    @private\r\n    */\r\n    attachFocusEvents() {\r\n        //  We are attaching a DOM capture listener so we know when we get the focus\r\n        if (this._eHead) {\r\n            if (window.addEventListener) {\r\n                df.events.addDomCaptureListener(\"focus\", this._eHead, this.onFocus, this);\r\n                df.events.addDomCaptureListener(\"blur\", this._eHead, this.onBlur, this);\r\n            } else {\r\n                df.dom.on(\"focusin\", this._eHead, this.onFocus, this);\r\n                df.dom.on(\"focusout\", this._eHead, this.onBlur, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Pass the focus on to the children like a container.\r\n    */\r\n    focus(bOptSelect) {\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (this._aChildren[i].focus) {\r\n                if (this._aChildren[i].focus(bOptSelect)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /* \r\n    The conditionalFocus only really gives the focus to an element on desktop browsers where on mobile \r\n    browsers it only registers the object as having the focus without actually giving the focus to the \r\n    DOM. \r\n    \r\n    @param  bOptSelect      Select the text in forms if true.\r\n    @return True if the focus is taken.\r\n    */\r\n    conditionalFocus(bOptSelect) {\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            if (this._aChildren[i].conditionalFocus) {\r\n                if (this._aChildren[i].conditionalFocus(bOptSelect)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Make sure that we only forward focus events if we don't already have the focus. Also cancel the blur \r\n    timeout.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onFocus(oEvent) {\r\n        if (!this._bHasFocus) {\r\n            super.onFocus(oEvent);\r\n        }\r\n\r\n        this._bLozingFocus = false;\r\n    }\r\n\r\n    /*\r\n    Since the focus can change within the control we only forward the blur after a small timeout. If \r\n    focus events occur within this timeout we know that the control still has the focus so we don't \r\n    perform the blur.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n        const superFunction = super.onBlur\r\n\r\n        this._bLozingFocus = true;\r\n\r\n        setTimeout(function () {\r\n            if (that._bLozingFocus) {\r\n                superFunction.call(that, oEvent);\r\n\r\n                that._bLozingFocus = false;\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n\r\n    // - - - - Generic - - - - \r\n\r\n    /*\r\n    This method loops over the tabs and makes sure all of them are hidden and the right one is shown.\r\n    \r\n    @private\r\n    */\r\n    showCard(oDisplay, bOptFirst) {\r\n        if (this.isEnabled() || bOptFirst) {   // Is the right place to do this thing (should a disabled card container not be able to change cards dynamically?)?\r\n            if (oDisplay && oDisplay.isActive()) {\r\n                //  Fire cardchange event if needed\r\n                if (!bOptFirst && oDisplay !== this._oCurrent) {\r\n                    this.fireCardChange(oDisplay._sName, (this._oCurrent && this._oCurrent._sName) || \"\");\r\n                }\r\n\r\n                //  Visit all tabs showing / hiding them\r\n                if (this._eElem) {\r\n                    for (let i = 0; i < this._aCards.length; i++) {\r\n                        const oTab = this._aCards[i];\r\n\r\n                        if (oTab === oDisplay) {\r\n                            oTab._show(!!bOptFirst);\r\n\r\n                            if (this._eLabel) {\r\n                                df.dom.setText(this._eLabel, oTab.psCaption);\r\n                            }\r\n                        } else {\r\n                            oTab._hide(!!bOptFirst);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //  Trigger afterHide\r\n                if (!bOptFirst && this._oCurrent) {\r\n                    this._oCurrent.afterHide();\r\n                }\r\n\r\n                this._oCurrent = oDisplay;\r\n\r\n                //  Trigger afterShow\r\n                if (!bOptFirst) {\r\n                    this._oCurrent.afterShow();\r\n                }\r\n\r\n                if (this.getWebApp()) {\r\n                    this.getWebApp().notifyLayoutChange(this);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    fireCardChange(sTo, sFrom) {\r\n        this.fire('OnCardChange', [sTo, sFrom]);\r\n    }\r\n\r\n    hideCard(oHide) {\r\n        let oLast = null, bFound = false;\r\n        if (oHide === this._oCurrent) {\r\n            //  Find the next tab to display\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                const oTab = this._aCards[i];\r\n\r\n                if (oTab.isActive()) {\r\n                    if (bFound) {\r\n                        this.showCard(oTab);\r\n                        return;\r\n                    }\r\n                    oLast = oTab;\r\n                }\r\n\r\n                if (oTab === oHide) {\r\n                    bFound = true;\r\n                }\r\n            }\r\n\r\n            this.showCard(oLast);\r\n        }\r\n    }\r\n\r\n    nextCard() {\r\n        let bFound = false;\r\n\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            const oTab = this._aCards[i];\r\n\r\n            if (!bFound) {\r\n                bFound = (oTab === this._oCurrent);\r\n            } else {\r\n                if (oTab.isActive()) {\r\n                    this.showCard(oTab);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    previousCard() {\r\n        let bFound = false;\r\n\r\n        for (let i = this._aCards.length - 1; i >= 0; i--) {\r\n            const oTab = this._aCards[i];\r\n\r\n            if (!bFound) {\r\n                bFound = (oTab === this._oCurrent);\r\n            } else {\r\n                if (oTab.isActive()) {\r\n                    this.showCard(oTab);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    get_psCurrentCard() {\r\n        return (this._oCurrent && this._oCurrent.getLongName()) || \"\";\r\n    }\r\n\r\n    /*\r\n    Augment the genClass function to add classes indicating wether a caption and / or a border is shown.\r\n    \r\n    @private\r\n    */\r\n    genClass() {\r\n        let sClass = super.genClass();\r\n\r\n        if (this.pbShowCaption) {\r\n            sClass += \" WebCC_HasCaption\";\r\n        }\r\n        if (this.pbShowBorder) {\r\n            sClass += \" WebCC_HasBorder\";\r\n        }\r\n\r\n        return sClass;\r\n    }\r\n\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebCC_HasBorder\", bVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_pbShowCaption(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebCC_HasCaption\", bVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eLabel) {\r\n            this._eLabel.style.background = sVal || '';\r\n        }\r\n        if (this._eControl) {\r\n            this._eControl.style.background = sVal || '';\r\n        }\r\n    }\r\n};\r\n","import { WebCard } from './WebCard.js';\r\n/*\r\nClass:\r\n    df.WebTabPage\r\nExtends:\r\n    df.WebCard\r\n\r\nThis class represents a page within a tab container. The main functionality is available in the \r\nWebCard class. The tab page is a container that contains controls and its tab button is rendered by \r\nthe tab container.\r\n    \r\nRevision:\r\n    2011/10/13  (HW, DAW) \r\n        Initial version.\r\n    2012/10/02  (HW, DAW)\r\n        Split into WebCard and WebTabPage.\r\n*/\r\nexport class WebTabPage extends WebCard {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebTabPage\";\r\n        this._bCC = true; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nName:\r\n    df.WebTreeView\r\nType:\r\n    Class\r\n\r\nImplementation of the treeview control. This controls is capable of rendering a treeview using HTML \r\nbased on information received from the server.\r\n    \r\nRevisions:\r\n    2009/10/07  (HW, DAE)\r\n        Created the initial version. \r\n    2012/04/03  (HW, DAW)\r\n        Refactored the original AjaxTreeView and TreeView classes from the AJAX Library into a \r\n        single WebTreeView class. The new class is part of the new web framework for VDF 17.1.\r\n*/\r\ndf.tWebTreeItem = {\r\n    sId: df.tString,\r\n    sParentId: df.tString,\r\n    sName: df.tString,\r\n    sAltText: df.tString,\r\n\r\n    sValue: df.tString,\r\n    sCSSClass: df.tString,\r\n    sIcon: df.tString,\r\n    bFolder: df.tBool,\r\n\r\n    bLoadChildren: df.tBool,\r\n    bExpanded: df.tBool\r\n};\r\n\r\nexport class WebTreeView extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web Properties\r\n        this.prop(df.tBool, \"pbShowIcons\", true);\r\n        this.prop(df.tBool, \"pbAllowHtml\", false);\r\n        this.prop(df.tString, \"psSelectedId\", \"\");\r\n        this.prop(df.tString, \"psSelectedValue\", \"\");\r\n\r\n        //  Events\r\n        this.event(\"OnSelect\", df.cCallModeWait);\r\n        this.event(\"OnExpand\", df.cCallModeDefault);\r\n        this.event(\"OnCollapse\", df.cCallModeDefault);\r\n\r\n        // @privates\r\n        this._aRootItems = [];\r\n        this._aItems = [];\r\n        this._iAutoNum = 1000;\r\n        this._tSelectedNode = null;\r\n\r\n        this._bRedraw = false;\r\n\r\n        this._eRootTable = null;\r\n\r\n        this._eCurHoveredElem = null;\r\n        this._fHoverTimeOut = null;\r\n\r\n        this._sControlClass = \"WebTreeView\";\r\n    }\r\n\r\n    /*\r\n    This method generates the wrapping HTML of the treeview. This includes an hidden anchor used for \r\n    receiving and keeping the focus.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebTree_Body\" style=\"height: 10px;\" ',\r\n            (!this.isEnabled() ? 'tabindex=\"-1\"' : 'tabindex=\"0\"'), '>');\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML that closes the wrapping elements of the treeview.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method gathers references to the HTML elements and attaches DOM listeners.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        const that = this;\r\n\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, 'div.WebTree_Body');\r\n        this._eFocus = this._eControl; //df.dom.query(this._eElem, 'a');\r\n\r\n        super.afterRender();\r\n\r\n        //  Attach event listeners\r\n        df.dom.on(\"click\", this._eControl, this.onBodyClick, this);\r\n        df.dom.on(\"dblclick\", this._eControl, this.onBodyDblClick, this);\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n\r\n        //  Render the initial tree\r\n        this.redraw();\r\n        setTimeout(function () {\r\n            if (that._tSelectedNode) {\r\n                that.scrollToElement(that._tSelectedNode._eElem);\r\n            }\r\n        }, 50);\r\n\r\n        setTimeout(function () {\r\n            that.dragDropCleanup();\r\n            that.dragDropInit();\r\n        }, 50);\r\n    }\r\n\r\n    /* \r\n    Augments applyEnabled to set the tabindex attribute of the focus element.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eFocus) {\r\n            this._eFocus.tabIndex = (bVal ? 0 : -1);\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - - - Public API - - - - - - - - - -\r\n\r\n    /*\r\n    Getter method that determines the currently selected id.\r\n    \r\n    @return The ID of the currently selected node or \"\" if no node is selected.\r\n    */\r\n    get_psSelectedId() {\r\n        if (this._tSelectedNode) {\r\n            return this._tSelectedNode.sId;\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n    /*\r\n    Getter method that determines the currently selected value.\r\n    \r\n    @return The value of the currently selected node or \"\" if no node is selected.\r\n    */\r\n    get_psSelectedValue() {\r\n        if (this._tSelectedNode) {\r\n            return this._tSelectedNode.sValue;\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n\r\n    /* \r\n    Setter method for the pbShowIcons property that redraws the tree based on the new setting. \r\n    \r\n    @param  bVal    New value.\r\n    @private\r\n    */\r\n    set_pbShowIcons(bVal) {\r\n        this.pbShowIcons = bVal;\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    /*\r\n    This method selects the node with the passed ID. Nothing happens if the ID is not found which can \r\n    happen because the tree doesn't always load all items.\r\n    \r\n    @param  sNodeId     ID of the tree node.\r\n    @client-action\r\n    */\r\n    select(sNodeId) {\r\n        const tNode = this.getNodeById(sNodeId);\r\n\r\n        if (tNode) {\r\n            this.doSelect(tNode, false);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method expands the node with the passed ID. Nothing happens if the ID is not found which can \r\n    happen because the tree doesn't always load all items.\r\n    \r\n    @param  sNodeId     Unique ID of the tree node.\r\n    @client-action\r\n    */\r\n    expand(sNodeId) {\r\n        const tNode = this.getNodeById(sNodeId);\r\n\r\n        if (tNode && tNode.bFolder) {\r\n            this.expandNode(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method collapses the node with the passed ID. Nothing happens if the ID is not found which can \r\n    happen because the tree doesn't always load all items.\r\n    \r\n    @param  sNodeId     Unique ID of the tree node.\r\n    \r\n    @client-action\r\n    */\r\n    collapse(sNodeId) {\r\n        const tNode = this.getNodeById(sNodeId);\r\n\r\n        if (tNode) {\r\n            this.collapseNode(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method will collapse all nodes.\r\n    \r\n    @client-action\r\n    */\r\n    collapseAll() {\r\n\r\n        for (let i = 0; i < this._aItems.length; i++) {\r\n            if (this._aItems[i].bExpanded) {\r\n                this.collapseNode(this._aItems[i]);\r\n            }\r\n        }\r\n\r\n        //this.redraw();\r\n    }\r\n\r\n    /*\r\n    This method refreshes the tree with the tree items encoded in the action data. The action data is a \r\n    two dimensional array that is used for sending 'complex data' with client actions. If a parent id is \r\n    provided then the nodes will be inserted as children of the parent node. If no parent id is provided \r\n    then the entire tree will be cleared and nodes will be inserted at the root of the tree.\r\n    \r\n    @param  sParentId     (optional) Unique ID of the parent tree node.\r\n    \r\n    \r\n    @client-action\r\n    */\r\n    refresh(sParentId) {\r\n        let tNode, sSelectedId;\r\n        const aNodes = this.deserializeVT(this._tActionData);\r\n\r\n        //  Remeber selected item\r\n        sSelectedId = this._tSelectedNode && (this._tSelectedNode.sId || \"\");\r\n        if (!sSelectedId && this.psSelectedId) {\r\n            sSelectedId = this.psSelectedId;\r\n            this.psSelectedId = \"\";\r\n        }\r\n\r\n        if (sParentId) {\r\n            //  Remove the sub nodes of the parent node first\r\n            tNode = this.getNodeById(sParentId);\r\n\r\n            if (tNode) {\r\n                while (tNode._aChildren.length > 0) {\r\n                    this.doRemove(tNode._aChildren[0], true);\r\n                }\r\n            }\r\n        } else {\r\n            //  Clear current tree\r\n            this.clear();\r\n            this.displayLoading();\r\n        }\r\n\r\n        for (let i = 0; i < aNodes.length; i++) {\r\n            tNode = this.initNode(aNodes[i]);\r\n\r\n            //  No parent id makes it a child of the parent we are loading for (root / \"\" if loading entire tree)\r\n            if (!tNode.sParentId) {\r\n                tNode.sParentId = sParentId || \"\";\r\n            }\r\n\r\n\r\n            //  Insert\r\n            this.insert(tNode);\r\n        }\r\n\r\n        //  Try to reselect the selected item\r\n        if (sSelectedId) {\r\n            tNode = this.getNodeById(sSelectedId);\r\n            if (tNode) {\r\n                this._tSelectedNode = tNode;\r\n            }\r\n        } else {\r\n            this._tSelectedNode = null;\r\n        }\r\n        //  Redraw\r\n        this.redraw();\r\n        this.hideLoading();\r\n    }\r\n\r\n    /*\r\n    This method is called to update a node. The node should be sent as client-data (two dimensional \r\n    array). If the node is found using its ID it will be updated and the display will be refreshed.\r\n    \r\n    @client-action\r\n    */\r\n    updateNode() {\r\n        var tNewNode, tOrigNode;\r\n        const aNodes = this.deserializeVT(this._tActionData);\r\n\r\n        if (aNodes.length > 0) {\r\n            //  Convert from data to node\r\n            tNewNode = this.initNode(aNodes[0]);\r\n\r\n            tOrigNode = this.getNodeById(tNewNode.sId);\r\n\r\n            if (tOrigNode) {\r\n                //  Update the node\r\n                tOrigNode.sName = tNewNode.sName;\r\n                tOrigNode.sAltText = tNewNode.sAltText;\r\n                tOrigNode.sValue = tNewNode.sValue;\r\n                tOrigNode.sCSSClass = tNewNode.sCSSClass;\r\n                tOrigNode.sIcon = tNewNode.sIcon;\r\n                tOrigNode.bFolder = tNewNode.bFolder;\r\n                tOrigNode.bLoadChildren = tNewNode.bLoadChildren;\r\n\r\n                //  Update display\r\n                this.redraw();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called to insert a new node. The node should be sent as client-data (two dimensional \r\n    array). \r\n    \r\n    @client-action\r\n    */\r\n    insertNode() {\r\n        let tNewNode;\r\n        const aNodes = this.deserializeVT(this._tActionData);\r\n\r\n        if (aNodes.length > 0) {\r\n            //  Convert from data to node\r\n            tNewNode = this.initNode(aNodes[0]);\r\n\r\n            this.insert(tNewNode);\r\n\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method will remove a node from the tree. If the node is not found then nothing will happen.\r\n    \r\n    @param  sNodeId     The unique id of the node to remove.\r\n    @client-action\r\n    */\r\n    removeNode(sNodeId) {\r\n        const tNode = this.getNodeById(sNodeId);\r\n\r\n        if (tNode) {\r\n            this.doRemove(tNode);\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - - - Engine - - - - - - - - - -\r\n\r\n    /* \r\n    Generates a deserializer function that deserializes a value tree in an array of tree items with \r\n    optimal performance.\r\n    \r\n    @param  tVT     Value tree with data.\r\n    @return Array of tree item objects.\r\n    */\r\n    deserializeVT = df.sys.vt.generateDeserializer([df.tWebTreeItem])\r\n\r\n    /*\r\n    This method is called to load the children of tree nodes that are expanded. A server-action is fired \r\n    to the server to load the nodes. The server will call a client-action called addSubItems to pass the \r\n    new items. The node is expanded when finished.\r\n    \r\n    @param  tParentNode     The node of which the child nodes need to be loaded.\r\n    @private\r\n    */\r\n    loadSubNodes(tParentNode) {\r\n        let sParentId = \"\", sParentValue = \"\", iParentLevel = 0;\r\n\r\n        //  Display loading and determine call details\r\n        if (tParentNode) {\r\n            tParentNode._bIsLoading = true;\r\n            this.displayLoading(tParentNode);\r\n\r\n            sParentId = tParentNode.sId;\r\n            sParentValue = tParentNode.sValue;\r\n            iParentLevel = this.getLevel(tParentNode);\r\n        } else {\r\n            this.clear();\r\n            this.displayLoading();\r\n\r\n        }\r\n\r\n        //  Perform the server-action\r\n        this.serverAction(\"LoadSubNodes\", [sParentId, sParentValue, iParentLevel], null, function (oEvent) {\r\n            //  Update the parent node\r\n            if (tParentNode) {\r\n                tParentNode._bIsLoading = false;\r\n                this.updateNodeCSS(tParentNode);\r\n            }\r\n\r\n            //  Expand the node or redraw the tree\r\n            if (!oEvent.bError) {\r\n                if (tParentNode) {\r\n                    tParentNode._bIsLoaded = true;\r\n                    this.expandNode(tParentNode);\r\n                } else {\r\n                    this.redraw();\r\n                }\r\n            }\r\n\r\n            //  Hide loading\r\n            this.hideLoading(tParentNode);\r\n        }, this);\r\n    }\r\n\r\n    /*\r\n    This client-action is called by the LoadSubNodes server-action to insert new nodes. The nodes will \r\n    be encoded into the action data (two dimensional array). The new nodes will be initialized and \r\n    inserted into the tree.\r\n    \r\n    @param  sParentId   Unique ID of the parent node indicating where to insert the ndoes.\r\n    \r\n    @client-action\r\n    @private\r\n    */\r\n    addSubItems(sParentId) {\r\n        let tNode\r\n        const aNodes = this.deserializeVT(this._tActionData);\r\n\r\n        for (let i = 0; i < aNodes.length; i++) {\r\n            tNode = this.initNode(aNodes[i]);\r\n\r\n            //  No parent id makes it a child of the parent we are loading for (root / \"\" if loading entire tree)\r\n            if (!tNode.sParentId) {\r\n                tNode.sParentId = sParentId || \"\";\r\n            }\r\n\r\n\r\n            //  Insert\r\n            this.insert(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method initializes a new node based on the passed raw data. The raw data is an array which \r\n    represents the node. This array is used when sending nodes from the server to client.\r\n    \r\n    @param  aRaw     Raw array representing the node.\r\n    @return Node object.\r\n    @private\r\n    */\r\n    initNode(tNode) {\r\n\r\n        tNode._aChildren = [];\r\n        tNode._tParent = null;\r\n        tNode._eElem = null;\r\n        tNode._eSubMenuRow = null;\r\n        tNode._eSubMenuTable = null;\r\n\r\n        tNode._bIsLoading = false;\r\n        tNode._bIsLoaded = tNode.bExpanded; // Assume that if an item is expanded its sub nodes are provided\r\n\r\n\r\n        //  Autonumber if needed\r\n        if (!tNode.sId) {\r\n            this._iAutoNum++;\r\n            tNode.sId = this._iAutoNum.toString();\r\n        }\r\n\r\n\r\n\r\n        return tNode;\r\n    }\r\n\r\n    /*\r\n    The node will be inserted into the tree based on its settings. If no (correct) \r\n    parent ID is found it will be added to the root. The display won't be updated so \r\n    the refresh method should be called.\r\n    \r\n    @param  tNode   New node (see: df.dataStructs.TAjaxTreeNode).\r\n    */\r\n    insert(tNode) {\r\n        let tParent;\r\n\r\n        //  Check if item doesn't already exist\r\n        if (this.getNodeById(tNode.sId)) {\r\n            throw new df.Error(5151, \"Node IDs must be unique (ID: '{{0}}')\", this, [tNode.sId]);\r\n        }\r\n\r\n        //  Search for parent\r\n        if (tNode.sParentId) {\r\n            tParent = this.getNodeById(tNode.sParentId);\r\n        }\r\n\r\n        //  Add to its parent\r\n        if (tParent) {\r\n            tNode._tParent = tParent;\r\n            tParent._aChildren.push(tNode);\r\n        } else {\r\n            this._aRootItems.push(tNode);\r\n        }\r\n\r\n        //  Add to the full item list\r\n        this._aItems.push(tNode);\r\n    }\r\n\r\n    /*\r\n    All the nodes will be removed from the tree. The display is updated.\r\n    */\r\n    clear() {\r\n\r\n        if (this._eRootTable) {\r\n            this._eControl.removeChild(this._eRootTable);\r\n\r\n            for (let i = 0; i < this._aItems.length; i++) {\r\n                if (this._aItems[i]._eElem) {\r\n                    this._aItems[i]._eElem.tNode = null;\r\n                }\r\n                this._aItems[i]._eElem = null;\r\n                this._aItems[i]._eSubMenuRow = null;\r\n                this._aItems[i]._eSubMenuTable = null;\r\n            }\r\n        }\r\n\r\n        this._tSelectedNode = null;\r\n        this._aItems = [];\r\n        this._aRootItems = [];\r\n\r\n        if (this._eControl) {\r\n            this._eRootTable = this.constructTable();\r\n            this._eControl.appendChild(this._eRootTable);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates the display based on the internal node structure. Newly inserted nodes \r\n    will be displayed correctly. Expanded items stay expanded and the selected node \r\n    will still be selected.\r\n    */\r\n    redraw() {\r\n\r\n        if (this._eControl) {\r\n            this._bRedraw = true;\r\n\r\n            if (this._eRootTable) {\r\n                this._eControl.removeChild(this._eRootTable);\r\n\r\n                for (let i = 0; i < this._aItems.length; i++) {\r\n                    this._aItems[i]._eElem = null;\r\n                    this._aItems[i]._eSubMenuRow = null;\r\n                    this._aItems[i]._eSubMenuTable = null;\r\n                }\r\n            }\r\n            this._eRootTable = this.constructTable();\r\n\r\n            this.constructMenu(this._aRootItems, this._eRootTable);\r\n\r\n            this._eControl.appendChild(this._eRootTable);\r\n\r\n            this._bRedraw = false;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Constructs a tree table (root or subitems).\r\n    \r\n    @private\r\n    */\r\n    constructTable() {\r\n        const eTable = document.createElement(\"table\");\r\n\r\n        return eTable;\r\n    }\r\n\r\n    /*\r\n    Constructs a node row at the given position in the table.\r\n    \r\n    @param  tNode       Node struct.\r\n    @param  eTable      Table element to which the node row needs to be added.\r\n    @param  iPos        Position in the table.\r\n    @param  bIsStart    True if the node is the first node on his level.\r\n    @param  bIsLast     True if the node is the last node on his level.\r\n    @private\r\n    */\r\n    constructNode(tNode, eTable, iPos, bIsStart, bIsLast) {\r\n        let eCell, sName;\r\n\r\n        //  Determine if node has sub menu\r\n        const bDoSub = tNode._aChildren.length > 0 || tNode.bLoadChildren;\r\n\r\n        //  Create row\r\n        const eRow = eTable.insertRow(iPos);\r\n        eRow.setAttribute(\"data-dftree-id\", tNode.sId);\r\n        if (this.pbDragDropEnabled) {\r\n            if (tNode.bFolder) {\r\n                if (this.isSupportedDragAction(df.dragActions.WebTreeView.ciDragFolder)) {\r\n                    eRow.setAttribute('draggable', true);\r\n                }\r\n            } else {\r\n                if (this.isSupportedDragAction(df.dragActions.WebTreeView.ciDragItem)) {\r\n                    eRow.setAttribute('draggable', true);\r\n                }\r\n            }\r\n\r\n        }\r\n        tNode._eElem = eRow;\r\n\r\n        //  Tree cell\r\n        eCell = eRow.insertCell(0);\r\n        eCell.innerHTML = \"<div>&nbsp;</div>\";\r\n\r\n        //  Content cell\r\n        eCell = eRow.insertCell(eRow.cells.length);\r\n\r\n        //  Text span\r\n        sName = (this.pbAllowHtml ? tNode.sName : df.dom.encodeHtml(tNode.sName));\r\n        eCell.innerHTML = '<span class=\"WebTree_Text\" title=\"' + df.dom.encodeAttr(tNode.sAltText) + '\">' + sName + '</span>';\r\n\r\n        this.updateNodeCSS(tNode);\r\n\r\n        //  Add listener(s)\r\n        if (bDoSub) {\r\n            // df.dom.on(\"click\", eRow, this.onExpandClick, this);\r\n\r\n            if (tNode.bExpanded) {\r\n                iPos++;\r\n                this.constructSubmenu(tNode, eTable, iPos, bIsLast);\r\n            }\r\n        }\r\n\r\n        return iPos;\r\n    }\r\n\r\n    /*\r\n    Generates the DOM elements for the given list of nodes on the given table.\r\n    \r\n    @param  aNodes  Array with nodes.\r\n    @param  eTable  Table element.\r\n    @private\r\n    */\r\n    constructMenu(aNodes, eTable) {\r\n        let iPos = 0;\r\n\r\n        for (let iNode = 0; iNode < aNodes.length; iNode++) {\r\n            iPos = this.constructNode(aNodes[iNode], eTable, iPos, (iNode === 0 && eTable === this.eRootTable), (iNode === aNodes.length - 1));\r\n            iPos++;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Constructs the submenu that belongs to the given node.\r\n    \r\n    @param  tNode       Node element.\r\n    @param  eTable      Table element in which the node is located.\r\n    @param  iPos        Position to generate submenu on.\r\n    @param  bIsLast     Determines wether the node is the last on this level.\r\n    @private\r\n    */\r\n    constructSubmenu(tNode, eTable, iPos, bIsLast) {\r\n        let eCell;\r\n\r\n        const eRow = eTable.insertRow(iPos);\r\n        eRow.className = \"WebTree_SubRow\" + (!this._bRedraw ? \" WebTree_HiddenSubRow\" : \"\");\r\n\r\n        eCell = eRow.insertCell(0);\r\n        eCell.className = (bIsLast ? \"WebTree_ConLast\" : \"WebTree_Con\");\r\n\r\n        eCell = eRow.insertCell(1);\r\n        eCell.innerHTML = \"<table></table>\";\r\n\r\n        const eNewTable = df.dom.query(eCell, \"table\"); //this.constructTable();\r\n\r\n        tNode._eSubMenuRow = eRow;\r\n        tNode._eSubMenuTable = eNewTable;\r\n\r\n        this.constructMenu(tNode._aChildren, eNewTable, false);\r\n\r\n        //  Make visible after small timeout for possible animation\r\n        if (!this._bRedraw) {\r\n            setTimeout(function () {\r\n                if (tNode._eSubMenuRow) {\r\n                    df.dom.removeClass(tNode._eSubMenuRow, \"WebTree_HiddenSubRow\");\r\n                }\r\n            }, 20);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Redefines the CSS classes set on the node elements.\r\n    \r\n    @private\r\n    */\r\n    updateNodeCSS(tNode) {\r\n\r\n        if (tNode._eElem) {\r\n            //  Update node CSS\r\n            tNode._eElem.className = (tNode.bExpanded ? \"WebTree_Expanded\" : \"WebTree_Collapsed\") + (tNode === this._tSelectedNode ? \" WebTree_Selected\" : \"\") + \" \" + tNode.sCSSClass;\r\n\r\n            const bFirst = this.isFirst(tNode);\r\n            const bLast = this.isLast(tNode);\r\n            const bRoot = this.isRoot(tNode);\r\n            const bSub = this.hasChildren(tNode);\r\n\r\n            tNode._eElem.cells[0].className = \"WebTree_Item WebTree_\" + ((bFirst && bRoot) || bLast ? (bFirst && bRoot ? \"Start\" : \"\") + (bLast ? \"End\" : \"\") : \"Entry\") + (bSub ? \"Sub\" : \"\");\r\n\r\n            if (this.pbShowIcons) {\r\n                const eCell = tNode._eElem.cells[1];\r\n\r\n                if (tNode.sIcon && !tNode._bIsLoading) {\r\n                    eCell.style.backgroundImage = \"url('\" + tNode.sIcon + \"')\";\r\n                    eCell.style.backgroundRepeat = \"no-repeat\";\r\n                    eCell.className = (tNode.bFolder ? \"WebTree_Folder \" : \"WebTree_Icon \") + \"WebTree_HasIcon\";\r\n                } else {\r\n                    eCell.className = (tNode._bIsLoading ? \"WebTree_IconLoading \" : \"WebTree_NoIcon \") + (tNode.bFolder ? \"WebTree_Folder \" : \"WebTree_Icon \");\r\n                    eCell.style.backgroundImage = \"\";\r\n                    //  FIX: Internet Explorer 8 won't go back to CSS setting, this can cause problems when dynamically changing the icon at runtime\r\n                    // eCell.style.backgroundPosition = \"\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // - - - - - - - Navigation - - - - - - - - -\r\n\r\n    /*\r\n    If the node is expanded it will be collapsed or the other way around.\r\n    \r\n    @param  tNode   Node to toggle (see: df.dataStructs.TAjaxTreeNode).\r\n    */\r\n    toggle(tNode) {\r\n        if (tNode.bExpanded) {\r\n            this.collapseNode(tNode);\r\n        } else {\r\n            this.expandNode(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    The node will be expanded.\r\n    \r\n    @param  tNode   Node to expand (see: df.dataStructs.TAjaxTreeNode).\r\n    */\r\n    expandNode(tNode) {\r\n        tNode.bExpanded = true;\r\n\r\n        if (tNode._bIsLoading) {\r\n            return;\r\n        }\r\n\r\n        this.fire(\"OnExpand\", [tNode.sId, tNode.sValue, this.getLevel(tNode)]);\r\n\r\n        if (!tNode._bIsLoaded && tNode.bLoadChildren) {\r\n            this.loadSubNodes(tNode);\r\n        } else {\r\n            if (tNode._eElem) {\r\n                if (tNode._eSubMenuRow) { //  Unhide if DOM elements are already there\r\n                    //   Display by removing CSS class (so a CSS3 transition can be used for animation)\r\n                    df.dom.removeClass(tNode._eSubMenuRow, \"WebTree_HiddenSubRow\");\r\n                } else {  //  Generate DOM elements\r\n                    this.constructSubmenu(tNode, (tNode._tParent ? tNode._tParent._eSubMenuTable : this._eRootTable), tNode._eElem.rowIndex + 1, this.isLast(tNode));\r\n                }\r\n            }\r\n\r\n            this.updateNodeCSS(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    The node will be collapsed.\r\n    \r\n    @param  tNode   Node to toggle (see: df.dataStructs.TAjaxTreeNode).\r\n    */\r\n    collapseNode(tNode) {\r\n        tNode.bExpanded = false;\r\n\r\n        this.fire(\"OnCollapse\", [tNode.sId, tNode.sValue, this.getLevel(tNode)]);\r\n\r\n        if (tNode._eSubMenuRow) {\r\n            //   Hide by setting CSS class (so a CSS3 transition can be used for animation)\r\n            df.dom.addClass(tNode._eSubMenuRow, \"WebTree_HiddenSubRow\");\r\n        }\r\n\r\n        //  If the selected item is now hidden we select the collapsed one\r\n        if (this.isParent(this._tSelectedNode, tNode)) {\r\n            while (tNode && !this.doSelect(tNode)) {\r\n                tNode = tNode._tParent;\r\n            }\r\n        }\r\n\r\n        this.updateNodeCSS(tNode);\r\n    }\r\n\r\n    /*\r\n    The node above the currently selected node will be selected.\r\n    */\r\n    moveUp() {\r\n        let tNode;\r\n\r\n        if (this._tSelectedNode) {\r\n            tNode = this._tSelectedNode;\r\n            const iPos = this.getPosition(tNode);\r\n            if (iPos > 0) {   //  Select the previous node on this level\r\n                const aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n\r\n                //  If this node is expanded move down till the last end node\r\n                tNode = aList[iPos - 1];\r\n                while (tNode.bExpanded && tNode._aChildren.length > 0) {\r\n                    tNode = tNode._aChildren[tNode._aChildren.length - 1];\r\n                }\r\n\r\n                this.doSelect(tNode);\r\n            } else {  //  Select the parent if available\r\n                if (tNode._tParent) {\r\n                    this.doSelect(tNode._tParent);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    The node below the currently selected node will be selected.\r\n    */\r\n    moveDown() {\r\n        let tNode;\r\n\r\n        if (this._tSelectedNode) {\r\n            tNode = this._tSelectedNode;\r\n            if (tNode.bExpanded && tNode._aChildren.length > 0) {  //  Select the first child\r\n                this.doSelect(tNode._aChildren[0]);\r\n            } else {\r\n                while (tNode) {   //  Keep on moving levels up until a next node on the level is available or the root is reached\r\n                    const aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n                    const iPos = this.getPosition(tNode);\r\n\r\n                    if (iPos < aList.length - 1) {\r\n                        this.doSelect(aList[iPos + 1]);\r\n                        break;\r\n                    } else {\r\n                        tNode = tNode._tParent;\r\n                    }\r\n                }\r\n            }\r\n        } else if (this._aRootItems.length > 0) {\r\n            this.doSelect(this._aRootItems[0]);\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n    The currently selected node will be collapsed. \r\n    */\r\n    doCollapse() {\r\n\r\n        if (this._tSelectedNode) {\r\n            const tNode = this._tSelectedNode;\r\n\r\n            if (tNode.bExpanded && this.hasChildren(tNode)) {\r\n                this.collapseNode(tNode);\r\n            } else {\r\n                if (tNode._tParent) {\r\n                    this.doSelect(tNode._tParent);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    The currently selected node will be extended.\r\n    */\r\n    doExpand() {\r\n\r\n        if (this._tSelectedNode) {\r\n            const tNode = this._tSelectedNode;\r\n\r\n            if (!tNode.bExpanded && this.hasChildren(tNode)) {\r\n                this.expandNode(tNode);\r\n            } else {\r\n                if (tNode._aChildren.length > 0) {\r\n                    this.doSelect(tNode._aChildren[0]);\r\n                }\r\n            }\r\n        } else if (this._aRootItems.length > 0) {\r\n            this.doSelect(this._aRootItems[0]);\r\n        }\r\n    }\r\n\r\n    /*\r\n    The first node will be selected.\r\n    */\r\n    moveFirst() {\r\n        if (this._aRootItems.length > 0) {\r\n            this.doSelect(this._aRootItems[0]);\r\n        }\r\n    }\r\n\r\n    /*\r\n    The last node will be selected.\r\n    */\r\n    moveLast() {\r\n        let tNode;\r\n\r\n        if (this._aRootItems.length > 0) {\r\n            tNode = this._aRootItems[this._aRootItems.length - 1];\r\n\r\n            while (tNode.bExpanded && tNode._aChildren.length > 0) {\r\n                tNode = tNode._aChildren[tNode._aChildren.length - 1];\r\n            }\r\n\r\n            this.doSelect(tNode);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method will select the node that is passed.\r\n    \r\n    @param  tNode           Node to select.\r\n    @param  bOptNoOnSelect  If true the OnSelect event is not fired.\r\n    @return True if the node was successfully selected.\r\n    */\r\n    doSelect(tNode, bOptNoOnSelect) {\r\n\r\n        //  When the selection changes then psSelectedId and psSelectedValue become synchronized\r\n        this.addSync(\"psSelectedId\");\r\n        this.addSync(\"psSelectedValue\");\r\n\r\n        const tPrevSelected = this._tSelectedNode;\r\n\r\n        //  Select the new node\r\n        this._tSelectedNode = tNode;\r\n        const bChanged = (this.psSelectedId !== tNode.sId);\r\n        this.psSelectedId = tNode.sId;\r\n\r\n        if (tPrevSelected) {\r\n            this.updateNodeCSS(tPrevSelected);\r\n        }\r\n        this.updateNodeCSS(tNode);\r\n\r\n        if (tNode._eElem) {\r\n            this.scrollToElement(tNode._eElem);\r\n        }\r\n\r\n        if (!bOptNoOnSelect && bChanged) {\r\n            this.fire(\"OnSelect\", [tNode.sId, tNode.sValue, this.getLevel(tNode)]);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    doRemove(tNode, bOptNoSelect) {\r\n        let i, aList, bSelect = false;\r\n\r\n        function removeSub(tNode) {\r\n            //  Move into subnodes\r\n            while (tNode._aChildren.length > 0) {\r\n                removeSub.call(this, tNode._aChildren.pop());\r\n            }\r\n\r\n            tNode._eElem = null;\r\n            tNode._eSubMenuRow = null;\r\n            tNode._eSubMenuTable = null;\r\n\r\n            //  De-select if it is the selected node\r\n            if (tNode === this._tSelectedNode) {\r\n                this._tSelectedNode = null;\r\n                bSelect = true;\r\n            }\r\n\r\n            //  Remove from global list\r\n            df.sys.data.removeFromArray(this._aItems, tNode);\r\n        }\r\n\r\n        removeSub.call(this, tNode);\r\n\r\n\r\n        //  Remove from tree\r\n        aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n        if (aList) {\r\n            //  Remove from structure\r\n            for (i = 0; i < aList.length; i++) {\r\n                if (aList[i] === tNode) {\r\n                    aList.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Reselect a node if needed\r\n        if (bSelect && !bOptNoSelect) {\r\n            if (aList && aList.length > 0) {\r\n                this.doSelect(aList[i] || aList[i - 1]);\r\n            } else {\r\n                this.doSelect(tNode._tParent || this._aItems[0]);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // - - - - - - - Tree functions - - - - - - - -\r\n\r\n    /*\r\n    Determines the position of the nod on its level.\r\n    \r\n    @param  tNode   Node\r\n    @return Position of the node on its level (-1 if not in the structure).\r\n    @private\r\n    */\r\n    getPosition(tNode) {\r\n\r\n        const aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n\r\n        for (let iPos = 0; iPos < aList.length; iPos++) {\r\n            if (aList[iPos] === tNode) {\r\n                return iPos;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    /*\r\n    Determines if the node is the last of its level.\r\n    \r\n    @param  tNode   Node\r\n    @return True if the node is the last.\r\n    @private\r\n    */\r\n    isLast(tNode) {\r\n        const aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n\r\n        return (aList[aList.length - 1] === tNode);\r\n    }\r\n\r\n    /*\r\n    Determines if the node is the first of its level.\r\n    \r\n    @param  tNode   Node\r\n    @return True if the node is the first.\r\n    @private\r\n    */\r\n    isFirst(tNode) {\r\n        const aList = (tNode._tParent ? tNode._tParent._aChildren : this._aRootItems);\r\n\r\n        return (aList[0] === tNode);\r\n    }\r\n\r\n    /*\r\n    Determines if the node is in the root of the tree.\r\n    \r\n    @param  tNode   Node\r\n    @return True if the node is in the root.\r\n    @private\r\n    */\r\n    isRoot(tNode) {\r\n        return (tNode._tParent ? false : true);\r\n    }\r\n\r\n    /*\r\n    Determines if the node is a child of the parent node.\r\n    \r\n    @param  tNode   Node.\r\n    @param  tParent Parent to determine.\r\n    @returns    True if the parent is a parent of the child.\r\n    @private\r\n    */\r\n    isParent(tNode, tParent) {\r\n        while (tNode) {\r\n            if (tNode === tParent) {\r\n                return true;\r\n            }\r\n\r\n            tNode = tNode._tParent;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Determines the level of the node in the tree.\r\n    \r\n    @param  tNode   Node.\r\n    @return Level (first level is 1).\r\n    @private\r\n    */\r\n    getLevel(tNode) {\r\n        let iLevel = 1;\r\n\r\n        while (tNode._tParent) {\r\n            iLevel++;\r\n            tNode = tNode._tParent;\r\n        }\r\n\r\n        return iLevel;\r\n    }\r\n\r\n    /*\r\n    Can be used to obtain a reference to a node struct.\r\n    \r\n    @param  sNodeId     Unique ID of the node.\r\n    @return Reference to the node struct (see: df.dataStructs.TAjaxTreeNode).\r\n    */\r\n    getNodeById(sNodeId) {\r\n\r\n        for (let i = 0; i < this._aItems.length; i++) {\r\n            if (this._aItems[i].sId === sNodeId) {\r\n                return this._aItems[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /*\r\n    Determines if the node has children.\r\n    \r\n    @param  tNode   Node\r\n    @return True if the node has children.\r\n    @private\r\n    */\r\n    hasChildren(tNode) {\r\n        return (tNode.bLoadChildren && !tNode._bIsLoaded) || tNode._aChildren.length > 0;\r\n    }\r\n\r\n    // - - - - - - - Supportive - - - - - - - -\r\n\r\n    /*\r\n    Scrolls to the element if the\r\n    \r\n    @private\r\n    */\r\n    scrollToElement(eElem) {\r\n\r\n        const oElem = df.sys.gui.getAbsoluteOffset(eElem);\r\n        const oDiv = df.sys.gui.getAbsoluteOffset(this._eControl);\r\n\r\n        const iTop = oElem.top - oDiv.top;\r\n\r\n        if (iTop < this._eControl.scrollTop) {\r\n            this._eControl.scrollTop = iTop;\r\n        } else if (iTop + eElem.offsetHeight > this._eControl.scrollTop + this._eControl.clientHeight) {\r\n            this._eControl.scrollTop = iTop + eElem.offsetHeight - this._eControl.clientHeight;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method handles the onclick event of the body. It first determines which tree item is clicked \r\n    and it makes a difference between clicking the expand / collapse button or the item itself. With \r\n    that information it will expand / collapse and / or select the tree item.\r\n    \r\n    @param  oEvent  The event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBodyClick(oEvent) {\r\n        let sNodeId = null, bSelect = true, eElem = oEvent.getTarget();\r\n\r\n        if (this.isEnabled()) {\r\n            //  Bubble up in the DOM finding the Node ID and checking if text or tree is clicked\r\n            while (eElem && !sNodeId && eElem !== this._eElem) {\r\n                if (eElem.className.indexOf(\"WebTree_Item\") >= 0) {\r\n                    bSelect = false;\r\n                }\r\n\r\n                sNodeId = eElem.getAttribute(\"data-dftree-id\");\r\n\r\n                eElem = eElem.parentNode;\r\n            }\r\n\r\n            //  Get node object\r\n            const tNode = this.getNodeById(sNodeId);\r\n\r\n            if (tNode) {\r\n                if (bSelect) {\r\n                    //  Select and expand\r\n                    if (this._tSelectedNode !== tNode) {\r\n                        // this.returnFocus();\r\n                        //  Expand the node if we want to\r\n                        if (!tNode.bExpanded && this.hasChildren(tNode)) {\r\n                            this.expandNode(tNode);\r\n                        }\r\n\r\n                        this.doSelect(tNode);\r\n                    } else {\r\n                        this.toggle(tNode);\r\n                    }\r\n\r\n                } else {\r\n                    //  Switch expanded\r\n                    this.toggle(tNode);\r\n\r\n\r\n                }\r\n\r\n                oEvent.stop();\r\n            }\r\n\r\n            this.focus();\r\n        }\r\n    }\r\n\r\n    onBodyDblClick(oEvent) {\r\n        let sNodeId = null, eElem = oEvent.getTarget();\r\n\r\n        if (this.isEnabled()) {\r\n\r\n            //  Bubble up in the DOM finding the Node ID and checking if text or tree is clicked\r\n            while (eElem && !sNodeId && eElem !== this._eElem) {\r\n                sNodeId = eElem.getAttribute(\"data-dftree-id\");\r\n\r\n                eElem = eElem.parentNode;\r\n            }\r\n\r\n            //  Get node object\r\n            const tNode = this.getNodeById(sNodeId);\r\n\r\n            if (tNode) {\r\n                if (this.fireSubmit()) {\r\n                    oEvent.stop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the keypress event of the hidden focus anchor. Compares the event \r\n    details to the oKeyActions and executes the action if a match is found.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        if (this.isEnabled()) {\r\n\r\n            if (oEvent.matchKey(df.settings.treeKeys.moveUp)) {\r\n                this.moveUp();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.moveDown)) {\r\n                this.moveDown();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.collapse)) {\r\n                this.doCollapse();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.extend)) {\r\n                this.doExpand();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.moveFirst)) {\r\n                this.moveFirst();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.moveLast)) {\r\n                this.moveLast();\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.treeKeys.enter)) {\r\n                if (this.fireSubmit()) {\r\n                    oEvent.stop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates the node CSS and if null is received globally display loading.\r\n    \r\n    @param  tNode   Node struct.\r\n    @private\r\n    */\r\n    displayLoading(tNode) {\r\n        if (tNode) {\r\n            this.updateNodeCSS(tNode);\r\n        } else {\r\n            if (this._eControl) {\r\n                df.dom.addClass(this._eControl, \"WebTree_Loading\");\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates the node CSS and if null is received globally hide loading.\r\n    \r\n    @param  tNode   Node struct.\r\n    @private\r\n    */\r\n    hideLoading(tNode) {\r\n        if (tNode) {\r\n            this.updateNodeCSS(tNode);\r\n        } else {\r\n            if (this._eControl) {\r\n                df.dom.removeClass(this._eControl, \"WebTree_Loading\");\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - Focus - - - - - - -\r\n\r\n    /*\r\n    We override the focus method and make it give the focus to the hidden focus holder element.\r\n    \r\n    @return True if the List can take the focus.\r\n    */\r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eFocus) {\r\n            this._eFocus.focus();\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Augments the onFocus event handler and cancel the blurring. This is because the focus can switch \r\n    between elements within the treeview and we don't want that to cause a blur event.\r\n    \r\n    @param oEvent   Event object.\r\n    @private\r\n    */\r\n    onFocus(oEvent) {\r\n        super.onFocus(oEvent);\r\n        this._bLozingFocus = false;\r\n    }\r\n\r\n    /*\r\n    Augments the blur event and adds a little timeout before forwarding it. If we receive a focus event \r\n    within timeout we do not forward it because is a focus change within the treeview itself.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n        const superFunction = super.onBlur\r\n\r\n        this._bLozingFocus = true;\r\n\r\n        setTimeout(function () {\r\n\r\n            if (that._bLozingFocus) {\r\n                superFunction.call(that, oEvent);\r\n\r\n                that._bLozingFocus = false;\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    // WebUIContext\r\n\r\n    determineSelectorForWebUIContext(eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextTreeviewFolder:\r\n            case df.WebUIContext.WebUIContextTreeviewItem:\r\n                return \"tr[data-dftree-id]\";\r\n        }\r\n        return null;\r\n    }\r\n\r\n    verifyElementForWebUIContext(eElem, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextTreeviewFolder:\r\n            case df.WebUIContext.WebUIContextTreeviewItem: {\r\n                if (!eElem.hasAttribute('data-dftree-id')) return false;\r\n\r\n                const iItemId = eElem.getAttribute(\"data-dftree-id\");\r\n                const hItem = this.getNodeById(iItemId);\r\n                return ((hItem.bFolder && eContext === df.WebUIContext.WebUIContextTreeviewFolder) ||\r\n                    (!hItem.bFolder && eContext === df.WebUIContext.WebUIContextTreeviewItem));\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    retrieveValueFromWebUIContext(eElem, eContext) {\r\n        switch (eContext) {\r\n            case df.WebUIContext.WebUIContextTreeviewFolder:\r\n            case df.WebUIContext.WebUIContextTreeviewItem: {\r\n                if (!eElem.hasAttribute('data-dftree-id'))\r\n                    break;\r\n                return eElem.getAttribute('data-dftree-id')\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // === Drag & Drop ===\r\n\r\n    getDragData(oEv, eDraggedElem) {\r\n        try {\r\n            const itemId = eDraggedElem.getAttribute(\"data-dftree-id\") || -1;\r\n            let item, eAction;\r\n\r\n            if (itemId && itemId != -1 && (itemId != '' || itemId >= 0)) {\r\n                // Destructure object to create a clone, then remove any privates (prevent circular json error)\r\n                item = { ...this.getNodeById(itemId) };\r\n\r\n                Object.keys(item).forEach(function (key) {\r\n                    key.indexOf(\"_\") == 0 && delete item[key];\r\n                });\r\n\r\n                if (item.bFolder) {\r\n                    eAction = df.dragActions.WebTreeView.ciDragFolder;\r\n                } else {\r\n                    eAction = df.dragActions.WebTreeView.ciDragItem;\r\n                }\r\n            }\r\n            return [{ data: item }, eAction]\r\n        } catch (err) {\r\n            // This can happen if the drag action is not supported, we don't want a nasty error if so.\r\n            console.error(\"Attempt to perform unsupported drag action\");\r\n            return [null, null];\r\n        }\r\n    }\r\n\r\n    getDropData(oDropZone, oPosition) {\r\n        if (oDropZone && oDropZone._eDropElem) {\r\n            const itemId = oDropZone._eDropElem.getAttribute(\"data-dftree-id\") || -1;\r\n            let item, eAction;\r\n\r\n            if (itemId && itemId != -1 && (itemId != '' || itemId >= 0)) {\r\n                // Destructure object to create a clone, then remove any privates (prevent circular json error)\r\n                item = { ...this.getNodeById(itemId) };\r\n\r\n                Object.keys(item).forEach(function (key) {\r\n                    key.indexOf(\"_\") == 0 && delete item[key];\r\n                });\r\n\r\n                if (item.bFolder) {\r\n                    eAction = df.dropActions.WebTreeView.ciDropOnFolder;\r\n                } else {\r\n                    eAction = df.dropActions.WebTreeView.ciDropOnItem;\r\n                }\r\n            }\r\n\r\n            const dropData = {\r\n                data: item,\r\n                action: eAction\r\n            }\r\n\r\n            return dropData;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    initDraggableElements() {\r\n        // because not all nodes / items are present at initialisation\r\n        // setting draggable=\"true\" is done constructNode\r\n        // HR: Not sure if this is still needed\r\n    }\r\n\r\n    initDropZones() {\r\n        this._aDropZones = [];\r\n\r\n        super.initDropZones();\r\n\r\n        if (this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnFolder) ||\r\n            this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnItem)) {\r\n\r\n            // Mark entire tree body as drop zone\r\n            const eZone = (df.dom.query(this._eElem, '.WebTree_Body'));\r\n            this.addDropZone(eZone);\r\n        }\r\n    }\r\n\r\n    determineDropCandidate(oEv, aHelpers) {\r\n        // DropOnControl and other drop actions cannot exist within the same control simultaneously\r\n        // It makes sense to check for this first to get it out of the way as it is the simplest check\r\n        if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebControl.ciDropOnControl))) {\r\n            return [this._eElem, df.dropActions.WebControl.ciDropOnControl];\r\n        }\r\n\r\n        const eElem = document.elementFromPoint(oEv.e.clientX, oEv.e.clientY);\r\n        let eNode = eElem?.closest('tr[data-dftree-id]');\r\n\r\n        if (eNode) {\r\n            // console.log(eNode);\r\n            let id = eNode.getAttribute('data-dftree-id');\r\n            let item = this.getNodeById(id);\r\n            if (item.bFolder) {\r\n                if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebTreeView.ciDropOnFolder))) {\r\n                    return [eNode, df.dropActions.WebTreeView.ciDropOnFolder];\r\n                }\r\n            } else {\r\n                if (aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebTreeView.ciDropOnItem))) {\r\n                    return [eNode, df.dropActions.WebTreeView.ciDropOnItem];\r\n                }\r\n            }\r\n        }\r\n\r\n        return [null, null];\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        return df.dropPositions.ciDropOn;\r\n    }\r\n\r\n    interactWithDropElem(dropZone, eElem) {\r\n        if (dropZone._eDropAction == df.dropActions.WebControl.ciDropOnControl) {\r\n            dropZone.highlightElement();\r\n        } else {\r\n            // Can add custom visual interaction here later if needed\r\n            dropZone.highlightElement();\r\n        }\r\n    }\r\n\r\n    doEmptyInteraction(dropZone) {\r\n        if (this.isSupportedDropAction(df.dropActions.WebTreeView.ciDropOnRoot)) {\r\n            // Can do custom visual interaction here later if needed\r\n            dropZone.highlightElement();\r\n            return df.dropActions.WebTreeView.ciDropOnRoot;\r\n        } else if (this.isSupportedDropAction(df.dropActions.WebControl.ciDropOnControl)) {\r\n            dropZone.highlightElement();\r\n            return df.dropActions.WebControl.ciDropOnControl;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    onControlDragOver(oEv, oDropZone, eDropElem) {\r\n        // After 1 second, expand the currently hovered node\r\n        if (eDropElem != this._eCurHoveredElem) {\r\n            this._eCurHoveredElem = eDropElem;\r\n\r\n            clearTimeout(this._fHoverTimeOut);\r\n\r\n            if (this._eCurHoveredElem) {\r\n                this._fHoverTimeOut = setTimeout(() => {\r\n                    this.expand(this._eCurHoveredElem.getAttribute('data-dftree-id'));\r\n                }, 1000);\r\n            }\r\n        }\r\n    }\r\n\r\n    hasData() {\r\n        return (this._aItems && this._aItems.length > 0);\r\n    }\r\n}","import { WebBaseFileUpload } from './WebBaseFileUpload.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebFileUploadForm\r\nExtends:\r\n    df.WebBaseFileUpload\r\n\r\nThis class renders a form that represents a single file. It displays the file name and some of its \r\ndetails (mime type, size). The prompt button opens a the file selection dialog allowing the user to \r\nupload a new file. While the file is uploaded the form changes into a progress bar. The \r\nimplementation of the file upload is inherited from the WebBaseFileUpload class.\r\n    \r\nRevision:\r\n    2013/09/10  (HW, DAW)\r\n        Initial version.\r\n*/\r\n\r\n\r\ndf.ciUploadStateEmpty = 0;\r\ndf.ciUploadStateDisplay = 1;\r\ndf.ciUploadStateSelected = 2;\r\ndf.ciUploadStateUploading = 3;\r\ndf.ciUploadStateFinished = 4;\r\n\r\nexport class WebFileUploadForm extends WebBaseFileUpload {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"peState\", df.ciUploadStateEmpty);\r\n\r\n        this.prop(df.tBool, \"pbShowMime\", false);\r\n\r\n        this.prop(df.tString, \"psFileName\", \"\");\r\n        this.prop(df.tInt, \"piFileSize\", 0);\r\n        this.prop(df.tString, \"psFileMime\", \"\");\r\n\r\n\r\n        this.event(\"OnFileClick\", df.cCallModeWait);\r\n\r\n        //  Configure super\r\n        this.addSync(\"peState\");\r\n        this._sControlClass = \"WebFileFrm\";\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebFrm_Wrapper\" tabindex=\"0\"><div><div class=\"WebFile_Btn\">');\r\n\r\n        this.fileHtml(aHtml);\r\n\r\n        aHtml.push('</div><div class=\"WebFile_Content\"></div></div></div>');\r\n    }\r\n\r\n    afterRender() {\r\n        this._eControl = this._eWrap = df.dom.query(this._eElem, \"div.WebFrm_Wrapper\");\r\n        this._eContent = df.dom.query(this._eElem, \"div.WebFile_Content\");\r\n        this._ePrompt = df.dom.query(this._eElem, \"div.WebFile_Btn\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eContent, this.onContentClick, this);\r\n        df.dom.on(\"click\", this._ePrompt, this.onPromptClick, this);\r\n        df.events.addDomKeyListener(this._eControl, this.onKey, this);\r\n\r\n        this.updateDetails();\r\n    }\r\n\r\n    onPromptClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.selectFiles();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method augments the onKey event handler to add support for the prompt key. \r\n    \r\n    @param  oEvent  Event object.\r\n    */\r\n    onKey(oEvent) {\r\n        if (oEvent.matchKey(df.settings.formKeys.prompt)) {\r\n            if (this.isEnabled()) {      // F4:  lookup\r\n                this.selectFiles();\r\n                oEvent.stop();\r\n            }\r\n        } else if (oEvent.matchKey(df.settings.tabKeys.enter)) {\r\n            if (this.fireContentClick()) {      // Enter\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    fireContentClick() {\r\n        if (this.isEnabled()) {\r\n            if (this.peState === df.ciUploadStateFinished || this.peState === df.ciUploadStateDisplay) {\r\n                this.fire(\"OnFileClick\");\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    @client-action\r\n    */\r\n    updateDetails() {\r\n        let sDtl;\r\n\r\n        if (this._eWrap) {\r\n            if (this.psFileName) {\r\n                if (this.peState === df.ciUploadStateSelected) {\r\n                    df.dom.addClass(this._eWrap, \"WebFile_Pending\");\r\n                } else {\r\n                    df.dom.addClass(this._eWrap, \"WebFile_HasFile\");\r\n                }\r\n\r\n                //sDtl = \"Name: \" + this.psFileName + \" Size: \" + this.piFileSize + \" Mime: \" + this.psFileMime;\r\n                sDtl = this.psFileName;\r\n\r\n                if (this.pbShowMime && this.piFileSize > 0 && this.psFileMime) {\r\n                    sDtl += \" (Size: \" + df.sys.data.markupDataSize(this.piFileSize) + \", Mime: \" + this.psFileMime + \")\";\r\n                } else if (this.piFileSize > 0) {\r\n                    sDtl += \" (\" + df.sys.data.markupDataSize(this.piFileSize) + \")\";\r\n                }\r\n                // sDtl = \"Name: \" + this.psFileName + \" Size: \" + this.piFileSize + \" Mime: \" + this.psFileMime;\r\n                // sDtl = \"Name: \" + this.psFileName + \" Size: \" + this.piFileSize + \" Mime: \" + this.psFileMime;\r\n            } else {\r\n                df.dom.removeClass(this._eWrap, \"WebFile_HasFile\");\r\n                df.dom.removeClass(this._eWrap, \"WebFile_Pending\");\r\n                sDtl = this.getWebApp().getTrans(\"no_file_selected\");\r\n            }\r\n\r\n            df.dom.toggleClass(this._eContent, \"WebFile_OnClick\", (this.pbServerOnFileClick && (this.peState === df.ciUploadStateFinished || this.peState === df.ciUploadStateDisplay)));\r\n\r\n            this._eContent.innerHTML = '<div class=\"WebFile_Details\">' + sDtl + '</div>';\r\n        }\r\n    }\r\n\r\n    displaySelectedFileDetails() {\r\n\r\n        if (this._aFiles.length > 0) {\r\n            const oFile = this._aFiles[0].oFile;\r\n\r\n            //  Mark properties as synchronized\r\n            this.addSync(\"psFileName\");\r\n            this.addSync(\"piFileSize\");\r\n            this.addSync(\"psFileMime\");\r\n\r\n            //  Remember the file we where displaying\r\n            this._eState = this.peState;\r\n            if (this.peState === df.ciUploadDisplay) {\r\n                this._sDisplayFileName = this.psFileName;\r\n                this._iDisplayFileSize = this.piFileSize;\r\n                this._sDisplayFileMime = this.psFileMime;\r\n            }\r\n\r\n            //  Store new details\r\n            this.peState = df.ciUploadStateSelected;\r\n            this.psFileName = oFile.name;\r\n            this.piFileSize = oFile.size;\r\n            this.psFileMime = oFile.type;\r\n        }\r\n\r\n        //  Update display\r\n        this.updateDetails();\r\n\r\n    }\r\n\r\n    displayStartWorking() {\r\n        if (!this.pbShowDialog) {\r\n            this._eContent.innerHTML = '<div class=\"WebFile_Working\"></div>';\r\n        } else {\r\n            super.displayStartWorking();\r\n        }\r\n    }\r\n\r\n    displayProgress(iFile, iFiles, iFileLoaded, iFileTotal, iTotalLoaded, iTotal) {\r\n\r\n        if (!this.pbShowDialog) {\r\n            const iPercent = (iTotalLoaded / iTotal) * 100;\r\n\r\n            if (!this._eBar) {\r\n                //  Prepare progress bar\r\n                this._eContent.innerHTML = '<div class=\"WebFile_Progress\"><div class=\"WebFile_ProgressBar\" style=\"width: 0%;\"></div><div class=\"WebFile_ProgressLabel\">0%</div></div>';\r\n                this._eBar = df.dom.query(this._eContent, \"div.WebFile_ProgressBar\");\r\n                this._eLbl = df.dom.query(this._eContent, \"div.WebFile_ProgressLabel\");\r\n            }\r\n\r\n            this._eBar.style.width = (Math.round(iPercent * 10) / 10) + \"%\";\r\n\r\n            df.dom.setText(this._eLbl, Math.round(iPercent) + \"%\");\r\n        } else {\r\n            super.displayProgress(iFile, iFiles, iFileLoaded, iFileTotal, iTotalLoaded, iTotal);\r\n        }\r\n    }\r\n\r\n    displayFinishWorking() {\r\n        if (!this.pbShowDialog) {\r\n            if (this._eBar) {\r\n                this._eBar.style.width = \"100%\";\r\n            }\r\n        } else {\r\n            super.displayFinishWorking();\r\n        }\r\n    }\r\n\r\n    displayFinished(bSuccess) {\r\n        this._eBar = null;\r\n        this._eLbl = null;\r\n\r\n        this.peState = (bSuccess ? df.ciUploadStateFinished : df.ciUploadStateSelected);\r\n        this.updateDetails();\r\n\r\n        super.displayFinished(bSuccess);\r\n    }\r\n\r\n    onContentClick(oEvent) {\r\n        this.fireContentClick();\r\n    }\r\n\r\n    /* \r\n    Augments applyEnabled to set the disabled and tabindex attributes of the control element.\r\n    \r\n    @param  bVal    The enabled state.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl) {\r\n            df.dom.setTabIndex(this._eControl, (bVal ? 0 : -1));\r\n        }\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { WebBaseContainer_mixin } from './WebBaseContainer.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebGroup\r\nMixin:\r\n    df.WebBaseContainer_mixin\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis class is the client-side representation of the WebGroup class. It is the first class that is \r\nboth a container and a control at the same time and uses WebBaseContainer as a mixin.\r\n\r\nRevision:\r\n    2013/11/11  (HW, DAW)\r\n        Refactored into a mixin to support the new WebGroup.\r\n*/\r\n\r\n//  Use the WebBaseContainer_mixin and inherit from WebBaseControl\r\nclass WebGroupBase extends WebBaseContainer_mixin(WebBaseControl) {}\r\ndf.WebGroupBase = WebGroupBase;\r\n\r\nexport class WebGroup extends WebGroupBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tBool, \"pbShowBorder\", true);\r\n        this.prop(df.tBool, \"pbShowCaption\", true);\r\n        this.prop(df.tBool, \"pbCollapsible\", false);\r\n        this.prop(df.tBool, \"pbExpanded\", true);\r\n\r\n        this.event(\"OnExpand\", df.cCallModeDefault);\r\n        this.event(\"OnCollapse\", df.cCallModeDefault);\r\n\r\n        // @privates\r\n        this._eCaption = null;\r\n\r\n        // Configure super classes\r\n        this._sBaseClass = \"WebControl\";\r\n        this._sControlClass = \"WebGroup\";\r\n    }\r\n\r\n    /* \r\n    Called by the WebBaseContainer openHtml to insert HTML between the control and the container HTML. \r\n    The WebGroup generates a label and the WebContainer div.\r\n    \r\n    @param  aHtml   String array used as string builder.\r\n    @private\r\n    */\r\n    wrpOpenHtml(aHtml) {\r\n        aHtml.push('<div class=\"WebContainer\">');\r\n    }\r\n\r\n\r\n    /* \r\n    Called by the WebBaseContainer openHtml to insert HTML between the control and the container HTML. \r\n    The WebGroup generates a label and the WebContainer div.\r\n    \r\n    @param  aHtml   String array used as string builder.\r\n    @private\r\n    */\r\n    wrpCloseHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n        aHtml.push('<label class=\"WebGrp_Caption\">', df.dom.encodeHtml(this.psCaption), '</label>');\r\n        aHtml.push('<div class=\"WebGrp_ExpandBtn\"></div>');\r\n    }\r\n\r\n    /* \r\n    Hook for getting references to the elements during the rendering process before child elements are \r\n    created. We get references to the caption eelement.\r\n    */\r\n    getRef() {\r\n        super.getRef();\r\n\r\n        //  Do this before afterRender to prevent issues with nested groups..\r\n        this._eCaption = df.dom.query(this._eElem, \"label.WebGrp_Caption\");\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebCon_Inner > div\");\r\n        this._eExpandBtn = df.dom.query(this._eElem, \"div.WebGrp_ExpandBtn\");\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eExpandBtn, this.onExpandClick, this);\r\n        df.dom.on(\"transitionend\", this._eElem, this.onTransEnd, this);\r\n        if (this._eContent) {\r\n            df.dom.on(\"transitionend\", this._eContent, this.onTransEndCancel, this);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment the genClass function to add classes indicating wether a caption and / or a border is shown.\r\n    \r\n    @private\r\n    */\r\n    genClass() {\r\n        let sClass = super.genClass();\r\n\r\n        if (this.pbShowCaption) {\r\n            sClass += \" WebGrp_HasCaption\";\r\n        }\r\n        if (this.pbShowBorder) {\r\n            sClass += \" WebGrp_HasBorder\";\r\n        }\r\n        if (this.pbCollapsible) {\r\n            sClass += \" WebGrp_Collapsible \" + (this.pbExpanded ? \"WebGrp_Expanded\" : \"WebGrp_Collapsed\");\r\n        }\r\n\r\n        return sClass;\r\n    }\r\n\r\n    /* \r\n    Setter method that updates the caption (including the CSS classname on the outer element indicating \r\n    if the is a caption).\r\n    \r\n    @param  sVal    New caption.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eCaption) {\r\n            df.dom.setText(this._eCaption, sVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Toggles the WebGrp_HasCaption CSS class which hides / shows the caption of the group. If false no \r\n    space will be reserved for the caption.\r\n    \r\n    @param  bVal    New value for the property.\r\n    */\r\n    set_pbShowCaption(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebGrp_HasCaption\", bVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter method that shows / hides the border by changing the CSS classname set on the outermost \r\n    element.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebGrp_HasBorder\", bVal);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    set_pbCollapsible(bVal) {\r\n        if (this._eElem) {\r\n            df.dom.toggleClass(this._eElem, \"WebGrp_Collapsible\", bVal);\r\n            if (bVal) {\r\n                df.dom.addClass(this._eElem, (this.pbExpanded ? \"WebGrp_Expanded\" : \"WebGrp_Collapsed\"));\r\n            } else {\r\n                df.dom.removeClass(this._eElem, \"WebGrp_Expanded WebGrp_Collapsed\");\r\n            }\r\n        }\r\n    }\r\n\r\n    set_pbExpanded(bVal) {\r\n        if (this._eElem && this.pbCollapsible && this.pbExpanded !== bVal) {\r\n            if (bVal) {\r\n                df.dom.addClass(this._eElem, \"WebGrp_Expanded\");\r\n                df.dom.removeClass(this._eElem, \"WebGrp_Collapsed\");\r\n\r\n                this.fire(\"OnExpand\");\r\n            } else {\r\n                df.dom.addClass(this._eElem, \"WebGrp_Collapsed\");\r\n                df.dom.removeClass(this._eElem, \"WebGrp_Expanded\");\r\n\r\n                this.fire(\"OnCollapse\");\r\n            }\r\n\r\n            this.sizeChanged(true);\r\n        }\r\n    }\r\n\r\n    onExpandClick(oEv) {\r\n        if (this.isEnabled()) {\r\n            this.set('pbExpanded', !this.pbExpanded);\r\n        }\r\n    }\r\n\r\n    /* \r\n    On transitionend (which triggers after the transition for opening / closing a card finishes) we will \r\n    trigger a resize.\r\n    \r\n    @param  oEv     DOM Event object.\r\n    @private\r\n    */\r\n    onTransEnd(oEv) {\r\n        this.sizeChanged(true);\r\n    }\r\n\r\n    /* \r\n    Handles the transitionend of the content div and stops propagation. We don't want every transition \r\n    of anything inside the container to trigger a resize. Only at the end of its own transition.\r\n    \r\n    @param  oEv     DOM Event object.\r\n    @private\r\n    */\r\n    onTransEndCancel(oEv) {\r\n        oEv.stopPropagation();\r\n    }\r\n\r\n    /*\r\n    The getMinHeight function is called by the column layout resize system implemented in \r\n    WebBaseContainer. It determines the minimal height that the control needs to render itself. The \r\n    WebGroup uses the getRequiredHeight function to determine the required height. The  getHeightDiff \r\n    function is used to calculate the height taken by a border / padding on the group itself.\r\n    \r\n    @return The minimal height needed in pixels.\r\n    */\r\n    getMinHeight() {\r\n        let iHeight = 0;\r\n\r\n        //  Give child containers a chance to resize\r\n        this.resize();\r\n\r\n        if (this.pbScroll) {\r\n            if (this.pbFillHeight) {\r\n                iHeight = this.piMinHeight;\r\n            } else {\r\n                iHeight = Math.max(this.piHeight, this.piMinHeight);\r\n            }\r\n        } else {\r\n            //  Determine natural height\r\n            iHeight = this.getRequiredHeight();\r\n        }\r\n\r\n        //  Add control height difference\r\n        if (this._eControl) {\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControl);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eInner);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControlWrp);\r\n        }\r\n\r\n        //  Respect piMinHeight\r\n        if (iHeight < this.piMinHeight) {\r\n            iHeight = this.piMinHeight;\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n\r\n    /*\r\n    Augments the getHeightDiff function and extends it so that it incorporates the space around a \r\n    WebGroup which is both a container and a control at the same time.\r\n    \r\n    bOut        Container\r\n                +------\r\n    bIn         |  Sizer\r\n                |  +------\r\n    bContentOut |  |  Content\r\n                |  |  +------\r\n    bContentIn  |  |  |\r\n    \r\n    @param  bOut        Margin & border of the container element.\r\n    @param  bIn         Padding of the container + margin & border of the sizer.\r\n    @param  bContentOut Padding of the sizer + margin & border of the content element.\r\n    @param  bCOntentIn  Padding of the content element.\r\n    @private\r\n    */\r\n    /* getHeightDiff : function(bOut, bIn, bContentOut, bContentIn){\r\n        var iHeight = df.WebGroup.base.getHeightDiff.apply(this, arguments);\r\n        if(bOut){\r\n            if(this._eInner){\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eInner, 0);\r\n            }\r\n        }\r\n        return iHeight;\r\n        \r\n    } */\r\n\r\n    /* \r\n    Override the setHeight and set the height on the container div which will properly stretch the \r\n    control and will make the container sizing logic function properly.\r\n    \r\n    @param  iHeight     The full height of the control (outermost element).\r\n    @private\r\n    */\r\n    setHeight(iHeight, bSense) {\r\n        if (this._eControl) {\r\n            //  If a negative value is given we should size 'naturally'\r\n            if (iHeight > 0) {\r\n                iHeight -= this.getVertHeightDiff();\r\n\r\n                iHeight = (iHeight < 0 ? 0 : iHeight);  //  FIX: IE8 doesn't handle negative values real well and this seems to happen somehow\r\n\r\n                //  Set the height\r\n                this._eContainer.style.height = iHeight + \"px\";\r\n            } else {\r\n                this._eContainer.style.height = \"\";\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment and add the container diff.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eContainer, 3);  //  Due to box-model: border-box we use mode 3\r\n\r\n        return iResult;\r\n    }\r\n\r\n    /*\r\n    Augment container height difference and add the control height diff to the outermost part.\r\n    \r\n    @private\r\n    */\r\n    getHeightDiff(bOut, bIn, bContentOut, bContentIn) {\r\n        let iHeight = super.getHeightDiff(bOut, bIn, bContentOut, bContentIn);\r\n\r\n        if (bOut) {\r\n            iHeight += this.getVertHeightDiff();\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eContainer) {\r\n            this._eContainer.style.background = sVal || '';\r\n        }\r\n        if (this._eCaption) {\r\n            this._eCaption.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    onFocus(oEV) {\r\n        //  Intercept onfocus as a group cannot take the focus\r\n    }\r\n\r\n    onBlur(oEV) {\r\n        //  Intercept onfocus as a group cannot take the focus\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebBreadcrumb\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the WebBreadcrumb class. It generates the HTML for the ul \r\nelement that wraps the li elements of each crumb. The CSS (class: WebBreadcrumb) Determines how the \r\nbreadcrumb is shown and how the items will look.\r\n    \r\nRevision:\r\n    2015/01/04  (JVH, DAW) \r\n        Initial version.\r\n*/\r\ndf.tWebBreadcrumbItem = {\r\n    sViewName: df.tString,\r\n    sCrumbCaption: df.tString,\r\n    sHeadCaption: df.tString\r\n};\r\n\r\n\r\nexport class WebBreadcrumb extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        // Web Properties\r\n        this.prop(df.tInt, \"peBreadcrumbStyle\", df.cCrumbHorizontal);\r\n\r\n        // @privates\r\n        this._eControl = null;\r\n        this._eList = null; // root <ul> element\r\n        this._eCaption = null; // <div> element used to display the current view's caption when peBreadcrumbStyle is Drop Down\r\n        this._eMask = null; // mask element shown behind the dropdown menu\r\n        this._aItems = []; // array of handles for each breadcrumb item wrapper <li> element\r\n        this._bRedraw = false;\r\n        this._bDropDownExpanded = false; // tracks whether the drop down breadcrumb is shown or hidden\r\n        this._tHideTimeout = null; // handle to a timeout object that is used to hide the dropdown breadcrumb list\r\n\r\n        this._bWrapDiv = true; // generate a wrapper <div>\r\n        this._sControlClass = \"WebBreadcrumb\"; // CSS Class\r\n    }\r\n    /*\r\n    This method generates the wrapping HTML of the breadcrumb.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n            aHtml.push('<div class=\"WebCrumbs_Body WebCrumbs_Horiz\" tabindex=\"-1\">');\r\n        }\r\n        else {\r\n            aHtml.push('<div class=\"WebCrumbs_Body WebCrumbs_DropDown\" tabindex=\"-1\">');\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML that closes the wrapping elements of the breadcrumb.\r\n    \r\n    @param  aHtml   Stringbuilder array to which the HTML can be added.\r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method gathers references to the HTML elements and attaches DOM listeners.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, 'div.WebCrumbs_Body');\r\n\r\n        super.afterRender();\r\n\r\n        //  Attach event listeners\r\n        df.dom.on(\"click\", this._eControl, this.onBodyClick, this);\r\n\r\n        //  Render the initial list\r\n        this.redraw();\r\n    }\r\n\r\n    // - - - - - - - - - - - - - - - - - - - - - - -\r\n    // Property Setters & Getters- - - - - - - - - -\r\n    // - - - - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // peBreadcrumbStyle\r\n\r\n    set_peBreadcrumbStyle(eVal) {\r\n        if (this._eControl) {\r\n            if (this.peBreadcrumbStyle !== eVal) {\r\n                this.peBreadcrumbStyle = eVal;\r\n                this.redraw();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - - - - - - - - \r\n    // Public API- - - - - - - - -\r\n    // - - - - - - - - - - - - - - \r\n\r\n    /*\r\n    This method refreshes the breadcrumb with the items encoded in the action data. The action data is a \r\n    two dimensional array that is used for sending 'complex data' with client actions.\r\n    \r\n    @client-action\r\n    */\r\n    refresh() {\r\n        const aItems = this.deserializeVT(this._tActionData);\r\n\r\n        this.clear();  //  Clear current breadcrumb\r\n\r\n        for (let i = 0; i < aItems.length; i++) {\r\n            //  append\r\n            this.append(aItems[i]);\r\n        }\r\n\r\n        //  Redraw\r\n        this.redraw();\r\n    }\r\n\r\n    // - - - - - - - - - - - - - - - \r\n    // Events- - - - - - - - - - - - \r\n    // - - - - - - - - - - - - - - - \r\n\r\n    /*\r\n    This method handles the onclick event of the body. It first determines which item is clicked \r\n    then makes a server call to navigate to the selected item.\r\n    \r\n    @param  oEvent  The event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBodyClick(oEvent) {\r\n        let sViewName = \"\", eElem = oEvent.getTarget(), bStop = false, bDropDown = false;\r\n\r\n        if (this.isEnabled()) {\r\n            // if necessary, cancel the timeout that is intended to hide the dropdown\r\n            if (this._tHideTimeout) {\r\n                clearTimeout(this._tHideTimeout);\r\n                this._tHideTimeout = null;\r\n            }\r\n\r\n            // Bubble up in the DOM finding the Node ID and checking if text or tree is clicked\r\n            while (eElem && !bStop && eElem !== this._eElem) {\r\n\r\n                // be careful! indexOf will successed to find a class that is\r\n                // a superset of the name we are searching for (e.g. \"WebCrumb_ItemHeader\")\r\n                // This would caue an infinite loop\r\n                if (eElem.className.indexOf(\"WebCrumb_Item\") >= 0) {\r\n                    // list item <li> (all but the last list item)\r\n                    sViewName = eElem.getAttribute(\"data-dfview-name\");\r\n\r\n                    if (sViewName) {\r\n                        this.doSelect(sViewName);\r\n                    }\r\n\r\n                    bStop = true;\r\n                }\r\n                else if (eElem.className.indexOf(\"WebCrumb_DropDownBtn\") >= 0) {\r\n                    // Drop down button click\r\n                    this.showDropDown();\r\n                    bDropDown = true;\r\n                    bStop = true;\r\n                }\r\n                else {\r\n                    // Bubble up            \r\n                    eElem = eElem.parentNode;\r\n                }\r\n            }\r\n\r\n            // Test if we need to hide the drop down breadcrumb\r\n            if (this._bDropDownExpanded && !bDropDown) {\r\n                this.hideDropDown();\r\n            }\r\n\r\n            if (bStop) {\r\n                oEvent.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    We will test if the DropDown needs to be hidden\r\n    */\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n\r\n        super.onBlur(oEvent);\r\n\r\n        if (this._bDropDownExpanded) {\r\n            // Create a timer event to hide the dropdown. This ensures that\r\n            // the drop-down element's OnClick event will fire if it is pending.        \r\n            if (this._tHideTimeout) {\r\n                clearTimeout(this._tHideTimeout);\r\n            }\r\n            this._tHideTimeout = setTimeout(function () {\r\n                that._tHideTimeout = null;\r\n                that.hideDropDown();\r\n            }, 150);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the click event of the mask shown behind the dropdown style breadcrumb. It hides the \r\n    dropdown immediately.\r\n    \r\n    @param  oEvent  Event object (see df.events.DOMEvent).\r\n    */\r\n    onMaskTouch(oEvent) {\r\n        this.hideDropDown();\r\n        oEvent.stop();\r\n    }\r\n\r\n    /*\r\n    This method will select the view that is passed. Called by OnClick\r\n    \r\n    @param  sViewName - object name of the view\r\n    */\r\n    doSelect(sViewName) {\r\n        // We send serverAction directly instead of going through the full this.fire interface.\r\n        // The server call is not optional so we can bypass the need for the pbServerOnSelect and\r\n        // psClientOnSelect interface\r\n        this.serverAction(\"OnSelect\", [sViewName]);\r\n    }\r\n\r\n\r\n\r\n    // - - - - - - - - - - - - - - - - - - - - - - - -\r\n    // Drop Down Handler for Drop Down breadcrumb\r\n    // - - - - - - - - - - - - - - - - - - - - - - - -\r\n\r\n    /* \r\n    Displays the Drop Down Breadcrumb\r\n    */\r\n    showDropDown() {\r\n        // Only drop down if there are 2 or more items in the list\r\n        if (this._eList && this._aItems.length > 1) {\r\n            df.dom.addClass(this._eList, \"WebCrumbs_Expanded\");\r\n            this._bDropDownExpanded = true;\r\n\r\n            if (df.sys.isMobile) {\r\n                this._eMask = df.dom.create('<div class=\"WebMenu_Mask\">&nbsp;</div>');\r\n\r\n                this._eElem.insertBefore(this._eMask, this._eElem.firstChild);\r\n                df.dom.on(\"click\", this._eMask, this.onMaskTouch, this);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides the Drop Down Breadcrumb\r\n    */\r\n    hideDropDown() {\r\n        if (this._eList) {\r\n            df.dom.removeClass(this._eList, \"WebCrumbs_Expanded\");\r\n            this._bDropDownExpanded = false;\r\n\r\n            if (this._eMask) {\r\n                df.dom.off(\"click\", this._eMask, this.onMaskTouch, this);\r\n                this._eMask.parentNode.removeChild(this._eMask);\r\n                this._eMask = null;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    // - - - - - - - - - - - - - - - - - - - - - - - - \r\n    // resize handler methods for horizontal breadcrumb\r\n    // - - - - - - - - - - - - - - - - - - - - - - - - \r\n\r\n    /*\r\n    Handle truncating the horizontal breadcrumb.\r\n    \r\n    Params:\r\n        oEvent  The event object which fired this function.\r\n    */\r\n    resize(oEvent) {\r\n\r\n        // Only dynamically resize items for horizontal breadcrumb    \r\n        if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n            if (this._eList && this._eList.hasChildNodes()) {\r\n                const aElements = df.dom.query(this._eList, \"li div.WebCrumb_Caption\", true);\r\n                this.resetWidths(aElements);\r\n                this.adjustWidths();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /* private: This method resets (clears) the inline width style of all \r\n    <div class=\"WebCrumb_Caption\"> elements to auto.\r\n    The set of elements is passed in the aDivs parameter \r\n    */\r\n    resetWidths(aDivs) {\r\n        for (let i = 0; i < aDivs.length; i++) {\r\n            aDivs[i].style.width = \"auto\";\r\n            aDivs[i].removeAttribute(\"title\");   // remove the tooltip\r\n        }\r\n    }\r\n\r\n\r\n    /* Helper function:\r\n    This method returns the total offsetWidth of the passed array of elements.\r\n    */\r\n    sumElementWidths(aElements) {\r\n        let iSumWidth = 0;\r\n\r\n        // iterate the child elements\r\n        for (let i = 0; i < aElements.length; i++) {\r\n            iSumWidth = iSumWidth + aElements[i].offsetWidth;\r\n        }\r\n\r\n        return iSumWidth;\r\n    }\r\n\r\n\r\n    /*\r\n    Private: This method is used for truncating horizontal list items when there is overflow.\r\n    It is designed to reduce the width of the passed li elements evenly until either:\r\n    1. The sum of the passed element widths is less or equal to the passed target width, or\r\n    2. All of the passed li elements have hit their minimum width of 20px.\r\n    \r\n    returns 0 if the target width was reached, otherwise it returns the number of remaining pixels\r\n    to reach the target width.\r\n    */\r\n    reduceWidthsToTarget_li(aListItems, iTargetWidth) {\r\n        let eDiv = null,\r\n            iWidth, iRemainder = 0,\r\n            sWidth;\r\n\r\n        if (aListItems.length === 0) {\r\n            return 0;\r\n        }\r\n\r\n        // pass 1: get the expected reduction per item, try to set the width to that\r\n        // reduced value. If some items could not be fully reduced (already at minimum)\r\n        // then we will calculate how much extra width remains.\r\n        const iSumWidth = this.sumElementWidths(aListItems);\r\n        const iDiffTotal = iSumWidth - iTargetWidth;\r\n\r\n        if (iDiffTotal <= 0) {\r\n            return 0;    // nothing to do (should not happen)\r\n        }\r\n\r\n        const iDiffPerItem = Math.ceil(iDiffTotal / aListItems.length);\r\n\r\n        // iterate the <li> elements\r\n        for (let i = 0; i < aListItems.length; i++) {\r\n            // get the inner <div class=\"WebCrumb_Caption\">\r\n            eDiv = df.dom.query(aListItems[i], \"div.WebCrumb_Caption\", false);\r\n\r\n            iWidth = eDiv.offsetWidth - iDiffPerItem;    // get the width we want (including padding & border)\r\n            iWidth = iWidth - df.sys.gui.getHorizBoxDiff(eDiv, 0);  // subtract the padding & border\r\n\r\n            if (iWidth < 15) {\r\n                eDiv.style.width = \"15px\";\r\n                iRemainder = iRemainder + 15 - iWidth;\r\n            }\r\n            else {\r\n                sWidth = iWidth.toString() + \"px\";\r\n                eDiv.style.width = sWidth;\r\n            }\r\n\r\n            // give the div a tooltip\r\n            const sTip = df.dom.getText(eDiv);\r\n            if (sTip) {\r\n                eDiv.setAttribute(\"title\", sTip);\r\n            }\r\n        }\r\n\r\n        // pass 2: try to get rid of the remainder\r\n        for (let i = 0; i < aListItems.length && iRemainder > 0; i++) {\r\n            // get the inner <div class=\"WebCrumb_Caption\">\r\n            eDiv = df.dom.query(aListItems[i], \"div.WebCrumb_Caption\", false);\r\n\r\n            if (eDiv.offsetWidth > 15) {\r\n                iRemainder = iRemainder + 15 - eDiv.offsetWidth;\r\n                eDiv.style.width = \"15px\";\r\n            }\r\n        }\r\n\r\n        // if there is still any remainder then that value\r\n        if (iRemainder > 0) {\r\n            return iRemainder;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n\r\n    /*\r\n    This method tests that the width of the control does not exceed the available space.\r\n    If it is too wide then we will trim back the number of characters in each caption\r\n    until it does fit or the caption is empty.\r\n    */\r\n    adjustWidths() {\r\n        let iTarget, iRemainder, aListItems;\r\n\r\n        if (this._eList && this._eList.hasChildNodes()) {\r\n            // compare the current ul element width with the total width of the child li elements...\r\n            const iSumChildWidths = this.sumElementWidths(df.dom.query(this._eList, \"li\", true));\r\n\r\n            if (this._eList.clientWidth < iSumChildWidths) {\r\n                // first we will try to trim the widths of all but the last \r\n                // list item <li> element\r\n                aListItems = this._eList.getElementsByClassName(\"WebCrumb_Item\");\r\n\r\n                if (aListItems.length > 0) {\r\n                    iTarget = this._eList.clientWidth - this._eList.lastChild.offsetWidth;\r\n                    iRemainder = this.reduceWidthsToTarget_li(aListItems, iTarget);\r\n                }\r\n                else {\r\n                    iRemainder = this._eList.lastChild.offsetWidth - this._eList.clientWidth;\r\n                }\r\n\r\n                // If there is any remaining width then we will take it out of the\r\n                // last (current) list item\r\n                if (iRemainder > 0) {\r\n                    aListItems = this._eList.getElementsByClassName(\"WebCurrentCrumb\");\r\n                    iTarget = this._eList.lastChild.offsetWidth - iRemainder - 2;\r\n                    iRemainder = this.reduceWidthsToTarget_li(aListItems, iTarget);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // - - - - - - - - - - - - - - - -\r\n    // DOM Creation Methods- - - - - -\r\n    // - - - - - - - - - - - - - - - -\r\n\r\n    /* \r\n    Generates a deserializer function that deserializes a value tree in an array of breadcrumb items with \r\n    optimal performance.\r\n    \r\n    @param  tVT     Value tree with data.\r\n    @return Array of breadcrumb item objects.\r\n    */\r\n    deserializeVT = df.sys.vt.generateDeserializer([df.tWebBreadcrumbItem]);\r\n\r\n\r\n    /*\r\n    The item will be appended the breadcrumb based on its settings. The display won't be updated so \r\n    the refresh method should be called.\r\n    \r\n    @param  tItem\r\n    */\r\n    append(tItem) {\r\n        this._aItems.push(tItem);\r\n    }\r\n\r\n    /*\r\n    All the items will be removed from the breadcrumb. The display is updated.\r\n    */\r\n    clear() {\r\n        if (this._eList) {\r\n            this._eList.innerHTML = \"\";        // remove the <li> list\r\n        }\r\n        else {\r\n            if (this._eControl) {\r\n                this._eList = this.constructList();       // create the list <ul> element\r\n                this._eControl.appendChild(this._eList);  // add it to the DOM\r\n            }\r\n        }\r\n\r\n        this._aItems = [];\r\n    }\r\n\r\n    /*\r\n    Updates the display based on the internal items. Newly inserted items\r\n    will be displayed correctly.\r\n    */\r\n    redraw() {\r\n        const aItems = this._aItems, aHtml = [];\r\n\r\n        if (this._eControl) {\r\n            this._bRedraw = true;\r\n\r\n            // Hide the horizontal breadcrumb if it only has 0 or 1 items\r\n            //        if (this.peBreadcrumbStyle == df.cCrumbHorizontal && aItems.length < 2) {\r\n            //            df.dom.addClass(this._eControl, \"WebCrumbs_Hide\");\r\n            //        }\r\n            //        else {\r\n            //            df.dom.removeClass(this._eControl, \"WebCrumbs_Hide\");\r\n            //        }\r\n\r\n            // Set the Breadcrumb Style CSS class\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                df.dom.removeClass(this._eControl, \"WebCrumbs_DropDown\");\r\n                df.dom.addClass(this._eControl, \"WebCrumbs_Horiz\");\r\n            } else {\r\n                df.dom.removeClass(this._eControl, \"WebCrumbs_Horiz\");\r\n                df.dom.addClass(this._eControl, \"WebCrumbs_DropDown\");\r\n            }\r\n\r\n            // If drop down then create a caption div otherwise remove it\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                if (this._eCaption) {\r\n                    // destroy the caption div\r\n                    this._eControl.removeChild(this._eCaption);\r\n                    this._eCaption = null;\r\n                }\r\n            }\r\n            // if peBreadcrumbStyle = df.cCrumbCaption or df.cCrumbDropDown\r\n            else {\r\n                if (!this._eCaption) {\r\n                    // create the caption div\r\n                    const eDiv = document.createElement(\"div\");\r\n                    df.dom.addClass(eDiv, \"WebCrumb_Caption\");\r\n\r\n                    this._eControl.appendChild(eDiv);  // add it to the DOM\r\n                    this._eCaption = eDiv;             // save a reference                \r\n                }\r\n\r\n                // update the caption with the current view's name\r\n                if (aItems.length) {\r\n                    if (aItems[aItems.length - 1].sHeadCaption.trim() === \"\") {\r\n                        // do not allow \"\" caption\r\n                        aHtml.push(\"&nbsp;\");\r\n                    }\r\n                    else {\r\n                        const sCaption = aItems[aItems.length - 1].sHeadCaption.trim();  // the arrow CSS is sensitive to trailing spaces!\r\n                        aHtml.push(df.dom.encodeHtml(sCaption));\r\n                    }\r\n\r\n                    this._eCaption.innerHTML = aHtml.join(\"\");\r\n                }\r\n                else {\r\n                    this._eCaption.innerHTML = '&nbsp;';\r\n                }\r\n\r\n                // if there is a list of more than one item then show the dropdown button\r\n                if (aItems.length > 1 && this.peBreadcrumbStyle === df.cCrumbDropDown) {\r\n                    df.dom.addClass(this._eCaption, \"WebCrumb_DropDownBtn\");\r\n                }\r\n                else {\r\n                    df.dom.removeClass(this._eCaption, \"WebCrumb_DropDownBtn\");\r\n                }\r\n            }\r\n\r\n            // Create or Reset the list\r\n            if (this._eList) {\r\n                this._eList.innerHTML = \"\";        // remove the <li> list\r\n            }\r\n            else if (this.peBreadcrumbStyle !== df.cCrumbCaption) {\r\n                this._eList = this.constructList();       // create the list <ul> element\r\n                this._eControl.appendChild(this._eList);  // add the list to the DOM \r\n            }\r\n\r\n            if (this.peBreadcrumbStyle !== df.cCrumbCaption) {\r\n                this.constructItems(aItems);        // create the <li> list item elements\r\n            }\r\n\r\n            this._bRedraw = false;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Constructs a list element <ul>.\r\n    \r\n    @private\r\n    */\r\n    constructList() {\r\n        const eList = document.createElement(\"ul\");\r\n        eList.setAttribute(\"class\", \"WebCrumbs\");\r\n\r\n        return eList;\r\n    }\r\n\r\n    /*\r\n    Generates the DOM elements for the given list of nodes on the given table.\r\n    \r\n    @param  aNodes  Array with nodes.\r\n    @param  eTable  Table element.\r\n    @private\r\n    */\r\n    constructItems(aItems) {\r\n        let bCurrent = false, sLine = \"\";\r\n        const aHtml = [];\r\n\r\n        // - - - breadcrumb list - - -\r\n        // <li><div><div>Caption 1<div></div></li>\r\n        // <li><div><div>Caption 2<div></div></li>\r\n        //\r\n        // build the list item <li> elements as a stringlist.\r\n\r\n        // If there are no items than build a dummy one\r\n        if (aItems.length === 0) {\r\n            aHtml.push('<li class=\"WebCurrentCrumb\">');\r\n\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                aHtml.push('<div tabindex=\"-1\">');\r\n            }\r\n\r\n            aHtml.push('<div class=\"WebCrumb_Caption\" tabindex=\"-1\">');\r\n            aHtml.push(\"&nbsp;\");\r\n            aHtml.push('</div>');\r\n\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                // close the arrow div\r\n                aHtml.push('</div>');\r\n            }\r\n            aHtml.push('</li>');\r\n        }\r\n\r\n        for (let iItem = 0; iItem < aItems.length; iItem++) {\r\n            if (iItem === aItems.length - 1) {\r\n                bCurrent = true;   // bCurrent is true for the last <li> element\r\n            }\r\n\r\n            if (bCurrent) {\r\n                sLine = '<li class=\"WebCurrentCrumb\"';\r\n            }\r\n            else {\r\n                // All items except the current one will have this class.\r\n                // Among other things, this determines whether the item will \r\n                // process a mouse click. This class name must not be used by \r\n                // any non list item <li> elements because we search for it \r\n                // while bubbling up in the onClick handler\r\n                sLine = '<li class=\"WebCrumb_Item\"';\r\n            }\r\n\r\n            // store the view name (for future reference)\r\n            sLine = sLine + ' data-dfview-name=\"' + aItems[iItem].sViewName + '\">';\r\n\r\n            // assemble <li> & inner <div><div>\r\n            aHtml.push(sLine);\r\n\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                // build the arrow for horizontal breadcrumbs\r\n                if (bCurrent) {\r\n                    aHtml.push('<div tabindex=\"-1\">');\r\n                }\r\n                else {\r\n                    aHtml.push('<div class=\"WebCrumb_Arrow\" tabindex=\"-1\">');\r\n                }\r\n            }\r\n\r\n            // build the caption\r\n            aHtml.push('<div class=\"WebCrumb_Caption\" tabindex=\"-1\">');\r\n\r\n            if (aItems[iItem].sCrumbCaption.trim() === \"\") {\r\n                // do not allow \"\" caption\r\n                aHtml.push(\"&nbsp;\");\r\n            }\r\n            else {\r\n                aHtml.push(df.dom.encodeHtml(aItems[iItem].sCrumbCaption)); // the crumb's caption\r\n            }\r\n            aHtml.push('</div>');\r\n\r\n            if (this.peBreadcrumbStyle === df.cCrumbHorizontal) {\r\n                // close the arrow div\r\n                aHtml.push('</div>');\r\n            }\r\n\r\n            aHtml.push('</li>');\r\n        }\r\n        // insert the list item <li> elements\r\n        this._eList.innerHTML = aHtml.join(\"\");\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColorPicker\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis control is color picker based on the HSV color scheme. A color map with horizontally the colors \r\nand vertically the saturation is used to pick the color and a separate slider allows the velocity to \r\nbe choosen. Both map and slider use a canvas with gradients for the rendering, no images are needed.\r\n\r\nThe resulting color is in RGB format as used everywhere on the web where a choice between \r\nhexadecimal notation and full rgb(r,g,b) notation is available.\r\n    \r\nRevision:\r\n    2016/06/16  (HW, DAW) \r\n        Initial version.\r\n*/\r\ndf.colorFormatHex = 1;\r\ndf.colorFormatRGB = 2;\r\n\r\ndf.settings.colorPickKeys = {\r\n    colorUp: {           //  Arrow up\r\n        iKeyCode: 38,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    colorDown: {         //  Arrow down\r\n        iKeyCode: 40,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    colorLeft: {         //  Arrow left\r\n        iKeyCode: 37,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    colorRight: {        //  Arrow right\r\n        iKeyCode: 39,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    sliderUp: {         //  Page up\r\n        iKeyCode: 33,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    sliderDown: {       //  Page down\r\n        iKeyCode: 34,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    },\r\n    enter: {           //  Enter\r\n        iKeyCode: 13,\r\n        bCtrl: false,\r\n        bShift: false,\r\n        bAlt: false\r\n    }\r\n};\r\n\r\ndf.tWebColorPaletteItem = {\r\n    sColor: df.tString,\r\n    sDescription: df.tString\r\n};\r\n\r\nexport class WebColorPicker extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbShowColorBar\", true);\r\n        this.prop(df.tInt, \"peColorFormat\", df.colorFormatHex);\r\n        this.prop(df.tInt, \"piPaletteItemsPerRow\", 6);\r\n\r\n        this.prop(df.tString, \"psValue\", \"#A53D40\");\r\n        this.addSync(\"psValue\");\r\n\r\n        //  Triggered when the color is changed (mouseup)\r\n        this.event(\"OnChange\");\r\n\r\n        //  Client-side only event triggering at real time while the value changes\r\n        this.OnRealtimeChange = new df.events.JSHandler();\r\n        //  Triggered on enter\r\n        this.OnEnter = new df.events.JSHandler();\r\n\r\n        this._tDoubleClick = null;\r\n        this._iDoubleClickWait = 800;\r\n\r\n        //  Internally the color is stored as HSV values. Unless the psValue is changed from the outside \r\n        //  the HSV is used for manipulation and generation of the RGB string (to prevent rounding \r\n        //  issues from causing jumping of the controls.\r\n        this._aHSV = [0, 0, 0];\r\n\r\n        this._aColorPalette = [];\r\n\r\n        this._sControlClass = \"WebColorPicker\";\r\n    }\r\n\r\n    create(tDef) {\r\n        super.create();\r\n\r\n\r\n        this.set_psValue(this.psValue);\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        const aMainClasses = ['WebCP_Main'];\r\n\r\n        super.openHtml(aHtml);\r\n\r\n        if (this.pbShowColorBar) {\r\n            aMainClasses.push('WebCP_ShowColorBar');\r\n        }\r\n        if (this._aColorPalette.length > 0) {\r\n            aMainClasses.push('WebCP_ShowPalette');\r\n        }\r\n\r\n        aHtml.push('<div class=\"', aMainClasses.join(' '), '\" tabindex=\"0\">',\r\n\r\n            '<div class=\"WebCP_ColorPalette\">');\r\n\r\n        this.genColorPaletteHtml(aHtml);\r\n\r\n        aHtml.push('</div>',\r\n            '<div class=\"WebCP_Picker\">',\r\n            '<div class=\"WebCP_ColorMap\">',\r\n            '<canvas width=\"0\" height=\"0\"></canvas>',\r\n            '<div class=\"WebCP_Pointer\"></div>',\r\n            '</div>',\r\n            '<div class=\"WebCP_GradSlider\">',\r\n            '<canvas width=\"0\" height=\"0\"></canvas>',\r\n            '<div class=\"WebCP_Slide\"></div>',\r\n            '</div>',\r\n            '</div>',\r\n            '<div class=\"WebCP_ColorBar\"></div>',\r\n            '<div>');\r\n\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n        this._eFocus = this._eControl = df.dom.query(this._eElem, \".WebCP_Main\");\r\n\r\n        this._ePicker = df.dom.query(this._eElem, '.WebCP_Picker');\r\n        this._eColorPalette = df.dom.query(this._eElem, '.WebCP_ColorPalette');\r\n\r\n        this._eColorMap = df.dom.query(this._eElem, \".WebCP_ColorMap\");\r\n        this._eMapCanvas = df.dom.query(this._eElem, \".WebCP_ColorMap canvas\");\r\n        this._ePointer = df.dom.query(this._eElem, \".WebCP_Pointer\");\r\n\r\n        this._eGradSlider = df.dom.query(this._eElem, \".WebCP_GradSlider\");\r\n        this._eSliderCanvas = df.dom.query(this._eElem, \".WebCP_GradSlider canvas\");\r\n        this._eSlide = df.dom.query(this._eElem, \".WebCP_Slide\");\r\n\r\n        this._eColorBar = df.dom.query(this._eElem, \".WebCP_ColorBar\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"mousedown\", this._eColorMap, this.startMapMouse, this);\r\n        df.dom.on(\"mousedown\", this._eGradSlider, this.startSliderMouse, this);\r\n        df.dom.on(\"click\", this._eColorPalette, this.onPaletteClick, this);\r\n        df.dom.on(\"dblclick\", this._eColorPalette, this.onPaletteDblClick, this);\r\n        df.events.addDomKeyListener(this._eFocus, this.onKey, this);\r\n        df.events.addDomMouseWheelListener(this._eFocus, this.onMouseWheelScroll, this);\r\n\r\n        //  Update DOM\r\n        this._eColorBar.style.backgroundColor = this.psValue;\r\n        df.dom.setText(this._eColorBar, this.psValue);\r\n    }\r\n\r\n    resize() {\r\n        let iPalOffset = 0;\r\n\r\n        if (this._aColorPalette.length > 0) {\r\n            iPalOffset += this._eColorPalette.offsetHeight;\r\n        }\r\n\r\n        this._ePicker.style.top = iPalOffset + \"px\";\r\n\r\n        super.resize();\r\n\r\n        if (this._eControl.clientHeight) {\r\n            if (this._eMapCanvas.width !== this._eColorMap.clientWidth || this._eMapCanvas.height !== this._eColorMap.clientHeight) {\r\n                this.drawColorMap();\r\n                this.positionPointer();\r\n            }\r\n            if (this._eSliderCanvas.width !== this._eGradSlider.clientWidth || this._eSliderCanvas.height !== this._eGradSlider.clientHeight) {\r\n                this.drawGradientSlider();\r\n            }\r\n        }\r\n    }\r\n\r\n    drawColorMap() {\r\n        const eCanvas = this._eMapCanvas;\r\n\r\n        //  Size the canvas\r\n        eCanvas.width = this._eColorMap.clientWidth;\r\n        eCanvas.height = this._eColorMap.clientHeight;\r\n\r\n        //  Get drawing context\r\n        if (!this._mainctx) {\r\n            this._mainctx = eCanvas.getContext('2d');\r\n        }\r\n        const ctx = this._mainctx;\r\n\r\n        //  Clear\r\n        ctx.clearRect(0, 0, eCanvas.width, eCanvas.height);\r\n\r\n        //  Draw rainbow\r\n        const hGrad = ctx.createLinearGradient(0, 0, eCanvas.width, 0);\r\n        hGrad.addColorStop(0, '#F00');\r\n        hGrad.addColorStop(1 / 6, '#FF0');\r\n        hGrad.addColorStop(2 / 6, '#0F0');\r\n        hGrad.addColorStop(3 / 6, '#0FF');\r\n        hGrad.addColorStop(4 / 6, '#00F');\r\n        hGrad.addColorStop(5 / 6, '#F0F');\r\n        hGrad.addColorStop(1, '#F00');\r\n\r\n        ctx.fillStyle = hGrad;\r\n        ctx.fillRect(0, 0, eCanvas.width, eCanvas.height);\r\n\r\n        //  Fade to white at the bototm\r\n        const vGrad = ctx.createLinearGradient(0, 0, 0, eCanvas.height);\r\n        vGrad.addColorStop(0, 'rgba(255,255,255,0)');\r\n        vGrad.addColorStop(1, 'rgba(255,255,255,1)');\r\n\r\n        ctx.fillStyle = vGrad;\r\n        ctx.fillRect(0, 0, eCanvas.width, eCanvas.height);\r\n    }\r\n\r\n    positionPointer() {\r\n        let iX = 0, iY = 0; \r\n        const aHSV = this.getHSV();\r\n\r\n        iX = aHSV[0] * this._eMapCanvas.width;\r\n        iY = (1 - aHSV[1]) * this._eMapCanvas.height;   //  Lightning determines vertical position\r\n\r\n        iX -= this._ePointer.offsetWidth / 2;\r\n        iY -= this._ePointer.offsetHeight / 2;\r\n\r\n        this._ePointer.style.left = Math.round(iX) + \"px\";\r\n        this._ePointer.style.top = Math.round(iY) + \"px\";\r\n\r\n    }\r\n\r\n    drawGradientSlider() {\r\n        const eCanvas = this._eSliderCanvas;\r\n\r\n        //  Size the canvas\r\n        eCanvas.width = this._eGradSlider.clientWidth;\r\n        eCanvas.height = this._eGradSlider.clientHeight;\r\n\r\n        //  Get drawing context\r\n        if (!this._sliderctx) {\r\n            this._sliderctx = eCanvas.getContext('2d');\r\n        }\r\n        const ctx = this._sliderctx;\r\n\r\n        //  Clear\r\n        ctx.clearRect(0, 0, eCanvas.width, eCanvas.height);\r\n\r\n        //  Calculate start color\r\n        const aHSV = this.getHSV();\r\n        aHSV[2] = 1;\r\n\r\n\r\n        const aRGB = this.HSVtoRGB(aHSV);\r\n\r\n        //  Fade to white at the bottom\r\n        const vGrad = ctx.createLinearGradient(0, 0, 0, eCanvas.height);\r\n        vGrad.addColorStop(0, this.RGBtoHexString(aRGB));\r\n        vGrad.addColorStop(1, '#000000');\r\n\r\n        ctx.fillStyle = vGrad;\r\n        ctx.fillRect(0, 0, eCanvas.width, eCanvas.height);\r\n\r\n        this.positionSlider();\r\n    }\r\n\r\n    positionSlider() {\r\n        let iY = 0;\r\n        const aHSV = this.getHSV();\r\n\r\n        iY = (1 - aHSV[2]) * this._eSliderCanvas.height;\r\n        iY -= Math.round(this._eSlide.offsetHeight / 2);\r\n\r\n        this._eSlide.style.top = iY + \"px\";\r\n    }\r\n\r\n    /* \r\n    Called to add a single color to the color palette. Updates the palette if we've already rendered.\r\n    \r\n    @param  sColor          Color in hex or rgb string format.\r\n    @param  sDescription    Text shown as title on the element.\r\n    \r\n    @client-action\r\n    */\r\n    addPaletteItem(sColor, sDescription) {\r\n        const aHtml = [];\r\n\r\n        this._aColorPalette.push({\r\n            sColor: sColor,\r\n            sDescription: sDescription\r\n        });\r\n\r\n        if (this._eElem) {\r\n            this.genColorPaletteHtml(aHtml);\r\n\r\n            this._eColorPalette.innerHTML = aHtml.join(\"\");\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called to refresh the entire color palette at once. Colors are sent as action data (array of \r\n    df.tWebColorPaletteItem items).\r\n    \r\n    @client-action\r\n    */\r\n    updatePalette() {\r\n        const aHtml = [];\r\n\r\n        this._aColorPalette = this.deserializeVT(this._tActionData);\r\n\r\n        if (this._eElem) {\r\n            this.genColorPaletteHtml(aHtml);\r\n\r\n            this._eColorPalette.innerHTML = aHtml.join(\"\");\r\n\r\n            df.dom.toggleClass(this._eControl, \"WebCP_ShowPalette\", this._aColorPalette.length > 0);\r\n\r\n            this.sizeChanged();\r\n        }\r\n    }\r\n\r\n    genColorPaletteHtml(aHtml) {\r\n        const aPal = this._aColorPalette;\r\n\r\n        if (aPal.length > 0) {\r\n            aHtml.push('<table class=\"WebCP_Palette\"><colgroup>');\r\n\r\n            for (let i = 0; i < this.piPaletteItemsPerRow; i++) {\r\n                aHtml.push('<col style=\"width: ', (Math.floor(1000 / this.piPaletteItemsPerRow) / 10), '%\">');\r\n            }\r\n\r\n            aHtml.push('</colgroup><tr>');\r\n            for (let i = 0; i < aPal.length; i++) {\r\n                const sC = this.RGBtoHexString(this.stringToRGB(aPal[i].sColor));\r\n\r\n                if (i % this.piPaletteItemsPerRow === 0 && i > 0) {\r\n                    aHtml.push('</tr><tr>');\r\n                }\r\n                aHtml.push('<td class=\"WebCP_PalColor\" style=\"background-color: ', sC, '\" data-palcolor=\"', sC, '\" title=\"', aPal[i].sDescription, '\"></td>');\r\n            }\r\n            aHtml.push('</tr></table>');\r\n        }\r\n\r\n    }\r\n\r\n    onPaletteClick(oEv) {\r\n        let eEl = oEv.getTarget()\r\n        const sPrevColor = this.psValue;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        while (eEl && eEl !== this._eColorPalette) {\r\n            if (eEl.hasAttribute(\"data-palcolor\")) {\r\n                const aHSV = this.RGBtoHSV(this.stringToRGB(eEl.getAttribute(\"data-palcolor\")));\r\n                this.setHSV(aHSV);\r\n\r\n                this.OnRealtimeChange.fire(this, {\r\n                    sColor: this.psValue,\r\n                    sPrevColor: sPrevColor\r\n                });\r\n\r\n                return;\r\n            }\r\n            eEl = eEl.parentNode;\r\n        }\r\n    }\r\n\r\n    onPaletteDblClick(oEv) {\r\n        let eEl = oEv.getTarget();\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        while (eEl && eEl !== this._eColorPalette) {\r\n            if (eEl.hasAttribute(\"data-palcolor\")) {\r\n                const aHSV = this.RGBtoHSV(this.stringToRGB(eEl.getAttribute(\"data-palcolor\")));\r\n                this.setHSV(aHSV);\r\n\r\n                this.OnEnter.fire(this, { sColor: this.psValue });\r\n\r\n                oEv.stop();\r\n\r\n                return;\r\n            }\r\n            eEl = eEl.parentNode;\r\n        }\r\n\r\n    }\r\n\r\n    startMapMouse(oEv) {\r\n        let iX, iY;\r\n        const aHSV = this.getHSV(), that = this;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        //  Check for double click\r\n        if (this._tDoubleClick) {\r\n            this.OnEnter.fire(this, { sColor: this.psValue });\r\n            clearTimeout(this._tDoubleClick);\r\n            this._tDoubleClick = null;\r\n            oEv.stop();\r\n            return;\r\n        }\r\n        //  Set double click timer\r\n        this._tDoubleClick = setTimeout(function () {\r\n            that._tDoubleClick = null;\r\n        }, this._iDoubleClickWait);\r\n\r\n        //  Create mask\r\n        const eMask = df.gui.dragMask(this.topLayer() || document.body);\r\n        eMask.style.cursor = \"crosshair\";\r\n\r\n        //  Initial x & y calculations\r\n        const oRect = df.sys.gui.getBoundRect(this._eMapCanvas);\r\n        iX = oEv.getMouseX() - oRect.left;\r\n        iY = oEv.getMouseY() - oRect.top;\r\n\r\n\r\n\r\n\r\n        //  Calculates the color based on x and y inside the canvas converting those into hue and saturation\r\n        function updateColor() {\r\n            const sPrevColor = this.psValue;\r\n\r\n            aHSV[0] = iX / oRect.width;\r\n            aHSV[1] = 1 - (iY / oRect.height);\r\n\r\n            this.setHSV(aHSV, true);\r\n\r\n            this.OnRealtimeChange.fire(this, {\r\n                sColor: this.psValue,\r\n                sPrevColor: sPrevColor\r\n            });\r\n        }\r\n\r\n        //  Updates x & y and triggers updateColor\r\n        function onDrag(oEv) {\r\n            iX = Math.min(Math.max(oEv.getMouseX() - oRect.left, 0), oRect.width);\r\n            iY = Math.min(Math.max(oEv.getMouseY() - oRect.top, 0), oRect.height);\r\n\r\n            updateColor.call(this);\r\n        }\r\n\r\n        //  Stops the drag, fires OnChange and cleans up\r\n        function onStopDrag(oEv) {\r\n            this.fire(\"OnChange\", [this.psValue]);\r\n            this.focus();\r\n\r\n            //  Clean up\r\n            df.dom.off(\"mouseup\", eMask, onStopDrag, this);\r\n            df.dom.off(\"mouseup\", window, onStopDrag, this);\r\n            df.dom.off(\"mousemove\", eMask, onDrag, this);\r\n\r\n            if (eMask && eMask.parentNode) {\r\n                eMask.parentNode.removeChild(eMask);\r\n            }\r\n        }\r\n\r\n        //  Attach DOM listeners\r\n        df.dom.on(\"mousemove\", eMask, onDrag, this);\r\n        df.dom.on(\"mouseup\", window, onStopDrag, this);\r\n        df.dom.on(\"mouseup\", eMask, onStopDrag, this);\r\n\r\n        oEv.stop();\r\n\r\n        updateColor.call(this);\r\n    }\r\n\r\n    startSliderMouse(oEv) {\r\n        let iY; \r\n        const aHSV = this.getHSV(), that = this;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        //  Check for double click\r\n        if (this._tDoubleClick) {\r\n            this.OnEnter.fire(this, { sColor: this.psValue });\r\n            clearTimeout(this._tDoubleClick);\r\n            this._tDoubleClick = null;\r\n            return;\r\n        }\r\n        //  Set double click timer\r\n        this._tDoubleClick = setTimeout(function () {\r\n            that._tDoubleClick = null;\r\n        }, this._iDoubleClickWait);\r\n\r\n        //  Create mask\r\n        const eMask = df.gui.dragMask(this.topLayer() || document.body);\r\n        eMask.style.cursor = \"n-resize\";\r\n\r\n        //  Initial y calculations\r\n        const oRect = df.sys.gui.getBoundRect(this._eSliderCanvas);\r\n        iY = oEv.getMouseY() - oRect.top;\r\n\r\n        //  Updates the color by converting the vertical coordinate into the new saturation\r\n        function updateColor() {\r\n            const sPrevColor = this.psValue;\r\n\r\n            aHSV[2] = 1 - (iY / oRect.height);\r\n\r\n            this.setHSV(aHSV, false);\r\n\r\n            this.OnRealtimeChange.fire(this, {\r\n                sColor: this.psValue,\r\n                sPrevColor: sPrevColor\r\n            });\r\n        }\r\n\r\n        //  Updates the Y coordinate and triggers the updateColor\r\n        function onDrag(oEv) {\r\n            iY = Math.min(Math.max(oEv.getMouseY() - oRect.top, 0), oRect.height);\r\n\r\n            updateColor.call(this);\r\n        }\r\n\r\n        //  Handles the mouseup, triggers OnChange and cleans up the mess\r\n        function onStopDrag(oEv) {\r\n            this.fire(\"OnChange\", [this.psValue]);\r\n            this.focus();\r\n\r\n            //  Clean up\r\n            df.dom.off(\"mouseup\", eMask, onStopDrag, this);\r\n            df.dom.off(\"mouseup\", window, onStopDrag, this);\r\n            df.dom.off(\"mousemove\", eMask, onDrag, this);\r\n\r\n            if (eMask && eMask.parentNode) {\r\n                eMask.parentNode.removeChild(eMask);\r\n            }\r\n        }\r\n\r\n        df.dom.on(\"mousemove\", eMask, onDrag, this);\r\n        df.dom.on(\"mouseup\", window, onStopDrag, this);\r\n        df.dom.on(\"mouseup\", eMask, onStopDrag, this);\r\n\r\n        oEv.stop();\r\n\r\n        updateColor.call(this);\r\n    }\r\n\r\n\r\n\r\n    adjustColor(iType, iVal) {\r\n        const aHSV = this.getHSV(), sPrevColor = this.psColor;\r\n\r\n        aHSV[iType] = Math.max(0, Math.min(1, aHSV[iType] + (iVal / 20)));\r\n        this.setHSV(aHSV, (iType !== 2));\r\n\r\n        this.OnRealtimeChange.fire(this, {\r\n            sColor: this.psValue,\r\n            sPrevColor: sPrevColor\r\n        });\r\n        this.fire(\"OnChange\", [this.psValue]);\r\n    }\r\n\r\n    /* \r\n    Handles the mousewheel scroll event and increments / decrements the slider value when it happens.\r\n    \r\n    @param  oEvent  DOM Event object (df.events.DomEvent)\r\n    @private\r\n    */\r\n    onMouseWheelScroll(oEvent) {\r\n        const iDelta = oEvent.getMouseWheelDelta();\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        if (iDelta > 0) {\r\n            //  Scroll up\r\n            this.adjustColor(2, 1);\r\n        } else if (iDelta < 0) {\r\n            //  Scroll down\r\n            this.adjustColor(2, -1);\r\n        }\r\n\r\n        oEvent.stop();\r\n    }\r\n\r\n    /*\r\n    Handles the keypress event of focus holder element. If the pressed key matches \r\n    one of the keys that are set it performs the action.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n\r\n        //  Generate key object to compare\r\n        if (this.isEnabled()) {\r\n            if (oEvent.matchKey(df.settings.colorPickKeys.colorUp)) { // Up (decrement with 7 days)\r\n                this.adjustColor(1, 1);\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.colorDown)) { //  Down (increment with 7 days)\r\n                this.adjustColor(1, -1);\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.colorLeft)) { // Left (decrement with one day)\r\n                this.adjustColor(0, -1);\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.colorRight)) { // Right (increment with one day)\r\n                this.adjustColor(0, 1);\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.sliderUp)) { //  Month up\r\n                this.adjustColor(2, 1);\r\n\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.sliderDown)) { //    Month down\r\n                this.adjustColor(2, -1);\r\n                oEvent.stop();\r\n            } else if (oEvent.matchKey(df.settings.colorPickKeys.enter)) { //    Enter\r\n                this.OnEnter.fire(this, { sColor: this.psValue });\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Setter for the psValue which parses the RGB string into separate RGB values that are calculated into \r\n    the HSV value. It calls setHSV to update the color picker with the new color.\r\n    \r\n    @param  sV  The new color value (RGB color string).\r\n    */\r\n    set_psValue(sV) {\r\n\r\n        const aRGB = this.stringToRGB(sV);\r\n\r\n        const aHSV = this.RGBtoHSV(aRGB);\r\n\r\n        if (this._aHSV[0] !== aHSV[0] || this._aHSV[1] !== aHSV[1] || this._aHSV[2] !== aHSV[2]) {\r\n            this.setHSV(aHSV, true);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Hides or shows the color bar by adding / removing the classname. Also triggers a redraw of the map \r\n    and slider as their position has changed.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbShowColorBar(bVal) {\r\n        if (this._eColorBar) {\r\n            df.dom.toggleClass(this._eControl, \"WebCP_ShowColorBar\", bVal);\r\n            this.drawColorMap();\r\n            this.drawGradientSlider();\r\n        }\r\n    }\r\n\r\n    /* \r\n    @return Current HSV value in array (by value).\r\n    @private\r\n    */\r\n    getHSV() {\r\n        return this._aHSV.slice();\r\n    }\r\n\r\n    /* \r\n    Updates the current HSV value by updating the map position, slider and psValue.\r\n    \r\n    @param  aHSV                Array with HSV values.\r\n    @param  bUpdateGradient     If true the color of the slider is updated.\r\n    @private\r\n    */\r\n    setHSV(aHSV, bUpdateGradient) {\r\n        //  Update central value\r\n        this._aHSV = aHSV;\r\n\r\n        //df.log(\"Set: H: \" + this._aHSV[0].toString().substr(0, 4) + \" S: \" + this._aHSV[1].toString().substr(0, 4) + \" V: \" + this._aHSV[2].toString().substr(0, 4));\r\n\r\n        //  Update psValue (after calculating RGB)\r\n        const aRGB = this.HSVtoRGB(aHSV);\r\n        if (this.peColorFormat === df.colorFormatHex) {\r\n            this.psValue = this.RGBtoHexString(aRGB);\r\n        } else {\r\n            this.psValue = this.RGBtoRgbString(aRGB);\r\n        }\r\n\r\n        //  Update UI\r\n        if (this._eControl) {\r\n            if (this._eColorBar) {\r\n                this._eColorBar.style.backgroundColor = this.psValue;\r\n                df.dom.setText(this._eColorBar, this.psValue);\r\n            }\r\n\r\n            this.positionPointer();\r\n            if (bUpdateGradient) {\r\n                this.drawGradientSlider();\r\n            } else {\r\n                this.positionSlider();\r\n            }\r\n        }\r\n    }\r\n\r\n    RGBtoHSV(rgb) {\r\n        let h;\r\n\r\n        const r = rgb[0] / 255;\r\n        const g = rgb[1] / 255;\r\n        const b = rgb[2] / 255;\r\n        const max = Math.max(r, g, b);\r\n        const min = Math.min(r, g, b);\r\n        const v = max;\r\n\r\n        const d = max - min;\r\n        const s = max === 0 ? 0 : d / max;\r\n\r\n        if (max === min) {\r\n            h = 0; // achromatic\r\n        } else {\r\n            switch (max) {\r\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n                case g: h = (b - r) / d + 2; break;\r\n                case b: h = (r - g) / d + 4; break;\r\n            }\r\n            h /= 6;\r\n        }\r\n\r\n        return [h, s, v];\r\n    }\r\n\r\n    HSVtoRGB(hsv) {\r\n        let r, g, b;\r\n        const h = hsv[0], s = hsv[1], v = hsv[2]\r\n\r\n        const i = Math.floor(h * 6);\r\n        const f = h * 6 - i;\r\n        const p = v * (1 - s);\r\n        const q = v * (1 - f * s);\r\n        const t = v * (1 - (1 - f) * s);\r\n\r\n        switch (i % 6) {\r\n            case 0:\r\n                r = v;\r\n                g = t;\r\n                b = p;\r\n                break;\r\n            case 1:\r\n                r = q;\r\n                g = v;\r\n                b = p;\r\n                break;\r\n            case 2:\r\n                r = p;\r\n                g = v;\r\n                b = t;\r\n                break;\r\n            case 3:\r\n                r = p;\r\n                g = q;\r\n                b = v;\r\n                break;\r\n            case 4:\r\n                r = t;\r\n                g = p;\r\n                b = v;\r\n                break;\r\n            case 5:\r\n                r = v;\r\n                g = p;\r\n                b = q;\r\n                break;\r\n        }\r\n\r\n        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n    }\r\n\r\n    RGBtoHexString(aRGB) {\r\n        let sV = \"#\";\r\n\r\n        for (let i = 0; i < aRGB.length; i++) {\r\n            sV += df.sys.math.padZero(Math.round(aRGB[i]).toString(16), 2);\r\n        }\r\n\r\n        return sV;\r\n    }\r\n\r\n    hexStringToRGB(sColor) {\r\n        if (sColor.length === 7) {\r\n            return [parseInt(sColor.substr(1, 2), 16), parseInt(sColor.substr(3, 2), 16), parseInt(sColor.substr(5, 2), 16)];\r\n        }\r\n        if (sColor.length === 4) {\r\n            return [parseInt(sColor.substr(1, 1) + sColor.substr(1, 1), 16), parseInt(sColor.substr(2, 1) + sColor.substr(2, 1), 16), parseInt(sColor.substr(3, 1) + sColor.substr(3, 1), 16)];\r\n        }\r\n\r\n        return [0, 0, 0];\r\n    }\r\n\r\n    RGBtoRgbString(aRGB) {\r\n        return \"rgb(\" + aRGB.join(\",\") + \")\";\r\n    }\r\n\r\n    rgbStringToRGB(sColor) {\r\n\r\n        sColor = sColor.substr(4);\r\n        if (sColor.charAt(sColor.length - 1) === ';') {\r\n            sColor.substr(0, sColor.length - 1);\r\n        }\r\n        if (sColor.charAt(sColor.length - 1) === ')') {\r\n            sColor.substr(0, sColor.length - 1);\r\n        }\r\n\r\n        const aRGB = sColor.split(\",\");\r\n        if (aRGB.length === 3) {\r\n            for (let i = 0; i < 3; i++) {\r\n                aRGB[i] = Math.max(0, Math.min(255, parseInt(aRGB[i], 10)));\r\n            }\r\n\r\n            return aRGB;\r\n        }\r\n\r\n        return [0, 0, 0];\r\n    }\r\n\r\n    stringToRGB(sColor) {\r\n        var aRGB = [0, 0, 0];\r\n\r\n        if (sColor.substr(0, 1) === \"#\") {\r\n            aRGB = this.hexStringToRGB(sColor);\r\n        } else if (sColor.substr(0, 4).toLowerCase() === \"rgb(\") {\r\n            aRGB = this.rgbStringToRGB(sColor);\r\n        }\r\n\r\n        return aRGB;\r\n    }\r\n\r\n    deserializeVT = df.sys.vt.generateDeserializer([df.tWebColorPaletteItem])\r\n};","import { WebList } from './WebList.js';\r\nimport { WebListView } from './WebListView.js';\r\nimport { WebListController } from './WebListController.js';\r\nimport { WebListRowModel } from './WebListRowModel.js';\r\nimport { WebListModel } from './WebListModel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebHtmlList\r\nExtends:\r\n    df.WebList\r\n\r\nThis class is a customizable version of the WebList that can be customized using HTML templates. \r\nNote that it does not support headers, sorting and that sort of stuff. It is just meant for \r\ndisplaying lists of data in customizable format while still enjoying the ease of automatic data \r\nbinding on the server.\r\n\r\nTo do this we had to subclass the WebListRowModel, the WebListView and the WebList itself.\r\n    \r\nRevision:\r\n    2020/02/27  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\n\r\n/*\r\nSubclass WebListRowModel to augment HTML generation for the row.\r\n*/\r\nexport class WebHtmlListRowModel extends WebListRowModel {\r\n    constructor(oList, oModel) {\r\n        super(oList, oModel);\r\n\r\n        this.rRegEx = /{{([a-zA-Z0-9_\\-]*)}}/g;\r\n    }\r\n\r\n    /*\r\n    Called to generate the HTML for a single row. Uses the regex to search for markers and replaces \r\n    them with column values calling cellHtml on the columns.\r\n    \r\n    @param  tRow    Struct with row data.\r\n    @param  aHtml   Array string builder for output.\r\n    @param  bZebra  True of odd rows, false for even.\r\n    */\r\n    rowHtml(tRow, aHtml, bZebra) {\r\n        const oL = this.oL, that = this;\r\n\r\n        aHtml.push(oL._sHtmlTemplate.replace(this.rRegEx, function (sMatch, sP1) {\r\n            if (sP1 == \"dfrowid\") {\r\n                return tRow.sRowId;\r\n            }\r\n            if (sP1 == \"isDraggable\") {\r\n                return (oL.pbDragDropEnabled && (oL.isSupportedDragAction(df.dragActions.WebList.ciDragRow)) ? 'true' : 'false');\r\n            }\r\n            const oCol = oL._oColMap[sP1];\r\n            if (oCol) {\r\n                return that.cellHtml(oCol, tRow, tRow.aCells[oCol._iColIndex]);\r\n            }\r\n            return sMatch;\r\n        }));\r\n    }\r\n}\r\n\r\n/*\r\nSubclass WebListView to add psHtmlBefore, psHtmlAfter and OnElemClick logic.\r\n*/\r\nexport class WebHtmlListView extends WebListView {\r\n\r\n    /*\r\n    Called to generate the HTML for the table. Augmented to isnert psHtmlBefore and psHtmlAfter.\r\n    \r\n    @param  aHtml   Array used as string builder.\r\n    */\r\n    tableHtml(aHtml) {\r\n        aHtml.push(this.oL.psHtmlBefore);\r\n        super.tableHtml(aHtml);\r\n        aHtml.push(this.oL.psHtmlAfter);\r\n    }\r\n\r\n    /* \r\n    This function handles the click event on the list table. It determines which row and which column is \r\n    clicked. It will trigger the cellClick on the column object and change row if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onTableClick(oEv) {\r\n        const iCol = -1, that = this;\r\n        let eElem = oEv.getTarget(), sRowId = null, sElemClick = null, bRowClick = true;\r\n\r\n        //  Check enabled state\r\n        if (!this.oL.isEnabled() || this.bCancelClick) {\r\n            return;\r\n        }\r\n\r\n        //  We need to determine if and which row was clicked so we start at the clicked element and move up untill we find the row\r\n        while (eElem.parentNode && eElem !== this.eBody && !sRowId) {\r\n            if (eElem.hasAttribute(\"data-ServerOnElemClick\")) {\r\n                sElemClick = eElem.getAttribute(\"data-ServerOnElemClick\");\r\n            }\r\n\r\n            //  Check if we found the tr element and if it is part of the table\r\n            if (eElem.hasAttribute(\"data-dfisrow\")) {\r\n                sRowId = eElem.getAttribute(\"data-dfrowid\");\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        //  Fire element click\r\n        if (sElemClick) {\r\n            bRowClick = this.oL.fire(\"OnElemClick\", [sRowId || \"\", sElemClick]);\r\n        }\r\n\r\n        //  Trigger regular cell click\r\n        if (bRowClick && sRowId) {\r\n            //  Trigger cell click\r\n            if (this.oC.cellClick(oEv, sRowId, iCol)) {\r\n                this._bPreventSubmit = true;\r\n                setTimeout(function () {\r\n                    that.bPreventSubmit = false;\r\n                }, 250);\r\n                oEv.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    No partial update supported..\r\n    */\r\n    refreshCell(sRowId, oCol) {\r\n        this.refreshDisplay();\r\n    }\r\n\r\n    /*\r\n    No partial update supported..\r\n    */\r\n    refreshRow(sRowId, sNewRowId) {\r\n        this.refreshDisplay();\r\n    }\r\n\r\n}\r\n\r\n/*\r\nThe actual WebHtmlList subclass of WebList using the changed MVC components above.\r\n*/\r\nexport class WebHtmlList extends WebList {\r\n    constructor(oParent, sName) {\r\n        super(oParent, sName);\r\n\r\n        this.prop(df.tString, \"psHtmlBefore\", \"\");\r\n        this.prop(df.tString, \"psHtmlTemplate\", \"\");\r\n        this.prop(df.tString, \"psHtmlAfter\", \"\");\r\n        this.prop(df.tInt, \"peDropPosDetectionMode\", 0);\r\n\r\n        this._oColMap = {};\r\n        this._sHtmlTemplate; // This is used as an internal reference to build the RowHtml\r\n\r\n        this.event(\"OnElemClick\", df.cCallModeWait);\r\n\r\n        this._sControlClass = \"WebHtmlList\";\r\n    }\r\n\r\n    /* \r\n    Initialize the HTML template.\r\n    */\r\n    create() {\r\n        this._sHtmlTemplate = this.initTemplate(this.psHtmlTemplate);\r\n\r\n        super.create();\r\n    }\r\n\r\n    /*\r\n    Override modules.\r\n    */\r\n    createTouchHandler() {\r\n        return null;\r\n    }\r\n\r\n    createPlaceHolder() {\r\n        return null;\r\n    }\r\n\r\n    createHeaderView() {\r\n        return null;\r\n    }\r\n\r\n    createRowModel() {\r\n        return new WebHtmlListRowModel(this, this._oModel);\r\n    }\r\n\r\n    createView() {\r\n        return new WebHtmlListView(this, this._oModel, this._oController);\r\n    }\r\n\r\n    createController() {\r\n        return new WebListController(this, this._oModel);\r\n    }\r\n\r\n    createModel() {\r\n        return new WebListModel(this);\r\n    }\r\n\r\n    /*\r\n    Override to do nothing.\r\n    */\r\n    focusHtml(aHtml){\r\n    }\r\n\r\n    /*\r\n    Augmented to intercept the column objects and build a column map used to find columns by their name.\r\n    \r\n    @param  oChild  New child object.\r\n    */\r\n    addChild(oChild) {\r\n        super.addChild(oChild);\r\n\r\n        if (oChild._bIsColumn) {\r\n            this._oColMap[oChild._sName] = oChild;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Initializes a template by injecting data-dfisrow and data-df-rowid attributes into the outermost element.\r\n    \r\n    @param  sTemplate   The HTML template for a row.\r\n    @return Altered template with necessary attributes.\r\n    @private\r\n    */\r\n    initTemplate(sTemplate) {\r\n        return sTemplate.replace(/<\\/?\\w+/i, (sMatch) => {\r\n            return sMatch + ' data-dfisrow=\"true\" data-dfrowid=\"{{dfrowid}}\" draggable=\"{{isDraggable}}\"';\r\n        });\r\n    }\r\n\r\n    /*\r\n    Client action to update the template without making psHtmlTemplate a synchronized property.\r\n    \r\n    @client-action\r\n    */\r\n    updateTemplate(sNewTemplate) {\r\n        this.set_psHtmlTemplate(sNewTemplate);\r\n    }\r\n\r\n    /*\r\n    Setters for web properties.\r\n    */\r\n    set_psHtmlTemplate(sVal) {\r\n        this._sHtmlTemplate = this.initTemplate(sVal);\r\n        this.redraw();\r\n    }\r\n\r\n    set_psHtmlBefore(sVal) {\r\n        this.psHtmlBefore = sVal;\r\n        this.redraw();\r\n    }\r\n\r\n    set_psHtmlAfter(sVal) {\r\n        this.psHtmlAfter = sVal;\r\n        this.redraw();\r\n    }\r\n\r\n    determineDropPosition(oEv, eElem) {\r\n        if (this.peDropPosDetectionMode == 0) {\r\n            return this.determineDropPosVertical(oEv, eElem);\r\n        } else {\r\n            return this.determineDropPosHorizontal(oEv, eElem);\r\n        }\r\n    }\r\n\r\n    determineDropPosVertical(oEv, eElem) {\r\n        const oRect = df.sys.gui.getBoundRect(eElem);\r\n        // We want to check if we are more to the top or to the bottom of the hovered row\r\n        const iMid = (oRect.bottom - (oRect.height / 2));\r\n        if (oEv.e.clientY >= iMid) {\r\n            return df.dropPositions.ciDropAfter;\r\n        } else {\r\n            return df.dropPositions.ciDropBefore;\r\n        }\r\n    }\r\n\r\n    determineDropPosHorizontal(oEv, eElem) {\r\n        const oRect = df.sys.gui.getBoundRect(eElem);\r\n        // We want to check if we are more to the top or to the bottom of the hovered row\r\n        const iMid = (oRect.right - (oRect.width / 2));\r\n        if (oEv.e.clientX >= iMid) {\r\n            return df.dropPositions.ciDropAfter;\r\n        } else {\r\n            return df.dropPositions.ciDropBefore;\r\n        }\r\n    }\r\n\r\n    interactWithDropElem(dropZone, eElem) {\r\n        if (dropZone._eDropAction == df.dropActions.WebControl.ciDropOnControl) {\r\n            // console.log('droponcontrol');\r\n            dropZone.highlightElement();\r\n        } else {\r\n            // console.log('droplistrow');\r\n            let eTempElem = df.dom.create(this._sHtmlTemplate.replace(this._oRowRenderer.rRegEx, function (sMatch, sP1) {\r\n                if (sP1 == \"dfrowid\") {\r\n                    return 'empty_placeholder';\r\n                }\r\n                if (sP1 == \"isDraggable\") {\r\n                    return 'false';\r\n                }\r\n                return \"\";\r\n            }));\r\n\r\n            df.dom.addClass(eTempElem, 'DfDragDrop_PlaceHolder');\r\n            eTempElem.appendChild(df.dom.create('<div class=\"DfDragDrop_PlaceHolder_Overlay\"></div>'));\r\n\r\n            dropZone.insertElement(eTempElem, eElem);\r\n        }\r\n    }\r\n\r\n}","import { WebObject } from '../WebObject.js';\r\nimport { df } from '../../df.js';\r\n\r\ndf.tDragDropDataKvPair = {\r\n    sKey: df.tString,\r\n    sValue: df.tString\r\n};\r\n\r\ndf.tGenericDragDropData = {\r\n    aDragData: [df.tDragDropDataKvPair],\r\n    aDropData: [df.tDragDropDataKvPair]\r\n};\r\n\r\nexport class WebDragDropHelper extends WebObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Events\r\n        this.event(\"OnHelperReady\", df.cCallModeWait);\r\n\r\n        // Internals\r\n        this._aSources = []; // { oControl : objectRef, aActions : [] }\r\n        this._aTargets = []; // { oControl : objectRef, aActions : [] }\r\n        this._oDragData = null; // Will store information about the drag upon a drag start\r\n                                // Format :\r\n                                // { \r\n                                //  oControl : <Control that started the drag>,\r\n                                //  eElem : <Element that started the drag>,\r\n                                //  oData : <Data for this drag>,\r\n                                //  eType : <Type of drag that was performed>\r\n                                // }\r\n        this._bInitializedDrag = false; // Flag to mark if this helper initialized the drag (to prevent invalid OnDrop events from firing)\r\n        this._bAcceptAllDrops = false;\r\n        this._oDragObj = null; // Object that is currently being dragged ( {item: ... , element: \"<div ..>\"})\r\n    }\r\n\r\n    isDropAllowed() {\r\n        if(this._bAcceptAllDrops === true) {\r\n            return true;\r\n        }\r\n\r\n        return this._bInitializedDrag;\r\n    }\r\n\r\n    create() {\r\n        super.create();\r\n\r\n        this.fire(\"OnHelperReady\");\r\n    }\r\n\r\n    registerDragSource(sObjName, sAction) {\r\n        let oObj = this.getWebApp().findObj(sObjName);\r\n        let bExists = false;\r\n\r\n        if (oObj) {\r\n            // Optionally map to different object than caller\r\n            oObj = oObj.getDragSourceObj();\r\n        }\r\n\r\n        if(!oObj){\r\n            throw new df.Error(999, \"Could not find drag source object '{{0}}'.\", this, [ sObjName ]);\r\n        }\r\n\r\n        // Check if object exists\r\n        for (let i = 0; i < this._aSources.length; i++) {\r\n            let curSource = this._aSources[i];\r\n            if (curSource.oControl == oObj) {\r\n                // Add the action\r\n                curSource.aActions.push(parseInt(sAction));\r\n                bExists = true;\r\n            }\r\n        }\r\n\r\n        // If it doesn't exist, add a new object\r\n        if (!bExists) {\r\n            const newSource = {\r\n                oControl: oObj,\r\n                aActions: [parseInt(sAction)]\r\n            }\r\n            this._aSources.push(newSource);\r\n        }\r\n\r\n        // this._aSources.add(oObj);\r\n\r\n        // Register helper at source\r\n        oObj.registerDragSource(this, parseInt(sAction));\r\n    }\r\n\r\n    registerDropTarget(sObjName, sAction) {\r\n        let oObj = this.getWebApp().findObj(sObjName);\r\n        let bExists = false;\r\n\r\n        if (oObj) {\r\n            // Optionally map to different object than caller\r\n            oObj = oObj.getDropTargetObj();\r\n        }        \r\n\r\n        if(!oObj){\r\n            throw new df.Error(999, \"Could not find drop target object '{{0}}'.\", this, [ sObjName ]);\r\n        }\r\n\r\n        // Check if object exists\r\n        for (let i = 0; i < this._aTargets.length; i++) {\r\n            let curTarget = this._aTargets[i];\r\n            if (curTarget.oControl == oObj) {\r\n                // Add the action\r\n                curTarget.aActions.push(parseInt(sAction));\r\n                bExists = true;\r\n            }\r\n        }\r\n\r\n        // If it doesn't exist, add a new object\r\n        if (!bExists) {\r\n            const newTarget = {\r\n                oControl: oObj,\r\n                aActions: [parseInt(sAction)]\r\n            }\r\n            this._aTargets.push(newTarget);\r\n        }\r\n\r\n        // Register helper at target\r\n        oObj.registerDropTarget(this, parseInt(sAction));\r\n        // oObj.initDropZones();\r\n    }\r\n\r\n    highlightDropZones() {\r\n        this._aTargets.forEach(oTarget => {\r\n            oTarget.oControl.highlightDropZones(this);\r\n        });\r\n    }\r\n\r\n    onDragStart(oEv, oDragObj, eElem, oDragData, eAction) {\r\n        // Only highlight if this helper is responsible for handling the drag from the source, otherwise stop here\r\n        if (oDragData && this.supportsDragAction(oDragObj, eAction)) {\r\n            this._oDragData = {\r\n                oControl: oDragObj,\r\n                eElem: eElem,\r\n                oData: oDragData\r\n            }\r\n\r\n            this._bInitializedDrag = true;\r\n            this.highlightDropZones();\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    onDragEnd(oEv) {\r\n        if (this.isDropAllowed()) {\r\n            this.cleanupHelper();\r\n            df.dragdrop.stopDropZones();\r\n        }\r\n    }\r\n\r\n    cleanupHelper() {\r\n        this._aTargets.forEach(oTarget => {\r\n            oTarget.oControl.cleanupDropZones();\r\n        });\r\n        this._oDragData = null;\r\n\r\n        this._bInitializedDrag = false;\r\n    }\r\n\r\n    serializeDragDropData = df.sys.vt.generateSerializer(df.tGenericDragDropData);\r\n\r\n    onDrop(oEv, oSourceDfObj, oDropZone) {\r\n        const oDragData = this._oDragData;\r\n        \r\n        if (oDragData && oDropZone && this.supportsDropAction(oDropZone._oControl, oDropZone._eDropAction) && this.isDropAllowed()) {\r\n            const oDropData = oDropZone.getDropData();\r\n\r\n            // Send OnDrop serveraction\r\n            var oDragDropData = {\r\n                DragData : this._oDragData?.oData || null,\r\n                DropData: oDropData\r\n            }\r\n\r\n            this.serverAction(\"Drop\", [this._oDragData?.oControl?.getLongName() || \"\", oDropZone._oControl.getLongName(), oDropZone._eDropPosition], oDragDropData);\r\n        }\r\n\r\n        this.onDragEnd(oEv);\r\n    }\r\n\r\n    onDragOver() {\r\n        // HTML5 Expects this to be there for dragdrop to function correctly, but an empty stub will suffice\r\n    }\r\n\r\n    destroyDragObj() {\r\n        this._oDragObj.destroy();\r\n        this._oDragObj = null;\r\n    }\r\n\r\n    supportsDragAction(oControl, eAction) {\r\n        for (let i = 0; i < this._aSources.length; i++) {\r\n            let curSource = this._aSources[i];\r\n            if (curSource.oControl == oControl) {\r\n                for (let j = 0; j < curSource.aActions.length; j++) {\r\n                    if (curSource.aActions[j] == eAction) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    supportsDropAction(oControl, eAction) {\r\n        for (let i = 0; i < this._aTargets.length; i++) {\r\n            let curTarget = this._aTargets[i];\r\n            if (curTarget.oControl == oControl) {\r\n                for (let j = 0; j < curTarget.aActions.length; j++) {\r\n                    if (curTarget.aActions[j] == eAction) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n};\r\n\r\n/*\r\nLocal WebDragDropHelper that redirects drag start (highlight) and drag end (cleanup) calls to \r\nDataFlex. This allows multiple helpers to be joined together to allow drag 'n drop between multiple \r\nlocal control hosts.\r\n*/\r\nexport class LocalWebDragDropProxy extends WebDragDropHelper {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n        this._bAcceptAllDrops = true;\r\n    }\r\n\r\n    /*\r\n    Override and send server action. Immediately include drag data.\r\n    */\r\n    highlightDropZones() {\r\n        this.serverAction(\"HighlightDropZones\", [this._oDragData.oControl.getLongName()],  { \"DragData\" : this._oDragData.oData });\r\n    }\r\n\r\n    /*\r\n    Do the actual actual highlight triggered from the server.\r\n\r\n    @client-action\r\n    */\r\n    doHighlightDropZones() {\r\n        //  Set dummy drag data to 'activate' drop logic for this helper.\r\n        this._oDragData = {\r\n            oControl : null,\r\n            eElem : null,\r\n            oData : null\r\n        }\r\n        this._aTargets.forEach(oTarget => {\r\n            oTarget.oControl.highlightDropZones(this);\r\n        });\r\n    }\r\n\r\n    /*\r\n    Override and and send to the server.\r\n    */\r\n    cleanupHelper(){\r\n        this.serverAction(\"CleanupHelper\");\r\n    }\r\n\r\n    /*\r\n    Do the actual cleanup triggered from the server.\r\n\r\n    @client-action\r\n    */\r\n    doCleanupHelper() {\r\n        this._aTargets.forEach(oTarget => {\r\n            oTarget.oControl.cleanupDropZones();\r\n        });\r\n        this._oDragData = null;\r\n    }\r\n\r\n}","import { WebDragDropHelper } from './WebDragDropHelper.js';\r\nimport { WebFileUpload_Mixin } from '../WebBaseFileUpload.js';\r\nimport { df } from '../../df.js';\r\n\r\n// Create base class for WebBaseFileUpload with WebFileUpload Mixin\r\nclass WebDragDropUploadBase extends WebFileUpload_Mixin(WebDragDropHelper) { } //df.mixin(\"df.WebFileUpload_Mixin\", \"df.WebDragDropHelper\");\r\n\r\nexport class WebDragDropFileHelper extends WebDragDropUploadBase {\r\n  constructor(sName, oParent) {\r\n    super(sName, oParent);\r\n\r\n    // this._bFileDrag = false;\r\n    this._oCurDropZone = null;\r\n  }\r\n\r\n  create() {\r\n    super.create();\r\n\r\n    // WebDragDropFileHelpers need to register themselves with the WebApp's df.dragdrop logic\r\n    // This is so we can make use of the single (existing) event handler on the document that can call all these helpers on a file entering the window.\r\n    df.dragdrop.registerHelper(this);\r\n  }\r\n\r\n  onFileDrag(oEvent) {\r\n    this.highlightDropZones();\r\n  }\r\n\r\n  onDragEnd(oEv) {\r\n    super.onDragEnd();\r\n  }\r\n\r\n  // OnDrop\r\n  // Modified to call OnFileDrop on server\r\n  onDrop(oEv, oSourceDfObj, oDropZone) {\r\n    // console.log('FILE DROP');\r\n    const oDragData = this._oDragData;\r\n    const oDropData = oDropZone.getDropData();\r\n    const bFileDrag = df.dragdrop.containsFiles(oEv.e);\r\n\r\n    if ((oDragData || bFileDrag) && oDropZone && this.supportsDropAction(oDropZone._oControl, oDropZone._eDropAction)) {\r\n      if (bFileDrag) {\r\n        // Temporarily store data, we clear it again after processing the file upload\r\n        this._tempDropData = oDropData;\r\n        this._oCurDropZone = oDropZone;\r\n        this.initFiles(oEv.e.dataTransfer.files);\r\n        this.startUpload();\r\n      } else {\r\n\r\n        // Collect drag drop data\r\n        var oDragDropData = {\r\n          DragData: oDragData.oData,\r\n          DropData: oDropData\r\n        }\r\n\r\n        // Send OnDrop serveraction\r\n        this.serverAction(\"Drop\", [this._oDragData.oControl.getLongName(), oDropZone._oControl.getLongName(), oDropZone._eDropPosition], oDragDropData);\r\n      }\r\n    }\r\n\r\n    this.onDragEnd(oEv);\r\n  }\r\n\r\n  // Calls server side upload logic,\r\n  // This is the default implementation, which can be modified to tailor specific classes needs\r\n  // The server side function should always return an array containing the fileIndex and upload key (aka: asResults = [index][fileIndex, key])\r\n  doStartUpload(fUploadCallback, aRows) {\r\n    // ToDo: Maybe convert aRows to a nice object with {index, filename, size, mime} so we can parse this to a struct at the server. Nicer to work with..\r\n    const oDragDropData = {\r\n      DragData: aRows, // In this case, the drag data is the files info, which is stored in aRows\r\n      DropData: this._tempDropData\r\n    }\r\n    //  Send call to initialize upload\r\n    this.serverAction(\"FileDrop\", [this._oCurDropZone._oControl.getLongName(), this._oCurDropZone._eDropPosition], oDragDropData, fUploadCallback);\r\n  }\r\n\r\n  // Augmented to reset the _tempDropData\r\n  cleanupHelper(oEv) {\r\n    super.cleanupHelper();\r\n\r\n    this._tempDropData = null;\r\n  }\r\n}","import { WebDynamicObjectContainer } from \"../WebDynamicObjectContainer.js\";\r\nimport { df } from '../../df.js';\r\n\r\ndf.tGridDef = {\r\n    iRowCount : df.tInt,\r\n    iColCount : df.tInt,\r\n    sDefaultRowHeight : df.tString,\r\n    sDefaultColWidth : df.tString,\r\n    sRowHeights : df.tString,\r\n    sColWidths : df.tString,\r\n}\r\n\r\ndf.tWidgetDef = {\r\n    sName : df.tString,\r\n    iRowIndex : df.tInt,\r\n    iColIndex : df.tInt,\r\n    iRowSpan : df.tInt,\r\n    iColSpan : df.tInt,\r\n    bFillHeight : df.tBool,\r\n    tNameValuePair : [{\r\n                        sName : df.tString,\r\n                        sValue : df.tString\r\n                    }]\r\n}\r\n\r\ndf.tContainerDef = {\r\n    GridDef : df.tGridDef,\r\n    aWidgets : [df.tWidgetDef]\r\n}\r\n\r\nexport class WebWidgetContainerInternal extends WebDynamicObjectContainer {\r\n\r\n    constructor(sName, oParent){\r\n        super(sName, oParent);\r\n\r\n        oParent._oWidgetContainer = this;\r\n\r\n        // this.prop(df.tAdv, \"ptContainerDef\", null);\r\n        this.prop(df.tBool, \"pbAutoToggleGrid\", false);\r\n        this.prop(df.tBool, \"pbDisableInternalDragDropHelper\", false);\r\n        this.prop(df.tBool, \"pbUseCustomConfigurationStorage\", false);\r\n        \r\n        // Event props\r\n        this.prop(df.tBool, \"pbServerOnToggleEditMode\", false);\r\n        this.prop(df.tBool, \"pbServerOnWidgetMoved\", false);\r\n        this.prop(df.tBool, \"pbServerOnWidgetResized\", false);\r\n\r\n        this.event(\"OnToggleEditMode\", df.cCallModeWait);\r\n\r\n        this._aWidgets = [];\r\n        this._aHighlightedCells = [];\r\n        this._eEditMenu;\r\n        this._oSelectedWidget = null;\r\n        this._oInternalDragDropHelper = null;\r\n        this._ePlaceHolder;\r\n        this._oCurDragControl = null;\r\n        this._aChildrenSnapShot = [];\r\n        this._bResolvingCollisions = false;\r\n        this._iCurrentHoverCol = -1;\r\n        this._aWidgetDefaultSizes = [];\r\n        this._iRowsActual = -1;\r\n        this._iGhostRows = 0;\r\n\r\n        // Configure super classes\r\n        this._sBaseClass = \"WebDynamicObjectContainer\";\r\n        this._sControlClass = \"WebWidgetContainer\";\r\n    };\r\n\r\n    afterRender () {\r\n        super.afterRender();\r\n\r\n        this._oParent._oWidgetContainer = this;\r\n\r\n        this.applyProps();\r\n\r\n        let eEditWrp = df.dom.create('<div class=\"WebCon_WebWidgetContainer_Edit_Wrp\"></div>');\r\n        this._eContent.appendChild(eEditWrp);\r\n\r\n        if (!this._eToggleEditBtn) {\r\n            this._eToggleEditBtn = df.dom.create('<span class=\"WebCon_WebWidgetContainer_Toggle_Edit_Btn WebCon_Icon\"></span>');\r\n            eEditWrp.appendChild(this._eToggleEditBtn);\r\n            df.events.addDomListener(\"click\", this._eToggleEditBtn, this.toggleEditMode, this);\r\n        }\r\n\r\n        if (!this._eEditMenu) {\r\n            this._eEditMenu = df.dom.create('<span class=\"WebCon_WebWidgetContainer_Edit_Menu\" style=\"display:none\"></span>');\r\n            eEditWrp.appendChild(this._eEditMenu);\r\n\r\n            let eSaveEditsBtn = df.dom.create('<span class=\"WebCon_WebWidgetContainer_Save_Edits_Btn WebCon_Icon\"></span>');\r\n            this._eEditMenu.appendChild(eSaveEditsBtn);\r\n            df.events.addDomListener(\"click\", eSaveEditsBtn, this.saveConfiguration, this);\r\n\r\n            let eCancelEditsBtn = df.dom.create('<span class=\"WebCon_WebWidgetContainer_Cancel_Edits_Btn WebCon_Icon\"></span>');\r\n            this._eEditMenu.appendChild(eCancelEditsBtn);\r\n            df.events.addDomListener(\"click\", eCancelEditsBtn, this.cancelEdits, this);\r\n        }\r\n\r\n        this.drawGridOverlay();\r\n\r\n    }\r\n\r\n    create (){\r\n        super.create();\r\n\r\n        if (!this.pbDisableInternalDragDropHelper) {\r\n            this.initInternalDragDropHelper();\r\n        }\r\n    }\r\n\r\n    applyProps () {\r\n        this.pbAutoToggleGrid                   = this._oParent?.pbAutoToggleGrid;\r\n        this.pbDisableInternalDragDropHelper    = this._oParent?.pbDisableInternalDragDropHelper;\r\n        this.pbUseCustomConfigurationStorage    = this._oParent?.pbUseCustomConfigurationStorage;\r\n        this.pbServerOnToggleEditMode           = this._oParent?.pbServerOnToggleEditMode;\r\n        this.pbServerOnWidgetMoved              = this._oParent?.pbServerOnWidgetMoved;\r\n        this.pbServerOnWidgetResized            = this._oParent?.pbServerOnWidgetResized;\r\n    }\r\n\r\n    // Initializes the internal drag drop helper to be used\r\n    initInternalDragDropHelper () {\r\n        if (this._oInternalDragDropHelper) { return; }\r\n\r\n        this._oInternalDragDropHelper = new df.WebWidgetContainerDragDropHelper(this.getLongName()+'int-dragdrop-helper', this);\r\n        \r\n        this._oInternalDragDropHelper.registerDropTarget(this.getLongName(), df.dropActions.WebWidgetContainer.ciDropOnCell);\r\n    } \r\n\r\n    loadDynamicObjects () {\r\n        super.loadDynamicObjects();\r\n\r\n        if (!this.pbDisableInternalDragDropHelper) {\r\n            for (let i=0; i < this._aChildren.length; i++) {\r\n                if (this._aChildren[i] instanceof df.WebWidget) {\r\n                    this._aChildren[i].initInternalDrag(this._oInternalDragDropHelper);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.calcRowsActual();\r\n        this.drawGridOverlay();\r\n    }\r\n\r\n    loadWidgets  (tConfiguration) {\r\n        this._tActionData = tConfiguration;\r\n        this.loadDynamicObjects();\r\n    }\r\n\r\n    calcRowsActual  () {\r\n        this._iRowsActual = this.piRowCount;\r\n        let oChild;\r\n\r\n        // Loop through widgets and find the highest row index + span\r\n        for (let i=0; i < this._aChildren.length; i++) {\r\n            oChild = this._aChildren[i];\r\n            if (oChild instanceof df.WebWidget) {\r\n                oChild = this._aChildren[i];\r\n                if ((oChild.piRowIndex + oChild.piRowSpan) > this._iRowsActual) {\r\n                    this._iRowsActual = (oChild.piRowIndex + oChild.piRowSpan);\r\n                }\r\n            }\r\n        }\r\n\r\n        return this._iRowsActual;\r\n    }\r\n\r\n    registerWidgetDefaultSizes () {\r\n        let aWidgets = this._tActionData;\r\n\r\n        for (let i = 0; i < aWidgets.length; i++) {\r\n            this._aWidgetDefaultSizes.push({\r\n                sName : aWidgets[i].sName,\r\n                iRowSpan : aWidgets[i].iRowSpan,\r\n                iColSpan : aWidgets[i].iColSpan\r\n            });\r\n        }\r\n    }\r\n\r\n    registerWidget (sObjName) {\r\n        let oWebApp = this.getWebApp();\r\n        let oWidget = oWebApp?.findObj(sObjName);\r\n\r\n        if (oWidget) {\r\n            oWidget.setEditMode(this._bEditMode);\r\n\r\n            if (this._oInternalDragDropHelper) {\r\n                oWidget.initInternalDrag(this._oInternalDragDropHelper);\r\n            }\r\n        }\r\n    }\r\n\r\n    findSpotForWidget () {\r\n        const oWidgetDef = this._tActionData;\r\n\r\n        oWidgetDef.iRowSpan;\r\n        oWidgetDef.iColSpan;\r\n\r\n        let [iRow, iCol] = this.findSpotForWidgetEx(oWidgetDef.iRowSpan, oWidgetDef.iColSpan);\r\n\r\n        oWidgetDef.iRowIndex = iRow;\r\n        oWidgetDef.iColIndex = iCol;\r\n\r\n        this.serverAction(\"AppendWidgetEx\", [], oWidgetDef, null);\r\n    }\r\n\r\n    findSpotForWidgetEx (iRowSpan, iColSpan) {\r\n        let oObjRect = {};\r\n\r\n        let aCollisionObjs = [];\r\n\r\n        for (let r = 0; r < this._iRowsActual; r++) {\r\n            for (let c = 0; c < (this.piColumnCount - iColSpan); c++) {\r\n                oObjRect = {\r\n                    iRowMin : r,\r\n                    iRowMax : r + iRowSpan,\r\n                    iColMin : c,\r\n                    iColMax : (c + iColSpan -1),\r\n                    iRowSpan : iRowSpan,\r\n                    iColSpan : iColSpan\r\n                };\r\n\r\n                aCollisionObjs = this.checkForCollisions(oObjRect);\r\n\r\n                if (aCollisionObjs.length <= 0) {\r\n                    return [r, c];\r\n                }\r\n            }\r\n        }\r\n\r\n        return [0, 0];\r\n    }\r\n\r\n    editWidgetEx (oObj) {\r\n        // Open wizard\r\n        this.serverAction(\"RequestConfigWizard\", [oObj.getLongName()], null, null);\r\n    }\r\n\r\n    removeWidget (sObjName) {\r\n        let oWebApp = this.getWebApp();\r\n        let oWidget = oWebApp?.findObj(sObjName);\r\n\r\n        if (oWidget) {\r\n            this.removeWidgetEx(oWidget);\r\n        }\r\n    }\r\n\r\n    removeWidgetEx (oObj) {\r\n        this.serverAction(\"RemoveWidget\", [oObj._sName], oObj.getWidgetProps());\r\n    }\r\n\r\n    saveConfiguration  () {\r\n        // generate configuration...\r\n        let tConfiguration = this.serializeDashboard() || {};\r\n\r\n        this.serverAction(\"ServerOnSaveConfiguration\", [], tConfiguration, null, null);\r\n\r\n        this.toggleEditMode();\r\n    }\r\n\r\n    saveConfigurationToLocalStorage () {\r\n        const oConfig = this._tActionData;\r\n\r\n        this.saveConfigurationToLocalStorageEx(oConfig);\r\n    }\r\n\r\n    saveConfigurationToLocalStorageEx  (oConfig) {\r\n        if (!df.pbDebugging) {\r\n            try {\r\n                localStorage.setItem(this.getStorageName(\"dashboard\"), JSON.stringify(oConfig));\r\n            // eslint-disable-next-line no-unused-vars\r\n            } catch (ex) {\r\n                // Ignore\r\n            }\r\n        }\r\n    }\r\n\r\n    invalidateLocalConfiguration () {\r\n        // ToDo: Should we maybe add an (optional paramater?) message here? \"Your dashboard configuration has been reset\"\r\n        this.saveConfigurationToLocalStorageEx({});\r\n    }\r\n\r\n    getStorageName  (sPostFix) {\r\n        if (sPostFix && sPostFix.length > 0) {\r\n            return window.location.host + \r\n            \".\" + window.location.pathname + \r\n            \".\" + this.getLongName() +\r\n            \"@\" + sPostFix;\r\n        }\r\n\r\n        return window.location.host + \r\n        \".\" + window.location.pathname + \r\n        \".\" + this.getLongName();\r\n    }\r\n\r\n    serializeDashboard  () {\r\n        let oDashboardConfig = {\r\n            sConfigVersionCode : this._oParent.psConfigVersionCode,\r\n            GridDef : {\r\n                iRowCount : this.piRowCount,\r\n                iColCount : this.piColumnCount,\r\n                iDefaultRowHeight : this.piDefaultRowHeight,\r\n                sDefaultColWidth : this.psDefaultColumnWidth,\r\n                sRowHeights : this.psRowHeights,\r\n                sColWidths : this.psColumnWidths,\r\n            },\r\n            aWidgets : []\r\n        };\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            oDashboardConfig.aWidgets.push(this._aChildren[i].getWidgetProps());\r\n        }\r\n\r\n        return oDashboardConfig;\r\n    }\r\n\r\n    widgetByName (sName){\r\n        return this[sName] || null;\r\n    }  \r\n\r\n    loadConfigurationFromLocalStorage (bRedraw) {\r\n        if (typeof bRedraw != \"boolean\") bRedraw = true;\r\n\r\n        let oConfig = null;\r\n\r\n        // if (!df.pbDebugging) {\r\n            const sConfig = localStorage.getItem(this.getStorageName(\"dashboard\"));\r\n            if (sConfig) {\r\n                try {\r\n                    oConfig = JSON.parse(sConfig);\r\n                // eslint-disable-next-line no-unused-vars\r\n                } catch (ex) {\r\n                    if (sConfig) { // Remove invalid cache.\r\n                        localStorage.removeItem(this.getStorageName(\"dashboard\"));\r\n                    }\r\n                    oConfig = null;\r\n                }\r\n            }\r\n        // }\r\n\r\n        \r\n        this.serverAction(\"LoadConfigurationFromLocalStorage\", [ df.fromBool(!!oConfig) ], oConfig, null, null);\r\n        \r\n\r\n        return oConfig;\r\n    }\r\n\r\n    // Edit mode\r\n    toggleEditMode () {\r\n        this._bEditMode = !this._bEditMode;\r\n\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            let oChild = this._aChildren[i];\r\n            \r\n            if (oChild instanceof df.WebWidget) {\r\n                oChild.setEditMode(this._bEditMode);\r\n            }\r\n        }\r\n        this._eToggleEditBtn.style.display = this._bEditMode ? 'none' : '';\r\n        this._eEditMenu.style.display = this._bEditMode ? 'flex' : 'none';\r\n\r\n        this.fire(\"OnToggleEditMode\", [df.fromBool(this._bEditMode)]);\r\n    }\r\n\r\n    cancelEdits () {\r\n        // (re)Load (existing) configuration\r\n        this.serverAction(\"Reload\", [], null, null);\r\n        \r\n        this.toggleEditMode();\r\n    }\r\n\r\n    // Grid overlay (for editing)\r\n\r\n    drawGridOverlay  () {\r\n        if (this._eGridOverLay) {\r\n            this.destroyGrid();\r\n        }\r\n        \r\n        let oObj = this;\r\n\r\n        if (oObj._bPanels) { return false; }\r\n\r\n        let oContainerRect = this.getContainerRect(oObj);\r\n        if(!oContainerRect) return;\r\n\r\n        let aCols = this.determineColumns(oObj);\r\n        let aRows = this.determineGridOverlayRows(oObj);\r\n\r\n        // Now we can use the column and row info to construct our grid overlay\r\n        // We'll create a table and position it absolute, then attach handles later\r\n        // Every row will be a <tr> with a <td> inside for each column\r\n        // We'll use the info in aRows and iColWidth to individually size each column / row inline\r\n\r\n        let aHtml = []; // Will be used to build our table html\r\n\r\n        aHtml.push('<Table class=\"WebCon_WebWidgetContainer_GridOverlay\" style=\"display: none; opacity: 0;\" data-dfcontainerobj=\"', oObj._eElem.dataset.dfobj ,'\"><tbody>');\r\n        for (let r = 0; r < aRows.length; r++) {\r\n            let sRow = this.genGridRowHtml(r, aRows[r], aCols);\r\n\r\n            aHtml.push(sRow);\r\n        }\r\n        aHtml.push('</tbody></table>');\r\n\r\n        this._eGridOverLay = df.dom.create(aHtml.join(\"\"));\r\n        this._eContainer.prepend(this._eGridOverLay);\r\n\r\n        this._iRowCount = aRows.length;\r\n\r\n        return true;\r\n    }\r\n\r\n    genGridRowHtml (iRowNum, iRowHeight, aCols, bIsGhostRow) {\r\n        let sRow = '<tr style=\"height: ' + iRowHeight + 'px; border-bottom: 1px dashed rgba(84, 175, 255, 0.5);'\r\n        if (iRowNum == 0) {\r\n            sRow += 'border-top: 1px dashed rgba(84, 175, 255, 0.5);'\r\n        }\r\n        sRow += '\"';\r\n        if (bIsGhostRow) {\r\n            sRow += ' data-dfisghostrow=\"true\"' \r\n        }\r\n        sRow += '>'\r\n\r\n        // Add columns\r\n        let sColTemplate = '';\r\n        for (let c = 0; c < aCols.length; c++) {\r\n            sColTemplate += '<td class=\"WebCon_WebWidgetContainer_GridOverlay_Cell\" data-dfcellid=\"' + iRowNum + '-' + c + '\" style=\"position: relative; width: ' + (c == 0 ? (aCols[c] - 2) : (aCols[c] - 1)) + 'px; '\r\n            if (c == 0) {\r\n                sColTemplate += 'border-left: 1px dashed rgba(84, 175, 255, 0.5); '\r\n            }\r\n            sColTemplate += 'border-right: 1px dashed rgba(84, 175, 255, 0.5);\">'\r\n            sColTemplate += '</td>'\r\n        }\r\n\r\n        sRow += sColTemplate + '</tr>';\r\n\r\n        return sRow;\r\n    }\r\n\r\n    // Determines and returns column count and width for the container\r\n    determineColumns (oObj, oRect) {\r\n        return oObj.determineColumnWidths(); \r\n    }\r\n\r\n    // Determines rows and their respective heights for the container\r\n    // If the container stuff is done properly, we can simply get the rows from the underlying container object...\r\n    // Convenience function for now in case we need to do extra stuff at a later stage\r\n    determineRows (oObj) {\r\n        return oObj.determineRowHeights();\r\n    }\r\n\r\n    determineGridOverlayRows  (oObj) {\r\n        let aRows = this.determineRows(oObj);\r\n\r\n        if (aRows.length < this._iRowsActual) {\r\n            let sBaseRowHeight = this.genBaseRowHeightString();\r\n            for (let i = aRows.length; i < this._iRowsActual; i++) {\r\n                aRows.push(sBaseRowHeight);\r\n            }\r\n        }\r\n\r\n        return aRows;\r\n    }\r\n\r\n    redrawGrid () {   \r\n        this._eGridOverLay?.parentNode?.removeChild(this._eGridOverLay);\r\n        this._eGridOverLay = null;\r\n\r\n\r\n        this.drawGridOverlay(this.oObj);\r\n    }\r\n\r\n    destroyGrid () {\r\n        if (this._eGridOverLay) {\r\n            this._eGridOverLay.parentNode.removeChild(this._eGridOverLay);\r\n            this._eGridOverLay = null;\r\n        }\r\n    }\r\n\r\n    findParentWidget (oControl) {\r\n        if (oControl instanceof df.WebWidget || oControl instanceof df.WebView) {\r\n            return oControl;\r\n        }\r\n\r\n        else {\r\n            return this.findParentWidget(oControl._oParent);\r\n        }\r\n    }\r\n\r\n    toggleGrid  () {\r\n        if (this._eGridOverLay) {\r\n            if (this._eGridOverLay.style.display == 'none') {\r\n                this._eGridOverLay.style.display = \"table\";\r\n                this._bGridVisible = true;\r\n            } else {\r\n                this._eGridOverLay.style.display = 'none';\r\n                this._bGridVisible = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    showGrid  (oOptObj) {\r\n        if (this._eGridOverLay) {\r\n            this._eGridOverLay.style.display = \"table\";\r\n            this._bGridVisible = true;\r\n        }\r\n    }\r\n\r\n    hideGrid  () {\r\n        if (this._eGridOverLay) {\r\n            this._eGridOverLay.style.display = \"none\";\r\n            this._bGridVisible = false;\r\n        }\r\n    }\r\n\r\n    getContainerRect (oObj) {\r\n        if(!oObj || !oObj._eContent) return null;\r\n        \r\n        let oContainerRect = df.sys.gui.getBoundRect(oObj._eContent);\r\n        let oStyle = df.sys.gui.getCurrentStyle(oObj._eContent);\r\n\r\n        // Remove paddings\r\n        let iLeft = oContainerRect.left + parseFloat(oStyle.paddingLeft);\r\n        let iRight = oContainerRect.right - parseFloat(oStyle.paddingRight);\r\n        let iTop = oContainerRect.top + parseFloat(oStyle.paddingTop);\r\n        let iBottom = oContainerRect.bottom - parseFloat(oStyle.paddingBottom);\r\n\r\n        return {\r\n            left: iLeft,\r\n            right: iRight,\r\n            top: iTop,\r\n            bottom: iBottom,\r\n            width: iRight - iLeft,\r\n            height: iBottom - iTop\r\n        }\r\n    }\r\n\r\n    refreshOverlay () {\r\n        this.redrawGrid();\r\n    }\r\n\r\n    set_ptContainerDef  (tConfiguration) {\r\n        this.ptContainerDef = tConfiguration;\r\n        this.saveConfigurationToLocalStorage();\r\n    }\r\n\r\n    // WidgetContainer only supports Grid\r\n    set_peLayoutType (eVal) {    \r\n        this.peLayoutType =  df.layoutType.ciLayoutTypeGrid;\r\n    }\r\n\r\n    // Always return grid\r\n    layoutType (){\r\n        return df.layoutType.ciLayoutTypeGrid;\r\n    }\r\n\r\n    // Override since we want to use fixed row heights in the widgetcontainer\r\n    genBaseRowHeightString (iHeight) {\r\n        return (\"\" + iHeight + \"px\");\r\n    }\r\n\r\n\r\n    // Dragdrop\r\n\r\n    getDragData  (oEv, eDraggedElem) {\r\n        return [null, null];\r\n    }\r\n\r\n    getDropData  (oDropZone, oPosition) {\r\n        let dropData = {\r\n            data : {\r\n                iRow : -1,\r\n                iCol : -1\r\n            },\r\n            action : df.dropActions.WebWidgetContainer.ciDropOnCell\r\n        };\r\n\r\n        // returns the cell (row + column)\r\n        const sCellID = (oDropZone._eDropElem && oDropZone._eDropElem.getAttribute(\"data-dfcellid\")) || -1;\r\n\r\n        let iDropRow, iDropCol;\r\n\r\n        \r\n        if (sCellID && sCellID != '') {\r\n            iDropRow = (parseInt(sCellID.split('-')[0]));\r\n            iDropCol = (parseInt(sCellID.split('-')[1]));\r\n        }\r\n\r\n        if (this._oWidgetDragInfo) {\r\n            iDropRow = Math.max(0, (iDropRow - this._oWidgetDragInfo.iRowOffset));\r\n            iDropCol = Math.max(0, (iDropCol - this._oWidgetDragInfo.iColOffset));\r\n        }\r\n\r\n        dropData.data.iRow = iDropRow;\r\n        dropData.data.iCol = iDropCol;\r\n\r\n        let sWidgetName = this.findWidgetNameInDragData(oDropZone._aHelpers[0]._oDragData);\r\n        for (let i = 0; i < this._aWidgetDefaultSizes.length; i++) {\r\n            let oDef = this._aWidgetDefaultSizes[i];\r\n            if (oDef.sName == sWidgetName) {\r\n                dropData.data.iRowSpan = oDef.iRowSpan\r\n                dropData.data.iColSpan = oDef.iColSpan\r\n            }\r\n        }\r\n\r\n        return dropData;\r\n    }\r\n\r\n    determineGridCell (iX, iY) {\r\n        let aElems = document.elementsFromPoint(iX, iY);\r\n\r\n        for (let i = 0; i < aElems.length; i++) {\r\n            if (aElems[i].classList.contains('WebCon_WebWidgetContainer_GridOverlay_Cell')) {\r\n                return aElems[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    initDropZones  () {\r\n        this._aDropZones = [];\r\n        \r\n        super.initDropZones();\r\n\r\n        // Mark grid as valid dropzone??\r\n        if (this.isSupportedDropAction(df.dropActions.WebWidgetContainer.ciDropOnCell)) {\r\n            this.addDropZone(this._eElem, this);\r\n        }\r\n    }\r\n\r\n    determineDropCandidate (oEv, aHelpers) {\r\n        // DropOnControl and other drop actions cannot exist within the same control simultaneously\r\n        // It makes sense to check for this first to get it out of the way as it is the simplest check\r\n        if(aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebControl.ciDropOnControl))){\r\n            return [this._eElem, df.dropActions.WebControl.ciDropOnControl] ;\r\n        }\r\n\r\n        // Check for ciDropOnCell, no need to continue if it doesn't exist\r\n        if(!aHelpers.find(oHelper => oHelper.supportsDropAction(this, df.dropActions.WebWidgetContainer.ciDropOnCell))){\r\n            return [null, null];\r\n        }\r\n        \r\n        // Determine cell\r\n        let eCell = this.determineGridCell(oEv.e.x, oEv.e.y);\r\n\r\n        if (eCell) {\r\n            return [eCell, df.dropActions.WebWidgetContainer.ciDropOnCell];\r\n        }\r\n\r\n        return [null, null];\r\n    }\r\n\r\n    // This is needed to stop the widget from instantly snapping to the mouse cursor.\r\n    initWidgetDrag (oEv, oWidget) {\r\n        this.showGrid();\r\n        let eCell = this.determineGridCell(oEv.e.x, oEv.e.y);\r\n        this.hideGrid();\r\n        let [iRow, iCol] = eCell?.dataset.dfcellid.split('-') || [0, 0];\r\n\r\n        let iRowOffset = iRow - oWidget.piRowIndex;\r\n        let iColOffset = iCol - oWidget.piColumnIndex;\r\n\r\n        this._oWidgetDragInfo = {\r\n            oWidget,\r\n            iRow,\r\n            iCol,\r\n            iRowOffset,\r\n            iColOffset\r\n        }\r\n\r\n    }\r\n\r\n    highlightDropZones  (oHelper) {\r\n        super.highlightDropZones(oHelper);\r\n\r\n        // 'Abusing' this entry point to init some stuff\r\n        this.snapshotChildrenPositions();\r\n        this._iCurrentHoverCol = -1;\r\n\r\n        this._oCurDragControl = oHelper._oDragData.oControl;\r\n        \r\n        this.showGrid();\r\n    }\r\n\r\n    cleanupDropZones () {\r\n        super.cleanupDropZones();\r\n        \r\n        // 'Abusing' this exit point to reset values\r\n        this._aChildrenSnapShot = [];\r\n        this._iCurrentHoverCol = -1;\r\n        this._ePlaceHolder?.parentNode.removeChild(this._ePlaceHolder);\r\n        this._ePlaceHolder = null;\r\n        this._oCurDragControl = null;\r\n        this._oWidgetDragInfo = null;\r\n        this._bResolvingCollisions = false;\r\n        this.removeGhostRows(0);\r\n\r\n        this.hideGrid();\r\n    }\r\n\r\n\r\n    interactWithDropElem (dropZone, eElem) {\r\n        if (dropZone._eDropAction == df.dropActions.WebControl.ciDropOnControl) {\r\n            dropZone.highlightElement();\r\n        } else {\r\n            // This would normally highlight the hovered cell, but we can use this to determine where we are and what to push - \r\n            // this marks the entry point of our sexy push logic :)\r\n            dropZone.highlightElement();\r\n            let [iRow, iCol] = eElem.dataset.dfcellid.split('-');\r\n            iRow = parseInt(iRow);\r\n            iCol = parseInt(iCol);\r\n\r\n            let oObjRect = {\r\n                iColMin : iCol,\r\n                iColMax : iCol,\r\n                iRowMin : iRow,\r\n                iRowMax : iRow\r\n            };\r\n\r\n\r\n            // Small optimization to prevent checking on every mouse move (very spammy!), only check when we actually changed row or column\r\n            if (this._iCurrentHoverCol != iCol || this._iCurrentHoverRow != iRow) {\r\n                this.resetPositionsToSnapshot();\r\n                this._iCurrentHoverCol = iCol;\r\n                this._iCurrentHoverRow = iRow\r\n\r\n                let oDragControl = dropZone._aHelpers[0]._oDragData.oControl;\r\n\r\n                // If obj is widget, use it to create objRect (for collisions and placeholder)\r\n                if (oDragControl instanceof df.WebWidget) {\r\n                    this._oCurDragControl = oDragControl;\r\n\r\n                    let iNewRow = Math.max(0, (iRow - this._oWidgetDragInfo.iRowOffset));\r\n                    let iNewCol = Math.max(0, (iCol - this._oWidgetDragInfo.iColOffset));\r\n\r\n                    oObjRect.iRowMin = iNewRow;\r\n                    oObjRect.iColMin = iNewCol;\r\n\r\n                    oObjRect.iColSpan = oDragControl.piColumnSpan;\r\n                    oObjRect.iRowSpan = oDragControl.piRowSpan;\r\n                    oObjRect.iColMax = (oObjRect.iColMin + (oDragControl.piColumnSpan - 1));\r\n                    oObjRect.iRowMax = (oObjRect.iRowMin + (oDragControl.piRowSpan));\r\n\r\n                    oDragControl.piRowIndex = iNewRow;\r\n                    oDragControl.piColumnIndex = iNewCol;\r\n                    this.position();\r\n                } else {\r\n                    let sWidgetName = this.findWidgetNameInDragData(dropZone._aHelpers[0]._oDragData);\r\n                    this.getObjRectFromDefaultSizes(sWidgetName, oObjRect);\r\n\r\n                    // Insert placeholder based on objRect\r\n                    if (!this._ePlaceHolder) {\r\n                        let sPlaceholderHtml = '<div class=\"WebCon_Widget_PlaceHolder\" style=\"border: 1px dotted black; grid-area: ' + (iRow + 1) + ' / ' + (iCol + 1) + ' / span ' + oObjRect.iRowSpan + ' / span ' + oObjRect.iColSpan + ';\"></div>';\r\n                        this._ePlaceHolder = df.dom.create(sPlaceholderHtml);\r\n                        this._eContent.appendChild(this._ePlaceHolder);\r\n                    } else {\r\n                        // Update placeholder\r\n                        this._ePlaceHolder.style.gridArea = '' + (iRow + 1) + ' / ' + (iCol + 1) + ' / span ' + oObjRect.iRowSpan + ' / span ' + oObjRect.iColSpan;\r\n                    }\r\n                }\r\n                \r\n                // Check (and potentially resolve) collisions (recursive action)\r\n                this.checkGridBottom(oObjRect);\r\n                this.checkAndResolveCollisions(oObjRect);\r\n            }\r\n        }\r\n    }\r\n\r\n    checkGridBottom  (oObjRect) {\r\n        let iCurGhostRows = (this._iGhostRows >= 0) ? this._iGhostRows : 0;\r\n        // If the object spans only 1 row, we want to overflow earlier so we can add an additional row still\r\n        let iRefRow = (oObjRect.iRowSpan > 1) ? oObjRect.iRowMax : (oObjRect.iRowMax + 1);\r\n        let iRowDiff = (iRefRow - (this._iRowsActual + iCurGhostRows));\r\n\r\n        if (iRowDiff > 0) {\r\n            this._iGhostRows += iRowDiff;\r\n            this.addGhostRows(iRowDiff);\r\n        } else {\r\n            if (iCurGhostRows > 0) {\r\n                this.removeGhostRows(iRefRow);\r\n            }\r\n        }\r\n    }\r\n\r\n    addGhostRows  (iRowsToAdd) {\r\n        let sGhostRowsHtml = '';\r\n        let aCols = this.determineColumns(this);\r\n        let aeRows = df.dom.query(this._eGridOverLay, 'tr', true);\r\n        let iNewRowNum = aeRows.length;\r\n        let iDefaultRowHeight = this.getDefaultRowHeight();\r\n\r\n        let eGridoverLayTableBody = df.dom.query(this._eGridOverLay, 'tbody');\r\n\r\n        if (eGridoverLayTableBody) {\r\n            for (let i = 0; i < iRowsToAdd; i++) {\r\n                sGhostRowsHtml += this.genGridRowHtml(iNewRowNum, iDefaultRowHeight, aCols, true);\r\n            }\r\n            eGridoverLayTableBody.innerHTML = eGridoverLayTableBody.innerHTML + sGhostRowsHtml;\r\n        }\r\n    }\r\n\r\n    removeGhostRows  (iToRow) {\r\n        let aeRows = Array.from(df.dom.query(this._eGridOverLay, 'tr', true));\r\n        let eRow;\r\n\r\n        while (aeRows.length > iToRow) {\r\n            eRow = aeRows.pop();\r\n            if (eRow.dataset.dfisghostrow == 'true') {\r\n                eRow.parentNode.removeChild(eRow);\r\n                this._iGhostRows--;\r\n            }\r\n        }\r\n    }\r\n\r\n    findWidgetNameInDragData (oDragData) {\r\n        if (oDragData.oControl instanceof df.WebList) {\r\n            // Assume name is in row's rowId\r\n            return oDragData.oData.data.sRowId;\r\n        } else if (oDragData.oControl instanceof df.WebTreeView) {\r\n            // Assume name is in node value\r\n            return oDragData.oData.data.sValue;\r\n        } else {\r\n            // Data should be in string format\r\n            return oDragData.oData.data;\r\n        }\r\n    }\r\n\r\n    getObjRectFromDefaultSizes (sWidgetName, oObjRect) {\r\n        for (let i = 0; i < this._aWidgetDefaultSizes.length; i++) {\r\n            let oDef = this._aWidgetDefaultSizes[i];\r\n            if (oDef.sName == sWidgetName) {\r\n                oObjRect.iColSpan = oDef.iColSpan;\r\n                oObjRect.iRowSpan = oDef.iRowSpan;\r\n                oObjRect.iColMax = (oObjRect.iColMin + (oDef.iColSpan - 1));\r\n                oObjRect.iRowMax = (oObjRect.iRowMin + (oDef.iRowSpan));\r\n            }\r\n        }\r\n    }\r\n\r\n    snapshotChildrenPositions () {\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            this._aChildrenSnapShot.push(this._aChildren[i].piRowIndex);\r\n        }\r\n    }\r\n\r\n    resetPositionsToSnapshot () {\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            this._aChildren[i].piRowIndex = this._aChildrenSnapShot[i];\r\n        }\r\n\r\n        this.position();\r\n    }\r\n\r\n    // oObjRect = {\r\n    //      iColMin : ...,\r\n    //      iColMax : ...,\r\n    //      iRowMin : ...,\r\n    //      iRowMax : ...\r\n    //  }\r\n\r\n    checkForCollisions (oObjRect, oOptRefObj) {\r\n        let aCollisionObjs = [];\r\n\r\n        for (let i=0; i < this._aChildren.length; i++) {\r\n            let oChild = this._aChildren[i];  \r\n\r\n            if (oChild != this._oCurDragControl && oChild != oOptRefObj && this.isWithinObjRect(oObjRect, oChild)) {\r\n                // Mark for move\r\n                aCollisionObjs.push(oChild);\r\n            }\r\n        }\r\n\r\n        return aCollisionObjs;\r\n    }\r\n\r\n    checkAndResolveCollisions  (oObjRect, oOptRefObj) {\r\n        let aCollisionObjs = this.checkForCollisions(oObjRect, oOptRefObj)\r\n\r\n        let c = 0;\r\n        // Resolve collisions (recursive)\r\n        while (c < aCollisionObjs.length) {\r\n            if (!this._bResolvingCollisions) {\r\n                this.resolveCollision(aCollisionObjs[c], oObjRect);\r\n                c++;\r\n            }\r\n        }\r\n    }\r\n\r\n    resolveCollision  (oObj, oCurObjRect) {\r\n        if (!this._bResolvingCollisions) {\r\n            this._bResolvingCollisions = true;\r\n            \r\n            oObj.piRowIndex = oCurObjRect.iRowMax;\r\n            this.position();\r\n\r\n            let oObjRect = this.getObjRect(oObj);\r\n\r\n            this.checkAndResolveCollisions(oObjRect, oObj);\r\n        }\r\n    }\r\n\r\n    position () {\r\n        super.position();\r\n\r\n        this._bResolvingCollisions = false;\r\n    }\r\n\r\n    getObjRect  (oObj) {\r\n        let oObjRect = {\r\n            iColMin : oObj.piColumnIndex || 0,\r\n            iColMax : (oObj.piColumnIndex + (oObj.piColumnSpan - 1)) || 0,\r\n            iRowMin : oObj.piRowIndex || 0,\r\n            iRowMax : (oObj.piRowIndex + (oObj.piRowSpan)) || 0,\r\n        }\r\n\r\n        return oObjRect;\r\n    }\r\n\r\n    isWithinObjRect  (oObjRect, oChild) {\r\n        let aObjCols = [];\r\n        let aChildCols = [];\r\n        const iChildColMax = oChild.piColumnIndex + (oChild.piColumnSpan - 1);\r\n\r\n        for (let c = oObjRect.iColMin; c <= oObjRect.iColMax; c++) {\r\n            aObjCols.push(c);\r\n        }\r\n    \r\n        for (let c = oChild.piColumnIndex; c <= iChildColMax; c++) {\r\n            aChildCols.push(c);\r\n        }\r\n\r\n        if ((this.arrayIntersections(aChildCols, aObjCols)).length > 0) {\r\n            let aObjRows = [];\r\n            let aChildRows = [];\r\n            const iChildRowMax = oChild.piRowIndex + (oChild.piRowSpan - 1);\r\n\r\n            for (let r = oObjRect.iRowMin; r <= oObjRect.iRowMax; r++) {\r\n                aObjRows.push(r);\r\n            }\r\n            \r\n            for (let r = oChild.piRowIndex; r <= iChildRowMax; r++) {\r\n                aChildRows.push(r);\r\n            }\r\n\r\n            return ((this.arrayIntersections(aChildRows, aObjRows)).length > 0);\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // This may seem inefficient, but is actually a O(n) speed operation and faster than checking every edge of our rectangles manually\r\n    arrayIntersections  (a, b) {\r\n        const setA = new Set(a);\r\n        return b.filter(value => setA.has(value));\r\n    }\r\n\r\n\r\n    highlightGridCell (eCell) {\r\n        for (let i = 0; i < this._aHighlightedCells.length; i++) {\r\n            this._aHighlightedCells[i].style.backgroundColor = 'transparent';\r\n        }\r\n\r\n        this._aHighlightedCells = [];\r\n\r\n        eCell.style.backgroundColor = 'rgba(84, 175, 255, 0.5)';\r\n        this._aHighlightedCells.push(eCell);\r\n    }\r\n\r\n    resize () {\r\n        super.resize();\r\n\r\n        if (this._eGridOverLay) {\r\n            this.redrawGrid();\r\n        }\r\n    }\r\n\r\n}","/*\r\nMain include file for the DataFlex JavaScript Engine. This file includes all the standard web \r\ncontrols and the core library. Include this file when packing your custom optimized build.\r\n*/\r\n\r\n// Global library of helper functions\r\nimport { df } from './df.js';\r\nself.df = df;\r\n\r\n// Helper classes\r\nimport  { HttpRequest } from    './df/ajax/HttpRequest.js';\r\nimport  { JSONCall } from   './df/ajax/JSONCall.js';\r\nimport { ServerAction, ServerCall } from './df/ServerAction.js';\r\nimport { InfoBalloon } from './df/InfoBalloon.js';\r\nimport { MobRuleController } from './df/MobRuleController.js';\r\nimport { GroupHub } from './df/GroupHub.js';\r\n\r\ndf.ajax.HttpRequest = HttpRequest;\r\ndf.ajax.JSONCall = JSONCall;\r\ndf.ServerAction = ServerAction;\r\ndf.ServerCall = ServerCall;\r\ndf.InfoBalloon = InfoBalloon;\r\ndf.MobRuleController = MobRuleController;  \r\ndf.GroupHub = GroupHub;\r\n\r\n// Web Object classes\r\nimport { WebObject } from './df/WebObject.js';\r\nimport { WebBaseUIObject } from './df/WebBaseUIObject.js';\r\nimport { WebBaseContainer } from './df/WebBaseContainer.js';\r\nimport { WebBaseControl } from './df/WebBaseControl.js';\r\nimport { WebBaseDEO } from './df/WebBaseDEO.js';\r\nimport { WebBaseForm } from './df/WebBaseForm.js';\r\nimport { WebBaseFileUpload } from './df/WebBaseFileUpload.js';\r\nimport { WebBaseMenu } from './df/WebBaseMenu.js';\r\nimport { WebPanel } from './df/WebPanel.js';\r\nimport { BaseApp } from './df/BaseApp.js';\r\nimport { WebApp } from './df/WebApp.js';\r\nimport { LocalApp } from './df/LocalApp.js';\r\nimport { WebBaseView } from './df/WebBaseView.js';\r\nimport { WebView } from './df/WebView.js';\r\nimport { WebWindow } from './df/WebWindow.js';\r\nimport { WebModalDialog } from './df/WebModalDialog.js';\r\nimport { WebButton } from './df/WebButton.js';\r\nimport { WebLabel } from './df/WebLabel.js';\r\nimport { WebForm } from './df/WebForm.js';\r\nimport { WebDateForm } from './df/WebDateForm.js';\r\nimport { WebDynamicObjectContainer } from './df/WebDynamicObjectContainer.js';\r\nimport { WebCheckbox } from './df/WebCheckbox.js';\r\nimport { WebEdit } from     './df/WebEdit.js';\r\nimport { WebCombo } from './df/WebCombo.js';\r\nimport { WebBaseSelectionForm } from './df/WebBaseSelectionForm.js';\r\nimport { WebSuggestionForm } from './df/WebSuggestionForm.js';\r\nimport { WebSelectionForm } from './df/WebSelectionForm.js';\r\nimport { WebTagsForm } from './df/WebTagsForm.js';\r\nimport { WebListExpandPanel } from './df/WebListExpandPanel.js';\r\nimport { WebList } from './df/WebList.js';\r\nimport { WebListHeaderView } from './df/WebListHeaderView.js';\r\nimport { WebListRowModel } from './df/WebListRowModel.js';\r\nimport { WebListSwipeButton } from './df/WebListSwipeButton.js';\r\nimport { WebGrid } from './df/WebGrid.js';\r\nimport { WebMuliSelectList } from './df/WebMultiSelectList.js';\r\nimport { WebColumn_mixin } from './df/WebColumn_mixin.js';\r\nimport { WebColumn } from './df/WebColumn.js';\r\nimport { WebColumnCombo } from './df/WebColumnCombo.js';\r\nimport { WebColumnCheckbox } from './df/WebColumnCheckbox.js';\r\nimport { WebColumnDate } from './df/WebColumnDate.js';\r\nimport { WebColumnButton } from './df/WebColumnButton.js';\r\nimport { WebColumnImage } from './df/WebColumnImage.js';\r\nimport { WebColumnSuggestion } from './df/WebColumnSuggestion.js';\r\nimport { WebColumnLink } from './df/WebColumnLink.js';\r\nimport { WebColumnTags } from './df/WebColumnTags.js';\r\nimport { WebColumnSelectionIndicator } from './df/WebColumnSelectionIndicator.js';\r\nimport { WebCommandBar } from './df/WebCommandBar.js';\r\nimport { WebMenuBar } from './df/WebMenuBar.js';\r\nimport { WebMenuGroup } from './df/WebMenuGroup.js';\r\nimport { WebToolBar } from './df/WebToolBar.js';\r\nimport { WebActionBar } from './df/WebActionBar.js';\r\nimport { WebMenuItem } from './df/WebMenuItem.js';\r\nimport { WebMenuItemCheckbox } from './df/WebMenuItemCheckbox.js';\r\nimport { WebMenuColumnBase } from './df/WebMenuColumnBase.js';\r\nimport { WebMenuColumnList } from './df/WebMenuColumnList.js';\r\nimport { WebMenuColumnRestorer } from './df/WebMenuColumnRestorer.js';\r\nimport { WebMenuGroupingSelector } from './df/WebMenuGroupingSelector.js';\r\nimport { WebCardContainer } from './df/WebCardContainer.js';\r\nimport { WebCard } from './df/WebCard.js';\r\nimport { WebTabContainer } from './df/WebTabContainer.js';\r\nimport { WebTabPage } from './df/WebTabPage.js';\r\nimport { WebDatePicker } from './df/WebDatePicker.js';\r\nimport { WebTreeView } from './df/WebTreeView.js';\r\nimport { WebIFrame } from './df/WebIFrame.js';\r\nimport { WebImage } from './df/WebImage.js';\r\nimport { WebHtmlBox } from './df/WebHtmlBox.js';\r\nimport { WebRadio } from './df/WebRadio.js';\r\nimport { WebSlider } from './df/WebSlider.js';\r\nimport { WebSpacer } from './df/WebSpacer.js';\r\nimport { WebHorizontalLine } from './df/WebHorizontalLine.js';\r\nimport { WebTimer } from './df/WebTimer.js';\r\nimport { WebProgressBar } from './df/WebProgressBar.js';\r\nimport { WebFileUploadButton } from './df/WebFileUploadButton.js';\r\nimport { WebFileUploadForm } from './df/WebFileUploadForm.js';\r\nimport { WebGroup } from './df/WebGroup.js';\r\nimport { WebBreadcrumb } from './df/WebBreadcrumb.js';\r\nimport { WebFloatingPanel } from './df/WebFloatingPanel.js';\r\nimport { WebMenuButton } from './df/WebMenuButton.js';\r\nimport { WebMenuList } from './df/WebMenuList.js';\r\nimport { WebColorPicker } from './df/WebColorPicker.js';\r\nimport { WebColorForm } from './df/WebColorForm.js';\r\nimport { WebColumnHighlight } from './df/WebColumnHighlight.js';\r\nimport { WebAccordionContainer } from './df/WebAccordionContainer.js';\r\nimport { WebAccordionCard } from './df/WebAccordionCard.js';\r\nimport { WebHtmlList, WebHtmlListRowModel } from './df/WebHtmlList.js';\r\nimport { WebGeoLocation } from './df/WebGeoLocation.js';\r\nimport { WebContextMenu } from './df/WebContextMenu.js';\r\nimport { WebDrawing } from './df/WebDrawing.js';\r\nimport { WebDropZone } from './df/dragdrop/WebDropZone.js';\r\nimport { WebDragDropHelper } from './df/dragdrop/WebDragDropHelper.js';\r\nimport { WebDragDropFileHelper } from './df/dragdrop/WebDragDropFileHelper.js';\r\nimport { LocalWebDragDropProxy } from './df/dragdrop/WebDragDropHelper.js';\r\nimport { WebWidget } from './df/dashboard/WebWidget.js';\r\nimport { WebWidgetContainerDragDropHelper } from './df/dashboard/WebWidgetContainerDragDropHelper.js';\r\nimport { WebWidgetContainerInternal } from './df/dashboard/WebWidgetContainerInternal.js';\r\nimport { WebWidgetContainer } from './df/dashboard/WebWidgetContainer.js';\r\n\r\ndf.WebObject = WebObject;\r\ndf.WebBaseUIObject = WebBaseUIObject;\r\ndf.WebBaseContainer = WebBaseContainer;\r\ndf.WebBaseControl = WebBaseControl;\r\ndf.WebBaseDEO = WebBaseDEO;\r\ndf.WebBaseForm = WebBaseForm;\r\ndf.WebBaseFileUpload = WebBaseFileUpload;\r\ndf.WebBaseMenu = WebBaseMenu;\r\ndf.WebPanel = WebPanel;\r\ndf.BaseApp = BaseApp;\r\ndf.WebApp = WebApp;\r\ndf.LocalApp = LocalApp;\r\ndf.WebBaseView = WebBaseView;\r\ndf.WebView = WebView;\r\ndf.WebWindow = WebWindow;\r\ndf.WebModalDialog = WebModalDialog;\r\ndf.WebButton = WebButton;\r\ndf.WebLabel = WebLabel;\r\ndf.WebForm = WebForm;\r\ndf.WebDateForm = WebDateForm;\r\ndf.WebDynamicObjectContainer = WebDynamicObjectContainer;\r\ndf.WebCheckbox = WebCheckbox;\r\ndf.WebEdit = WebEdit;\r\ndf.WebBaseSelectionForm = WebBaseSelectionForm;\r\ndf.WebCombo = WebCombo;\r\ndf.WebSuggestionForm = WebSuggestionForm;\r\ndf.WebSelectionForm = WebSelectionForm;\r\ndf.WebTagsForm = WebTagsForm;\r\ndf.WebListExpandPanel = WebListExpandPanel;\r\ndf.WebList = WebList;\r\ndf.WebListHeaderView = WebListHeaderView;\r\ndf.WebListRowModel = WebListRowModel;\r\ndf.WebListSwipeButton = WebListSwipeButton;\r\ndf.WebGrid = WebGrid;\r\ndf.WebMuliSelectList = WebMuliSelectList;\r\ndf.WebColumn_mixin = WebColumn_mixin;\r\ndf.WebColumn = WebColumn;\r\ndf.WebColumnCombo = WebColumnCombo;\r\ndf.WebColumnCheckbox = WebColumnCheckbox;\r\ndf.WebColumnDate = WebColumnDate;\r\ndf.WebColumnButton = WebColumnButton;\r\ndf.WebColumnImage = WebColumnImage;\r\ndf.WebColumnSuggestion = WebColumnSuggestion;\r\ndf.WebColumnLink = WebColumnLink;\r\ndf.WebColumnTags = WebColumnTags;\r\ndf.WebColumnSelectionIndicator = WebColumnSelectionIndicator;\r\ndf.WebCommandBar = WebCommandBar;\r\ndf.WebMenuBar = WebMenuBar;\r\ndf.WebMenuGroup = WebMenuGroup;\r\ndf.WebToolBar = WebToolBar;\r\ndf.WebActionBar = WebActionBar;\r\ndf.WebMenuItem = WebMenuItem;\r\ndf.WebMenuItemCheckbox = WebMenuItemCheckbox;\r\ndf.WebMenuColumnBase = WebMenuColumnBase;\r\ndf.WebMenuColumnList = WebMenuColumnList;\r\ndf.WebMenuColumnRestorer = WebMenuColumnRestorer;\r\ndf.WebMenuGroupingSelector = WebMenuGroupingSelector;\r\ndf.WebCardContainer = WebCardContainer;\r\ndf.WebCard = WebCard;\r\ndf.WebTabContainer = WebTabContainer;\r\ndf.WebTabPage = WebTabPage;\r\ndf.WebDatePicker = WebDatePicker;\r\ndf.WebTreeView = WebTreeView;\r\ndf.WebIFrame = WebIFrame;\r\ndf.WebImage = WebImage;\r\ndf.WebHtmlBox = WebHtmlBox;\r\ndf.WebRadio = WebRadio;\r\ndf.WebSlider = WebSlider;\r\ndf.WebSpacer = WebSpacer;\r\ndf.WebHorizontalLine = WebHorizontalLine;\r\ndf.WebTimer = WebTimer;\r\ndf.WebProgressBar = WebProgressBar;\r\ndf.WebFileUploadButton = WebFileUploadButton;\r\ndf.WebFileUploadForm = WebFileUploadForm;\r\ndf.WebGroup = WebGroup;\r\ndf.WebBreadcrumb = WebBreadcrumb;\r\ndf.WebFloatingPanel = WebFloatingPanel;\r\ndf.WebMenuButton = WebMenuButton;\r\ndf.WebMenuList = WebMenuList;\r\ndf.WebColorPicker = WebColorPicker;\r\ndf.WebColorForm = WebColorForm;\r\ndf.WebColumnHighlight = WebColumnHighlight;\r\ndf.WebAccordionContainer = WebAccordionContainer;\r\ndf.WebAccordionCard = WebAccordionCard;\r\ndf.WebHtmlList = WebHtmlList;\r\ndf.WebHtmlListRowModel = WebHtmlListRowModel;\r\ndf.WebGeoLocation = WebGeoLocation;\r\ndf.WebContextMenu = WebContextMenu;\r\ndf.WebDrawing = WebDrawing;\r\ndf.WebDropZone = WebDropZone;\r\ndf.WebDragDropHelper = WebDragDropHelper;\r\ndf.WebDragDropFileHelper = WebDragDropFileHelper;\r\ndf.LocalWebDragDropProxy = LocalWebDragDropProxy;\r\ndf.WebWidget = WebWidget;\r\ndf.WebWidgetContainerDragDropHelper = WebWidgetContainerDragDropHelper;\r\ndf.WebWidgetContainerInternal = WebWidgetContainerInternal;\r\ndf.WebWidgetContainer = WebWidgetContainer;\r\n\r\n\r\n\r\n\r\n","/*\r\nClasses defining objects used to store data for actions and calls by the df.WebApp and df.WebObject \r\nclasses.\r\n\r\nRevisions:\r\n    2011/11/18  Created the initial versions. (HW, DAW)\r\n    2013/06/07  Refactored and moved call logic itself to df.WebApp. (HW, DAW)\r\n*/\r\n\r\n/*\r\nThe df.ServerAction class / object represents an action to be executed on the server. It basically \r\nis a function call. This class is purely used by df.WebApp and df.WebObject to store data that \r\nbelongs to a call while it is queued and send.\r\n*/\r\nexport class ServerAction {\r\n    constructor() {\r\n        this.oWO = null;\r\n        this.sAction = \"\";\r\n        this.aParams = [];\r\n        this.tData = { v: \"\", c: [] };\r\n\r\n        this.aViews = [];\r\n\r\n        this.eCallMode = df.cCallModeDefault;\r\n        this.sProcessMessage = \"\";\r\n\r\n        this.fHandler = null;\r\n        this.oHandlerEnv = null;\r\n\r\n        this.sReturnValue = null;\r\n    }\r\n};\r\n\r\n/*\r\nThe df.ServerCall class represents a call about to be sent to the server. It contains one or more \r\nactions (df.ServerAction) and can be waiting to be sent (pending) or it can be currently processed. \r\nThe df.WebApp class uses the call objects internally.\r\n*/\r\nexport class ServerCall {\r\n    constructor() {\r\n        this.aActions = [];\r\n\r\n        this.eCallMode = df.cCallModeDefault;\r\n        this.sProcessMessage = \"\";\r\n\r\n        this.sFocus = \"\";\r\n\r\n        this.aWaiters = [];\r\n\r\n        this.bSending = false;\r\n    }\r\n};\r\n","/*\r\nClass:\r\n    df.InfoBalloon\r\nExtends:\r\n    Object\r\n\r\nThis class can show an info balloon next to a control to display errors or additional information. \r\nThis info balloon consists of a simple div element that is positioned by the class next to the \r\nelement. Used to display errors (WebBaseDEO.showControlError) and custom info balloons \r\n(WebBaseControl.showInfoBalloon).\r\n    \r\nRevision:\r\n    2011/07/04  (HW, DAW) \r\n        Initial version.\r\n    2013/12/10  (HW, DAW)\r\n        Refactored from WebTooltip into InfoBalloon. Simplified so it doesn't inherit from WebObject\r\n        any more (which wasn't needed).\r\n*/\r\n/* global df */\r\nexport class InfoBalloon {\r\n    constructor(oControl, sCssClass, sMessage) {\r\n        this.psMessage = sMessage;\r\n        this.piHideDelay = 6000;\r\n        this.pbShowOnHover = true;\r\n        this.psCSSClass = sCssClass;\r\n\r\n        this.poTarget = oControl;\r\n\r\n        this._eElem = null;\r\n        this._eEventElem = null;\r\n        this._eParentRef = null;\r\n        this._bFirstPos = true;\r\n        this._bTopTooltip = false;\r\n        this._tHideTimeout = null;\r\n        this._tPositionInterval = null;\r\n\r\n    }\r\n\r\n    update() {\r\n        if (this._eElem) {\r\n            this._eElem.innerHTML = this.psMessage;\r\n            this._eElem.className = \"WebInfoBalloon \" + this.psCSSClass;\r\n\r\n            //  Reset position\r\n            this._eElem.style.bottom = \"\";\r\n            this._eElem.style.top = \"\";\r\n            this._eElem.style.left = \"\";\r\n\r\n            //  Recalculate position (from scratch)\r\n            this._bTopTooltip = false;\r\n            this._bFirstPos = true;\r\n            this.position();\r\n        }\r\n    }\r\n\r\n    init() {\r\n        const eTarget = this.getTargetElem();\r\n\r\n        if (!this._eElem && eTarget) {\r\n            //  Create elem\r\n            this._eElem = df.dom.create('<div class=\"WebInfoBalloon WebInfoBalloonHidden ' + this.psCSSClass + '\"></div>');\r\n            this._eElem.innerHTML = this.psMessage;\r\n\r\n            //  Insert\r\n            const eParent = this.poTarget?.topLayer() || document.body;\r\n            eParent.appendChild(this._eElem);\r\n\r\n            this._bTopTooltip = false;\r\n            this._bFirstPos = true;\r\n            this.position();\r\n\r\n            if (this.pbShowOnHover) {\r\n                df.dom.on(\"mouseover\", eTarget, this.onMouseOver, this);\r\n                df.dom.on(\"mouseout\", eTarget, this.onMouseOut, this);\r\n                this._eEventElem = eTarget;\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Remove DOM elements and clear event handlers when destroying the object.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        if (this._eElem && this._eElem.parentNode) {\r\n            this._eElem.parentNode.removeChild(this._eElem);\r\n        }\r\n        this._eElem = null;\r\n    }\r\n\r\n    show() {\r\n        if (!this._eElem) {\r\n            this.init();\r\n        } else {\r\n            //  Make sure we are the last child in the container..\r\n            if (this._eElem.parentNode.lastChild !== this._eElem) {\r\n                this._eElem.parentNode.appendChild(this._eElem);\r\n            }\r\n        }\r\n        this._show();\r\n        this.setTimeout();\r\n    }\r\n\r\n    _show() {\r\n        const that = this;\r\n\r\n        if (this._eElem) {\r\n            // this.position();\r\n            // this._eElem.style.visibility = \"visible\";\r\n            df.dom.addClass(this._eElem, \"WebInfoBalloonVisible\");\r\n            df.dom.removeClass(this._eElem, \"WebInfoBalloonHidden\");\r\n\r\n            if (!this._tPositionInterval) {\r\n                this._tPositionInterval = setInterval(function () {\r\n                    that.position();\r\n                }, 300);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    getTargetElem() {\r\n        let eElem = this.poTarget._eElem;\r\n\r\n        if (this.poTarget.getTooltipElem) {\r\n            eElem = this.poTarget.getTooltipElem() || eElem;\r\n        }\r\n\r\n        return eElem;\r\n    }\r\n\r\n    hide() {\r\n        const eElem = this._eElem;\r\n\r\n        if (this._eElem) {\r\n            this._hide();\r\n\r\n            if (this._eEventElem) {\r\n                df.dom.off(\"mouseover\", this._eEventElem, this.onMouseOver, this);\r\n                df.dom.off(\"mouseout\", this._eEventElem, this.onMouseOut, this);\r\n                this._eEventElem = null;\r\n            }\r\n\r\n            if (this._tHideTimeout) {\r\n                clearTimeout(this._tHideTimeout);\r\n                this._tHideTimeout = null;\r\n            }\r\n\r\n\r\n            setTimeout(function () {\r\n                if (eElem.parentNode) {\r\n                    eElem.parentNode.removeChild(eElem);\r\n                }\r\n            }, 3000);\r\n            this._eElem = null;\r\n        }\r\n    }\r\n\r\n    _hide() {\r\n        if (this._eElem) {\r\n            // this._eElem.style.visibility = \"hidden\";\r\n            df.dom.addClass(this._eElem, \"WebInfoBalloonHidden\");\r\n            df.dom.removeClass(this._eElem, \"WebInfoBalloonVisible\");\r\n        }\r\n\r\n        if (this._tPositionInterval) {\r\n            clearInterval(this._tPositionInterval);\r\n            this._tPositionInterval = null;\r\n        }\r\n\r\n    }\r\n\r\n    position() {\r\n        let iTop = 0, iLeft = 0;\r\n\r\n        const eTarget = this.getTargetElem(); //  The element to position next\r\n        const eTool = this._eElem;    //  The tooltip\r\n\r\n        if (eTool && eTarget) {\r\n            const iScreenWidth = df.dom.windowWidth();\r\n\r\n            if (!df.sys.gui.isOnScreen(eTarget)) {\r\n                eTool.style.display = \"none\";\r\n                return;\r\n            } else {\r\n                eTool.style.display = \"\";\r\n            }\r\n\r\n            //    Calculate offsets using bounding rectangles (this is better when the content is scrolled)\r\n            const oRectT = df.sys.gui.getBoundRect(eTarget);\r\n\r\n            iTop = oRectT.top + oRectT.height;\r\n            iLeft = oRectT.left + Math.max(Math.round((oRectT.width - 70) / 2), 0);\r\n\r\n            //  Calculate width & height of the tooltip\r\n            const iHeight = eTool.clientHeight + df.sys.gui.getVertBoxDiff(eTool);\r\n            const iWidth = eTool.clientWidth + df.sys.gui.getHorizBoxDiff(eTool);\r\n            //  Calculate the bottom coordiante\r\n            const iBottom = iTop + eTarget.offsetHeight;\r\n\r\n            if (this._bFirstPos) {\r\n                //  Determine if we should make it a top balloon (we do that if there is not enough space below and enough space above)\r\n                if (screen.height < (iTop + iHeight) && screen.height > (iBottom + iHeight)) {\r\n                    this._bTopTooltip = true;\r\n                    df.dom.addClass(this._eElem, \"WebInfoBalloon_Top\");\r\n                }\r\n                this._bFirstPos = false;\r\n            }\r\n\r\n            //  Optionally move it to the left if it is too wide (but rely on wrapping)\r\n            if (iScreenWidth < iLeft + iWidth) {\r\n                iLeft = Math.max(oRectT.left - 10, 0);\r\n            }\r\n\r\n            //  Position on top or at the bottom\r\n            if (this._bTopTooltip) {\r\n                eTool.style.bottom = iBottom + \"px\";\r\n            } else {\r\n                eTool.style.top = iTop + \"px\";\r\n            }\r\n            eTool.style.left = iLeft + \"px\";\r\n\r\n        }\r\n    }\r\n\r\n    setTimeout() {\r\n        const that = this;\r\n        if (this.piHideDelay > 0) {\r\n            if (this._tHideTimeout) {\r\n                clearTimeout(this._tHideTimeout);\r\n            }\r\n            this._tHideTimeout = setTimeout(function () {\r\n                that._hide();\r\n            }, this.piHideDelay);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the mouseover event of the element. It displays the balloon.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onMouseOver(oEvent) {\r\n        this._show();\r\n\r\n        if (this._tHideTimeout) {\r\n            clearTimeout(this._tHideTimeout);\r\n            this._tHideTimeout = null;\r\n        }\r\n    }\r\n\r\n    onMouseOut(oEvent) {\r\n        this.setTimeout();\r\n    }\r\n\r\n    resize() {\r\n        this.position();\r\n    }\r\n}","/* \r\nClass:\r\n    df.GroupHub\r\n    \r\nThis class is a generic hub between providers and listeners that share data in groups. The group is \r\nidentified by a string a unique string. Both providers and listeners register themselves to a \r\nspecific group. Listeners implement the groupUpdate method which is called passing a data array with \r\nthe new group data. This update is performed as soon as the contents of the group might have \r\nchanged. This change can mean that the set of providers is changed or that a provider triggered an \r\nupdate by calling updateGroup. The provider needs to implement the collectGroup procedure which is \r\ncalled by the hub during an update to gather the data for that group during an update. It gets \r\npassed an array to which it can add its data. This class is being used by the group logic of the \r\nmenu system.\r\n\r\nRevision:\r\n    2015/01/15  Creation (HW, DAW)\r\n */\r\n\r\n\r\nexport class GroupHub {\r\n    constructor() {\r\n        this._oGroups = {};\r\n    }\r\n    /* \r\n    Registers an object as listener for a specific group. Listener objects should implement the \r\n    groupUpdate function. Adding a listener causes groupUpdate to be called immediately to provide the \r\n    initial set of data.\r\n    \r\n    @param  sGroup      Name of the group.\r\n    @param  oListener   Listener object.\r\n    */\r\n    addListener(sGroup, oListener) {\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        //  Initiate group if neede\r\n        if (!this._oGroups[sGroup]) {\r\n            this._oGroups[sGroup] = { aListeners: [], aProviders: [] };\r\n        }\r\n\r\n        //  Register listener\r\n        this._oGroups[sGroup].aListeners.push(oListener);\r\n\r\n        //  Do initial update\r\n        const aData = this.collectGroup(sGroup);\r\n        oListener.groupUpdate(aData);\r\n    }\r\n\r\n    /* \r\n    Unregisters an object as a listener for a specific group.\r\n    \r\n    @param  sGroup      Name of the group.\r\n    @param  oListener   Listener object.\r\n    */\r\n    remListener(sGroup, oListener) {\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        if (this._oGroups[sGroup]) {\r\n            const i = this._oGroups[sGroup].aListeners.indexOf(oListener);\r\n\r\n            if (i >= 0) {\r\n                //  Remove if found\r\n                this._oGroups[sGroup].aListeners.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Registers a provider for a specific group. Provider objects should implement the groupCollect \r\n    function that is called passing an array by reference to add the data to. Adding a provider causes \r\n    the group to update itself immediately.\r\n    \r\n    @param  sGroup      Name of the group.\r\n    @param  oProv       The provider object.\r\n    */\r\n    addProvider(sGroup, oProv) {\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        //  Initiate group if needed\r\n        if (!this._oGroups[sGroup]) {\r\n            this._oGroups[sGroup] = { aListeners: [], aProviders: [] };\r\n        }\r\n\r\n        //  Register provider\r\n        this._oGroups[sGroup].aProviders.push(oProv);\r\n\r\n        //  Do initial update\r\n        this.updateGroup(sGroup);\r\n    }\r\n\r\n    /* \r\n    Removes a provider from a specific group. Removing a provider causes a group to update itself.\r\n    \r\n    @param  sGroup  Name of the group.\r\n    @param  oProv   Provider object to unregister.\r\n    */\r\n    remProvider(sGroup, oProv) {\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        //  Find group & provider\r\n        if (this._oGroups[sGroup]) {\r\n            const i = this._oGroups[sGroup].aProviders.indexOf(oProv);\r\n            if (i >= 0) {\r\n\r\n                //  Remove if found\r\n                this._oGroups[sGroup].aProviders.splice(i, 1);\r\n\r\n                //  Update group\r\n                this.updateGroup(sGroup);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Updates a specific group by collecting its data from the providers and then triggering the listeners \r\n    by calling their groupUpdate procedures.\r\n    \r\n    @param  sGroup  Name of the group.\r\n    */\r\n    updateGroup(sGroup) {\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        //  Check if there is anything to update\r\n        if (this._oGroups[sGroup] && this._oGroups[sGroup].aListeners.length > 0) {\r\n            //  Collect data\r\n            const aData = this.collectGroup(sGroup);\r\n\r\n            //  Update listeners with new data\r\n            const aL = this._oGroups[sGroup].aListeners;\r\n            for (let i = 0; i < aL.length; i++) {\r\n                aL[i].groupUpdate(aData);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Collects data for a specific group by calling groupCollect on all the providers. An array is passed \r\n    by reference to the groups so they can add their data.\r\n    \r\n    @param  sGroup      Name of the group.\r\n    @return     Array with the group data.\r\n    */\r\n    collectGroup(sGroup) {\r\n        let aData = []; \r\n\r\n        sGroup = sGroup.toLowerCase();\r\n\r\n        //  Loop over providers to collect data\r\n        const aP = this._oGroups[sGroup].aProviders;\r\n        for (let i = 0; i < aP.length; i++) {\r\n            aP[i].groupCollect(aData);\r\n        }\r\n\r\n        return aData;\r\n    }\r\n\r\n    /* \r\n    Returns all listener objects for a specific group.\r\n    */\r\n    getListeners(sGroup) {\r\n        if (this._oGroups[sGroup]) {\r\n            return this._oGroups[sGroup].aListeners.slice();\r\n        }\r\n        return [];\r\n    }\r\n\r\n};","import { JSONCall } from './ajax/JSONCall.js';\r\nimport { BaseApp } from './BaseApp.js';\r\n\r\n\r\n/*\r\nClass:\r\n    df.WebApp\r\nExtends:\r\n    df.BaseApp\r\n\r\nThis class is the main class of the DataFlex Engine that has the logic for loading application \r\ndefinitions of the server and creation of the Web Objects. An instance of this class should be \r\ncreated for every application within the page. It will act as the main API to initialize and render \r\nweb applications and views. A lot of global logic like error handling and server actions are \r\nimplemented in this class.\r\n\r\nIt inherits from df.WebBaseContainer because it can contain and manage visual controls (panels and \r\nmainly views). Views are a special case when rendering since they render to the center panel area by \r\ndefault.\r\n\r\n@code\r\nvar oWebApp = new df.WebApp(\"WebService.wso\");\r\n\r\noWebApp.displayApp(\"#viewport\");\r\n@code\r\nThe example above shows how to create a webapp object that will communicate with the \r\n'WebService.wso' web-service and it will render to the '#viewport' element within the page. This \r\nrenders the entire webapp including global panels en menu's.\r\n\r\n@code\r\nvar oWebApp = new df.WebApp(\"WebService.wso\");\r\n\r\noWebApp.displayView(\"oOrderView\", \"#viewport\");\r\n@code\r\nThe example above shows how to create a webapp object but only render a single view.\r\n*/\r\nexport class WebApp extends BaseApp {\r\n    constructor(sOptWebService) {\r\n        super();\r\n\r\n        this.psWebService = sOptWebService || \"WebServiceDispatcher.wso\";\r\n        this.pbXHRWithCredentials = false;\r\n\r\n        this._bPanels = true;\r\n\r\n        this.pbViewApp = true;\r\n    }\r\n\r\n    sendCall(oCall) {\r\n        return new Promise((resolve, reject) => {\r\n            //  Create & send the call\r\n            let oRequest = new JSONCall(\"CallAction\", this.assembleRequest(oCall), this.psWebService, this);\r\n            oRequest.pbWithCredentials = this.pbXHRWithCredentials;\r\n            oRequest.bSilent = true;\r\n            oRequest.onFinished.addListener(function (oEvent) {\r\n                try {\r\n                    //  Parse response\r\n                    let tData = oEvent.oSource.getResponseValue();\r\n\r\n                    resolve(tData);\r\n                } catch (oErr) {\r\n                    reject(oErr);\r\n                }\r\n            }, this);\r\n\r\n            oRequest.onError.addListener(function (oEvent) {\r\n                reject(oEvent.oError);\r\n            }, this);\r\n            try {\r\n                oRequest.send(true);\r\n            } catch (oErr) {\r\n                reject(oErr);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n    position() {\r\n\r\n    }\r\n\r\n\r\n}","import { WebBaseView } from './WebBaseView.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebView\r\nExtends:\r\n    df.WebBaseView\r\n\r\nThis class represents a view within in Visual DataFlex Web Application. It inherits from WebWindow \r\nbut it doesn't have the be a floating window. This inheritance structure is chosen because of the \r\nWebModalDialog class that inherits from WebView and the possible future support of MDI.\r\n\r\nThe WebView is managed by the df.WebApp class which maintains a set of views. It has support for \r\nhandling a DDO structure and is a scope in the synchronized properties system. This means that only \r\nsynchronized properties from the current view and optionally its invoking view will be synchronized \r\nwithin a single call.\r\n    \r\nRevision:\r\n    2011/07/11  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebView extends WebBaseView {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web Properties\r\n        this.prop(df.tBool, \"pbFillHeight\", false);\r\n\r\n        //  Configure parents\r\n        this._sControlClass = \"WebView\";\r\n        this._sBaseClass = \"WebInlineView\";\r\n        this._bWrapDiv = true;\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpOpenHtml(aHtml) {\r\n        //  Wrapper div for positioning of control\r\n        aHtml.push('<div class=\"WebContainer\">');\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpCloseHtml(aHtml) {\r\n        //  Wrapper div for positioning of control\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        //  Optionally label\r\n        aHtml.push('<div class=\"WebCon_Inner\">');\r\n\r\n        aHtml.push('<label class=\"WebWin_title\"', (!this.pbShowCaption ? 'style=\"display: none\"' : ''), '>', df.dom.encodeHtml(this.psCaption), '</label>');\r\n\r\n        aHtml.push('<div class=\"WebCon_ContentWrp\">');\r\n    }\r\n\r\n    closeHtml(aHtml) {\r\n        super.closeHtml(aHtml);\r\n\r\n        aHtml.push('</div></div></div></div>');\r\n    }\r\n\r\n    afterRender() {\r\n        //  Get references to generated elements\r\n        this._eInner = df.dom.query(this._eElem, \"div.WebCon_Inner\");\r\n        this._eContentWrap = df.dom.query(this._eElem, \"div.WebCon_ContentWrp\");\r\n        this._eLbl = df.dom.query(this._eElem, \"label.WebWin_title\");\r\n\r\n        //  Call super\r\n        super.afterRender();\r\n\r\n        this.set_piHeight(this.piHeight);\r\n        this.set_piWidth(this.piWidth);\r\n        this.set_piMaxWidth(this.piMaxWidth);\r\n\r\n        this.set_piMinWidth(this.piMinWidth);\r\n\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n    }\r\n\r\n    _show(eRenderTo) {\r\n        const oWebApp = this.getWebApp();\r\n        const bRender = !this._eElem;\r\n\r\n        this.fireEx({\r\n            sEvent: \"OnShow\"\r\n        });\r\n\r\n        //  Render to DOM elements if that didn't happen before\r\n        if (bRender) {\r\n            const eElem = this.render();\r\n            df.dom.addClass(eElem, \"WebWin_Hidden\");\r\n        }\r\n\r\n        //  Insert into the DOM (if needed)\r\n        if (this._eElem.parentNode !== eRenderTo) {\r\n            eRenderTo.appendChild(this._eElem);\r\n            this._eRenderTo = eRenderTo;\r\n        }\r\n\r\n        //  Remove \"hidden\" class\r\n        df.dom.removeClass(this._eElem, \"WebWin_Hidden\");\r\n\r\n        //  We still need to call the afterRender method if we freshly rendered\r\n        if (bRender) {\r\n            this.afterRender();\r\n        }\r\n\r\n        //  Make sure sizes are correct and then unhide\r\n        this._bRendered = true;\r\n\r\n        //  Trigger afterShow\r\n        this.afterShow();\r\n\r\n        this._oCurrentObj = null;\r\n\r\n        //  Make sure that this view is the currentwindow and the focus object is inside this view\r\n        if (oWebApp) {\r\n            oWebApp.objFocus(this);\r\n        }\r\n\r\n        //  Set a small timeout so the framework will resize controls\r\n        setTimeout(() => {\r\n            if (oWebApp && this._bRendered) {\r\n                //  Give focus to first element\r\n                if (this.pbFocusFirstOnShow && !this._oCurrentObj) {\r\n                    this.conditionalFocus(true);\r\n                }\r\n\r\n                //  Add visible CSS class\r\n                df.dom.addClass(this._eElem, \"WebWin_Visible\");\r\n\r\n                //  Fire event\r\n                oWebApp.OnShowWindow.fire(oWebApp, {\r\n                    oWindow: this,\r\n                    eElem: this._eElem,\r\n                    bModal: false\r\n                });\r\n            }\r\n        }, 20);\r\n    }\r\n\r\n    _hide(bNoServerEvents) {\r\n        const oWebApp = this.getWebApp();\r\n        let bCanceled = false;\r\n\r\n        if (this._bRendered) {\r\n            if (this._bRendered && !bNoServerEvents) {\r\n                this.fire(\"OnHide\", []);\r\n            }\r\n\r\n            df.dom.addClass(this._eElem, \"WebWin_Hidden\");\r\n            df.dom.removeClass(this._eElem, \"WebWin_Visible\");\r\n\r\n            //  Fire webapp event\r\n            if (oWebApp) {\r\n                bCanceled = !oWebApp.OnHideWindow.fire(oWebApp, {\r\n                    oWindow: this,\r\n                    eElem: this._eElem,\r\n                    bModal: false\r\n                });\r\n            }\r\n        }\r\n\r\n        this._bRendered = false;\r\n        //  Trigger afterHide\r\n        this.afterHide();\r\n\r\n        //  Remove window from DOM\r\n        if (this._bStandalone) {\r\n            //  If the OnHideWindow event was stopped we wait with the removal of the element so an animation or so can be performed, else we do it immediately to not disturb anything\r\n            if (bCanceled) {\r\n                setTimeout(() => {\r\n                    if (this._eElem && this._eElem.parentNode) {\r\n                        this._eElem.parentNode.removeChild(this._eElem);\r\n                    }\r\n                }, 5000);\r\n            } else {\r\n                if (this._eElem && this._eElem.parentNode) {\r\n                    this._eElem.parentNode.removeChild(this._eElem);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    /* \r\n    Called by the WebApp object to trigger a resize. It gets the maximum available space for views as a \r\n    parameter. If we are floating we just look at the screen dimensions.\r\n    \r\n    @param  iMaxH   Maximum height determined by the WebApp.\r\n    @private\r\n    */\r\n    viewResize(iMaxH) {\r\n        const oWebApp = this.getWebApp();\r\n\r\n        this.prepareSize();\r\n\r\n        //  Apply piHeight or maximum if piHeight is to high or not set\r\n        if (this.piHeight > 0 && this.piHeight < iMaxH) {\r\n            this.setOuterHeight(this.piHeight);\r\n        } else if (this._bStretch || (this.pbScroll && oWebApp._eElem)) {\r\n            this.setOuterHeight(iMaxH);\r\n        }\r\n\r\n        this.resize();\r\n    }\r\n\r\n    /*\r\n    This method determines the height that is lost. For the tab panel this is the space that the buttons \r\n    take.\r\n    \r\n    @return The amount of pixels that can't be used by the content.\r\n    @private\r\n    */\r\n    getHeightDiff(bOut, bIn, bContentOut, bContentIn) {\r\n        let iHeight = super.getHeightDiff(bOut, bIn, bContentOut, bContentIn);\r\n\r\n        if (this._eLbl) {\r\n            if (bContentOut) {\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eInner, 0);\r\n                iHeight += this._eLbl.offsetHeight;\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eLbl, 1);\r\n\r\n                iHeight += df.sys.gui.getVertBoxDiff(this._eContentWrap, 0);\r\n            }\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n\r\n    /* \r\n    @client-action\r\n    \r\n    Called by the server from the new drill-down system when navigating up multiple levels. In that case \r\n    the view being navigated too (this view) is not in sync and an extra round trip is needed to finish \r\n    that operation. Note that we are relying on oWebApp._oCurrentWindow to be pointing to the top view \r\n    of the view stack so that it is automatically being synchronized as well.\r\n    \r\n    @param  bCancel     Is it a cancel operation or not (passed back to the server).\r\n    @param  bCallback   Is there are callback object (passed back to the server).\r\n    @param  sCallback   Name of the callback object (passed back to the server).\r\n    @private\r\n    */\r\n    navigateBackToHere(bCancel, bCallback, sCallback) {\r\n        this.serverAction(\"NavigateBackToHere_Callback\", [bCancel, bCallback, sCallback], this._tActionData);\r\n    }\r\n\r\n\r\n    /* \r\n    Augment destroy to remove view from the view array and to clear its DDO data kept by the WebApp \r\n    object.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        const oWebApp =  this.getWebApp();\r\n        let i\r\n\r\n        if (oWebApp) {\r\n            //  Remove from views array\r\n            i = oWebApp._aViews.indexOf(this);\r\n            if (i >= 0) {\r\n                oWebApp._aViews.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    /*\r\n    This method implements the action method that is called from the server. It will close the view.\r\n    */\r\n    closePanel() {\r\n        this.close();\r\n    }\r\n\r\n    set_pbFillHeight(bVal) {\r\n        this.pbFillHeight = bVal;\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_piMinWidth(iVal) {\r\n        if (!this.pbFloating) {\r\n            if (this._eSizer) {\r\n                if (iVal > 0) {\r\n                    iVal -= this.getWidthDiff(true, true, false, false);\r\n                    this._eSizer.style.minWidth = iVal + \"px\";\r\n                } else {\r\n                    this._eSizer.style.minWidth = \"\";\r\n                }\r\n            }\r\n            this.sizeChanged();\r\n        }\r\n\r\n        this.piMinWidth = iVal;\r\n        this.set_piWidth(this.piWidth);\r\n    }\r\n\r\n    set_piWidth(iVal) {\r\n\r\n        //df.WebWindow.base.set_piWidth.call(this, iVal);\r\n        if (this._eSizer) {\r\n            const iDiff = this.getWidthDiff(true, true, false, false);\r\n            iVal -= iDiff;\r\n\r\n            this._eSizer.style.width = (iVal > 0 ? iVal + \"px\" : \"\");\r\n        }\r\n        this.sizeChanged();\r\n    }\r\n\r\n    set_piMaxWidth(iVal) {\r\n        if (this._eSizer) {\r\n            if (iVal > 0) {\r\n                iVal -= this.getWidthDiff(true, true, false, false);\r\n                this._eSizer.style.maxWidth = iVal + \"px\";\r\n            } else {\r\n                this._eSizer.style.maxWidth = \"\";\r\n            }\r\n        }\r\n        this.sizeChanged();\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    resizeHorizontal() {\r\n        this.setOuterWidth(this.piWidth);\r\n\r\n        super.resizeHorizontal();\r\n    }\r\n\r\n\r\n    setOuterHeight(iHeight) {\r\n        if (!this._eContainer) return;\r\n\r\n        iHeight -= this.getHeightDiff(true, false, false, false);\r\n\r\n        this._eContainer.style.height = (iHeight > 0 ? iHeight + 'px' : '');\r\n    }\r\n\r\n    resize() {\r\n        if (!this._bRendered) return;\r\n\r\n        //  Center the view (if needed)\r\n        this.updateAlign();\r\n\r\n        this.resizeHorizontal();\r\n        this.resizeVertical();\r\n    }\r\n\r\n\r\n    /* \r\n    Sets the marginLeft and marginRight properties to update the alignment of the view. It uses the \r\n    peAlignView property of the webapp object to determine the alignment.\r\n    \r\n    @private\r\n    */\r\n    updateAlign() {\r\n\r\n        if (this._eSizer) {\r\n            const eAlign = this.getWebApp().peAlignView;\r\n\r\n            this._eSizer.style.marginLeft = (eAlign === df.ciAlignCenter || eAlign === df.ciAlignRight ? \"auto\" : \"\");\r\n            this._eSizer.style.marginRight = (eAlign === df.ciAlignCenter ? \"auto\" : \"\");\r\n        }\r\n    }\r\n}","import { WebBaseForm } from './WebBaseForm.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebEdit\r\nExtends:\r\n    df.WebBaseForm\r\n\r\nThis is the client-side representation of the WebEdit class. It generates the HTML for the input \r\nelement and possibly a prompt button.\r\n    \r\nRevision:\r\n    2011/10/12  (HW, DAW) \r\n        Initial version.\r\n*/\r\n/*\r\nThis class is the implementation of the client-side part of the WebEdit data entry object. It can \r\nrender itself to HTML and implements the published properties from the server. It has special prompt \r\nbutton functionality.\r\n*/\r\nexport class WebEdit extends WebBaseForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbStopOnSubmit\", true);\r\n        this.prop(df.tString, \"psPlaceHolder\", \"\");\r\n\r\n        // @privates\r\n        this._eWrap = null;\r\n        this._ePrompt = null;\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebEdit\";\r\n        this._bJSSizing = false;\r\n    }\r\n\r\n    /*\r\n    This method generates the HTML for input element. The input element has two wrappers for styling it \r\n    and making space for the prompt button. The HTML for the prompt button is available by default and \r\n    is made visible when needed.\r\n    \r\n    @param  aHtml   String builder array to which HTML can be added.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebFrm_Wrapper\"><textarea name=\"', this._sName, '\"',\r\n            ' autocomplete=\"', df.dom.encodeAttr(this.psAutoComplete), '\"',\r\n            (this.peLabelPosition != df.ciLabelFloat ? (' placeholder=\"' + df.dom.encodeAttr(this.psPlaceHolder) + '\" ') : ''),\r\n            (!this.isEnabled() ? ' disabled=\"disabled\" tabindex=\"-1\"' : ''),\r\n            '></textarea></div>');\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and gets references, attaches event handlers and sets property \r\n    values.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebFrm_Wrapper textarea\");\r\n        this._eWrap = df.dom.query(this._eElem, \"div.WebFrm_Wrapper\");\r\n\r\n        super.afterRender();\r\n\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n    }\r\n\r\n    /*\r\n    This setter sets the background color of the field. The background color is applied to the wrapper \r\n    div element.\r\n    \r\n    @param  sVal    The bew value.\r\n    @private\r\n    */\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eWrap) {\r\n            this._eWrap.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    /* \r\n    Sets the placeholder using the HTML5 placeholder attribute (only works on IE10 and higher).\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psPlaceHolder(sVal) {\r\n        if (this._eControl && this.peLabelPosition != df.ciLabelFloat) {\r\n            this._eControl.placeholder = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Override the getter of pbChanged to make sure that line feeds don't cause pbChanged to become true. \r\n    The textarea DOM element converts all line-feeds & cariage returns into single line feed characters \r\n    without the user actually making a change. So we make the same change before doing the comparison.\r\n    */\r\n    get_pbChanged() {\r\n        let sComp = this._sOrigValue;\r\n\r\n        if (this.pbChanged) {\r\n            return true;\r\n        }\r\n\r\n        if (this._eElem) {\r\n            this.updateTypeVal();\r\n\r\n            sComp = sComp.replace(/\\r\\n|\\r/g, '\\n');\r\n        }\r\n\r\n        return sComp !== this.getServerVal();\r\n\r\n        //  HW: Test code to be deleted after fix is confirmed..\r\n        // var bRes = sComp !== this.getServerVal();\r\n\r\n        // sComp = sComp.replace(/\\r/g, \"[LF]\");\r\n        // sComp = sComp.replace(/\\n/g, \"[CR]\");\r\n\r\n        // var sV = this.getServerVal();\r\n\r\n        // sV = sV.replace(/\\r/g, \"[LF]\");\r\n        // sV = sV.replace(/\\n/g, \"[CR]\");\r\n\r\n        // console.log(\"Result: \" + bRes + \"\\r\\nOrig:  '\" + sComp + \"' \\r\\n Value: '\" + sV + \"'\");\r\n\r\n        // return bRes;\r\n    }\r\n\r\n\r\n    /*\r\n    We override this method because the form has an extra wrapper of which the Box Difference needs to \r\n    be taken into account.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n\r\n        iResult += df.sys.gui.getVertBoxDiff(this._eWrap);\r\n\r\n        if (df.sys.isChrome) {   //  Strange extra pixels in chrome :S\r\n            iResult++;\r\n            iResult++;\r\n        }\r\n\r\n        return iResult;\r\n    }\r\n\r\n\r\n    /*\r\n    Handles the onKey event and makes sure that it doesn't propagate the enter key if pbStopOnSubmit is \r\n    true to stop the onsubmit event of the view / dialog.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        //  Make sure that the OnSubmit doesn't fire by canceling the propagation (but leaving the default behavior, OnClick intact)\r\n        if (oEvent.matchKey(df.settings.formKeys.submit) && this.pbStopOnSubmit) {\r\n            oEvent.stopPropagation();\r\n        } else {\r\n            super.onKey(oEvent);\r\n        }\r\n    }\r\n\r\n\r\n}","import { WebBaseSelectionForm } from './WebBaseSelectionForm.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebSelectionForm\r\nExtends:\r\n    df.WebBaseSelectionForm\r\n\r\nImplementation of the web suggestion form that is capable of showing a list of suggestions while \r\ntyping. These suggestions can come from a variety of sources which is mainly determined on the \r\nserver.\r\n\r\nRevision:\r\n    2020/09/25  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebSelectionForm extends WebBaseSelectionForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.event(\"OnSelect\", df.cCallModeDefault, \"privateOnSelect\");\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        // OpenHtml of the WebBaseSelectionForm.\r\n        super.openHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n        // AfterRender of the WebBaseSelectionForm.\r\n        super.afterRender();\r\n    }   \r\n\r\n    suggestSelect() {\r\n        if (this._oSelectedSuggestion && !this._oSelectedSuggestion.control) {\r\n            let tRow = this.findSuggestionByValue(this._oSelectedSuggestion.aValues[0]);\r\n            if (tRow) {\r\n                this.set_psValue(tRow.aValues[0]);\r\n                this.fireEx({\r\n                    sEvent: \"OnSelect\",\r\n                    tActionData: [tRow],\r\n                    oEnv: this\r\n                });\r\n                this.suggestHide();\r\n                return;\r\n            }\r\n        }\r\n        super.suggestSelect();\r\n    }\r\n    \r\n}","import { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebListSwipeButton\r\nExtends:\r\n    df.WebBaseUIObject\r\n\r\nSwipe button inside a WebList. It is threated by the list as a column but it isn't really a column. \r\nThe WebList class itself implements the rendering.\r\n    \r\nRevision:\r\n    2017/01/18  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\nexport class WebListSwipeButton extends WebBaseUIObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tInt, \"piWidth\", 50);\r\n        this.prop(df.tBool, \"pbPositionLeft\", false);\r\n        this.prop(df.tBool, \"pbDynamic\", false);\r\n        this.prop(df.tBool, \"pbAllowHtml\", false);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait);\r\n\r\n        this._iColIndex = 0;\r\n        this._bIsSwipeButton = true;\r\n    }\r\n\r\n    isVisible(tCell) {\r\n        return this.pbRender && this.pbVisible && (!this.pbDynamic || df.toBool(tCell.aOptions[0]));\r\n    }\r\n\r\n    btnHtml(tCell) {\r\n        let sV = \"\";\r\n        if (this.pbDynamic) {\r\n            sV = tCell.sValue;\r\n        } else {\r\n            sV = this.psCaption;\r\n        }\r\n\r\n        if (!this.pbAllowHtml) {\r\n            sV = df.dom.encodeHtml(sV);\r\n        }\r\n\r\n        return sV;\r\n    }\r\n\r\n    /* \r\n    Triggered by the List / Grid when a cell of this column is clicked. Checks if a button is clicked \r\n    and if so it will fire the OnClick event.\r\n    \r\n    @param  oEvent  Event object.\r\n    @param  sRowId  RowId of the clicked row.\r\n    */\r\n    btnClick(oEv, sRowId, fHandler, oEnv) {\r\n        this.fire(\"OnClick\", [sRowId], fHandler, oEnv);\r\n\r\n        return true;\r\n    }\r\n};\r\n","import { WebColumnCheckbox } from './WebColumnCheckbox.js';\r\nimport { WebGrid } from './WebGrid.js';\r\nimport { WebMuliSelectList } from './WebMultiSelectList.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebColumnSelectionIndicator\r\nExtends:\r\n    df.WebColumnCheckbox\r\n\r\nThis is an extention on the WebList to allow for multi-selection of rows.\r\n    \r\nRevision:\r\n    2022/07/06  (BN, DAW) \r\n        Initial version.\r\n*/\r\n\r\nexport class WebColumnSelectionIndicator extends WebColumnCheckbox {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tBool, \"pbSelectAllCheckbox\", false);\r\n\r\n        //  Configure super class\r\n        this._sCellClass = \"WebColumnSelectionIndicator WebColCheckbox\";\r\n        this._sControlClass = \"WebColumnSelectionIndicator WebCheckbox WebCheckboxColumn\";\r\n\r\n        this._bIsMultiSelectCapable = true;\r\n        this._bAllCheckedCheckbox = false;\r\n    }\r\n\r\n    setAllSelectedCheckbox(bValue) {\r\n        if (bValue !== this._bAllCheckedCheckbox) {\r\n            this._bAllCheckedCheckbox = bValue;\r\n\r\n            this.updateHeader();\r\n        }\r\n    }\r\n\r\n    create() {\r\n        if (!(this._oParent instanceof WebMuliSelectList)) {\r\n            throw new df.Error(999, \"The parent of the a cWebColumnSelectionIndicator should be a cWebMultiSelectList.\");\r\n        }\r\n        return super.create();\r\n    }\r\n\r\n    /*\r\n    @20.1\r\n    This function is called when the header of the column is constructed.\r\n    It could later be augmented for custom headers.\r\n    */\r\n    headerCSS() {\r\n        return this.pbSelectAllCheckbox ? \"WebCheckbox WebCheckboxColumn\" : null;\r\n    }\r\n\r\n    /*\r\n    @20.1\r\n    This function is called when the header of the column is constructed.\r\n    It could later be augmented for custom headers.\r\n    */\r\n    headerHtml() {\r\n        if (this.pbSelectAllCheckbox) {\r\n            return '<input class=\"WebMultiSelectList_SelectAllBox\" type=\"checkbox\"' + (this._oParent._oController.areAllRowsSelected() ? 'checked=\"checked\"' : '') + ' tabindex=\"-1\"><span class=\"WebMultiSelectList_SelectAllBox WebCB_Fake\"></span>';\r\n        } else {\r\n            return super.headerHtml();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines the HTML that is displayed within a cell. It gets the value as a parameter \r\n    and uses the column context properties (like masks) to generate the value to display. For default \r\n    grid columns it simply displays the properly masked value.\r\n    \r\n    @param  tCell   Data object reprecenting the cell data.\r\n    @return The HTML representing the display value.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        const aHtml = [];\r\n\r\n        aHtml.push('<div class=\"', this.genClass(), '\"><div class=\"WebCon_Inner\"><div><input type=\"checkbox\"');\r\n\r\n        if (this._oParent.isRowIdSelected(sRowId)) {\r\n            aHtml.push(' onclick=\"this.checked = true\" checked=\"checked\"');\r\n        } else {\r\n            aHtml.push(' onclick=\"this.checked = false\"');\r\n        }\r\n\r\n        if (!this.isEnabled()) {\r\n            aHtml.push(' disabled=\"disabled\"');\r\n        }\r\n        if (!(this._oParent instanceof WebGrid)) {\r\n            aHtml.push(' tabindex=\"-1\"');\r\n        }\r\n\r\n        aHtml.push('><span class=\"WebCB_Fake\"></span></div></div></div>');\r\n\r\n        return aHtml.join('');\r\n    }\r\n\r\n    set_pbSelectAllCheckbox(bSelectAllCheckbox) {\r\n        if (this.pbSelectAllCheckbox !== bSelectAllCheckbox) {\r\n            this.pbSelectAllCheckbox = bSelectAllCheckbox;\r\n            this._oParent._oHeader.updateHeader();\r\n        }\r\n    }\r\n}","import { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { WebMenuBar } from './WebMenuBar.js';\r\nimport { WebToolBar } from './WebToolBar.js';\r\nimport { df } from '../df.js';\r\n\r\nexport class WebCommandBar extends WebBaseUIObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"peRegion\", df.ciRegionTop);\r\n\r\n        // @privates\r\n        this._eSizer = null;\r\n        this._bIsCommandBar = true;\r\n\r\n        //  Configure super classes\r\n        this._bWrapDiv = true;\r\n        this._bRenderChildren = true;\r\n        this._sControlClass = \"WebCommandBar\";\r\n    }\r\n\r\n    addChild(oChild) {\r\n        if (oChild instanceof WebMenuBar || oChild instanceof WebToolBar) {\r\n            super.addChild(oChild);\r\n        } else {\r\n            throw new df.Error(5201, \"Invalid object structure: WebCommandBar can only contain WebMenuBar or WebToolBar objects.\", this);\r\n        }\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebCmd_Sizer\">');\r\n    }\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n\r\n    renderChildren(eContainer) {\r\n        let eToolWrap;\r\n\r\n        this._eSizer = df.dom.query(this._eElem, \"div.WebCmd_Sizer\");\r\n\r\n        //  Call children and append them to ourselves\r\n        for (let i = 0; i < this._aChildren.length; i++) {\r\n            const oChild = this._aChildren[i];\r\n\r\n            //  Check if we can actually render the object\r\n            if (oChild instanceof WebBaseUIObject) {\r\n                const eChild = oChild.render();\r\n\r\n                if (oChild instanceof WebToolBar) {\r\n                    if (!eToolWrap) {\r\n                        eToolWrap = df.dom.create('<div class=\"WebCmd_ToolWrap\"></div>');\r\n                        this._eSizer.appendChild(eToolWrap);\r\n                    }\r\n                    eToolWrap.appendChild(eChild);\r\n                } else {\r\n                    eToolWrap = null;\r\n                    this._eSizer.appendChild(eChild);\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        //this._eSizer.appendChild(df.dom.create('<div style=\"clear: both\"></div>'));\r\n    }\r\n\r\n    prepareSize() {\r\n        this._bStretch = false;\r\n\r\n        if (this._eSizer) {\r\n            this._iWantedHeight = this._eSizer.scrollHeight; // Changed to scrollheight for IE issue\r\n        }\r\n\r\n        return this._iWantedHeight;\r\n    }\r\n\r\n    setOuterHeight(iHeight) {\r\n        if (this._eElem) {\r\n            this._eElem.style.height = iHeight + \"px\";\r\n        }\r\n    }\r\n\r\n\r\n}","import { WebToolBar } from './WebToolBar.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebActionBar\r\nExtends:\r\n    df.WebToolBar\r\n\r\nThe WebActionBar is a specialized version of the toolbar that has specialized logic for placing \r\nitems in the submenu. This works using the peActionDisplay property available on cWebMenuItem. This \r\nproperty can be set to adMenu, adActionBar and adBoth controlling if an menu item is placed directly \r\nin the actionbar, in the submenu or in both (default). This is used by the action toolbar in the \r\nheader for drilldown style web applications. On overflow items set to adBoth are removed from the \r\naction bar first and after that it moves adActionBar items to the menu if really needed.\r\n    \r\nRevision:\r\n    2015/01/20  (HW, DAW)\r\n*/\r\nexport class WebActionBar extends WebToolBar {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent)\r\n\r\n        this._sControlClass += \" WebActionBar\";\r\n    }\r\n\r\n    /* \r\n    Override the function responsible for rendering the root level menu. We change it so that items are \r\n    placed in the actionbar itself or in the menu (or both) based on peActionDisplay.\r\n    \r\n    @param  aHtml   Array string builder.\r\n    @private    \r\n    */\r\n    genMenuHtml(aHtml) {\r\n        let tItm, bMenu = false;\r\n        const aMenu = this.getMenu();\r\n\r\n        for (let i = 0; i < aMenu.length; i++) {\r\n            tItm = aMenu[i];\r\n\r\n            if (!tItm.sCSSClass) {\r\n                tItm.sCSSClass = \"WebDefaultMenuItem\";\r\n            }\r\n\r\n            if (tItm.eActionDisplay === df.adBoth || tItm.eActionDisplay === df.adActionBar) {\r\n                this.genItemHtml(aHtml, tItm, true);\r\n            }\r\n\r\n            bMenu = bMenu || tItm.eActionDisplay === df.adBoth || tItm.eActionDisplay === df.adMenu;\r\n        }\r\n\r\n        aHtml.push('<li data-df-item=\"subitems\" class=\"WebMenuItem WebTlb_SubItems WebTlb_NoFit\"', (bMenu ? '' : ' style=\"display: none;\"'), '><div><span class=\"WebItm_Icon\">&nbsp;</span><a href=\"javascript: void(0);\" target=\"_self\">', this.psSubItemCaption, '</a></div><ul>');\r\n\r\n        if (bMenu) {\r\n            for (let i = 0; i < aMenu.length; i++) {\r\n                tItm = aMenu[i];\r\n\r\n                if (tItm.eActionDisplay === df.adBoth || tItm.eActionDisplay === df.adMenu) {\r\n                    this.genItemHtml(aHtml, tItm, true);\r\n                }\r\n            }\r\n        }\r\n\r\n        aHtml.push('</ul></li>');\r\n    }\r\n\r\n    /* \r\n    We override adjustWidth which is called from the WebToolBar class when the size or the menu changed. \r\n    Based on the available space we move overflowing items to the submenu. This is done in two passes \r\n    where the first only removes items that are both in the action bar and in the menu and then it moves \r\n    actionbar only items to the menu.\r\n    \r\n    @private\r\n    */\r\n    adjustWidth() {\r\n        let aItems, eItem, i;\r\n\r\n        if (this._eControl) {\r\n            const iSpace = this._eControlWrp.clientWidth;\r\n\r\n            if (this._eControl.scrollWidth > iSpace) {\r\n                aItems = df.dom.query(this._eElem, \"ul.WebBarRoot > li.WebMenuItem\", true);\r\n\r\n                if (aItems.length > 1) {\r\n\r\n\r\n                    //  Loop over items and first remove items also available in the menu\r\n                    i = aItems.length - 2;\r\n                    while (this._eControl.scrollWidth > iSpace && i >= 0) {\r\n                        eItem = aItems[i];\r\n                        if (eItem.hasAttribute(\"data-df-path\")) {\r\n                            const tItem = this.getItemByPath(eItem.getAttribute(\"data-df-path\"));\r\n\r\n                            if (tItem.eActionDisplay === df.adBoth) {\r\n                                eItem.parentNode.removeChild(eItem);\r\n                            }\r\n                        }\r\n                        i--;\r\n                    }\r\n\r\n                    //  If needed do a second pass to move actionbar only items to the menu\r\n                    if (this._eControl.scrollWidth > iSpace) {\r\n                        const eSubMen = df.dom.query(this._eControl, \"li.WebTlb_NoFit > ul\");\r\n                        aItems = df.dom.query(this._eElem, \"ul.WebBarRoot > li.WebMenuItem\", true);\r\n\r\n                        i = aItems.length - 2;\r\n                        while (this._eControl.scrollWidth > iSpace && i >= 0) {\r\n                            eItem = aItems[i];\r\n                            eSubMen.appendChild(eItem);\r\n                            i--;\r\n                        }\r\n                    }\r\n\r\n                    const eSubBtn = df.dom.query(this._eControl, \"li.WebTlb_NoFit\");\r\n                    eSubBtn.style.display = \"\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment collapseAll with the logic to remove the mask that might have been created for mobile \r\n    devices.\r\n    */\r\n    collapseAll() {\r\n        if (this._eMask) {\r\n            df.dom.off(\"click\", this._eMask, this.onMaskTouch, this);\r\n            this._eMask.parentNode.removeChild(this._eMask);\r\n            this._eMask = null;\r\n        }\r\n\r\n        super.collapseAll();\r\n    }\r\n\r\n    /* \r\n    Augment the expandItem function and insert the mask if there is actually something to expand.\r\n    \r\n    @param  tItem       Menu item.\r\n    */\r\n    expandItem(tItem) {\r\n        if (tItem && tItem.aChildren.length > 0) {\r\n            this.showMask();\r\n        }\r\n\r\n        super.expandItem(tItem);\r\n    }\r\n\r\n    /* \r\n    Augment the expandSub function and insert the mask. This function is called when the submenu is \r\n    shown.\r\n    */\r\n    expandSub() {\r\n        this.showMask();\r\n\r\n        super.expandSub();\r\n    }\r\n\r\n    /* \r\n    Inserts a mask for for mobile that intercepts the a click behind the menu.\r\n    */\r\n    showMask() {\r\n        if (df.sys.isMobile) {\r\n            this._eMask = df.dom.create('<div class=\"WebMenu_Mask\">&nbsp;</div>');\r\n\r\n            this._eElem.insertBefore(this._eMask, this._eElem.firstChild);\r\n            //document.body.appendChild(this._eMask);\r\n            df.dom.on(\"click\", this._eMask, this.onMaskTouch, this);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the click on the mask and collapses all expanded menu's.\r\n    \r\n    @param  oEvent  See df.events.DOMEvent.\r\n    */\r\n    onMaskTouch(oEvent) {\r\n        this.collapseAll();\r\n\r\n        oEvent.stop();\r\n    }\r\n\r\n}","import { WebListGroupSelector } from './weblist/WebListGroupSelector.js'\r\nimport { WebMenuColumnBase } from './WebMenuColumnBase.js'\r\n\r\n/*\r\nClass:\r\n    df.WebMenuGroupingSelector\r\nExtends:\r\n    df.WebMenuColumnBase\r\n\r\nThis class represents a menu item that displays the weblist grouping selector. It uses the WebListGroupSelector to actually render its contents.\r\n    \r\nRevision:\r\n    2023/02/23  (HW, DAW) \r\n        Initial version.\r\n*/\r\n/* global df */\r\nexport class WebMenuGroupingSelector extends WebMenuColumnBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this._oGroupingSelector = null;\r\n    }\r\n\r\n    /**\r\n     * Initializes the WebListGroupSelector.\r\n     */\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        let oL = this.getList();\r\n        if (!oL) {\r\n            throw new df.Error(999, \"WebMenuGroupingSelector could not find it's WebList.\", this);\r\n        }\r\n\r\n        this._oGroupingSelector = new WebListGroupSelector(oL);\r\n        this._oGroupingSelector.onSizeChanged.on(this.onSizeChange, this);\r\n\r\n        oL._oGrouping.registerMenuGroupingSelector(this._oGroupingSelector);\r\n    }\r\n\r\n    /**\r\n     * Handles a sizechange triggered by the WebListGroupSelector.\r\n     * \r\n     * @param {df.JSevent} oEv \r\n     */\r\n    onSizeChange(oEv) {\r\n        this.getProv()?._oMenu?.updateMenuSize();\r\n    }\r\n\r\n    /**\r\n     * Override the itemClick to do nothing.\r\n     * \r\n     * @param {Menu Item} tItem \r\n     * @param {Function} fReturn \r\n     * @param {Object} oEnv \r\n     */\r\n    itemClick(tItem, fReturn, oEnv) {\r\n\r\n    }\r\n\r\n    /**\r\n     * Override addChild to prevent child menu item from being created.\r\n     */\r\n    addChild() {\r\n        throw new df.Error(999, \"a WebMenuGroupingSelector is not supposed to have children.\", this);\r\n    }\r\n\r\n    /**\r\n     * Add extra CSS class to menu item.\r\n     * \r\n     * @returns CSS classes to be added to the menu item.\r\n     */\r\n    cssClass() {\r\n        return super.cssClass() + \" WebMenuGroupingSelector\";\r\n    }\r\n\r\n    /**\r\n     * This menu item will show if peGrouping is configured to be automatic.\r\n     * \r\n     * @returns True if the menu item should be visible.\r\n     */\r\n    visible() {\r\n        if (super.visible()) {\r\n            const oL = this.getList();\r\n            return oL.peGrouping == df.grpAutomatic;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @returns True because this item does custom rendering.\r\n     */\r\n    customRender() {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Generates placeholder HTML that we'll fill with the selector after rendering.\r\n     * \r\n     * @param {Array} aHtml Stringbuilder HTML array.\r\n     */\r\n    itemHtml(aHtml) {\r\n        aHtml.push(`<div class=\"WebMenuGrp_Placeholder\"></div>`);\r\n    }\r\n\r\n    /**\r\n     * Called when the menu item is rendered, we insert the grouping selector element.\r\n     * \r\n     * @param {DOM Element} eElem \r\n     */\r\n    itemRendered(eElem) {\r\n        if (this._oGroupingSelector && eElem) {\r\n            eElem.removeChild(eElem.firstChild);\r\n            eElem.appendChild(this._oGroupingSelector.render());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Called when the menu item is hidden.\r\n     */\r\n    itemHidden() {\r\n\r\n    }\r\n}","import { WebCardContainer } from './WebCardContainer.js';\r\nimport { WebTabPage } from './WebTabPage.js';\r\nimport { WebBaseUIObject } from './WebBaseUIObject.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebTabContainer\r\nExtends:\r\n    df.WebCardContainer\r\n\r\nThis class represents the tab container control. The WebCardContainer contains the main \r\nimplementation of the WebTabContainer only different styles are applied.\r\n    \r\nRevision:\r\n    2012/10/02  (HW, DAW)\r\n        Split into WebCardContainer and WebTabContainer.\r\n*/\r\nexport class WebTabContainer extends WebCardContainer {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n\r\n        // @privates\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebTabContainer\";\r\n        this._sCardClass = \"WebTbc\";\r\n        this._bCC = false; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        this.pbShowCaption = false;\r\n        this.pbShowBorder = false;\r\n\r\n        super.openHtml(aHtml);\r\n    }\r\n\r\n    addChild(oChild) {\r\n        if (oChild instanceof WebBaseUIObject && !(oChild instanceof WebTabPage)) {\r\n            throw new df.Error(999, \"WebTabContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebTabPage.\", this, [(oChild.getLongName() || 'oWebApp')]);\r\n        }\r\n\r\n        super.addChild(oChild);\r\n    }\r\n\r\n    set_pbShowCaption(bVal) {\r\n\r\n    }\r\n\r\n    set_pbShowBorder(bVal) {\r\n\r\n    }\r\n\r\n\r\n    /*\r\n    This method determines the height that is lost. For the tab panel this is the space that the buttons \r\n    take.\r\n    \r\n    @return The amount of pixels that can't be used by the content.\r\n    @private\r\n    */\r\n    getHeightDiff() {\r\n        let iHeight = 0;\r\n\r\n        if (this._eHead) {\r\n            iHeight += df.dom.clientHeight(this._eHead);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eHead, 1);  //  Outside difference\r\n        }\r\n\r\n        if (this.pbShowCaption && this._eLabelSpacer) {\r\n            iHeight += df.dom.clientHeight(this._eLabelSpacer);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eHead, 1);  //  Outside difference\r\n        }\r\n\r\n\r\n        if (this._eControl) {\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControl);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eInner);\r\n            iHeight += df.sys.gui.getVertBoxDiff(this._eControlWrp);\r\n        }\r\n\r\n        return iHeight;\r\n    }\r\n\r\n    // - - - - Focus  - - - - \r\n\r\n    /*\r\n    Overrides the focus method and passes the focus to the first active tab button, if there is no \r\n    active tab button we return false to indicate that it can't take the focus.\r\n    */\r\n    focus() {\r\n        let oTab;\r\n\r\n        if (this._bFocusAble && this.isEnabled() && this._eElem) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                oTab = this._aCards[i];\r\n\r\n\r\n                if (oTab.isActive() && oTab._eBtn) {\r\n                    try {\r\n                        oTab._eBtn.focus();\r\n                    } catch (oErr) {\r\n\r\n                    }\r\n\r\n                    this.objFocus();\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebImage\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the WebImage class. It renders the image (container) and \r\ncan show images based on a URL or with base64 encoded data. It has support for different display \r\nmodes like stretch and center and can show scrollbars.\r\n    \r\nRevision:\r\n    2012/06/01  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebImage extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psUrl\", \"\");\r\n        this.prop(df.tBool, \"pbScroll\", false);\r\n        this.prop(df.tInt, \"pePosition\", df.cwiActual);\r\n        this.prop(df.tBool, \"pbShowBorder\", false);\r\n        this.prop(df.tBool, \"pbFitZoom\", true);\r\n\r\n        this.event(\"OnClick\", df.cCallModeWait);\r\n        this.pbServerOnClick = false;\r\n        this.psClientOnClick = \"\";\r\n\r\n        // @privates\r\n        this._eImg = null;\r\n\r\n        this._sLastUrl = null;\r\n\r\n        this._iImageWidth = null;\r\n        this._iImageHeight = null;\r\n\r\n\r\n        this._bFocusAble = false;\r\n        this._sControlClass = \"WebImage\";\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and adds the div.WebImg_Wrp element and the img element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebImg_Wrp\"><img>');\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and closes the div.WebImg_Wrp element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and is used the get references to DOM elements, attach event \r\n    listeners and do other initialization.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebImg_Wrp\");\r\n        this._eImg = df.dom.query(this._eElem, \"div.WebImg_Wrp > img\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onClick, this);\r\n        df.dom.on(\"load\", this._eImg, this.onImageLoaded, this);\r\n\r\n        this.set_pePosition(this.pePosition);\r\n        this.set_pbShowBorder(this.pbShowBorder);\r\n        this.set_piHeight(this.piHeight);\r\n        this.updateImage();\r\n    }\r\n\r\n    // - - - - - - Public API - - - - - -\r\n\r\n    /*\r\n    The setter of psUrl will update the image that is displayed. The updateImage method is called to \r\n    actually update the image. The _sUrl property is cleared to make sure that we are not showing base64 \r\n    encoded images any more.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psUrl(sVal) {\r\n        this.psUrl = sVal;\r\n\r\n        this.updateImage();\r\n    }\r\n\r\n    /*\r\n    The setter of pbScroll enables or disabled the scrollbar. If pePosition is set to stretch it will not \r\n    enable the scrollbars and if pePosition is set to stretch horizontal it will only show the horizontal \r\n    scrollbar (if needed).\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbScroll(bVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.overflowY = (bVal && this.pePosition !== df.cwiStretch ? \"auto\" : \"hidden\");\r\n            this._eControl.style.overflowX = (bVal && this.pePosition !== df.cwiStretchHoriz && this.pePosition !== df.cwiStretch ? \"auto\" : \"hidden\");\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    The mode determines how the image is positioned. It can be centered, stretched or left top aligned \r\n    (actual). This setter method changes this behavior by manipulating CSS properties of the image \r\n    element. The center image method is called to center the image (which is a calculated process) and \r\n    the setter of pbScroll is called because it depends on the mode as well.\r\n    \r\n    @param  iVal    New value.\r\n    */\r\n    set_pePosition(iVal) {\r\n        if (this._eImg) {\r\n            this._eControl.scrollLeft = 0;\r\n            this._eControl.scrollTop = 0;\r\n\r\n            this._eImg.style.width = (iVal === df.cwiStretch || iVal === df.cwiStretchHoriz ? \"100%\" : \"\");\r\n            this._eImg.style.height = (iVal === df.cwiStretch ? \"100%\" : \"\");\r\n\r\n            this._eImg.style.marginLeft = (iVal === df.cwiCenter ? \"auto\" : \"\");\r\n            this._eImg.style.marginRight = (iVal === df.cwiCenter ? \"auto\" : \"\");\r\n            this._eImg.style.display = \"block\";\r\n            this._eImg.style.marginTop = \"\";\r\n\r\n\r\n            this.pePosition = iVal;\r\n            this.set_pbScroll(this.pbScroll);\r\n            this.centerImage();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method determines if the image is shown with a border and background. It does this by removing \r\n    or adding the \"WebImg_Box\" CSS class.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbShowBorder(bVal) {\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebImg_Box\", bVal);\r\n\r\n            if (this.pbShowBorder !== bVal) {\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Sets the tooltip on the image element. Both the alt and the title attributes are set to make it show \r\n    as a tooltip in all browser.\r\n    \r\n    @param  sVal    The new tooltip.\r\n    */\r\n    set_psToolTip(sVal) {\r\n        if (this._eImg) {\r\n            this._eImg.alt = sVal;\r\n            this._eImg.title = sVal;\r\n        }\r\n    }\r\n\r\n    // - - - - - - Rendering - - - - - -\r\n\r\n    /*\r\n    This method is called by the server to update the displayed image with a base64 encoded image. The \r\n    image is passed in the ActionData as an array of strings. The parameter specifies the mime type.\r\n    \r\n    @param  sType   The mime type of the image.\r\n    @client-action\r\n    */\r\n    // updateBase64 : function(sType){\r\n    // var i, aStr = [], aData = this._aActionData;\r\n\r\n    // if(aData.length > 0){\r\n    // aStr.push(\"data:\", sType, \";base64,\");\r\n\r\n    // for(i = 0; i < aData[0].aValues.length; i++){\r\n    // aStr.push(aData[0].aValues[i]);\r\n    // }\r\n\r\n    // this._sUrl = aStr.join('');\r\n\r\n    // this.updateImage();\r\n    // }\r\n    // }\r\n\r\n    /*\r\n    Updates the displayed image based on psUrl or _sUrl. If _sUrl is set it will use it.\r\n    \r\n    @private\r\n    */\r\n    updateImage() {\r\n        this._iImageWidth = null;\r\n        this._iImageHeight = null;\r\n\r\n        if (this._eImg) {\r\n            //  Because Chrome 36 doesn't fire the load URL after changing the src to the same URL we don't hide it in that case\r\n            if (this.psUrl !== this._sLastUrl) {\r\n                this._eImg.style.visibility = \"hidden\";\r\n            }\r\n\r\n            this._eImg.src = this.psUrl;\r\n            this._sLastUrl = this.psUrl;\r\n\r\n            this.centerImage();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method makes sure the image is centered if pePosition is set to cwiCenter. It does this by \r\n    setting the marginTop if the image is smaller in height than the available space or it sets the \r\n    scrollTop & scrollLeft if the image is bigger than the available space.\r\n    \r\n    @private\r\n    */\r\n    centerImage() {\r\n        if (this._eImg) {\r\n            //  For cwiFit we calculate the scale based on the image size and the control size\r\n            if (this.pePosition === df.cwiFit) {\r\n                if (this._iImageWidth > 0) {\r\n                    const iHorizScale = this._eControl.clientWidth / this._iImageWidth;\r\n                    const iVertScale = this._eControl.clientHeight / this._iImageHeight;\r\n\r\n                    let iScale = (iHorizScale < iVertScale ? iHorizScale : iVertScale);\r\n                    if (!this.pbFitZoom) {\r\n                        iScale = (iScale > 1 ? 1 : iScale);\r\n                    }\r\n\r\n                    if (iScale > 0) {\r\n\r\n                        this._eImg.style.width = Math.floor(this._iImageWidth * iScale) + \"px\";\r\n                    }\r\n                }\r\n            }\r\n            if (this.pePosition === df.cwiCenter || this.pePosition === df.cwiFit) {\r\n                if (this._eImg.clientHeight < this._eControl.clientHeight) {\r\n                    this._eImg.style.marginTop = Math.floor((this._eControl.clientHeight - this._eImg.clientHeight) / 2) + \"px\";\r\n                } else {\r\n                    this._eImg.style.marginTop = \"\";\r\n                    this._eControl.scrollTop = Math.floor((this._eControl.scrollHeight - this._eControl.clientHeight) / 2);\r\n                }\r\n                if (this._eImg.clientWidth < this._eControl.clientWidth) {\r\n                    this._eImg.style.marginLeft = Math.floor((this._eControl.clientWidth - this._eImg.clientWidth) / 2) + \"px\";\r\n                } else {\r\n                    this._eImg.style.marginLeft = \"\";\r\n                    this._eControl.scrollLeft = Math.floor((this._eControl.scrollWidth - this._eControl.clientWidth) / 2);\r\n                }\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Overrides the resize method and calls the centerImage.\r\n    \r\n    @private\r\n    */\r\n    resize() {\r\n        //  If the control was hidden during onImageLoaded we'll get the height now, if onImageLoaded didn't happen yet _iImageWidth should be null instead of 0\r\n        if (this._iImageWidth === 0) {\r\n            this._iImageWidth = this._eImg.clientWidth;\r\n            this._iImageHeight = this._eImg.clientHeight;\r\n        }\r\n        this.centerImage();\r\n    }\r\n\r\n    /*\r\n    Handles the onload event of the image element and centers this image.\r\n    \r\n    @private\r\n    */\r\n    onImageLoaded(oEvent) {\r\n        this._iImageWidth = this._eImg.clientWidth;\r\n        this._iImageHeight = this._eImg.clientHeight;\r\n\r\n        this.centerImage();\r\n        this._eImg.style.visibility = \"\";\r\n    }\r\n\r\n    onClick(oEvent) {\r\n        if (this.isEnabled() && this.fire('OnClick')) {\r\n            oEvent.stop();\r\n        }\r\n    }\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebRadio\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis is the client-side representation of the cWebRadio class. It renders a radio button using the \r\ninput type=\"radio\" HTML element. The psGroupName determines which radio's belong to each other so we \r\ncan use it as the name. The psMasterName determines which radio is the master control which is the \r\none that communicates to the server. All value related calls are forwarded to this master control \r\nwhich knows the other radio's.\r\n    \r\nRevision:\r\n    2012/09/06  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebRadio extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Web properties\r\n        this.prop(df.tString, \"psMasterName\", \"\");\r\n        this.prop(df.tString, \"psGroupName\", \"\");\r\n        this.prop(df.tString, \"psRadioValue\", \"\");\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n\r\n        //  Events\r\n        this.event(\"OnSelect\", df.cCallModeDefault);\r\n\r\n        // @privates\r\n        this._oMaster = null;\r\n        this._aRadios = [];\r\n        this._sPrevChangeVal = null;\r\n        this._iPrevSelected = null;\r\n        this._eCaption = null;\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebRadio\";\r\n    }\r\n\r\n    // - - - - - - - - - - - RENDERING - - - - - - - - - - - \r\n    /*\r\n    Augments openHtml and adds the radio element.\r\n    \r\n    @param  aHtml   Array string builder to add HTML to.\r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<input type=\"radio\" name=\"', this.psGroupName, '\" id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\" tabindex=\"-1\"' : ''), '><span class=\"WebR_Fake\"></span><label class=\"WebRadio_Caption\" for=\"', this._sControlId, '\"></label>');\r\n        if (this._oParent?._bIsContainer && this._oParent?.isFlowLayout()) {\r\n            aHtml.push('<div style=\"clear: both\"></div>');\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments afterRender to get a reference to the DOM element.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        const oWebApp = this.getWebApp();\r\n\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"input\");\r\n        this._eCaption = df.dom.query(this._eElem, \"label.WebRadio_Caption\");\r\n        this._eFakeBox = df.dom.query(this._eElem, \".WebR_Fake\");\r\n\r\n        this.set_psCaption(this.psCaption);\r\n        this.set_psRadioValue(this.psRadioValue);\r\n\r\n        //  Find master and register\r\n        if (this.psMasterName) {\r\n            this._oMaster = oWebApp.findObj(this.psMasterName);\r\n            this._oMaster.registerRadio(this);\r\n\r\n            this.unSync('psValue');\r\n            this.unSync('pbChanged');\r\n\r\n            //  Take the value from the master as the master should have the right value, the WebBaseDEO.afterRender will call the set_psValue which will try to select the right radio now that this one is registered as well\r\n            this.psValue = this._oMaster.psValue;\r\n        } else {\r\n            this.registerRadio(this);\r\n        }\r\n\r\n        //  Call super\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onClick, this);\r\n        df.dom.on(\"click\", this._eFakeBox, this.onFakeClick, this);\r\n    }\r\n\r\n    // - - - - - - - - - - - PUBLIC API - - - - - - - - - - - \r\n    /*\r\n    Augment the getter for pbChanged and forward it to the master radio.\r\n    \r\n    @return True if the value is changed.\r\n    */\r\n    get_pbChanged() {\r\n        if (this._oMaster) {\r\n            return this._oMaster.get_pbChanged();\r\n        }\r\n        return super.get_pbChanged();\r\n    }\r\n\r\n    /*\r\n    Augment the setter for psValue and forward it to the master radio.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psValue(sVal) {\r\n        \r\n        if (this._oMaster) {\r\n            this._oMaster.set_psValue(sVal);\r\n        } else {\r\n            super.set_psValue(sVal);\r\n\r\n            //  Update _iPrevSelected\r\n            for (let i = 0; i < this._aRadios.length; i++) {\r\n                if (this._aRadios[i]._eControl.checked) {\r\n                    this._iPrevSelected = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augment the getter for psValue and forward it to the master radio.\r\n    \r\n    @return The current value.\r\n    */\r\n    get_psValue() {\r\n        if (this._oMaster) {\r\n            return this._oMaster.get_psValue();\r\n        }\r\n        return super.get_psValue();\r\n    }\r\n\r\n    /*\r\n    Update the DOM with the new psRadioValue value so that direct DOM access will work properly.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psRadioValue(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.value = sVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Update the DOM with the new caption. If the caption really changed we trigger a resize using sizeChanged.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eCaption) {\r\n            df.dom.setText(this._eCaption, sVal);\r\n\r\n            if (this.psCaption !== sVal) {\r\n                this.sizeChanged();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Overrides setter for psTextColor so the color is set on the caption.\r\n    \r\n    @param  sVal    The new value.\r\n    @private\r\n    */\r\n    set_psTextColor(sVal) {\r\n        if (this._eCaption) {\r\n            this._eCaption.style.color = sVal || '';\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the psTooltip with fakebox element support.\r\n    \r\n    @param  sVal    The new tooltip.\r\n    @private\r\n    */\r\n    set_psToolTip(sVal) {\r\n        super.set_psToolTip(sVal);\r\n        if (this._eFakeBox) {\r\n            this._eFakeBox.title = sVal;\r\n        }\r\n    }\r\n\r\n    // - - - - - - - - - - - SUPPORTIVE - - - - - - - - - - - \r\n\r\n    /*\r\n    This method is called by the WebBaseDEO logic when the value needs to be read from the user \r\n    interface. The checkbox overrides the default behavior and returns psChecked or psUnchecked \r\n    depending on the state of the checkbox element.\r\n    \r\n    @return The currently displayed value.\r\n    @private\r\n    */\r\n    getControlValue() {\r\n\r\n        if (this._oMaster) {\r\n            return this._oMaster.getControlValue();\r\n        }\r\n        for (let i = 0; i < this._aRadios.length; i++) {\r\n            if (this._aRadios[i]._eControl.checked) {\r\n                return this._aRadios[i].psRadioValue;\r\n            }\r\n        }\r\n\r\n        return this.psValue;\r\n\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebBaseDEO logic when the user interface needs to be updated with a new \r\n    value. When sVal is equal to psChecked we display the checkbox as checked.\r\n    \r\n    @param  sVal    The new value to display.\r\n    */\r\n    setControlValue(sVal) {\r\n        \r\n        if (this._oMaster) {\r\n            return this._oMaster.setControlValue(sVal);\r\n        }\r\n\r\n        if (!(this._aRadios[this._iPrevSelected] && this._aRadios[this._iPrevSelected]._eControl.checked && this._aRadios[this._iPrevSelected].psRadioValue === sVal)) {\r\n            for (let i = 0; i < this._aRadios.length; i++) {\r\n                if (this._aRadios[i].psRadioValue === sVal) {\r\n                    this._aRadios[i]._eControl.checked = true;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called by the slave radio controls to register them.\r\n    \r\n    @param  oRadio  The slave radio control.\r\n    @private\r\n    */\r\n    registerRadio(oRadio) {\r\n        this._aRadios.push(oRadio);\r\n    }\r\n\r\n    /*\r\n    This method overrides the fireChange method because radio controls are a special case. The call is \r\n    forwarded to the master radio which will trigger the OnChange event on all the radios in the group. \r\n    The OnSelect event is triggered on the radio control that is now the selected one.\r\n    \r\n    @private\r\n    */\r\n    fireChange() {\r\n        \r\n        //  The master handles this\r\n        if (this._oMaster) {\r\n            return this._oMaster.fireChange();\r\n        }\r\n\r\n        //  Check the new value\r\n        this.updateTypeVal();\r\n        const sNewVal = this.getServerVal();\r\n\r\n        //  Fire events (OnChange on every radio and OnSelect on the selected one)\r\n        for (let i = 0; i < this._aRadios.length; i++) {\r\n            if (this._sPrevChangeVal !== sNewVal) {\r\n                this._aRadios[i].fire('OnChange', [sNewVal, this._sPrevChangeVal]);\r\n            }\r\n\r\n            if (this._aRadios[i]._eControl.checked && i !== this._iPrevSelected) {\r\n                this._aRadios[i].fire('OnSelect');\r\n                this._iPrevSelected = i;\r\n            }\r\n        }\r\n\r\n        //  Remember the value\r\n        this._sPrevChangeVal = sNewVal;\r\n    }\r\n\r\n    /*\r\n    Event handler for the click event that triggers the check for the onchange event.\r\n    \r\n    @param  oEvent  Event details object.\r\n    @private\r\n    */\r\n    onClick(oEvent) {\r\n        this.fireChange();\r\n    }\r\n\r\n    /* \r\n    Handles the click on the fake radio element. Toggles the state and fires OnChange.\r\n    \r\n    @param  oEvent  Event details.\r\n    @private\r\n     */\r\n    onFakeClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.focus();\r\n            this._eControl.checked = true;\r\n\r\n            this.fireChange();\r\n        }\r\n    }\r\n}","import { WebBaseDEO } from './WebBaseDEO.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebSlider\r\nExtends:\r\n    df.WebBaseDEO\r\n\r\nThis is the client-side representation of the cWebSlider class. It is able to display\r\na slider with labels and a ranged slider\r\n    \r\nRevision:\r\n    2012/09/05  (RH, DAE) \r\n        Initial version.\r\n    2013/02/13  (HW, DAW)\r\n        Refactored, implemented design, finished.\r\n*/\r\nexport class WebSlider extends WebBaseDEO {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piMinValue\", 1);\r\n        this.prop(df.tInt, \"piMaxValue\", 10);\r\n        this.prop(df.tInt, \"piSliderValue\", 1);\r\n        this.prop(df.tInt, \"piInterval\", 1);\r\n\r\n        this.prop(df.tBool, \"pbVertical\", false);\r\n        this.prop(df.tInt, \"piHeight\", 0);\r\n\r\n        this.prop(df.tBool, \"pbShowMarkers\", false);\r\n        this.prop(df.tInt, \"piMaxMarkers\", 101);\r\n        this.prop(df.tBool, \"pbRanged\", false);\r\n        this.prop(df.tInt, \"piSliderStart\", 0);\r\n        this.prop(df.tInt, \"piFrom\", 1);\r\n        this.prop(df.tInt, \"piTo\", 3);\r\n        this.prop(df.tBool, \"pbShowValue\", true);\r\n        this.prop(df.tBool, \"pbShowRange\", false);\r\n        this.prop(df.tBool, \"pbMouseWheelScroll\", true);\r\n\r\n        // @privates\r\n        this._eSlider = null;\r\n        this._eSliderWrp = null;\r\n        this._eSliderBar = null;\r\n        this._eControl = null;\r\n        this._eLabels = null;\r\n        this._eValueIndicator = null;\r\n        this._bSelected = false;\r\n        this._bFocus = false;\r\n        this._eRangedSlider = null;\r\n\r\n        this._iValueInterval = 0;\r\n        this._aLabels = [];\r\n        this._aMarkers = [];\r\n        this._iPrevChangePos = 1;\r\n        this._iPrevChangeFrom = 0;\r\n        this._iPrevChangeTo = 0;\r\n\r\n        //  Configure super classes\r\n        this.unSync(\"psValue\");\r\n        this._sControlClass = \"WebSlider\";\r\n    }\r\n\r\n        /*\r\n    Do initializations based on the initial values of the web properties.\r\n    */\r\n    create(tDef) {\r\n        super.create(tDef);\r\n\r\n        //  We automatically correct wrong initial piSliderValue\r\n        if (this.piSliderValue < this.piMinValue) {\r\n            this.piSliderValue = this.piMinValue;\r\n        } else if (this.piSliderValue > this.piMaxValue) {\r\n            this.piSliderValue = this.piMaxValue;\r\n        }\r\n        this._iPrevChangePos = this.piSliderValue;\r\n\r\n        //  Validate properties\r\n        this.assertions();\r\n        if (this.piSliderValue > this.piMaxValue) {\r\n            this.piSliderValue = this.piMaxValue;\r\n        } else if (this.piSliderValue < this.piMinValue) {\r\n            this.piSliderValue = this.piMinValue;\r\n        }\r\n\r\n        //  Make sure properties are being synchronized\r\n        if (this.pbRanged) {\r\n            this.addSync(\"piFrom\");\r\n            this.addSync(\"piTo\");\r\n        } else {\r\n            this.addSync(\"piSliderValue\");\r\n        }\r\n    }\r\n\r\n    //--------Main element functions --------\r\n    /*\r\n    This function adds the slider element to the aHtml param.\r\n    \r\n    Params:\r\n        aHtml   Array string builder to add HTML to.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        // This will be used to show the current value of the slider\r\n        if (this.pbShowValue) {\r\n            aHtml.push('<div class=\"WebSlider_ValueIndicatorWrapper\">1</div>');\r\n        }\r\n\r\n        aHtml.push('<div class=\"WebSlider_Wrapper',\r\n            (this.pbVertical ? ' WebSlider_Vertical' : ' WebSlider_Horizontal'),\r\n            (this.pbRanged ? ' WebSlider_Range' : ' WebSlider_NoRange'), '\" ',\r\n            (!this.isEnabled() ? 'tabindex=\"-1\"' : 'tabindex=\"0\"'), '>');\r\n\r\n        //  BAR\r\n        aHtml.push('<div class=\"WebSlider_BarWrapper\">');\r\n        aHtml.push('<div class=\"WebSlider_Bar\">');\r\n        aHtml.push('<div class=\"WebSlider_InnerBar\">');\r\n\r\n        //If the range should be shown\r\n        if (this.pbShowRange) {\r\n            aHtml.push('<div class=\"WebSlider_ShowRange\"></div>');\r\n        }\r\n        aHtml.push('</div></div>');\r\n        aHtml.push('</div>');\r\n\r\n        //Add a wrapper for the labels and let another function create the HTML for the labels\r\n        aHtml.push('<div class=\"WebSlider_Labels\">');\r\n        this.generateMarkers();\r\n\r\n        this.renderLabels(aHtml);\r\n        aHtml.push('</div>');\r\n\r\n\r\n        //  SLIDER\r\n        aHtml.push('<div class=\"WebSlider_SliderWrapper\">');\r\n        aHtml.push('<div class=\"WebSlider_Slider\"></div>');\r\n\r\n        if (this.pbRanged) {\r\n            aHtml.push('<div class=\"WebSlider_SliderRanged WebSlider_Slider\"></div>');\r\n        }\r\n\r\n\r\n\r\n        aHtml.push('</div>');\r\n\r\n\r\n    }\r\n\r\n    /*\r\n    This method adds the a element making the next element come on the next line\r\n    and closes the slider element to the aHtml param.\r\n    \r\n    Params:\r\n        aHtml   Array string builder to add HTML to.\r\n        \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    /*\r\n    This method gets the needed references, sets the needed eventlisteners \r\n    and positions the slider element to the start position.\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"div.WebSlider_Wrapper\");\r\n        this._eSlider = df.dom.query(this._eElem, \"div.WebSlider_Slider\");\r\n        this._eSliderWrp = df.dom.query(this._eElem, \"div.WebSlider_SliderWrapper\");\r\n        this._eSliderBar = df.dom.query(this._eElem, \"div.WebSlider_Bar\");\r\n        this._eSliderBarWrp = df.dom.query(this._eElem, \"div.WebSlider_BarWrapper\");\r\n        this._eSliderBarInner = df.dom.query(this._eElem, \"div.WebSlider_InnerBar\");\r\n        this._eLabels = df.dom.query(this._eElem, \"div.WebSlider_Labels\");\r\n        this._eValueIndicator = df.dom.query(this._eElem, \"div.WebSlider_ValueIndicatorWrapper\");\r\n\r\n        //Get the reference for the ranged slider if this is a ranged slider\r\n        if (this.pbRanged) {\r\n            this._eRangedSlider = df.dom.query(this._eElem, \"div.WebSlider_SliderRanged\");\r\n        }\r\n\r\n        if (this.pbShowRange) {\r\n            this._eRangeIndicator = df.dom.query(this._eElem, \"div.WebSlider_ShowRange\");\r\n        }\r\n\r\n\r\n        //  Call super\r\n        super.afterRender();\r\n\r\n        //  Update display\r\n        this.updateDisplay();\r\n\r\n        //   Attatch slider events\r\n        if (window.PointerEvent) {    //  Microsofts new standard adopted by W3C for touch / mouse & pen events as of IE11\r\n            df.dom.on(\"pointerdown\", this._eControl, this.onPointerDown, this);\r\n        } else {\r\n            df.dom.on(\"touchstart\", this._eControl, this.onTouchDown, this);\r\n        }\r\n\r\n        df.events.addDomMouseWheelListener(this._eSliderWrp, this.onMouseWheelScroll, this);\r\n        if (this.pbRanged) {\r\n            df.dom.on(\"mousedown\", this._eRangedSlider, this.onMouseDown, this);\r\n        }\r\n        df.dom.on(\"mousedown\", this._eSlider, this.onMouseDown, this);\r\n\r\n        df.dom.on(\"click\", this._eLabels, this.onLabelClick, this);\r\n        df.dom.on(\"click\", this._eControl, this.onSliderClick, this);\r\n        // df.events.removeDomKeyListener(this._eControl, this.onKey, this);\r\n\r\n    }\r\n\r\n    //-----------Label functions-------------\r\n\r\n    assertions() {\r\n        if (this.piInterval <= 0) {\r\n            throw new df.Error(999, \"The piInterval needs to be a positive number\", this);\r\n        }\r\n\r\n        //Check for errors\r\n        if (this.piMaxValue === this.piMinValue) {\r\n            throw new df.Error(999, \"Please specify a Max and a Min value\", this);\r\n        } else if (this.piMaxValue < this.piMinValue) {\r\n            throw new df.Error(999, \"The max value is smaller then the min value\", this);\r\n        }\r\n        //Check if the piMaxValue, piMinValue and intervall add up\r\n        if ((this.piMaxValue - this.piMinValue) % this.piInterval > 0) {\r\n            throw new df.Error(999, \"Your maximum, minimum and interval value do not match properly\", this);\r\n        }\r\n\r\n        //Check if the specified piSliderValue is within the range of the piMaxValue and the piMinValue\r\n        //Check if the slider is able to reach the specified piSliderValue with the current piInterval\r\n        if (this.piSliderValue < this.piMinValue || this.piSliderValue > this.piMaxValue) {\r\n            throw new df.Error(999, \"Please specify the piSliderValue with a number between the piMinValue and piMaxValue\", this);\r\n        } else if ((this.piSliderValue - this.piMinValue) % this.piInterval > 0 || (this.piMaxValue - this.piSliderValue) % this.piInterval > 0) {\r\n            throw new df.Error(999, \"The piSliderValue value is unreachable with the specified interval.\", this);\r\n        }\r\n\r\n        if (this.pbRanged) {\r\n            //Check if the specified piFrom and piTo are within the range of the piMaxValue and the piMinValue\r\n            //Check if the slider is able to reach the specified piFrom and piTo with the current piInterval\r\n            if (this.piFrom < this.piMinValue || this.piFrom > this.piMaxValue) {\r\n                throw new df.Error(999, \"Please specify the piFrom with a number between the piMinValue and piMaxValue\", this);\r\n            } else if (this.piTo < this.piMinValue || this.piTo > this.piMaxValue) {\r\n                throw new df.Error(999, \"Please specify the piTo with a number between the piMinValue and piMaxValue\", this);\r\n            } else if ((this.piFrom - this.piMinValue) % this.piInterval > 0 || (this.piMaxValue - this.piFrom) % this.piInterval > 0) {\r\n                throw new df.Error(999, \"The piRangedValue value is unreachable with the specified interval.\", this);\r\n            } else if ((this.piTo - this.piMinValue) % this.piInterval > 0 || (this.piMaxValue - this.piTo) % this.piInterval > 0) {\r\n                throw new df.Error(999, \"The piTo value is unreachable with the specified interval.\", this);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    We override this method because the form has an extra wrapper of which the Box Difference needs to \r\n    be taken into account.\r\n    \r\n    @private\r\n    */\r\n    getVertHeightDiff() {\r\n        let iResult = super.getVertHeightDiff();\r\n        if (this._eValueIndicator && this.pbVertical) {\r\n            iResult += this._eValueIndicator.offsetHeight;\r\n        }\r\n        return iResult;\r\n    }\r\n\r\n    /*\r\n    This function repositions the labels and sliders to the new dimentions of the element.\r\n    \r\n    Params:\r\n        oEvent  The event object which fired this function.\r\n    */\r\n    resize(oEvent) {\r\n        this.positionLabels();\r\n        this.updateDisplay();\r\n    }\r\n\r\n    /*\r\n    This method updates the currently displayed valued based on the properties. It will move the \r\n    slider(s), range and updates the value indicator.\r\n    \r\n    @private\r\n    */\r\n    updateDisplay() {\r\n        let nOffset, nWidth;\r\n\r\n        if (this._eElem) {\r\n            const nStep = this.getInterval() / this.piInterval;\r\n\r\n            if (this.pbRanged) {\r\n                //  Update the slider positions\r\n                const nFrom = nStep * (this.piFrom - this.piMinValue);\r\n                const nTo = nStep * (this.piTo - this.piMinValue);\r\n                if (this.pbVertical) {\r\n                    this._eRangedSlider.style.top = nFrom + \"px\";\r\n                    this._eSlider.style.top = nTo + \"px\";\r\n                } else {\r\n                    this._eRangedSlider.style.left = nFrom + \"px\";\r\n                    this._eSlider.style.left = nTo + \"px\";\r\n                }\r\n\r\n                //  Update the value indicator\r\n                if (this.pbShowValue) {\r\n                    this._eValueIndicator.innerHTML = this.piFrom + \"-\" + this.piTo;\r\n                }\r\n\r\n                //  Update range indicator\r\n                if (this.pbShowRange) {\r\n                    if (this.pbVertical) {\r\n                        this._eRangeIndicator.style.top = nFrom + \"px\";\r\n                        this._eRangeIndicator.style.height = (nTo - nFrom) + \"px\";\r\n                    } else {\r\n                        this._eRangeIndicator.style.left = nFrom + \"px\";\r\n\r\n                        nWidth = nTo - nFrom;\r\n                        nWidth = (nWidth < 0 ? -nWidth : nWidth);\r\n                        this._eRangeIndicator.style.width = nWidth + \"px\";\r\n                    }\r\n                }\r\n            } else {\r\n                //  Update the slider position\r\n                nOffset = nStep * (this.piSliderValue - this.piMinValue);\r\n                if (this.pbVertical) {\r\n                    this._eSlider.style.top = nOffset + \"px\";\r\n                } else {\r\n                    this._eSlider.style.left = nOffset + \"px\";\r\n                }\r\n\r\n                //  Update the value indicator\r\n                if (this.pbShowValue) {\r\n                    this._eValueIndicator.innerHTML = this.piSliderValue;\r\n                }\r\n\r\n                //  Update range indicator\r\n                if (this.pbShowRange) {\r\n                    if (this.pbVertical) {\r\n                        this._eRangeIndicator.style.top = \"0px\";\r\n                        this._eRangeIndicator.style.height = nOffset + \"px\";\r\n                    } else {\r\n                        this._eRangeIndicator.style.left = \"0px\";\r\n                        nOffset = nOffset < 0 ? -nOffset : nOffset;\r\n                        this._eRangeIndicator.style.width = nOffset + \"px\";\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Client action that is called by the server to update the labels with a new set of labels. We update \r\n    the labels array, regenerate the markers array and update the display.\r\n    \r\n    @client-action\r\n    */\r\n    fillLabels() {\r\n        if (this._tActionData) {\r\n            this._aLabels = df.sys.vt.deserialize(this._tActionData, [{ sN: df.tString, sV: df.tString }]);\r\n\r\n            this.generateMarkers();\r\n            this.updateLabels();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function generates the array of markers based on the all the properties (pbShowMarkers, \r\n    piInterval, piMaxValue, piMinValue) and the array of labels.\r\n    */\r\n    generateMarkers() {\r\n        var oLabel, iNumberOfIntervals, iInterval;\r\n        const aData = this._aLabels;\r\n\r\n        //  Clear values array\r\n        this._aMarkers = [];\r\n\r\n        //  Create the indicators and add them to the _aLabel array\r\n        if (this.pbShowMarkers) {\r\n\r\n            //  Deterine the number of markers\r\n            iNumberOfIntervals = this.piMaxMarkers;\r\n            const iDevide = (this.piMaxValue - this.piMinValue) / (iNumberOfIntervals - 1);\r\n\r\n            if (iDevide < this.piInterval) {  //  More markers that possible values\r\n                iInterval = this.piInterval;\r\n            } else {  //  More values than markers allowed, no find the right number of markers where markers are placed at possible values and there is a marker at the max and min value\r\n                iInterval = this.piInterval;\r\n                while (iInterval < iDevide || ((this.piMaxValue - this.piMinValue) % iInterval)) {\r\n                    iInterval += this.piInterval;\r\n                }\r\n            }\r\n            iNumberOfIntervals = (this.piMaxValue - this.piMinValue) / iInterval;\r\n\r\n            //  Gernate & store the markers\r\n            for (let i = 0; i <= iNumberOfIntervals; i++) {\r\n                oLabel = {};\r\n                oLabel.piSliderValue = iInterval * i + this.piMinValue;\r\n                oLabel.psLabel = \"\";\r\n                this._aMarkers.push(oLabel);\r\n            }\r\n        }\r\n\r\n        //  Transform raw data into value / description objects\r\n        if (aData) {\r\n            for (let i = 0; i < aData.length; i++) {\r\n                oLabel = {};\r\n                oLabel.piSliderValue = parseFloat(aData[i].sV, 10);\r\n                oLabel.psLabel = aData[i].sN;\r\n                if (oLabel.piSliderValue % this.piInterval === 0 && oLabel.piSliderValue <= this.piMaxValue && oLabel.piSliderValue >= this.piMinValue) {\r\n                    this._aMarkers.push(oLabel);\r\n                }\r\n            }\r\n        }\r\n        //Remove the indicators where a label is also specified, sort, and update the DOM the array.\r\n        this._aMarkers = this._aMarkers.sort(this.sortLabels);\r\n        this._aMarkers = this.removeDoubleValues(this._aMarkers);\r\n    }\r\n\r\n    /*\r\n    This function is used by the sort function. This function determines whether\r\n    a label object is greater then, smaller then or equal to another label.\r\n    \r\n    Params:\r\n        a   The element to compare with b.\r\n        b   The element to compare with a.\r\n    Returns:\r\n        0 if the two elements are equal, 1 if a is greater then b, or -1 is b is greater then a.\r\n    */\r\n    sortLabels(a, b) {\r\n        if (a.piSliderValue < b.piSliderValue) {\r\n            return -1;\r\n        }\r\n        if (a.piSliderValue > b.piSliderValue) {\r\n            return 1;\r\n        }\r\n        if (a.piSliderValue === b.piSliderValue) {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function removes the possible double labels.\r\n    \r\n    Params:\r\n        aLabels   The labels array to remove the double labels from.\r\n    Returns:\r\n        The labels array without the double labels.\r\n    */\r\n    removeDoubleValues(aLabels) {\r\n        const iDummyArray = [];\r\n\r\n        for (let i = 0; i < aLabels.length; i++) {\r\n            if (i + 1 === aLabels.length) {\r\n                iDummyArray.push(aLabels[i]);\r\n            } else {\r\n                if (aLabels[i].piSliderValue === aLabels[i + 1].piSliderValue) {\r\n                    if (aLabels[i].psLabel.length > aLabels[i + 1].psLabel.length) {\r\n                        iDummyArray.push(aLabels[i]);\r\n                    } else {\r\n                        iDummyArray.push(aLabels[i + 1]);\r\n                    }\r\n                    i++;\r\n                } else {\r\n                    iDummyArray.push(aLabels[i]);\r\n                }\r\n            }\r\n        }\r\n        return iDummyArray;\r\n    }\r\n\r\n    /*\r\n    This function creates the HTML for the labels\r\n    \r\n    Params:\r\n        aHtml   Array string builder to add HTML to.\r\n    */\r\n    renderLabels(aHtml) {\r\n\r\n        aHtml.push('<div class=\"WebSlider_LabelMarkerWrapper\"', (this._aLabels.length === 0 && !this.pbShowMarkers ? ' style=\"display: none;\"' : ''), '>');\r\n        for (let i = 0; i < this._aMarkers.length; i++) {\r\n            //The data-labelIndex indicates the position of the label in the _aMarkers array\r\n            //needed for a reference later on.\r\n            aHtml.push('<div class=\"WebSlider_LabelMarker\" data-labelIndex=\"', i, '\"></div>');\r\n        }\r\n\r\n\r\n        aHtml.push('</div><div class=\"WebSlider_LabelWrapper\"', (this._aLabels.length === 0 ? ' style=\"display: none;\"' : ''), '>');\r\n\r\n        for (let i = 0; i < this._aMarkers.length; i++) {\r\n            //The data-labelIndex indicates the position of the label in the _aMarkers array\r\n            //needed for a reference later on.        \r\n            if (this._aMarkers[i].psLabel !== '') {\r\n                aHtml.push('<div class=\"WebSlider_LabelText\" data-labelIndex=\"', i, '\">', this._aMarkers[i].psLabel, '</div>');\r\n            }\r\n        }\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    positionLabels() {\r\n        let iNewPosition, nRel, nSliderOffset;\r\n\r\n        const iIntervalSize = (this.getInterval() / this.piInterval);\r\n        const aLabels = df.dom.query(this._eLabels, \"div.WebSlider_LabelText\", true);\r\n        const aMarkers = df.dom.query(this._eLabels, \"div.WebSlider_LabelMarker\", true);\r\n\r\n        if (this.pbVertical) {\r\n            nSliderOffset = this._eSlider.offsetHeight / 2;\r\n        } else {\r\n            nSliderOffset = this._eSlider.offsetWidth / 2;\r\n        }\r\n\r\n\r\n        //Calculate the new position for each labelMarker\r\n        for (let i = 0; i < aMarkers.length; i++) {\r\n            iNewPosition = 0;\r\n\r\n            iNewPosition = nSliderOffset + iIntervalSize * (this._aMarkers[i].piSliderValue - this.piMinValue);\r\n\r\n            if (this.pbVertical) {\r\n                aMarkers[i].style.top = iNewPosition + \"px\";\r\n            } else {\r\n                aMarkers[i].style.left = iNewPosition + \"px\";\r\n            }\r\n        }\r\n\r\n\r\n\r\n        //Calculate the new position for each label\r\n        for (let i = 0; i < aLabels.length; i++) {\r\n            iNewPosition = 0;\r\n            const iValue = this._aMarkers[aLabels[i].getAttribute(\"data-labelIndex\")].piSliderValue;\r\n\r\n\r\n            iNewPosition = nSliderOffset + iIntervalSize * (iValue - this.piMinValue);\r\n            if (this.pbVertical) {\r\n                iNewPosition = iNewPosition - (aLabels[i].offsetHeight / 2);\r\n                aLabels[i].style.top = iNewPosition + \"px\";\r\n            } else {\r\n                // Calculate percentage of the label width we want to move the label horizontally\r\n                nRel = (iValue - this.piMinValue) / (this.piMaxValue - this.piMinValue);\r\n                nRel = ((nRel - 0.5) * 0.6) + 0.5; // We want to go slightly over the sides\r\n\r\n                // Decrease with percentage of label width\r\n                iNewPosition = iNewPosition - (nRel * aLabels[i].offsetWidth);\r\n\r\n                aLabels[i].style.left = iNewPosition + \"px\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This function re-renders the labels if it is not the initial call.\r\n    The inital call already does this, therefore doing this twice is redundant.\r\n    */\r\n    updateLabels() {\r\n        const aNewLabels = [];\r\n\r\n        //Check for inital call\r\n        if (this._eElem) {\r\n            this.renderLabels(aNewLabels);\r\n            this._eLabels.innerHTML = aNewLabels.join(\"\");\r\n            //Call the resize function to put the labels neatly in theire place\r\n            this.positionLabels();\r\n        }\r\n    }\r\n\r\n    //----- Helper functions --------\r\n\r\n    /*\r\n    This function positively or negatively increments the position of the slider and the value.\r\n    \r\n    Params:\r\n        bUp     True if the slider should be positively incremented, false if the slider should be negatively incremented.\r\n        bSize   If true on a ranged slider it will increase the size of the range where false would move the range.\r\n    */\r\n    increment(bUp, bSize) {\r\n        if (this.pbRanged) {\r\n            if (bSize) {\r\n                if (bUp) {\r\n                    if (this.piTo < this.piMaxValue) {\r\n                        this.piTo += this.piInterval;\r\n                    } else if (this.piFrom > this.piMinValue) {\r\n                        this.piFrom -= this.piInterval;\r\n                    }\r\n                } else {\r\n                    if (this.piFrom < this.piTo) {\r\n                        this.piTo -= this.piInterval;\r\n                    }\r\n                }\r\n            } else {\r\n                if (bUp) {\r\n                    if (this.piTo < this.piMaxValue) {\r\n                        this.piTo += this.piInterval;\r\n                        this.piFrom += this.piInterval;\r\n                    }\r\n                } else {\r\n                    if (this.piFrom > this.piMinValue) {\r\n                        this.piTo -= this.piInterval;\r\n                        this.piFrom -= this.piInterval;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            if (bUp && this.piSliderValue !== this.piMaxValue) {\r\n                this.piSliderValue += this.piInterval;\r\n            } else if (!bUp && this.piSliderValue !== this.piMinValue) {\r\n                this.piSliderValue -= this.piInterval;\r\n            }\r\n        }\r\n\r\n        this.updateDisplay();\r\n        this.fireChange();\r\n    }\r\n\r\n    /*\r\n    This method calculates the ammount of pixels each increment represents.\r\n    \r\n    @return The amount of pixels.\r\n    */\r\n    getInterval() {\r\n        //Calculate the ammount of pixels\r\n        const iSliderSize = (this.pbVertical) ? this._eSliderBarInner.offsetHeight : this._eSliderBarInner.offsetWidth;\r\n\r\n        const iValueInterval = iSliderSize / ((this.piMaxValue - this.piMinValue) / this.piInterval);\r\n\r\n        return iValueInterval;\r\n    }\r\n\r\n    /*\r\n    This method converts any value to a positive value.\r\n    \r\n    Params:\r\n        iValue    The value to be converted to positive.\r\n    Returns:\r\n        The positive value\r\n    */\r\n    toPositive(iValue) {\r\n        iValue = Math.sqrt(Math.pow(iValue, 2));\r\n        return iValue;\r\n    }\r\n\r\n    /*\r\n    This method calculates the maximal position the slider can be in.\r\n    \r\n    Returns:\r\n        The maximal position value for the slider\r\n    */\r\n    getMaximalSliderPosition() {\r\n        let iSliderSize;\r\n        if (this.pbVertical) {\r\n            iSliderSize = this._eSliderBarInner.offsetHeight;\r\n        } else {\r\n            iSliderSize = this._eSliderBarInner.offsetWidth;\r\n        }\r\n        return iSliderSize;\r\n    }\r\n\r\n    /*\r\n    When a label is clicked this function jumps the slider to the corresponding place.\r\n    \r\n    Params:\r\n        oEvent  The event object causing the function to go off.\r\n    */\r\n    onLabelClick(oEvent) {\r\n        let eLabel = oEvent.getTarget();\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        while (eLabel.getAttribute(\"data-labelindex\") === null || eLabel === document) {\r\n            eLabel = eLabel.parentNode;\r\n\r\n            if (eLabel === document) {\r\n                return;\r\n            }\r\n        }\r\n        this.piSliderValue = this._aMarkers[eLabel.getAttribute(\"data-labelIndex\")].piSliderValue;\r\n        this.updateDisplay();\r\n\r\n        this.fireChange();\r\n\r\n        this.onFocus();\r\n    }\r\n\r\n\r\n    //---------Event handlers=--------------\r\n\r\n    /*\r\n    Handles the onMouseDown event and initiates the slide.\r\n    \r\n    Params:\r\n        oEvent  The event object causing the function to go off.\r\n    */\r\n    onMouseDown(oEvent) {\r\n        this.slide(0, (this._eRangedSlider === oEvent.eSource && this.pbRanged), oEvent);\r\n    }\r\n\r\n    /* \r\n    Handles the W3C pointerdown event and initiates the slide if a touch / pen down was close enough to \r\n    one of the sliders.    \r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    */\r\n    onPointerDown(oEvent) {\r\n        let tRec;\r\n        const iD = 10;\r\n\r\n        if (oEvent.e.pointerType === \"pen\" || oEvent.e.pointerType === \"touch\") {\r\n\r\n            //  Determine based on pixel positions if the touch was close enough (within 10 pixels) to one of the sliders\r\n            const iX = oEvent.e.clientX;\r\n            const iY = oEvent.e.clientY;\r\n\r\n            tRec = this._eSlider.getBoundingClientRect();\r\n\r\n            if (iX > (tRec.left - iD) && iX < (tRec.right + iD) && iY > (tRec.top - iD) && iY < (tRec.bottom + iD)) {\r\n                //  Initiate slide on regular slider\r\n                this.slide(1, false, oEvent);\r\n            } else if (this.pbRanged) {\r\n                tRec = this._eRangedSlider.getBoundingClientRect();\r\n\r\n                if (iX > (tRec.left) - iD && iX < (tRec.right + iD) && iY > (tRec.top - iD) && iY < (tRec.bottom + iD)) {\r\n                    //  Initiate slide on range slider\r\n                    this.slide(1, true, oEvent);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the touchdown event (webkit) and if the touch was close enough to one of the sliders it \r\n    initiates the generic slide logic.    \r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    */\r\n    onTouchDown(oEvent) {\r\n        let tRec;\r\n        const iD = 10;\r\n\r\n        //  Determine based on pixel positions if the touch was close enough (within 10 pixels) to one of the sliders\r\n        const iX = oEvent.e.targetTouches[0].clientX;\r\n        const iY = oEvent.e.targetTouches[0].clientY;\r\n\r\n        tRec = this._eSlider.getBoundingClientRect();\r\n\r\n        if (iX > (tRec.left) - iD && iX < (tRec.right + iD) && iY > (tRec.top - iD) && iY < (tRec.bottom + iD)) {\r\n            //  Initiate slide on regular slider\r\n            this.slide(2, false, oEvent);\r\n        } else if (this.pbRanged) {\r\n            tRec = this._eRangedSlider.getBoundingClientRect();\r\n\r\n            if (iX > (tRec.left) - iD && iX < (tRec.right + iD) && iY > (tRec.top - iD) && iY < (tRec.bottom + iD)) {\r\n                //  Initiate slide on range slider\r\n                this.slide(2, true, oEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the mousewheel scroll event and increments / decrements the slider value when it happens.\r\n    \r\n    @param  oEvent  DOM Event object (df.events.DomEvent)\r\n    @private\r\n    */\r\n    onMouseWheelScroll(oEvent) {\r\n        if (this.pbMouseWheelScroll) {\r\n            const iDelta = oEvent.getMouseWheelDelta();\r\n\r\n            if (iDelta > 0) {\r\n                //  Scroll up\r\n                this.increment(false, false);\r\n            } else if (iDelta < 0) {\r\n                //  Scroll down\r\n                this.increment(true, false);\r\n            }\r\n\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /* \r\n    The generic sliding logic that listens to the move events and updates the slider until the release.\r\n    \r\n    @param  eType       The event type (0 = mousedown, 1 = pointerdown, 2 = touchdown).\r\n    @param  bRanged     If true it is the ranged slider that is being moved.\r\n    @param  oEvent      The event object of the initial event.\r\n    \r\n    @private\r\n    */\r\n    slide(eType, bRanged, oEvent) {\r\n        let iStartValue;\r\n        const bVert = this.pbVertical;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        //  Get mouse / touch position from the browser (use specific API's based on eType)\r\n        function getPos(oEv) {\r\n            if (eType === 0) {\r\n                return (bVert ? oEv.getMouseY() : oEv.getMouseX());\r\n            }\r\n            if (eType === 1) {\r\n                return (bVert ? oEv.e.clientY : oEv.e.clientX);\r\n            }\r\n            if (eType === 2) {\r\n                return (bVert ? oEv.e.targetTouches[0].clientY : oEv.e.targetTouches[0].clientX);\r\n            }\r\n\r\n            return 0;\r\n        }\r\n\r\n\r\n        //  Check if the slider is a ranged slider\r\n        //bRanged = (this._eRangedSlider === oEvent.eSource && this.pbRanged);\r\n\r\n        const iInterval = this.getInterval();\r\n\r\n        //  Generate mask\r\n        const eMask = df.gui.dragMask(this.topLayer() || document.body);\r\n        eMask.style.cursor = bVert ? \"s-resize\" : \"e-resize\";\r\n\r\n        const iMouseStart = getPos(oEvent);\r\n\r\n        //Set the starting values\r\n        if (this.pbRanged) {\r\n            if (bRanged) {\r\n                iStartValue = this.piFrom;\r\n            } else {\r\n                iStartValue = this.piTo;\r\n            }\r\n        } else {\r\n            iStartValue = this.piSliderValue;\r\n        }\r\n\r\n\r\n        /*\r\n        This function is fired when the drag event is fired.\r\n        This function repositions the slider to the new mouse position and ajustst the value of the (ranged)slider\r\n        \r\n        Params:\r\n            oEvent  The event object causing the function to go off.\r\n        */\r\n        function onDragSlide(oEvent) {\r\n            let iNewValue, iNumberOfIntervals;\r\n\r\n            //  Calculate the new mouse position difference\r\n            const iNewMouseValue = getPos(oEvent);\r\n            const iDiff = iNewMouseValue - iMouseStart;\r\n\r\n            //  Calculate the number of intervals the slider has to change, compared to the beginning values\r\n            iNumberOfIntervals = iDiff / iInterval;\r\n            iNumberOfIntervals = Math.round(this.toPositive(iNumberOfIntervals));\r\n\r\n            //  If the new mouse value is lower then the starting mouse value make the number of intervals negative\r\n            if (iMouseStart > iNewMouseValue) {\r\n                iNumberOfIntervals *= -1;\r\n            }\r\n\r\n            //  Calculate the new position of the slider\r\n            iNewValue = iNumberOfIntervals * this.piInterval + iStartValue;\r\n\r\n            //  Check if the new position is not lower then the minimal position or higher then the maximum position\r\n            if (iNewValue < this.piMinValue) {\r\n                iNewValue = this.piMinValue;\r\n            } else if (iNewValue > this.piMaxValue) {\r\n                iNewValue = this.piMaxValue;\r\n            }\r\n\r\n            //  Reposition the slider and change the value\r\n            if (this.pbRanged) {\r\n                if (bRanged) {\r\n                    this.piFrom = iNewValue;\r\n                    if (this.piFrom > this.piTo) {\r\n                        bRanged = false;\r\n                        const iTemp = this.piFrom;\r\n                        this.piFrom = this.piTo;\r\n                        this.piTo = iTemp;\r\n                    }\r\n                } else {\r\n                    this.piTo = iNewValue;\r\n                    if (this.piTo < this.piFrom) {\r\n                        bRanged = true;\r\n                        const iTemp = this.piFrom;\r\n                        this.piFrom = this.piTo;\r\n                        this.piTo = iTemp;\r\n                    }\r\n                }\r\n            } else {\r\n                this.piSliderValue = iNewValue;\r\n            }\r\n            this.updateDisplay();\r\n        }\r\n\r\n        /*\r\n        This function removes the dragmask and removes the mouseup listener    \r\n        \r\n        Params:\r\n            oEvent  The event object causing the function to go off.\r\n        */\r\n        function onStopSlide(oEvent) {\r\n            eMask.parentNode.removeChild(eMask);\r\n\r\n            if (eType === 0) {\r\n                df.dom.off(\"mouseup\", window, onStopSlide, this);\r\n                df.dom.off(\"mouseup\", eMask, onStopSlide, this);\r\n                df.dom.off(\"mousemove\", eMask, onDragSlide, this);\r\n            } else if (eType === 1) {\r\n                df.dom.off(\"pointerup\", window, onStopSlide, this);\r\n                df.dom.off(\"pointerup\", eMask, onStopSlide, this);\r\n                df.dom.off(\"pointermove\", window, onDragSlide, this);\r\n            } else if (eType === 2) {\r\n                df.dom.off(\"touchend\", window, onStopSlide, this);\r\n                df.dom.off(\"touchend\", eMask, onStopSlide, this);\r\n                df.dom.off(\"touchmove\", window, onDragSlide, this);\r\n            }\r\n\r\n            this.fireChange();\r\n        }\r\n\r\n        //add event listeners to the mask\r\n        if (eType === 0) {\r\n            df.dom.on(\"mouseup\", window, onStopSlide, this);\r\n            df.dom.on(\"mouseup\", eMask, onStopSlide, this);\r\n            df.dom.on(\"mousemove\", eMask, onDragSlide, this);\r\n        } else if (eType === 1) {\r\n            df.dom.on(\"pointerup\", window, onStopSlide, this);\r\n            df.dom.on(\"pointerup\", eMask, onStopSlide, this);\r\n            df.dom.on(\"pointermove\", window, onDragSlide, this);\r\n        } else if (eType === 2) {\r\n            df.dom.on(\"touchend\", window, onStopSlide, this);\r\n            df.dom.on(\"touchend\", eMask, onStopSlide, this);\r\n            df.dom.on(\"touchmove\", window, onDragSlide, this);\r\n        }\r\n\r\n        oEvent.stop();\r\n\r\n        this.focus();\r\n    }\r\n\r\n    /*\r\n    Event handler for a click on the slider bar. This event is handler on a wrapping element because our \r\n    bar is not rendered on top (slider & markers go in front of it). We check if the click was on (or \r\n    close to) the bar and then we update the value based on the position of the click.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    onSliderClick(oEvent) {\r\n        let iOffset, iVal;\r\n\r\n        if (!this.isEnabled()) {\r\n            return;\r\n        }\r\n\r\n        //  Determine bar position\r\n        const oOffset = this._eSliderBarInner.getBoundingClientRect();\r\n\r\n        //  Check if the click was anywhere close to the bar (we are handling the event on a bigger element)\r\n        if (!(oEvent.getMouseY() >= oOffset.top - 2 && oEvent.getMouseY() <= oOffset.bottom + 2 && oEvent.getMouseX() >= oOffset.left - 2 && oEvent.getMouseX() <= oOffset.right + 2)) {\r\n            return;\r\n        }\r\n\r\n        //  Calculate the clicked position\r\n        if (this.pbVertical) {\r\n            iOffset = oEvent.getMouseY() - oOffset.top;\r\n        } else {\r\n            iOffset = oEvent.getMouseX() - oOffset.left;\r\n        }\r\n        const iRawVal = iOffset / (this.getInterval() / this.piInterval);\r\n\r\n        //  Round and increment with minimum value\r\n        iVal = (Math.round(iRawVal / this.piInterval) * this.piInterval) + this.piMinValue;\r\n\r\n        if (iVal < this.piMinValue) {\r\n            iVal = this.piMinValue;\r\n        } else if (iVal > this.piMaxValue) {\r\n            iVal = this.piMaxValue;\r\n        }\r\n\r\n        if (this.pbRanged) {\r\n            //  For the ranged slider we adjust the slider the click was the closest to\r\n            if (iVal < this.piFrom) {\r\n                this.piFrom = iVal;\r\n            } else if (iVal > this.iTo) {\r\n                this.piTo = iVal;\r\n            } else if (iVal - this.piFrom < this.piTo - iVal) {\r\n                this.piFrom = iVal;\r\n            } else {\r\n                this.piTo = iVal;\r\n            }\r\n        } else {\r\n            //  Update the position\r\n            this.piSliderValue = iVal;\r\n        }\r\n\r\n        this.updateDisplay();\r\n        this.fireChange();\r\n\r\n    }\r\n\r\n    /*\r\n    This function handles the event when a key is pressed and increments or decrements the slider accordingly\r\n    \r\n    Params:\r\n        oEvent  The event object causing the function to go off.\r\n    */\r\n    onKey(oEvent) {\r\n\r\n        if (oEvent.matchKey(df.settings.sliderKeys.sliderDown)) {\r\n            this.increment(this.pbVertical, !this.pbVertical);\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n        if (oEvent.matchKey(df.settings.sliderKeys.sliderUp)) {\r\n            this.increment(!this.pbVertical, !this.pbVertical);\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n        if (oEvent.matchKey(df.settings.sliderKeys.sliderLeft)) {\r\n            this.increment(false, this.pbVertical);\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n        if (oEvent.matchKey(df.settings.sliderKeys.sliderRight)) {\r\n            this.increment(true, this.pbVertical);\r\n            oEvent.stop();\r\n            return;\r\n        }\r\n\r\n        super.onKey(oEvent);\r\n    }\r\n\r\n    /*\r\n    This method checks if the value is changed and if so it will trigger the OnChange event.\r\n    */\r\n    fireChange() {\r\n\r\n        //  Only fire events if it changed\r\n        if (this._iPrevChangePos !== this.piSliderValue || this._iPrevChangeFrom !== this.piFrom || this._iPrevChangeTo !== this.piTo) {\r\n            this.pbChanged = true;\r\n\r\n            //  Fire events (OnSelectedChange on every radio and OnSelect on the selected one)\r\n            this.fire('OnChange', [this.piSliderValue, this._iPrevChangePos]);\r\n\r\n            //  Remember the value\r\n            this._iPrevChangePos = this.piSliderValue;\r\n            this._iPrevChangeFrom = this.piFrom;\r\n            this._iPrevChangeTo = this.piTo;\r\n        }\r\n    }\r\n\r\n    //------------Getters and setters for the element -----------------\r\n\r\n    //-------------Setters\r\n    /*\r\n    Setter for piMinValue.\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piMinValue(iVal) {\r\n        this.piMinValue = iVal;\r\n        this.resize();\r\n\r\n        this.generateMarkers();\r\n        this.updateLabels();\r\n    }\r\n\r\n    /*\r\n    Setter for piMaxValue.\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piMaxValue(iVal) {\r\n        this.piMaxValue = iVal;\r\n        this.updateDisplay();\r\n\r\n        this.generateMarkers();\r\n        this.updateLabels();\r\n    }\r\n\r\n    /*\r\n    Setter for piInterval.\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piInterval(iVal) {\r\n        this.piInterval = iVal;\r\n        this.updateDisplay();\r\n\r\n        this.generateMarkers();\r\n        this.updateLabels();\r\n    }\r\n\r\n    /*\r\n    Setter for pbShowMarkers.\r\n    \r\n    @param bVal    The new value.\r\n    */\r\n    set_pbShowMarkers(bVal) {\r\n        this.pbShowMarkers = bVal;\r\n\r\n        this.generateMarkers();\r\n        this.updateLabels();\r\n    }\r\n\r\n    /*\r\n    Setter for piSliderValue.\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piSliderValue(iVal) {\r\n        if (iVal > this.piMaxValue) {\r\n            this.piSliderValue = this.piMaxValue;\r\n        } else if (iVal < this.piMinValue) {\r\n            this.piSliderValue = this.piMinValue;\r\n        } else {\r\n            this.piSliderValue = iVal;\r\n        }\r\n\r\n        this._iPrevChangePos = this.piSliderValue;\r\n        // this.pbChanged = false;\r\n        this.updateDisplay();\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Setter for piFrom. Note that if piFrom is lower than piTo then the values will be switched after a \r\n    short timeout (to give set_piTo a chance).\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piFrom(iVal) {\r\n        const that = this;\r\n\r\n        if (iVal > this.piMaxValue) {\r\n            this.piFrom = this.piMaxValue;\r\n        } else if (iVal < this.piMinValue) {\r\n            this.piFrom = this.piMinValue;\r\n        } else {\r\n            this.piFrom = iVal;\r\n        }\r\n\r\n        this._iPrevChangeFrom = this.piFrom;\r\n\r\n        if (this.piFrom > this.piTo) {\r\n            //  We need to set a small timeout to make sure that set_piTo is not going to be called after this\r\n            setTimeout(function () {\r\n                \r\n                if (that.piFrom > that.piTo) {\r\n                    const i = that.piFrom;\r\n                    const x = that._iPrevChangeFrom;\r\n\r\n                    that.piFrom = that.piTo;\r\n                    that.piTo = i;\r\n\r\n                    that._iPrevChangeFrom = that._iPrevChangeTo;\r\n                    that._iPrevChangeTo = x;\r\n                }\r\n\r\n                that.updateDisplay();\r\n            }, 10);\r\n        } else {\r\n            this.updateDisplay();\r\n        }\r\n\r\n\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Setter for piTo. Note that if piFrom is lower than piTo then the values will be switched after a \r\n    short timeout (to give set_piTo a chance).\r\n    \r\n    @param iVal    The new value.\r\n    */\r\n    set_piTo(iVal) {\r\n        const that = this;\r\n\r\n        if (iVal > this.piMaxValue) {\r\n            this.piTo = this.piMaxValue;\r\n        } else if (iVal < this.piMinValue) {\r\n            this.piTo = this.piMinValue;\r\n        } else {\r\n            this.piTo = iVal;\r\n        }\r\n\r\n        this._iPrevChangeTo = this.piTo;\r\n\r\n        if (this.piFrom > this.piTo) {\r\n            //  We need to set a small timeout to make sure that set_piFrom is not going to be called after this\r\n            setTimeout(function () {\r\n\r\n                if (that.piFrom > that.piTo) {\r\n                    const i = that.piFrom;\r\n                    const x = that._iPrevChangeFrom;\r\n\r\n                    that.piFrom = that.piTo;\r\n                    that.piTo = i;\r\n\r\n                    that._iPrevChangeFrom = that._iPrevChangeTo;\r\n                    that._iPrevChangeTo = x;\r\n                }\r\n\r\n                that.updateDisplay();\r\n            }, 10);\r\n        } else {\r\n            this.updateDisplay();\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*\r\n    Override this property to make it work on pbChanged only.\r\n    */\r\n    get_pbChanged() {\r\n        return this.pbChanged;\r\n    }\r\n\r\n    /*\r\n    Override and make it actually return piSliderValue.\r\n    \r\n    @private\r\n    */\r\n    get_psValue() {\r\n        return this.piSliderValue.toString();\r\n    }\r\n\r\n    /*\r\n    Override to make sure they are not accidentally called.\r\n    \r\n    @private\r\n    */\r\n    set_psValue(sVal) {\r\n\r\n    }\r\n\r\n    // - - - - - - - Focus - - - - - - -\r\n\r\n    //TODO This can be done correct\r\n    attachFocusEvents() {\r\n        //  We use a simpler focus detection on the control\r\n        if (this._eControl && this.isEnabled() && this.pbVisible) {\r\n            df.events.addDomCaptureListener(\"focus\", this._eControl, this.onFocus, this);\r\n            df.dom.on(\"blur\", this._eControl, this.onBlur, this);\r\n        }\r\n    }\r\n    /*\r\n    We override the focus method and make it give the focus to the hidden focus holder element.\r\n    \r\n    @return True if the List can take the focus.\r\n    */\r\n    focus() {\r\n        if (this._bFocusAble && this.isEnabled() && this._eControl) {\r\n            this._eControl.focus();\r\n\r\n            this.objFocus();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    onFocus(oEvent) {\r\n        super.onFocus(oEvent);\r\n        this.focus();\r\n        this._bLozingFocus = false;\r\n    }\r\n\r\n    onBlur(oEvent) {\r\n        const that = this;\r\n        this._bLozingFocus = true;\r\n\r\n        setTimeout(function () {\r\n            if (that._bLozingFocus) {\r\n                that.getWebApp().objBlur(that);\r\n                if (that._eElem) {\r\n                    df.dom.removeClass(that._eElem, \"WebCon_Focus\");\r\n                }\r\n\r\n                that._bHasFocus = false;\r\n                that._bLozingFocus = false;\r\n            }\r\n        }, 100);\r\n    }\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebHorizontalLine\r\nExtends:\r\n    df.WebBaseControl\r\n\r\nThis is the client-side representation of the cWebHorizontalLine class. \r\n    \r\nRevision:\r\n    2012/08/30  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebHorizontalLine extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this._sControlClass = \"WebHorizontalLine\";\r\n        this._bFocusAble = false;\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and adds the div.WebHorizontalLine_Spacer element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<hr/>');\r\n    }\r\n\r\n    /*\r\n    This method augments the html generation and closes the div.WebHorizontalLine_Spacer element.\r\n    \r\n    @param  aHtml   String builder array containing html.\r\n    \r\n    @private\r\n    */\r\n    closeHtml(aHtml) {\r\n\r\n\r\n        super.closeHtml(aHtml);\r\n    }\r\n\r\n    /*\r\n    This method is called after rendering and is used the get references to DOM elements, attach event \r\n    listeners and do other initialization.\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"hr\");\r\n\r\n        super.afterRender();\r\n    }\r\n\r\n    /*\r\n    Override the setter for psBackgroundColor because <hr elements behave different in different \r\n    browsers. If we want the line to show the background color we need to set both color and\r\n    backgroundColor because some browsers use one and others use the other.\r\n    \r\n    @param  sVal    The new background color.\r\n    */\r\n    set_psBackgroundColor(sVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.backgroundColor = sVal || '';\r\n            this._eControl.style.color = sVal || '';\r\n            //this._eControl.style.backgroundImage = (sVal ? 'none' :'');\r\n        }\r\n    }\r\n}","import { WebObject  } from './WebObject.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebTimer\r\nExtends:\r\n    df.WebObject\r\n\r\nThis class contains a simple timer object that allows developers to easily build user interfaces \r\nthat have to refresh regularly. It works a lot like the windows DfTimer class but with this \r\nframework the timer has to run on the client and call the server.\r\n    \r\nRevision:\r\n    2012/11/30  (HW, DAW) \r\n        Initial version.\r\n*/\r\nexport class WebTimer extends WebObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Public API\r\n        this.prop(df.tBool, \"pbAutoStart\", true);\r\n        this.prop(df.tBool, \"pbAutoStop\", true);\r\n        this.prop(df.tInt, \"piInterval\", 2000);\r\n        this.prop(df.tBool, \"pbRunning\", false);\r\n        this.prop(df.tBool, \"pbWaitForCall\", true);\r\n\r\n        this.event(\"OnTimer\", df.cCallModeDefault);\r\n\r\n        //  Privates\r\n        this._tInterval = null;\r\n        this._tTimeout = null;\r\n        this._oView = null;\r\n\r\n        this.addSync(\"pbRunning\");\r\n    }\r\n\r\n    /*\r\n    This method initializes the timer. It attaches event listeners to the view object for automatic \r\n    starting / stopping or starts the timer right away.\r\n    \r\n    @private\r\n    */\r\n    create() {\r\n        super.create();\r\n\r\n        //  Check if we are in a view, if so we listen to its OnShow and OnHide events, else we just start it\r\n        this._oView = this.getView();\r\n        if (this._oView) {\r\n            this._oView.OnShow.on(this.showView, this);\r\n            this._oView.OnHide.on(this.hideView, this);\r\n        } else {\r\n            if (this.pbAutoStart) {\r\n                this.pbRunning = true;\r\n                this.trigger();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Cleanup.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        super.destroy();\r\n\r\n        if (this._oView) {\r\n            this._oView.OnShow.off(this.showView, this);\r\n            this._oView.OnHide.off(this.hideView, this);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method fires the OnTimer event to the server when it is triggered. It will call the trigger \r\n    method when finished to control the next timeout.\r\n    \r\n    @private\r\n    */\r\n    timer() {\r\n        if (this.pbRunning) {\r\n            this.fire(\"OnTimer\", [], function () {\r\n                this.trigger();\r\n            });\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is the central method of this timer and it sets / clears the timeout or interval. \r\n    \r\n    @private\r\n    */\r\n    trigger() {\r\n        const that = this;\r\n\r\n        if (this.pbRunning) {\r\n            if (this.pbWaitForCall) {\r\n                if (this._tInterval) {\r\n                    clearInterval(this._tInterval);\r\n                    this._tInterval = null;\r\n                }\r\n                if (this._tTimeout) {\r\n                    clearTimeout(this._tTimeout);\r\n                }\r\n\r\n                this._tTimeout = setTimeout(function () {\r\n                    that.timer();\r\n                }, this.piInterval);\r\n            } else if (!this._tInterval) {\r\n                this._tInterval = setInterval(function () {\r\n                    that.timer();\r\n                }, this.piInterval);\r\n            }\r\n        } else {\r\n            if (this._tInterval) {\r\n                clearInterval(this._tInterval);\r\n                this._tInterval = null;\r\n            }\r\n            if (this._tTimeout) {\r\n                clearTimeout(this._tTimeout);\r\n                this._tTimeout = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    This setter method for pbRunning starts / stops the timer. It updates the property an calls the \r\n    trigger method to make sure that the timer is started or stopped.\r\n    \r\n    @param bVal     The new value.\r\n    */\r\n    set_pbRunning(bVal) {\r\n        this.pbRunning = bVal;\r\n\r\n        this.trigger();\r\n    }\r\n\r\n    /*\r\n    This setter method piInterval updates the timeout between the calls. If we are using the setInterval \r\n    API we need to clear the current interval. We then call the trigger method to make sure the new \r\n    timeout / interval is properly set.\r\n    \r\n    @param iVal     The new value.\r\n    */\r\n    set_piInterval(iVal) {\r\n        if (this.piInterval !== iVal) {\r\n            this.piInterval = iVal;\r\n\r\n            if (this._tInterval) {\r\n                clearInterval(this._tInterval);\r\n                this._tInterval = null;\r\n            }\r\n\r\n            this.trigger();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter method for pbWaitForCall that updates the intervals used by calling the trigger method.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbWaitForCall(bVal) {\r\n        this.pbWaitForCall = bVal;\r\n\r\n        this.trigger();\r\n    }\r\n\r\n    /*\r\n    This method handles the OnShow event of the view which starts the timer if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    showView(oEvent) {\r\n        if (this.pbAutoStart) {\r\n            this.pbRunning = true;\r\n            this.trigger();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method handles the OnHide event of the view which stops the timer if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    hideView(oEvent) {\r\n        if (this.pbAutoStop) {\r\n            this.pbRunning = false;\r\n            this.trigger();\r\n        }\r\n    }\r\n}","import { WebBaseFileUpload } from './WebBaseFileUpload.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebFileUploadButton\r\nExtends:\r\n    df.WebBaseFileUpload\r\n\r\nThis class renders a button that can be used to upload one or multiple files. It inherits the file \r\nupload logic from WebBaseFileUpload.\r\n    \r\nRevision:\r\n    2013/09/10  (HW, DAW)\r\n        Initial version.\r\n*/\r\n\r\nexport class WebFileUploadButton extends WebBaseFileUpload {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psCaption\", \"Select file(s)\");\r\n        this.prop(df.tInt, \"peAlign\", -1);\r\n\r\n        this._sControlClass = \"WebButton WebUploadBtn\";\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<button id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\"' : ''));\r\n        if (this.peAlign >= 0) {\r\n            aHtml.push(' style=\"text-align: ', df.sys.gui.cssTextAlign(this.peAlign), '\"');\r\n        }\r\n        aHtml.push('>', df.dom.encodeHtml(this.psCaption), '</button>');\r\n\r\n        this.fileHtml(aHtml);\r\n    }\r\n\r\n    afterRender() {\r\n        this._eControl = df.dom.query(this._eElem, \"button\");\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"click\", this._eControl, this.onBtnClick, this);\r\n    }\r\n\r\n    /*\r\n    Event handler for the OnClick event of the button. It fires the OnClick event of the framework which \r\n    is usually handled on the server.\r\n    \r\n    @param  oEvent  Event object (df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBtnClick(oEvent) {\r\n        const eElem = this._eElem;\r\n\r\n        if (this.isEnabled()) {\r\n            df.dom.addClass(eElem, df.CssHit);\r\n            setTimeout(function () {\r\n                df.dom.removeClass(eElem, df.CssHit);\r\n            }, df.hitTimeout);\r\n\r\n            this.selectFiles();\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Setter method for psCaption which is the text shown on the button.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eControl) {\r\n            df.dom.setText(this._eControl, sVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter for the peAlign property which updates the textAlign style.\r\n    \r\n    @param  eVal    The new value.\r\n    */\r\n    set_peAlign(eVal) {\r\n        if (this._eControl) {\r\n            this._eControl.style.textAlign = df.sys.gui.cssTextAlign(eVal);\r\n        }\r\n    }\r\n\r\n    /*\r\n    Augments the applyEnabled method and disables the button by setting the disabled attribute of the \r\n    button HTML element.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl) {\r\n            this._eControl.disabled = !bVal;\r\n        }\r\n    }\r\n}","import { WebBaseMenu } from './WebBaseMenu.js';\r\nimport { WebFloatingPanel } from './WebFloatingPanel.js';\r\nimport { WebMenuList } from './WebMenuList.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebMenuButton\r\nExtends:\r\n    df.WebBaseMenu\r\n\r\nControl that renders a button (or an anchor) which on click shows a floating panel that shows a menu \r\nusing the WebMenuList.\r\n\r\nRevisions:\r\n    2015/01/15, HW (DAW)\r\n        Initial version.\r\n*/\r\nexport class WebMenuButton extends WebBaseMenu {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tBool, \"pbRenderAsAnchor\", true);\r\n        this.prop(df.tBool, \"pbHideOnBlur\", true);\r\n        this.prop(df.tString, \"psCaption\", \"\");\r\n        this.prop(df.tInt, \"piMenuWidth\", 300);\r\n        this.prop(df.tInt, \"piMenuHeight\", 0);\r\n        this.prop(df.tString, \"psMenuCSSClass\", \"\");\r\n        this.prop(df.tString, \"psMenuRootCaption\", \"\");\r\n        this.prop(df.tBool, \"pbMenuShowCaption\", true);\r\n        this.prop(df.tBool, \"pbMenuShowIcons\", false);\r\n        this.prop(df.tString, \"psGroupName\", \"\");\r\n        this.prop(df.tBool, \"pbOpenOnRoot\", false);\r\n\r\n        this.pbShowLabel = false;\r\n\r\n        this._oPnl = null;\r\n        this._oMenuList = null;\r\n\r\n        this._sRealgroupName = \"\";\r\n\r\n        this._bIsMenu = true;\r\n        this._sControlClass = \"WebMenuButton\";\r\n    }\r\n\r\n    create() {\r\n        //  The menu button uses the menu group system internally so it generates a custom menu group name if none is specified.\r\n        this._sRealgroupName = this.psGroupName;\r\n\r\n        if (!this.psGroupName) {\r\n            this.psGroupName = \"_WebMenuButtonGrp_\" + df.dom.genDomId().toString();\r\n        }\r\n\r\n        super.create();\r\n    }\r\n\r\n\r\n    openHtml(aHtml) {\r\n        if (!this.pbRenderAsAnchor) {\r\n            this._sControlClass += \" WebButton\";\r\n        } else {\r\n            this._sControlClass = \"WebMenuAnchor\";\r\n        }\r\n\r\n        super.openHtml(aHtml);\r\n\r\n        if (this.pbRenderAsAnchor) {\r\n            aHtml.push('<a id=\"', this._sControlId, '\" href=\"javascript:void(0);\" target=\"_self\"', (!this.isEnabled() ? ' tabindex=\"-1\"' : ''), '></a>');\r\n        } else {\r\n            aHtml.push('<button id=\"', this._sControlId, '\"', (!this.isEnabled() ? ' disabled=\"disabled\"' : ''), '></button>');\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method is called after the HTML is added to the DOM and provides a hook for doing additional implementation. It gets references to the DOM elements, adds event handlers and executes setters t\r\n    \r\n    @private\r\n    */\r\n    afterRender() {\r\n        //  Get references\r\n        this._eControl = df.dom.query(this._eElem, \"button, a\");\r\n\r\n\r\n        super.afterRender();\r\n\r\n        //  Attach listeners\r\n        df.dom.on(\"click\", this._eControl, this.onBtnClick, this);\r\n        df.events.addDomKeyListener(this._eElem, this.onKey, this);\r\n\r\n        //  Call setters\r\n        this.set_psCaption(this.psCaption);\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    /*\r\n    Event handler for the OnClick event of the button. \r\n    \r\n    @param  oEvent  Event object (df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onBtnClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            if (this._oPnl && this._oPnl.pbVisible) {\r\n                this.hideMenu();\r\n            } else {\r\n                this.showMenu();\r\n            }\r\n            oEvent.stop();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Shows the menu by showing the floating panel.\r\n    */\r\n    showMenu() {\r\n\r\n        if (!this._oPnl) {    // Create the WebFloatingPanel and WebMenuList controls if they don't exist yet\r\n            const oPnl = this._oPnl = new WebFloatingPanel(null, this);\r\n            oPnl.psFloatByControl = this.getLongName();\r\n            oPnl.piWidth = this.piMenuWidth || 150;\r\n            oPnl.piColumnCount = 1;\r\n            oPnl.psCSSClass = \"WebMBPanel \" + this.psMenuCSSClass;\r\n            oPnl.pbHideOnBlur = this.pbHideOnBlur;\r\n            oPnl.piHeight = this.piMenuHeight;\r\n            oPnl.create();\r\n\r\n            const oMnu = this._oMenuList = new WebMenuList(null, this);\r\n            oMnu._oMenuBtn = this;\r\n            oMnu.psGroupName = this.psGroupName;\r\n            oMnu.pbFillHeight = (this.piMenuHeight > 0);\r\n            oMnu.pbShowCaption = this.pbMenuShowCaption;\r\n            oMnu.pbShowIcons = this.pbMenuShowIcons;\r\n            oMnu.psRootCaption = this.psMenuRootCaption;\r\n            oMnu.pbAllowHtml = this.pbAllowHtml;\r\n            oMnu.create();\r\n\r\n            oPnl.addChild(oMnu);\r\n\r\n            const ePnl = oPnl.render();\r\n            if (ePnl) {\r\n                this._eElem.parentNode.insertBefore(ePnl, this._eElem);\r\n            }\r\n            oPnl.afterRender();\r\n            oPnl.resizeHorizontal();\r\n            oPnl.resizeVertical();\r\n        } else if (this.pbOpenOnRoot) {\r\n            this._oMenuList.collapseAll();\r\n        }\r\n\r\n        this._oPnl.show();\r\n    }\r\n\r\n    /* \r\n    Hides the menu by hiding the floating panel.\r\n    */\r\n    hideMenu() {\r\n        this._oPnl.hide();\r\n    }\r\n\r\n    /* \r\n    @client-action\r\n    */\r\n    collapseAll() {\r\n        this._oMenuList?.collapseAll();\r\n    }\r\n\r\n    /* \r\n    @client-action\r\n    */\r\n    levelUp() {\r\n        this._oMenuList?.levelUp();\r\n    }\r\n\r\n    /*\r\n    Setter method for psCaption which is the text shown on the button.\r\n    \r\n    @param  sVal    The new value.\r\n    */\r\n    set_psCaption(sVal) {\r\n        if (this._eControl) {\r\n            if (sVal) {\r\n                df.dom.setText(this._eControl, sVal);\r\n            } else {\r\n                this._eControl.innerHTML = \"\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment the setter for the psGroupName as the WebMenuButton uses the menu group system internally. \r\n    It makes sure that it either uses the supplied group name or it uses an internally generated \r\n    groupname if the new value is empty.\r\n    \r\n    @param  sVal    The new value\r\n    @private\r\n    */\r\n    set_psGroupName(sVal) {\r\n        this._sRealgroupName = sVal;\r\n\r\n        //  The menu button uses the menu group system internally so it generates a custom menu group name if none is specified.\r\n        if (!sVal) {\r\n            sVal = this.psGroupName = \"_WebMenuButtonGrp_\" + df.dom.genDomId().toString();\r\n        }\r\n        if (this._oMenuList) {\r\n            this._oMenuList.set(\"psGroupName\", sVal);\r\n        }\r\n        super.set_psGroupName(sVal);\r\n\r\n        return false;   //  Make sure that set doesn't alter the value\r\n    }\r\n\r\n    /* \r\n    Override the psGroupName logic hiding the internal usage of the group logic.\r\n    \r\n    @private\r\n    */\r\n    get_psGroupName() {\r\n        //  Override to return the real name\r\n        return this._sRealgroupName;\r\n    }\r\n\r\n    set_pbMenuShowCaption(bVal) {\r\n        if (this._oMenuList) {\r\n            this._oMenuList.set(\"pbShowCaption\", bVal);\r\n        }\r\n    }\r\n\r\n    set_pbMenuShowIcons(bVal) {\r\n        if (this._oMenuList) {\r\n            this._oMenuList.set(\"pbShowIcons\", bVal);\r\n        }\r\n    }\r\n\r\n    set_psMenuRootCaption(bVal) {\r\n        if (this._oMenuList) {\r\n            this._oMenuList.set(\"psRootCaption\", bVal);\r\n        }\r\n    }\r\n\r\n    set_psMenuCSSClass(sVal) {\r\n        if (this._oPnl) {\r\n            this._oPnl.set(\"psCSSClass\", \"WebMBPanel \" + sVal);\r\n        }\r\n    }\r\n\r\n    set_piMenuWidth(iVal) {\r\n        if (this._oPnl) {\r\n            this._oPnl.set(\"piWidth\", iVal);\r\n        }\r\n    }\r\n\r\n    set_piMenuHeight(iVal) {\r\n        if (this._oPnl) {\r\n            this._oMenuList.set(\"pbFillHeight\", (iVal > 0));\r\n            this._oPnl.set(\"piHeight\", iVal);\r\n        }\r\n    }\r\n\r\n    set_pbHideOnBlur(iVal) {\r\n        if (this._oPnl) {\r\n            this._oPnl.set(\"pbHideOnBlur\", iVal);\r\n        }\r\n    }\r\n\r\n    set_pbAllowHtml(iVal) {\r\n        if (this._oMenuList) {\r\n            this._oMenuList.set(\"pbAllowHtml\", iVal);\r\n        }\r\n    }\r\n\r\n    applyEnabled(bVal) {\r\n        super.applyEnabled(bVal);\r\n\r\n        if (this._eControl) {\r\n            this._eControl.disabled = !bVal;\r\n        }\r\n    }\r\n\r\n    /*\r\n    Handles the onKey event and makes sure that it doesn't propagate the enter key to stop the onsubmit \r\n    event of the view / dialog.\r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    @private\r\n    */\r\n    onKey(oEvent) {\r\n        //  Make sure that the OnSubmit doesn't fire by canceling the propagation (but leaving the default behavior, OnClick intact)\r\n        if (oEvent.matchKey(df.settings.formKeys.submit)) {\r\n            oEvent.stopPropagation();\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        if (this._oPnl) {\r\n            this._oPnl.resize();\r\n        }\r\n    }\r\n\r\n    /* \r\n    Augment destroy to also destroy standalone controls used by the button.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        if (this._oPnl) {\r\n            this._oPnl.destroy();\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n}","import { WebForm } from './WebForm.js';\r\nimport { WebColorPicker } from './WebColorPicker.js';\r\nimport { WebFloatingPanel } from './WebFloatingPanel.js';\r\nimport { df } from '../df.js';\r\n\r\n/*\r\nClass:\r\n    df.WebColorForm\r\nExtends:\r\n    df.WebForm\r\n\r\nThis is the popup version of the cWebColorPicker which inherits from cWebForm and extends the \r\ncWebForm with options to display the color picker in a floating panel. It also displays a box \r\nshowing the color.\r\n    \r\nRevision:\r\n    2016/06/16  (HW, DAW) \r\n        Initial version.\r\n*/\r\n\r\nexport class WebColorForm extends WebForm {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tInt, \"piPickWidth\", 300);\r\n        this.prop(df.tInt, \"piPickHeight\", 250);\r\n        this.prop(df.tInt, \"piPaletteItemsPerRow\", 8);\r\n        this.prop(df.tInt, \"peColorFormat\", df.colorFormatHex);\r\n        this.prop(df.tBool, \"pbColorBackground\", false);\r\n        this.prop(df.tBool, \"pbAutoShow\", false);\r\n\r\n        //  Configure super classes\r\n        this.pbPromptButton = true;\r\n\r\n        this._sControlClass = \"WebForm WebColorForm\";\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        df.dom.toggleClass(this._eWrap, \"WebCF_ShowBox\", !this.pbColorBackground);\r\n\r\n        this._eColorBox = df.dom.create('<div class=\"WebCF_Box\"></div>');\r\n        this._eWrap.insertBefore(this._eColorBox, this._eWrap.firstChild);\r\n\r\n        df.dom.on(\"click\", this._eColorBox, this.onColorClick, this);\r\n\r\n        this.refreshDisplay(this._tValue);\r\n    }\r\n\r\n    initPicker() {\r\n        const oPnl = this._oFloatingPanel = new WebFloatingPanel(null, this);\r\n        oPnl.psFloatByControl = this.getLongName();\r\n        oPnl.piWidth = this.piPickWidth;\r\n        oPnl.piHeight = this.piPickHeight;\r\n        oPnl.piColumnCount = 1;\r\n        oPnl.pbHideOnBlur = true;\r\n        oPnl.pbFocusOnShow = true;\r\n        oPnl.pbHideOnEscape = true;\r\n        oPnl.psCSSClass = \"NoWhitespace Shadow WebColorForm_FlPnl\";\r\n        oPnl.OnHide.addListener(this.onPanelClose, this);\r\n        oPnl.create();\r\n\r\n        const oPicker = this._oColorPicker = new WebColorPicker(null, this);\r\n        oPicker.psValue = this.getServerVal();\r\n        oPicker.piColumnSpan = 0;\r\n        oPicker.pbFillHeight = true;\r\n        oPicker.pbShowLabel = false;\r\n        oPicker.pbShowColorBar = false;\r\n        oPicker.peColorFormat = this.peColorFormat;\r\n        oPicker.psCSSClass = \"WebColorPicker_Form\";\r\n        oPicker.piPaletteItemsPerRow = this.piPaletteItemsPerRow;\r\n        oPicker.OnRealtimeChange.addListener(this.onPickerChange, this);\r\n        oPicker.OnEnter.addListener(this.onPickerEnter, this);\r\n        oPicker.create();\r\n\r\n        oPnl.addChild(oPicker);\r\n    }\r\n\r\n    /* \r\n    Augment destroy to destroy the date picker as well.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        if (this._oFloatingPanel) {\r\n            this._oFloatingPanel.destroy();\r\n        }\r\n        super.destroy();\r\n    }\r\n\r\n\r\n    renderPicker() {\r\n        const oPnl = this._oFloatingPanel;\r\n\r\n        const ePnl = oPnl.render();\r\n        if (ePnl) {\r\n            this._eElem.parentNode.insertBefore(ePnl, this._eElem);\r\n        }\r\n        oPnl.afterRender();\r\n        oPnl.resizeHorizontal();\r\n        oPnl.resizeVertical();\r\n\r\n    }\r\n\r\n    firePrompt() {\r\n        this.showPicker();\r\n    }\r\n\r\n    showPicker() {\r\n        if (!this._oFloatingPanel) {\r\n            this.initPicker();\r\n        }\r\n        if (!this._oFloatingPanel._eElem) {\r\n            this.renderPicker();\r\n        }\r\n        this._oColorPicker.set(\"psValue\", this.getServerVal());\r\n        this._oFloatingPanel.show();\r\n    }\r\n\r\n    onColorClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            this.showPicker();\r\n        }\r\n    }\r\n\r\n    onPickerChange(oEvent) {\r\n        this._tValue = oEvent.sColor;\r\n        this.refreshDisplay(oEvent.sColor);\r\n    }\r\n\r\n    onPickerEnter(oEvent) {\r\n        //var sPrevColor = this.getServerVal();\r\n\r\n        this._tValue = oEvent.sColor;\r\n        this.refreshDisplay(oEvent.sColor);\r\n\r\n        this._oFloatingPanel.hide();\r\n        this.focus();\r\n        this.fireChange();\r\n    }\r\n\r\n    onPanelClose(oEvent) {\r\n        const sReason = oEvent.aParams[0];\r\n\r\n        this.fireChange();\r\n\r\n        if (sReason !== \"auto_blur\") {\r\n            this._bSkipAutoShow = true;\r\n            this.focus();\r\n        }\r\n    }\r\n\r\n    onPickerClose(oEvent) {\r\n        this._oFloatingPanel.hide();\r\n\r\n    }\r\n\r\n    set_pbColorBackground(bVal) {\r\n        this.set_psBackgroundColor((bVal ? this.getServerVal() : \"\"));\r\n\r\n        if (this._eWrap) {\r\n            df.dom.toggleClass(this._eWrap, \"WebCF_ShowBox\", !bVal);\r\n        }\r\n    }\r\n\r\n    setControlValue(sVal) {\r\n        super.setControlValue(sVal);\r\n\r\n        if (this.pbColorBackground) {\r\n            this.set_psBackgroundColor(sVal);\r\n        }\r\n        if (this._eColorBox) {\r\n            this._eColorBox.style.backgroundColor = sVal;\r\n        }\r\n    }\r\n\r\n    set_piPickHeight(iVal) {\r\n        if (this._oFloatingPanel) {\r\n            this._oFloatingPanel.set(\"piHeight\", iVal);\r\n        }\r\n    }\r\n\r\n    set_piPickWidth(iVal) {\r\n        if (this._oFloatingPanel) {\r\n            this._oFloatingPanel.set(\"piWidth\", iVal);\r\n        }\r\n    }\r\n\r\n    set_piPaletteItemsPerRow(iVal) {\r\n        if (this._oColorPicker) {\r\n            this._oColorPicker.set(\"piPaletteItemsPerRow\", iVal);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Called to add a single color to the color palette. Updates the palette if we've already rendered.\r\n    \r\n    @param  sColor          Color in hex or rgb string format.\r\n    @param  sDescription    Text shown as title on the element.\r\n    \r\n    @client-action\r\n    */\r\n    addPaletteItem(sColor, sDescription) {\r\n        if (!this._oFloatingPanel) {\r\n            this.initPicker();\r\n        }\r\n\r\n        //  Pass on to color picker\r\n        this._oColorPicker.addPaletteItem(sColor, sDescription);\r\n    }\r\n\r\n    /* \r\n    Called to refresh the entire color palette at once. Colors are sent as action data (array of \r\n    df.tWebColorPaletteItem items).\r\n    \r\n    @client-action\r\n    */\r\n    updatePalette() {\r\n        if (!this._oFloatingPanel) {\r\n            this.initPicker();\r\n        }\r\n\r\n        //  Pass on to color picker including action data.\r\n        this._oColorPicker._tActionData = this._tActionData;\r\n        this._oColorPicker.updatePalette();\r\n        this._oColorPicker._tActionData = null;\r\n    }\r\n\r\n    /*\r\n    This method augments the onFocus event of the display field and handles two different scenarios. If \r\n    the date picker is visible then this means that the user manually passed the focus to the input \r\n    field. In that case we hide the date picker. If the date picker is not visible then we might need to \r\n    show the date picker if pbAutoShow is true. The _bSkipAutoShow property can be set to true to \r\n    prevent recursive loops. \r\n    \r\n    @param  oEvent  Event object (see: df.events.DOMEvent).\r\n    */\r\n    onFocus(oEvent) {\r\n        super.onFocus(oEvent);\r\n\r\n        if (this.pbAutoShow && this.isEnabled() && !this.pbReadOnly && !this._bSkipAutoShow) {\r\n            this.showPicker();\r\n        }\r\n\r\n        this._bSkipAutoShow = false;\r\n    }\r\n}","import { WebColumnBase } from './WebColumn.js';\r\nimport { df } from '../df.js';\r\n/* \r\nClass:\r\n    df.WebColumnHighlight\r\nExtends:\r\n    df.WebColumn_mixin(df.WebForm)\r\n\r\nSpecial column class that is able to highlight search phrases. It does this by altering cell values \r\nwith a <span class=\"WebHighlight\">..</span> wrapping each keyword. This allows the CSS to highlight \r\nthe keyword.\r\n\r\nRevision:\r\n    2016/05/25  (HW, DAE)\r\n*/\r\n\r\nexport class WebColumnHighlight extends WebColumnBase {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString, \"psHighlightCSSClass\", \"WebHighlight\");\r\n\r\n        this.prop(df.tString, \"psHighlight\", \"\");\r\n        this.prop(df.tBool, \"pbFullText\", true);\r\n        this.prop(df.tBool, \"pbSeparateWords\", true);\r\n        this.prop(df.tBool, \"pbCaseSensitive\", false);\r\n\r\n        this._oRegEx = null;\r\n    }\r\n\r\n    /* \r\n    Augments the cellHtml function with support for the pbPassword property.\r\n    \r\n    @param  tCell   Struct with cell data.\r\n    @return HTML content of the cell &bull;&bull; for passwords.\r\n    */\r\n    cellHtml(sRowId, tCell) {\r\n        let sVal; \r\n        const sCssClass = this.psHighlightCSSClass;\r\n\r\n        const tVal = df.sys.data.serverToType(tCell.sValue, this.peDataType);\r\n        sVal = this.typeToDisplay(tVal);\r\n\r\n        if (!this.pbAllowHtml) {\r\n            sVal = df.dom.encodeHtml(sVal);\r\n        }\r\n\r\n        if (this.psHighlight) {\r\n            const oRegEx = this.getRegEx();\r\n\r\n            sVal = sVal.replace(oRegEx, function (match) {\r\n                return '<span class=\"' + sCssClass + '\">' + match + '</span>';\r\n            });\r\n        }\r\n\r\n        return (sVal !== '' ? sVal : '&nbsp;');\r\n    }\r\n\r\n    set_psHighlight(sVal) {\r\n        if (this.psHighlight !== sVal) {\r\n            this.psHighlight = sVal;\r\n            this._oRegEx = null;\r\n            //  this._oParent.redraw(); // We are not doing a list redraw because it causes a duplicate redraw in most cases. It does mean that to apply a new highlight you have to refresh the list yourself.\r\n        }\r\n    }\r\n\r\n    set_psHighlightCSSClass(sVal) {\r\n        this.psHighlightCSSClass = sVal;\r\n\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    set_pbFullText(bVal) {\r\n        this.pbFullText = bVal;\r\n        this._oRegEx = null;\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    set_pbSeparateWords(bVal) {\r\n        this.pbSeparateWords = bVal;\r\n        this._oRegEx = null;\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    set_pbCaseSensitive(bVal) {\r\n        this.pbCaseSensitive = bVal;\r\n        this._oRegEx = null;\r\n        this._oParent.redraw();\r\n    }\r\n\r\n    getRegEx() {\r\n        let aHighlights, sRegex, sMod;\r\n\r\n        if (!this._oRegEx) {\r\n            if (this.pbSeparateWords) {\r\n                aHighlights = this.psHighlight.split(\" \");\r\n            } else {\r\n                aHighlights = [this.psHighlight];\r\n            }\r\n\r\n            for (let i = 0; i < aHighlights.length; i++) {\r\n                aHighlights[i] = df.sys.data.escapeRegExp(aHighlights[i]);\r\n            }\r\n            sRegex = \"(\" + aHighlights.join(\"|\") + \")\";\r\n\r\n            if (!this.pbFullText) {\r\n                sRegex = \"^\" + sRegex;\r\n            }\r\n\r\n            sMod = \"g\";\r\n            if (!this.pbCaseSensitive) {\r\n                sMod += \"i\";\r\n            }\r\n\r\n            this._oRegEx = new RegExp(sRegex, sMod);\r\n        }\r\n\r\n        return this._oRegEx;\r\n    }\r\n}","import { WebCardContainer } from './WebCardContainer.js';\r\n/* \r\nClass:\r\n    df.WebAccordionContainer\r\nExtends:\r\n    df.WebCardContainer\r\n\r\nAccordion control that based on card container technology. It supports multiple modes with \r\npbMultiOpen, pbAutoHeight and pbOpenFirst. The df.WebAccordionCard implements the card interface.\r\n\r\nRevision:\r\n    2016/10/06  (HW, DAW)\r\n        Refactored into df.WebAccordionContainer.\r\n    2016/06/27  (HW, DAW)\r\n        Migrated to DataFlex 18.2 with support for the deferred card rendering and isEnabled.\r\n    2015/09/29  (HW, DAW)\r\n        Initial version.\r\n*/\r\n/* global df */\r\n\r\nexport class WebAccordionContainer extends WebCardContainer {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tBool, \"pbOpenFirst\", true);\r\n        this.prop(df.tBool, \"pbAutoHeight\", true);\r\n        this.prop(df.tBool, \"pbMultiOpen\", false);\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebAccordion\";\r\n        this._sCardClass = \"WebAC\";\r\n        this._bCC = false; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n    }\r\n\r\n    /*\r\n    Override since we don't want a header with tab buttons to be generated.\r\n    \r\n    @param  aHtml   String builder array.\r\n    @private\r\n    */\r\n    headHtml(aHtml) {\r\n\r\n    }\r\n\r\n    afterRender() {\r\n        const that = this;\r\n\r\n        super.afterRender();\r\n\r\n        df.dom.on(\"transitionend\", this._eElem, this.onTransEnd, this);\r\n\r\n        this.openCardsAfterRender();\r\n\r\n        setTimeout(function () {\r\n            df.dom.addClass(that._eElem, \"WebAc_Rendered\");\r\n        }, 100);\r\n\r\n    }\r\n\r\n    openCardsAfterRender() {\r\n\r\n        if (this.pbMultiOpen) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                const oTab = this._aCards[i];\r\n                if (oTab.pbExpanded || oTab._bExpanded) {\r\n                    this.showCard(oTab, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    renderChildren(eContainer) {\r\n        let eRenderTo, bDynamic = this.hasDynamicHeight();\r\n\r\n        //  Determine initial current card\r\n        if (this.pbOpenFirst) {\r\n            if (this.psCurrentCard) {\r\n                this._oCurrent = this.getWebApp().findObj(this.psCurrentCard);\r\n            }\r\n\r\n            for (let i = 0; i < this._aCards.length && !this._oCurrent; i++) {\r\n                if (this._aCards[i].isActive()) {\r\n                    this._oCurrent = this._aCards[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        eRenderTo = this._eControl = df.dom.query(this._eElem, 'div.' + this._sCardClass + '_Body');\r\n\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            //  Generate and append button\r\n            const aHtml = [];\r\n            this._aCards[i].tabButtonHtml(aHtml);\r\n            const eButton = df.dom.create(aHtml.join(\"\"));\r\n            eRenderTo.appendChild(eButton);\r\n            this._aCards[i].btnRendered(eButton);\r\n            // this._aCards[i]._eBtn = eButton;\r\n\r\n            if (bDynamic || this._aCards[i] === this._oCurrent) {\r\n                const eTab = this._aCards[i].render();\r\n                eRenderTo.appendChild(eTab);\r\n            }\r\n        }\r\n    }\r\n\r\n    showCard(oDisplay, bOptFirst) {\r\n        const that = this;\r\n\r\n        if (this.isEnabled() || bOptFirst) {\r\n            if (this.pbMultiOpen) {\r\n                if (oDisplay && !bOptFirst) {\r\n                    oDisplay._bExpanded = true;\r\n                    oDisplay._show();\r\n                    oDisplay.afterShow();\r\n                }\r\n            } else {\r\n                if (oDisplay && oDisplay.isActive()) {\r\n                    //  Fire cardchange event if needed\r\n                    if (!bOptFirst && oDisplay !== this._oCurrent) {\r\n                        this.fireCardChange(oDisplay._sName, (this._oCurrent && this._oCurrent._sName) || \"\");\r\n                    }\r\n\r\n                    //  Visit all tabs showing / hiding them\r\n                    if (this._eElem) {\r\n                        for (let i = 0; i < this._aCards.length; i++) {\r\n                            const oTab = this._aCards[i];\r\n\r\n                            if (oTab === oDisplay) {\r\n                                oTab._show(!!bOptFirst);\r\n\r\n                                df.dom.setText(this._eLabel, oTab.psCaption);\r\n                            } else {\r\n                                oTab._hide(!!bOptFirst);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //  Trigger afterHide\r\n                    if (!this.pbMultiOpen) {\r\n                        if (!bOptFirst && this._oCurrent) {\r\n                            this._oCurrent.afterHide();\r\n                        }\r\n                    }\r\n\r\n                    this._oCurrent = oDisplay;\r\n\r\n                    //  Trigger afterShow\r\n                    if (!bOptFirst) {\r\n                        this._oCurrent.afterShow();\r\n                    }\r\n\r\n                    if (this.getWebApp()) {\r\n                        this.getWebApp().notifyLayoutChange(this);\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n\r\n            if (!this.pbFillHeight && (!this.pbAutoHeight || this.pbMultiOpen)) {\r\n                this.sizeChanged(true);\r\n\r\n                setTimeout(function () {\r\n                    that.sizeChanged(true);\r\n                }, 1000);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    Override renderAllCards to make sure that the card elements are placed as next sibling of the tab \r\n    buttons.\r\n    \r\n    @private\r\n    */\r\n    renderAllCards() {\r\n\r\n        for (let i = 0; i < this._aCards.length; i++) {\r\n            const oCard = this._aCards[i];\r\n            if (!oCard._eElem) {\r\n                const eElem = oCard.render();\r\n                if (!oCard._eBtn) {\r\n                    throw new df.Error(999, \"Assertion: Accordion card should have a button element!\");\r\n                } else {\r\n                    if (oCard._eBtn.nextSibling) {\r\n                        oCard._eBtn.parentNode.insertBefore(eElem, oCard._eBtn.nextSibling);\r\n                    } else {\r\n                        oCard._eBtn.parentNode.appendChild(eElem);\r\n                    }\r\n                }\r\n                oCard.afterRender();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    \r\n    @param  iExtHeight  The height determined by the container (-1 means suite yourself).\r\n    @return The height that is actually applied.\r\n    */\r\n    sizeHeight(iExtHeight) {\r\n        let iHeight = -1;\r\n\r\n        //  Determine which height to use\r\n        if (this.pbFillHeight) {\r\n            iHeight = iExtHeight;\r\n        } else {\r\n            if (this.piHeight > 0) {\r\n                iHeight = this.piHeight;\r\n            }\r\n        }\r\n\r\n        //  Respect minimal height\r\n        if (iHeight < this.piMinHeight) {\r\n            iHeight = this.piMinHeight;\r\n        }\r\n\r\n        //  Update the height\r\n        this.setHeight(iHeight);\r\n\r\n        //  Return the final height\r\n        if (iHeight > 0) {\r\n            return iHeight;\r\n        }\r\n    }\r\n\r\n    setHeight(iHeight) {\r\n        super.setHeight(iHeight);\r\n\r\n        if (this.pbFillHeight && this._oCurrent) {\r\n            this._oCurrent._eElem.style.height = this.getCardHeight(this._oCurrent) + \"px\";\r\n        }\r\n    }\r\n\r\n    getCardHeight(oCard, iNaturalHeight) {\r\n        let iHeight;\r\n\r\n        if (this.pbAutoHeight || this.pbFillHeight) {\r\n            if (this.piHeight > 0 || this.pbFillHeight) {\r\n                iHeight = df.dom.clientHeight(this._eControl);\r\n\r\n                iHeight -= df.sys.gui.getVertBoxDiff(this._eControl, 2);\r\n\r\n                for (var i = 0; i < this._aCards.length; i++) {\r\n                    if (this._aCards[i]._eBtn) {\r\n                        iHeight -= this._aCards[i]._eBtn.offsetHeight;\r\n                    }\r\n                }\r\n\r\n                return iHeight;\r\n            } else {\r\n                return this.getNaturalHeight() - this.getHeightDiff();\r\n            }\r\n        } else {\r\n            return (oCard && df.dom.clientHeight(oCard._eSizer)) || 0;\r\n        }\r\n\r\n    }\r\n\r\n    attachFocusEvents() {\r\n\r\n    }\r\n\r\n    resize() {\r\n        let iCardHeight = 0;\r\n\r\n        if (this._eElem && this._bRendered) {\r\n            if (this.pbAutoHeight || this.pbFillHeight) {\r\n                iCardHeight = this.getCardHeight(null);\r\n            }\r\n\r\n            //  Resize the tabpages\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                if (this._aCards[i]._eElem) {\r\n                    if (iCardHeight > 0) {\r\n                        this._aCards[i]._eContainer.style.height = iCardHeight + \"px\";\r\n                    } else {\r\n                        this._aCards[i]._eContainer.style.height = \"\";\r\n                    }\r\n\r\n                    this._aCards[i].resizeHorizontal();\r\n                    this._aCards[i].resizeVertical();\r\n                }\r\n            }\r\n\r\n            //  A resize can also mean that the tab page size changed, if pbFillHeight is true sizeHeight will be called by container, if not we force it here!\r\n            if (!this.pbFillHeight) {\r\n                this.sizeHeight(-1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /* \r\n    On transitionend (which triggers after the transition for opening / closing a card finishes) we will \r\n    trigger a resize.\r\n    \r\n    @param  oEv     DOM Event object.\r\n    @private\r\n    */\r\n    onTransEnd(oEv) {\r\n        this.sizeChanged(true);\r\n    }\r\n\r\n    set_pbMultiOpen(bVal) {\r\n        this.pbMultiOpen = bVal;\r\n\r\n        if (!bVal) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                this._aCards[i]._bExpanded = false;\r\n            }\r\n\r\n            //  Make sure that only one card will be shown\r\n            if (this._oCurrent) {\r\n                this.showCard(this._oCurrent);\r\n            }\r\n        }\r\n    }\r\n\r\n    set_pbAutoHeight(bVal) {\r\n        if (this.pbAutoHeight !== bVal) {\r\n            this.pbAutoHeight = bVal;\r\n\r\n            this.triggerCardResize(!bVal);\r\n        }\r\n    }\r\n\r\n    set_pbFillHeight(bVal) {\r\n        if (this.pbFillHeight !== bVal) {\r\n            super.set_pbFillHeight(bVal);\r\n\r\n            this.triggerCardResize(!bVal);\r\n        }\r\n    }\r\n\r\n    /* \r\n    Triggers the cards to resize themselves and clears innerHeights that might have been set. This is \r\n    used when dynamically changing pbAutoHeight and pbFillHeight.\r\n    \r\n    #param  bClearInnerHeight       If true the innerheight of the cards will be reset.\r\n    @private\r\n    */\r\n    triggerCardResize(bClearInnerHeight) {\r\n\r\n        //  Clear the innerheight that is set by the WebBaseContainer resizeVertical\r\n        if (bClearInnerHeight) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                this._aCards[i].setInnerHeight(0);\r\n            }\r\n        }\r\n\r\n        //  Reopen the cards to enforce proper height recalculation\r\n        if (this.pbMultiOpen) {\r\n            for (let i = 0; i < this._aCards.length; i++) {\r\n                if (this._aCards[i]._bExpanded) {\r\n                    this._aCards[i]._show();\r\n                }\r\n            }\r\n        } else {\r\n            if (this._oCurrent) {\r\n                this.showCard(this._oCurrent);\r\n            }\r\n        }\r\n\r\n        this.sizeChanged(true);\r\n    }\r\n};","import { WebCard } from './WebCard.js';\r\n/* \r\nClass:\r\n    df.WebAccordionCard\r\nExtends:\r\n    df.WebCard\r\n\r\nAccordion control that based on card container technology. It supports multiple modes with \r\npbMultiOpen, pbAutoHeight and pbOpenFirst. The df.WebAccordionCard implements the card interface.\r\n\r\nRevision:\r\n    2016/10/06  (HW, DAW)\r\n        Refactored into df.WebAccordionContainer.\r\n    2016/06/27  (HW, DAW)\r\n        Migrated to DataFlex 18.2 with support for the deferred card rendering and isEnabled.\r\n    2015/09/29  (HW, DAW)\r\n        Initial version.\r\n*/\r\nexport class WebAccordionCard extends WebCard {\r\n    constructor(sName, oPrnt) {\r\n        super(sName, oPrnt);\r\n\r\n        this.prop(df.tBool, \"pbExpanded\", false);\r\n        this.prop(df.tString, \"psBtnBackgroundColor\", \"\");\r\n\r\n        this._bExpanded = false;\r\n\r\n        this.addSync(\"pbExpanded\");\r\n\r\n        //  Configure super classes\r\n        this._sControlClass = \"WebAcCard\";\r\n        this._sBaseClass = \"\";\r\n        this._bCC = false; //  Used by the designer to filter cardcontainers from tab / accordion containers\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpOpenHtml(aHtml) {\r\n        aHtml.push('<div class=\"WebContainer\">');\r\n    }\r\n\r\n    /* \r\n    Empty stub allowing sub classes to slip in HTML.\r\n    \r\n    @private\r\n    */\r\n    wrpCloseHtml(aHtml) {\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    afterRender() {\r\n        super.afterRender();\r\n\r\n        if (this._bPanels) {\r\n            df.dom.on(\"transitionend\", this._eMainArea, this.onTransEndCancel, this);\r\n        } else {\r\n            df.dom.on(\"transitionend\", this._eContent, this.onTransEndCancel, this);\r\n        }\r\n\r\n        if (this.psBtnBackgroundColor) {\r\n            this.set_psBtnBackgroundColor(this.psBtnBackgroundColor);\r\n        }\r\n    }\r\n\r\n    show() {\r\n        if (!this._bExpanded) {\r\n            super.show();\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (this._bExpanded && this._oParent.pbMultiOpen) {\r\n            this._bExpanded = false;\r\n            this._hide();\r\n            this.afterHide();\r\n        }\r\n    }\r\n\r\n    /*\r\n    This event handler handles the click event of the tab button. \r\n    \r\n    @param  \r\n    */\r\n    onBtnClick(oEvent) {\r\n        if (this.isEnabled()) {\r\n            if (!this._bExpanded) {\r\n                this.show();\r\n            } else if (this._oParent.pbMultiOpen) {\r\n                this.hide();\r\n            }\r\n        }\r\n        oEvent.stop();\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebTabPanel to hide this tab page. Note that switching a tab always \r\n    causes this method to be called regardless whether it was already hidden.\r\n    \r\n    @param  bFirst  True if this method is called during initialization.\r\n    @private\r\n    */\r\n    _hide(bFirst) {\r\n        if (this._eElem) {\r\n            this._eElem.style.visibility = \"hidden\";\r\n            df.dom.addClass(this._eElem, \"WebAcCard_Hidden\");\r\n            df.dom.removeClass(this._eElem, \"WebAcCard_Visible\");\r\n            df.dom.removeClass(this._eBtn, \"WebTab_Current\");\r\n            this._eElem.style.height = \"0px\";\r\n        }\r\n\r\n        if (!bFirst && this._bCurrent) {\r\n            this.fire('OnHide');\r\n        }\r\n\r\n        this._bCurrent = false;\r\n    }\r\n\r\n    /*\r\n    This method is called by the WebTabPanel to show this tab page.\r\n    \r\n    @param  bFirst  True if this method is called during initialization.\r\n    @private\r\n    */\r\n    _show(bFirst) {\r\n        if (!this._eElem && this._oParent._eElem) {\r\n            //  We render the card if it wasn't rendered yet\r\n            var eElem = this.render();\r\n            if (!this._eBtn) {\r\n                throw new df.Error(999, \"Assertion: Accordion card should have a button element!\");\r\n            } else {\r\n                if (this._eBtn.nextSibling) {\r\n                    this._eBtn.parentNode.insertBefore(eElem, this._eBtn.nextSibling);\r\n                } else {\r\n                    this._eBtn.parentNode.appendChild(eElem);\r\n                }\r\n            }\r\n\r\n            this.afterRender();\r\n\r\n            /* this.resizeHorizontal();\r\n            this.resizeVertical(); */\r\n            this._oParent.resize();\r\n        }\r\n\r\n        if (this._eElem) {\r\n            this._eElem.style.visibility = \"inherit\";\r\n            df.dom.addClass(this._eElem, \"WebAcCard_Visible\");\r\n            df.dom.removeClass(this._eElem, \"WebAcCard_Hidden\");\r\n            df.dom.addClass(this._eBtn, \"WebTab_Current\");\r\n            this._eElem.style.height = this._oParent.getCardHeight(this) + \"px\";\r\n        }\r\n\r\n        if (!bFirst && !this._bCurrent) {\r\n            this.fire('OnShow');\r\n        }\r\n        this._bCurrent = true;\r\n    }\r\n\r\n    get_pbExpanded() {\r\n        return this._bExpanded;\r\n    }\r\n\r\n    set_pbExpanded(bVal) {\r\n        if (this._Elem && bVal !== this._bExpanded) {\r\n            this.show();\r\n        }\r\n    }\r\n\r\n    set_psBtnBackgroundColor(sVal) {\r\n        if (this._eBtn) {\r\n            this._eBtn.style.background = sVal || '';\r\n        }\r\n    }\r\n\r\n    /* \r\n    Handles the transitionend of the content div and stops propagation. We don't want every transition \r\n    of anything inside the container to trigger a resize. Only at the end of its own transition.\r\n    \r\n    @param  oEv     DOM Event object.\r\n    @private\r\n    */\r\n    onTransEndCancel(oEv) {\r\n        oEv.stopPropagation();\r\n    }\r\n}","import { WebObject } from './WebObject.js';\r\nimport { df } from '../df.js';\r\n/*\r\nClass:\r\n    df.WebGeoLocation\r\nExtends:\r\n    df.WebObject\r\n\r\nA simple wrapper for the navigator.geolocation API. It makes\r\n    \r\nRevision:\r\n    2017/07/26  (HW, DAW) \r\n        Initial version.\r\n    2020/03/04  (HW, DAW)\r\n        Merged into the framework.\r\n*/\r\nexport class WebGeoLocation extends WebObject {\r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n\r\n        //  Enables position tracking / watching\r\n        this.prop(df.tBool, \"pbTracking\", false);\r\n        this.prop(df.tBool, \"pbAutoStart\", true);\r\n        this.prop(df.tBool, \"pbAutoStop\", true);\r\n\r\n        //  Properties representing latest position\r\n        this.prop(df.tNum, \"pnLatitude\", 0.0);\r\n        this.prop(df.tNum, \"pnLongitude\", 0.0);\r\n        this.prop(df.tNum, \"pnAccuracy\", 0.0);\r\n        this.prop(df.tNum, \"pnSpeed\", 0.0);\r\n        this.prop(df.tNum, \"pnHeading\", 0.0);\r\n\r\n        //  Configuration options\r\n        this.prop(df.tBool, \"pbEnableHighAccuracy\", false);\r\n        this.prop(df.tInt, \"piMaxTimeout\", 0);\r\n        this.prop(df.tInt, \"piMinTimeout\", 200);\r\n        this.prop(df.tInt, \"piMaxAge\", 0);\r\n\r\n        //  Events for tracking\r\n        this.event(\"OnLocationChange\", df.cCallModeDefault);\r\n        this.event(\"OnError\", df.cCallModeDefault);\r\n\r\n        //  Mark position props as synchronized\r\n        this.addSync(\"pnLatitude\");\r\n        this.addSync(\"pnLongitude\");\r\n        this.addSync(\"pnAccuracy\");\r\n        this.addSync(\"pnSpeed\");\r\n        this.addSync(\"pnHeading\");\r\n\r\n        // @privates\r\n        this._iWatchId = null;\r\n        this._oView = null;\r\n        this._iLocChTime = 0;\r\n        this._iLocChTimer = null;\r\n    }\r\n\r\n    /*\r\n    Initialization.\r\n    \r\n    @private\r\n    */\r\n    create() {\r\n        super.create();\r\n\r\n        this.set_pbTracking(this.pbTracking);   //  If tracking is on we simply enable\r\n\r\n        //  Check if we are in a view, if so we listen to its OnShow and OnHide events, else we just start it\r\n        this._oView = this.getView();\r\n        if (this._oView) {\r\n            this._oView.OnShow.on(this.showView, this);\r\n            this._oView.OnHide.on(this.hideView, this);\r\n        } else {\r\n            if (this.pbAutoStart) {\r\n                this.set(\"pbTracking\", false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    Cleanup.\r\n    \r\n    @private\r\n    */\r\n    destroy() {\r\n        super.destroy();\r\n\r\n        if (this._oView) {\r\n            this._oView.OnShow.off(this.showView, this);\r\n            this._oView.OnHide.off(this.hideView, this);\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    This method handles the OnShow event of the view which starts the timer if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    showView(oEvent) {\r\n        if (this.pbAutoStart) {\r\n            this.set(\"pbTracking\", true);\r\n        }\r\n    }\r\n\r\n    /*\r\n    This method handles the OnHide event of the view which stops the timer if needed.\r\n    \r\n    @param  oEvent  Event object.\r\n    @private\r\n    */\r\n    hideView(oEvent) {\r\n        if (this.pbAutoStop) {\r\n            this.set(\"pbTracking\", false);\r\n        }\r\n    }\r\n\r\n\r\n    /*\r\n    Performs a single getCurrentPosition to query the location once. Performs a callback with the result.\r\n    \r\n    @param  sCallbackMsg    Serveraction to which callback is sent.\r\n    @param  sCallbackObj    Name of callback WO (if none this is used).\r\n    @client-action\r\n    */\r\n    queryLocation(sCallbackMsg, sCallbackObj) {\r\n        const that = this;\r\n\r\n        if (navigator.geolocation) {\r\n            navigator.geolocation.getCurrentPosition(function (position) {\r\n                that.updateProps(position);\r\n\r\n                that.serverAction(\"QueryLocation_Callback\", [sCallbackMsg, sCallbackObj, 0, df.fromNumber(that.pnLatitude), df.fromNumber(that.pnLongitude), df.fromNumber(that.pnAccuracy), df.fromNumber(that.pnSpeed), df.fromNumber(that.pnHeading)]);\r\n            },\r\n                function (locationerror) {\r\n                    that.serverAction(\"QueryLocation_Callback\", [sCallbackMsg, sCallbackObj, locationerror.code, \"0\", \"0\", \"0\", \"0\", \"0\"]);\r\n                    that.fire(\"OnError\", [locationerror.code, locationerror.message]);\r\n                }, this.geoOptions());\r\n        }\r\n    }\r\n\r\n    /*\r\n    Updates position properties based on a GeolocationPosition object.\r\n    \r\n    @param  position    GeolocationPosition object.\r\n    @private\r\n    */\r\n    updateProps(position) {\r\n        this.pnLatitude = position.coords.latitude;\r\n        this.pnLongitude = position.coords.longitude;\r\n        this.pnAccuracy = position.coords.accuracy || 0;\r\n        this.pnSpeed = position.coords.speed || 0;\r\n        this.pnHeading = position.coords.heading || 0;\r\n    }\r\n\r\n    /*\r\n    Fires the actual server OnLocationChange event.\r\n    \r\n    @private\r\n    */\r\n    fireLocationChange() {\r\n        this.fireEx({\r\n            sEvent: \"OnLocationChange\",\r\n            aParams: [df.fromNumber(this.pnLatitude), df.fromNumber(this.pnLongitude), df.fromNumber(this.pnAccuracy), df.fromNumber(this.pnSpeed), df.fromNumber(this.pnHeading)],\r\n            oEnv: this,\r\n            sAltServerName: \"TriggerLocationChange\"\r\n        });\r\n\r\n        this._iLocChTime = (new Date()).getTime();\r\n    }\r\n\r\n    /*\r\n    Tracker callback function that fires OnLocationChange after updating position properties.\r\n    \r\n    @param  position    GeolocationPosition object.\r\n    @private\r\n    */\r\n    trackPosition(position) {\r\n        const that = this;\r\n\r\n        this.updateProps(position);\r\n\r\n        const iDiff = (new Date()).getTime() - this._iLocChTime;\r\n        if (this.piMaxTimeout > 0 && iDiff < this.piMaxTimeout) {\r\n            if (!this._iLocChTimer) {\r\n                this._iLocChTimer = setTimeout(function () {\r\n                    that.fireLocationChange();\r\n                    this._iLocChTimer = null;\r\n                }, iDiff);\r\n            }\r\n        } else {\r\n            that.fireLocationChange();\r\n        }\r\n    }\r\n\r\n    /*\r\n    Setter for pbTracking that enables or clears watchPosition based on the value.\r\n    \r\n    @param  bVal    New value.\r\n    */\r\n    set_pbTracking(bVal) {\r\n        const that = this;\r\n\r\n        if (bVal !== (this._iWatchId !== null)) {\r\n            if (bVal) {\r\n                if (navigator.geolocation) {\r\n                    this._iWatchId = navigator.geolocation.watchPosition(function (position) {\r\n                        that.trackPosition(position);\r\n                    }, function (locationerror) {\r\n                        that.fire(\"OnError\", [locationerror.code, locationerror.message]);\r\n                    }, this.geoOptions());\r\n                }\r\n            } else {\r\n                if (navigator.geolocation && this._iWatchId !== null) {\r\n                    navigator.geolocation.clearWatch(this._iWatchId);\r\n                }\r\n\r\n                this._iWatchId = null;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n    Creates a PositionOptions object based on configuration properties.\r\n    \r\n    @private\r\n    */\r\n    geoOptions() {\r\n        return {\r\n            enableHighAccuracy: this.pbEnableHighAccuracy,\r\n            maximumAge: (this.piMaxAge > 0 ? this.piMaxAge : Infinity),\r\n            timeout: (this.piMaxTimeout > 0 ? this.piMaxTimeout : Infinity)\r\n        };\r\n    }\r\n\r\n\r\n}","import { WebBaseControl } from './WebBaseControl.js';\r\nimport { df } from '../df.js';\r\n\r\n\r\nexport class WebDrawing extends WebBaseControl {\r\n    constructor(sName, oParent) {\r\n        // Configure superclasses\r\n        super(sName, oParent);\r\n\r\n        // Properties\r\n        this.prop(df.tInt, \"peDrawingJustification\", 0);\r\n        this.prop(df.tInt, \"piDrawingWidth\", 0);\r\n        this.prop(df.tInt, \"piDrawingHeight\", 0);\r\n        this.prop(df.tInt, \"peResizeMode\", 0);\r\n        this.prop(df.tBool, \"pbNoContextMenu\", false);\r\n        this.prop(df.tBool, \"pbZoomable\", false);\r\n        this.prop(df.tNumber, \"pfMinZoom\", 0.125);\r\n        this.prop(df.tNumber, \"pfMaxZoom\", 4);\r\n        this.prop(df.tNumber, \"pfDefaultZoom\", 1);\r\n        this.prop(df.tBool, \"pbClientOnResize\", false);\r\n        this.prop(df.tBool, \"pbDebugOutline\", false);\r\n        this.prop(df.tInt, \"piDebugOutlineWidth\", 1);\r\n        this.prop(df.tString, \"psDebugOutlineColor\", \"\");\r\n        this.prop(df.tBool, \"pbShowBorder\", false);\r\n        this.prop(df.tString, \"psCanvasBackgroundColor\", \"\");\r\n\r\n        /** @type {SVGGraphicsElement | null} */\r\n        this._eDrawing = null;\r\n        /** @type {Map<string, DrawingItem>} */\r\n        this.drawingItemMap = new Map();\r\n        this.drawingsBuffered = false;\r\n\r\n        /** @type {number} */\r\n        this.globalScale = 1;\r\n        /** @type {Position} */\r\n        this.panOffset = { x: 0, y: 0 };\r\n        /** @type {Position} */\r\n        this.previousMousePosition = undefined;\r\n\r\n        this.ns = \"http://www.w3.org/2000/svg\";\r\n\r\n        this._zoomBtns = undefined;\r\n        this._btnZoomIn = undefined;\r\n        this._btnZoomOut = undefined;\r\n        this._btnZoomReset = undefined;\r\n\r\n        this.wdResizeModeDisabled = 0;\r\n        this.wdResizeModeScale = 1;\r\n        this.wdResizeModeCrop = 2;\r\n\r\n        this.wdInteractionOnMouseDown = 1;\r\n        this.wdInteractionOnMouseUp = 2;\r\n        this.wdInteractionOnMouseEnter = 4;\r\n        this.wdInteractionOnMouseLeave = 8;\r\n        this.wdInteractionOnMouseMove = 16;\r\n        this.wdInteractionOnMouseClick = 32;\r\n        this.wdInteractionOnMouseDoubleClick = 64;\r\n        this.wdInteractionOnMouseDrag = 128;\r\n\r\n        this._bJSSizing = true;\r\n\r\n    }\r\n\r\n    // Standard functions\r\n    create() {\r\n        // Throw error if scaling mode is enabled without a piDrawingWith and/or piDrawingHeight\r\n        if (this.peResizeMode === this.wdResizeModeScale && (this.piDrawingWidth <= 0 || this.piDrawingHeight <= 0)) {\r\n            throw new df.Error(999, \"A piDrawingWidth and piDrawingHeight have to be defined when peResizeMode is set to Scaling.\");\r\n        }\r\n\r\n        // Disallow pfMinZoom below 0\r\n        if (this.pfMinZoom < 0) {\r\n            throw new df.Error(999, \"pfMinZoom cannot go below 0\");\r\n        }\r\n\r\n        // Disallow pfMinZoom to be higher than pfMaxZoom\r\n        if (this.pfMinZoom > this.pfMaxZoom) {\r\n            throw new df.Error(999, \"pfMinZoom cannot be higher than pfMaxZoom\");\r\n        }\r\n\r\n        // Disallow pfMaxZoom to be lower than pfMinZoom\r\n        if (this.pfMaxZoom < this.pfMinZoom) {\r\n            throw new df.Error(999, \"pfMaxZoom cannot be lower than pfMinZoom\");\r\n        }\r\n\r\n        if (this.pfDefaultZoom < this.pfMinZoom || this.pfDefaultZoom > this.pfMaxZoom) {\r\n            throw new df.Error(999, \"The default zoom cannot be lower or higher than the pfMinZoom and/or pfMaxZoom\");\r\n        }\r\n    }\r\n\r\n    openHtml(aHtml) {\r\n        // Forward send\r\n        super.openHtml(aHtml);\r\n\r\n        aHtml.push('<div class=\"WebDrawing-wrp\">');\r\n        aHtml.push('    <div class=\"WebDrawing-wrp-inner\">');\r\n        aHtml.push('        <div class=\"WebDrawing-zoom-buttons\" style=\"display: none;\">');\r\n        aHtml.push('            <button class=\"WebDrawing-btn-zoom WebDrawing-btn-zoom-in\">+</button>');\r\n        aHtml.push('            <button class=\"WebDrawing-btn-zoom WebDrawing-btn-zoom-reset\">&#x21bb</button>');\r\n        aHtml.push('            <button class=\"WebDrawing-btn-zoom WebDrawing-btn-zoom-out\">-</button>');\r\n        aHtml.push('        </div>');\r\n        aHtml.push('        <svg xmlns=\"http://www.w3.org/2000/svg\" style=\"background-color:' + this.psCanvasBackgroundColor + '\"></svg>');\r\n        aHtml.push('    </div>');\r\n        aHtml.push('</div>');\r\n    }\r\n\r\n    afterRender() {\r\n        this.initializeDrawing();\r\n\r\n        if (this.drawingsBuffered) {\r\n            this.drawingsBuffered = false;\r\n            this.createSVGDomElements(this.drawingItemMap);\r\n        }\r\n\r\n        // Forward send\r\n        super.afterRender();\r\n\r\n        this.set_pbShowBorder(this.pbShowBorder);\r\n    }\r\n\r\n    initializeDrawing() {\r\n        this._eControl = df.dom.query(this._eElem, \".WebDrawing-wrp\");\r\n        this._eDrawing = this._eControl.querySelector(\"svg\");\r\n\r\n        this._zoomBtns = this._eControl.querySelector(\".WebDrawing-zoom-buttons\");\r\n        this._btnZoomIn = this._eControl.querySelector(\".WebDrawing-btn-zoom-in\");\r\n        this._btnZoomOut = this._eControl.querySelector(\".WebDrawing-btn-zoom-out\");\r\n        this._btnZoomReset = this._eControl.querySelector(\".WebDrawing-btn-zoom-reset\");\r\n\r\n        // Apply property settings\r\n        if (this.pbNoContextMenu) this._eDrawing.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n        if (this.pbDebugOutline) this._eDrawing.style.border = this.piDebugOutlineWidth + \"px solid black\", this._eDrawing.style.borderColor = this.psDebugOutlineColor;\r\n\r\n        if (this.pbZoomable) {\r\n            this._zoomBtns.style.display = \"block\";\r\n            this.globalScale = this.pfDefaultZoom;\r\n\r\n            this._eDrawing.addEventListener(\"wheel\", (event) => {\r\n                event.preventDefault();\r\n\r\n                this.globalScale += event.deltaY * -0.001;\r\n\r\n                this.updateViewBox();\r\n            });\r\n\r\n            this._eDrawing.addEventListener(\"mousedown\", (event) => {\r\n                this.previousMousePosition = this.getMousePos(event);\r\n            });\r\n\r\n            this._eDrawing.addEventListener(\"touchstart\", (event) => {\r\n                this.previousMousePosition = this.getTouchPos(event);\r\n            });\r\n\r\n            this._eDrawing.addEventListener(\"mousemove\", (event) => {\r\n                if (event.buttons !== 0) {\r\n                    if (this.previousMousePosition !== undefined) {\r\n                        event.preventDefault();\r\n\r\n                        // Do panning\r\n                        const currentMousePosition = this.getMousePos(event);\r\n                        this.viewPanning(currentMousePosition);\r\n                    }\r\n                }\r\n            });\r\n\r\n            this._eDrawing.addEventListener(\"touchmove\", (event) => {\r\n                if (this.previousMousePosition !== undefined) {\r\n                    event.preventDefault();\r\n\r\n                    // Do panning\r\n                    const currentMousePosition = this.getTouchPos(event);\r\n                    this.viewPanning(currentMousePosition);\r\n                }\r\n            });\r\n\r\n            this._btnZoomIn.addEventListener(\"click\", () => {\r\n                this.globalScale += 0.1;\r\n                this.updateViewBox();\r\n            });\r\n\r\n            this._btnZoomOut.addEventListener(\"click\", () => {\r\n                this.globalScale += -0.1;\r\n                this.updateViewBox();\r\n            });\r\n\r\n            this._btnZoomReset.addEventListener(\"click\", () => {\r\n                this.globalScale = this.pfDefaultZoom;\r\n                this.updateViewBox();\r\n            });\r\n        }\r\n\r\n        this.updateViewBox();\r\n    }\r\n\r\n    /**\r\n     * View panning\r\n     * @param {Position} currentMousePosition\r\n     * @private\r\n     */\r\n    viewPanning(currentMousePosition) {\r\n        // Calculate difference\r\n        const diffX = this.previousMousePosition.x - currentMousePosition.x;\r\n        const diffY = this.previousMousePosition.y - currentMousePosition.y;\r\n\r\n        let diffXScaled = diffX / this.globalScale;\r\n        let diffYScaled = diffY / this.globalScale;\r\n\r\n        if (this.peResizeMode === this.wdResizeModeScale) {\r\n            const ratio = Math.min(this._eControl.clientWidth / this.piDrawingWidth, this._eControl.clientHeight / this.piDrawingHeight);\r\n\r\n            diffXScaled = diffXScaled / ratio;\r\n            diffYScaled = diffYScaled / ratio;\r\n        }\r\n\r\n        this.panOffset.x += diffXScaled;\r\n        this.panOffset.y += diffYScaled;\r\n\r\n        this.updateViewBox();\r\n\r\n        this.previousMousePosition = currentMousePosition;\r\n    }\r\n\r\n    updateViewBox() {\r\n        this.globalScale = Math.min(Math.max(this.pfMinZoom, this.globalScale), this.pfMaxZoom); // Restrict scale\r\n\r\n        let width = this.piDrawingWidth;\r\n        let height = this.piDrawingHeight;\r\n\r\n        if (this.peResizeMode === this.wdResizeModeCrop) {\r\n            width = this._eControl.clientWidth;\r\n            height = this._eControl.clientHeight;\r\n        }\r\n\r\n        const centerX = width / 2;\r\n        const centerY = height / 2;\r\n\r\n        const newWidth = width / this.globalScale;\r\n        const newHeight = height / this.globalScale;\r\n\r\n        const offsetX = this.panOffset.x + (centerX - newWidth / 2);\r\n        const offsetY = this.panOffset.y + (centerY - newHeight / 2);\r\n\r\n        this._eDrawing.setAttributeNS(null, \"viewBox\", `${offsetX} ${offsetY} ${newWidth} ${newHeight}`);\r\n    }\r\n\r\n\r\n    updateSizes() {\r\n        if (this.peResizeMode !== this.wdResizeModeDisabled) {\r\n            if (this._eControl.clientHeight) {\r\n                if (this._eDrawing.width.baseVal.value !== this._eControl.clientWidth || this._eDrawing.height.baseVal.value !== this._eControl.clientHeight) {\r\n                    if (this.peResizeMode === this.wdResizeModeScale) {\r\n                        const heightRatio = this._eControl.clientHeight / this.piDrawingHeight;\r\n                        const widthRatio = this._eControl.clientWidth / this.piDrawingWidth;\r\n\r\n                        const newWidth = this.piDrawingWidth * widthRatio;\r\n                        const newHeight = this.piDrawingHeight * heightRatio;\r\n\r\n                        this._eDrawing.setAttributeNS(null, \"width\", newWidth.toString());\r\n                        this._eDrawing.setAttributeNS(null, \"height\", newHeight.toString());\r\n                    }\r\n                    else if (this.peResizeMode === this.wdResizeModeCrop) {\r\n                        this._eDrawing.setAttributeNS(null, \"width\", this._eControl.clientWidth.toString());\r\n                        this._eDrawing.setAttributeNS(null, \"height\", this._eControl.clientHeight.toString());\r\n                    }\r\n\r\n                    this.updateViewBox();\r\n\r\n                    if (this.pbClientOnResize) {\r\n                        const dataToSend = this.createResizeEventData(this._eDrawing.width.baseVal.value, this._eDrawing.height.baseVal.value);\r\n                        this.serverAction(\"HandleResize\", [], dataToSend);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._eDrawing.setAttributeNS(null, \"width\", this.piDrawingWidth.toString());\r\n            this._eDrawing.setAttributeNS(null, \"height\", this.piDrawingHeight.toString());\r\n        }\r\n    }\r\n\r\n    setHeight(iHeight, bSense) {\r\n        super.setHeight(iHeight, bSense);\r\n\r\n        if (bSense) {\r\n            df.dom.animFrame(this.updateSizes, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create resize event data\r\n     * @param {number} viewWidth The view width\r\n     * @param {number} viewHeight The view height\r\n     * @private\r\n     */\r\n    createResizeEventData(viewWidth, viewHeight) {\r\n        const data = {};\r\n\r\n        data.fViewWidth = viewWidth;\r\n        data.fViewHeight = viewHeight;\r\n\r\n        return data;\r\n    }\r\n\r\n    // Client Events\r\n\r\n    /**\r\n     * Update drawing instructions\r\n     */\r\n    updateInstructions() {\r\n        this.drawingItemMap = this.collectInstructions(this._tActionData, this.drawingItemMap);\r\n\r\n        this.setGroupingPositions();\r\n        this.updateDrawing();\r\n    }\r\n\r\n    /**\r\n     * Reset and clear the entire drawing\r\n     */\r\n    clearDrawing() {\r\n        if (this._eDrawing) {\r\n            this.drawingItemMap = new Map();\r\n            this._eDrawing.innerHTML = \"\";\r\n            this.initializeDrawing();\r\n        }\r\n    }\r\n\r\n    // Collect and apply instructions\r\n\r\n    /**\r\n     * Update the drawing\r\n     * @private\r\n     */\r\n    updateDrawing() {\r\n        if (this._eDrawing) {\r\n            this.createSVGDomElements(this.drawingItemMap);\r\n        } else {\r\n            this.drawingsBuffered = true;\r\n        }\r\n    }\r\n\r\n    setGroupingPositions() {\r\n        for (const id of this.drawingItemMap.keys()) {\r\n            const drawingItem = this.drawingItemMap.get(id);\r\n            if (drawingItem.subDrawingItemMap.size > 0) {\r\n                drawingItem.drawingItemData.position = this.getCentroidOfGrouping(drawingItem);\r\n                this.drawingItemMap.set(id, drawingItem);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adjust the position of grouping children\r\n     * @param {DrawingItem} drawingItem\r\n     * @param {Position} currentCenter\r\n     * @returns {DrawingItem}\r\n     * @private\r\n     */\r\n    adjustChildrenPosition(drawingItem, currentCenter) {\r\n        if (drawingItem.subDrawingItemMap.size > 0) {\r\n            for (const [id, childDrawingItem] of drawingItem.subDrawingItemMap.entries()) {\r\n                const childCurrentCenter = this.cloneObject(childDrawingItem.drawingItemData.position);\r\n\r\n                const diffX = childDrawingItem.drawingItemData.position.x - currentCenter.x;\r\n                const diffY = childDrawingItem.drawingItemData.position.y - currentCenter.y;\r\n\r\n                childDrawingItem.drawingItemData.position.x = drawingItem.drawingItemData.position.x + diffX;\r\n                childDrawingItem.drawingItemData.position.y = drawingItem.drawingItemData.position.y + diffY;\r\n\r\n                if (childDrawingItem.drawingItemData.shape !== undefined) {\r\n                    switch (childDrawingItem.drawingItemData.shape.type) {\r\n                        case \"rectangle\":\r\n                        case \"rounded-rectangle\":\r\n                        case \"image\": {\r\n                            const diffTLX = childDrawingItem.drawingItemData.shape.data.topLeft.x - currentCenter.x;\r\n                            const diffTLY = childDrawingItem.drawingItemData.shape.data.topLeft.y - currentCenter.y;\r\n                            const diffBRX = childDrawingItem.drawingItemData.shape.data.bottomRight.x - currentCenter.x;\r\n                            const diffBRY = childDrawingItem.drawingItemData.shape.data.bottomRight.y - currentCenter.y;\r\n\r\n                            childDrawingItem.drawingItemData.shape.data.topLeft.x = drawingItem.drawingItemData.position.x + diffTLX;\r\n                            childDrawingItem.drawingItemData.shape.data.topLeft.y = drawingItem.drawingItemData.position.y + diffTLY;\r\n                            childDrawingItem.drawingItemData.shape.data.bottomRight.x = drawingItem.drawingItemData.position.x + diffBRX;\r\n                            childDrawingItem.drawingItemData.shape.data.bottomRight.y = drawingItem.drawingItemData.position.y + diffBRY;\r\n                            break;\r\n                        }\r\n                        case \"path\": {\r\n                            for (const subPoint of childDrawingItem.drawingItemData.shape.data.subPoints) {\r\n                                const diffPosX = subPoint.position.x - currentCenter.x;\r\n                                const diffPosY = subPoint.position.y - currentCenter.y;\r\n\r\n                                subPoint.position.x = drawingItem.drawingItemData.position.x + diffPosX;\r\n                                subPoint.position.y = drawingItem.drawingItemData.position.y + diffPosY;\r\n\r\n                                if (subPoint.position2) {\r\n                                    const diffPos2X = subPoint.position2.x - currentCenter.x;\r\n                                    const diffPos2Y = subPoint.position2.y - currentCenter.y;\r\n\r\n                                    subPoint.position2.x = drawingItem.drawingItemData.position.x + diffPos2X;\r\n                                    subPoint.position2.y = drawingItem.drawingItemData.position.y + diffPos2Y;\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.adjustChildrenPosition(childDrawingItem, childCurrentCenter);\r\n\r\n                drawingItem.subDrawingItemMap.set(id, childDrawingItem);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Collect all instructions\r\n     * @param {RawInstruction[]} instructions Raw Instructions\r\n     * @param {Map<string, DrawingItem>} drawingItemMap The Drawing Item Map\r\n     * @private\r\n     */\r\n    collectInstructions(instructions, drawingItemMap) {\r\n        let untrackedIdIndex = 0;\r\n\r\n        for (let i = 0; i < instructions.length; i++) {\r\n            const instr = instructions[i];\r\n\r\n            /** @type {DrawingItem|null} */\r\n            let drawingItem = {\r\n                subDrawingItemMap: new Map(),\r\n                hasEntered: false,\r\n                hasLeft: true\r\n            };\r\n\r\n            // Add ! prefix to empty id to indicate special behaviour\r\n            if (instr.sId === \"\") {\r\n                if (instr.sType.startsWith(\"create-\")) {\r\n                    untrackedIdIndex++;\r\n                }\r\n\r\n                instr.sId = `!${untrackedIdIndex}`;\r\n            }\r\n\r\n            if (drawingItemMap.has(instr.sId)) {\r\n                drawingItem = drawingItemMap.get(instr.sId);\r\n            } else {\r\n                drawingItemMap.forEach(element => {\r\n\r\n                    if (element.subDrawingItemMap.size > 0) {\r\n\r\n                        if (element.subDrawingItemMap.has(instr.sId)) {\r\n                            drawingItem = element.subDrawingItemMap.get(instr.sId);\r\n                        }\r\n\r\n                    }\r\n\r\n                });\r\n            }\r\n\r\n            if (instr.sType === \"create-group\") {\r\n                const startSubInstructionIndex = instructions.findIndex(i => i.sType === \"create-group\" && i.sId === instr.sId);\r\n                const endSubInstructionIndex = instructions.findIndex(i => i.sType === \"end-create-group\" && i.sId === instr.sId);\r\n\r\n                if (endSubInstructionIndex === -1) {\r\n                    throw new df.Error(999, `Group \"${instr.sId}\" has no corresponding EndCreateGroup instruction.`);\r\n                }\r\n\r\n                const subInstructions = instructions.slice(startSubInstructionIndex + 1, endSubInstructionIndex);\r\n\r\n                // Take style instructions that should apply to the entire group\r\n                if (drawingItem.drawingItemData === undefined) {\r\n                    drawingItem.drawingItemData = {\r\n                        visible: true,\r\n                        shadowOffset: { x: 0, y: 0 },\r\n                        position: {x:0 , y:0}\r\n                    };\r\n                }\r\n\r\n                const groupInstructions = subInstructions.filter(si => si.sId === instr.sId);\r\n                for (const groupInstr of groupInstructions) {\r\n                    drawingItem = this.applyGroupedInstruction(drawingItem, groupInstr);\r\n                    const subInstrToRemove = subInstructions.findIndex(si => si.sId === groupInstr.sId && si.sType === groupInstr.sType);\r\n                    subInstructions.splice(subInstrToRemove, 1);\r\n                }\r\n\r\n                drawingItem.subDrawingItemMap = this.collectInstructions(subInstructions, drawingItem.subDrawingItemMap);\r\n\r\n                i = endSubInstructionIndex;\r\n            }\r\n            else if (instr.sType === \"create-layer\") {\r\n                const startSubInstructionIndex = instructions.findIndex(i => i.sType === \"create-layer\" && i.sId === instr.sId);\r\n                const endSubInstructionIndex = instructions.findIndex(i => i.sType === \"end-create-layer\" && i.sId === instr.sId);\r\n\r\n                if (endSubInstructionIndex === -1) {\r\n                    throw new df.Error(999, `Layer \"${instr.sId}\" has no corresponding EndCreateLayer instruction.`);\r\n                }\r\n\r\n                const subInstructions = instructions.slice(startSubInstructionIndex + 1, endSubInstructionIndex);\r\n\r\n                // Take style instructions that should apply to the entire group\r\n                if (drawingItem.drawingItemData === undefined) {\r\n                    drawingItem.drawingItemData = {\r\n                        visible: true,\r\n                        shadowOffset: { x: 0, y: 0 }\r\n                    };\r\n                }\r\n\r\n                drawingItem.subDrawingItemMap = this.collectInstructions(subInstructions, drawingItem.subDrawingItemMap);\r\n\r\n                i = endSubInstructionIndex;\r\n            }\r\n            else if (instr.sType === \"delete-item\") {\r\n                this.deleteItem(instr.sId);\r\n                drawingItem = null;\r\n            }\r\n            else {\r\n                if (drawingItem.subDrawingItemMap.size > 0) {\r\n                    drawingItem = this.applyGroupedInstruction(drawingItem, instr);\r\n                }\r\n                else {\r\n                    drawingItem = this.applyInstruction(drawingItem, instr);\r\n                }\r\n\r\n            }\r\n\r\n            if (drawingItem) {\r\n                drawingItemMap.set(instr.sId, drawingItem);\r\n            }\r\n        }\r\n\r\n        return drawingItemMap;\r\n    }\r\n\r\n    /**\r\n     * Apply raw instruction to the item map\r\n     * @param {DrawingItem} drawingItem The drawing item data\r\n     * @param {RawInstruction} instr The raw instruction\r\n     * @returns {DrawingItem} Applied instructions\r\n     * @private\r\n     */\r\n    applyInstruction(drawingItem, instr) {\r\n        drawingItem.drawingItemData = this.applyCreateInstruction(drawingItem.drawingItemData, instr);\r\n\r\n        if (drawingItem.drawingItemData === undefined) {\r\n            throw new df.Error(999, `There is no shape created for \"${instr.sId}\", cannot apply styling. Maybe you mistyped the ID?`);\r\n        }\r\n\r\n        drawingItem = this.applyNormalInstructions(drawingItem, instr);\r\n\r\n        return drawingItem;\r\n    }\r\n\r\n    /**\r\n     * Apply instructions for groupings\r\n     * @param {DrawingItem} drawingItem The drawing item data\r\n     * @param {RawInstruction} instr The raw instruction\r\n     * @returns {DrawingItem} Applied instructions\r\n     * @private\r\n     */\r\n    applyGroupedInstruction(drawingItem, instr) {\r\n        drawingItem = this.applyNormalInstructions(drawingItem, instr);\r\n\r\n        return drawingItem;\r\n    }\r\n\r\n    /**\r\n     * Create the data from the instructions\r\n     * @param {DrawingItemData} drawingItemData The drawing item data\r\n     * @param {RawInstruction} instr The raw instruction\r\n     * @returns {DrawingItemData} The created data\r\n     * @private\r\n     */\r\n    applyCreateInstruction(drawingItemData, instr) {\r\n        const typeName = instr.sType;\r\n        const params = instr.asParams;\r\n\r\n        if (typeName.startsWith(\"create-\") && this.mapHasId(instr.sId)) {\r\n            throw new df.Error(999, `A shape with the id \"${instr.sId}\" already exists`);\r\n        }\r\n\r\n        // Set some default values\r\n        if (drawingItemData === undefined) {\r\n            drawingItemData = {};\r\n            drawingItemData.position = { x: 0, y: 0 };\r\n            drawingItemData.scale = { width: 1, height: 1 };\r\n            drawingItemData.shadowOffset = { x: 0, y: 0 };\r\n            drawingItemData.visible = true;\r\n            drawingItemData.closed = false;\r\n        }\r\n\r\n        // Create shapes\r\n\r\n        switch (typeName) {\r\n            case \"create-rectangle\": {\r\n                const [posX, posY, width, height, radius] = params;\r\n\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.data = {\r\n                    topLeft: { x: parseFloat(posX), y: parseFloat(posY) },\r\n                    bottomRight: { x: parseFloat(posX) + parseFloat(width), y: parseFloat(posY) + parseFloat(height) }\r\n                };\r\n\r\n                if (params.length > 4) {\r\n                    drawingItemData.shape.type = \"rounded-rectangle\";\r\n                    drawingItemData.shape.data.radius = parseFloat(radius);\r\n                }\r\n                else {\r\n                    drawingItemData.shape.type = \"rectangle\";\r\n                }\r\n\r\n                // Set position to center of rectangle\r\n                drawingItemData.position = this.getCentroid([drawingItemData.shape.data.topLeft, drawingItemData.shape.data.bottomRight]);\r\n                break;\r\n            }\r\n            case \"create-circle\": {\r\n                const [posX, posY, radius] = params;\r\n\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.type = \"circle\";\r\n                drawingItemData.shape.data = {\r\n                    radius: parseFloat(radius)\r\n                };\r\n\r\n                // Set position to center of circle\r\n                drawingItemData.position.x = parseFloat(posX);\r\n                drawingItemData.position.y = parseFloat(posY);\r\n                break;\r\n            }\r\n            case \"create-ellipse\": {\r\n                const [posX, posY, radiusX, radiusY] = params;\r\n\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.type = \"ellipse\";\r\n                drawingItemData.shape.data = {\r\n                    radiusX: parseFloat(radiusX),\r\n                    radiusY: parseFloat(radiusY)\r\n                };\r\n                // Set position to center of ellipse\r\n                drawingItemData.position.x = parseFloat(posX);\r\n                drawingItemData.position.y = parseFloat(posY);\r\n                break;\r\n            }\r\n            case \"create-path\":\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.type = \"path\";\r\n                drawingItemData.shape.data = {\r\n                    subPoints: []\r\n                };\r\n                break;\r\n            case \"create-line\": {\r\n                const [pos1X, pos1Y, pos2X, pos2Y] = params;\r\n\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.type = \"path\";\r\n                drawingItemData.shape.data = {\r\n                    subPoints: []\r\n                };\r\n\r\n                drawingItemData.shape.data.subPoints.push({\r\n                    type: \"moveTo\",\r\n                    position: { x: parseFloat(pos1X), y: parseFloat(pos1Y) }\r\n                });\r\n                drawingItemData.shape.data.subPoints.push({\r\n                    type: \"lineTo\",\r\n                    position: { x: parseFloat(pos2X), y: parseFloat(pos2Y) }\r\n                });\r\n                break;\r\n            }\r\n            case \"create-text\": {\r\n                const [posX, posY, content, fontFamily, fontSize, justification, fontWeight, textDecoration] = params;\r\n\r\n                drawingItemData.shape = {};\r\n                drawingItemData.shape.type = \"text\";\r\n                drawingItemData.shape.params = params;\r\n                drawingItemData.textContent = content;\r\n                drawingItemData.position.x = parseFloat(posX);\r\n                drawingItemData.position.y = parseFloat(posY);\r\n                drawingItemData.fontFamily = fontFamily;\r\n                drawingItemData.fontSize = parseFloat(fontSize);\r\n                drawingItemData.fillColor = \"black\";\r\n                drawingItemData.strokeColor = \"transparent\";\r\n                if (params.length > 5) drawingItemData.justification = this.enumJustificationIntToString(parseInt(justification));\r\n                if (params.length > 6) drawingItemData.fontWeight = fontWeight;\r\n                if (params.length > 7) drawingItemData.textDecoration = textDecoration;\r\n                break;\r\n            }\r\n            case \"create-image\":\r\n            case \"create-svg\": {\r\n                const [path] = params;\r\n                drawingItemData.shape = this.getImageShapeData(params);\r\n                drawingItemData.imagePath = path;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return drawingItemData;\r\n    }\r\n\r\n    /**\r\n     * Get the shape data for an image or SVG\r\n     * @param {string[]} params\r\n     * @return {Shape} The image rectangle data\r\n     */\r\n    getImageShapeData(params) {\r\n        const [_, left, top, right, bottom] = params;\r\n\r\n        /** @type {Shape} */\r\n        const shape = {\r\n            type: \"image\"\r\n        };\r\n\r\n        if (params.length > 3) {\r\n            shape.data = {\r\n                topLeft: { x: parseFloat(left), y: parseFloat(top) },\r\n                bottomRight: { x: parseFloat(right), y: parseFloat(bottom) }\r\n            };\r\n        }\r\n        else {\r\n            shape.data = {\r\n                topLeft: { x: parseFloat(left), y: parseFloat(top) },\r\n            };\r\n        }\r\n\r\n        return shape;\r\n    }\r\n\r\n    /**\r\n     * Do processing for regular instruction types\r\n     * @param {DrawingItem} drawingItem The drawing item data\r\n     * @param {RawInstruction} instr The raw instruction\r\n     * @returns {DrawingItem} The processed instruction\r\n     * @private\r\n     */\r\n    applyNormalInstructions(drawingItem, instr) {\r\n        const typeName = instr.sType;\r\n        const params = instr.asParams;\r\n\r\n        switch (typeName) {\r\n            // Draw\r\n            case \"add\":\r\n                drawingItem.drawingItemData.shape.data.subPoints.push({\r\n                    type: \"add\",\r\n                    position: { x: parseFloat(params[0]), y: parseFloat(params[1]) }\r\n                });\r\n                drawingItem.drawingItemData.position = this.getCentroid(drawingItem.drawingItemData.shape.data.subPoints.map(sp => sp.position));\r\n                break;\r\n            case \"moveTo\":\r\n                drawingItem.drawingItemData.shape.data.subPoints.push({\r\n                    type: \"moveTo\",\r\n                    position: { x: parseFloat(params[0]), y: parseFloat(params[1]) }\r\n                });\r\n                drawingItem.drawingItemData.position = this.getCentroid(drawingItem.drawingItemData.shape.data.subPoints.map(sp => sp.position));\r\n                break;\r\n            case \"lineTo\":\r\n                drawingItem.drawingItemData.shape.data.subPoints.push({\r\n                    type: \"lineTo\",\r\n                    position: { x: parseFloat(params[0]), y: parseFloat(params[1]) }\r\n                });\r\n                drawingItem.drawingItemData.position = this.getCentroid(drawingItem.drawingItemData.shape.data.subPoints.map(sp => sp.position));\r\n                break;\r\n            case \"quadraticCurveTo\":\r\n                drawingItem.drawingItemData.shape.data.subPoints.push({\r\n                    type: \"quadraticCurveTo\",\r\n                    position: { x: parseFloat(params[2]), y: parseFloat(params[3]) },\r\n                    position2: { x: parseFloat(params[0]), y: parseFloat(params[1]) }\r\n                });\r\n                drawingItem.drawingItemData.position = this.getCentroid(drawingItem.drawingItemData.shape.data.subPoints.map(sp => sp.position));\r\n                break;\r\n            case \"closePath\":\r\n                drawingItem.drawingItemData.shape.data.subPoints.push({\r\n                    type: \"closePath\"\r\n                });\r\n                drawingItem.drawingItemData.closed = true;\r\n                break;\r\n            // Stroke style\r\n            case \"strokeWidth\":\r\n                drawingItem.drawingItemData.strokeWidth = parseFloat(params[0]);\r\n                break;\r\n            case \"strokeColor\":\r\n                drawingItem.drawingItemData.strokeColor = params[0];\r\n                break;\r\n            case \"strokeCap\":\r\n                drawingItem.drawingItemData.strokeCap = this.enumStrokeCapIntToString(parseInt(params[0]));\r\n                break;\r\n            case \"strokeJoin\":\r\n                drawingItem.drawingItemData.strokeJoin = this.enumStrokeJoinIntToString(parseInt(params[0]));\r\n                break;\r\n            case \"dashOffset\":\r\n                drawingItem.drawingItemData.dashOffset = parseFloat(params[0]);\r\n                break;\r\n            case \"strokeDashes\":\r\n                drawingItem.drawingItemData.strokeDistance = params[0];\r\n\r\n                if (params.length > 1) {\r\n                    drawingItem.drawingItemData.whitespaceDistance = params[1];\r\n                }\r\n                break;\r\n            // Fill style\r\n            case \"fillColor\":\r\n                drawingItem.drawingItemData.fillColor = params[0];\r\n                break;\r\n            // Shadow style\r\n            case \"shadowColor\":\r\n                drawingItem.drawingItemData.shadowColor = params[0];\r\n                break;\r\n            case \"shadowBlur\":\r\n                drawingItem.drawingItemData.shadowBlur = parseFloat(params[0]);\r\n                break;\r\n            case \"shadowOffset\":\r\n                drawingItem.drawingItemData.shadowOffset = { x: parseFloat(params[0]), y: parseFloat(params[1]) };\r\n                break;\r\n            // Font style\r\n            case \"fontFamily\":\r\n                drawingItem.drawingItemData.fontFamily = params[0];\r\n                break;\r\n            case \"fontSize\":\r\n                drawingItem.drawingItemData.fontSize = parseFloat(params[0]);\r\n                break;\r\n            case \"fontWeight\":\r\n                drawingItem.drawingItemData.fontWeight = params[0];\r\n                break;\r\n            case \"textDecoration\":\r\n                drawingItem.drawingItemData.textDecoration = params[0];\r\n                break;\r\n            case \"fontJustification\":\r\n                drawingItem.drawingItemData.justification = this.enumJustificationIntToString(parseInt(params[0]));\r\n                break;\r\n            case \"textContent\":\r\n                drawingItem.drawingItemData.textContent = params[0];\r\n                break;\r\n            // Visibility style\r\n            case \"set-visibility\":\r\n                drawingItem.drawingItemData.visible = (params[0] == true);\r\n                break;\r\n            case \"toggle-visibility\":\r\n                drawingItem.drawingItemData.visible = !drawingItem.drawingItemData.visible;\r\n                break;\r\n            case \"add-svg-attribute\":\r\n                drawingItem.drawingItemData.customAttribute = {customAttributeName: params[0], customAttributeValue: params[1]}\r\n                break;\r\n            // Transform\r\n            case \"position\": {\r\n                let currentPos;\r\n\r\n                drawingItem.drawingItemData.position.x = parseFloat(params[0]);\r\n                drawingItem.drawingItemData.position.y = parseFloat(params[1]);\r\n\r\n                if (drawingItem.drawingItemData.position !== undefined) {\r\n                    currentPos = this.cloneObject(drawingItem.drawingItemData.position)\r\n                    this.adjustChildrenPosition(drawingItem, currentPos);\r\n                }\r\n                break;\r\n            }\r\n            case \"rotation\":\r\n                drawingItem.drawingItemData.rotation = parseFloat(params[0]);\r\n                if (params.length > 1) {\r\n                    drawingItem.drawingItemData.rotateInPlace = params[1];\r\n                }\r\n                break;\r\n            case \"scaling\":\r\n                if (drawingItem.drawingItemData.scale === undefined) drawingItem.drawingItemData.scale = {};\r\n                drawingItem.drawingItemData.scale.width = parseFloat(params[0]);\r\n                drawingItem.drawingItemData.scale.height = parseFloat(params[1]);\r\n                break;\r\n            case \"enable-interaction\": {\r\n                // Set value to 0 if undefined\r\n                if (drawingItem.enabledInteractions === undefined) drawingItem.enabledInteractions = 0;\r\n\r\n                const flags = parseInt(params[0]);\r\n                drawingItem.enabledInteractions = drawingItem.enabledInteractions | flags;\r\n                break;\r\n            }\r\n            case \"disable-interaction\": {\r\n                // Set value to 0 if undefined\r\n                if (drawingItem.enabledInteractions === undefined) drawingItem.enabledInteractions = 0;\r\n                const flags = parseInt(params[0]);\r\n\r\n                // Only disable if the flag was actually set to prevent bitwise operation issues\r\n                if (drawingItem.enabledInteractions & flags) {\r\n                    drawingItem.enabledInteractions = drawingItem.enabledInteractions ^ flags;\r\n                }\r\n\r\n                break;\r\n            }\r\n            case \"add-tooltip\":\r\n                drawingItem.drawingItemData.tooltip = params[0];\r\n                break;\r\n        }\r\n\r\n        return drawingItem;\r\n    }\r\n\r\n    /**\r\n     * Get the centroid of groupings\r\n     * @param {DrawingItem} drawingItem\r\n     * @returns {Position}\r\n     */\r\n    getCentroidOfGrouping(drawingItem) {\r\n        /** @type {Position[]} */\r\n        const positions = [];\r\n\r\n        for (const subDrawingItem of drawingItem.subDrawingItemMap.values()) {\r\n            // Is grouping\r\n            if (subDrawingItem.subDrawingItemMap.size > 0) {\r\n                subDrawingItem.drawingItemData.position = this.getCentroidOfGrouping(subDrawingItem);\r\n            }\r\n\r\n            positions.push(subDrawingItem.drawingItemData.position);\r\n        }\r\n\r\n        return this.getCentroid(positions);\r\n    }\r\n\r\n    // Draw instructions\r\n\r\n    /**\r\n     * Draw all drawing items in a map\r\n     * @param {Map<string, DrawingItem>} drawingItemMap A map with drawing items\r\n     * @private\r\n     */\r\n    createSVGDomElements(drawingItemMap) {\r\n        for (const [id, drawingItem] of drawingItemMap) {\r\n            this.createSVGDomElement(id, drawingItem);\r\n\r\n            if (drawingItem.drawingItemData.pathItem !== undefined) {\r\n                const existingElement = this._eDrawing.querySelector(`[df-wd-item-id=\"${id}\"]`);\r\n\r\n                // Only update DOM when something has actually changed, otherwise create a new element\r\n                if (existingElement === null) {\r\n                    this._eDrawing.appendChild(drawingItem.drawingItemData.pathItem);\r\n                }\r\n                else if (!existingElement.isEqualNode(drawingItem.drawingItemData.pathItem)) {\r\n                    existingElement.replaceWith(drawingItem.drawingItemData.pathItem);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draw a drawing instruction\r\n     * @param {string} id\r\n     * @param {DrawingItem} drawingItem The data\r\n     * @private\r\n     */\r\n    createSVGDomElement(id, drawingItem) {\r\n        if (drawingItem.subDrawingItemMap.size > 0) {\r\n            drawingItem.drawingItemData.pathItem = document.createElementNS(this.ns, \"g\");\r\n            drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"style\", \"pointer-events: bounding-box; transform-origin: center; transform-box: fill-box;\");\r\n\r\n            for (const [childId, childDrawingItem] of drawingItem.subDrawingItemMap.entries()) {\r\n                this.createSVGDomElement(childId, childDrawingItem);\r\n                this.applyStylesForGroupChildren(childDrawingItem, drawingItem.drawingItemData); // Apply styles from group\r\n                drawingItem.drawingItemData.pathItem.setAttribute(\"df-wd-item-id\", id);\r\n                this.applyTransformStyles(drawingItem.drawingItemData);\r\n\r\n                const existingElement = drawingItem.drawingItemData.pathItem.querySelector(`:scope > *[df-wd-item-id=\"${id}\"]`);\r\n\r\n                // Only update DOM when something has actually changed, otherwise create a new element\r\n                if (existingElement === null) {\r\n                    drawingItem.drawingItemData.pathItem.appendChild(childDrawingItem.drawingItemData.pathItem);\r\n                }\r\n                else if (!existingElement.isEqualNode(drawingItem.drawingItemData.pathItem)) {\r\n                    existingElement.replaceWith(childDrawingItem.drawingItemData.pathItem);\r\n                }\r\n\r\n            }\r\n\r\n\r\n            this.assignEvent(id, drawingItem);\r\n        }\r\n        else {\r\n            if (drawingItem.drawingItemData.shape === undefined || drawingItem.drawingItemData.shape.type === \"\") return; // Ignore non-existent shape\r\n\r\n            this.createSVGData(id, drawingItem.drawingItemData);\r\n            this.applyStyles(drawingItem.drawingItemData);\r\n            this.applyTransformStyles(drawingItem.drawingItemData);\r\n            this.assignEvent(id, drawingItem);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply the Path 2D Data\r\n     * @param {string} id The ID\r\n     * @param {DrawingItemData} drawingItemData The drawing item data\r\n     * @private\r\n     */\r\n    createSVGData(id, drawingItemData) {\r\n        // Apply Path2D data\r\n        switch (drawingItemData.shape.type) {\r\n            case \"rectangle\": {\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"rect\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"x\", drawingItemData.shape.data.topLeft.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"y\", drawingItemData.shape.data.topLeft.y.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"width\",\r\n                    (drawingItemData.shape.data.bottomRight.x - drawingItemData.shape.data.topLeft.x).toString()\r\n                );\r\n                drawingItemData.pathItem.setAttributeNS(null, \"height\",\r\n                    (drawingItemData.shape.data.bottomRight.y - drawingItemData.shape.data.topLeft.y).toString()\r\n                );\r\n                break;\r\n            }\r\n            case \"rounded-rectangle\":\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"rect\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"x\", drawingItemData.shape.data.topLeft.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"y\", drawingItemData.shape.data.topLeft.y.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"width\",\r\n                    (drawingItemData.shape.data.bottomRight.x - drawingItemData.shape.data.topLeft.x).toString()\r\n                );\r\n                drawingItemData.pathItem.setAttributeNS(null, \"height\",\r\n                    (drawingItemData.shape.data.bottomRight.y - drawingItemData.shape.data.topLeft.y).toString()\r\n                );\r\n                drawingItemData.pathItem.setAttributeNS(null, \"rx\", drawingItemData.shape.data.radius.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"ry\", drawingItemData.shape.data.radius.toString());\r\n                break;\r\n            case \"circle\":\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"circle\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"cx\", drawingItemData.position.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"cy\", drawingItemData.position.y.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"r\", drawingItemData.shape.data.radius.toString());\r\n                break;\r\n            case \"ellipse\":\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"ellipse\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"cx\", drawingItemData.position.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"cy\", drawingItemData.position.y.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"rx\", drawingItemData.shape.data.radiusX.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"ry\", drawingItemData.shape.data.radiusY.toString());\r\n                break;\r\n            case \"path\": {\r\n                /** @type {string[]} */\r\n                const pathCommands = [];\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"path\");\r\n\r\n                for (let i = 0; i < drawingItemData.shape.data.subPoints.length; i++) {\r\n                    const subPoint = drawingItemData.shape.data.subPoints[i];\r\n\r\n                    switch (subPoint.type) {\r\n                        case \"add\":\r\n                        case \"lineTo\": {\r\n                            if (i === 0) pathCommands.push(`M ${subPoint.position.x},${subPoint.position.y}`);\r\n                            else pathCommands.push(`L ${subPoint.position.x},${subPoint.position.y}`);\r\n\r\n                            break;\r\n                        }\r\n                        case \"moveTo\": {\r\n                            pathCommands.push(`M ${subPoint.position.x},${subPoint.position.y}`);\r\n                            break;\r\n                        }\r\n                        case \"quadraticCurveTo\": {\r\n                            pathCommands.push(`Q ${subPoint.position2.x},${subPoint.position2.y} ${subPoint.position.x},${subPoint.position.y}`);\r\n                            break;\r\n                        }\r\n                        case \"closePath\":\r\n                            pathCommands.push(\"Z\");\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                drawingItemData.pathItem.setAttributeNS(null, \"d\", pathCommands.join(\" \"));\r\n                break;\r\n            }\r\n            case \"text\": {\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"text\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"x\", drawingItemData.position.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"y\", drawingItemData.position.y.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"font-family\", drawingItemData.fontFamily);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"font-size\", drawingItemData.fontSize.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"text-anchor\", drawingItemData.justification);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"font-weight\", drawingItemData.fontWeight);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"text-decoration\", drawingItemData.textDecoration);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"stroke\", drawingItemData.strokeColor);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"fill\", drawingItemData.fillColor);\r\n                drawingItemData.pathItem.textContent = drawingItemData.textContent;\r\n                break;\r\n            }\r\n            case \"image\": {\r\n                drawingItemData.pathItem = document.createElementNS(this.ns, \"image\");\r\n                drawingItemData.pathItem.setAttributeNS(null, \"x\", drawingItemData.shape.data.topLeft.x.toString());\r\n                drawingItemData.pathItem.setAttributeNS(null, \"y\", drawingItemData.shape.data.topLeft.y.toString());\r\n                if (drawingItemData.shape.data.bottomRight !== undefined) {\r\n                    drawingItemData.pathItem.setAttributeNS(null, \"width\",\r\n                        (drawingItemData.shape.data.bottomRight.x - drawingItemData.shape.data.topLeft.x).toString()\r\n                    );\r\n                    drawingItemData.pathItem.setAttributeNS(null, \"height\",\r\n                        (drawingItemData.shape.data.bottomRight.y - drawingItemData.shape.data.topLeft.y).toString()\r\n                    );\r\n                }\r\n                drawingItemData.pathItem.setAttributeNS(null, \"href\", drawingItemData.imagePath);\r\n                drawingItemData.pathItem.setAttributeNS(null, \"onmousedown\", \"return false\");\r\n                break;\r\n            }\r\n        }\r\n\r\n        drawingItemData.pathItem.setAttribute(\"df-wd-item-id\", id);\r\n    }\r\n\r\n    /**\r\n     * Apply styles for children of group\r\n     * @param {DrawingItem} drawingItem The drawing item\r\n     * @param {DrawingItemData} parentDrawingItemData The parent drawing item\r\n     * @private\r\n     */\r\n    applyStylesForGroupChildren(drawingItem, parentDrawingItemData) {\r\n        if (drawingItem.subDrawingItemMap.size > 0) {\r\n            for (const childDrawingItem of drawingItem.subDrawingItemMap.values()) {\r\n                this.applyStylesForGroupChildren(childDrawingItem, parentDrawingItemData);\r\n            }\r\n        }\r\n\r\n        // Stroke style\r\n        if (drawingItem.drawingItemData.strokeWidth === undefined && parentDrawingItemData.strokeWidth !== undefined) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke-width\", parentDrawingItemData.strokeWidth.toString());\r\n        if (drawingItem.drawingItemData.strokeColor === undefined && parentDrawingItemData.strokeColor !== undefined) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke\", parentDrawingItemData.strokeColor);\r\n        if (drawingItem.drawingItemData.strokeCap === undefined && parentDrawingItemData.strokeCap !== undefined) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke-linecap\", parentDrawingItemData.strokeCap);\r\n        if (drawingItem.drawingItemData.strokeJoin === undefined && parentDrawingItemData.strokeJoin !== undefined) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke-linejoin\", parentDrawingItemData.strokeJoin);\r\n        //Stroke dashes\r\n        const dashList = [];\r\n        if (drawingItem.drawingItemData.strokeDistance === undefined && parentDrawingItemData.strokeDistance !== undefined) dashList.push(parentDrawingItemData.strokeDistance);\r\n        if (drawingItem.drawingItemData.whitespaceDistance === undefined && parentDrawingItemData.whitespaceDistance !== undefined) dashList.push(parentDrawingItemData.whitespaceDistance);\r\n        if (dashList.length > 0) {\r\n            drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke-dasharray\", dashList.join());\r\n        }\r\n        if (drawingItem.drawingItemData.dashOffset === undefined && parentDrawingItemData.dashOffset !== undefined) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"stroke-dashoffset\", parentDrawingItemData.dashOffset);\r\n\r\n        // Fill style\r\n        // Special case for path, don't fill path unless it's closed\r\n        if (drawingItem.drawingItemData.shape?.type === \"path\" && drawingItem.drawingItemData.fillColor === undefined && drawingItem.drawingItemData.closed === false) {\r\n            drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"fill\", \"none\");\r\n        }\r\n\r\n        if (drawingItem.drawingItemData.fillColor === undefined && parentDrawingItemData.fillColor !== undefined) {\r\n            drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"fill\", parentDrawingItemData.fillColor);\r\n        }\r\n\r\n        // Shadow style\r\n        const shadowList = [];\r\n        if (drawingItem.drawingItemData.shadowOffset.x === 0 && drawingItem.drawingItemData.shadowOffset.y === 0 && parentDrawingItemData.shadowOffset.x !== 0 && parentDrawingItemData.shadowOffset.y !== 0) {\r\n            shadowList.push(`${parentDrawingItemData.shadowOffset.x}px ${parentDrawingItemData.shadowOffset.y}px`);\r\n        } else shadowList.push(\"0px 0px\");\r\n        if (drawingItem.drawingItemData.shadowBlur === undefined && parentDrawingItemData.shadowBlur !== undefined) shadowList.push(`${parentDrawingItemData.shadowBlur}px`);\r\n        if (drawingItem.drawingItemData.shadowColor === undefined && parentDrawingItemData.shadowColor !== undefined) shadowList.push(parentDrawingItemData.shadowColor);\r\n        if (shadowList.length > 1) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"style\", `filter: drop-shadow(${shadowList.join(\" \")});`);\r\n\r\n        // Visibility\r\n        if (parentDrawingItemData.visible === false) drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"visibility\", \"hidden\");\r\n        else drawingItem.drawingItemData.pathItem.setAttributeNS(null, \"visibility\", \"\");\r\n\r\n        //Custom attributes\r\n        if (drawingItem.drawingItemData.customAttribute === undefined && parentDrawingItemData.customAttribute !== undefined) {\r\n            drawingItem.drawingItemData.pathItem.setAttributeNS(null, parentDrawingItemData.customAttribute.customAttributeName, parentDrawingItemData.customAttribute.customAttributeValue);\r\n        };\r\n\r\n        // Tooltip\r\n        if (drawingItem.drawingItemData.tooltip === undefined && parentDrawingItemData.tooltip !== undefined) {\r\n            let titleElement = document.createElementNS(this.ns, \"title\");\r\n            titleElement.textContent = parentDrawingItemData.tooltip;\r\n            drawingItem.drawingItemData.pathItem.append(titleElement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply styles\r\n     * @param {DrawingItemData} drawingItemData The drawing item data\r\n     * @private\r\n     */\r\n    applyStyles(drawingItemData) {\r\n        // Stroke style\r\n        if (drawingItemData.strokeWidth !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-width\", drawingItemData.strokeWidth.toString());\r\n        if (drawingItemData.strokeColor !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke\", drawingItemData.strokeColor);\r\n        else drawingItemData.pathItem.setAttributeNS(null, \"stroke\", \"black\");\r\n        if (drawingItemData.strokeCap !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-linecap\", drawingItemData.strokeCap);\r\n        if (drawingItemData.strokeJoin !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-linejoin\", drawingItemData.strokeJoin);\r\n\r\n        //Stroke dashes\r\n        if (drawingItemData.strokeDistance !== undefined && drawingItemData.whitespaceDistance === undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-dasharray\", drawingItemData.strokeDistance);\r\n        if (drawingItemData.strokeDistance !== undefined && drawingItemData.whitespaceDistance !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-dasharray\", drawingItemData.strokeDistance + \",\" + drawingItemData.whitespaceDistance);\r\n        if (drawingItemData.dashOffset !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"stroke-dashoffset\", drawingItemData.dashOffset);\r\n\r\n        // Fill style\r\n        // Special case for path, don't fill path unless it's closed\r\n        if (drawingItemData.shape?.type === \"path\" && drawingItemData.fillColor === undefined && drawingItemData.closed === false) {\r\n            drawingItemData.pathItem.setAttributeNS(null, \"fill\", \"none\");\r\n        }\r\n\r\n        if (drawingItemData.fillColor !== undefined) {\r\n            drawingItemData.pathItem.setAttributeNS(null, \"fill\", drawingItemData.fillColor);\r\n        } else {\r\n            drawingItemData.pathItem.setAttributeNS(null, \"fill\", \"transparent\");\r\n        }\r\n\r\n        // Shadow style\r\n        const shadowList = [];\r\n        if (drawingItemData.shadowOffset.x !== 0 && drawingItemData.shadowOffset.y !== 0) {\r\n            shadowList.push(`${drawingItemData.shadowOffset.x}px ${drawingItemData.shadowOffset.y}px`);\r\n        } else {\r\n            shadowList.push(\"0px 0px\");\r\n        }\r\n        if (drawingItemData.shadowBlur) shadowList.push(`${drawingItemData.shadowBlur}px`);\r\n        if (drawingItemData.shadowColor) shadowList.push(drawingItemData.shadowColor);\r\n        if (shadowList.length > 1) drawingItemData.pathItem.setAttributeNS(null, \"style\", `filter: drop-shadow(${shadowList.join(\" \")});`);\r\n\r\n        //Visibility\r\n        if (drawingItemData.visible === true) drawingItemData.pathItem.setAttributeNS(null, \"visibility\", \"\");\r\n        else drawingItemData.pathItem.setAttributeNS(null, \"visibility\", \"hidden\");\r\n\r\n        //Custom attributes\r\n        if (drawingItemData.customAttribute !== undefined) drawingItemData.pathItem.setAttributeNS(null, drawingItemData.customAttribute.customAttributeName, drawingItemData.customAttribute.customAttributeValue);\r\n\r\n        //Tooltip\r\n        if (drawingItemData.tooltip !== undefined) {\r\n            let titleElement = document.createElementNS(this.ns, \"title\");\r\n            titleElement.textContent = drawingItemData.tooltip;\r\n            drawingItemData.pathItem.append(titleElement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply transform styles\r\n     * @param {DrawingItemData} drawingItemData The drawing item data\r\n     * @private\r\n     */\r\n    applyTransformStyles(drawingItemData) {\r\n        // Transform\r\n        let transformList = [];\r\n        if (drawingItemData.rotation !== undefined) transformList.push(`rotate(${drawingItemData.rotation})`);\r\n        if (drawingItemData.rotateInPlace !== undefined) drawingItemData.pathItem.setAttributeNS(null, \"transform-origin\", drawingItemData.position.x + \" \" + drawingItemData.position.y);\r\n        if (drawingItemData.scale !== undefined) {\r\n            if (drawingItemData.scale?.width !== 1 && drawingItemData.scale?.height !== 1) transformList.push(`scale(${drawingItemData.scale.width}, ${drawingItemData.scale.height})`);\r\n        }\r\n        if (transformList.length > 0) drawingItemData.pathItem.setAttributeNS(null, \"transform\", transformList.join(\" \"));\r\n    }\r\n\r\n    // Event Handling\r\n\r\n    /**\r\n     * Assign events to the drawing\r\n     * @param {string} id\r\n     * @param {DrawingItem} drawingItem\r\n     * @private\r\n     */\r\n    assignEvent(id, drawingItem) {\r\n        if (id.startsWith(\"!\")) return; // Ignore exclamation IDs\r\n\r\n        const element = drawingItem.drawingItemData.pathItem;\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseClick) {\r\n            element.addEventListener(\"click\", (event) => {\r\n                this.handleEvent(\"HandleMouseClick\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseDoubleClick) {\r\n            element.addEventListener(\"dblclick\", (event) => {\r\n                this.handleEvent(\"HandleMouseDoubleClick\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseUp) {\r\n            element.addEventListener(\"mouseup\", (event) => {\r\n                this.handleEvent(\"HandleMouseUp\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseDown) {\r\n            element.addEventListener(\"mousedown\", (event) => {\r\n                event.preventDefault();\r\n                this.handleEvent(\"HandleMouseDown\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseMove) {\r\n            element.addEventListener(\"mousemove\", (event) => {\r\n                this.handleEvent(\"HandleMouseMove\", event, id, drawingItem);\r\n\r\n                if (event.buttons !== 0) {\r\n                    this.handleEvent(\"HandleMouseDrag\", event, id, drawingItem);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseDrag) {\r\n            element.addEventListener(\"mousemove\", (event) => {\r\n                if (event.buttons !== 0) {\r\n                    this.handleEvent(\"HandleMouseDrag\", event, id, drawingItem);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseEnter) {\r\n            element.addEventListener(\"mouseenter\", (event) => {\r\n                this.handleEvent(\"HandleMouseEnter\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseLeave) {\r\n            element.addEventListener(\"mouseleave\", (event) => {\r\n                this.handleEvent(\"HandleMouseLeave\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        // Touchscreen events\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseUp) {\r\n            element.addEventListener(\"touchend\", (event) => {\r\n                this.handleEvent(\"HandleMouseUp\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseClick) {\r\n            element.addEventListener(\"touchstart\", (event) => {\r\n                event.preventDefault();\r\n                this.handleEvent(\"HandleMouseClick\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseDown) {\r\n            element.addEventListener(\"touchstart\", (event) => {\r\n                event.preventDefault();\r\n                this.handleEvent(\"HandleMouseDown\", event, id, drawingItem);\r\n            });\r\n        }\r\n\r\n        if (drawingItem.enabledInteractions & this.wdInteractionOnMouseMove) {\r\n            element.addEventListener(\"touchmove\", (event) => {\r\n                this.handleEvent(\"HandleMouseMove\", event, id, drawingItem);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handle an event and send it to the server\r\n     * @param {string} eventName\r\n     * @param {MouseEvent} event\r\n     * @param {string} id\r\n     * @param {DrawingItem} drawingItem\r\n     */\r\n    handleEvent(eventName, event, id, drawingItem) {\r\n        const dataToSend = this.createEventData(drawingItem.drawingItemData, event);\r\n        this.serverAction(\"ReceiveEventData\", [eventName, id], dataToSend, null);\r\n    }\r\n\r\n    /**\r\n     * Create a value tree of the event data and the drawing item\r\n     * @param {DrawingItemData} drawingItemData The item data\r\n     * @param {MouseEvent | TouchEvent} e The event data\r\n     * @return Value tree of the event data\r\n     * @private\r\n     */\r\n    createEventData(drawingItemData, e) {\r\n        const data = {};\r\n\r\n        data.eMouseButtons = 0;\r\n        data.tMousePosition = { fX: 0, fY: 0 };\r\n\r\n        if (e.touches !== undefined && e.touches.length > 0) {\r\n            let tempXandY;\r\n            tempXandY = this.getTouchPos(e);\r\n            data.tMousePosition.fX = tempXandY.x;\r\n            data.tMousePosition.fY = tempXandY.y;\r\n        }\r\n        else if (e.buttons !== undefined) {\r\n            let tempXandY;\r\n            data.eMouseButtons = e.buttons;\r\n            tempXandY = this.getMousePos(e);\r\n            data.tMousePosition.fX = tempXandY.x;\r\n            data.tMousePosition.fY = tempXandY.y;\r\n        }\r\n\r\n        // Positioning\r\n        data.tPosition = {};\r\n        data.tPosition.fX = drawingItemData.position?.x ?? 0;\r\n        data.tPosition.fY = drawingItemData.position?.y ?? 0;\r\n        data.fRotation = drawingItemData.rotation ?? 0;\r\n        data.tScaling = {};\r\n        data.tScaling.fWidth = drawingItemData.scale?.width ?? 1;\r\n        data.tScaling.fHeight = drawingItemData.scale?.height ?? 1;\r\n\r\n        // Stroke style\r\n        data.sStrokeColor = drawingItemData.strokeColor ?? \"transparent\";\r\n        data.fStrokeWidth = drawingItemData.strokeWidth ?? 0;\r\n        data.iStrokeCap = this.enumStrokeCapStringToInt(drawingItemData.strokeCap);\r\n        data.iStrokeJoin = this.enumStrokeJoinStringToInt(drawingItemData.strokeJoin);\r\n        data.fDashOffset = drawingItemData.dashOffset ?? 0;\r\n\r\n        // Fill style\r\n        data.sFillColor = drawingItemData.fillColor ?? \"transparent\";\r\n\r\n        // Shadow style\r\n        data.sShadowColor = drawingItemData.shadowColor ?? \"transparent\";\r\n        data.fShadowBlur = drawingItemData.shadowBlur ?? 0;\r\n        data.tShadowOffset = {};\r\n        data.tShadowOffset.fX = drawingItemData.shadowOffset?.x ?? 0;\r\n        data.tShadowOffset.fY = drawingItemData.shadowOffset?.y ?? 0;\r\n\r\n        // Font style\r\n        data.sTextContent = drawingItemData.textContent ?? \"\";\r\n        data.sFontFamily = drawingItemData.fontFamily ?? \"sans-serif\";\r\n        data.fFontSize = drawingItemData.fontSize ?? 10;\r\n        data.eJustification = this.enumJustificationStringToInt(drawingItemData.justification);\r\n        data.sFontWeight = drawingItemData.fontWeight ?? \"\";\r\n        data.sTextDecoration = drawingItemData.textDecoration ?? \"\";\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Get the position of the mouse on the drawing\r\n     * @param {MouseEvent} e The event data\r\n     * @returns {Position}\r\n     * @private\r\n     */\r\n    getMousePos(e) {\r\n        const rect = this._eDrawing.getBoundingClientRect();\r\n\r\n        return {\r\n            x: e.clientX - rect.left,\r\n            y: e.clientY - rect.top\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get the position of the finger on the drawing\r\n     * @param {TouchEvent} e\r\n     * @returns {Position}\r\n     * @private\r\n     */\r\n    getTouchPos(e) {\r\n        const rect = this._eDrawing.getBoundingClientRect();\r\n\r\n        return {\r\n            x: e.touches[0].clientX - rect.left,\r\n            y: e.touches[0].clientY - rect.top\r\n        };\r\n    }\r\n\r\n    // Helper functions\r\n\r\n    /**\r\n     * Get the centroid from a bunch of sub points\r\n     * @param {Position[]} positions The sub points\r\n     * @return {Position} The centroid of the points\r\n     * @private\r\n     */\r\n    getCentroid(positions) {\r\n        // Sum up X and Y coordinates\r\n        const sumX = positions.map(p => p.x).reduce((previous, current) => previous + current);\r\n        const sumY = positions.map(p => p.y).reduce((previous, current) => previous + current);\r\n\r\n        // Calculate centroid\r\n        /** @type {Position} */\r\n        const position = {};\r\n        position.x = sumX / positions.length;\r\n        position.y = sumY / positions.length;\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * Delete an item from the drawing\r\n     * @param {string} id The ID of the item\r\n     * @private\r\n     */\r\n    deleteItem(id) {\r\n        this.drawingItemMap = this.recursiveDeleteFromMap(id, this.drawingItemMap);\r\n    }\r\n\r\n    /**\r\n     * Recursively delete items from the map\r\n     * @param {string} idToRemove The ID to remove\r\n     * @param {Map<string, DrawingItem>} drawingItemMap The drawing item map\r\n     * @returns {Map<string, DrawingItem>} The new drawing item map\r\n     * @private\r\n     */\r\n    recursiveDeleteFromMap(idToRemove, drawingItemMap) {\r\n        /** @type {string[]} */\r\n        const itemsToRemove = [];\r\n\r\n        // Collect ids of items to remove\r\n        for (const [id, drawingItem] of drawingItemMap.entries()) {\r\n            if (drawingItem.subDrawingItemMap.size > 0) {\r\n                drawingItem.subDrawingItemMap = this.recursiveDeleteFromMap(idToRemove, drawingItem.subDrawingItemMap);\r\n            }\r\n\r\n            if (id === idToRemove) {\r\n                itemsToRemove.push(id);\r\n                const existingElement = this._eDrawing.querySelector(`:scope > *[df-wd-item-id=\"${id}\"]`);\r\n                if (existingElement !== null) this._eDrawing.removeChild(existingElement);\r\n            }\r\n        }\r\n\r\n        // Removes items from map\r\n        for (const itemToRemove of itemsToRemove) {\r\n            drawingItemMap.delete(itemToRemove);\r\n        }\r\n\r\n        return drawingItemMap;\r\n    }\r\n\r\n    /**\r\n     * Clone a object\r\n     * @param {Object} input\r\n     * @returns {Object}\r\n     */\r\n    cloneObject(input) {\r\n        return JSON.parse(JSON.stringify(input));\r\n    }\r\n\r\n    /**\r\n     * Convert a blob to base64\r\n     * @param blob The Data Blob\r\n     * @returns {Promise<string>} The return data string as Base64\r\n     */\r\n    blobImageToBase64(blob) {\r\n        return new Promise((resolve, _) => {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                const result = reader.result.replace(\"data:image/png;base64,\", \"\");\r\n                resolve(result);\r\n            };\r\n\r\n            reader.readAsDataURL(blob);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if the canvas map already has this id\r\n     * @param {String} idToCheck The ID to check\r\n     * @returns {boolean} True if the ID exists in the map\r\n     * @private\r\n     */\r\n    mapHasId(idToCheck) {\r\n        return this.checkMapChildren(idToCheck, this.drawingItemMap);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} idToCheck\r\n     * @param {Map<string, DrawingItem>} drawingItemMap\r\n     * @return {boolean} True if the ID exists in the map\r\n     * @private\r\n     */\r\n    checkMapChildren(idToCheck, drawingItemMap) {\r\n        for (const [id, drawingItem] of drawingItemMap.entries()) {\r\n            if (id === idToCheck) {\r\n                return true;\r\n            }\r\n\r\n            if (drawingItem.subDrawingItemMap.size > 0) {\r\n                const result = this.checkMapChildren(idToCheck, drawingItem.subDrawingItemMap);\r\n\r\n                if (result) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // Export and Import\r\n\r\n    async exportDrawingToImage() {\r\n        // Clone svg element\r\n        const svgCopy = this._eDrawing.cloneNode(true);\r\n\r\n        // Convert image paths to data urls\r\n        const svgImages = svgCopy.querySelectorAll(\"image\");\r\n        for (const svgImage of svgImages) {\r\n            const response = await fetch(svgImage.href.baseVal);\r\n            const imgBlob = await response.blob();\r\n            const svgImageReader = new FileReader();\r\n            svgImageReader.readAsDataURL(imgBlob);\r\n            const result = await new Promise((resolve) => {\r\n                svgImageReader.onloadend = () => {\r\n                    resolve(svgImageReader.result);\r\n                };\r\n            });\r\n\r\n            svgImage.setAttributeNS(null, \"href\", result);\r\n        }\r\n\r\n        const drawing = document.createElement(\"drawing\");\r\n        drawing.width = svgCopy.width.baseVal.value;\r\n        drawing.height = svgCopy.height.baseVal.value;\r\n        const ctx = drawing.getContext(\"2d\");\r\n        const data = (new XMLSerializer()).serializeToString(svgCopy);\r\n        const img = new Image();\r\n        const svgBlob = new Blob([data], { type: 'image/svg+xml;charset=utf-8' });\r\n        const svgDrawingReader = new FileReader();\r\n        svgDrawingReader.readAsDataURL(svgBlob);\r\n        img.src = await new Promise((resolve) => {\r\n            svgDrawingReader.onloadend = () => {\r\n                resolve(svgDrawingReader.result);\r\n            };\r\n        });\r\n\r\n        img.addEventListener(\"load\", () => {\r\n            ctx.drawImage(img, 0, 0);\r\n            let result = drawing.toDataURL(\"image/png\").replace(\"data:image/png;base64,\", \"\");\r\n            this.serverAction(\"OnReceiveImage\", [result]);\r\n        });\r\n    }\r\n\r\n    exportDrawingDataToJSON() {\r\n        const result = JSON.stringify(Object.fromEntries(this.drawingItemMap));\r\n        this.serverAction(\"OnReceiveJSONExport\", [result], null, null);\r\n    }\r\n\r\n    /**\r\n     * Import JSON data from the server to the drawing\r\n     * @param {string} jsonInput The JSON string data\r\n     */\r\n    importDrawingFromJSON(jsonInput) {\r\n        this.drawingItemMap = Object.entries(JSON.parse(jsonInput));\r\n        this.updateDrawing();\r\n    }\r\n\r\n    // Enum conversion\r\n\r\n    /**\r\n     * Convert stroke cap type string to stroke ID\r\n     * @param {DrawingLineCap} input Stroke cap type\r\n     * @returns {0 | 1 | 2} Stoke cap type ID\r\n     * @private\r\n     */\r\n    enumStrokeCapStringToInt(input) {\r\n        switch (input) {\r\n            case \"round\":\r\n                return 0;\r\n            case \"square\":\r\n                return 1;\r\n            case \"butt\":\r\n            default:\r\n                return 2;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert stroke cap numeric ID to type string\r\n     * @param {0 | 1 | 2} input Stroke cap type ID\r\n     * @return {DrawingLineCap} Stroke cap type\r\n     * @private\r\n     */\r\n    enumStrokeCapIntToString(input) {\r\n        switch (input) {\r\n            case 0:\r\n                return \"round\";\r\n            case 1:\r\n                return \"square\";\r\n            case 2:\r\n            default:\r\n                return \"butt\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert stroke join type to numeric ID\r\n     * @param {DrawingLineJoin} input Stroke join type\r\n     * @returns {0 | 1 | 2} Stroke join type ID\r\n     * @private\r\n     */\r\n    enumStrokeJoinStringToInt(input) {\r\n        switch (input) {\r\n            case \"miter\":\r\n            default:\r\n                return 0;\r\n            case \"round\":\r\n                return 1;\r\n            case \"bevel\":\r\n                return 2;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert stroke join numeric ID to type\r\n     * @param {0 | 1 | 2} input Stroke join type ID\r\n     * @return {DrawingLineJoin} Stroke join type\r\n     * @private\r\n     */\r\n    enumStrokeJoinIntToString(input) {\r\n        switch (input) {\r\n            case 0:\r\n            default:\r\n                return \"miter\";\r\n            case 1:\r\n                return \"round\";\r\n            case 2:\r\n                return \"bevel\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert justification type to numeric ID\r\n     * @param {\"start\" | \"middle\" | \"end\"} input Justification type\r\n     * @returns {0 | 1 | 2} Justification type ID\r\n     * @private\r\n     */\r\n    enumJustificationStringToInt(input) {\r\n        switch (input) {\r\n            default:\r\n            case \"start\":\r\n                return 0;\r\n            case \"middle\":\r\n                return 1;\r\n            case \"end\":\r\n                return 2;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert stroke join numeric ID to type\r\n     * @param {0 | 1 | 2} input Justification type ID\r\n     * @returns {\"start\" | \"middle\" | \"end\"} Justification type\r\n     * @private\r\n     */\r\n    enumJustificationIntToString(input) {\r\n        switch (input) {\r\n            default:\r\n            case 0:\r\n                return \"start\";\r\n            case 1:\r\n                return \"middle\";\r\n            case 2:\r\n                return \"end\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {string} color The new background color for the canvas. Allows both color words such as \"red\" and hexcode.\r\n     * @private\r\n     */\r\n    set_psCanvasBackgroundColor(color) {\r\n        this._eDrawing.style.backgroundColor = color;\r\n    }\r\n\r\n    /*\r\n    This method determines if the control is shown with a border. It does this by removing \r\n    or adding the \"WebDrawing_Box\" CSS class.\r\n    \r\n    @param  bVal    The new value.\r\n    */\r\n    set_pbShowBorder(bVal) {\r\n        this.pbShowBorder = bVal\r\n        if (this._eControl) {\r\n            df.dom.toggleClass(this._eControl, \"WebDrawing_Box\", this.pbShowBorder);\r\n        }\r\n    }\r\n}","export class WebDropZone {\r\n  constructor(eZone, oControl) {\r\n    this._eZone = eZone; // The underlying html element\r\n    this._oControl = oControl; // Reference to the control this dropzone belongs to\r\n    this._eInsertedElem = null; // Will contain the insertedElement so it can be removed later, can only contain 1\r\n    this._aHelpers = []; // List of responsible helpers, filled upon starting the drag (when highlighting)\r\n    this._eDropPosition = -1; // Determined position (on, before, or after) for the dropped element. -1 = unknown.\r\n    this._eDropElem = null; // Temporary reference to the current element being dropped on\r\n    this._eDropAction = -1; // Temporary reference to the elements' corresponding drop action\r\n    this._iEnterCount = 0; // Used to determine if we actually left this dropzone when a dragLeave event fires\r\n  }\r\n\r\n  highlight(oHelper) {\r\n    df.dom.addClass(this._eZone, \"WebCon_DropZone\");\r\n    this.attachHandlers();\r\n\r\n    // Add responsible helper\r\n    this._aHelpers.push(oHelper);\r\n  }\r\n\r\n  unhighlight() {\r\n    df.dom.removeClass(this._eZone, \"WebCon_DropZone\");\r\n    this.detachHandlers();\r\n    this.removeDropElemInteractions();\r\n\r\n    // Remove responsible helpers\r\n    this._aHelpers = [];\r\n\r\n    // Cleanup\r\n    this._eDropPosition = -1;\r\n    this._eDropElem = null;\r\n    this._eDropAction = -1;\r\n    this._iEnterCount = 0;\r\n  }\r\n\r\n  destroy() {\r\n    this.unhighlight();\r\n  }\r\n\r\n  attachHandlers() {\r\n    df.dom.on(\"dragenter\", this._eZone, this.onDragEnter, this);\r\n    df.dom.on(\"dragleave\", this._eZone, this.onDragLeave, this);\r\n    df.dom.on(\"dragover\", this._eZone, this.onDragOver, this);\r\n    df.dom.on(\"drop\", this._eZone, this.onDrop, this);\r\n  }\r\n\r\n  detachHandlers() {\r\n    df.dom.off(\"dragenter\", this._eZone, this.onDragEnter, this);\r\n    df.dom.off(\"dragleave\", this._eZone, this.onDragLeave, this);\r\n    df.dom.off(\"dragover\", this._eZone, this.onDragOver, this);\r\n    df.dom.off(\"drop\", this._eZone, this.onDrop, this);\r\n  }\r\n\r\n  getDropData() {\r\n    return this._oControl.getDropData(this);\r\n  }\r\n\r\n  // DragDrop Events\r\n  onDrop(oEv) {\r\n    oEv.e.preventDefault();\r\n    this._oControl.onDrop(oEv, this, this._eDropAction);\r\n    this.removeDropElemInteractions();\r\n    this._iEnterCount = 0;\r\n  }\r\n\r\n  onDragOver(oEv) {\r\n    oEv.e.preventDefault();\r\n\r\n    if (!this.controlHasData()) {\r\n      this._eDropPosition = df.dropPositions.ciDropOnEmpty;\r\n      this._eDropElem = null;\r\n      this._eDropAction = this.doEmptyInteraction();\r\n    } else {\r\n      // Get the element that needs to be interacted with\r\n      const [eDropElem, eDropAction] = this.getDropCandidate(oEv);\r\n      const bOverDropPlaceHolder = this.isOverDropPlaceHolder(oEv);\r\n      let ePosition;\r\n\r\n      if (eDropElem == null && !bOverDropPlaceHolder) {\r\n        this.removeDropElemInteractions();\r\n        this._eDropElem = null;\r\n        ePosition = this._eDropPosition = 0;\r\n      }\r\n      if (eDropElem != null && !bOverDropPlaceHolder) {\r\n        ePosition = this.getDropPosition(oEv, eDropElem);\r\n      }\r\n      const bInteract = ((ePosition > 0 && eDropElem != null) && (eDropElem != this._eDropElem || this._eDropPosition != ePosition));\r\n      if (bInteract && !bOverDropPlaceHolder) {\r\n        this.removeDropElemInteractions();\r\n        this._eDropElem = eDropElem;\r\n        this._eDropPosition = ePosition;\r\n        this._eDropAction = eDropAction;\r\n        this.interactWithDropElem();\r\n      }\r\n\r\n      this._oControl.onControlDragOver(oEv, this, eDropElem);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onDragEnter(oEv) {\r\n    oEv.e.preventDefault();\r\n    this._iEnterCount++;\r\n    // return false;\r\n  }\r\n\r\n  onDragLeave(oEv) {\r\n    oEv.e.preventDefault();\r\n    this._iEnterCount--;\r\n\r\n    // Check if we actually left the dropzone\r\n    // if (!this.isInDropZone(oEv)) {\r\n    // Now use a simple counter, probably much more efficient...\r\n    if (this._iEnterCount <= 0) {\r\n      this.removeDropElemInteractions();\r\n      this._eDropElem = null;\r\n      this._eDropPosition = 0;\r\n      this._iEnterCount = 0;\r\n    }\r\n\r\n    // return false;\r\n  }\r\n\r\n  // isInDropZone (oEv) {\r\n  //   let eElem = document.elementFromPoint(oEv.e.x, oEv.e.y);\r\n\r\n  //   while (eElem && eElem != this._oControl._eElem) {\r\n  //       if (eElem == this._eZone) {\r\n  //           return true;\r\n  //       }\r\n  //       eElem = eElem.parentNode;\r\n  //   }\r\n\r\n  //   return false;\r\n  // }\r\n\r\n  getDropCandidate(oEv) {\r\n    const [eDropElem, eDropAction] = this._oControl.determineDropCandidate(oEv, this._aHelpers);\r\n\r\n    return [eDropElem, eDropAction];\r\n  }\r\n\r\n  getDropPosition(oEv, eDropElem) {\r\n    const ePosition = this._oControl.determineDropPosition(oEv, eDropElem);\r\n    return ePosition;\r\n  }\r\n\r\n  isOverDropPlaceHolder(oEv) {\r\n    let eElem = document.elementFromPoint(oEv.e.x, oEv.e.y);\r\n\r\n    if (eElem) {\r\n      return eElem.classList.contains(\"DfDragDrop_PlaceHolder\");\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  controlHasData() {\r\n    return this._oControl.hasData();\r\n  }\r\n\r\n  removeDropElemInteractions() {\r\n    this.removeInsertedElement();\r\n    this.clearHighlight();\r\n  }\r\n\r\n  interactWithDropElem() {\r\n    this._oControl.interactWithDropElem(this, this._eDropElem);\r\n  }\r\n\r\n  doEmptyInteraction() {\r\n    const eDropAction = this._oControl.doEmptyInteraction(this);\r\n    return eDropAction;\r\n  }\r\n\r\n  highlightElement() {\r\n    if (this._eDropElem) {\r\n      df.dom.addClass(this._eDropElem, \"WebCon_DragHover\");\r\n    }\r\n  }\r\n\r\n  clearHighlight() {\r\n    if (this._eDropElem) {\r\n      df.dom.removeClass(this._eDropElem, \"WebCon_DragHover\");\r\n    }\r\n  }\r\n\r\n  insertElement(eElem, targetElem, eOptForceDropPosition) {\r\n    if (!this._eInsertedElem) {\r\n      df.dom.addClass(eElem, \"DfDragDrop_PlaceHolder\");\r\n      eElem.setAttribute('data-dfdropplaceholder', true);\r\n\r\n      let eDropPosition = eOptForceDropPosition || this._eDropPosition;\r\n\r\n      switch (eDropPosition) {\r\n        case df.dropPositions.ciDropBefore:\r\n          targetElem.insertAdjacentElement('beforebegin', eElem);\r\n          break;\r\n        case df.dropPositions.ciDropAfter:\r\n          targetElem.insertAdjacentElement('afterend', eElem);\r\n          break;\r\n        case df.dropPositions.ciDropOnEmpty:\r\n          targetElem.appendChild(eElem);\r\n          break;\r\n      }\r\n\r\n      this._eInsertedElem = eElem;\r\n    }\r\n  }\r\n\r\n  removeInsertedElement() {\r\n    if (this._eInsertedElem) {\r\n      this._eInsertedElem?.parentNode?.removeChild(this._eInsertedElem);\r\n      this._eInsertedElem = null;\r\n    }\r\n  }\r\n};","import { WebGroup } from \"../WebGroup.js\"\r\nimport { df } from '../../df.js';\r\n\r\nexport class WebWidget extends WebGroup {\r\n\r\n    constructor(sName, oParent) {\r\n        //  Forward Send\r\n        super(sName, oParent);\r\n\r\n        this.prop(df.tString,     'psDynamicWidgetId',    '');\r\n        this.prop(df.tString,     'psWidgetName',         '');\r\n        this.prop(df.tBool,       'pbAllowResize',        true);\r\n        this.prop(df.tBool,       'pbConfigurable',       false);\r\n\r\n        // Configure super classes\r\n        this._sBaseClass = \"WebGroup\";\r\n        this._sControlClass = \"WebWidget\";\r\n        \r\n        // privates\r\n        this._bEditMode = false;\r\n\r\n        this._eSelTop;\r\n        this._eSelLeft;\r\n        this._eSelBottom;\r\n        this._eSelRight;\r\n        this._eDragMove;\r\n        this._eResizeHandle;\r\n        this._eRemoveBtn;\r\n\r\n        this._oInternalDragDropHelper = null;\r\n    };\r\n\r\n    getWidgetProps  () {\r\n        return  {\r\n            sName : this.psWidgetName,\r\n            sDynId : this.psDynamicWidgetId,\r\n            iRowIndex : this.piRowIndex,\r\n            iColIndex : this.piColumnIndex,\r\n            iRowSpan : this.piRowSpan,\r\n            iColSpan : this.piColumnSpan,\r\n            bFillHeight : this.pbFillHeight,\r\n            aConfig : this.getCurrentConfiguration()\r\n        }\r\n    }\r\n\r\n    initInternalDrag (oHelper) {\r\n        this._oInternalDragDropHelper = oHelper;\r\n        this._oInternalDragDropHelper.registerDragSource(this.getLongName(), df.dragActions.WebWidgetContainer.ciDragWidget);\r\n    } \r\n\r\n    getCurrentConfiguration () {\r\n        return [];\r\n    }\r\n\r\n    setEditMode (bEdit) {\r\n        this._bEditMode = bEdit;\r\n\r\n        if (this._bEditMode) {\r\n            this.showEditBox();\r\n        } else {\r\n            this.hideEditBox();\r\n        }\r\n    }\r\n\r\n\r\n    showEditBox () {\r\n        let aHtml = [];\r\n        let eBox;\r\n        \r\n        aHtml.push('<div class=\"WebCon_WebWidget_Edit_Box\" style=\"display: none\"' + ((this._oInternalDragDropHelper || this.pbDragDropEnabled) ? ' draggable=\"true\"' : '') + '>');\r\n        aHtml.push('    <div class=\"WebCon_WebWidget_Top_Btns_Wrp\">');\r\n        aHtml.push('        <span class=\"WebCon_WebWidget_Drag_Indicator WebCon_Icon\"></span>');\r\n        aHtml.push('        <span class=\"WebCon_WebWidget_Edit_Btns_Wrp\">');\r\n        aHtml.push('            <span class=\"WebCon_WebWidget_Edit_Btn_Wrp\"><span class=\"WebCon_WebWidget_Function_Btn WebCon_WebWidget_Edit_Btn WebCon_Icon\"></span></span>');\r\n        aHtml.push('            <span class=\"WebCon_WebWidget_Edit_Btn_Wrp\"><span class=\"WebCon_WebWidget_Function_Btn WebCon_WebWidget_Remove_Btn WebCon_Icon\"></span></span>');\r\n        aHtml.push('        </span>');\r\n        aHtml.push('    </div>');\r\n        aHtml.push('    <div class=\"WebCon_WebWidget_Bottom_Btns_Wrp\">');\r\n        aHtml.push('        <span class=\"WebCon_WebWidget_ResizeHandle_Wrp\">')\r\n        aHtml.push('            <span class=\"WebCon_WebWidget_Function_Btn WebCon_WebWidget_ResizeHandle WebCon_Icon\"></span>');\r\n        aHtml.push('        </span>');\r\n        aHtml.push('    </div>');\r\n        aHtml.push('</div>');\r\n\r\n        this._eEditBox = eBox = df.dom.create(aHtml.join(''));\r\n        this._eResizeHandle = df.dom.query(eBox, 'span.WebCon_WebWidget_ResizeHandle');\r\n        this._eEditBtn = df.dom.query(eBox, 'span.WebCon_WebWidget_Edit_Btn');\r\n        this._eRemoveBtn = df.dom.query(eBox, 'span.WebCon_WebWidget_Remove_Btn');\r\n\r\n        df.events.addDomListener(\"mousedown\", this._eEditBox, this.onWidgetMove, this);\r\n        df.events.addDomListener(\"mousedown\", this._eResizeHandle, this.onWidgetResize, this);\r\n        df.events.addDomListener(\"click\", this._eEditBtn, this.onEditClick, this);\r\n        df.events.addDomListener(\"click\", this._eRemoveBtn, this.onRemoveClick, this);\r\n    \r\n        this._eElem.appendChild(eBox);\r\n        \r\n        if (!this.pbConfigurable) {\r\n            this._eEditBtn.style.display = 'none';\r\n        }\r\n\r\n        this.repositionEditBox();\r\n    }\r\n\r\n    repositionEditBox (){\r\n        if (this._eEditBox) {\r\n            if (this._eElem) {\r\n                this.positionEditBox(df.sys.gui.getBoundRect(this._eContainer));\r\n            } else {\r\n                this._eSel.style.display = \"none\";\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    positionEditBox (oRect){\r\n        this._eEditBox.style.display = \"\";\r\n        this._eEditBox.style.width = Math.round(oRect.width) + 'px';\r\n        this._eEditBox.style.height = Math.round(oRect.height) + 'px';\r\n\r\n        if (this.pbAllowResize) {\r\n            this._eResizeHandle.style.display = 'inline-block';\r\n        } else {\r\n            this._eResizeHandle.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    onEditClick (oEv) {\r\n        if(this.pbConfigurable){\r\n            this.editWidget()\r\n        }\r\n    }\r\n\r\n    editWidget () {\r\n        if (this._oParent?.editWidgetEx) {\r\n            this._oParent.editWidgetEx(this);\r\n        }\r\n    }\r\n\r\n    onRemoveClick (oEv) {\r\n        this.removeWidget();\r\n    }\r\n\r\n    removeWidget () {\r\n        if (this._oParent?.removeWidgetEx) {\r\n            this._oParent.removeWidgetEx(this);\r\n        }\r\n    }\r\n\r\n    onWidgetMove (oEv) {\r\n\r\n    }\r\n\r\n    onWidgetResize (oEv) {\r\n        var eElem, iRow, iCol, iStartRowIndex, iStartColIndex, iNewColSpan, iNewRowSpan, eMask, oObjParentContainer, oObj = this;\r\n        var aCells = [], eCell;\r\n\r\n        eElem = this._eElem;\r\n        oObjParentContainer = this._oParent;\r\n        this._oParent.snapshotChildrenPositions();\r\n\r\n        if (oObjParentContainer && !oObjParentContainer.isGridLayout()) { return false; }\r\n\r\n        // Select parent to show grid\r\n        if (!oObjParentContainer._eGridOverLay) {\r\n            if (!oObjParentContainer.drawGridOverlay()) { \r\n                return false; \r\n            }\r\n        } \r\n        oObjParentContainer.showGrid(); \r\n        \r\n\r\n        var aPointElems  = document.elementsFromPoint(oEv.getMouseX(), oEv.getMouseY());\r\n        for (let e=0; e < aPointElems.length; e++) {\r\n            if (aPointElems[e].classList.contains(\"WebCon_WebWidgetContainer_GridOverlay_Cell\") ) {\r\n                eCell = aPointElems[e];\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(eCell){\r\n            iStartRowIndex = determineRow(oObj, eCell);\r\n            iStartColIndex = determineColumn(oObj, eCell);\r\n        }else{\r\n            iStartRowIndex = (oObj.piRowIndex > -1) ? oObj.piRowIndex : 0;\r\n            iStartColIndex = (oObj.piColumnIndex > -1) ? oObj.piColumnIndex : 0;\r\n        }\r\n\r\n        this.bAutoRepos = false;\r\n\r\n        eMask = oObjParentContainer._eContainer;\r\n        if (!eMask) { return; }\r\n        eMask.style.cursor = this._eEditBox.style.cursor = \"nwse-resize\";  \r\n        \r\n\r\n        function onResize(oEv) {\r\n            let aPointElems;\r\n\r\n            aPointElems  = document.elementsFromPoint(oEv.getMouseX(), oEv.getMouseY());\r\n            for (let e=0; e < aPointElems.length; e++) {\r\n                if (aPointElems[e].classList.contains(\"WebCon_WebWidgetContainer_GridOverlay_Cell\") ) {\r\n                    eCell = aPointElems[e];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            let sCellID = eCell.dataset.dfcellid;\r\n            iRow = (parseInt(sCellID.split('-')[0]));\r\n            iCol = (parseInt(sCellID.split('-')[1]));\r\n            iNewRowSpan = iRow - iStartRowIndex + 1;\r\n            iNewColSpan = iCol - iStartColIndex + 1;\r\n\r\n\r\n            let bColChanged = (iNewColSpan && (oObj.piColumnSpan !== iNewColSpan));\r\n            let bRowChanged = (iNewRowSpan && (oObj.piRowSpan !== iNewRowSpan));\r\n\r\n            if (bColChanged) {\r\n                oObj.piColumnSpan = iNewColSpan;\r\n            }\r\n            if (bRowChanged) {\r\n                oObj.piRowSpan = iNewRowSpan;\r\n            }\r\n            if (bColChanged || bRowChanged) {\r\n                this._oParent.resetPositionsToSnapshot();\r\n                let oRect = this._oParent.getObjRect(oObj)\r\n                this._oParent.checkAndResolveCollisions(oRect, oObj);\r\n                this._oParent.position();\r\n            }\r\n        }\r\n\r\n        function onStopResize(oEv){\r\n            df.events.removeDomListener(\"mouseup\", eMask, onStopResize, this);\r\n            df.events.removeDomListener(\"mouseup\", window, onStopResize, this);\r\n            df.events.removeDomListener(\"mousemove\", eMask, onResize, this);\r\n\r\n            if (oObjParentContainer && oObjParentContainer instanceof df.WebWidgetContainerInternal) {\r\n                oObjParentContainer._eGridOverLay.style.cursor = 'default';\r\n                \r\n                oObjParentContainer.redrawGrid();\r\n\r\n                oObjParentContainer.fire(\"ServerOnWidgetResized\", JSON.stringify(this.getWidgetProps));\r\n            }\r\n            \r\n            eMask = oObjParentContainer._eContainer;\r\n            if (!eMask) { return; }\r\n            eMask.style.cursor = \"default\";\r\n            this._eEditBox.style.cursor = \"grabbing\";  \r\n            oObjParentContainer.hideGrid(); \r\n        }\r\n\r\n        function determineRow(oObj, eCell) {\r\n            let iRowSpan = 1;\r\n\r\n            if (oObj.piRowIndex > -1) { \r\n                return oObj.piRowIndex;\r\n            }\r\n\r\n            let sCellID = eCell.dataset.dfcellid;\r\n            let iCellRow = (parseInt(sCellID.split('-')[0]));\r\n            \r\n            if (oObj.piRowSpan <= 0) {\r\n                iRowSpan = 1;\r\n            } else {\r\n                iRowSpan = oObj.piRowSpan;\r\n            }\r\n\r\n            let iStartRow = iCellRow - (iRowSpan - 1);\r\n\r\n            return iStartRow;\r\n        }\r\n\r\n        function determineColumn(oObj, eCell) {\r\n            let iColSpan = 1;\r\n\r\n            if (oObj.piColumnIndex > -1) { \r\n                return oObj.piColumnIndex;\r\n            }\r\n\r\n            let sCellID = eCell.dataset.dfcellid;\r\n            let iCellCol = (parseInt(sCellID.split('-')[1]));\r\n\r\n            if (oObj.piColumnSpan <= 0) {\r\n                iColSpan = 1;\r\n            } else {\r\n                iColSpan = oObj.piColumnSpan;\r\n            }\r\n\r\n            let iStartCol = iCellCol - (iColSpan - 1);\r\n\r\n            return iStartCol;\r\n        }\r\n\r\n        function clearHighlightedCells() {\r\n            for (let iCell = 0; iCell < aCells.length; iCell++) {\r\n                if (aCells[iCell]) {\r\n                    aCells[iCell].style.backgroundColor = 'transparent';\r\n                }\r\n            }\r\n\r\n            aCells = [];\r\n        }\r\n\r\n        df.events.addDomListener(\"mousemove\", eMask, onResize, this);\r\n        df.events.addDomListener(\"mouseup\", window, onStopResize, this);\r\n        df.events.addDomListener(\"mouseup\", eMask, onStopResize, this);\r\n            \r\n        oEv.stop();\r\n    }\r\n\r\n    getDragData  (oEv, eDraggedElem) {\r\n        let oData = {\r\n            sControlName : this.getLongName(),\r\n            WidgetProps : this.getWidgetProps()\r\n        }\r\n\r\n        this._oParent.initWidgetDrag(oEv, this);\r\n        \r\n        return [oData, df.dragActions.WebWidgetContainer.ciDragWidget]\r\n    }\r\n\r\n    moveWidget (iRow, iCol) {\r\n        if (this.piRowIndex != iRow) {\r\n            this.set_piRowIndex(iRow);\r\n        }\r\n\r\n        if (this.piColumnIndex != iCol) {\r\n            this.set_piColumnIndex(iCol);\r\n        }\r\n    }\r\n\r\n    getParentContainer  (eStartElem) {\r\n        let oObjParentContainer;\r\n        let eElem = eStartElem;\r\n        let oWebApp = this.getWebApp();\r\n\r\n        if (!oWebApp) { return; }\r\n\r\n        while(eElem && eElem !== document && (!(oObjParentContainer && oObjParentContainer._bIsContainer) || (oObjParentContainer == this.oObj))){\r\n            if(eElem.hasAttribute(\"data-dfobj\")){\r\n                oObjParentContainer = oWebApp.findObj(eElem.getAttribute(\"data-dfobj\"));\r\n            }\r\n            eElem = eElem.parentNode;\r\n        }\r\n\r\n        return oObjParentContainer;\r\n    }\r\n\r\n    hideEditBox () {\r\n        if (this._eEditBox) {\r\n            this._eEditBox.parentNode.removeChild(this._eEditBox);\r\n            this._eEditBox = null;\r\n        }\r\n    }\r\n\r\n    createObserver (){\r\n        if(!this._eElem || this._oObserver) return;\r\n\r\n        this._oObserver = new ResizeObserver((entries) => {\r\n            let nHeight = entries[0]?.contentRect.height;\r\n            if (!nHeight){\r\n                nHeight = this._eElem.getBoundingClientRect()?.height || 0;\r\n            }\r\n            this.sizeHeight(nHeight);\r\n\r\n            // Whenever the size changes, reposition existing editbox (if shown)\r\n            this.repositionEditBox();\r\n        });\r\n\r\n        this._oObserver.observe(this._eElem);\r\n\r\n        this._oMutationObserver = new MutationObserver((mutationList) => {\r\n            this.repositionEditBox();\r\n        });\r\n\r\n        this._oMutationObserver.observe(this._eElem, {\r\n            attributes : true,\r\n            attributeFilter: [\"style\"],\r\n            attributeOldValue: true,});\r\n    }\r\n\r\n}","import { WebDragDropHelper } from \"../dragdrop/WebDragDropHelper.js\";\r\n\r\nexport class WebWidgetContainerDragDropHelper extends WebDragDropHelper {\r\n\r\n    constructor(sName, oParent){\r\n        super(sName, oParent);\r\n    }\r\n\r\n    onDrop(oEv, oSourceDfObj, oDropZone) {\r\n        const oDragData = this._oDragData;\r\n        \r\n        if (oDragData && oDropZone && this.supportsDropAction(oDropZone._oControl, oDropZone._eDropAction) ) {\r\n            const oDropData = oDropZone.getDropData();\r\n\r\n            // Send OnDrop serveraction\r\n            var oDragDropData = {\r\n                DragData : this._oDragData.oData,\r\n                DropData : oDropData\r\n            }\r\n\r\n            this.getWebApp()?.findObj(oDragDropData.DragData.sControlName)?.moveWidget(oDropData.data.iRow, oDropData.data.iCol);\r\n\r\n            oDropZone._oControl.fire(\"ServerOnWidgetMoved\", [oDragDropData.DragData.sControlName, oDropData.data.iRow, oDropData.data.iCol]);\r\n        }\r\n\r\n        this.onDragEnd(oEv);\r\n    }\r\n\r\n}","import { WebGroup } from \"../WebGroup.js\"\r\nimport { df } from \"../../df.js\"\r\n\r\nexport class WebWidgetContainer extends WebGroup {\r\n    \r\n    constructor(sName, oParent) {\r\n        super(sName, oParent);\r\n        \r\n        // All these props need to be forwarded to the child container\r\n        this.prop(df.tBool, \"pbAutoToggleGrid\", false);\r\n        this.prop(df.tBool, \"pbDisableInternalDragDropHelper\", false);\r\n        this.prop(df.tBool, \"pbUseCustomConfigurationStorage\", false);\r\n\r\n        // Event props\r\n        this.prop(df.tBool, \"pbServerOnToggleEditMode\", false);\r\n        this.prop(df.tBool, \"pbServerOnWidgetMoved\", false);\r\n        this.prop(df.tBool, \"pbServerOnWidgetResized\", false);\r\n\r\n        // this.event(\"OnToggleEditMode\", df.cCallModeWait);\r\n\r\n        this._oWidgetContainer = null; // Set by child container\r\n\r\n        // Configure super classes\r\n        this._sBaseClass = \"WebGroup\";\r\n        this._sControlClass = \"WebWidgetContainer\";\r\n    }\r\n\r\n    create(){\r\n        super.create();\r\n        this.peLayoutType = df.layoutType.ciLayoutTypeFlow;\r\n    }\r\n\r\n    // Todo - prevent creation of non-widgetcontainer class objects\r\n    afterRender () {\r\n        super.afterRender();\r\n    }\r\n\r\n    // Forward prop websets\r\n    set_pbAutoToggleGrid  (bVal) {\r\n        this.pbAutoToggleGrid = bVal\r\n\r\n        this._oWidgetContainer?.set_pbAutoToggleGrid(bVal);\r\n    }\r\n\r\n    set_pbDisableInternalDragDropHelper  (bVal) {\r\n        this.pbDisableInternalDragDropHelper = bVal\r\n\r\n        this._oWidgetContainer?.set_pbDisableInternalDragDropHelper(bVal);\r\n    }\r\n\r\n    set_pbUseCustomConfigurationStorage  (bVal) {\r\n        this.pbUseCustomConfigurationStorage = bVal\r\n\r\n        this._oWidgetContainer?.set_pbUseCustomConfigurationStorage(bVal);\r\n    }\r\n\r\n    set_pbServerOnToggleEditMode  (bVal) {\r\n        this.pbServerOnToggleEditMode = bVal\r\n\r\n        this._oWidgetContainer?.set_pbServerOnToggleEditMode(bVal);\r\n    }\r\n\r\n    set_pbServerOnWidgetMoved  (bVal) {\r\n        this.pbServerOnWidgetMoved = bVal\r\n\r\n        this._oWidgetContainer?.set_pbServerOnWidgetMoved(bVal);\r\n    }\r\n\r\n    set_pbServerOnWidgetResized  (bVal) {\r\n        this.pbServerOnWidgetResized = bVal\r\n\r\n        this._oWidgetContainer?.set_pbServerOnWidgetResized(bVal);\r\n    }\r\n\r\n    // Drag drop logic, partially forwarded to underlying container\r\n\r\n    // Map dragdrop to underlying container\r\n    getDragSourceObj () {\r\n        return this._oWidgetContainer;\r\n    }\r\n\r\n    // Map dragdrop to underlying container\r\n    getDropTargetObj () {\r\n        return this._oWidgetContainer;\r\n    }\r\n\r\n    getDragData  (oEv, eDraggedElem) {\r\n        // Should this return the dragged widget??\r\n        return this._oWidgetContainer.getDragData(oEv, eDraggedElem);\r\n    }\r\n    \r\n    getDropData  (oDropZone, oPosition) {\r\n        return this._oWidgetContainer.getDropData(oDropZone, oPosition);\r\n    }   \r\n}"],"names":["dev","isSafari","isChrome","isOpera","isMoz","isIE","isEdge","isWebkit","isMobile","isIOS","iVersion","detectDevice","this","_sPrevUA","navigator","userAgent","indexOf","document","documentMode","appVersion","parseInt","substr","parseFloat","product","test","gui","disableTabIndexes","eParent","aElems","df","dom","query","cFocusSelector","iElem","length","eElem","getAttribute","setAttribute","tabIndex","restoreTabIndexes","removeAttribute","hidePlugins","aHidden","i","push","style","display","restorePlugins","getAbsoluteOffset","eElement","oReturn","left","top","bFirst","offsetParent","getCurrentStyle","position","offsetTop","offsetLeft","y","x","getViewportHeight","undefined","window","innerHeight","compatMode","documentElement","clientHeight","body","getViewportWidth","clientWidth","innerWidth","getSize","width","offsetWidth","height","offsetHeight","oStyle","getPropertyValue","getComputedStyle","currentStyle","getVertBoxDiff","iOptType","iDiff","marginTop","borderTopWidth","paddingTop","marginBottom","borderBottomWidth","paddingBottom","getHorizBoxDiff","marginLeft","borderLeftWidth","paddingLeft","marginRight","borderRightWidth","paddingRight","isSizedByContent","iCH","appendChild","create","bRes","removeChild","lastChild","getBoundRect","oR","getBoundingClientRect","right","bottom","rectToObj","getTransformProp","sPrefix","aPre","createElement","getTrans","initCSS","aC","sB","className","replace","trim","split","join","isOnScreen","el","rect","isElementFullyOnScreen","addScrollListeners","fListen","oEnv","on","removeScrollListeners","shift","off","cssTextAlign","eAlign","ciAlignLeft","ciAlignCenter","ciAlignRight","events","keys","modifier","legacyModifier","whiteSpace","navigation","editing","ui","device","imeCompositionKeys","koreanSpecific","japaneseSpecific","commonFunction","multimedia","multimediaNumpad","audio","speech","application","browser","mobilePhone","tv","mediaControls","allKeys","insertInputTypes","KEY_CODE_TAB","KEY_CODE_NON_EDIT","KEY_CODE_SPECIAL","addDomCaptureListener","sEvent","fListener","oEnvironment","addEventListener","addDomListener","removeDomCaptureListener","removeDomListener","oDOMHandler","_oDfDomH","DOMHandler","addListener","removeListener","addDomKeyListener","removeDomKeyListener","addDomMouseWheelListener","sys","removeDomMouseWheelListener","stop","oEvent","iDOMHandlers","oDOMHandlers","clearDomHandlers","iHandlerId","hasOwnProperty","__DOMHandler","clear","clearDomListeners","bRecursive","visit","eChild","constructor","aListeners","aRemoveListeners","bFiring","fHandler","attach","e","fire","attachEvent","removeEventListener","detachEvent","Error","console","warn","splice","DOMEvent","bCanceled","call","oError","handleError","oListener","pop","preventDefault","returnValue","eSource","sName","event","getTarget","eTarget","target","srcElement","nodeType","parentNode","getMouseX","clientX","getMouseY","clientY","getKeyCode","keyCode","isSpecialKey","iKeyCode","type","getAltKey","getCtrlKey","isKeyPrintable","key","inputIsInsert","inputType","getCharCode","charCode","ctrlKey","getShiftKey","shiftKey","altKey","getMouseButton","which","button","getMouseWheelDelta","iDelta","detail","wheelDelta","cancelBubble","canceled","stopPropagation","matchKey","keydef","Array","bCtrl","bShift","bAlt","JSHandler","sOptServerName","sServerName","iListener","oSource","oOptions","JSEvent","sProp","Object","reduce","acc","sKey","concat","piDomCounter","fHan","aEv","NodeList","forEach","eItem","sItem","genDomId","addClass","sClass","sClassName","bFound","aClasses","removeClass","toggleClass","bVal","createCSSElem","sFile","eStyle","rel","href","isBefore","eElem1","eElem2","cur","previousSibling","setText","sValue","innerHTML","toString","innerText","textContent","getText","getOuterHTML","outerHTML","eFake","tagName","sHTML","deepClone","eOrig","fChecker","eClone","cloneNode","iChild","value","childNodes","swapNodes","eNew","replaceNode","replaceChild","insertAfter","eNewElement","nextSibling","insertBefore","isParent","eStart","eSearch","searchParent","sTagName","toUpperCase","focus","bSelect","select","setActive","err","getCaretPosition","eField","getSelection","start","getSelectionLength","iStart","iEnd","selectionStart","selectionEnd","selection","oRange","createRange","parentElement","iLen","sNormalizedValue","oTextInputRange","createTextRange","moveToBookmark","getBookmark","oEndRange","collapse","compareEndPoints","moveStart","slice","moveEnd","end","setCaretPosition","iCaretPos","oSel","getFirstFocusChild","fWorker","disableTextSelection","unselectable","MozUserSelect","webkitUserSelect","enableTextSelection","ready","readyState","sHtml","eWrapper","isArray","firstChild","sSelect","bOptMulti","querySelector","querySelectorAll","aRes","translateY","iY","bTopFB","sPre","translateX","iX","bLeftFB","transition","sTransition","fFinish","transEnd","oEv","encodeHtml","encodeAttr","windowWidth","Math","max","scrollWidth","windowHeight","scrollHeight","animFrame","fCallback","requestAnimationFrame","setTimeout","setTabIndex","iVal","hasAttribute","json","parse","sString","JSON","SyntaxError","stringify","oObject","vt","generateDeserializer","tDef","aCode","iFC","aObjs","switchType","sC","tBool","tInt","tNumber","tDate","parseEndNode","iFunc","aFunc","parseArray","sM","parseObj","Function","generateSerializer","deserialize","tVT","toBool","v","toInt","toNumber","toDate","c","oRes","oErr","message","serialize","tStruct","oObj","fromBool","Date","fromDate","aArray","ref","getType","sType","getConstructorName","getMethodName","fFunction","substring","getGlobalObj","getNestedProp","sPath","oProp","aParts","iPart","setNestedProp","oValue","math","padZero","iNum","iDigits","sResult","isNumeric","n","isNaN","isFinite","data","stringToNum","sVal","sDecSep","sOptThousSepp","numToString","nVal","iPrecision","aVal","applyDateMask","dValue","sMask","sDateSeparator","sOptTimeSeparator","bMinute","iPos","toLowerCase","getMonth","getMinutes","string","copyCase","lang","monthsShort","monthsLong","getDate","daysShort","getDay","daysLong","getFullYear","getHours","getSeconds","getMilliseconds","applyNumMask","nValue","sThousSep","sCurSym","sChar","bEscape","iChar","iNumChar","iCount","sBefore","sDecimals","sMaskBefore","aResult","sMaskDecimals","iMaskBefore","iMaskDecimals","bThousands","bBefore","charAt","toFixed","String","unshift","aAfter","applyWinMask","iValChar","acceptWinMaskChar","sValChar","match","stringToDate","sFormat","dResult","iDate","iMonth","iYear","iHour","iSecond","iMinute","iFraction","dToday","aValues","aFormat","sV","dateToString","dateToWeek","dDate","date","getTime","setHours","setDate","week1","round","removeFromArray","formatRegExp","format","sStr","oReps","reps","str","p1","offset","s","markupDataSize","iBytes","escapeRegExp","compareText","sVal1","sVal2","localeCompare","compareRevText","compareBCD","compareRevBCD","compareDate","compareRevDate","compareDateTime","compareRevDateTime","compareTime","compareRevTime","compareFunction","eDataType","bRev","ciTypeBCD","ciTypeDate","ciTypeDateTime","ciTypeTime","serverToType","tVal","typeToDisplay","oWebApp","bInputMask","ciTypeText","psDateSeparator","psTimeSeparator","psDecimalSeparator","psThousandsSeparator","psCurrencySymbol","psDateFormat","psDateTimeFormat","psTimeFormat","cookie","set","sVar","iExpires","sOptPath","sParams","toGMTString","del","setTime","get","sDefault","aVars","iVar","aVar","ltrim","rtrim","sSample","bUpper","supportHtml5Input","oCache","prototype","find","callback","TypeError","list","thisArg","arguments","element","values","obj","vals","propertyIsEnumerable","replaceAll","search","replacement","Element","matches","msMatchesSelector","webkitMatchesSelector","closest","sDfVersion","settings","formKeys","findGT","findLT","findGE","findFirst","findLast","save","clearAll","remove","prompt","tabOut","submit","escape","listKeys","scrollUp","scrollDown","scrollRangeUp","scrollRangeDown","scrollPageUp","scrollPageDown","scrollTop","scrollBottom","leftSwipeBtns","rightSwipeBtns","selectAll","deSelectAll","collapseAllGrp","expandAllGrp","collapseGrp","expandGrp","gridKeys","nextCol","prevCol","newRow","tabKeys","enter","calendarKeys","dayUp","dayDown","dayLeft","dayRight","monthUp","monthDown","yearUp","yearDown","close","treeKeys","moveUp","moveDown","extend","moveFirst","moveLast","sliderKeys","sliderUp","sliderDown","sliderLeft","sliderRight","menuKeys","moveLeft","moveRight","spinKeys","suggestionKeys","backSpace","delete","forceDisplay","psVersionId","pnDataFlexVersion","aV","ciRegionCenter","ciRegionLeft","ciRegionRight","ciRegionTop","ciRegionBottom","ciLabelLeft","ciLabelTop","ciLabelRight","ciLabelFloat","ciDirGT","ciDirLT","ciOpenSameWindow","ciOpenNewTab","ciOpenNewWindow","cwiActual","cwiStretch","cwiStretchHoriz","cwiCenter","cwiFit","cwiCover","csUnsorted","csDescription","csValue","cCrumbHorizontal","cCrumbDropDown","cCrumbCaption","tUnknown","tString","tAdv","gtAutomatic","gtAllData","gtManual","grpDisabled","grpCustom","grpAutomatic","cCallModeDefault","cCallModeWait","cCallModeProgress","smFind","smValidationTable","smCustom","ctExecDefault","ctExecEarly","ctExecViewLoad","modeDesktop","modeTablet","modeTabletLandscape","modeTabletPortrait","modeMobile","modeMobileLandscape","modeMobilePortrait","adActionBar","adMenu","adBoth","wbNone","wbWrap","wbPre","wbPreWrap","wbEllipsis","dropPositions","ciDropUnknown","ciDropOn","ciDropBefore","ciDropAfter","ciDropOnEmpty","dragActions","WebList","ciDragRow","WebMultiSelectList","ciDragRowSelection","WebTreeView","ciDragFolder","ciDragItem","WebTagsForm","ciDragTag","WebWidgetContainer","ciDragWidget","dropActions","WebControl","ciDropOnControl","ciDropOnRow","ciDropOnRoot","ciDropOnFolder","ciDropOnItem","ciDropOnInput","ciDropOnCell","WebUIContext","WebUIContextCustom","WebUIContextListHead","WebUIContextListRow","WebUIContextListFull","WebUIContextListSelection","WebUIContextTreeviewFolder","WebUIContextTreeviewItem","WebUIContextTagsFormTag","isChildScopeCompatible","eContext","layoutType","ciLayoutTypeInherit","ciLayoutTypeFlow","ciLayoutTypeGrid","rowColValType","ciTypeDefault","ciTypeFixed","ciTypeFraction","ciTypeOther","CssEnabled","CssDisabled","CssHit","hitTimeout","psIncludeLocation","aScripts","getElementsByTagName","src","psRootPath","from","eScript","ajax","aZReservations","reserveZIndex","freeZIndex","iIndex","iRes","dragMask","eMask","defineClass","sSuper","oProto","fConstructor","fSuper","oPrototype","alert","newClass","super","apply","assign","base","mixin","sMixin","error","val","fromNumber","nNumber","toDateTime","fromDateTime","_tValue","timeValues","timeStart","sLbl","sLog","log","timeStop","time","pbDebugging","bDfDebug","location","debug","oOptSource","getWebApp","WebApp","iNumber","sText","iLine","sTarget","bUserError","classWordBreak","eMode","aOptReplacements","sOptDetailHtml","bOptSrv","bOptUsr","sOptCaption","oOptTarget","iOptLine","sCaption","oTarget","bServer","sDetailHtml","HttpRequest","static","REQUEST_STATE_UNITIALIZED","REQUEST_STATE_LOADING","REQUEST_STATE_LOADED","REQUEST_STATE_INTERACTIVE","REQUEST_STATE_COMPLETE","sUrl","sData","pbWithCredentials","bAsynchronous","sExpectedContentType","onFinished","onError","onClose","oLoader","bSilent","send","that","XMLHttpRequest","getData","onreadystatechange","onReadyStateChange","open","getRequestUrl","withCredentials","setHeaders","states","status","checkErrors","getFinishedDetails","oResponseXml","getResponseXml","sResponseText","getResponseText","bSkip500","responseText","statusText","sResponseContentType","getResponseHeader","responseXML","cancel","abort","aListener","destroy","onreadstatechange","JSONCall","sFunction","oParams","bUsePOST","bExtendURL","_oJSON","addParam","setRequestHeader","sParam","aParams","encodeURIComponent","tError","errorCode","errorDescription","reason","getResponseValue","sJSON","MobRuleController","_oWebApp","peMode","pbActive","_aWOs","_aModes","eM","sCSS","init","detectMode","onWindowResize","regWO","oWO","remWO","enforceMode","sizeChanged","_oPropRuleStore","enforceRule","tDet","_oSynced","aRules","_set","bActive","iWidth","iHeight","bLandscape","detectOrientation","screen","dfOrientation","orientation","activate","deactivate","WebObject","oParent","_sName","_oParent","_oTypes","_aChildren","_oServerActionModes","_oServerWaitMsg","_tActionData","_bStandalone","_oView","_bIsWO","_bIsDynamic","_oModeControl","addChild","oChild","prop","eType","toLocalType","toServerType","bOptNoSync","addSync","bSetter","bSync","unSync","getSynced","aAdvProps","aProps","sObj","getLongName","sO","sP","tV","sN","aP","getLongNamePrnt","getView","getObjectLevel","oView","iLevel","serverAction","sMethod","aOptParams","tOptData","fOptHandler","oOptEnv","serverActionEx","tData","oHandlerEnv","oConf","oAction","sAction","aViews","oPlatformSpecific","eCallMode","sProcessMessage","handleAction","cancelServerAction","cancelAction","hasPendingServerAction","hasPendingAction","callBack","setActionMode","sOptWaitMessage","getActionMode","eOptMode","fireEx","bResult","bASync","oJsHandler","bClient","sReturnVal","aView","bSkipClient","oFunc","findFunc","fFunc","sAltServerName","bSkipServer","tActionData","oActEvent","sReturnValue","insertChild","renderChild","eOptChild","unrenderChild","propRule","sort","a","b","sFunc","oCur","sCur","oGlob","oPrnt","WebDragDrop_Mixin","superclass","_sRawDragData","_aDragDropHelpers","Set","_aDropZones","_aDragActions","_aDropActions","addDragDropEventListeners","_eElem","onDragStart","onDragEnd","size","registerDragSource","oHelper","eAction","add","resize","registerDropTarget","has","initDropZones","getDragSourceObj","getDropTargetObj","addDropZone","eZone","oOptControl","oDropZone","removeDropZone","filter","DropZone","removeDropZoneByElem","_eZone","initDraggableElements","dragDropInit","dragDropCleanup","oDragData","eDragAction","getDragData","onDrop","eDropAction","onControlDragOver","eDropElem","oData","getDropData","highlightDropZones","dropZone","highlight","cleanupDropZones","unhighlight","removeDropElemInteractions","hasData","determineDropCandidate","aHelpers","determineDropPosition","interactWithDropElem","highlightElement","doEmptyInteraction","isSupportedDragAction","isSupportedDropAction","WebBaseUIObjectBase","WebBaseUIObject","OnAfterRender","OnAfterShow","OnAfterHide","_bWrapDiv","_bRenderChildren","_bFocusAble","_sControlClass","_sBaseClass","_aKeyHandlers","_bShown","openHtml","aHtml","genClass","psHtmlId","pbRender","pbVisible","closeHtml","render","getRef","renderChildren","afterRender","afterRenderChildren","onKeyDownHandler","attachFocusEvents","set_psTextColor","psTextColor","psBackgroundColor","set_psBackgroundColor","afterShow","afterHide","eContainer","isActive","isEnabled","pbEnabled","updateEnabled","applyEnabled","psCSSClass","color","background","set_pbVisible","visibility","set_pbRender","set_pbEnabled","set_psCSSClass","set_psHtmlId","id","addKeyHandler","sServerMsg","oKH","findKeyHandler","aMsg","iKey","removeKeyHandler","iIndexOut","oH","_oCurrentObj","validate","svrFocus","oW","updateFocus","bFocus","objFocus","objBlur","onFocus","onBlur","oV","bOptSelect","conditionalFocus","scrollIntoView","bAlignToTop","focusNext","oP","oC","bPosition","_bIsContainer","_bPositionChanged","objSizeChanged","notifyLayoutChange","_bIsView","_bIsBaseApp","fireSubmit","makeVisible","determineSelectorForWebUIContext","verifyElementForWebUIContext","retrieveValueFromWebUIContext","oPosition","_eDropElem","getControlValue","action","supportsDropAction","topLayer","WebBaseControl","_eInner","_eLbl","_eControlWrp","_eControl","_oInfoBalloon","_oObserver","_sControlId","_bHasFocus","_bJSSizing","pbShowLabel","pbFillHeight","peLabelPosition","genLabelHtml","psLabel","psValue","onLblClick","posLabel","set_psLabelColor","psLabelColor","set_peLabelAlign","peLabelAlign","set_psToolTip","psToolTip","piHeight","sizeHeight","_bShowInfoBallon","show","initObserver","destroyObserver","set_psLabel","set_pbShowLabel","textAlign","set_piLabelOffset","piLabelOffset","set_peLabelPosition","title","set_piColumnIndex","piColumnIndex","set_piColumnSpan","piColumnSpan","set_piMinHeight","piMinHeight","set_piHeight","set_pbFillHeight","isInGridContainer","createObserver","ResizeObserver","entries","nHeight","contentRect","observe","disconnect","iExtHeight","bSense","setHeight","getVertHeightDiff","iResult","iOffset","sColumns","sRows","gridTemplateColumns","gridTemplateRows","getTooltipElem","showInfoBalloon","sCssClass","bShow","psCssClass","psMessage","update","InfoBalloon","hideInfoBalloon","hide","isGridLayout","WebBaseContainer_mixin","_oRegionTop","_oRegionLeft","_oRegionCenter","_oRegionRight","_oRegionBottom","_eRegionTop","_eMainArea","_eRegionLeft","_eRegionCenter","_eContent","_eRegionRight","_eRegionBottom","_eContainer","_aUIObjects","_aPanels","_aFloats","_bHasFill","_iContentHeight","_bRendered","_bPanels","_bIsPanel","_iWantedHeight","_bWantedChanged","_iWhiteSpaceHeight","_aRowsTemplate","_aColsTemplate","_iTotalRowHeight","wrpOpenHtml","wrpCloseHtml","onScroll","_eSizer","_iLastInnerHeight","placePanels","isFlowLayout","_bFloating","peRegion","eBefore","bMoveOperation","oInsertAfter","nextElementSibling","firstElementChild","ePnl","oPnl","previousElementSibling","pbScroll","prepareSize","iCur","iNeeded","iMiddleNeeded","iMiddle","iPrevWanted","_bStretch","getHeightDiff","resizeColumnLayout","_iMinHeight","_bSizePrep","resizeHorizontal","piWidth","setOuterWidth","updateMinWidth","resizeVertical","iVSpace","iPanelHeight","iCenter","iLeft","iRight","bStretch","setOuterHeight","iMiddleSpace","_oCurrentView","iMiddleWanted","_iMiddleHeight","setInnerHeight","minHeight","setInnerWidth","piMinWidth","minWidth","iMinHeight","iSpace","iSize","oStretch","iSpan","iCol","iRowHeight","aStretch","piColumnCount","iChildColIndex","aItems","getMinHeight","nOffset","peLayoutType","positionFlow","positionGrid","iColSpan","iColCount","aRows","aCols","eContent","aColsCustWidths","parsePsColumnWidths","oCol","sWidth","oCustWidthCol","col","sDefaultColumnWidth","getDefaultColumnWidth","map","tCol","iDefaultHeight","getDefaultRowHeight","sDefaultRowHeight","genBaseRowHeightString","gridAutoRows","aChildren","iTotalRows","sortChildren","piRowCount","aRowsCustHeights","psRowHeights","iHighestRowNum","parsePsRowHeights","r","oRow","sHeight","oCustHeightRow","row","tRow","iColIndex","sColIndex","sRowIndex","piRowIndex","iRowSpan","piRowSpan","gridColumn","gridRow","determineRowHeights","aRowHeights","asRowHeights","determineColumnWidths","aColWidths","asColWidths","psColumnWidths","asColsTemplate","aColWidthParts","includes","iHighestRowIndex","aRowHeightParts","aObjects","piDefaultRowHeight","psDefaultColumnWidth","styleFloat","cssFloat","floor","getRequiredHeight","bOut","bIn","bContentOut","bContentIn","getWidthDiff","getContentWidthDiff","notifyScroll","set_piWidth","set_piMinWidth","set_piColumnCount","set_psRowHeights","set_psColumnWidths","set_pbScroll","WebBaseContainer","WebBaseDEO","_sOrigValue","_sPrevChangeVal","_bValueInvalid","_bMasks","_oMask","_bAutoFind","_bReplaceDecSepp","_oErrorBalloon","_aErrors","_bRendering","set_peDataType","peDataType","set_psValue","set_pbCapslock","pbCapslock","set_peAlign","peAlign","set_pbRequired","pbRequired","onChange","onKey","updateErrorDisp","detach","disabled","get_pbChanged","pbChanged","updateTypeVal","getServerVal","refreshDisplay","hideAllControlErrors","get_psValue","bSvr","initMask","set_psMask","psMask","eVal","setControlValue","piPrecision","dateFormat","dateTimeFormat","timeFormat","dateSep","decSep","thousSep","timeSep","clearWinMask","validateDateRange","pbLimitDateRange","genNumMask","genDateMask","genWinMask","aMask","bEnter","bNumeric","bAlpha","bPunct","filterWinMask","iNewPos","sOrig","correctWinMask","iMaskPos","sNew","iAdded","clearVal","regex","updateFormat","sDateSepp","sTimeSepp","asFormat","sRegex","sPart","oNew","oNext","iMax","RegExp","parseValue","exec","bDirty","oPart","bAdd","filterDate","bAllow","iMoveCarret","iCarret","bNum","bAppend","oCP","sNewVal","correctDate","sDecSepp","sDecSepparators","iLength","piMaxLength","bNegative","sNum","bHasDecSep","iDecSepOffset","sDec","filterNumeric","bAdjust","correctNumeric","showControlError","hideControlError","fireChange","fireAutoFind","selectAndFocus","iErrNum","sErrText","getErrorElem","WebBaseForm","set_pbReadOnly","pbReadOnly","onKeyDownSrv","onInputSrv","floatLabel","checkAutoFill","maxLength","readOnly","set_piMaxLength","set_psAutoComplete","autocomplete","matchSelector","iTries","doCheckAutoFill","selector","matchesSelector","mozMatchesSelector","oMatchesSelector","WebPanel","_eDivider","set_pbResizable","pbResizable","onResize","set_peRegion","iCurLeft","iCurTop","iMin","eGhost","cursor","iStartLeft","iStartTop","iStartMouseX","iStartMouseY","onStopResize","WebBaseView","_eRenderTo","_show","showView","_hide","hideView","windowResize","iBrowserWidth","iBrowserHeight","centerWindow","_bFireOnResize","getInvoking","psInvokingView","returnFocus","set_psCaption","psCaption","updateCaption","set_pbShowCaption","pbShowCaption","WebWindow","_bHasLeft","_bHasTop","_eMask","_oPrevFocus","pbModal","piLeft","piTop","pbShowClose","_eHeader","_eHeaderContent","_eControlWrap","_eMainRight","_eMainLeft","_eTopLeft","_eTopRight","_eTopContent","_eBottomLeft","_eBottomRight","_eResizer","_eBottomContent","_eCloseBtn","onStartDrag","onStartResize","onCloseClick","eRenderTo","bRender","_eViewPort","showModal","pbFloating","pbFocusFirstOnShow","activeElement","oControl","findObj","dataset","dfobj","OnShowWindow","oWindow","bModal","bNoServerEvents","oInvoking","_oCurrentWindow","OnHideWindow","set_pbShowClose","set_piTop","set_piLeft","createGhost","eGhostContent","eGhostHeader","oSize","sOrigId","iTopLim","iLeftLim","iDragOffsetTop","iDragOffsetLeft","onDrag","onStopDrag","classList","eTar","resizeDrag","bWidth","bLeft","bHeight","bTop","sCursor","iStartWidth","iStartHeight","aHiddenPlugins","iMarginRight","getViewportElem","blur","doClose","viewResize","iMaxH","WebModalDialog","psFloatByControl","floatByControl","boundRect","oldPiTop","oldPiLeft","WebLabel","peWordBreak","set_pbShowBorder","pbShowBorder","set_peWordBreak","WebProgressBar","_eProgressBarWrp","_eProgress","_ePercentage","pbShowPercentage","set_piValue","piValue","getPercentage","iCustomDecimals","iDecimals","piDecimals","pow","fPercentage","piMaxValue","set_pbShowPercentage","set_piMaxValue","WebButton","set_pbShowWaitDialog","pbShowWaitDialog","onBtnClick","tTimer","bDone","psLoadViewOnClick","psWaitMessage","set_psWaitMessage","WebSpacer","WebIFrame","_eWrapper","_sContentHtml","onFrameLoad","set_psUrl","psUrl","writeHtmlContent","sNewLoc","contentWindow","setHtmlContent","write","WebHtmlBox","onHtmlClick","updateHtml","psHtml","appendHtml","prependHtml","updateHtmlArray","overflowY","overflowX","set_psHtml","BaseApp","pbViewApp","sDfPreloadTheme","OnError","OnShowProgress","OnHideProgress","_oPreLoaded","_oMenuHub","_aSyncPropCache","_aAdvSyncPropCache","_aViews","_aFocussed","_bReady","_aLoadQueue","_oLoadViewQueue","_aPreLoadViewActions","_bInitStarted","_bCallTimeout","_oPendingCall","_oSendingCall","_eLocked","_aLockwaiters","_eStyleSystem","_eStyleTheme","_eStyleApplication","_sRootPath","_oTranslations","_aModalQueue","_tResizeTimer","_bSizeChanged","_bContainerStretch","_aResponseAttachments","attachGlobalHandlers","set_pbResponsive","pbResponsive","onOrientationChange","onPopState","onHashChange","piScreenHeight","piScreenWidth","_eViewRegion","initialize","bLoadDefault","checkBrowser","updateCSS","testCSS","sView","aWaiters","bLoading","displayApp","oRenderTo","forceResize","displayView","renderView","queueModal","sOptCallbackMsg","sOptCallbackObj","bOptNoServerEvents","loadView","bPreLoaded","sOptInvoker","ServerAction","tAct","execClientAction","unloadView","bDefinition","_oWODefStore","oWin","getFocusObjName","set_pbMDI","notifyPosChange","initJSON","initObj","oContext","FConstructor","getConstructor","aAdvP","newWebObject","waitForCall","lock","sWaitMessage","oDialog","_eLockMask","_tLockCursor","onBlockKey","_bLockWait","sMessage","_oLockModalBlock","bFinished","bDisplayed","_oLockDialog","oLabel","unlock","oHandler","clearTimeout","processModal","aActions","ServerCall","sFocus","processCall","processResponse","oCall","Header","asReturnValues","tResponse","handleHeader","process","sendCall","then","catch","finally","requestIdleCallback","timeout","assembleRequest","aAttachments","iAttached","getHeader","Promise","resolve","reject","oDone","tHead","aDDOViews","aSyncProps","aAdvSyncP","addView","oViewObj","sViewName","getCachedSyncProps","oHeader","aObjectDefs","handleSyncProps","handleAdvSyncProps","tObj","cacheSyncProps","tP","cacheAdvProp","responseAttachment","tCacheObj","sStart","set_psTheme","psTheme","set_peAlignView","peAlignView","bResize","sTheme","sDfBuildNr","aStyles","eHead","head","fSuccess","fFailed","oObserver","eTest","checksize","timer","_tResizeTimeout","get_piWindowWidth","get_piWindowHeight","iMxVwH","oSrcWO","iOrientation","showInfoBox","tDetails","iWindowWidth","iViewArrayPos","OnSubmit","OnHide","oContentPnl","oButtonPnl","oCloseBtn","OnClick","showMessageBox","sReturnObj","sReturnMsg","sLabelCSSClass","iDefaultButton","oReturnObj","aButtons","showMsgBox","iBtn","oDefaultBtn","handleBtnClick","_iConfirmId","oBtn","showYesNo","bOptNull","initTranslations","initTrans","aTrans","showError","iErrLine","displayError","oDetailsBox","aDetails","pbShowBox","setPageTitle","sTitle","navigateToPage","navigateNewWindow","navigateRefresh","reload","historyPushState","state","history","pushState","historyReplaceState","replaceState","hash","get_peMode","get_pbIsMobile","get_psLocationHash","get_piBrowserTimezoneOffset","getTimezoneOffset","get_pasBrowserLanguages","languages","language","LocalApp","bViewHost","chrome","webview","onWebMessageReceived","syncObserver","bIdle","sync","MutationObserver","subtree","childList","attributes","oPromise","aAddionalObjects","oAct","aAdditionalObjects","tReq","_resolve","_reject","postMessageWithAdditionalObjects","postMessage","bSuccess","tResizeInt","aHandlers","aZones","bInDrag","iEnterCount","repositionDropZones","oZone","oDropDetails","oDetails","getDropDetails","oRect","stopDropZones","cleanupHelper","clearInterval","onWindowEnter","containsFiles","sDropClass","sDropContent","eZoneParent","setInterval","onFileDrag","onWindowOver","dataTransfer","dropEffect","onWindowDrop","handleDrop","onWindowLeave","types","addHandler","remHandler","registerHelper","removeHelper","oOpts","fEmpty","aFiles","oCurRec","uploadFilesHtml5","bLast","oFile","iFile","fFinished","displayProgress","iLoaded","iTotal","sResourceId","oReq","upload","ev","loaded","total","psUploadUrl","FormData","append","uploadFileHtml5","displayFinishWorking","pbNotifyIndividualFile","name","sFinishedResult","displayFinished","finished","processUpload","displayStartWorking","oCurFile","doStartUpload","oMainPnl","oLbl","oFileLbl","oRemLbl","oSpacer","oTotalPrg","oFilePrg","oBtnPnl","oCancelBtn","sFilesTrans","sFileTrans","onCancel","pbAllowCancel","OnEscape","pbMultiFile","iFiles","iFileLoaded","iFileTotal","iTotalLoaded","iRem","iBytesRem","WebFileUpload_Mixin","initFiles","_bUploading","_aFiles","displaySelectedFileDetails","pbAutoStart","startUpload","aAllowed","sAccept","aMime","aFileMime","bExt","psAccept","lastIndexOf","_eInput","pbShowDialog","fCallBack","set_psAccept","accept","set_pbCapture","capture","WebFileUploadBase","WebBaseFileUpload","_oDragArea","_eDragArea","fileHtml","pbCapture","onFileChange","selectFiles","File","FileList","FileReader","click","oDropObj","psDropZoneObjName","files","WebMenuItem","_oProv","itemClick","tItem","fReturn","notifyChange","set_pbBeginGroup","pbBeginGroup","set_psImage","psImage","set_peActionDisplay","peActionDisplay","getProv","oProv","psGroupName","getItemElemByHandler","aL","getHub","getListeners","_bIsMenuProv","cssClass","visible","customRender","itemHtml","itemRendered","WebMenuItemCheckbox","hRef","set_pbChecked","isChecked","pbChecked","sId","sTooltip","sGroupCaption","bEnabled","sCSSClass","sHtmlId","bBeginGroup","sImage","eCheckbox","sTextColor","sBackgroundColor","eActionDisplay","WebMenuProvider_mixin","OnUiUpdate","_aMenu","_aDynamicMenu","_bIsMenuListener","addProvider","remListener","remProvider","groupCollect","aData","genMenuData","groupUpdate","updatePaths","refreshMenu","aMen","_oHandler","oItem","psGroupCaption","_bCustomRender","set_psGroupName","set_pbAllowHtml","pbAllowHtml","deserializeVT","refresh","aMenu","initDynamic","updateItem","bOverwriteSubs","tNew","tCur","getItemById","sToolTip","insertItem","sParentId","tParent","removeItem","performUpdate","updateGroup","bUiDriven","getMenu","getItemByPath","aPath","oSub","getItemByHandler","getItemElemByPath","tItm","_sPath","genItemHtml","bSub","aClassNames","genID","expandItem","showItem","oWA","notifyMenuRendered","eMnu","WebBaseMenu","WebForm","_eWrap","_ePrompt","_bAutoTabOnUp","pbPassword","psInputMode","psPlaceHolder","psAutoComplete","onPromptClick","set_pbPromptButton","pbPromptButton","set_pbPassword","set_psPlaceHolder","placeholder","set_psInputMode","inputMode","firePrompt","iCarPos","bSelectAll","autoTab","onKeyPressAutoTab","onKeyUpAutoTab","pbAutoTab","set_pbAutoTab","WebFloatingPanel","_bViewVisible","_bVisible","pePosition","piContentWidth","pbHideOnBlur","_eArrow","_aFocusCatchers","onCaptureFocus","onCaptureBlur","onCatchFocus","positionPnl","doShow","onMaskTouch","_eBlurBuddy","_tHideBlurTimeout","pbFocusOnShow","_tPositionInterval","getFloatByRefElem","eRef","iActualHeight","iTop","iArrow","iScreenWidth","iScreenHeight","iActualWidth","pbNaturalWidth","pbShrinkIfNoSpace","maxHeight","overflow","transform","piBottom","piRight","set_pePosition","set_piContentWidth","set_pbHideOnBlur","eEl","bNoPos","sReason","doHide","WebDatePicker","OnRealtimeChange","OnEnter","_eBuddy","_bBuddyActive","_eFocus","_eBody","_eDispMonth","_eDispYear","_dSelected","_iWeekSelected","_iDisplayYear","_iDisplayMonth","_iLastDisplayYear","_iLastDisplayMonth","_aMonthNames","_aMonthNamesShort","_aDaysShort","_aDaysLong","pbShowToday","_eFooter","_eDispToday","onWrapClick","onBodyClick","onNextClick","onPrevClick","onMonthClick","onYearClick","onTodayClick","set_pbShowWeekNr","pbShowWeekNr","displayCalendar","set_pbShowToday","set_piStartWeekAt","piStartWeekAt","iDayPointer","iRows","dEnd","iDay","bHasFocus","eOld","setSelectedDate","dSelected","bOptNoAni","bOptNoDisplayNow","fireRTChange","getSelectedDate","valueOf","bShort","tMenuTimeout","eMenu","onClick","eLI","onOver","onOut","_fMonthHide","eUp","eDown","tScrollTimeout","eScroll","doScroll","onScrollStop","_fYearHide","eCell","fireEnter","fireDateClick","setMonth","setFullYear","_bLozingFocus","WebDateForm","_ePickerWrp","_bPickerVisible","_bSkipAutoShow","_bShowWait","_iWidth","_iHeight","_tOnChange","_eParentRef","pbHtml5NativeOnMobile","_eHtml5HiddenDate","html5OnChange","_oFloatingPanel","_oPicker","initPicker","oPicker","createModalDialog","createPanel","configurePanel","createDatePicker","configureDatePicker","pbHideOnEscape","onPanelClose","onPickerChange","onPickerEnter","renderPicker","showPicker","hideDatePicker","bOptNoFocus","pbAutoShow","bA","bReset","aAdvSyncProps","WebDynamicObjectContainerBase","WebDynamicObjectContainer","_aSyncPropQueue","_bReset","loadQueuedSyncProps","aQueuedSyncProps","tQueuedSyncProp","loadDynamicObjects","initDynamicObject","_oOwner","emptyPropCache","insertDynamicObject","sParent","sInsertAfter","insertDynamicObjectAtIndex","prependDynamicObject","appendDynamicObject","moveDynamicObject","sDynamicObjectId","webApp","oNewParent","oOldParent","eObj","iResizeCount","moveDynamicObjectToIndex","destroyDynamicObject","bInsert","applyQueuedSyncProps","resetContainer","vPropValue","aQueue","set_ptSyncPropsWrapper","tSyncPropsWrapper","get_ptSyncPropsWrapper","aPropList","aAdvPropList","iObj","set_ptAdvSyncPropsWrapper","tAdvSyncPropsWrapper","get_ptAdvSyncPropsWrapper","oOptObj","oEV","serializeAdvSyncProps","composeAdvSyncProp","serializeVT","composeAdvSyncPropsArray","composeAdvSyncPropsObjectArray","WebCheckbox","pbServerOnChange","psClientOnChange","_eCaption","_eFakeBox","onFakeClick","checked","psChecked","psUnchecked","tick","sDescription","WebCombo","_bFilled","_aValues","_bDeferedSet","updateList","fill","sortList","peSortItems","fCompare","options","eOpt","Option","selected","WebBaseSelectionForm","_eSuggestions","_bForceDisplay","_tRepos","_aSuggestRows","_aShownSuggestions","_oSelectedSuggestion","_iMaxCells","_bFirstFetch","_TotalOfControlRows","_ShowNextHandle","_iPage","_iAdditionalItems","_oPrevItem","_eSugContent","_eSugSuggestions","_eSugControls","_eInputBox","onSuggestKey","onSuggestClick","inputBoxOnClick","getSearchValue","contentEditable","suggestSelect","control","sRowId","handleMoreButton","suggestMove","pbAllowCreate","piMinimumItemLength","suggestHide","_bLastItemOnServer","_bMoreRequested","pbPaged","suggestLoad","oElem","suggestHightlight","suggestUpdate","_sSuggestPrevVal","piStartAtChar","_bSuggestVisible","_sSuggestBaseVal","suggestRefine","suggestDisplay","clientFilter","aList","callbackOnLoop","aFiltered","sCurVal","oRegEx","pbCaseSensitive","pbFullText","extraFilterOnHandle","suggestHandle","bRefine","aSelectables","AddControlSuggestions","findIndexByValue","suggestRender","showSuggestions","pbAllData","psShowMoreText","sCssClassName","psCreateNewItemText","sSearch","sLowerSearch","renderSuggestion","oSuggestion","makeBold","sMatch","pbSourceIsValidationTable","aControls","aSuggestionsTable","iMaxLength","pbSuggestions","piPageSize","aControlsTable","suggestPosition","sFilter","afterSuggestRefine","iDir","oSelectedSuggestion","iBottom","findSuggestionByValue","oKeys","overrideDoLoad","_overrideDoLoad","invalidateCache","_tSuggestUpdate","suggestDoLoad","piTypeTimeout","_bSuggestLoading","_sSuggestNextLoad","hSuggestionsBody","hControlsBody","bReturn","eSugg","iOffsetTop","iOffsetLeft","piPopupWidth","_tSuggestDisplay","_tSugBlurTimeout","afterBlur","WebSuggestionForm","_aScrollListeners","_sSelectedId","initDOM","psPopupCSSClass","pbClientRefinement","piPopupTimeout","pbShowResults","_aSuggestBase","piSuggestionWidth","pbHighlight","peSuggestionMode","aBase","piMaxResults","sLowVal","iRow","pbAllowForce","set_psPopupCSSClass","_aSelectedSuggestions","_sSelectedTag","_oSelectedTag","_aTagCssClass","setPlaceHolderVisibility","bVisible","setVisibility","_ePlaceHolder","setInputVisibility","hElem","getVisibility","focusInputField","_tFocus","blurInputField","defineProperty","keydown","aSelectionCache","setCachedTags","removeTagSelection","validateAsSeparator","psSeparator","bChanged","set_psSeparator","setTagSelection","sEscapedSeperator","parseSelectionValues","sList","iLastIndex","iBegin","bEven","j","getSelectedSuggestionId","clearTags","addTag","truncate","iMaximumLength","bUseBoundary","subString","setTagCssClass","sTag","tag_elem","pbDragDropEnabled","piTagTruncateAt","oTag","contains","removeTag","pbAllowTagSelection","pos","range","sel","setStart","removeAllRanges","addRange","editableDiv","caretPos","rangeCount","getRangeAt","commonAncestorContainer","endOffset","tempEl","tempRange","duplicate","moveToElementText","setEndPoint","text","pbTagOnSpace","createTag","_tUnselectTag","eDraggedElem","eTextElem","sTagText","eTag","elementFromPoint","iMid","_eDropAction","eTempElem","insertElement","eTargetElem","WebListModel","header","custom","oList","oL","bPaged","sCurrentRowId","psCurrentRowId","iCurrentRow","aDisplay","aGroupHeaders","aGroups","bIsGrouped","onDataUpdate","onBeforeDataUpdate","onBeforeRowChange","onRowChange","onAfterRowChange","_onSettingChange","onSettingChange","prepDisplay","aHiddenGroups","groupHead","iHeaderIndex","iRowIndex","tHeader","iParentHeaderIndex","iGroupIndex","bCollapsed","_iItemIndex","displayTypes","iGroupHeaderIndex","handleData","listData","peGrouping","groupData","sortData","rowIndexByRowId","isFirst","isLast","_oGrouping","piSortColumn","_aColumns","aSortCols","aCmpFuncs","pbReverseOrdering","index","customSortData","row1","row2","aCells","findIndex","rowIdByRowIndex","rowByRowIndex","rowByRowId","rowIndexToItemIndex","setCurrentRowId","sPrevRowId","iPrevRowIndex","sGotoRowId","iGotoRowIndex","updateRow","bMergeRow","newCell","iCell","origCell","aOptions","sUpdateRowId","sNewRowId","removeRow","appendRow","sBeforeRowId","iBefore","sAfterRowId","iAfter","updateCell","_iColIndex","updateCellByRowId","updateSorting","updateGrouping","WebListView","oModel","oController","oM","_oRowRenderer","bPreventSubmit","bCancelClick","bScroll","onRowsRendered","onCellClick","onAfterCellClick","genHtml","pbShowSelected","tableHtml","eList","eRowContainer","eBody","eBodyWrp","onTableClick","onTableDblClick","groupHeaderHtml","iItemIndex","tGroup","sLabel","sTotal","iItems","pbGroupsCollapsible","rowHtml","refreshRow","eRow","dfitem","eNewRow","refreshCell","cell","_iCol","cellHtml","makeCurrentRowVisible","ePrevRow","containerElem","sSelector","groupHeader","currentRowElem","item","determineCell","eSwipeBtn","bHeaderToggle","dfgrphead","oCDtl","_oTouchHandler","swipeBtnClick","cellClick","_bPreventSubmit","toggleGroupHeader","cellDblClick","bHitDone","eHitElem","tHitTimer","colCell","colCellByIndex","scrollbarWidth","getViewSize","fullwidth","setExtraRowHeight","iExtra","getExtraRowHeight","scrollToRow","sRowID","WebListScrollingView","heightCache","bZebraTop","bZebraBottom","iTableOffset","iScrollOffsetPx","iRowDispOffset","iViewOffset","iRowsDispOffset","iRowDispLast","iPrefViewOffset","iMaxViewOffsetDiff","iLastScrollbarSet","bScrollbarDirty","iAvgRowHeight","iTableHeight","bNoRender","iAutoScroll","oInitialFullEvent","bFirstFill","aItemHeightProcess","onHorizontalScroll","onVerticalScroll","bDelUpdDim","bDelUpdDimForced","_onResize","_oDimUpdConf","pbAutoColumnSizing","eTableWrp","eTable","eScrollbar","eScrollStretch","onMouseWheelScroll","onScrollbarScroll","onHorizbarScroll","onContentLoaded","afterFirstFill","scrollToCol","iMaxPX","clearHeightCache","updateScrollbarSize","centerCurrentRow","updatePosition","dimensionUpdate","bUpdateRows","bUpdateScrollbar","bForceRedraw","smartRepositionCurrentRow","iOffsetChange","scrollToCurrentRow","combinedRowHeightPx","scrollTo","iDisplayItem","scrollToDisplayItem","scroll","bSnap","bFromScrollbar","bNoBoundaries","updateScrollbarPos","updateCache","iViewOffsetPx","iViewEndOffsetPx","iRowPx","iInitScrollOffsetPx","iViewRowOffsetPx","iRowViewLast","iRowScrollOffset","iEmptyRows","iTotalPx","tableHeight","getMaxPX","min","rowHeightPx","iCalcEmptyRows","adjustDisplay","updateScrollOffset","iAllowedDiff","insertRow","removeBottomRow","removeTopRow","prepend","_iRowHeight","realHeight","realMargin","iMarginTop","iMarginBottom","updateItemHeight","sRowClass","bChange","updateAvgRowHeight","iSum","updateRenderedRowHeights","iItem","processRowHeights","iHeightPx","_iRowHeightExtra","iTo","snapToRow","iOffsetPx","abs","triggerCacheUpdate","smartRepositionDisplayItem","scrollLeft","_oBody","scrollToHoriz","iScrollX","determineDimensions","iPrevTableHeight","iTableWidth","waitForRepaint","oConfig","aFinished","nScrollX","WebListPagedModel","iPrefCacheOffset","sStartRowId","reverse","WebListController","iRowChangeCount","onCellDblClick","_onKeyDown","keyDown","bNoRowChange","sColVal","cellClickBefore","selectRow","cellClickAfter","fireRowClick","headClick","pbColumnSortable","pbSortable","changeSorting","headDblClick","bReverse","iPrevCol","bPrevReverse","keyPress","pbAutoSearch","bNoSearch","hasFocus","fromCharCode","showSearch","fComp","iLow","iHigh","moveToRow","sOptSearch","pbDDHotKeys","oForm","oOKBtn","oJSEvent","oDOMEvent","_eKeyBuddy","moveUpRow","moveDownRow","movePageUp","movePageDown","moveToFirstRow","moveToLastRow","showSwipeLeft","showSwipeRight","pbDataAware","updateColumnsFromCache","iPrevRow","bRowChange","appendNewRow","sGotoRow","tOptSelectRowData","bContinue","sTargetRowId","tSelectRowData","iRowChange","handleRowChange","bOverridden","pbOfflineEditing","serializeRows","bResetChange","iTopRow","iLastRow","loadCachePage","_bNoRender","bError","processDataSet","eOperation","fSelect","moveToRowByID","C_LocalStorageName","WebListGroupController","onKeyDown","onSettingsChange","loadGroupConfig","registerMenuGroupingSelector","onGroupsChanged","applyGrouping","iColumnId","applyGroupConfig","bOverrideDefault","pbStoreGroupConfig","localStorage","getItem","getStorageName","storeGroupConfig","clearGrouping","setItem","ex","triggerOnGroupsChanged","aGrpHeadIndex","tPrevRow","bSwitch","iGrp","pbGroupsCollapseByDefault","_iLogicalParentGroup","_iLogicalGroup","collapseAll","expandAll","collapseCurrent","expandCurrent","WebListRowModel","iColMin","iRound","sTableWidth","prepareLayout","bZebra","_aSwipeBtns","rowClass","resizeRowHtml","_aColumnMapper","pbHidden","pbNewLine","pbValueAsTooltip","tooltipValue","sClassSpecifier","fCellClass","cellClass","piListRowSpan","piListColSpan","cHideColumnCSS","tCell","_sCellClass","pbEditable","fCellHtml","bAllFixed","bFixed","iPixels","iPercent","iCols","iFixed","iRatio","aTable","bDef","bGues","pbFixedWidth","recalcColumnSizes","iVCol","bOverrideResizable","iLast","iColls","calcPixelRatio","iColDiff","iChanged","redraw","iFullWidth","findVColNr","WebMenuList","_sCurrentMenu","_eCurrentMenu","_oMenuBtn","psRootCaption","pbShowIcons","genMenuHtml","_eMenuPanel","_eMenuTitle","_eMenuCaption","onMenuClick","getMenuHeight","pbShowBackItem","sID","levelUp","ePrnt","updateMenuSize","bExec","hideMenu","eSub","bNoSizeChanged","iNewHeight","set_pbShowIcons","set_psRootCaption","set_pbShowBackItem","WebContextMenu","_oRootControl","_oMenu","_oChildrenCache","set_psControlName","sControlName","bForceInit","psControlName","unbind","bind","set_peContext","peContext","set_psContextCSSSelector","sContextCSSSelector","psContextCSSSelector","onClickGeneral","piMaxHeight","_fMenuBaseClick","_hContextMenu","privateStopEvent","_bProviderRequestAfterRender","isRootControlReady","afterRenderRootControl","rebind","_hRootControlAfterRender","pbChildScopes","useCSSSelectorOfObject","bindHandlerForWebUIContext","onContextMenuOpen","noError","sCSSSelector","unbindHandlerForWebUIContext","getVisibleChildCount","isVisible","oTargetContext","eTargetControl","psContextScopeName","bValid","psContextValue","vValue","oServerEvent","enable","bOptState","disable","createMenuItem","createCheckedMenuItem","bChecked","bOptEnabled","WebMenuColumnBase","getList","_oList","WebMenuColumnList","_iAddedColums","refreshColumnList","_oHeader","registerMenuColumnList","iColumnCount","pbHideable","_oColumnRef","set_pbHidden","triggerLayoutChange","WebMenuColumnRestorer","registerMenuColumnRestorer","triggerRestoreColumnLayout","WebListHeaderView","_oHeaderMenu","_oHeaderMenuColumnList","_oHeaderMenuColumnRestorer","_bHeaderMenuPreviousState","_oColumnNewLineCache","_onModulesCreated","onModulesCreated","pbShowHeader","pbColumnsResizable","headerHtml","eHeadWrp","onHeadClick","onHeadMouseDown","onHeadDblClick","setColumnReordering","pbAllowColumnReordering","registerHeaderMenu","oMenu","unregisterHeaderMenu","oMenuColumnList","oMenuColumnRestorer","setColumnHiding","onHeadMouseDownWithDraggingProxy","oLast","headerCSS","updateHeader","iPrevHeight","pbAllowColumnHiding","_eHead","bDragging","resizeColumn","iColumn","eColumnHead","moveColumn","eColumnHeader","iOriginalDbIndex","eColumnGhost","aLayoutToMapperIndex","iOriginalIndexInLayout","children","iOriginalIndexInMapper","iNewIndexInMapper","aColumnHeadedRows","oColumnHead_Rect","iColumnGhost_MouseCorrection_X","iColumnGhost_MouseCorrection_Y","aGhostColumnCells","eVerticalScrollBar","aHorizontalScrollBars","eGhostListLabel","sBodyOverflowCache","aColumnElements","updateColumnShadowPosition","iNewIndexOfColumn","moveElementToIndex","dtLastHorizontalScroll","now","eHorizontalSrollbar","iHorizontalScrollDeltaPx","onMove","oScrollBarRect","eWebObject","iLeftBarrier","iRightBarrier","iNewIndexInLayout","onStopMove","oOrgCol","piPosition","iPX","eColumn","iStartX","iNewX","iNewLeft","WebListFooterView","pbShowFooter","footerHtml","eFooter","eFooterWrp","oFooterRow","peFooterAlign","peFooterDataType","psFooterMask","piFooterPrecision","aMergedColumns","psFooterValue","updateFooter","WebListTouchHandler","iAutoScrollIncr","iSwipeStartOffset","iSwipeOffset","eSwipeRow","eSwipeRowStart","eSwipeLeftBtns","eSwipeRightBtns","PointerEvent","onPointerDown","onTouchStart","passive","targetTouches","touchScroll","pointerType","bPointer","iTimeConstant","bScrollable","iPrevY","iFrame","tTracker","iTarget","iBounce","iStartOffset","iAuto","iPrevX","iVelocity","iAmplitude","iTimestamp","iBounceTime","bSwipe","bSwipeFixed","bSwipable","swipeStart","pageX","iStartY","pageY","touchMove","swipeRow","swipeRowCancel","autoScroll","iElapsed","iDone","exp","aniScroll","touchEnd","swipeRowEnd","iLengthMS","iFrom","tStart","tEnd","animate","iStep","t","d","cos","PI","iNow","swipeRowClose","initSwipeRow","swipeAniOffset","eLeft","eRight","bRight","aLeftHtml","aRightHtml","pbPositionLeft","btnHtml","iDiffX","eBtn","btnClick","WebListPlaceHolderView","_oModel","_oFooter","_iColCount","_tRedraw","_bScrollQueued","_bIsColumn","_bIsSwipeButton","recordColumnMapperDefaults","loadLayout","rebuildColumnMapper","createModel","_oController","createController","createRowModel","createHeaderView","createView","createFooterView","createTouchHandler","_oPlaceHolder","createPlaceHolder","createGrouping","clearGroupConfig","sPostFix","host","pathname","serializeLayout","aLayout","oColLayout","sObjName","iPosition","bHidden","bLoadIntoMapper","bRedraw","pbStoreColumnLayout","sLayout","restoreColumnMapper","saveLayout","hSender","_defaultLayout","restoreColumnMapperDefaults","lookupSet","oColumnRef","aIndifferent","triggerRebuildHeaderMenu","peDbGridType","focusHtml","bSkip","onKeyPress","onListClick","psKeyBuddy","gridRefresh","webListData","handleDataPage","deserializeRows","dataSetAppendRow","dataSetInsertRowBefore","sBeforeRowID","dataSetInsertRowAfter","sAfterRowID","dataSetRemoveRow","dataSetUpdateRow","expandAllGroups","collapseAllGroups","set_psCurrentRowId","set_pbAllowColumnReordering","set_pbAllowColumnHiding","get_psCurrentRowId","currentRowId","get_piRowCount","get_piCurrentRowIndex","set_piSortColumn","propertyUpdate","set_pbReverseOrdering","set_pbShowHeader","set_pbShowFooter","set_pbShowSelected","set_pbColumnsResizable","set_pbAutoColumnSizing","set_pbGroupsCollapsible","set_pbGroupsCollapseByDefault","prev","newval","prevval","updateCurrentCell","getColCell","getColHead","getCell","superFunction","oFocusObj","eCaption","eIter","itemId","dY","dT","iBottomSection","dragScroll","iTopSection","getPlaceholderRowHeight","iAvgHeight","iFirstRowHeight","WebColumn_mixin","_bCellEdit","set_psFooterValue","set_psFooterMask","set_piFooterPrecision","set_peFooterAlign","set_peFooterDataType","WebGrid","bCS","set_piPosition","set_pbHideable","set_pbEditable","set_pbFixedWidth","set_pbNewLine","set_piListColSpan","set_piListRowSpan","cellEdit","cellUnEdit","selectCol","WebColumnBase","WebColumn","WebGridView_mixin","define_WebGridView_mixin","eEditCell","oEditCol","sEditRowId","bCellEdit","bStopFocus","onColChange","editCell","unEditCell","bIsRow","iCurrentColumn","bEdit","_bIgnoreOnChange","eFocus","bUpdate","iEditRowId","WebGridView","WebGridScrollingView","WebGridModel_mixin","define_WebGridModel_mixin","piCurrentColumn","WebGridModel","WebGridPagedModel","WebGridController","iChangeToCol","bNewRow","tNewRow","iNewCount","updateCacheFromColumns","iNewRow","iGotoCol","tOrigRow","tUpdateRow","createNewRow","pbAllowAppendRow","insertNewRow","pbAllowInsertRow","clearRow","bPrevRow","bNextRow","oVisCol","oSelCol","get_piCurrentColumn","set_piCurrentColumn","WebMultiSelectListController","_bAllChecked","_iBeginRange","oJsEv","pbKeyboardSelection","toggleCurrentRow","toggleSelectAll","clearSelection","pbSelectionByRow","setCurrentRow","sSubRowId","setSelection","bNoChangeRow","toggleSelectionOfRow","_bIsMultiSelectCapable","isRowIdSelected","setAllSelectedCheckboxState","bAllSelected","areAllRowsSelected","bSelected","optNoThrowEvents","_paSelectedRowIds","_sRowId","fireSelectionEvent","isCurrentRowSelected","bValue","aCache","tNullableRow","eSelectionEvents","eEventType","WebMultiSelectListRowModel","_sCSSSelectedClass","_sCSSUnSelectedClass","WebMuliSelectList","_aMultiSelectColumns","set_paSelectedRowIds","aSelectedRowIds","every","get_paSelectedRowIds","sSelectedRow","hasCheckboxColumn","items","rowId","_eTempCrt","padding","backgroundColor","border","setDragImage","WebColumnComboBase","WebColumnCheckboxBase","WebColumnCheckbox","_sTick","WebColumnDateBase","WebColumnButtonBase","WebColumnImageBase","WebColumnSuggestionBase","WebColumnLinkBase","WebColumnTagsBase","WebMenuBar","_bShownByHover","_sSelectedItem","_sExpanded","_tHideTimeout","onMouseOver","onMouseOut","exapndPath","notifyReceived","selectItem","isExpanded","collapseItem","pbShowOnHover","collapseSubItems","notifyLost","bWithoutTransition","sConstructPath","eLast","iViewport","bMouseOut","moveParent","moveSibling","moveChild","bRoot","pbFocusable","WebToolBar","adjustWidth","psSubItemCaption","_bSubMenuOpened","expandSub","eSubBtn","eSubMen","_iLastResizeSpace","_bIsCommandBar","WebBaseMenuGroup","WebListGroupSelector","aColumns","eDragGroup","onSizeChanged","components","eMain","eSubGroupBtn","eFieldsSelected","eChip","eSelectDropdown","oWebList","onWebListSettingsChange","createElements","updateColumns","renderGroups","pbGroupable","onMainClick","onAddButtonClick","onAddDropDownClick","onFieldsClick","onFieldsChange","onFieldsDragStart","onFieldsDragEnter","onFieldsDragLeave","onFieldsDragOver","onFieldsDragEnd","onFieldsDragDrop","eDropDown","availableColumns","columnIndexById","iColId","colid","fireGroupsChanged","aSelColIds","tGrp","iGrpIndex","iGroup","group","eGroup","effectAllowed","eOverGroup","finishDrag","iNexGroupIndex","WebCard","WebCardContainer","_eBtn","_bCurrent","_bCC","tabButtonHtml","psBtnCSSClass","btnRendered","onBtnKey","onBtnFocus","onBtnBlur","renderCard","bFirstElem","showCard","_oCurrent","_eLabel","hideCard","set_psBtnCSSClass","_iHeightSet","_aCards","_sCardClass","headHtml","pbSwipeCards","set_pbSwipeCards","touchSwipe","oShowCard","oPrev","oCurrent","eCur","eNext","ePrev","iBehindOffset","psCurrentCard","hasDynamicHeight","getNaturalHeight","iTab","resizeCards","renderAllCards","oDisplay","bOptFirst","fireCardChange","oTab","sTo","sFrom","oHide","nextCard","previousCard","get_psCurrentCard","WebTabPage","sAltText","sIcon","bFolder","bLoadChildren","bExpanded","WebGroupBase","WebGroup","_eExpandBtn","onExpandClick","onTransEnd","onTransEndCancel","pbCollapsible","pbExpanded","set_pbCollapsible","set_pbExpanded","sCrumbCaption","sHeadCaption","colorUp","colorDown","colorLeft","colorRight","sColor","WebColorPicker","_tDoubleClick","_iDoubleClickWait","_aHSV","_aColorPalette","aMainClasses","pbShowColorBar","genColorPaletteHtml","_ePicker","_eColorPalette","_eColorMap","_eMapCanvas","_ePointer","_eGradSlider","_eSliderCanvas","_eSlide","_eColorBar","startMapMouse","startSliderMouse","onPaletteClick","onPaletteDblClick","iPalOffset","drawColorMap","positionPointer","drawGradientSlider","eCanvas","_mainctx","getContext","ctx","clearRect","hGrad","createLinearGradient","addColorStop","fillStyle","fillRect","vGrad","aHSV","getHSV","_sliderctx","aRGB","HSVtoRGB","RGBtoHexString","positionSlider","addPaletteItem","updatePalette","aPal","piPaletteItemsPerRow","stringToRGB","sPrevColor","RGBtoHSV","setHSV","updateColor","adjustColor","iType","psColor","set_pbShowColorBar","bUpdateGradient","peColorFormat","RGBtoRgbString","rgb","h","g","hsv","f","p","q","hexStringToRGB","rgbStringToRGB","WebHtmlListRowModel","rRegEx","_sHtmlTemplate","sP1","_oColMap","WebHtmlListView","psHtmlBefore","psHtmlAfter","sElemClick","bRowClick","aDragData","aDropData","WebDragDropHelper","_aSources","_aTargets","_oDragData","_bInitializedDrag","_bAcceptAllDrops","_oDragObj","isDropAllowed","bExists","curSource","newSource","curTarget","newTarget","oDragObj","supportsDragAction","serializeDragDropData","oSourceDfObj","_oControl","oDropData","oDragDropData","DragData","DropData","_eDropPosition","onDragOver","destroyDragObj","WebDragDropUploadBase","iRowCount","sDefaultColWidth","sRowHeights","sColWidths","bFillHeight","tNameValuePair","GridDef","aWidgets","self","bSending","piHideDelay","poTarget","_eEventElem","_bFirstPos","_bTopTooltip","getTargetElem","eTool","oRectT","_oGroups","sGroup","aProviders","collectGroup","sOptWebService","psWebService","pbXHRWithCredentials","oRequest","_eContentWrap","set_piMaxWidth","piMaxWidth","navigateBackToHere","bCancel","bCallback","sCallback","closePanel","maxWidth","updateAlign","sComp","pbStopOnSubmit","_sExpandedRow","_bExpanding","OnAfterExpand","_oL","expand","colTransEnd","expTransEnd","pbShowLoading","iHeightTo","get_psExpandedRow","pbDynamic","set_psBtnCssClass","psBtnCssClass","sAttributes","psButtonCaption","set_psImageUrl","psImageUrl","eImg","sStyle","piImageWidth","piImageHeight","aImages","pbImageByCSS","psImageCSSClass","aSelection","_bAllCheckedCheckbox","setAllSelectedCheckbox","pbSelectAllCheckbox","set_pbSelectAllCheckbox","bSelectAllCheckbox","eToolWrap","_bActive","OnShow","bMenu","showMask","_oGroupingSelector","onSizeChange","itemHidden","_eLabelSpacer","_aRootItems","_aItems","_iAutoNum","_tSelectedNode","_bRedraw","_eRootTable","_eCurHoveredElem","_fHoverTimeOut","onBodyDblClick","scrollToElement","get_psSelectedId","get_psSelectedValue","sNodeId","tNode","getNodeById","doSelect","expandNode","collapseNode","sSelectedId","aNodes","psSelectedId","doRemove","displayLoading","initNode","insert","hideLoading","updateNode","tNewNode","tOrigNode","insertNode","removeNode","loadSubNodes","tParentNode","sParentValue","iParentLevel","_bIsLoading","getLevel","updateNodeCSS","_bIsLoaded","addSubItems","_tParent","_eSubMenuRow","_eSubMenuTable","constructTable","constructMenu","constructNode","bIsStart","bIsLast","bDoSub","insertCell","cells","constructSubmenu","iNode","eRootTable","eNewTable","isRoot","hasChildren","backgroundImage","backgroundRepeat","toggle","rowIndex","getPosition","doCollapse","doExpand","bOptNoOnSelect","tPrevSelected","bOptNoSelect","removeSub","oDiv","iItemId","hItem","eNode","pbServerOnClick","psClientOnClick","_eImg","_sLastUrl","_iImageWidth","_iImageHeight","onImageLoaded","updateImage","centerImage","alt","iHorizScale","iVertScale","iScale","pbFitZoom","_oMaster","_aRadios","_iPrevSelected","set_psRadioValue","psRadioValue","psMasterName","registerRadio","oRadio","_eSlider","_eSliderWrp","_eSliderBar","_eLabels","_eValueIndicator","_bSelected","_bFocus","_eRangedSlider","_iValueInterval","_aLabels","_aMarkers","_iPrevChangePos","_iPrevChangeFrom","_iPrevChangeTo","piSliderValue","piMinValue","assertions","pbRanged","pbShowValue","pbVertical","pbShowRange","generateMarkers","renderLabels","_eSliderBarWrp","_eSliderBarInner","_eRangeIndicator","updateDisplay","onTouchDown","onMouseDown","onLabelClick","onSliderClick","piInterval","piFrom","piTo","positionLabels","nWidth","nStep","getInterval","nFrom","nTo","fillLabels","updateLabels","iNumberOfIntervals","iInterval","pbShowMarkers","piMaxMarkers","iDevide","sortLabels","removeDoubleValues","aLabels","iDummyArray","iNewPosition","nRel","nSliderOffset","iIntervalSize","aMarkers","iValue","aNewLabels","increment","bUp","bSize","toPositive","sqrt","getMaximalSliderPosition","iSliderSize","eLabel","slide","tRec","iD","pbMouseWheelScroll","bRanged","iStartValue","bVert","getPos","iMouseStart","onDragSlide","iNewValue","iNewMouseValue","iTemp","onStopSlide","oOffset","iRawVal","set_piMinValue","set_piInterval","set_pbShowMarkers","set_piSliderValue","set_piFrom","set_piTo","_tInterval","_tTimeout","pbRunning","trigger","pbWaitForCall","set_pbRunning","set_pbWaitForCall","pbAutoStop","onContentClick","updateDetails","fireContentClick","peState","sDtl","psFileName","pbShowMime","piFileSize","psFileMime","pbServerOnFileClick","_eState","_sDisplayFileName","_iDisplayFileSize","_sDisplayFileMime","_eBar","_eList","_bDropDownExpanded","peBreadcrumbStyle","set_peBreadcrumbStyle","bStop","bDropDown","showDropDown","hideDropDown","hasChildNodes","aElements","resetWidths","adjustWidths","aDivs","sumElementWidths","iSumWidth","reduceWidthsToTarget_li","aListItems","iTargetWidth","eDiv","iRemainder","iDiffTotal","iDiffPerItem","ceil","sTip","iSumChildWidths","getElementsByClassName","constructList","constructItems","bCurrent","sLine","_oPnl","_oMenuList","_sRealgroupName","_bIsMenu","pbRenderAsAnchor","showMenu","pbOpenOnRoot","piMenuWidth","psMenuCSSClass","piMenuHeight","oMnu","pbMenuShowCaption","pbMenuShowIcons","psMenuRootCaption","get_psGroupName","set_pbMenuShowCaption","set_pbMenuShowIcons","set_psMenuRootCaption","set_psMenuCSSClass","set_piMenuWidth","set_piMenuHeight","pbColorBackground","_eColorBox","onColorClick","piPickWidth","piPickHeight","_oColorPicker","onPickerClose","set_pbColorBackground","set_piPickHeight","set_piPickWidth","set_piPaletteItemsPerRow","_oRegEx","psHighlightCSSClass","psHighlight","getRegEx","set_psHighlight","set_psHighlightCSSClass","set_pbFullText","set_pbSeparateWords","pbSeparateWords","set_pbCaseSensitive","aHighlights","sMod","openCardsAfterRender","pbMultiOpen","_bExpanded","bDynamic","pbOpenFirst","eButton","eTab","pbAutoHeight","oCard","getCardHeight","iNaturalHeight","iCardHeight","set_pbMultiOpen","set_pbAutoHeight","triggerCardResize","bClearInnerHeight","psBtnBackgroundColor","set_psBtnBackgroundColor","get_pbExpanded","_Elem","initTemplate","psHtmlTemplate","sTemplate","updateTemplate","sNewTemplate","set_psHtmlTemplate","set_psHtmlBefore","set_psHtmlAfter","peDropPosDetectionMode","determineDropPosVertical","determineDropPosHorizontal","_iWatchId","_iLocChTime","_iLocChTimer","set_pbTracking","pbTracking","queryLocation","sCallbackMsg","sCallbackObj","geolocation","getCurrentPosition","updateProps","pnLatitude","pnLongitude","pnAccuracy","pnSpeed","pnHeading","locationerror","code","geoOptions","coords","latitude","longitude","accuracy","speed","heading","fireLocationChange","trackPosition","piMaxTimeout","watchPosition","clearWatch","enableHighAccuracy","pbEnableHighAccuracy","maximumAge","piMaxAge","Infinity","_eDrawing","drawingItemMap","Map","drawingsBuffered","globalScale","panOffset","previousMousePosition","ns","_zoomBtns","_btnZoomIn","_btnZoomOut","_btnZoomReset","wdResizeModeDisabled","wdResizeModeScale","wdResizeModeCrop","wdInteractionOnMouseDown","wdInteractionOnMouseUp","wdInteractionOnMouseEnter","wdInteractionOnMouseLeave","wdInteractionOnMouseMove","wdInteractionOnMouseClick","wdInteractionOnMouseDoubleClick","wdInteractionOnMouseDrag","peResizeMode","piDrawingWidth","piDrawingHeight","pfMinZoom","pfMaxZoom","pfDefaultZoom","psCanvasBackgroundColor","initializeDrawing","createSVGDomElements","pbNoContextMenu","pbDebugOutline","piDebugOutlineWidth","borderColor","psDebugOutlineColor","pbZoomable","deltaY","updateViewBox","getMousePos","getTouchPos","buttons","currentMousePosition","viewPanning","diffX","diffY","diffXScaled","diffYScaled","ratio","centerX","centerY","newWidth","newHeight","offsetX","offsetY","setAttributeNS","updateSizes","baseVal","heightRatio","widthRatio","pbClientOnResize","dataToSend","createResizeEventData","viewWidth","viewHeight","fViewWidth","fViewHeight","updateInstructions","collectInstructions","setGroupingPositions","updateDrawing","clearDrawing","drawingItem","subDrawingItemMap","drawingItemData","getCentroidOfGrouping","adjustChildrenPosition","currentCenter","childDrawingItem","childCurrentCenter","cloneObject","shape","diffTLX","topLeft","diffTLY","diffBRX","bottomRight","diffBRY","subPoint","subPoints","diffPosX","diffPosY","position2","diffPos2X","diffPos2Y","instructions","untrackedIdIndex","instr","hasEntered","hasLeft","startsWith","startSubInstructionIndex","endSubInstructionIndex","subInstructions","shadowOffset","groupInstructions","si","groupInstr","applyGroupedInstruction","subInstrToRemove","deleteItem","applyInstruction","applyCreateInstruction","applyNormalInstructions","typeName","params","asParams","mapHasId","scale","closed","posX","posY","radius","getCentroid","radiusX","radiusY","pos1X","pos1Y","pos2X","pos2Y","content","fontFamily","fontSize","justification","fontWeight","textDecoration","fillColor","strokeColor","enumJustificationIntToString","path","getImageShapeData","imagePath","_","sp","strokeWidth","strokeCap","enumStrokeCapIntToString","strokeJoin","enumStrokeJoinIntToString","dashOffset","strokeDistance","whitespaceDistance","shadowColor","shadowBlur","customAttribute","customAttributeName","customAttributeValue","currentPos","rotation","rotateInPlace","enabledInteractions","flags","tooltip","positions","subDrawingItem","createSVGDomElement","pathItem","existingElement","isEqualNode","replaceWith","createElementNS","childId","applyStylesForGroupChildren","applyTransformStyles","assignEvent","createSVGData","applyStyles","pathCommands","parentDrawingItemData","dashList","shadowList","titleElement","transformList","handleEvent","eventName","createEventData","fX","fY","touches","tempXandY","tMousePosition","eMouseButtons","tPosition","fRotation","tScaling","fWidth","fHeight","sStrokeColor","fStrokeWidth","iStrokeCap","enumStrokeCapStringToInt","iStrokeJoin","enumStrokeJoinStringToInt","fDashOffset","sFillColor","sShadowColor","fShadowBlur","tShadowOffset","sTextContent","sFontFamily","fFontSize","eJustification","enumJustificationStringToInt","sFontWeight","sTextDecoration","sumX","previous","current","sumY","recursiveDeleteFromMap","idToRemove","itemsToRemove","itemToRemove","input","blobImageToBase64","blob","reader","onloadend","result","readAsDataURL","idToCheck","checkMapChildren","async","svgCopy","svgImages","svgImage","response","fetch","imgBlob","svgImageReader","drawing","XMLSerializer","serializeToString","img","Image","svgBlob","Blob","svgDrawingReader","drawImage","toDataURL","exportDrawingDataToJSON","fromEntries","importDrawingFromJSON","jsonInput","set_psCanvasBackgroundColor","_eInsertedElem","_aHelpers","_iEnterCount","attachHandlers","detachHandlers","onDragEnter","onDragLeave","controlHasData","getDropCandidate","bOverDropPlaceHolder","isOverDropPlaceHolder","ePosition","getDropPosition","removeInsertedElement","clearHighlight","targetElem","eOptForceDropPosition","insertAdjacentElement","_oCurDropZone","bFileDrag","_tempDropData","fUploadCallback","doHighlightDropZones","doCleanupHelper","_bEditMode","_eSelTop","_eSelLeft","_eSelBottom","_eSelRight","_eDragMove","_eResizeHandle","_eRemoveBtn","_oInternalDragDropHelper","getWidgetProps","psWidgetName","sDynId","psDynamicWidgetId","aConfig","getCurrentConfiguration","initInternalDrag","setEditMode","showEditBox","hideEditBox","eBox","_eEditBox","_eEditBtn","onWidgetMove","onWidgetResize","onEditClick","onRemoveClick","pbConfigurable","repositionEditBox","positionEditBox","_eSel","pbAllowResize","editWidget","editWidgetEx","removeWidget","removeWidgetEx","iStartRowIndex","iStartColIndex","iNewColSpan","iNewRowSpan","oObjParentContainer","snapshotChildrenPositions","_eGridOverLay","drawGridOverlay","showGrid","aPointElems","elementsFromPoint","sCellID","dfcellid","bColChanged","bRowChanged","resetPositionsToSnapshot","getObjRect","checkAndResolveCollisions","redrawGrid","hideGrid","iCellRow","determineRow","iCellCol","determineColumn","bAutoRepos","WidgetProps","initWidgetDrag","moveWidget","set_piRowIndex","getParentContainer","eStartElem","_oMutationObserver","mutationList","attributeFilter","attributeOldValue","_oWidgetContainer","_aWidgets","_aHighlightedCells","_eEditMenu","_oSelectedWidget","_oCurDragControl","_aChildrenSnapShot","_bResolvingCollisions","_iCurrentHoverCol","_aWidgetDefaultSizes","_iRowsActual","_iGhostRows","applyProps","eEditWrp","_eToggleEditBtn","toggleEditMode","eSaveEditsBtn","saveConfiguration","eCancelEditsBtn","cancelEdits","pbDisableInternalDragDropHelper","initInternalDragDropHelper","pbAutoToggleGrid","pbUseCustomConfigurationStorage","pbServerOnToggleEditMode","pbServerOnWidgetMoved","pbServerOnWidgetResized","calcRowsActual","loadWidgets","tConfiguration","registerWidgetDefaultSizes","registerWidget","oWidget","findSpotForWidget","oWidgetDef","findSpotForWidgetEx","oObjRect","aCollisionObjs","iRowMin","iRowMax","iColMax","checkForCollisions","serializeDashboard","saveConfigurationToLocalStorage","saveConfigurationToLocalStorageEx","invalidateLocalConfiguration","oDashboardConfig","sConfigVersionCode","psConfigVersionCode","iDefaultRowHeight","widgetByName","loadConfigurationFromLocalStorage","sConfig","destroyGrid","getContainerRect","determineColumns","determineGridOverlayRows","sRow","genGridRowHtml","_iRowCount","iRowNum","bIsGhostRow","sColTemplate","determineRows","sBaseRowHeight","findParentWidget","toggleGrid","_bGridVisible","oContainerRect","refreshOverlay","set_ptContainerDef","ptContainerDef","set_peLayoutType","dropData","iDropRow","iDropCol","_oWidgetDragInfo","iRowOffset","iColOffset","sWidgetName","findWidgetNameInDragData","oDef","determineGridCell","removeGhostRows","_iCurrentHoverRow","oDragControl","iNewCol","getObjRectFromDefaultSizes","gridArea","sPlaceholderHtml","checkGridBottom","iCurGhostRows","iRefRow","iRowDiff","addGhostRows","iRowsToAdd","sGhostRowsHtml","iNewRowNum","eGridoverLayTableBody","iToRow","aeRows","dfisghostrow","oOptRefObj","isWithinObjRect","resolveCollision","oCurObjRect","aObjCols","aChildCols","iChildColMax","arrayIntersections","aObjRows","aChildRows","iChildRowMax","setA","highlightGridCell","set_pbAutoToggleGrid","set_pbDisableInternalDragDropHelper","set_pbUseCustomConfigurationStorage","set_pbServerOnToggleEditMode","set_pbServerOnWidgetMoved","set_pbServerOnWidgetResized"],"sourceRoot":""}